const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/PatientEducationAgent.Dp4R0RAp.js","chunks/agents.BCwlpfSj.js","chunks/services.ChDmJF-3.js","chunks/BatchPatientReviewAgent.uf_0rG-p.js","chunks/AgentFactory.BUZB8vXp.js","chunks/modulepreload-polyfill.B5Qt9EMX.js","chunks/vendor-ui.D4lcIdSh.js","chunks/vendor.DxVDkWSy.js"])))=>i.map(i=>d[i]);
import"./chunks/modulepreload-polyfill.B5Qt9EMX.js";import{Q as $a,j as t,a as _a,C as Fn,M as Se,A as qt,Z as en,b as Ye,c as Fa,d as at,P as La,e as Ln,R as za,V as Ba,D as rt,f as Ct,T as Tt,U as Le,E as on,g as Ua,K as Ht,h as xt,S as Me,i as tn,k as zn,l as Bn,m as Un,n as qa,o as qn,F as Et,p as Ke,q as bt,G as ft,r as ln,s as Wt,B as Hn,t as Gt,u as Ha,v as Wa,X as xe,w as Ga,x as Va,y as Xa,L as ze,z as nn,H as ot,I as vt,J as Ka,N as Qa,O as Ot,W as tt,Y as Vt,_ as Ya,$ as yt,a0 as Ja,a1 as Za,a2 as $t,a3 as cn,a4 as er,a5 as tr,a6 as Wn,a7 as dn,a8 as nr,a9 as ar,aa as rr,ab as ir,ac as sr,ad as or,ae as lr}from"./chunks/vendor-ui.D4lcIdSh.js";import{a as Gn,r as d,R as Z,g as cr}from"./chunks/vendor.DxVDkWSy.js";import{L as dr,W as mr,l as mn}from"./chunks/services.ChDmJF-3.js";var Vn,un=Gn;Vn=un.createRoot,un.hydrateRoot;const ur="modulepreload",pr=function(n){return"/"+n},pn={},je=function(e,a,r){let i=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");i=Promise.allSettled(a.map(c=>{if(c=pr(c),c in pn)return;pn[c]=!0;const m=c.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const h=document.createElement("link");if(h.rel=m?"stylesheet":ur,m||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),m)return new Promise((u,f)=>{h.addEventListener("load",u),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},hr=new $a({defaultOptions:{queries:{staleTime:10*60*1e3,gcTime:30*60*1e3,retry:2,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!0,refetchInterval:!1},mutations:{retry:1}}}),gr=({children:n})=>t.jsx(_a,{client:hr,children:n}),Xn=d.createContext(void 0),fr=({children:n})=>{const[e,a]=d.useState(null),[r,i]=d.useState(null),[s,o]=d.useState("auto"),[l,c]=d.useState("auto"),m=(h,u=!1)=>{if(a(h),o(u?"manual":"auto"),u&&h)try{localStorage.setItem("xestro-preferred-microphone",h)}catch(f){console.warn("Failed to persist microphone preference:",f)}},p=(h,u=!1)=>{if(i(h),c(u?"manual":"auto"),u&&h)try{localStorage.setItem("xestro-preferred-speaker",h)}catch(f){console.warn("Failed to persist speaker preference:",f)}};return t.jsx(Xn.Provider,{value:{selectedMicrophoneId:e,selectedSpeakerId:r,microphoneSelectionType:s,speakerSelectionType:l,setSelectedMicrophoneId:m,setSelectedSpeakerId:p},children:n})},Kn=()=>{const n=d.useContext(Xn);if(n===void 0)throw new Error("useAudioDeviceContext must be used within an AudioDeviceProvider");return n},Qn=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"m12 1 0 11"}),t.jsx("path",{d:"m18 7c0 4.97-4.03 9-9 9s-9-4.03-9-9"}),t.jsx("path",{d:"m12 20 0 3"}),t.jsx("path",{d:"m8 23 8 0"})]}),xr=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),Pt=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t.jsx("polyline",{points:"14,2 14,8 20,8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),t.jsx("polyline",{points:"10,9 9,9 8,9"})]}),br=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"22,12 18,12 15,21 9,3 6,12 2,12"})}),vr=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"}),t.jsx("path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"}),t.jsx("circle",{cx:"20",cy:"10",r:"2"})]}),yr=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("circle",{cx:"12",cy:"12",r:"1"})]}),ve=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"20,6 9,17 4,12"})}),it=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),Ie=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"})}),wr=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("polygon",{points:"11,5 6,9 2,9 2,15 6,15 11,19"}),t.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"})]}),kr=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("path",{d:"m21 21-4.35-4.35"})]}),jr=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Nr=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M10.5 20.5 L3.5 13.5 L10.5 6.5 L17.5 13.5 Z"}),t.jsx("path",{d:"M13.5 3.5 L20.5 10.5 L13.5 17.5 L6.5 10.5 Z"})]}),Sr=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),Yn=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"6,9 12,15 18,9"})}),Jn=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"18,15 12,9 6,15"})}),nt=({className:n="w-4 h-4",title:e})=>{const[a,r]=d.useState(!1),i=()=>{r(!0),setTimeout(()=>r(!1),300)};return t.jsx("span",{onMouseEnter:i,onFocus:i,className:"relative inline-flex items-center justify-center group","aria-hidden":e?void 0:!0,title:e,children:t.jsx(Fn,{className:`${n} transition-transform duration-300 ${a?"animate-bounce":"group-hover:scale-110"}`})})};class _e{static instance;metrics=[];maxMetricsHistory=100;constructor(){}static getInstance(){return _e.instance||(_e.instance=new _e),_e.instance}recordMetrics(e,a,r){const i={timestamp:Date.now(),processingPhase:e,duration:a,memoryUsage:this.getMemoryInfo(),systemLoad:this.getSystemLoad(),...r};this.metrics.push(i),this.metrics.length>this.maxMetricsHistory&&(this.metrics=this.metrics.slice(-this.maxMetricsHistory)),console.log(`ðŸ“Š Performance: ${e} completed in ${a}ms`,{phase:e,duration:a,agentType:r?.agentType,audioSize:r?.audioSize?Math.round(r.audioSize/1024)+"KB":void 0,memoryUsage:i.memoryUsage?.estimatedMemoryMB+"MB"}),this.detectPerformanceIssues(i)}getMemoryInfo(){let e={totalAgents:0,estimatedMemoryMB:0};try{typeof window<"u"&&window.AgentFactory&&(e=window.AgentFactory.getMemoryEstimate())}catch{}const a=window.performance;let r={jsHeapSizeLimit:0,jsHeapTotalSize:0,jsHeapUsedSize:0};return a&&a.memory&&(r={jsHeapSizeLimit:a.memory.jsHeapSizeLimit,jsHeapTotalSize:a.memory.totalJSHeapSize,jsHeapUsedSize:a.memory.usedJSHeapSize}),{...e,...r}}getSystemLoad(){const e=this.metrics.slice(-5);if(e.length===0)return{};const a=e.reduce((o,l)=>o+l.duration,0)/e.length,r={transcription:2e3,"agent-loading":500,"agent-processing":5e3,complete:0};let i=0;e.forEach(o=>{const l=r[o.processingPhase]||1e3,c=o.duration/l;i+=Math.min(c,3)});const s=i/e.length*100;return{cpuUsage:Math.min(s,100),isMainThreadBlocked:a>1e4,frameDrops:s>200?Math.floor(s/50):0}}detectPerformanceIssues(e){const a=[];e.processingPhase==="transcription"&&e.duration>1e4&&a.push(`Slow transcription (${e.duration}ms) - check MLX Whisper server`),e.processingPhase==="agent-processing"&&e.duration>3e4&&a.push(`Slow processing (${e.duration}ms) - agent: ${e.agentType}`),e.memoryUsage&&e.memoryUsage.jsHeapUsedSize>100*1024*1024&&a.push(`High memory usage (${Math.round(e.memoryUsage.jsHeapUsedSize/1024/1024)}MB)`),e.memoryUsage&&e.memoryUsage.totalAgents>8&&a.push(`Too many agents loaded (${e.memoryUsage.totalAgents}) - consider cache optimization`),a.length>0&&console.warn("âš ï¸ Performance issues detected:",a)}getPerformanceSummary(){if(this.metrics.length===0)return{totalSessions:0,averageTranscriptionTime:0,averageProcessingTime:0,averageCompressionRatio:0,memoryTrend:"stable",recommendedOptimizations:["Start using the extension to collect performance data"]};const e=this.metrics.filter(m=>m.processingPhase==="transcription"),a=this.metrics.filter(m=>m.processingPhase==="agent-processing"),r=this.metrics.filter(m=>m.compressionRatio!==void 0),i=e.length>0?e.reduce((m,p)=>m+p.duration,0)/e.length:0,s=a.length>0?a.reduce((m,p)=>m+p.duration,0)/a.length:0,o=r.length>0?r.reduce((m,p)=>m+(p.compressionRatio||0),0)/r.length:0,l=this.analyzeMemoryTrend(),c=this.generateOptimizationRecommendations(i,s,o,l);return{totalSessions:Math.floor(this.metrics.filter(m=>m.processingPhase==="complete").length),averageTranscriptionTime:Math.round(i),averageProcessingTime:Math.round(s),averageCompressionRatio:Math.round(o*10)/10,memoryTrend:l,recommendedOptimizations:c}}analyzeMemoryTrend(){const e=this.metrics.slice(-20).filter(l=>l.memoryUsage);if(e.length<5)return"stable";const a=e.slice(0,Math.floor(e.length/2)),r=e.slice(Math.floor(e.length/2)),i=a.reduce((l,c)=>l+(c.memoryUsage?.jsHeapUsedSize||0),0)/a.length,o=(r.reduce((l,c)=>l+(c.memoryUsage?.jsHeapUsedSize||0),0)/r.length-i)/i*100;return o>10?"increasing":o<-10?"decreasing":"stable"}generateOptimizationRecommendations(e,a,r,i){const s=[];return e>8e3&&(s.push("Transcription is slow - check MLX Whisper server performance"),s.push("Consider restarting the Whisper server: ./start-whisper-server.sh")),a>2e4&&s.push("Agent processing is slow - consider using lighter models for simple tasks"),r<20&&s.push("Low compression ratio - audio files may benefit from better compression"),i==="increasing"&&(s.push("Memory usage is increasing - enable automatic cache optimization"),s.push("Consider restarting the extension periodically for long sessions")),s.length===0&&(s.push("Performance is optimal - no specific optimizations needed"),s.push("Continue using agent preloading for best performance")),s}clearMetrics(){this.metrics=[],console.log("ðŸ§¹ Performance metrics cleared")}exportMetrics(){return[...this.metrics]}getRecentIssues(e=5){const a=Date.now()-e*60*1e3,r=this.metrics.filter(s=>s.timestamp>a),i=[];return r.forEach(s=>{s.processingPhase==="transcription"&&s.duration>1e4&&i.push(`Slow transcription: ${s.duration}ms`),s.processingPhase==="agent-processing"&&s.duration>3e4&&i.push(`Slow ${s.agentType} processing: ${s.duration}ms`)}),[...new Set(i)]}}class Fe{static instance;historicalData=[];maxHistorySize=200;performanceService;agentProfiles={"investigation-summary":{baselineMs:1500,lengthScalingFactor:.8,modelComplexity:"lightweight",expectedRange:{min:1e3,max:3e3}},medication:{baselineMs:1800,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3500}},background:{baselineMs:2e3,lengthScalingFactor:1,modelComplexity:"lightweight",expectedRange:{min:1500,max:4e3}},bloods:{baselineMs:1600,lengthScalingFactor:.85,modelComplexity:"lightweight",expectedRange:{min:1100,max:3200}},imaging:{baselineMs:1700,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3400}},"quick-letter":{baselineMs:4e3,lengthScalingFactor:1.2,modelComplexity:"standard",expectedRange:{min:2500,max:8e3}},consultation:{baselineMs:5e3,lengthScalingFactor:1.4,modelComplexity:"standard",expectedRange:{min:3e3,max:12e3}},tavi:{baselineMs:6e3,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},"angiogram-pci":{baselineMs:6500,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},mteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},tteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},"pfo-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"asd-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"right-heart-cath":{baselineMs:5800,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:3800,max:13e3}},"pvl-plug":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"bypass-graft":{baselineMs:7e3,lengthScalingFactor:2,modelComplexity:"heavy",expectedRange:{min:4500,max:18e3}},"tavi-workup":{baselineMs:6500,lengthScalingFactor:1.9,modelComplexity:"heavy",expectedRange:{min:4e3,max:16e3}},"ai-medical-review":{baselineMs:8e3,lengthScalingFactor:2.2,modelComplexity:"heavy",expectedRange:{min:5e3,max:2e4}},"batch-ai-review":{baselineMs:15e3,lengthScalingFactor:3,modelComplexity:"heavy",expectedRange:{min:1e4,max:45e3}},"patient-education":{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:3e3,max:1e4}},enhancement:{baselineMs:3e3,lengthScalingFactor:1.1,modelComplexity:"standard",expectedRange:{min:2e3,max:6e3}},transcription:{baselineMs:2e3,lengthScalingFactor:.5,modelComplexity:"lightweight",expectedRange:{min:1e3,max:4e3}},generation:{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:2500,max:9e3}}};constructor(){this.performanceService=_e.getInstance(),this.loadHistoricalData()}static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}predictProcessingTime(e,a,r){const i=this.agentProfiles[e];if(!i)throw new Error(`Unknown agent type: ${e}`);const s=this.historicalData.filter(T=>T.agentType===e),o=this.categorizeTranscriptionLength(a),l=i.baselineMs,c=this.calculateLengthFactor(a,i.lengthScalingFactor),m=this.calculateHistoricalAdjustment(e,a,s),p=this.calculateSystemPerformanceFactor(r?.systemPerformance),h=l*c*m*p,u=Math.max(i.expectedRange.min,Math.min(i.expectedRange.max,h)),f=r?.includeTranscriptionTime?u+this.estimateTranscriptionTime(a):u,g=this.calculateConfidenceLevel(s.length,o),v=g==="high"?.2:g==="medium"?.4:.6,k={min:Math.round(f*(1-v)),max:Math.round(f*(1+v))},I=[{name:"Agent baseline",impact:l,description:`${i.modelComplexity} model baseline`,type:"additive"},{name:"Transcription length",impact:c,description:`${o.category} transcription (${a} chars)`,type:"multiplier"}];return m!==1&&I.push({name:"Historical performance",impact:m,description:`Based on ${s.length} similar sessions`,type:"multiplier"}),p!==1&&I.push({name:"System performance",impact:p,description:r?.systemPerformance?`Current system load: ${r.systemPerformance}%`:"System performance adjustment",type:"multiplier"}),{estimatedDurationMs:Math.round(f),confidenceLevel:g,factors:I,range:k,basedOnSessions:s.length,displayText:this.formatEstimateForDisplay(k,g,s.length)}}categorizeTranscriptionLength(e){return e<300?{category:"short",range:{min:0,max:300},description:"Short dictation (< 300 characters)"}:e<800?{category:"medium",range:{min:300,max:800},description:"Medium dictation (300-800 characters)"}:e<1500?{category:"long",range:{min:800,max:1500},description:"Long dictation (800-1500 characters)"}:{category:"very-long",range:{min:1500,max:1/0},description:"Very long dictation (> 1500 characters)"}}calculateLengthFactor(e,a){const i=e/500;return 1+Math.log(i+1)*a*.3}calculateHistoricalAdjustment(e,a,r){if(r.length<3)return 1;const i={min:a*.5,max:a*1.5},s=r.filter(o=>o.transcriptionLength>=i.min&&o.transcriptionLength<=i.max);return s.length<2?this.calculateAveragePerformanceRatio(r,e):this.calculateAveragePerformanceRatio(s,e)}calculateAveragePerformanceRatio(e,a){const r=this.agentProfiles[a],i=e.map(o=>{const l=r.baselineMs*this.calculateLengthFactor(o.transcriptionLength,r.lengthScalingFactor);return o.actualProcessingTime/l}),s=i.reduce((o,l)=>o+l,0)/i.length;return Math.max(.5,Math.min(2,s))}calculateSystemPerformanceFactor(e){return e?2-Math.max(0,Math.min(100,e))/100*1.2:(this.performanceService.getPerformanceSummary(),this.performanceService.getRecentIssues(2).length>0?1.3:1)}estimateTranscriptionTime(e){return 1500+Math.log(e/100+1)*200}calculateConfidenceLevel(e,a){return e>=20?"high":e>=8?"medium":"low"}formatEstimateForDisplay(e,a,r){const i=this.formatDuration(e.min),s=this.formatDuration(e.max),o=a==="high"?"High confidence":a==="medium"?"Medium confidence":"Low confidence";return r>0?`Expected: ${i}-${s} (${o}, ${r} sessions)`:`Expected: ${i}-${s} (${o})`}formatDuration(e){if(e<1e3)return`${Math.round(e)}ms`;const a=e/1e3;return a<10?`${a.toFixed(1)}s`:`${Math.round(a)}s`}recordActualProcessingTime(e,a,r,i){const s={agentType:e,transcriptionLength:a,actualProcessingTime:r,timestamp:Date.now(),systemPerformance:i};this.historicalData.push(s),this.historicalData.length>this.maxHistorySize&&(this.historicalData=this.historicalData.slice(-this.maxHistorySize)),this.saveHistoricalData(),console.log(`ðŸ“Š Recorded: ${e} processed ${a} chars in ${r}ms`)}updatePredictionAccuracy(e,a){const r=a>=e.range.min&&a<=e.range.max,i=1-Math.abs(e.estimatedDurationMs-a)/e.estimatedDurationMs;return console.log(`ðŸŽ¯ Prediction accuracy: ${Math.round(i*100)}%, within range: ${r}`),{accuracy:Math.max(0,i),wasWithinRange:r}}getAgentPerformanceStats(e){const a=this.historicalData.filter(s=>s.agentType===e);if(a.length===0)return{averageTime:this.agentProfiles[e]?.baselineMs||5e3,sessionCount:0,accuracyTrend:"stable"};const r=a.reduce((s,o)=>s+o.actualProcessingTime,0)/a.length,i=this.analyzeTrend(a);return{averageTime:Math.round(r),sessionCount:a.length,accuracyTrend:i}}analyzeTrend(e){if(e.length<6)return"stable";const a=Math.floor(e.length/2),r=e.slice(0,a),i=e.slice(a),s=r.reduce((c,m)=>c+m.actualProcessingTime,0)/r.length,l=(i.reduce((c,m)=>c+m.actualProcessingTime,0)/i.length-s)/s*100;return l<-10?"improving":l>10?"declining":"stable"}async loadHistoricalData(){try{const e=await chrome.storage.local.get("processingTimeHistory");e.processingTimeHistory&&(this.historicalData=e.processingTimeHistory.slice(-this.maxHistorySize),console.log(`ðŸ“š Loaded ${this.historicalData.length} historical processing time data points`))}catch(e){console.warn("Failed to load historical processing time data:",e)}}async saveHistoricalData(){try{await chrome.storage.local.set({processingTimeHistory:this.historicalData})}catch(e){console.warn("Failed to save historical processing time data:",e)}}clearHistoricalData(){this.historicalData=[],chrome.storage.local.remove("processingTimeHistory"),console.log("ðŸ§¹ Cleared historical processing time data")}exportHistoricalData(){return[...this.historicalData]}}const ct={"quick-letter":{min:3e4,max:6e4,complexity:"low"},consultation:{min:12e4,max:24e4,complexity:"medium"},"investigation-summary":{min:1e4,max:3e4,complexity:"low"},tavi:{min:48e4,max:72e4,complexity:"high"},mteer:{min:42e4,max:6e5,complexity:"high"},"pfo-closure":{min:3e5,max:48e4,complexity:"medium"},"right-heart-cath":{min:36e4,max:6e5,complexity:"medium"},"angiogram-pci":{min:48e4,max:9e5,complexity:"high"},"ai-medical-review":{min:18e4,max:24e4,complexity:"medium"}},Cr=({appState:n,isRecording:e=!1,recordingTime:a=0,transcriptionLength:r})=>{const[i,s]=d.useState(0),[o,l]=d.useState(null),[c]=d.useState(()=>Fe.getInstance());d.useEffect(()=>{let u;return(n.processingStatus==="transcribing"||n.processingStatus==="processing")&&(u=window.setInterval(()=>{n.processingStartTime&&s(Date.now()-n.processingStartTime)},100)),()=>{u&&clearInterval(u)}},[n.processingStatus,n.processingStartTime]),d.useEffect(()=>{try{if(n.currentAgent&&typeof r=="number"&&r>0){const u=c.predictProcessingTime(n.currentAgent,r,{includeTranscriptionTime:!0});l(u)}else l(null)}catch(u){console.warn("Failed to predict processing time:",u),l(null)}},[n.currentAgent,r,c]);const m=u=>{if(u===null)return"0s";const f=Math.floor(u/1e3);if(f<60)return`${(u/1e3).toFixed(1)}s`;{const g=Math.floor(f/60),v=f%60;return`${g}m ${v}s`}},p=u=>{if(u===null)return"0s";const f=Math.floor(u/1e3);if(f<60)return`${f}s`;{const g=Math.floor(f/60),v=f%60;return`${g}m ${v.toString().padStart(2,"0")}s`}},h=(u,f)=>{if(o)return u<o.range.min?{icon:"ðŸŸ¢",color:"text-green-600",label:"Fast"}:u<=o.range.max?{icon:"ðŸŸ¡",color:"text-yellow-600",label:"Normal"}:{icon:"ðŸ”´",color:"text-red-600",label:"Slow"};if(!f||!ct[f])return{icon:"ðŸŸ¡",color:"text-yellow-600",label:"Normal"};const g=ct[f];return u<g.min?{icon:"ðŸŸ¢",color:"text-green-600",label:"Fast"}:u<=g.max?{icon:"ðŸŸ¡",color:"text-yellow-600",label:"Normal"}:{icon:"ðŸ”´",color:"text-red-600",label:"Slow"}};if(e&&a>0)return t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Se,{className:"h-4 w-4 text-red-600 animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-red-800",children:"Recording..."}),t.jsxs("span",{className:"text-sm text-red-600 font-mono",children:["(",p(a)," elapsed)"]})]})});if(n.processingStatus==="transcribing")return t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(qt,{className:"h-4 w-4 text-blue-600 animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Transcribing..."}),t.jsxs("span",{className:"text-sm text-blue-600 font-mono",children:["(",p(i)," elapsed)"]})]})});if(n.processingStatus==="processing")return t.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(en,{className:"h-4 w-4 text-purple-600 animate-pulse"}),t.jsxs("span",{className:"text-sm font-medium text-purple-800",children:[n.currentAgentName||"Agent"," Processing..."]}),t.jsxs("span",{className:"text-sm text-purple-600 font-mono",children:["(",p(i)," elapsed)"]})]})});if(n.processingStatus==="complete"&&n.totalProcessingTime){const u=h(n.totalProcessingTime,n.currentAgent),f=n.recordingTime?Math.round(n.recordingTime/n.totalProcessingTime*100):0,g=n.transcriptionTime?Math.round(n.transcriptionTime/n.totalProcessingTime*100):0,v=n.agentProcessingTime?Math.round(n.agentProcessingTime/n.totalProcessingTime*100):0;return t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ye,{className:"h-4 w-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-800",children:"Processing Complete"}),t.jsxs("span",{className:`text-xs ${u.color}`,children:[u.icon," ",u.label]})]}),t.jsx("span",{className:"text-sm font-semibold text-green-800",children:m(n.totalProcessingTime)})]}),t.jsxs("div",{className:"space-y-2",children:[n.recordingTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),t.jsx("span",{className:"text-gray-700",children:"Recording (Voice Input)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-red-400 h-1.5 rounded-full",style:{width:`${f}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:m(n.recordingTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[f,"%"]})]})]}),n.transcriptionTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),t.jsx("span",{className:"text-gray-700",children:"Transcription (MLX Whisper)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-blue-400 h-1.5 rounded-full",style:{width:`${g}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:m(n.transcriptionTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[g,"%"]})]})]}),n.agentProcessingTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),t.jsxs("span",{className:"text-gray-700",children:[n.currentAgentName||"Agent"," (MedGemma-27b MLX)"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-purple-400 h-1.5 rounded-full",style:{width:`${v}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:m(n.agentProcessingTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[v,"%"]})]})]})]}),(()=>{if(o)return t.jsx("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:o.displayText});if(n.currentAgent&&ct[n.currentAgent]){const k=ct[n.currentAgent];return t.jsxs("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:["Expected: ",m(k.min)," - ",m(k.max)," (",k.complexity," complexity)"]})}return null})()]})})}return null};class Te{static instance;STORAGE_KEY="xestro-recording-metrics";MAX_STORED_METRICS=500;constructor(){}static getInstance(){return Te.instance||(Te.instance=new Te),Te.instance}async storeMetric(e){try{const a={...e,sessionId:this.generateSessionId(),timestamp:new Date},r=await this.getAllMetrics(),i=[a,...r].slice(0,this.MAX_STORED_METRICS);await chrome.storage.local.set({[this.STORAGE_KEY]:JSON.stringify(i)}),console.log("ðŸ“Š Metric stored:",{agent:e.agentType,transcription:`${e.transcriptionTime}ms`,processing:`${e.processingTime}ms`,total:`${e.totalDuration}ms`})}catch(a){console.error("Failed to store metric:",a)}}async getAllMetrics(){try{const a=(await chrome.storage.local.get(this.STORAGE_KEY))[this.STORAGE_KEY];return a?JSON.parse(a).map(i=>({...i,timestamp:new Date(i.timestamp)})):[]}catch(e){return console.error("Failed to get metrics:",e),[]}}async getAnalytics(){const a=(await this.getAllMetrics()).filter(u=>u.success);if(a.length===0)return this.getEmptyAnalytics();const r={},i={};a.forEach(u=>{r[u.agentType]||(r[u.agentType]={count:0,totalTranscription:0,totalProcessing:0,totalDuration:0});const f=r[u.agentType];f.count++,f.totalTranscription+=u.transcriptionTime,f.totalProcessing+=u.processingTime,f.totalDuration+=u.totalDuration,i[u.modelUsed]||(i[u.modelUsed]={count:0,totalTime:0}),i[u.modelUsed].count++,i[u.modelUsed].totalTime+=u.processingTime});const s={};Object.entries(r).forEach(([u,f])=>{s[u]={count:f.count,avgTranscription:Math.round(f.totalTranscription/f.count),avgProcessing:Math.round(f.totalProcessing/f.count),avgTotal:Math.round(f.totalDuration/f.count)}});const o={};Object.entries(i).forEach(([u,f])=>{o[u]={count:f.count,avgTime:Math.round(f.totalTime/f.count)}});const l=a.slice(0,10),c=a.slice(0,25),m=l.length>0?Math.round(l.reduce((u,f)=>u+f.totalDuration,0)/l.length):0,p=c.length>0?Math.round(c.reduce((u,f)=>u+f.totalDuration,0)/c.length):0,h=p>0&&m>0?Math.round((p-m)/p*100):0;return{totalRecordings:a.length,averageTranscriptionTime:Math.round(a.reduce((u,f)=>u+f.transcriptionTime,0)/a.length),averageProcessingTime:Math.round(a.reduce((u,f)=>u+f.processingTime,0)/a.length),averageTotalDuration:Math.round(a.reduce((u,f)=>u+f.totalDuration,0)/a.length),agentTypeBreakdown:s,recentTrend:{last10Avg:m,last25Avg:p,improvementPercent:h},modelPerformance:o}}async clearAllMetrics(){try{await chrome.storage.local.remove(this.STORAGE_KEY),console.log("ðŸ“Š All metrics cleared")}catch(e){console.error("Failed to clear metrics:",e)}}async getMetricsByAgent(e){return(await this.getAllMetrics()).filter(r=>r.agentType===e)}async exportMetrics(){const e=await this.getAllMetrics();return JSON.stringify(e,null,2)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getEmptyAnalytics(){return{totalRecordings:0,averageTranscriptionTime:0,averageProcessingTime:0,averageTotalDuration:0,agentTypeBreakdown:{},recentTrend:{last10Avg:0,last25Avg:0,improvementPercent:0},modelPerformance:{}}}}const Zn=d.memo(({results:n,agentType:e,className:a=""})=>{const[r,i]=d.useState(!0),[s,o]=d.useState(!1),l=d.useMemo(()=>{const u=n.split(/\s+/).filter(k=>k.length>0).length,f=Math.ceil(u/200),g=n.length,v=n.split(`
`).length;return{wordCount:u,readingTime:f,charCount:g,lineCount:v}},[n]),c=n.length>1e3,m=d.useMemo(()=>!c||s?n:n.substring(0,500)+"...",[n,c,s]),p=d.useMemo(()=>{const u=[],f=m.split(`
`);let g={title:"",content:""};for(const v of f){const k=v.trim();k.match(/^[A-Z][A-Z\s]+:?$/)||k.match(/^[A-Z][a-z\s]+:$/)?(g.content.trim()&&u.push({...g}),g={title:k.replace(":",""),content:""}):k&&(g.content+=v+`
`)}return g.content.trim()&&u.push(g),u.length===0&&u.push({title:"Medical Report",content:m}),u},[m]),h=u=>u?{tavi:"TAVI Report","angiogram-pci":"Angiogram/PCI Report","quick-letter":"Quick Letter",consultation:"Consultation Report","investigation-summary":"Investigation Summary",background:"Background Summary",medication:"Medication Review",bloods:"Blood Test Order",imaging:"Imaging Order",mteer:"mTEER Report",tteer:"TTEER Report","pfo-closure":"PFO Closure Report","asd-closure":"ASD Closure Report","pvl-plug":"PVL Plug Report","bypass-graft":"Bypass Graft Report","right-heart-cath":"Right Heart Catheterisation","tavi-workup":"TAVI Workup","ai-medical-review":"AI Medical Review","batch-ai-review":"Batch AI Review","patient-education":"Patient Education",enhancement:"Enhanced Report",transcription:"Transcription",generation:"Generated Report"}[u]||u.toUpperCase():"Medical Report";return n?t.jsxs("div",{className:`glass rounded-2xl overflow-hidden ${a}`,children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>i(!r),className:"p-1 hover:bg-gray-100 rounded transition-colors","aria-label":r?"Collapse report":"Expand report",children:r?t.jsx(Fa,{className:"w-5 h-5 text-gray-600"}):t.jsx(at,{className:"w-5 h-5 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-semibold text-sm",children:h(e)}),t.jsxs("div",{className:"text-gray-600 text-xs mt-1",children:[t.jsxs("span",{children:[l.wordCount," words"]}),t.jsx("span",{className:"mx-2",children:"â€¢"}),t.jsxs("span",{children:[l.readingTime," min read"]}),t.jsx("span",{className:"mx-2",children:"â€¢"}),t.jsx("span",{children:new Date().toLocaleTimeString()})]})]})]}),c&&t.jsx("button",{onClick:()=>o(!s),className:"text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:s?"Show Less":"Show More"})]})}),r&&t.jsxs("div",{className:"report-content",children:[p.length>1?t.jsx("div",{className:"space-y-4 p-4",children:p.map((u,f)=>t.jsxs("div",{className:"section",children:[u.title&&t.jsx("h4",{className:"font-semibold text-gray-900 border-b border-gray-200 pb-1 mb-2 text-sm",children:u.title}),t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:u.content})]},f))}):t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap font-mono",children:m})}),c&&!s&&t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("button",{onClick:()=>o(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1 transition-colors",children:[t.jsxs("span",{children:["Show complete report (",l.charCount," characters)"]}),t.jsx(at,{className:"w-4 h-4"})]})})]})]}):null});Zn.displayName="ReportDisplay";const ea=({audioBlob:n,fileName:e="investigation-audio",className:a="",onAnalysisUpdate:r})=>{const[i,s]=d.useState(!1),[o,l]=d.useState(0),[c,m]=d.useState(0),[p,h]=d.useState(1),[u,f]=d.useState(1),[g,v]=d.useState([]),[k,I]=d.useState(""),[T,F]=d.useState(null),[x,y]=d.useState(!1),[j,C]=d.useState(!1),w=d.useRef(null),E=d.useRef(null),A=d.useRef(),P=d.useRef();d.useEffect(()=>{const z=URL.createObjectURL(n);return I(z),()=>{URL.revokeObjectURL(z)}},[n]);const $=d.useCallback(async()=>{if(n)try{const z=await n.arrayBuffer(),B=new AudioContext,Q=await B.decodeAudioData(z),K=Q.getChannelData(0),G=Q.sampleRate,ie=Q.duration;let Ae=0,we=0;const pe=.01;for(let me=0;me<K.length;me++){const ue=Math.abs(K[me]);Ae+=ue,ue<pe&&we++}const fe=Ae/K.length,H=we/G,V=[...K].map(Math.abs).sort((me,ue)=>me-ue),te=V[Math.floor(V.length*.1)],Je=V[Math.floor(V.length*.9)],Ze=Je>0?20*Math.log10(Je/(te+.001)):0;let _="good";fe<.005||H>ie*.8||Ze<10?_="poor":(fe<.02||H>ie*.5||Ze<20)&&(_="fair");const q=200,ae=Math.floor(K.length/q),se=[];for(let me=0;me<q;me++){let ue=0;const De=me*ae,Ue=Math.min(De+ae,K.length);for(let Oe=De;Oe<Ue;Oe++)ue+=Math.abs(K[Oe]);se.push(ue/(Ue-De))}const de={duration:ie,fileSize:n.size,quality:_,avgVolume:fe,silenceDuration:H,estimatedSNR:Ze};v(se),F(de),r?.(de),await B.close()}catch(z){console.error("Audio analysis failed:",z)}},[n,r]);d.useEffect(()=>{k&&$()},[k,$]);const b=d.useCallback(()=>{const z=E.current;if(!z||!g.length||!c)return;const B=z.getContext("2d");if(!B)return;const{width:Q,height:K}=z,G=o/c;B.clearRect(0,0,Q,K);const ie=Q/g.length,Ae=Math.max(...g);g.forEach((pe,fe)=>{const H=Math.max(2,pe/Ae*K*.8),V=fe*ie,te=(K-H)/2;fe/g.length<=G?B.fillStyle=x?"#1d4ed8":"#3b82f6":B.fillStyle="#d1d5db",B.fillRect(V,te,Math.max(1,ie-1),H)});const we=G*Q;B.strokeStyle=x?"#dc2626":"#ef4444",B.lineWidth=x?3:2,B.beginPath(),B.moveTo(we,0),B.lineTo(we,K),B.stroke(),x&&(B.fillStyle="rgba(239, 68, 68, 0.2)",B.fillRect(we-2,0,4,K))},[g,o,c,x]);d.useEffect(()=>{b()},[b]);const N=()=>{w.current&&!x&&!j&&l(w.current.currentTime)},S=()=>{w.current&&m(w.current.duration)},M=()=>{s(!1),L()},D=d.useCallback(()=>{console.log("âœ… Audio seeked event fired"),P.current&&(window.clearTimeout(P.current),P.current=void 0),y(!1),w.current&&l(w.current.currentTime)},[]),O=d.useCallback(()=>{console.error("âŒ Audio seek error occurred"),P.current&&(window.clearTimeout(P.current),P.current=void 0),y(!1),w.current&&l(w.current.currentTime)},[]),R=d.useCallback(()=>{if(!i||!w.current||x||j)return;const z=()=>{w.current&&i&&!x&&!j&&(l(w.current.currentTime),A.current=requestAnimationFrame(z))};A.current=requestAnimationFrame(z)},[i,x,j]),L=d.useCallback(()=>{A.current&&(cancelAnimationFrame(A.current),A.current=void 0)},[]),X=d.useCallback(()=>{!w.current||x||(i?(w.current.pause(),s(!1),L()):w.current.play().then(()=>{s(!0),!j&&!x&&R()}).catch(z=>{console.error("Audio playback failed:",z),s(!1)}))},[i,x,j,R,L]),W=d.useCallback(z=>{if(!w.current||!c)return;if(x){console.log("â­ï¸ Seek already in progress, ignoring new seek request");return}y(!0);const B=Math.max(0,Math.min(c,z/100*c));P.current&&window.clearTimeout(P.current),console.log("ðŸŽ¯ Seeking to:",{percentage:z.toFixed(2),newTime:B.toFixed(2)}),l(B);try{w.current.currentTime=B,P.current=window.setTimeout(()=>{console.log("âš ï¸ Seek timeout fallback triggered - seeked event may not have fired"),y(!1),w.current&&l(w.current.currentTime)},300)}catch(Q){console.error("âŒ Seek failed:",Q),y(!1),P.current&&window.clearTimeout(P.current)}},[c,x]),ee=d.useCallback(z=>{z.preventDefault(),z.stopPropagation();const B=E.current;if(!B||!c){console.log("âŒ Cannot seek: canvas or duration not available",{canvas:!!B,duration:c});return}if(x){console.log("â­ï¸ Seek already in progress, ignoring click");return}const Q=B.getBoundingClientRect(),K=z.clientX-Q.left,G=Math.max(0,Math.min(100,K/Q.width*100));console.log("ðŸŽ¯ Waveform clicked:",{x:K,width:Q.width,percentage:G.toFixed(2)});try{W(G)}catch(ie){console.error("âŒ Waveform seek failed:",ie)}},[c,x,W]),Y=d.useCallback(()=>{L(),s(!1),C(!1),w.current&&w.current.pause(),W(0)},[W,L]),ge=()=>{const z=URL.createObjectURL(n),B=document.createElement("a");B.href=z,B.download=`${e}-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.webm`,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(z)},ce=z=>{const B=Math.floor(z/60),Q=Math.floor(z%60);return`${B}:${Q.toString().padStart(2,"0")}`},Ee=z=>{switch(z){case"good":return"text-green-600";case"fair":return"text-yellow-600";case"poor":return"text-red-600";default:return"text-gray-600"}},Pe=z=>{switch(z){case"good":return"âœ…";case"fair":return"âš ï¸";case"poor":return"âŒ";default:return"â“"}};return d.useEffect(()=>{i||L()},[i,L]),d.useEffect(()=>()=>{P.current&&window.clearTimeout(P.current)},[]),d.useEffect(()=>()=>{L(),P.current&&window.clearTimeout(P.current)},[L]),t.jsxs("div",{className:`space-y-4 p-4 bg-gray-50 rounded-lg border ${a}`,children:[t.jsx("audio",{ref:w,src:k,onTimeUpdate:N,onLoadedMetadata:S,onEnded:M,onSeeked:D,onError:O,onRateChange:()=>h(w.current?.playbackRate||1),preload:"metadata"}),T&&t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Quality:"}),t.jsxs("span",{className:`font-medium ${Ee(T.quality)}`,children:[Pe(T.quality)," ",T.quality.toUpperCase()]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Duration:"}),t.jsx("span",{className:"text-gray-900",children:ce(T.duration)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"File Size:"}),t.jsxs("span",{className:"text-gray-900",children:[(T.fileSize/1024).toFixed(1),"KB"]})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Avg Volume:"}),t.jsxs("span",{className:"text-gray-900",children:[(T.avgVolume*100).toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Silence:"}),t.jsx("span",{className:"text-gray-900",children:ce(T.silenceDuration)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Est. SNR:"}),t.jsxs("span",{className:"text-gray-900",children:[T.estimatedSNR.toFixed(1),"dB"]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("canvas",{ref:E,width:400,height:80,className:`w-full h-20 bg-white rounded border transition-all duration-200 ${x?"cursor-grabbing border-blue-400 shadow-md":"cursor-pointer hover:bg-gray-50 hover:border-gray-300"}`,onClick:ee,onMouseMove:z=>{const B=E.current;if(B&&c&&!x){const Q=B.getBoundingClientRect(),G=(z.clientX-Q.left)/Q.width*100;B.title=`Click to seek to ${ce(G/100*c)}`}else B&&x&&(B.title="Seeking...")},style:{touchAction:"none"}}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[t.jsx("span",{children:ce(o)}),t.jsx("span",{className:x?"text-blue-600 font-medium":"",children:x?"Seeking...":"Click waveform to seek"}),t.jsx("span",{children:ce(c)})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("input",{type:"range",min:"0",max:"100",step:"0.1",value:c?o/c*100:0,onMouseDown:()=>{C(!0),L()},onMouseUp:()=>{C(!1),i&&!x&&R()},onTouchStart:()=>{C(!0),L()},onTouchEnd:()=>{C(!1),i&&!x&&R()},onInput:z=>{if(j){const B=parseFloat(z.target.value);W(B)}},onChange:()=>{},className:"w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",disabled:!c}),t.jsx("div",{className:"text-xs text-gray-400 text-center",children:"Alternative: Use slider above to seek"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:X,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition-colors",disabled:!k,children:i?t.jsx(La,{className:"w-5 h-5"}):t.jsx(Ln,{className:"w-5 h-5 ml-1"})}),t.jsx("button",{onClick:Y,className:"flex items-center justify-center w-8 h-8 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-full transition-colors",disabled:!k,children:t.jsx(za,{className:"w-4 h-4"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ba,{className:"w-4 h-4 text-gray-600"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:u,onChange:z=>{const B=parseFloat(z.target.value);f(B),w.current&&(w.current.volume=B)},className:"w-20 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("select",{value:p,onChange:z=>{const B=parseFloat(z.target.value);h(B),w.current&&(w.current.playbackRate=B)},className:"text-xs bg-white border border-gray-300 rounded px-2 py-1",children:[t.jsx("option",{value:.5,children:"0.5x"}),t.jsx("option",{value:.75,children:"0.75x"}),t.jsx("option",{value:1,children:"1.0x"}),t.jsx("option",{value:1.25,children:"1.25x"}),t.jsx("option",{value:1.5,children:"1.5x"}),t.jsx("option",{value:2,children:"2.0x"})]}),t.jsx("button",{onClick:ge,className:"flex items-center justify-center w-8 h-8 bg-green-600 hover:bg-green-700 text-white rounded transition-colors",title:"Download audio file",children:t.jsx(rt,{className:"w-4 h-4"})})]})]}),T&&T.quality!=="good"&&t.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3",children:t.jsx("div",{className:"flex items-start",children:t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Audio Quality Issues Detected"}),t.jsxs("div",{className:"mt-1 text-xs text-yellow-600 space-y-1",children:[T.avgVolume<.005&&t.jsx("p",{children:"â€¢ Recording is very quiet - check microphone levels"}),T.silenceDuration>T.duration*.5&&t.jsx("p",{children:"â€¢ Recording contains significant silence"}),T.estimatedSNR<15&&t.jsx("p",{children:"â€¢ High background noise detected"}),T.duration<2&&t.jsx("p",{children:"â€¢ Recording is very short - may affect transcription accuracy"})]})]})})})]})},ta=d.memo(({originalTranscription:n,onTranscriptionCopy:e,onTranscriptionInsert:a,onAgentReprocess:r,currentAgent:i,isProcessing:s=!1,className:o="",audioBlob:l,defaultExpanded:c=!1,collapseWhen:m})=>{const[p,h]=d.useState(!!c),[u,f]=d.useState(!1),[g,v]=d.useState(!1);Z.useEffect(()=>{m&&p&&h(!1)},[m]);const k=[{id:"tavi",label:"TAVI",icon:"ðŸ«€"},{id:"angiogram-pci",label:"Angiogram/PCI",icon:"ðŸ©º"},{id:"quick-letter",label:"Quick Letter",icon:"ðŸ“"},{id:"consultation",label:"Consultation",icon:"ðŸ‘¨â€âš•ï¸"},{id:"investigation-summary",label:"Investigation",icon:"ðŸ”¬"}],I=async()=>{if(e)try{await e(n),f(!0),setTimeout(()=>f(!1),2e3)}catch(x){console.error("Failed to copy transcription:",x)}},T=async()=>{if(a)try{await a(n),v(!0),setTimeout(()=>v(!1),2e3)}catch(x){console.error("Failed to insert transcription:",x)}},F=x=>{r&&!s&&r(x)};return t.jsxs("div",{className:`border-b border-gray-200/50 ${o} ${s?"bg-blue-50/30 border-b-blue-200/50":""}`,children:[t.jsxs("button",{onClick:()=>h(!p),className:`w-full p-4 text-left transition-colors flex items-center justify-between ${s?"hover:bg-blue-50/60":"hover:bg-gray-50/50"}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Pt,{className:`w-4 h-4 ${s?"text-blue-600":"text-gray-600"}`}),t.jsx("span",{className:`font-medium text-sm ${s?"text-blue-900":"text-gray-900"}`,children:"Original Transcription"}),s&&t.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-medium",children:"Processing..."}),t.jsxs("span",{className:"text-xs text-gray-500",children:[n.split(" ").length," words"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[e&&t.jsxs("button",{onClick:x=>{x.stopPropagation(),I()},className:`px-2 py-1.5 rounded transition-all duration-200 flex items-center space-x-1 ${s?"bg-blue-50 border border-blue-200 hover:bg-blue-100 shadow-sm":"p-1.5 hover:bg-gray-100"}`,title:s?"Copy raw transcription":"Copy transcription",children:[u?t.jsx(ve,{className:"w-3.5 h-3.5 text-green-600"}):t.jsx(nt,{className:"w-3.5 h-3.5 text-blue-600",title:"Copy transcription"}),s&&t.jsx("span",{className:"text-xs text-blue-700 font-medium",children:"Copy Raw"})]}),a&&t.jsx("button",{onClick:x=>{x.stopPropagation(),T()},className:"p-1.5 rounded hover:bg-gray-100 transition-colors",title:"Insert transcription to EMR",children:g?t.jsx(ve,{className:"w-3.5 h-3.5 text-green-600"}):t.jsx(Ie,{className:"w-3.5 h-3.5 text-blue-500"})}),r&&t.jsx("div",{className:"p-1.5",children:t.jsx(Ct,{className:`w-3.5 h-3.5 text-purple-500 ${s?"animate-spin":""}`})}),p?t.jsx(Jn,{className:"w-4 h-4 text-gray-400"}):t.jsx(Yn,{className:"w-4 h-4 text-gray-400"})]})]}),p&&t.jsxs("div",{className:"px-4 pb-4",children:[t.jsx("div",{className:"bg-gray-50/80 rounded-lg p-3 border border-gray-200/50",children:t.jsx("p",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:n})}),l&&t.jsx("div",{className:"mt-3",children:t.jsx(ea,{audioBlob:l,fileName:`transcription-${i||"recording"}`,className:"bg-white border-gray-200"})}),r&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Reprocess with different agent:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(x=>t.jsxs("button",{onClick:()=>F(x.id),disabled:s,className:`px-2 py-1 text-xs rounded-md border transition-colors flex items-center space-x-1 ${i===x.id?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"} ${s?"opacity-50 cursor-not-allowed":""}`,children:[t.jsx("span",{children:x.icon}),t.jsx("span",{children:x.label}),i===x.id&&t.jsx("span",{className:"text-xs text-blue-500",children:"â€¢"})]},x.id))})]})]})]})});ta.displayName="TranscriptionSection";const na=d.memo(({reviewData:n,className:e=""})=>{const[a,r]=d.useState(new Set),[i,s]=d.useState(!1),[o,l]=d.useState(new Set);console.log("ðŸŽ´ AI REVIEW CARDS: Component render with data:",{hasReviewData:!!n,reviewDataType:typeof n,reviewDataKeys:n?Object.keys(n):null,findingsArray:n?.findings,findingsType:typeof n?.findings,findingsCount:n?.findings?.length||0,isBatchReview:n?.isBatchReview,timestamp:n?.timestamp,findingsPreview:Array.isArray(n?.findings)?n.findings.slice(0,2):"Not an array"});const c=Array.isArray(n?.findings)?n.findings:[];d.useEffect(()=>{c.length>0&&(r(new Set),l(new Set),s(!0),console.log("ðŸ”„ Reset AI Review acknowledged findings for new review data"),c.forEach((h,u)=>{setTimeout(()=>{l(f=>new Set([...f,u]))},u*200+300)}),setTimeout(()=>{s(!1)},c.length*200+800))},[c.length,n?.timestamp]);const m=h=>{switch(h){case"Immediate":return"red";case"Soon":return"amber";default:return"blue"}},p=h=>{const u=new Set(a);a.has(h)?u.delete(h):u.add(h),r(u)};return t.jsxs("div",{className:`space-y-3 ${e}`,children:[t.jsxs("div",{className:`flex items-center justify-between mb-4 transition-all duration-500 ${o.size>0||c.length===0?"opacity-100 translate-y-0":"opacity-0 translate-y-2"}`,children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Clinical Advisory Cards"}),t.jsx("div",{className:"text-xs text-gray-500",children:c.length>0?`${a.size} of ${c.length} reviewed`:"No findings"})]}),c.length===0?t.jsxs("div",{className:"text-center py-8 bg-green-50 border border-green-200 rounded-lg",children:[t.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),t.jsx("h4",{className:"text-green-800 font-medium mb-2",children:"No Clinical Oversights Identified"}),t.jsx("p",{className:"text-green-700 text-sm",children:n?.noFindingsReason||"The AI review found no major clinical oversights based on Australian guidelines."})]}):c.map((h,u)=>{const f=a.has(u),g=m(h.urgency),v=o.has(u);return t.jsx("div",{className:`border rounded-lg motion-safe:transition-all motion-safe:duration-500 motion-safe:transform motion-reduce:transition-none ${v?"opacity-100 translate-y-0 scale-100":"opacity-0 translate-y-4 scale-95"} ${f?"opacity-60 border-gray-200 bg-gray-50":`border-${g}-200 bg-white`}`,style:{transitionDelay:v?"0ms":`${u*100}ms`},role:"article","aria-labelledby":`finding-${u}-title`,"aria-describedby":`finding-${u}-description`,children:t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("button",{onClick:()=>p(u),className:`flex-shrink-0 w-5 h-5 rounded border-2 motion-safe:transition-colors motion-reduce:transition-none flex items-center justify-center ${f?"bg-green-500 border-green-500":`border-${g}-300 hover:border-${g}-400`}`,"aria-label":f?"Mark as unreviewed":"Mark as reviewed","aria-pressed":f,children:f&&t.jsx(ve,{className:"w-3 h-3 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("h4",{id:`finding-${u}-title`,className:`font-medium text-sm ${f?"text-gray-500":"text-gray-900"}`,children:h.finding}),t.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${g==="red"?"bg-red-100 text-red-800":g==="amber"?"bg-amber-100 text-amber-800":"bg-blue-100 text-blue-800"}`,children:h.urgency}),h.patientName&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:h.patientName})]}),h.patientFileNumber&&t.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["File: ",h.patientFileNumber]}),!f&&t.jsxs("div",{id:`finding-${u}-description`,className:"space-y-2",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-medium",children:"Guideline:"})," ",h.australianGuideline]}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-medium",children:"Reasoning:"})," ",h.clinicalReasoning]}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-medium",children:"Recommendation:"})," ",h.recommendedAction]}),h.heartFoundationLink&&t.jsx("div",{className:"text-sm",children:t.jsx("a",{href:h.heartFoundationLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 underline",children:"Heart Foundation Resource â†’"})})]})]})]})})},u)})]})});na.displayName="AIReviewCards";const aa=d.memo(({results:n,agentType:e,onCopy:a,onInsertToEMR:r,className:i=""})=>{const[s,o]=d.useState(!1),[l,c]=d.useState(!1),m=async()=>{try{await a(n),o(!0),setTimeout(()=>o(!1),2e3)}catch(u){console.error("Failed to copy:",u)}},p=async()=>{try{await r(n),c(!0),setTimeout(()=>c(!1),2e3)}catch(u){console.error("Failed to insert to EMR:",u)}},h=()=>{const u=new Blob([n],{type:"text/plain"}),f=URL.createObjectURL(u),g=document.createElement("a");g.href=f,g.download=`medical-report-${e||"report"}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(f)};return t.jsxs("div",{className:`p-4 border-t border-emerald-200/50 ${i}`,children:[t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:m,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${s?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,children:[s?t.jsx(ve,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(nt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${s?"text-emerald-700":"text-gray-700"}`,children:s?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:p,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${l?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,children:[l?t.jsx(ve,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Ie,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${l?"text-emerald-700":"text-gray-700"}`,children:l?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:h,className:"bg-white/60 border border-emerald-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-emerald-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(rt,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]}),t.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(it,{className:"w-4 h-4 text-green-400"}),t.jsx("span",{className:"text-green-400 text-xs",children:"Report generated successfully"})]}),t.jsx("div",{className:"text-gray-500 text-xs",children:"Confidence: 95%"})]}),t.jsx("div",{className:"mt-3 p-2 bg-emerald-50/50 rounded-lg border border-emerald-100",children:t.jsxs("p",{className:"text-emerald-700 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Full Letter:"})," Complete medical correspondence ready for EMR insertion or sharing."]})})]})});aa.displayName="ActionButtons";const ra=d.memo(({warnings:n=[],onDismissWarnings:e,className:a=""})=>{const[r,i]=d.useState(!1);return!n||n.length===0?null:t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>i(!r),className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 hover:bg-orange-200 transition-colors",title:`${n.length} warning${n.length!==1?"s":""} - click to ${r?"hide":"view"}`,children:[t.jsx(it,{className:"w-3 h-3"}),t.jsx("span",{children:n.length})]}),r&&t.jsx("div",{className:`p-4 border-b border-orange-200/50 bg-orange-50/30 ${a}`,children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(it,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-orange-800 font-medium text-sm mb-2",children:"Content Warnings"}),t.jsx("ul",{className:"space-y-1",children:n.map((s,o)=>t.jsxs("li",{className:"text-orange-700 text-sm leading-relaxed",children:["â€¢ ",s]},o))}),e&&t.jsx("button",{onClick:()=>{e(),i(!1)},className:"mt-3 text-orange-600 hover:text-orange-700 text-xs font-medium transition-colors",children:"Dismiss warnings"})]})]})})]})});ra.displayName="WarningsPanel";const ia=d.memo(({failedAudioRecordings:n,errors:e,onClearFailedRecordings:a,className:r=""})=>{const[i,s]=d.useState(!1),[o,l]=d.useState(null);return n.length>0&&e.length>0&&e.some(m=>m.includes("could not be parsed coherently")||m.includes("Investigation dictation could not be parsed"))?t.jsxs("div",{className:`border-t border-red-200/50 bg-red-50/30 ${r}`,children:[t.jsxs("button",{onClick:()=>s(!i),className:"w-full p-4 text-left hover:bg-red-50/50 transition-colors flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(wr,{className:"w-4 h-4 text-red-600"}),t.jsx("span",{className:"text-red-900 font-medium text-sm",children:"ðŸ”Š Troubleshoot Audio Recording"}),t.jsxs("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-0.5 rounded-full",children:[n.length," recording",n.length!==1?"s":""]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[a&&t.jsx("button",{onClick:m=>{m.stopPropagation(),a()},className:"p-1.5 rounded hover:bg-red-100 transition-colors",title:"Clear all failed recordings",children:t.jsx(Tt,{className:"w-3.5 h-3.5 text-red-500"})}),i?t.jsx(Jn,{className:"w-4 h-4 text-red-400"}):t.jsx(Yn,{className:"w-4 h-4 text-red-400"})]})]}),i&&t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-sm text-red-700 bg-red-100/50 p-3 rounded-lg border border-red-200",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(it,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Investigation parsing failed"}),t.jsx("p",{className:"text-red-600 mt-1 text-xs",children:"The recording could not be processed into a structured investigation summary. Use the audio playback below to identify potential issues:"}),t.jsxs("ul",{className:"mt-2 text-xs text-red-600 space-y-1",children:[t.jsx("li",{children:"â€¢ Check if audio is too quiet or contains too much silence"}),t.jsx("li",{children:"â€¢ Verify medical terminology is clearly spoken"}),t.jsx("li",{children:"â€¢ Ensure recording duration is adequate (â‰¥2 seconds)"}),t.jsx("li",{children:"â€¢ Look for background noise or audio quality issues"})]})]})]})}),n.length>1&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-red-700 mb-2",children:"Select recording to troubleshoot:"}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:n.map((m,p)=>t.jsx("button",{onClick:()=>l(m),className:`p-3 rounded-lg border text-left transition-colors ${o?.id===m.id?"bg-red-100 border-red-300 text-red-800":"bg-white border-red-200 hover:bg-red-50 text-red-700"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-sm",children:["Recording #",n.length-p]}),t.jsxs("div",{className:"text-xs opacity-75 mt-1",children:[new Date(m.timestamp).toLocaleString()," â€¢",m.metadata.recordingTime,"s â€¢",(m.metadata.fileSize/1024).toFixed(1),"KB"]})]}),o?.id===m.id&&t.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})]})},m.id))})]}),(o||n.length===1)&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-red-700 mb-1",children:"Audio Playback & Analysis"}),t.jsx("p",{className:"text-xs text-red-600",children:"Listen to the recording and check the audio quality metrics below:"})]}),t.jsx(ea,{audioBlob:(o||n[0]).audioBlob,fileName:`investigation-failed-${(o||n[0]).agentType}`,className:"border-red-200"}),(o||n[0]).transcriptionAttempt&&t.jsxs("div",{className:"mt-3",children:[t.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Transcription Result:"}),t.jsx("div",{className:"bg-white p-3 rounded-lg border border-red-200 text-sm text-gray-800",children:t.jsx("p",{className:"whitespace-pre-wrap",children:(o||n[0]).transcriptionAttempt})}),t.jsx("p",{className:"text-xs text-red-600 mt-2",children:"The transcription above was successful, but could not be parsed into a structured investigation summary."})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Error Details:"}),t.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:t.jsx("p",{className:"text-sm text-red-800 font-mono",children:(o||n[0]).errorMessage})})]})]})]})})]}):null});ia.displayName="TroubleshootingSection";const Tr=({missingInfo:n,onSubmit:e,onDismiss:a})=>{const r=d.useMemo(()=>{const c=[];return Array.isArray(n?.missing_diagnostic)&&c.push(...n.missing_diagnostic),Array.isArray(n?.missing_intervention)&&c.push(...n.missing_intervention),Array.isArray(n?.missing_purpose)&&c.push(...n.missing_purpose),Array.isArray(n?.missing_clinical)&&c.push(...n.missing_clinical),Array.isArray(n?.missing_recommendations)&&c.push(...n.missing_recommendations),c},[n]),[i,s]=d.useState({}),o=(c,m)=>{s(p=>({...p,[c]:m}))},l=n?.completeness_score||"";return r.length===0?null:t.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50",children:[t.jsxs("div",{className:"p-3 border-b border-amber-200 bg-amber-100 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-amber-900 font-semibold text-sm",children:"Missing Information"}),l&&t.jsxs("p",{className:"text-amber-700 text-xs",children:["Completeness: ",l]})]}),a&&t.jsx("button",{className:"text-amber-700 text-xs underline",onClick:a,children:"Dismiss"})]}),t.jsx("div",{className:"p-3 space-y-3",children:r.map(c=>t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-medium text-amber-900 block",children:c}),t.jsx("input",{type:"text",className:"w-full text-sm p-2 border border-amber-200 rounded focus:outline-none focus:ring-2 focus:ring-amber-300 bg-white",placeholder:"Add detail...",value:i[c]||"",onChange:m=>o(c,m.target.value)})]},c))}),t.jsxs("div",{className:"p-3 border-t border-amber-200 bg-amber-50 flex items-center justify-end space-x-2",children:[a&&t.jsx("button",{className:"px-3 py-2 text-xs rounded border border-amber-200 bg-white hover:bg-amber-50",onClick:a,children:"Skip for now"}),t.jsx("button",{className:"px-3 py-2 text-xs rounded bg-amber-600 text-white hover:bg-amber-700",onClick:()=>e(i),children:"Reprocess with answers"})]})]})},sa=d.memo(({results:n,resultsSummary:e="",agentType:a,onCopy:r,onInsertToEMR:i,warnings:s=[],onDismissWarnings:o,selectedSessionId:l=null,selectedPatientName:c="",originalTranscription:m,onTranscriptionCopy:p,onTranscriptionInsert:h,onTranscriptionEdit:u,currentAgent:f,onAgentReprocess:g,missingInfo:v,onReprocessWithAnswers:k,onDismissMissingInfo:I,isProcessing:T=!1,failedAudioRecordings:F=[],onClearFailedRecordings:x,errors:y=[],reviewData:j,audioBlob:C,transcriptionTime:w=null,agentProcessingTime:E=null,totalProcessingTime:A=null,processingStatus:P="idle",currentAgentName:$=null,patientVersion:b=null,isGeneratingPatientVersion:N=!1,onGeneratePatientVersion:S})=>{const[M,D]=d.useState(!0);d.useEffect(()=>{(async()=>{P==="complete"&&A&&w&&E&&a&&await Te.getInstance().storeMetric({agentType:a,transcriptionTime:w,processingTime:E,totalDuration:A,modelUsed:$||"Unknown",success:!0})})().catch(V=>{console.error("Failed to store metrics:",V)})},[P,A,w,E,a,$]);const O=d.useMemo(()=>{const H=n.split(/\s+/).filter(te=>te.length>0).length,V=Math.ceil(H/200);return{wordCount:H,readingTime:V}},[n]),[R,L]=d.useState({copied:!1,inserted:!1}),[X,W]=d.useState({copied:!1,inserted:!1}),[ee,Y]=d.useState({copied:!1,inserted:!1}),ge=d.useCallback(async()=>{await r(e||"No summary available"),L(V=>({...V,copied:!0})),setTimeout(()=>L(V=>({...V,copied:!1})),2e3)},[r,e]),ce=d.useCallback(async()=>{await i(e||"No summary available"),L(V=>({...V,inserted:!0})),setTimeout(()=>L(V=>({...V,inserted:!1})),2e3)},[i,e]),Ee=d.useCallback(async()=>{await r(n),W(H=>({...H,copied:!0})),setTimeout(()=>W(H=>({...H,copied:!1})),2e3)},[r,n]),Pe=d.useCallback(async()=>{await i(n),W(H=>({...H,inserted:!0})),setTimeout(()=>W(H=>({...H,inserted:!1})),2e3)},[i,n]),z=d.useCallback(()=>{const H=new Blob([e],{type:"text/plain"}),V=URL.createObjectURL(H),te=document.createElement("a");te.href=V,te.download=`medical-summary-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(V)},[e]);d.useCallback(()=>{const H=new Blob([n],{type:"text/plain"}),V=URL.createObjectURL(H),te=document.createElement("a");te.href=V,te.download=`medical-letter-${a||"report"}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(V)},[n,a]);const B=d.useCallback(async()=>{b&&(await r(b),Y(H=>({...H,copied:!0})),setTimeout(()=>Y(H=>({...H,copied:!1})),2e3))},[r,b]),Q=d.useCallback(async()=>{b&&(await i(b),Y(H=>({...H,inserted:!0})),setTimeout(()=>Y(H=>({...H,inserted:!1})),2e3))},[i,b]),K=d.useCallback(()=>{if(b){const H=new Blob([b],{type:"text/plain"}),V=URL.createObjectURL(H),te=document.createElement("a");te.href=V,te.download=`patient-version-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(V)}},[b]),G=a==="ai-medical-review"&&j;console.log("ðŸ” RESULTS PANEL: AI Review detection:",{agentType:a,isAIReview:G,hasReviewData:!!j,reviewDataType:typeof j,reviewDataKeys:j?Object.keys(j):null,findingsArray:j?.findings,findingsLength:j?.findings?.length||0});const ie=a==="quick-letter"&&n;console.log("ðŸ–¼ï¸ DISPLAY LOGIC: OptimizedResultsPanel display decision",{agentType:a,isQuickLetterDualCards:ie,hasResultsSummary:!!e,resultsSummaryLength:e?.length||0,resultsSummaryPreview:e?.substring(0,100)+"...",resultsLength:n?.length||0,resultsPreview:n?.substring(0,100)+"...",willUseDualCards:ie});const pe=a==="quick-letter"&&!!n&&!!e||a!=="quick-letter"&&!!n,fe=()=>t.jsxs("div",{className:"p-4 border-b border-emerald-200/50",children:[l&&c&&t.jsx("div",{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(on,{className:"w-3 h-3 text-blue-600"}),t.jsxs("span",{className:"text-blue-800 text-xs font-medium",children:["Viewing session for: ",c]})]})}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center space-x-2",children:G?t.jsxs(t.Fragment,{children:[t.jsx(it,{className:"w-4 h-4 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:j.isBatchReview?"Batch AI Medical Review":"AI Medical Review"}),t.jsx("p",{className:"text-blue-700 text-xs",children:j.isBatchReview?"Multi-patient clinical oversight recommendations":"Australian clinical oversight recommendations"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx(Pt,{className:"w-4 h-4 text-emerald-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Final Proof"}),t.jsx("p",{className:"text-emerald-700 text-xs",children:l?"Viewing previous session":"Processed output ready for review"})]})]})}),t.jsx("button",{onClick:()=>D(!M),className:"bg-white/60 border border-emerald-200 p-2 rounded-lg hover:bg-emerald-50/60 transition-colors",title:M?"Collapse":"Expand",children:M?t.jsx(Ua,{className:"w-4 h-4 text-emerald-600"}):t.jsx(on,{className:"w-4 h-4 text-emerald-600"})})]}),t.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs",children:[G?t.jsxs("div",{className:"text-blue-600 flex items-center space-x-2",children:[t.jsxs("span",{children:[j.findings.length," clinical findings"]}),t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:[j.findings.filter(H=>H.urgency==="Immediate").length," immediate"]}),j.isBatchReview&&j.batchSummary&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:[j.batchSummary.totalPatients," patients"]})]}),t.jsx("span",{children:"â€¢"}),t.jsx("span",{children:new Date().toLocaleTimeString()}),s.length>0&&t.jsx("span",{children:"â€¢"})]}):t.jsxs("div",{className:"text-emerald-600 flex items-center space-x-2",children:[t.jsxs("span",{children:[O.wordCount," words"]}),t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:[O.readingTime," min read"]}),t.jsx("span",{children:"â€¢"}),t.jsx("span",{children:new Date().toLocaleTimeString()}),s.length>0&&t.jsx("span",{children:"â€¢"})]}),s.length>0&&t.jsx(ra,{warnings:s,onDismissWarnings:o})]})]});return t.jsxs("div",{className:"letter-card rounded-2xl overflow-hidden shadow-lg border",children:[fe(),m&&t.jsx(ta,{originalTranscription:m,onTranscriptionCopy:p,onTranscriptionInsert:h,onAgentReprocess:g,currentAgent:f,isProcessing:T,audioBlob:C,defaultExpanded:!pe,collapseWhen:pe}),M&&t.jsxs("div",{className:"p-4",children:[v&&(v.missing_diagnostic?.length>0||v.missing_intervention?.length>0||v.missing_purpose?.length>0||v.missing_clinical?.length>0||v.missing_recommendations?.length>0)&&t.jsx("div",{className:"mb-4",children:t.jsx(Tr,{missingInfo:v,onSubmit:H=>k&&k(H),onDismiss:I})}),G?t.jsxs(t.Fragment,{children:[console.log("ðŸ–¼ï¸ RESULTS PANEL: Rendering AIReviewCards with data:",j),t.jsx(na,{reviewData:j})]}):a==="quick-letter"&&n?(console.log("âœ… DISPLAY: Using QuickLetter dual-card display"),null,t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"letter-card rounded-lg border border-emerald-200 bg-emerald-50",children:[t.jsx("div",{className:"p-3 border-b border-emerald-200 bg-emerald-100",children:t.jsx("h4",{className:"text-emerald-800 font-semibold text-sm",children:"Summary"})}),t.jsx("div",{className:"p-3 max-h-48 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:e||t.jsx("div",{className:"text-gray-500 italic",children:"Summary not available - displaying full letter content below"})})}),t.jsx("div",{className:"p-3 border-t border-emerald-200 bg-emerald-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:ge,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${R.copied?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[R.copied?t.jsx(ve,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(nt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${R.copied?"text-emerald-700":"text-gray-700"}`,children:R.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:ce,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${R.inserted?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[R.inserted?t.jsx(ve,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Ie,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${R.inserted?"text-emerald-700":"text-gray-700"}`,children:R.inserted?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:z,className:"bg-white/60 border border-emerald-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-emerald-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(rt,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]}),t.jsxs("div",{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",children:[t.jsx("div",{className:"p-3 border-b border-blue-200 bg-blue-100",children:t.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Letter"})}),t.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:n})}),t.jsx("div",{className:"p-3 border-t border-blue-200 bg-blue-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:Ee,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${X.copied?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[X.copied?t.jsx(ve,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(nt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${X.copied?"text-blue-700":"text-gray-700"}`,children:X.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:Pe,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${X.inserted?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[X.inserted?t.jsx(ve,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(Ie,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${X.inserted?"text-blue-700":"text-gray-700"}`,children:X.inserted?"Inserted!":"Insert"})]}),t.jsx("button",{onClick:S,disabled:N,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${N?"bg-blue-100/60 border-blue-300 text-blue-500 cursor-not-allowed":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:N?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-300 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-xs text-blue-500",children:"Generating"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Le,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Patient Version"})]})})]})})]}),b&&t.jsxs("div",{className:"letter-card rounded-lg border border-purple-200 bg-purple-50",children:[t.jsx("div",{className:"p-3 border-b border-purple-200 bg-purple-100",children:t.jsx("h4",{className:"text-purple-800 font-semibold text-sm",children:"Patient-Friendly Version"})}),t.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:b})}),t.jsx("div",{className:"p-3 border-t border-purple-200 bg-purple-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:B,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${ee.copied?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[ee.copied?t.jsx(ve,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):t.jsx(nt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${ee.copied?"text-purple-700":"text-gray-700"}`,children:ee.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:Q,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${ee.inserted?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[ee.inserted?t.jsx(ve,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):t.jsx(Ie,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${ee.inserted?"text-purple-700":"text-gray-700"}`,children:ee.inserted?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:K,className:"bg-white/60 border border-purple-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-purple-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(rt,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]})]})):(console.log("âš ï¸ DISPLAY: Falling back to ReportDisplay component",{reason:a==="quick-letter"?"QuickLetter missing summary":"Not QuickLetter agent",agentType:a,hasResultsSummary:!!e,resultsSummaryLength:e?.length||0}),null,t.jsx(Zn,{results:n,agentType:a}))]}),!G&&!ie&&t.jsx(aa,{results:n,agentType:a,onCopy:r,onInsertToEMR:i}),(A||P!=="idle")&&t.jsx("div",{className:"px-4 pb-4",children:t.jsx(Cr,{appState:{processingStatus:P,totalProcessingTime:A,transcriptionTime:w,agentProcessingTime:E,currentAgent:a,currentAgentName:$,processingStartTime:null},isRecording:!1,recordingTime:0,transcriptionLength:m?m.length:0})}),t.jsx(ia,{failedAudioRecordings:F,errors:y,onClearFailedRecordings:x})]})});sa.displayName="OptimizedResultsPanel";function le(n,e){e===void 0&&(e={});var a=e.insertAt;if(n&&typeof document<"u"){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",a==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}le(`.react-loading-indicator-normalize,
[class$=rli-bounding-box] {
  font-size: 1rem;
  display: inline-block;
  box-sizing: border-box;
  text-align: unset;
  isolation: isolate;
}

.rli-d-i-b {
  display: inline-block;
}

.rli-text-format {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 600;
  width: 90%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.7em;
  letter-spacing: 0.5px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Avenir Next", "Avenir", "Segoe UI", "Lucida Grande", "Helvetica Neue", "Helvetica", "Fira Sans", "Roboto", "Noto", "Droid Sans", "Cantarell", "Oxygen", "Ubuntu", "Franklin Gothic Medium", "Century Gothic", "Liberation Sans", sans-serif;
}`);var Ne=function(){return Ne=Object.assign||function(n){for(var e,a=1,r=arguments.length;a<r;a++)for(var i in e=arguments[a])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},Ne.apply(this,arguments)};function wt(n){return wt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(n)}var Er=/^\s+/,Pr=/\s+$/;function U(n,e){if(e=e||{},(n=n||"")instanceof U)return n;if(!(this instanceof U))return new U(n,e);var a=function(r){var i={r:0,g:0,b:0},s=1,o=null,l=null,c=null,m=!1,p=!1;typeof r=="string"&&(r=function(g){g=g.replace(Er,"").replace(Pr,"").toLowerCase();var v,k=!1;if(Xt[g])g=Xt[g],k=!0;else if(g=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(v=be.rgb.exec(g))?{r:v[1],g:v[2],b:v[3]}:(v=be.rgba.exec(g))?{r:v[1],g:v[2],b:v[3],a:v[4]}:(v=be.hsl.exec(g))?{h:v[1],s:v[2],l:v[3]}:(v=be.hsla.exec(g))?{h:v[1],s:v[2],l:v[3],a:v[4]}:(v=be.hsv.exec(g))?{h:v[1],s:v[2],v:v[3]}:(v=be.hsva.exec(g))?{h:v[1],s:v[2],v:v[3],a:v[4]}:(v=be.hex8.exec(g))?{r:he(v[1]),g:he(v[2]),b:he(v[3]),a:vn(v[4]),format:k?"name":"hex8"}:(v=be.hex6.exec(g))?{r:he(v[1]),g:he(v[2]),b:he(v[3]),format:k?"name":"hex"}:(v=be.hex4.exec(g))?{r:he(v[1]+""+v[1]),g:he(v[2]+""+v[2]),b:he(v[3]+""+v[3]),a:vn(v[4]+""+v[4]),format:k?"name":"hex8"}:(v=be.hex3.exec(g))?{r:he(v[1]+""+v[1]),g:he(v[2]+""+v[2]),b:he(v[3]+""+v[3]),format:k?"name":"hex"}:!1}(r)),wt(r)=="object"&&(Ce(r.r)&&Ce(r.g)&&Ce(r.b)?(h=r.r,u=r.g,f=r.b,i={r:255*ne(h,255),g:255*ne(u,255),b:255*ne(f,255)},m=!0,p=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Ce(r.h)&&Ce(r.s)&&Ce(r.v)?(o=et(r.s),l=et(r.v),i=function(g,v,k){g=6*ne(g,360),v=ne(v,100),k=ne(k,100);var I=Math.floor(g),T=g-I,F=k*(1-v),x=k*(1-T*v),y=k*(1-(1-T)*v),j=I%6,C=[k,x,F,F,y,k][j],w=[y,k,k,x,F,F][j],E=[F,F,y,k,k,x][j];return{r:255*C,g:255*w,b:255*E}}(r.h,o,l),m=!0,p="hsv"):Ce(r.h)&&Ce(r.s)&&Ce(r.l)&&(o=et(r.s),c=et(r.l),i=function(g,v,k){var I,T,F;function x(C,w,E){return E<0&&(E+=1),E>1&&(E-=1),E<1/6?C+6*(w-C)*E:E<.5?w:E<2/3?C+(w-C)*(2/3-E)*6:C}if(g=ne(g,360),v=ne(v,100),k=ne(k,100),v===0)I=T=F=k;else{var y=k<.5?k*(1+v):k+v-k*v,j=2*k-y;I=x(j,y,g+1/3),T=x(j,y,g),F=x(j,y,g-1/3)}return{r:255*I,g:255*T,b:255*F}}(r.h,o,c),m=!0,p="hsl"),r.hasOwnProperty("a")&&(s=r.a));var h,u,f;return s=oa(s),{ok:m,format:r.format||p,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:s}}(n);this._originalInput=n,this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||a.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=a.ok}function hn(n,e,a){n=ne(n,255),e=ne(e,255),a=ne(a,255);var r,i,s=Math.max(n,e,a),o=Math.min(n,e,a),l=(s+o)/2;if(s==o)r=i=0;else{var c=s-o;switch(i=l>.5?c/(2-s-o):c/(s+o),s){case n:r=(e-a)/c+(e<a?6:0);break;case e:r=(a-n)/c+2;break;case a:r=(n-e)/c+4}r/=6}return{h:r,s:i,l}}function gn(n,e,a){n=ne(n,255),e=ne(e,255),a=ne(a,255);var r,i,s=Math.max(n,e,a),o=Math.min(n,e,a),l=s,c=s-o;if(i=s===0?0:c/s,s==o)r=0;else{switch(s){case n:r=(e-a)/c+(e<a?6:0);break;case e:r=(a-n)/c+2;break;case a:r=(n-e)/c+4}r/=6}return{h:r,s:i,v:l}}function fn(n,e,a,r){var i=[ye(Math.round(n).toString(16)),ye(Math.round(e).toString(16)),ye(Math.round(a).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function xn(n,e,a,r){return[ye(la(r)),ye(Math.round(n).toString(16)),ye(Math.round(e).toString(16)),ye(Math.round(a).toString(16))].join("")}function Ar(n,e){e=e===0?0:e||10;var a=U(n).toHsl();return a.s-=e/100,a.s=At(a.s),U(a)}function Rr(n,e){e=e===0?0:e||10;var a=U(n).toHsl();return a.s+=e/100,a.s=At(a.s),U(a)}function Mr(n){return U(n).desaturate(100)}function Ir(n,e){e=e===0?0:e||10;var a=U(n).toHsl();return a.l+=e/100,a.l=At(a.l),U(a)}function Dr(n,e){e=e===0?0:e||10;var a=U(n).toRgb();return a.r=Math.max(0,Math.min(255,a.r-Math.round(-e/100*255))),a.g=Math.max(0,Math.min(255,a.g-Math.round(-e/100*255))),a.b=Math.max(0,Math.min(255,a.b-Math.round(-e/100*255))),U(a)}function Or(n,e){e=e===0?0:e||10;var a=U(n).toHsl();return a.l-=e/100,a.l=At(a.l),U(a)}function $r(n,e){var a=U(n).toHsl(),r=(a.h+e)%360;return a.h=r<0?360+r:r,U(a)}function _r(n){var e=U(n).toHsl();return e.h=(e.h+180)%360,U(e)}function bn(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var a=U(n).toHsl(),r=[U(n)],i=360/e,s=1;s<e;s++)r.push(U({h:(a.h+s*i)%360,s:a.s,l:a.l}));return r}function Fr(n){var e=U(n).toHsl(),a=e.h;return[U(n),U({h:(a+72)%360,s:e.s,l:e.l}),U({h:(a+216)%360,s:e.s,l:e.l})]}function Lr(n,e,a){e=e||6,a=a||30;var r=U(n).toHsl(),i=360/a,s=[U(n)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(U(r));return s}function zr(n,e){e=e||6;for(var a=U(n).toHsv(),r=a.h,i=a.s,s=a.v,o=[],l=1/e;e--;)o.push(U({h:r,s:i,v:s})),s=(s+l)%1;return o}U.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var n=this.toRgb();return(299*n.r+587*n.g+114*n.b)/1e3},getLuminance:function(){var n,e,a,r=this.toRgb();return n=r.r/255,e=r.g/255,a=r.b/255,.2126*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))},setAlpha:function(n){return this._a=oa(n),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var n=gn(this._r,this._g,this._b);return{h:360*n.h,s:n.s,v:n.v,a:this._a}},toHsvString:function(){var n=gn(this._r,this._g,this._b),e=Math.round(360*n.h),a=Math.round(100*n.s),r=Math.round(100*n.v);return this._a==1?"hsv("+e+", "+a+"%, "+r+"%)":"hsva("+e+", "+a+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var n=hn(this._r,this._g,this._b);return{h:360*n.h,s:n.s,l:n.l,a:this._a}},toHslString:function(){var n=hn(this._r,this._g,this._b),e=Math.round(360*n.h),a=Math.round(100*n.s),r=Math.round(100*n.l);return this._a==1?"hsl("+e+", "+a+"%, "+r+"%)":"hsla("+e+", "+a+"%, "+r+"%, "+this._roundA+")"},toHex:function(n){return fn(this._r,this._g,this._b,n)},toHexString:function(n){return"#"+this.toHex(n)},toHex8:function(n){return function(e,a,r,i,s){var o=[ye(Math.round(e).toString(16)),ye(Math.round(a).toString(16)),ye(Math.round(r).toString(16)),ye(la(i))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this._r,this._g,this._b,this._a,n)},toHex8String:function(n){return"#"+this.toHex8(n)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*ne(this._r,255))+"%",g:Math.round(100*ne(this._g,255))+"%",b:Math.round(100*ne(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*ne(this._r,255))+"%, "+Math.round(100*ne(this._g,255))+"%, "+Math.round(100*ne(this._b,255))+"%)":"rgba("+Math.round(100*ne(this._r,255))+"%, "+Math.round(100*ne(this._g,255))+"%, "+Math.round(100*ne(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(Br[fn(this._r,this._g,this._b,!0)]||!1)},toFilter:function(n){var e="#"+xn(this._r,this._g,this._b,this._a),a=e,r=this._gradientType?"GradientType = 1, ":"";if(n){var i=U(n);a="#"+xn(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+a+")"},toString:function(n){var e=!!n;n=n||this._format;var a=!1,r=this._a<1&&this._a>=0;return e||!r||n!=="hex"&&n!=="hex6"&&n!=="hex3"&&n!=="hex4"&&n!=="hex8"&&n!=="name"?(n==="rgb"&&(a=this.toRgbString()),n==="prgb"&&(a=this.toPercentageRgbString()),n!=="hex"&&n!=="hex6"||(a=this.toHexString()),n==="hex3"&&(a=this.toHexString(!0)),n==="hex4"&&(a=this.toHex8String(!0)),n==="hex8"&&(a=this.toHex8String()),n==="name"&&(a=this.toName()),n==="hsl"&&(a=this.toHslString()),n==="hsv"&&(a=this.toHsvString()),a||this.toHexString()):n==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return U(this.toString())},_applyModification:function(n,e){var a=n.apply(null,[this].concat([].slice.call(e)));return this._r=a._r,this._g=a._g,this._b=a._b,this.setAlpha(a._a),this},lighten:function(){return this._applyModification(Ir,arguments)},brighten:function(){return this._applyModification(Dr,arguments)},darken:function(){return this._applyModification(Or,arguments)},desaturate:function(){return this._applyModification(Ar,arguments)},saturate:function(){return this._applyModification(Rr,arguments)},greyscale:function(){return this._applyModification(Mr,arguments)},spin:function(){return this._applyModification($r,arguments)},_applyCombination:function(n,e){return n.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(Lr,arguments)},complement:function(){return this._applyCombination(_r,arguments)},monochromatic:function(){return this._applyCombination(zr,arguments)},splitcomplement:function(){return this._applyCombination(Fr,arguments)},triad:function(){return this._applyCombination(bn,[3])},tetrad:function(){return this._applyCombination(bn,[4])}},U.fromRatio=function(n,e){if(wt(n)=="object"){var a={};for(var r in n)n.hasOwnProperty(r)&&(a[r]=r==="a"?n[r]:et(n[r]));n=a}return U(n,e)},U.equals=function(n,e){return!(!n||!e)&&U(n).toRgbString()==U(e).toRgbString()},U.random=function(){return U.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},U.mix=function(n,e,a){a=a===0?0:a||50;var r=U(n).toRgb(),i=U(e).toRgb(),s=a/100;return U({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},U.readability=function(n,e){var a=U(n),r=U(e);return(Math.max(a.getLuminance(),r.getLuminance())+.05)/(Math.min(a.getLuminance(),r.getLuminance())+.05)},U.isReadable=function(n,e,a){var r,i,s=U.readability(n,e);switch(i=!1,(r=function(o){var l,c;return l=((o=o||{level:"AA",size:"small"}).level||"AA").toUpperCase(),c=(o.size||"small").toLowerCase(),l!=="AA"&&l!=="AAA"&&(l="AA"),c!=="small"&&c!=="large"&&(c="small"),{level:l,size:c}}(a)).level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7}return i},U.mostReadable=function(n,e,a){var r,i,s,o,l=null,c=0;i=(a=a||{}).includeFallbackColors,s=a.level,o=a.size;for(var m=0;m<e.length;m++)(r=U.readability(n,e[m]))>c&&(c=r,l=U(e[m]));return U.isReadable(n,l,{level:s,size:o})||!i?l:(a.includeFallbackColors=!1,U.mostReadable(n,["#fff","#000"],a))};var Xt=U.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Br=U.hexNames=function(n){var e={};for(var a in n)n.hasOwnProperty(a)&&(e[n[a]]=a);return e}(Xt);function oa(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function ne(n,e){(function(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1})(n)&&(n="100%");var a=function(r){return typeof r=="string"&&r.indexOf("%")!=-1}(n);return n=Math.min(e,Math.max(0,parseFloat(n))),a&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function At(n){return Math.min(1,Math.max(0,n))}function he(n){return parseInt(n,16)}function ye(n){return n.length==1?"0"+n:""+n}function et(n){return n<=1&&(n=100*n+"%"),n}function la(n){return Math.round(255*parseFloat(n)).toString(16)}function vn(n){return he(n)/255}var Re,dt,mt,be=(dt="[\\s|\\(]+("+(Re="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Re+")[,|\\s]+("+Re+")\\s*\\)?",mt="[\\s|\\(]+("+Re+")[,|\\s]+("+Re+")[,|\\s]+("+Re+")[,|\\s]+("+Re+")\\s*\\)?",{CSS_UNIT:new RegExp(Re),rgb:new RegExp("rgb"+dt),rgba:new RegExp("rgba"+mt),hsl:new RegExp("hsl"+dt),hsla:new RegExp("hsla"+mt),hsv:new RegExp("hsv"+dt),hsva:new RegExp("hsva"+mt),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function Ce(n){return!!be.CSS_UNIT.exec(n)}var Ur=function(n,e){var a=(typeof n=="string"?parseInt(n):n)||0;if(a>=-5&&a<=5){var r=a,i=parseFloat(e),s=i+r*(i/5)*-1;return(s==0||s<=Number.EPSILON)&&(s=.1),{animationPeriod:s+"s"}}return{animationPeriod:e}},qr=function(n,e){var a=n||{},r="";switch(e){case"small":r="12px";break;case"medium":r="16px";break;case"large":r="20px";break;default:r=void 0}var i={};if(a.fontSize){var s=a.fontSize;i=function(o,l){var c={};for(var m in o)Object.prototype.hasOwnProperty.call(o,m)&&l.indexOf(m)<0&&(c[m]=o[m]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var p=0;for(m=Object.getOwnPropertySymbols(o);p<m.length;p++)l.indexOf(m[p])<0&&Object.prototype.propertyIsEnumerable.call(o,m[p])&&(c[m[p]]=o[m[p]])}return c}(a,["fontSize"]),r=s}return{fontSize:r,styles:i}},Hr={color:"currentColor",mixBlendMode:"difference",width:"unset",display:"block",paddingTop:"2px"},Wr=function(n){var e=n.className,a=n.text,r=n.textColor,i=n.staticText,s=n.style;return a?Z.createElement("span",{className:"rli-d-i-b rli-text-format ".concat(e||"").trim(),style:Ne(Ne(Ne({},i&&Hr),r&&{color:r,mixBlendMode:"unset"}),s&&s)},typeof a=="string"&&a.length?a:"loading"):null},ca="rgb(50, 205, 50)";function Gr(n,e){if(e===void 0&&(e=0),n.length===0)throw new Error("Input array cannot be empty!");var a=[];return function r(i,s){return s===void 0&&(s=0),a.push.apply(a,i),a.length<s&&r(a,s),a.slice(0,s)}(n,e)}le(`.atom-rli-bounding-box {
  --atom-phase1-rgb: 50, 205, 50;
  color: rgba(var(--atom-phase1-rgb), 1);
  font-size: 16px;
  position: relative;
  text-align: unset;
  isolation: isolate;
}
.atom-rli-bounding-box .atom-indicator {
  width: 6em;
  height: 6em;
  position: relative;
  perspective: 6em;
  overflow: hidden;
  color: rgba(var(--atom-phase1-rgb), 1);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator::after, .atom-rli-bounding-box .atom-indicator::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 0.48em;
  height: 0.48em;
  margin: auto;
  border-radius: 50%;
  background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7eg;
}
.atom-rli-bounding-box .atom-indicator::before {
  filter: drop-shadow(0px 0px 0.0625em currentColor);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit {
  color: rgba(var(--atom-phase1-rgb), 0.85);
  border: 0;
  border-left: 0.4em solid currentColor;
  box-sizing: border-box;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  width: 4.8em;
  height: 4.8em;
  background-color: transparent;
  border-radius: 50%;
  transform-style: preserve-3d;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7fj, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gy;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  color: rgba(var(--atom-phase1-rgb), 0.18);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7hv;
  border: 0.125em solid currentColor;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::before {
  content: "";
  width: 0.192em;
  height: 0.192em;
  position: absolute;
  border-radius: 50%;
  top: -0.096em;
  right: 0;
  bottom: 0;
  left: 0;
  margin: 0 auto;
  color: rgba(var(--atom-phase1-rgb), 1);
  box-shadow: 0px 0px 0.0625em 0.0625em currentColor, 0px 0px 0.0625em 0.125em currentColor;
  background-color: currentColor;
  transform: rotateY(-70deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7ew, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(1) {
  --orbit-vector-factor: -1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(2) {
  --orbit-vector-factor: 1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3) {
  --orbit-vector-factor: 0;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3)::before {
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --atom-phase1-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase2-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase3-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase4-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7fj {
  from {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(0deg);
  }
  to {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(360deg);
  }
}
@keyframes uxlv7ew {
  from {
    transform: rotateY(-70deg) rotateX(0deg);
  }
  to {
    transform: rotateY(-70deg) rotateX(-360deg);
  }
}
@keyframes uxlv7eg {
  100%, 0% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  20% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  25% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  45% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  50% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  70% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  75% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  95% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
}
@keyframes uxlv7gg {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
}
@keyframes uxlv7gy {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
}
@keyframes uxlv7hv {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
}`);U(ca).toRgb();Array.from({length:4},function(n,e){return"--atom-phase".concat(e+1,"-rgb")});le(`.commet-rli-bounding-box {
  --commet-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  width: 6.85em;
  height: 6.85em;
  overflow: hidden;
  display: inline-block;
  box-sizing: border-box;
  position: relative;
  isolation: isolate;
}
.commet-rli-bounding-box .commet-indicator {
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  box-sizing: border-box;
  width: 6em;
  height: 6em;
  color: var(--commet-phase1-color);
  display: inline-block;
  isolation: isolate;
  position: absolute;
  z-index: 0;
  animation: calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite uxlv7cp;
}
.commet-rli-bounding-box .commet-indicator .commet-box {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  animation: uxlv7bx var(--rli-animation-duration, 1.2s) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(1) {
  width: 100%;
  height: 100%;
  animation-direction: normal;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(2) {
  width: 70%;
  height: 70%;
  animation-direction: reverse;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  display: inline-block;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box::before {
  content: "";
  width: 0.5em;
  height: 0.5em;
  border-radius: 50%;
  background-color: currentColor;
  position: absolute;
  top: -0.125em;
  left: 50%;
  transform: translateX(-50%);
  box-shadow: 0 0 0.2em 0em currentColor, 0 0 0.6em 0em currentColor;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  box-sizing: border-box;
  border-style: solid;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail1 {
  border-color: currentColor transparent transparent currentColor;
  border-width: 0.25em 0.25em 0 0;
  transform: rotateZ(-45deg);
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail2 {
  border-color: currentColor currentColor transparent transparent;
  border-width: 0.25em 0 0 0.25em;
  transform: rotateZ(45deg);
}
.commet-rli-bounding-box .commet-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--commet-phase1-color);
}

@property --commet-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7bx {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7cp {
  100%, 0% {
    color: var(--commet-phase1-color);
  }
  20% {
    color: var(--commet-phase1-color);
  }
  25% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  45% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  50% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  70% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  75% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
  95% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--commet-phase".concat(e+1,"-color")});le(`.OP-annulus-rli-bounding-box {
  --OP-annulus-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .whirl {
  animation: uxlv7n7 calc(var(--rli-animation-duration, 1.5s) * 1.33) linear infinite;
  height: 100%;
  transform-origin: center center;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .path {
  stroke-dasharray: 1, 125;
  stroke-dashoffset: 0;
  animation: var(--rli-animation-duration, 1.5s) var(--rli-animation-function, ease-in-out) infinite uxlv7oa, calc(var(--rli-animation-duration, 1.5s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7p5;
  stroke-linecap: round;
}
.OP-annulus-rli-bounding-box .OP-annulus-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7n7 {
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7oa {
  0% {
    stroke-dasharray: 1, 125;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -35px;
  }
  100% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -124px;
  }
}
@keyframes uxlv7p5 {
  100%, 0% {
    stroke: var(--OP-annulus-phase1-color);
  }
  22% {
    stroke: var(--OP-annulus-phase1-color);
  }
  25% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  42% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  50% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  72% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  75% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
  97% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--OP-annulus-phase".concat(e+1,"-color")});function _t(n){return n&&n.Math===Math&&n}le(`.OP-dotted-rli-bounding-box {
  --OP-dotted-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-dotted-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .OP-dotted-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder .dot {
  display: block;
  margin: 0 auto;
  width: 15%;
  height: 15%;
  background-color: currentColor;
  border-radius: 50%;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) infinite uxlv7nu, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7ol;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) {
  transform: rotate(0deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 12 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) {
  transform: rotate(30deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 11 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) {
  transform: rotate(60deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 10 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) {
  transform: rotate(90deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 9 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) {
  transform: rotate(120deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 8 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) {
  transform: rotate(150deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 7 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) {
  transform: rotate(180deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 6 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) {
  transform: rotate(210deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 5 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) {
  transform: rotate(240deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 4 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) {
  transform: rotate(270deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 3 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) {
  transform: rotate(300deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 2 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) {
  transform: rotate(330deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 1 * -1);
}

@property --OP-dotted-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7nu {
  0%, 39%, 100% {
    opacity: 0;
  }
  40% {
    opacity: 1;
  }
}
@keyframes uxlv7ol {
  100%, 0% {
    background-color: var(--OP-dotted-phase1-color);
  }
  22% {
    background-color: var(--OP-dotted-phase1-color);
  }
  25% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  47% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  50% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  72% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  75% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
  97% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
}`);_t(typeof window=="object"&&window)||_t(typeof self=="object"&&self)||_t(typeof global=="object"&&global)||function(){return this}()||Function("return this")();Array.from({length:4},function(n,e){return"--OP-dotted-phase".concat(e+1,"-color")});le(`.OP-spokes-rli-bounding-box {
  --OP-spokes-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  position: relative;
  color: var(--OP-spokes-phase1-color);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator {
  width: 4.8em;
  height: 4.8em;
  display: block;
  position: relative;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke {
  position: absolute;
  height: 1.2em;
  width: 0.4em;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: auto auto auto 50%;
  background-color: var(--OP-spokes-phase1-color);
  border-radius: 0.24em;
  opacity: 0;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) backwards infinite uxlv7pw, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7qn;
  transform-origin: left center;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(1) {
  transform: rotate(calc(0 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(11 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(2) {
  transform: rotate(calc(1 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(10 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(3) {
  transform: rotate(calc(2 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(9 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(4) {
  transform: rotate(calc(3 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(8 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(5) {
  transform: rotate(calc(4 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(7 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(6) {
  transform: rotate(calc(5 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(6 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(7) {
  transform: rotate(calc(6 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(5 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(8) {
  transform: rotate(calc(7 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(4 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(9) {
  transform: rotate(calc(8 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(3 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(10) {
  transform: rotate(calc(9 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(2 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(11) {
  transform: rotate(calc(10 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(1 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(12) {
  transform: rotate(calc(11 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(0 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--OP-spokes-phase1-color);
  z-index: -2;
}

@property --OP-spokes-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7pw {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@keyframes uxlv7qn {
  100%, 0% {
    background-color: var(--OP-spokes-phase1-color);
  }
  22% {
    background-color: var(--OP-spokes-phase1-color);
  }
  25% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  42% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  50% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  72% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  75% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
  97% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--OP-spokes-phase".concat(e+1,"-color")});le(`.OP-annulus-dual-sectors-rli-bounding-box {
  --OP-annulus-dual-sectors-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator {
  width: 5em;
  height: 5em;
  display: inline-block;
  position: relative;
  z-index: 0;
  color: var(--OP-annulus-dual-sectors-phase1-color);
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .annulus-sectors {
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border-width: 0.34em;
  border-style: solid;
  border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent var(--OP-annulus-dual-sectors-phase1-color) transparent;
  background-color: transparent;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) infinite uxlv7ra, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) infinite uxlv7sv;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .OP-annulus-dual-sectors-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-dual-sectors-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7ra {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7sv {
  100%, 0% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  20% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  25% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  45% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  50% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  70% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  75% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  95% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
}`);Array.from({length:4},function(n,e){return"--OP-annulus-dual-sectors-phase".concat(e+1,"-color")});le(`.OP-annulus-sector-track-rli-bounding-box {
  --OP-annulus-track-phase1-color: rgba(50, 205, 50, 0.22);
  --OP-annulus-sector-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-sector-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .annulus-track-ring {
  width: 100%;
  height: 100%;
  border-width: 0.34em;
  border-style: solid;
  border-radius: 50%;
  box-sizing: border-box;
  border-color: var(--OP-annulus-track-phase1-color);
  border-top-color: var(--OP-annulus-sector-phase1-color);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7rl, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7tf;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .OP-annulus-sector-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-track-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-sector-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7rl {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7tf {
  100%, 0% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  18% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  25% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  43% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  50% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  68% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  75% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
  93% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return["--OP-annulus-track-phase".concat(e+1,"-color"),"--OP-annulus-sector-phase".concat(e+1,"-color")]});le(`.foursquare-rli-bounding-box {
  --four-square-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  color: var(--four-square-phase1-color);
  display: inline-block;
  overflow: hidden;
}
.foursquare-rli-bounding-box .foursquare-indicator {
  height: 5.3033008589em;
  width: 5.3033008589em;
  position: relative;
  display: block;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container {
  position: absolute;
  z-index: 0;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  height: 2.5em;
  width: 2.5em;
  color: inherit;
  will-change: color, width, height;
  transform: rotate(45deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7dk, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7es;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square {
  position: absolute;
  width: 1.25em;
  height: 1.25em;
  border-radius: 0.1875em;
  background-color: currentColor;
  animation: uxlv7dd var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) both infinite;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square1 {
  top: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square2 {
  top: 0;
  right: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square3 {
  bottom: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square4 {
  bottom: 0;
  right: 0;
}

@property --four-square-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7dk {
  0% {
    width: 2.5em;
    height: 2.5em;
  }
  10% {
    width: 2.5em;
    height: 2.5em;
  }
  50% {
    width: 3.75em;
    height: 3.75em;
  }
  90% {
    width: 2.5em;
    height: 2.5em;
  }
  100% {
    width: 2.5em;
    height: 2.5em;
  }
}
@keyframes uxlv7dd {
  0% {
    transform: rotateZ(0deg);
  }
  10% {
    transform: rotateZ(0deg);
  }
  50% {
    transform: rotateZ(90deg);
  }
  90% {
    transform: rotateZ(90deg);
  }
  100% {
    transform: rotateZ(90deg);
  }
}
@keyframes uxlv7es {
  100%, 0% {
    color: var(--four-square-phase1-color);
  }
  20% {
    color: var(--four-square-phase1-color);
  }
  25% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  45% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  50% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  70% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  75% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
  95% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--four-square-phase".concat(e+1,"-color")});le(`.mosaic-rli-bounding-box {
  --mosaic-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  color: var(--mosaic-phase1-color);
}
.mosaic-rli-bounding-box .mosaic-indicator {
  width: 5em;
  height: 5em;
  color: currentColor;
  display: grid;
  gap: 0.125em;
  grid-template-columns: repeat(3, 1fr);
  grid-template-areas: "a b c" "d e f" "g h i";
  position: relative;
  z-index: 0;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  z-index: -2;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube {
  background-color: var(--mosaic-phase1-color);
  animation-name: uxlv7i4, uxlv7is;
  animation-duration: var(--rli-animation-duration, 1.5s), calc(var(--rli-animation-duration, 1.5s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in-out);
  animation-iteration-count: infinite;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube1 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
  grid-area: a;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube2 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
  grid-area: b;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube3 {
  grid-area: c;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 4);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube4 {
  grid-area: d;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube5 {
  grid-area: e;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube6 {
  grid-area: f;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube7 {
  grid-area: g;
  animation-delay: 0s;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube8 {
  grid-area: h;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube9 {
  grid-area: i;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}

@property --mosaic-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7i4 {
  0%, 60%, 100% {
    transform: scale3D(1, 1, 1);
  }
  30% {
    transform: scale3D(0, 0, 1);
  }
}
@keyframes uxlv7is {
  100%, 0% {
    background-color: var(--mosaic-phase1-color);
  }
  25% {
    background-color: var(--mosaic-phase2-color, var(--mosaic-phase1-color));
  }
  50% {
    background-color: var(--mosaic-phase3-color, var(--mosaic-phase1-color));
  }
  75% {
    background-color: var(--mosaic-phase4-color, var(--mosaic-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--mosaic-phase".concat(e+1,"-color")});le(`.riple-rli-bounding-box {
  --riple-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--riple-phase1-color);
}
.riple-rli-bounding-box .riple-indicator {
  display: inline-block;
  width: 5em;
  height: 5em;
  position: relative;
  z-index: 0;
}
.riple-rli-bounding-box .riple-indicator .riple-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.riple-rli-bounding-box .riple-indicator .riple {
  --border-width: 0.25em;
  position: absolute;
  border: var(--border-width) solid var(--riple-phase1-color);
  opacity: 1;
  border-radius: 50%;
  will-change: top, right, left, bottom, border-color;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7i1, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7io;
}
.riple-rli-bounding-box .riple-indicator .riple:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 1s) / 2 * -1);
}

@property --riple-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7i1 {
  0% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  4.9% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  5% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 1;
  }
  100% {
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
  }
}
@keyframes uxlv7io {
  100%, 0% {
    border-color: var(--riple-phase1-color);
  }
  24.9% {
    border-color: var(--riple-phase1-color);
  }
  25% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  49.9% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  50% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  74.9% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  75% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
  99.9% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--riple-phase".concat(e+1,"-color")});le(`.pulsate-rli-bounding-box {
  --TD-pulsate-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
  box-sizing: border-box;
  color: var(--TD-pulsate-phase1-color);
}
.pulsate-rli-bounding-box .pulsate-indicator {
  width: 4.4em;
  height: 1.1em;
  text-align: center;
  position: relative;
  z-index: 0;
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  align-items: center;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot {
  width: 1.1em;
  height: 1.1em;
  border-radius: 50%;
  background-color: var(--TD-pulsate-phase1-color);
  transform: scale(0);
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7s0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7to;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(1) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15 * -1);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(2) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(3) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15);
}
.pulsate-rli-bounding-box .pulsate-text {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 80%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.6em;
  letter-spacing: 0.5px;
  font-family: sans-serif;
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --TD-pulsate-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7s0 {
  0%, 90%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}
@keyframes uxlv7to {
  0%, 100% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  24.9% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  25% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  49.9% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  50% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  74.9% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  75% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
  99.9% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-pulsate-phase".concat(e+1,"-color")});le(`.brick-stack-rli-bounding-box {
  --TD-brick-stack-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-brick-stack-phase1-color);
}
.brick-stack-rli-bounding-box .brick-stack-indicator {
  width: 2.8em;
  height: 2.8em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.brick-stack-rli-bounding-box .brick-stack {
  width: 100%;
  height: 100%;
  background: radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 0/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 100%/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 100% 100%/40% 40% no-repeat;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, ease-out) infinite uxlv7tu, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, ease-out) infinite uxlv7us;
}

@property --TD-brick-stack-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7tu {
  0% {
    background-position: 0 0, 0 100%, 100% 100%;
  }
  25% {
    background-position: 100% 0, 0 100%, 100% 100%;
  }
  50% {
    background-position: 100% 0, 0 0, 100% 100%;
  }
  75% {
    background-position: 100% 0, 0 0, 0 100%;
  }
  100% {
    background-position: 100% 100%, 0 0, 0 100%;
  }
}
@keyframes uxlv7us {
  100%, 0% {
    color: var(--TD-brick-stack-phase1-color);
  }
  20% {
    color: var(--TD-brick-stack-phase1-color);
  }
  25% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  45% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  50% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  70% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  75% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
  95% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-brick-stack-phase".concat(e+1,"-color")});le(`.bob-rli-bounding-box {
  --TD-bob-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-bob-phase1-color);
}
.bob-rli-bounding-box .bob-indicator {
  width: 4.4em;
  height: 2.2em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bob-rli-bounding-box .bob-indicator .bobbing,
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  width: 1.1em;
  height: 100%;
  display: grid;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) var(--delay) infinite uxlv7u0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) var(--delay) infinite uxlv7vq;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  content: "";
  grid-area: 1/1;
}
.bob-rli-bounding-box .bob-indicator .bobbing {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12 * -1);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
  transform: translateX(150%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12);
  transform: translateX(300%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}

@property --TD-bob-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7u0 {
  100%, 0% {
    background-position: 50% 50%;
  }
  15% {
    background-position: 50% 10%;
  }
  30% {
    background-position: 50% 100%;
  }
  40% {
    background-position: 50% 0%;
  }
  50% {
    background-position: 50% 90%;
  }
  70% {
    background-position: 50% 10%;
  }
  98% {
    background-position: 50% 50%;
  }
}
@keyframes uxlv7vq {
  100%, 0% {
    color: var(--TD-bob-phase1-color);
  }
  22% {
    color: var(--TD-bob-phase1-color);
  }
  25% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  47% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  50% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  72% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  75% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
  97% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-bob-phase".concat(e+1,"-color")});le(`.bounce-rli-bounding-box {
  --TD-bounce-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--TD-bounce-phase1-color);
  display: inline-block;
  padding-bottom: 0.25125em;
}
.bounce-rli-bounding-box .wrapper {
  --dot1-delay: 0s;
  --dot1-x-offset: 0.55em;
  --dot2-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.75) * -1);
  --dot2-x-offset: 2.2em;
  --dot3-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.5) * -1);
  --dot3-x-offset: 3.85em;
  width: 5.5em;
  height: 3.125em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bounce-rli-bounding-box .wrapper .group {
  display: block;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.bounce-rli-bounding-box .wrapper .group .dot {
  width: 1.1em;
  height: 1.1em;
  position: absolute;
  border-radius: 50%;
  background-color: var(--TD-bounce-phase1-color);
  transform-origin: 50%;
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7wc, calc(var(--rli-animation-duration, 0.5s) * 4) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) infinite uxlv7x6;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .shadow {
  width: 1.1em;
  height: 0.22em;
  border-radius: 50%;
  background-color: rgba(0, 0, 0, 0.5);
  position: absolute;
  top: 101%;
  transform-origin: 50%;
  z-index: -1;
  filter: blur(1px);
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7ww;
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay);
}

@property --TD-bounce-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 0.5s;
}
@keyframes uxlv7wc {
  0% {
    top: 0%;
  }
  60% {
    height: 1.25em;
    border-radius: 50%;
    transform: scaleX(1);
  }
  100% {
    top: 100%;
    height: 0.22em;
    transform: scaleX(1.5);
    filter: blur(0.4px);
  }
}
@keyframes uxlv7ww {
  0% {
    transform: scaleX(0.2);
    opacity: 0.2;
  }
  60% {
    opacity: 0.4;
  }
  100% {
    transform: scaleX(1.5);
    opacity: 0.6;
  }
}
@keyframes uxlv7x6 {
  0%, 100% {
    background-color: var(--TD-bounce-phase1-color);
  }
  20% {
    background-color: var(--TD-bounce-phase1-color);
  }
  25% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  45% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  50% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  70% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  75% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
  95% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-bounce-phase".concat(e+1,"-color")});le(`.blink-blur-rli-bounding-box {
  --shape-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--shape-phase1-color);
}
.blink-blur-rli-bounding-box .blink-blur-indicator {
  isolation: isolate;
  display: flex;
  flex-direction: row;
  -moz-column-gap: 0.4em;
       column-gap: 0.4em;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape {
  --x-deg: -20deg;
  width: 1.8em;
  height: 2.25em;
  border-radius: 0.25em;
  color: inherit;
  transform: skewX(var(--x-deg));
  background-color: var(--shape-phase1-color);
  animation-name: uxlv7id, uxlv7jl;
  animation-duration: var(--rli-animation-duration, 1.2s), calc(var(--rli-animation-duration, 1.2s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in);
  animation-iteration-count: infinite;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape1 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.5 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape2 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.4 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape3 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.3 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape4 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.2 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape5 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.1 * -1);
}

@property --shape-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7id {
  100%, 0% {
    opacity: 0.3;
    filter: blur(0.0675em) drop-shadow(0 0 0.0625em);
    transform: skewX(var(--x-deg)) scale(1.2, 1.45);
  }
  39% {
    opacity: 0.8;
  }
  40%, 41%, 42% {
    opacity: 0;
  }
  43% {
    opacity: 0.8;
  }
  50% {
    opacity: 1;
    filter: blur(0em) drop-shadow(0 0 0em);
    transform: skewX(var(--x-deg)) scale(1, 1);
  }
}
@keyframes uxlv7jl {
  100%, 0% {
    color: var(--shape-phase1-color);
    background-color: var(--shape-phase1-color);
  }
  25% {
    color: var(--shape-phase2-color, var(--shape-phase1-color));
    background-color: var(--shape-phase2-color, var(--shape-phase1-color));
  }
  50% {
    color: var(--shape-phase3-color, var(--shape-phase1-color));
    background-color: var(--shape-phase3-color, var(--shape-phase1-color));
  }
  75% {
    color: var(--shape-phase4-color, var(--shape-phase1-color));
    background-color: var(--shape-phase4-color, var(--shape-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--shape-phase".concat(e+1,"-color")});le(`.trophy-spin-rli-bounding-box {
  --trophySpin-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  position: relative;
  isolation: isolate;
  color: var(--trophySpin-phase1-color);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator {
  width: 4em;
  perspective: 1000px;
  transform-style: preserve-3d;
  display: block;
  margin: 0 auto;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade {
  display: block;
  width: 4em;
  height: 0.5em;
  background: var(--trophySpin-phase1-color);
  animation: uxlv7ki var(--rli-animation-duration, 2.5s) var(--rli-animation-function, linear) infinite, uxlv7l2 calc(var(--rli-animation-duration, 2.5s) * 0.5) var(--rli-animation-function, linear) infinite, uxlv7ly calc(var(--rli-animation-duration, 2.5s) * 4) var(--rli-animation-function, linear) infinite;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(8) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 0 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(7) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 1 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(6) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 2 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(5) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 3 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(4) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 4 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(3) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 5 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 6 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(1) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 7 * -1);
}

@property --trophySpin-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2.5s;
}
@keyframes uxlv7ki {
  to {
    transform: rotateY(1turn) rotateX(-25deg);
  }
}
@keyframes uxlv7l2 {
  100%, 0% {
    filter: brightness(1);
    opacity: 1;
  }
  15% {
    filter: brightness(1);
  }
  25% {
    opacity: 0.96;
  }
  30% {
    filter: brightness(0.92);
  }
  50% {
    filter: brightness(0.7);
    opacity: 1;
  }
  75% {
    filter: brightness(0.92);
    opacity: 0.96;
  }
  90% {
    filter: brightness(1);
  }
}
@keyframes uxlv7ly {
  100%, 0% {
    background-color: var(--trophySpin-phase1-color);
  }
  18% {
    background-color: var(--trophySpin-phase1-color);
  }
  25% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  43% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  50% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  68% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  75% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
  93% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
}`);var ut=Array.from({length:4},function(n,e){return"--trophySpin-phase".concat(e+1,"-color")}),Vr=function(n){var e,a=qr(n?.style,n?.size),r=a.styles,i=a.fontSize,s=n?.easing,o=Ur(n?.speedPlus,"2.5s").animationPeriod,l=function(c){var m={},p=ut.length;if(c instanceof Array){for(var h=Gr(c,p),u=0;u<h.length&&!(u>=4);u++)m[ut[u]]=h[u];return m}try{if(typeof c!="string")throw new Error("Color String expected");for(var f=0;f<p;f++)m[ut[f]]=c}catch(g){for(g instanceof Error?console.warn("[".concat(g.message,']: Received "').concat(typeof c,'" instead with value, ').concat(JSON.stringify(c))):console.warn("".concat(JSON.stringify(c)," received in <TrophySpin /> indicator cannot be processed. Using default instead!")),f=0;f<p;f++)m[ut[f]]=ca}return m}((e=n?.color)!==null&&e!==void 0?e:"");return Z.createElement("span",{className:"rli-d-i-b trophy-spin-rli-bounding-box",style:Ne(Ne(Ne(Ne(Ne({},i&&{fontSize:i}),o&&{"--rli-animation-duration":o}),s&&{"--rli-animation-function":s}),l),r),role:"status","aria-live":"polite","aria-label":"Loading"},Z.createElement("span",{className:"rli-d-i-b trophy-spin-indicator"},Z.createElement("span",{className:"blade"}),Z.createElement("span",{className:"blade"}),Z.createElement("span",{className:"blade"}),Z.createElement("span",{className:"blade"}),Z.createElement("span",{className:"blade"}),Z.createElement("span",{className:"blade"}),Z.createElement("span",{className:"blade"}),Z.createElement("span",{className:"blade"})),Z.createElement(Wr,{staticText:!0,text:n?.text,textColor:n?.textColor}))};le(`.slab-rli-bounding-box {
  --slab-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--slab-phase1-color);
  position: relative;
}
.slab-rli-bounding-box .slab-indicator {
  position: relative;
  display: block;
  width: 7em;
  height: 4em;
  margin: 0 auto;
  overflow: hidden;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper {
  width: 4em;
  height: 4em;
  transform: perspective(15em) rotateX(66deg) rotateZ(-25deg);
  transform-style: preserve-3d;
  transform-origin: 50% 100%;
  display: block;
  position: absolute;
  bottom: 0;
  right: 0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--slab-phase1-color);
  opacity: 0;
  box-shadow: -0.08em 0.15em 0 rgba(0, 0, 0, 0.45);
  transform-origin: 0% 0%;
  animation: calc(var(--rli-animation-duration-unitless, 3) * 1s) var(--rli-animation-function, linear) infinite uxlv7md, calc(var(--rli-animation-duration-unitless, 3) * 4s) var(--rli-animation-function, linear) infinite uxlv7n0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(1) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 3 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(2) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 2 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(3) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(4) {
  animation-delay: 0s;
}

@property --slab-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration-unitless {
  syntax: "<number>";
  inherits: true;
  initial-value: 3;
}
@keyframes uxlv7md {
  0% {
    transform: translateY(0) rotateX(30deg);
    opacity: 0;
  }
  10% {
    transform: translateY(-40%) rotateX(0deg);
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  100% {
    transform: translateY(-400%) rotateX(0deg);
    opacity: 0;
  }
}
@keyframes uxlv7n0 {
  100%, 0% {
    background-color: var(--slab-phase1-color);
  }
  24.9% {
    background-color: var(--slab-phase1-color);
  }
  25% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  49.9% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  50% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  74.9% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  75% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
  99.9% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--slab-phase".concat(e+1,"-color")});le(`.lifeline-rli-bounding-box {
  --life-line-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  isolation: isolate;
  color: var(--life-line-phase1-color);
}
.lifeline-rli-bounding-box .lifeline-indicator {
  position: relative;
  text-align: center;
}
.lifeline-rli-bounding-box .lifeline-indicator path.rli-lifeline {
  stroke-dasharray: 474.7616760254 30.3039367676;
  animation: var(--rli-animation-duration, 2s) var(--rli-animation-function, linear) infinite uxlv7k3, calc(var(--rli-animation-duration, 2s) * 4) var(--rli-animation-function, linear) infinite uxlv7kg;
}
.lifeline-rli-bounding-box .lifeline-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --life-line-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2s;
}
@keyframes uxlv7k3 {
  to {
    stroke-dashoffset: -1010.1312255859;
  }
}
@keyframes uxlv7kg {
  100%, 0% {
    color: var(--life-line-phase1-color);
  }
  20% {
    color: var(--life-line-phase1-color);
  }
  25% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  45% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  50% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  70% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  75% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
  95% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--life-line-phase".concat(e+1,"-color")});const Xr={sm:14,md:20,lg:32,xl:48},da=({size:n="md",color:e="#3b82f6",speedPlus:a=1,className:r=""})=>{const i=Xr[n];return t.jsx("div",{className:`flex items-center justify-center ${r}`,children:t.jsx(Vr,{color:e,size:i,speedPlus:a,style:{width:`${i}px`,height:`${i}px`}})})},kt=({className:n})=>t.jsx(da,{size:"sm",className:n}),Ft=({className:n,color:e})=>t.jsx(da,{size:"md",color:e,className:n}),yn=({config:n,onStartWorkflow:e,onQuickAction:a,processingAction:r,isFooter:i=!1})=>{const[s,o]=d.useState(!1),l=r===n.actionId,c=n.icon,m=d.useCallback(()=>{l||o(!0)},[l]),p=d.useCallback(()=>{o(!1)},[]),h=d.useCallback(async()=>{n.actionId==="bloods"&&a&&await a(n.actionId,{type:"prepare-modal"}),e&&e(n.workflowId),o(!1)},[e,a,n.workflowId,n.actionId]),u=d.useCallback(async()=>{await a(n.actionId,{type:"manual"}),o(!1)},[a,n.actionId]);return i?t.jsxs("div",{className:"relative overflow-hidden min-h-10",onMouseEnter:m,onMouseLeave:p,style:{minHeight:"40px"},children:[t.jsx("div",{className:`
          absolute inset-0 transition-all duration-200 ease-out
          ${s&&!l?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100"}
        `,children:t.jsxs("button",{disabled:l,className:`
              glass-button relative p-1.5 rounded-lg transition-all hover:bg-gray-50 text-left w-full h-full
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx(c,{className:`w-3 h-3 text-${n.color}-600 flex-shrink-0`}),t.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:n.label})]}),l&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx("div",{className:`w-3 h-3 border-2 border-gray-300 border-t-${n.color}-600 rounded-full animate-spin`})})]})}),t.jsx("div",{className:`
          absolute inset-0 transition-all duration-200 ease-out
          ${s&&!l?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}
        `,children:t.jsxs("div",{className:"grid grid-cols-2 gap-1 h-full",children:[t.jsxs("button",{onClick:h,disabled:l,className:`
                glass-button relative flex items-center justify-center p-1 rounded-lg 
                transition-all hover:bg-${n.color}-50 text-left
                ${l?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsx(Se,{className:`w-2.5 h-2.5 text-${n.color}-600 flex-shrink-0 mr-1`}),t.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:"Dictate"})]}),t.jsxs("button",{onClick:u,disabled:l,className:`
                glass-button relative flex items-center justify-center p-1 rounded-lg 
                transition-all hover:bg-${n.color}-50 text-left
                ${l?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsx(Ht,{className:`w-2.5 h-2.5 text-${n.color}-600 flex-shrink-0 mr-1`}),t.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:"Type"})]})]})})]}):t.jsxs("div",{className:"relative overflow-hidden",onMouseEnter:m,onMouseLeave:p,children:[t.jsx("div",{className:`
        transition-all duration-200 ease-out
        ${s&&!l?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100"}
      `,children:t.jsxs("button",{disabled:l,className:`
            glass-button relative flex items-center p-3 rounded-lg transition-all 
            hover:bg-gray-50 text-left w-full
            ${l?"opacity-50 cursor-not-allowed":""}
          `,children:[t.jsx(c,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-gray-900 font-medium text-sm",children:n.label}),t.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Quick entry and processing"})]}),l&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx("div",{className:`w-4 h-4 border-2 border-gray-300 border-t-${n.color}-600 rounded-full animate-spin`})})]})}),t.jsx("div",{className:`
        transition-all duration-200 ease-out
        ${s&&!l?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}
      `,children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs("button",{onClick:h,disabled:l,className:`
              glass-button relative flex items-center p-3 rounded-lg transition-all 
              hover:bg-${n.color}-50 text-left w-full
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[t.jsx(Se,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"text-gray-900 font-medium text-sm",children:["Dictate ",n.label]}),t.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Voice recording and AI processing"})]})]}),t.jsxs("button",{onClick:u,disabled:l,className:`
              glass-button relative flex items-center p-3 rounded-lg transition-all 
              hover:bg-${n.color}-50 text-left w-full
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[t.jsx(Ht,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"text-gray-900 font-medium text-sm",children:["Type ",n.label]}),t.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Manual entry and quick processing"})]})]})]})})]})},Kr=[{id:"preset-116-fup-3mth",displayName:"116 + FUP 3mth",itemCode:"116",notes:"Face to face follow up in 3 months please"},{id:"preset-91824-fup-3mth",displayName:"91824 + FUP 3mth",itemCode:"91824",notes:"TH follow up in 3 months please"}],Qr=[{id:"dictate",label:"Dictate",icon:Se,description:"Voice-to-text with AI formatting"},{id:"type",label:"Type",icon:Ht,description:"Open field for manual entry"}],pt={"investigation-summary":{icon:Me,label:"Investigations",actionId:"investigation-summary",workflowId:"investigation-summary",color:"emerald"},background:{icon:xt,label:"Background",actionId:"background",workflowId:"background",color:"blue"},medications:{icon:tn,label:"Medications",actionId:"medications",workflowId:"medication",color:"purple"},"social-history":{icon:zn,label:"Social History",actionId:"social-history",workflowId:"background",color:"indigo"},bloods:{icon:Bn,label:"Bloods",actionId:"bloods",workflowId:"bloods",color:"red"},imaging:{icon:Un,label:"Imaging",actionId:"imaging",workflowId:"imaging",color:"cyan"}},Yr=[{id:"background",label:"Background",icon:xt,description:"Access patient background notes",category:"emr"},{id:"investigation-summary",label:"Investigations",icon:Me,description:"Open investigation summary field",category:"emr"},{id:"medications",label:"Medications",icon:tn,description:"View/edit medication list",category:"emr"},{id:"social-history",label:"Social History",icon:zn,description:"Access social & family history section",category:"emr"},{id:"bloods",label:"Bloods",icon:Bn,description:"Blood test results and analysis",category:"emr"},{id:"imaging",label:"Imaging",icon:Un,description:"Medical imaging reports and analysis",category:"emr"},{id:"profile-photo",label:"Profile Photo",icon:qa,description:"Capture screenshot for patient profile",category:"emr"},{id:"annotate-screenshots",label:"Canvas",icon:qn,description:"Capture, annotate, and combine multiple screenshots",category:"emr"},{id:"quick-letter",label:"Quick Letter",icon:Et,description:"Generate quick medical letter",category:"documentation"},{id:"create-task",label:"Create Task",icon:Ke,description:"Add new task to workflow",category:"workflow"},{id:"appointment-wrap-up",label:"Wrap Up",icon:bt,description:"Complete appointment workflow",category:"workflow"},{id:"patient-education",label:"Patient Education",icon:ft,description:"Generate lifestyle advice and education",category:"documentation"}],Jr=[{id:"ai-medical-review",label:"AI Medical Review",icon:Hn,description:"Australian clinical oversight and guidelines review (analyzes existing EMR data)",category:"analysis"},{id:"batch-ai-review",label:"Batch AI Review",icon:Le,description:"AI review for multiple patients from appointment book",category:"analysis"}],ma=d.memo(({onQuickAction:n,onStartWorkflow:e,isFooter:a=!1})=>{const[r,i]=d.useState(null),[s,o]=d.useState(!1),[l,c]=d.useState(!1),m=async(x,y)=>{if(x==="appointment-wrap-up"&&!y){o(!0);return}if(x==="investigation-summary"&&!y){c(!0);return}if(x==="patient-education"){try{i(x),console.log("ðŸŽ“ Starting Patient Education..."),await n(x,{type:"show-config"}),console.log("âœ… Patient Education config triggered")}catch(j){console.error("âŒ Patient Education failed:",j)}finally{i(null)}return}if(x==="batch-ai-review"){try{i(x),console.log("ðŸ‘¥ Starting Batch AI Review..."),await n(x,{type:"show-modal"}),console.log("âœ… Batch AI Review modal triggered")}catch(j){console.error("âŒ Batch AI Review failed:",j)}finally{i(null)}return}if(x==="ai-medical-review"){try{i(x),console.log("ðŸ” Starting AI Medical Review..."),console.log("ðŸ“‹ Extracting EMR data for AI medical review...");const j=await p();if(j){const C={background:{hasContent:!!j.background.trim(),length:j.background.length},investigations:{hasContent:!!j.investigations.trim(),length:j.investigations.length},medications:{hasContent:!!j.medications.trim(),length:j.medications.length}},w=Object.entries(C).filter(([,P])=>P.hasContent),E=Object.keys(C).length;if(console.log("ðŸ“‹ EMR DATA VALIDATION:",{fieldsWithData:w.length,totalFields:E,details:C,extractionMeta:j.extractionMeta}),w.length===0){const P=Object.entries(C).filter(([,$])=>!$.hasContent).map(([$])=>$).join(", ");throw new Error(`No clinical data found - all EMR fields are empty: ${P}. Please ensure the patient record contains data in Background, Investigations, or Medications fields.`)}if(w.length<E){const P=Object.entries(C).filter(([,$])=>!$.hasContent).map(([$])=>$);console.warn(`âš ï¸ EMR PARTIAL DATA: Processing with ${w.length}/${E} fields. Missing: ${P.join(", ")}`)}console.log(`âœ… EMR data validation passed: ${w.length}/${E} fields available`),console.log("ðŸ”„ Processing with Australian Medical Review Agent...");const A=u(j);await n(x,{emrData:j,formattedInput:A,type:"australian-medical-review"}),console.log("âœ… AI Medical Review completed successfully")}else throw console.error("âŒ EMR EXTRACTION: extractEMRData returned null - critical extraction failure"),new Error("EMR data extraction failed - unable to connect to content script or read EMR fields. Please refresh the EMR page and ensure you are on a patient record page.")}catch(j){console.error("âŒ AI MEDICAL REVIEW FAILED:",j);const C=j instanceof Error?j.message:"Unknown error";if(console.error("ðŸš¨ AI Review Error Details:",{message:C,stack:j instanceof Error?j.stack:"No stack trace",timestamp:new Date().toISOString()}),C.includes("Content script not responding")||C.includes("all EMR fields are empty")||C.includes("extraction failed"),typeof window<"u"){const w=C.includes("Unknown message type")?"Please reload the extension in chrome://extensions and try again":C.includes("No clinical data")?"Please navigate to a patient page with clinical data and try again":`AI Review failed: ${C}`;alert(`AI Medical Review Error

${w}`)}}finally{i(null)}return}try{i(x),console.log("âš¡ Calling onQuickAction..."),await n(x,y),console.log("âš¡ onQuickAction completed successfully"),o(!1),c(!1)}catch(j){console.error(`âŒ Quick action ${x} failed:`,j)}finally{i(null)}},p=async()=>{try{console.log("ðŸ“‹ EMR EXTRACTION: Starting EMR data extraction..."),console.log("ðŸ“‹ EMR EXTRACTION: Current tab info:",await chrome.tabs.query({active:!0,currentWindow:!0})),console.log("ðŸ“‹ EMR EXTRACTION: Testing content script connection...");try{const R=await chrome.runtime.sendMessage({type:"PING"});console.log("ðŸ“‹ EMR EXTRACTION: Content script ping response:",R)}catch(R){throw console.error("ðŸ“‹ EMR EXTRACTION: Content script ping failed:",R),new Error("Content script not responding - please refresh the EMR page and try again")}console.log("ðŸ“‹ EMR EXTRACTION: Making individual EXECUTE_ACTION calls...");const x=[{name:"background",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"background",data:{extractOnly:!0}})},{name:"investigation-summary",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"investigation-summary",data:{extractOnly:!0}})},{name:"medications",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"medications",data:{extractOnly:!0}})}],y=await Promise.allSettled(x.map(R=>R.promise)),[j,C,w]=y;console.log("ðŸ“‹ EMR EXTRACTION: Detailed extraction results:"),y.forEach((R,L)=>{const X=x[L].name;R.status==="fulfilled"?console.log(`ðŸ“‹ EMR EXTRACTION: ${X} - SUCCESS:`,R.value):console.error(`ðŸ“‹ EMR EXTRACTION: ${X} - FAILED:`,R.reason)});const E=j.status==="fulfilled"?j.value:null,A=C.status==="fulfilled"?C.value:null,P=w.status==="fulfilled"?w.value:null,$={background:{response:E,success:E?.success||!1,hasData:!!E?.data,error:j.status==="rejected"?j.reason:null},investigations:{response:A,success:A?.success||!1,hasData:!!A?.data,error:C.status==="rejected"?C.reason:null},medications:{response:P,success:P?.success||!1,hasData:!!P?.data,error:w.status==="rejected"?w.reason:null}};console.log("ðŸ“‹ EMR EXTRACTION: Detailed response validation:",$);const b=h(E,"Background"),N=h(A,"Investigation Summary"),S=h(P,"Medications"),M={background:{length:b.length,hasContent:!!b.trim()},investigations:{length:N.length,hasContent:!!N.trim()},medications:{length:S.length,hasContent:!!S.trim()}};console.log("ðŸ“‹ EMR EXTRACTION: Final extraction summary:",M);const D=Object.values(M).filter(R=>R.hasContent).length;console.log(`ðŸ“‹ EMR EXTRACTION: Successfully extracted ${D}/3 fields`);const O=[];return!M.background.hasContent&&$.background.error&&O.push(`Background: ${$.background.error.message||$.background.error}`),!M.investigations.hasContent&&$.investigations.error&&O.push(`Investigations: ${$.investigations.error.message||$.investigations.error}`),!M.medications.hasContent&&$.medications.error&&O.push(`Medications: ${$.medications.error.message||$.medications.error}`),O.length>0&&console.warn("ðŸ“‹ EMR EXTRACTION: Some fields failed to extract:",O),{background:b,investigations:N,medications:S,extractionMeta:{successfulFields:D,totalFields:3,failedFields:O,fieldDetails:M}}}catch(x){throw console.error("âŒ EMR EXTRACTION: Critical error in extraction process:",x),new Error(`EMR data extraction failed: ${x instanceof Error?x.message:"Unknown error"}`)}},h=(x,y="Unknown")=>{if(console.log(`ðŸ“‹ EMR EXTRACTION: Parsing ${y} response:`,x),!x)return console.log(`ðŸ“‹ EMR EXTRACTION: ${y} - No response received`),"";let j="";return typeof x=="string"?j=x:x.data&&typeof x.data=="string"?j=x.data:x.content&&typeof x.content=="string"?j=x.content:x.text&&typeof x.text=="string"?j=x.text:x.value&&typeof x.value=="string"&&(j=x.value),console.log(`ðŸ“‹ EMR EXTRACTION: ${y} - Extracted ${j.length} characters:`,j?`"${j.substring(0,100)}${j.length>100?"...":""}"`:"(empty)"),j},u=x=>`BACKGROUND: ${x.background||"Not provided"}

INVESTIGATIONS: ${x.investigations||"Not provided"}

MEDICATIONS: ${x.medications||"Not provided"}`,f=async x=>{await m("appointment-wrap-up",{preset:x})},g=x=>{x.id==="dictate"?e&&(e("investigation-summary"),c(!1)):x.id==="type"&&m("investigation-summary",{type:"manual"})},v=()=>{o(!1),c(!1)},k=Yr,I=k.reduce((x,y)=>(x[y.category]||(x[y.category]=[]),x[y.category].push(y),x),{}),T={emr:"EMR Navigation",documentation:"Documentation",workflow:"Workflow",analysis:"Clinical Analysis"},F={emr:Ha,documentation:Et,workflow:Ke,analysis:Gt};return l?t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:v,className:"flex items-center text-blue-600 hover:text-blue-700",children:t.jsx(ln,{className:"w-4 h-4 mr-1"})}),t.jsx(Me,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Investigation Summary"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Choose how to add your summary"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 gap-3",children:Qr.map(x=>t.jsxs("button",{onClick:()=>g(x),disabled:r==="investigation-summary",className:`
                  glass-button p-4 rounded-lg text-left transition-all hover:bg-gray-50 border-2 border-transparent hover:border-blue-200 btn-micro-press btn-micro-hover shadow-none
                  ${r==="investigation-summary"?"opacity-50 cursor-not-allowed":""}
                `,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(x.icon,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:x.label}),t.jsx("div",{className:"text-gray-600 text-xs leading-tight",children:x.description})]}),t.jsx(Wt,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]}),r==="investigation-summary"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx(Ft,{})})]},x.id))})}),t.jsx("div",{className:"p-4 bg-gray-50",children:t.jsxs("p",{className:"text-gray-600 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Dictate uses AI to format your speech, Type opens the field for manual entry"]})})]}):s?t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:v,className:"flex items-center text-blue-600 hover:text-blue-700",children:t.jsx(ln,{className:"w-4 h-4 mr-1"})}),t.jsx(bt,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Appointment Wrap-up Presets"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Choose a preset to apply"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 gap-3",children:Kr.map(x=>t.jsxs("button",{onClick:()=>f(x),disabled:r==="appointment-wrap-up",className:`
                  glass-button p-4 rounded-lg text-left transition-all hover:bg-gray-50 border-2 border-transparent hover:border-blue-200 btn-micro-press btn-micro-hover shadow-none
                  ${r==="appointment-wrap-up"?"opacity-50 cursor-not-allowed":""}
                `,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(bt,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:x.displayName}),t.jsxs("div",{className:"text-gray-600 text-xs mb-2",children:[t.jsx("span",{className:"font-medium",children:"Item Code:"})," ",x.itemCode]}),t.jsxs("div",{className:"text-gray-600 text-xs leading-tight",children:[t.jsx("span",{className:"font-medium",children:"Notes:"}),' "',x.notes,'"']})]}),t.jsx(Wt,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]}),r==="appointment-wrap-up"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx(Ft,{})})]},x.id))})}),t.jsx("div",{className:"p-4 bg-gray-50",children:t.jsxs("p",{className:"text-gray-600 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Presets will automatically fill the Item Code and Appointment Notes fields"]})})]}):a?t.jsxs("div",{className:"bg-white",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx(Ke,{className:"w-3 h-3 text-blue-600"}),t.jsx("h3",{className:"text-gray-900 font-medium text-xs",children:"Quick Actions"})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[k.map(x=>pt[x.id]?t.jsx(yn,{config:pt[x.id],onStartWorkflow:e,onQuickAction:n,processingAction:r,isFooter:!0},x.id):t.jsxs("button",{onClick:()=>{console.log("ðŸ”§ Button clicked:",x.id,"at",new Date().toISOString()),m(x.id)},disabled:r===x.id,className:`
                  relative p-2 rounded-2xl transition-all duration-150 text-left micro-press micro-lift min-h-10 flex items-center
                  hover:bg-surface-primary hover:border hover:border-line-primary hover:shadow-sm
                  ${x.category==="analysis"?"hover:border-accent-violet/30":""}
                  ${r===x.id?"opacity-50 cursor-not-allowed":""}
                `,children:[t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx(x.icon,{className:`w-3 h-3 flex-shrink-0 ${x.category==="analysis"?"text-accent-violet":"text-accent-emerald"}`}),t.jsx("div",{className:"text-ink-primary text-[10px] font-medium leading-tight min-w-0 flex-1",children:x.label})]}),r===x.id&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx(kt,{})})]},x.id)),t.jsx("div",{className:"relative rounded-2xl min-h-10 flex transition-all duration-150 hover:bg-surface-primary hover:border hover:border-accent-violet/30",children:t.jsx("div",{className:"flex h-full",children:Jr.map((x,y)=>t.jsxs("button",{onClick:()=>{console.log("ðŸ”§ AI Button clicked:",x.id,"at",new Date().toISOString()),m(x.id)},disabled:r===x.id,className:`
                    flex-1 relative p-1 transition-all text-left micro-press micro-lift
                    ${y===0?"rounded-l-2xl border-r border-line-primary":"rounded-r-2xl"}
                    hover:bg-surface-tertiary
                    ${r===x.id?"opacity-50 cursor-not-allowed":""}
                  `,children:[t.jsxs("div",{className:"flex items-center justify-center flex-col space-y-0.5",children:[t.jsx(x.icon,{className:"w-3 h-3 flex-shrink-0 text-accent-violet"}),t.jsx("div",{className:"text-ink-primary text-[9px] font-medium leading-tight text-center",children:x.id==="ai-medical-review"?"AI Review":"Batch AI"})]}),r===x.id&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-surface-tertiary rounded-lg",children:t.jsx(kt,{})})]},x.id))})})]})]}):t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ke,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Quick Actions"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"EMR shortcuts and workflows"})]})]})}),t.jsxs("div",{children:[Object.entries(I).map(([x,y])=>{const j=F[x];return t.jsxs("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx(j,{className:"w-4 h-4 text-gray-500"}),t.jsx("h4",{className:"text-gray-700 text-xs font-medium uppercase tracking-wide",children:T[x]})]}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:y.map(C=>pt[C.id]?t.jsx(yn,{config:pt[C.id],onStartWorkflow:e,onQuickAction:n,processingAction:r,isFooter:!1},C.id):t.jsxs("button",{onClick:()=>m(C.id),disabled:r===C.id,className:`
                          p-3 rounded-2xl text-left transition-all duration-150 micro-press micro-lift
                          hover:bg-surface-primary hover:border hover:border-line-primary hover:shadow-sm
                          ${C.category==="analysis"?"hover:border-accent-violet/30":""}
                          ${r===C.id?"opacity-50 cursor-not-allowed":""}
                        `,children:[t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(C.icon,{className:`w-4 h-4 mt-0.5 flex-shrink-0 ${C.category==="analysis"?"text-accent-violet":"text-accent-emerald"}`}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-ink-primary text-xs font-medium truncate",children:C.label}),t.jsx("div",{className:"text-ink-secondary text-xs mt-1 leading-tight",children:C.description})]})]}),r===C.id&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx(Ft,{})})]},C.id))})]},x)}),t.jsx("div",{className:"p-4 bg-surface-tertiary",children:t.jsxs("p",{className:"text-ink-secondary text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Quick actions provide fast access to EMR fields and workflows"]})})]})]})});ma.displayName="QuickActions";const wn=[{id:"ai-medical-review",label:"AI Medical Review",icon:Hn,description:"Australian clinical oversight and guidelines review (analyzes existing EMR data)"},{id:"batch-ai-review",label:"Batch AI Review",icon:Le,description:"AI review for multiple patients from appointment book"}],Zr=({onQuickAction:n,processingAction:e,isFooter:a=!1})=>{const[r,i]=d.useState(null),s=async(l,c)=>{if(l==="ai-medical-review"){i(l),console.log("ðŸ¤– AI Medical Review action triggered...");try{console.log("ðŸ“‹ EMR EXTRACTION: Starting EMR data extraction via service worker...");const m=await new Promise(p=>{console.log("ðŸ“‹ EMR EXTRACTION: Sending EXTRACT_EMR_DATA_AI_REVIEW message to service worker"),chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA_AI_REVIEW",fields:["background","investigations","medications-problemlist"]},h=>{if(console.log("ðŸ“‹ EMR EXTRACTION: Response from service worker:",h),chrome.runtime.lastError){console.error("ðŸ“‹ EMR EXTRACTION: Chrome runtime error:",chrome.runtime.lastError),p({success:!1,error:`Chrome runtime error: ${chrome.runtime.lastError.message}`});return}if(!h){console.error("ðŸ“‹ EMR EXTRACTION: No response received from service worker"),p({success:!1,error:"No response from service worker"});return}p(h)})});if(m.success&&m.data){const p=m.data;if(console.log("ðŸ“‹ EMR EXTRACTION: Successfully received data:",p),Object.entries(p).filter(([f,g])=>g&&typeof g=="string"&&g.trim().length>0).length===0)throw new Error("No EMR data found. Please ensure you're on a patient page with clinical data.");const u=`
Background: ${p.background||"No background data available"}

Investigations: ${p.investigations||"No investigations data available"}

Medications: ${p["medications-problemlist"]||"No medications data available"}
          `.trim();console.log("ðŸ“‹ EMR EXTRACTION: Processing EMR data for AI review"),await n(l,{emrData:p,formattedInput:u,type:"australian-medical-review"}),console.log("âœ… AI Medical Review completed successfully")}else{const p=m.error||"Unknown extraction error";throw new Error(`Failed to extract EMR data: ${p}`)}}catch(m){console.error("âŒ AI Medical Review failed:",m);const p=m instanceof Error?m.message:"Unknown error";console.error("AI Review Error:",p),typeof window<"u"&&alert(`AI Medical Review Error

${p}`)}finally{i(null)}return}try{i(l),console.log("âš¡ Calling onQuickAction for AI Review..."),await n(l,c),console.log("âš¡ AI Review onQuickAction completed successfully")}catch(m){console.error(`âŒ AI Review action ${l} failed:`,m)}finally{i(null)}},o=l=>e===l||r===l;return a?t.jsxs("div",{className:"bg-white",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Gt,{className:"w-3 h-3 text-indigo-600"}),t.jsx("h3",{className:"text-gray-900 font-medium text-xs",children:"AI Medical Review"})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:wn.map(l=>t.jsxs("button",{onClick:()=>s(l.id),disabled:o(l.id),className:`
                glass-button relative p-2 rounded-lg transition-all text-center btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(l.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[t.jsx(l.icon,{className:"w-3 h-3 text-indigo-600 flex-shrink-0"}),t.jsx("div",{className:"text-gray-900 text-xs font-medium leading-tight",children:l.label})]}),o(l.id)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:t.jsx(kt,{})})]},l.id))})]}):t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Gt,{className:"w-5 h-5 text-indigo-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"AI Medical Review"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Clinical analysis and guidelines review"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 gap-3",children:wn.map(l=>t.jsxs("button",{onClick:()=>s(l.id),disabled:o(l.id),className:`
                glass-button p-3 rounded-lg text-left transition-all btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(l.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(l.icon,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-indigo-600"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-xs font-medium truncate",children:l.label}),t.jsx("div",{className:"text-gray-600 text-xs mt-1 leading-tight",children:l.description})]})]}),o(l.id)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:t.jsx(kt,{})})]},l.id))})}),t.jsx("div",{className:"p-4 bg-indigo-50",children:t.jsxs("p",{className:"text-indigo-700 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Note:"})," AI Review uses MedGemma-27b for comprehensive clinical analysis"]})})]})},ua=n=>{const{isOpen:e,offset:a={x:0,y:8},alignment:r="right",maxHeight:i=320}=n,s=d.useRef(null),o=d.useRef(null),[l,c]=d.useState({top:0,left:0}),m=d.useCallback(()=>{if(!s.current||!e)return;const p=s.current.getBoundingClientRect(),h={width:window.innerWidth,height:window.innerHeight};let u=p.bottom+a.y,f=p.left+a.x,g;r==="right"?(f=p.right-280,g=h.width-p.right+a.x):r==="center"&&(f=p.left+p.width/2-140),f<8?(f=8,g=void 0):f+280>h.width-8&&(f=h.width-280-8,g=8);const v=h.height-p.bottom-8,k=p.top-8;let I=i;v<i&&k>v?(u=p.top-i-a.y,I=Math.min(i,k)):I=Math.min(i,v),c({top:u,left:g!==void 0?void 0:f,right:g,maxHeight:I})},[e,a,r,i]);return d.useEffect(()=>{if(e){m();const p=()=>m(),h=()=>m();return window.addEventListener("resize",p),window.addEventListener("scroll",h,!0),()=>{window.removeEventListener("resize",p),window.removeEventListener("scroll",h,!0)}}},[e,m]),{triggerRef:s,dropdownRef:o,position:l,calculatePosition:m}},ei=(n="portal-root")=>{const e=d.useRef(null);return d.useEffect(()=>{let a=document.getElementById(n);return a||(a=document.createElement("div"),a.id=n,a.style.position="relative",a.style.zIndex="999999",a.style.pointerEvents="none",document.body.appendChild(a)),e.current=a,()=>{a&&a.children.length===0&&document.body.removeChild(a)}},[n]),e.current},an=({isOpen:n,children:e,onClickOutside:a})=>{const r=ei("dropdown-portal");return d.useEffect(()=>{if(!n||!a)return;const i=o=>{const l=o.target;!l.closest("[data-dropdown-menu]")&&!l.closest("[data-dropdown-trigger]")&&a()},s=setTimeout(()=>{document.addEventListener("mousedown",i)},0);return()=>{clearTimeout(s),document.removeEventListener("mousedown",i)}},[n,a]),!n||!r?null:Gn.createPortal(t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:50},children:t.jsx("div",{style:{pointerEvents:"auto"},children:e})}),r)},Lt=[{id:"quick-letter",label:"Quick Letter",description:"Medical correspondence and consultation letters",agent:"QuickLetterAgent",icon:"FileText",color:"green",category:"documentation",estimatedTime:"1-3 min",complexity:"low"},{id:"consultation",label:"Consultation",description:"Comprehensive patient assessments",agent:"ConsultationAgent",icon:"Stethoscope",color:"blue",category:"documentation",estimatedTime:"2-4 min",complexity:"medium"},{id:"angiogram-pci",label:"Angiogram/PCI",description:"Cardiac catheterization and coronary interventions",agent:"AngiogramPCIAgent",icon:"Heart",color:"red",category:"procedure",estimatedTime:"8-15 min",complexity:"high"},{id:"tavi",label:"TAVI Report",description:"Transcatheter aortic valve implantation",agent:"TAVIAgent",icon:"CircleDot",color:"red",category:"procedure",estimatedTime:"8-12 min",complexity:"high"},{id:"mteer",label:"mTEER Report",description:"Mitral transcatheter edge-to-edge repair",agent:"MTEERAgent",icon:"Zap",color:"purple",category:"procedure",estimatedTime:"7-10 min",complexity:"high"},{id:"pfo-closure",label:"PFO Closure",description:"Patent foramen ovale closure",agent:"PFOClosureAgent",icon:"Shield",color:"green",category:"procedure",estimatedTime:"5-8 min",complexity:"medium"},{id:"right-heart-cath",label:"Right Heart Cath",description:"Right heart catheterisation with haemodynamic assessment",agent:"RightHeartCathAgent",icon:"Activity",color:"orange",category:"procedure",estimatedTime:"6-10 min",complexity:"medium"}],ti={Heart:xr,FileText:Pt,Activity:br,Stethoscope:vr,CircleDot:yr,Mic:Qn,Square:Ie,Search:kr,User:jr,Pill:Nr,Shield:Sr},pa=d.memo(({onWorkflowSelect:n,activeWorkflow:e,isRecording:a,disabled:r=!1,voiceActivityLevel:i=0,recordingTime:s=0,whisperServerRunning:o=!0})=>{const[l,c]=d.useState(!1),[m,p]=d.useState(!1),h=d.useRef(null),u=d.useRef(!1),f=d.useRef(null),g=d.useRef(`record-menu-${Math.random().toString(36).slice(2)}`),{triggerRef:v,position:k}=ua({isOpen:l,alignment:"center",offset:{x:0,y:8},maxHeight:400}),I=P=>{const $=Math.floor(P/60),b=P%60;return`${$}:${b.toString().padStart(2,"0")}`},T=()=>{r||(console.log("ðŸ–±ï¸ Mouse entered record button"),u.current=!0,p(!0),h.current&&(window.clearTimeout(h.current),h.current=null),l||(h.current=window.setTimeout(()=>{u.current&&(console.log("ðŸŽ¯ Expanding card after hover delay"),c(!0))},50)))},F=()=>{console.log("ðŸ–±ï¸ Mouse left record button"),u.current=!1,p(!1),h.current&&(window.clearTimeout(h.current),h.current=null),h.current=window.setTimeout(()=>{u.current||(console.log("ðŸ”½ Collapsing card - mouse completely away"),c(!1))},150)},x=()=>{console.log("ðŸ–±ï¸ Mouse entered card"),u.current=!0,p(!0),h.current&&(window.clearTimeout(h.current),h.current=null)},y=()=>{console.log("ðŸ–±ï¸ Mouse left card"),u.current=!1,p(!1),h.current=window.setTimeout(()=>{u.current||(console.log("ðŸ”½ Collapsing card - mouse left card area"),c(!1))},150)};d.useEffect(()=>{!a&&e&&window.setTimeout(()=>{c(!1),p(!1),u.current=!1},1e3)},[a,e]),d.useEffect(()=>()=>{h.current&&(window.clearTimeout(h.current),h.current=null)},[]);const j=()=>{const P="relative flex items-center justify-center transition-all duration-300 cursor-pointer w-11 h-11 rounded-full border-2";return r?`${P} bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed`:a?`${P} bg-red-500 border-red-600 record-button-recording text-white shadow-lg`:`${P} bg-emerald-100 border-emerald-300 record-button-idle text-emerald-600 hover:bg-emerald-200 hover:border-emerald-400`},C=(P,$)=>{const b="relative w-full h-12 rounded-lg border-2 flex items-center justify-start font-medium transition-all duration-200 overflow-hidden hover:shadow-md";if(r||!o)return`${b} glass-button border-gray-300 opacity-50 cursor-not-allowed`;if($&&a){const S=P.category==="procedure"?"procedure-card":P.category==="documentation"?"documentation-card":"investigation-card";return`${b} ${S} recording-glow border-2`}const N=P.category==="procedure"?"btn-procedure-outline":P.category==="documentation"?"btn-documentation-outline":"btn-investigation-outline";return`${b} ${N} border-2 btn-hover-enhanced`},w=P=>{const $=ti[P.icon]||Pt,b=e===P.id,N=()=>o?`${P.description} â€¢ ${P.estimatedTime} â€¢ ${P.complexity} complexity`:"Whisper server not running. Please start server: ./start-whisper-server.sh";return t.jsx("button",{onClick:()=>n(P.id),disabled:r||a&&!b||!o,className:C(P,b),title:N(),tabIndex:0,children:t.jsxs("div",{className:"relative flex items-center justify-start w-full h-full px-3 py-2",children:[t.jsx("div",{className:"relative flex-shrink-0 mr-3",children:b&&a?t.jsxs(t.Fragment,{children:[t.jsx(Ie,{className:"w-5 h-5"}),t.jsx("div",{className:"absolute inset-0 rounded-full bg-red-500/20 motion-safe:animate-ping"})]}):t.jsx($,{className:"w-5 h-5"})}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("span",{className:`text-sm font-semibold ${b&&a?"text-red-700 font-bold":""}`,children:b&&a?"Complete Recording":P.label}),t.jsx("div",{className:`text-xs mt-0.5 ${b&&a?"text-red-600":"text-gray-500"}`,children:b&&a?I(s):P.estimatedTime})]}),b&&a&&t.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:t.jsx("div",{className:"w-6 h-0.5 rounded-full transition-all duration-150",style:{backgroundColor:i>.1?"#10b981":"#e5e7eb",opacity:.3+i*.7}})})]})},P.id)},E=P=>{r||(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),c($=>!$))};d.useEffect(()=>{if(l){const P=f.current;P&&setTimeout(()=>{const $=P.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');$.length>0&&$[0].focus()},0)}},[l]);const A=P=>{if(l){if(P.key==="Escape"){P.stopPropagation(),c(!1),p(!1),v.current?.focus?.();return}if(P.key==="Tab"){const $=f.current;if(!$)return;const b=Array.from($.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(M=>!M.hasAttribute("disabled"));if(b.length===0)return;const N=b[0],S=b[b.length-1];P.shiftKey?document.activeElement===N&&(P.preventDefault(),S.focus()):document.activeElement===S&&(P.preventDefault(),N.focus())}}};return t.jsxs("div",{className:"relative",children:[t.jsxs("button",{ref:v,type:"button","data-dropdown-trigger":!0,onMouseEnter:T,onMouseLeave:F,onClick:()=>!r&&c(P=>!P),onKeyDown:E,"aria-haspopup":"dialog","aria-expanded":l,"aria-controls":g.current,"aria-label":a?"Recording menu, recording in progress":"Open recording menu",className:j(),disabled:r,children:[t.jsx(Wa,{className:`w-5 h-5 ${a?"fill-current":""}`}),a&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-red-300 motion-safe:animate-ping opacity-40"}),t.jsx("div",{className:"absolute inset-0 rounded-full border-1 border-white opacity-60"})]})]}),t.jsx(an,{isOpen:l,onClickOutside:()=>{console.log("ðŸ–±ï¸ Click outside detected - closing card"),c(!1),p(!1),u.current=!1},children:t.jsxs("div",{"data-dropdown-menu":!0,id:g.current,role:"dialog","aria-labelledby":`${g.current}-label`,ref:f,onKeyDown:A,onMouseEnter:x,onMouseLeave:y,className:"record-card glass rounded-xl p-4 w-[390px] bg-white border border-gray-200 shadow-xl",style:{position:"fixed",top:k.top,left:k.left,zIndex:999999},children:[t.jsxs("div",{className:"mb-3 text-center",children:[t.jsx("h2",{id:`${g.current}-label`,className:"text-gray-900 text-base font-semibold",children:"Record Now"}),t.jsx("p",{className:"text-gray-600 text-sm",children:a?`Recording ${Lt.find(P=>P.id===e)?.label}...`:"Choose the type of medical report to create"})]}),t.jsx("div",{className:"flex flex-col gap-2 mb-3",children:Lt.map(w)}),!a&&t.jsx("div",{className:"text-center text-gray-500 text-sm",children:o?t.jsx("p",{children:"Tap workflow to start recording"}):t.jsxs("p",{className:"text-red-600 font-medium flex items-center justify-center gap-2",children:[t.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-red-500","aria-hidden":"true"})," Whisper server not running - Please start server first"]})}),a&&e&&t.jsxs("div",{className:"glass rounded-lg p-2 text-center bg-red-50 border border-red-200",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full motion-safe:animate-pulse"}),t.jsxs("span",{className:"text-red-800 text-xs font-bold",children:["Recording ",Lt.find(P=>P.id===e)?.label]})]}),t.jsxs("p",{className:"text-red-700 text-sm font-medium flex items-center justify-center gap-2",children:[i>.1?t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx(Qn,{className:"w-3.5 h-3.5"})," Listening..."]}):t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx(Ie,{className:"w-3.5 h-3.5"})," Speak now"]})," â€¢ Tap ",t.jsx("strong",{children:"Complete"})," when done"]})]})]})})]})});pa.displayName="RecordPanel";const kn=({session:n,onRemoveSession:e,showRemoveButton:a=!1,isCompact:r=!1})=>{const i=o=>new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),s=o=>t.jsx(Et,{className:"w-4 h-4"});return r?t.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-blue-50 rounded-lg border border-blue-200",children:[t.jsx(xt,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-semibold text-blue-900 truncate",children:n.patient.name}),t.jsx("span",{className:"text-xs text-blue-600 font-medium",children:n.agentName||n.agentType})]}),t.jsxs("div",{className:"flex items-center space-x-2 mt-1 text-xs text-blue-700",children:[t.jsxs("span",{children:["ID: ",n.patient.id]}),t.jsx("span",{children:"â€¢"}),t.jsx("span",{children:i(n.timestamp)})]})]}),a&&e&&t.jsx("button",{onClick:()=>e(n.id),className:"p-1 text-blue-600 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Remove session",children:t.jsx(xe,{className:"w-4 h-4"})})]}):t.jsx("div",{className:"glass rounded-xl p-4 border-l-4 border-blue-500",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(xt,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:n.patient.name}),t.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s(n.agentType),t.jsx("span",{className:"text-sm text-blue-600 font-medium",children:n.agentName||n.agentType})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-700 mb-3",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"ID:"})," ",n.patient.id]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Age:"})," ",n.patient.age]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"DOB:"})," ",n.patient.dob]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Ye,{className:"w-3 h-3"}),t.jsx("span",{children:i(n.timestamp)})]})]}),(n.patient.phone||n.patient.medicare)&&t.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[n.patient.phone&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(Ga,{className:"w-3.5 h-3.5"})," ",n.patient.phone]}),n.patient.medicare&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(Va,{className:"w-3.5 h-3.5"})," Medicare: ",n.patient.medicare]})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[n.completed&&t.jsx("div",{className:"text-green-600 bg-green-100 px-2 py-1 rounded-full text-xs font-medium",children:"âœ“ Complete"}),a&&e&&t.jsx("button",{onClick:()=>e(n.id),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove session",children:t.jsx(xe,{className:"w-4 h-4"})})]})]})})},ha=d.memo(({sessions:n,onRemoveSession:e,onClearAllSessions:a,onSessionSelect:r,isOpen:i,onClose:s,triggerRef:o,position:l})=>{if(!i||n.length===0)return null;const c=n.filter(v=>v.completed),m=n.filter(v=>!v.completed),p=v=>{r&&r(v),s()},h=v=>{e(v)},u=()=>{a(),s()},f=()=>{if(l)return{position:"absolute",top:l.top,left:l.left,right:l.right,width:"320px",maxHeight:"384px",zIndex:999999};if(o?.current){const v=o.current.getBoundingClientRect();return{position:"absolute",top:v.bottom+8,right:window.innerWidth-v.right,width:"320px",maxHeight:"384px",zIndex:999999}}return{position:"fixed",top:"60px",right:"16px",width:"320px",maxHeight:"384px",zIndex:999999}},g=t.jsxs("div",{style:f(),className:"bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden","data-dropdown-menu":!0,children:[t.jsx("div",{className:"p-3 border-b border-gray-100 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Le,{className:"w-4 h-4 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Recent Sessions"}),t.jsxs("p",{className:"text-gray-600 text-xs",children:[n.length," session",n.length!==1?"s":""," â€¢ ",c.length," completed"]})]})]}),n.length>0&&t.jsx("button",{onClick:u,className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear all sessions",children:t.jsx(Tt,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[m.length>0&&t.jsxs("div",{className:"p-2",children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx(Ye,{className:"w-3 h-3 text-amber-600"}),t.jsx("span",{className:"text-xs font-medium text-amber-700",children:"In Progress"})]}),t.jsx("div",{className:"space-y-2",children:m.map(v=>t.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>p(v),children:t.jsx(kn,{session:v,onRemoveSession:h,showRemoveButton:!0,isCompact:!0})},v.id))})]}),c.length>0&&t.jsxs("div",{className:`p-2 ${m.length>0?"border-t border-gray-100":""}`,children:[m.length>0&&t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full flex-shrink-0"}),t.jsx("span",{className:"text-xs font-medium text-emerald-700",children:"Completed"})]}),t.jsx("div",{className:"space-y-2",children:c.slice(0,5).map(v=>t.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>p(v),children:t.jsx(kn,{session:v,onRemoveSession:h,showRemoveButton:!0,isCompact:!0})},v.id))}),c.length>5&&t.jsxs("div",{className:"text-xs text-gray-500 text-center mt-2 px-2",children:["And ",c.length-5," more completed session",c.length-5!==1?"s":"","..."]})]})]}),n.length===0&&t.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No recent sessions"})]});return t.jsx(an,{isOpen:i,onClickOutside:s,children:g})});ha.displayName="SessionDropdown";class oe{static instance;toasts=[];listeners=new Set;autoRemoveTimers=new Map;constructor(){}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}subscribe(e){return this.listeners.add(e),e([...this.toasts]),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{e([...this.toasts])})}show(e){const a=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r={...e,id:a,timestamp:Date.now(),duration:e.duration??(e.type==="error"?8e3:5e3)};if(this.toasts.unshift(r),this.toasts.length>5&&this.toasts.splice(5).forEach(s=>{const o=this.autoRemoveTimers.get(s.id);o&&(clearTimeout(o),this.autoRemoveTimers.delete(s.id))}),this.notifyListeners(),r.duration&&r.duration>0){const i=window.setTimeout(()=>{this.remove(a)},r.duration);this.autoRemoveTimers.set(a,i)}return a}remove(e){const a=this.toasts.findIndex(r=>r.id===e);if(a!==-1){this.toasts.splice(a,1);const r=this.autoRemoveTimers.get(e);r&&(clearTimeout(r),this.autoRemoveTimers.delete(e)),this.notifyListeners()}}clear(){this.autoRemoveTimers.forEach(e=>clearTimeout(e)),this.autoRemoveTimers.clear(),this.toasts=[],this.notifyListeners()}success(e,a,r){return this.show({type:"success",title:e,message:a,duration:r})}error(e,a,r){return this.show({type:"error",title:e,message:a,duration:r})}warning(e,a,r){return this.show({type:"warning",title:e,message:a,duration:r})}info(e,a,r){return this.show({type:"info",title:e,message:a,duration:r})}}const ni=n=>{const e=n.find(s=>s.deviceId==="default");if(e)return e;const a=n.find(s=>s.label.toLowerCase().includes("built-in")||s.label.toLowerCase().includes("internal")||s.label.toLowerCase().includes("macbook"));if(a)return a;const r=n.find(s=>s.deviceId!=="default"&&s.label&&!s.label.includes("Microphone ")&&!rn(s.label));if(r)return r;const i=n.find(s=>s.deviceId!=="default");return i||n[0]},ai=n=>{const e=n.find(s=>s.deviceId==="default");if(e)return e;const a=n.find(s=>s.label.toLowerCase().includes("built-in")||s.label.toLowerCase().includes("internal")||s.label.toLowerCase().includes("macbook"));if(a)return a;const r=n.find(s=>s.deviceId!=="default"&&s.label&&!s.label.includes("Speaker ")&&!rn(s.label));if(r)return r;const i=n.find(s=>s.deviceId!=="default");return i||n[0]},rn=n=>{const e=n.toLowerCase();return["iphone","ipad","airpods","bluetooth","wireless","headphones","headset","earbuds","watch"].some(r=>e.includes(r))},jn=(n,e,a)=>{if(n.deviceId==="default")return"system default device";const r=n.label.toLowerCase();return r.includes("built-in")||r.includes("internal")||r.includes("macbook")?"built-in device":rn(n.label)?n.deviceId!=="default"?"non-default device fallback":"first available device":"preferred non-mobile device"},ri=()=>{const[n,e]=d.useState([]),[a,r]=d.useState([]),[i,s]=d.useState(!0),[o,l]=d.useState(!1),{selectedMicrophoneId:c,selectedSpeakerId:m,microphoneSelectionType:p,speakerSelectionType:h,setSelectedMicrophoneId:u,setSelectedSpeakerId:f}=Kn(),g=d.useCallback(async()=>{try{s(!0);const j=(await navigator.permissions.query({name:"microphone"})).state==="granted";l(j);const C=await navigator.mediaDevices.enumerateDevices(),w=C.filter(A=>A.kind==="audioinput").map(A=>({deviceId:A.deviceId,label:A.label||`Microphone ${A.deviceId.slice(0,8)}`,groupId:A.groupId,kind:"audioinput"})),E=C.filter(A=>A.kind==="audiooutput").map(A=>({deviceId:A.deviceId,label:A.label||`Speaker ${A.deviceId.slice(0,8)}`,groupId:A.groupId,kind:"audiooutput"}));if(e(w),r(E),w.length>0&&(!c||p==="auto")){let A=null;if(p==="auto")try{const P=localStorage.getItem("xestro-preferred-microphone");P&&(A=w.find($=>$.deviceId===P)||null,A&&console.log("ðŸŽ¤ Using saved microphone preference:",A.label))}catch(P){console.warn("Failed to read microphone preference:",P)}A||(A=ni(w),console.log("ðŸŽ¤ Auto-selected microphone:",{deviceId:A.deviceId,label:A.label,selectionReason:jn(A,w,"microphone")})),u(A.deviceId,!1)}if(E.length>0&&(!m||h==="auto")){let A=null;if(h==="auto")try{const P=localStorage.getItem("xestro-preferred-speaker");P&&(A=E.find($=>$.deviceId===P)||null,A&&console.log("ðŸ”Š Using saved speaker preference:",A.label))}catch(P){console.warn("Failed to read speaker preference:",P)}A||(A=ai(E),console.log("ðŸ”Š Auto-selected speaker:",{deviceId:A.deviceId,label:A.label,selectionReason:jn(A,E,"speaker")})),f(A.deviceId,!1)}console.log("ðŸŽ¤ Audio devices enumerated:",{microphones:w.length,speakers:E.length})}catch(y){console.error("ðŸŽ¤ Failed to enumerate audio devices:",y)}finally{s(!1)}},[c,m,p,h]),v=d.useCallback(async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(j=>j.stop()),l(!0),await g()}catch(y){console.error("ðŸŽ¤ Failed to get microphone permission:",y),l(!1)}},[g]),k=d.useCallback(y=>{console.log("ðŸŽ¤ Manually selecting microphone:",y),u(y,!0)},[u]),I=d.useCallback(y=>{console.log("ðŸ”Š Manually selecting speaker:",y),f(y,!0)},[f]),T=d.useCallback(()=>{if(!c)return"No microphone";const y=n.find(j=>j.deviceId===c);return y?y.label:c==="default"?"Default microphone":"Unknown microphone"},[c,n]),F=d.useCallback(()=>{if(!m)return"No speaker";const y=a.find(j=>j.deviceId===m);return y?y.label:m==="default"?"Default speaker":"Unknown speaker"},[m,a]),x=d.useCallback(async()=>{await g()},[g]);return d.useEffect(()=>{g();const y=()=>{console.log("ðŸŽ¤ Audio devices changed, re-enumerating..."),g()};return navigator.mediaDevices.addEventListener("devicechange",y),()=>{navigator.mediaDevices.removeEventListener("devicechange",y)}},[g]),{microphones:n,speakers:a,selectedMicrophoneId:c,selectedSpeakerId:m,isLoading:i,hasPermission:o,setSelectedMicrophone:k,setSelectedSpeaker:I,requestPermission:v,refreshDevices:x,getCurrentMicrophoneLabel:T,getCurrentSpeakerLabel:F}},ii=({disabled:n=!1})=>{const{microphones:e,speakers:a,selectedMicrophoneId:r,selectedSpeakerId:i,setSelectedMicrophone:s,setSelectedSpeaker:o,getCurrentMicrophoneLabel:l,getCurrentSpeakerLabel:c,isLoading:m,hasPermission:p,requestPermission:h}=ri(),[u,f]=d.useState(!1),[g,v]=d.useState(!1);Z.useEffect(()=>{const T=F=>{F.target.closest("[data-audio-dropdown]")||(f(!1),v(!1))};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const k=T=>{T.kind==="audioinput"?(s(T.deviceId),f(!1)):(o(T.deviceId),v(!1))},I=(T,F=15)=>T.length<=F?T:T.substring(0,F-1)+"â€¦";return m?t.jsx("div",{className:"text-gray-500 text-[10px]",children:"Loading devices..."}):p?t.jsxs("div",{className:"flex items-center space-x-2 text-[10px]","data-audio-dropdown":!0,children:[t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>!n&&f(!u),disabled:n,className:`
            flex items-center space-x-1 text-gray-500 hover:text-gray-700 transition-colors
            ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,title:`Current microphone: ${l()}`,children:[t.jsx("span",{children:"ðŸŽ¤"}),t.jsx("span",{className:"max-w-[80px] truncate",children:I(l(),20)}),t.jsx(at,{className:`w-2 h-2 transition-transform ${u?"transform rotate-180":""}`})]}),u&&!n&&e.length>0&&t.jsx("div",{className:"absolute top-full left-0 mt-1 z-[9998] bg-white border border-gray-200 rounded-md shadow-lg min-w-[200px] max-w-[250px]",children:t.jsx("div",{className:"py-1",children:e.map(T=>t.jsxs("button",{onClick:()=>k(T),className:`
                    w-full px-3 py-1.5 text-left text-xs hover:bg-gray-50 
                    transition-colors flex items-center space-x-2
                    ${r===T.deviceId?"bg-blue-50 text-blue-900":"text-gray-800"}
                  `,children:[t.jsx(Se,{className:`w-3 h-3 ${r===T.deviceId?"text-blue-600":"text-gray-400"}`}),t.jsx("span",{className:"truncate",children:T.label}),r===T.deviceId&&t.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full ml-auto flex-shrink-0"})]},T.deviceId))})})]}),t.jsx("span",{className:"text-gray-400",children:"â€¢"}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>!n&&v(!g),disabled:n,className:`
            flex items-center space-x-1 text-gray-500 hover:text-gray-700 transition-colors
            ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,title:`Current speaker: ${c()}`,children:[t.jsx("span",{children:"ðŸ”Š"}),t.jsx("span",{className:"max-w-[80px] truncate",children:I(c(),20)}),t.jsx(at,{className:`w-2 h-2 transition-transform ${g?"transform rotate-180":""}`})]}),g&&!n&&a.length>0&&t.jsx("div",{className:"absolute top-full left-0 mt-1 z-[9998] bg-white border border-gray-200 rounded-md shadow-lg min-w-[200px] max-w-[250px]",children:t.jsx("div",{className:"py-1",children:a.map(T=>t.jsxs("button",{onClick:()=>k(T),className:`
                    w-full px-3 py-1.5 text-left text-xs hover:bg-gray-50 
                    transition-colors flex items-center space-x-2
                    ${i===T.deviceId?"bg-blue-50 text-blue-900":"text-gray-800"}
                  `,children:[t.jsx(Xa,{className:`w-3 h-3 ${i===T.deviceId?"text-blue-600":"text-gray-400"}`}),t.jsx("span",{className:"truncate",children:T.label}),i===T.deviceId&&t.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full ml-auto flex-shrink-0"})]},T.deviceId))})})]})]}):t.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-700 text-[10px] transition-colors",disabled:n,children:"Enable audio access"})},si={idle:{icon:Se,label:"Ready",description:"Ready to record",color:"text-ink-secondary",bgColor:"bg-surface-tertiary",animate:!1},recording:{icon:Se,label:"Recording",description:"Listening to your voice...",color:"text-accent-red",bgColor:"bg-surface-tertiary",animate:!1},transcribing:{icon:ze,label:"Transcribing",description:"Converting speech to text...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},classifying:{icon:vt,label:"Analyzing",description:"Determining the best medical agent...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},processing:{icon:en,label:"Processing",description:"Generating medical report...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},enhancing:{icon:vt,label:"Enhancing",description:"Refining medical content...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},complete:{icon:ot,label:"Complete",description:"Medical report generated successfully",color:"text-accent-emerald",bgColor:"bg-surface-tertiary",animate:!1},error:{icon:nn,label:"Error",description:"Something went wrong. Click any workflow to restart.",color:"text-accent-red",bgColor:"bg-surface-tertiary",animate:!1},cancelled:{icon:xe,label:"Cancelled",description:"Recording cancelled. Click any workflow to start again.",color:"text-ink-secondary",bgColor:"bg-surface-tertiary",animate:!1},cancelling:{icon:ze,label:"Cancelling",description:"Cancelling operation...",color:"text-accent-amber",bgColor:"bg-surface-tertiary",animate:!0}},oi={tavi:"TAVI Agent","angiogram-pci":"Angiogram/PCI Agent","quick-letter":"Quick Letter Agent",consultation:"Consultation Agent","investigation-summary":"Investigation Summary Agent",background:"Background Agent",medication:"Medication Agent",mteer:"MTEER Agent",tteer:"TTEER Agent","pfo-closure":"PFO Closure Agent","asd-closure":"ASD Closure Agent","right-heart-cath":"RHC Agent","pvl-plug":"PVL Plug Agent","bypass-graft":"Bypass Graft Agent","tavi-workup":"TAVI Workup Agent",enhancement:"Enhancement Agent",transcription:"Transcription Agent",generation:"Generation Agent","ai-medical-review":"AI Medical Review"},li=({status:n,currentAgent:e,onCompleteRecording:a,onCancelProcessing:r,isRecording:i=!1,modelStatus:s,onRefreshServices:o,onWorkflowSelect:l,activeWorkflow:c,voiceActivityLevel:m=0,recordingTime:p=0,isExtractingPatients:h=!1,patientSessions:u=[],onRemoveSession:f,onClearAllSessions:g,onSessionSelect:v,onShowMetrics:k,onNewRecording:I,showNewRecording:T=!1})=>{const F=si[n],x=h?ze:F.icon,[y,j]=d.useState(!1),[C,w]=d.useState(!1),[E,A]=d.useState(!1),{triggerRef:P,position:$}=ua({isOpen:y,alignment:"right",offset:{x:0,y:8},maxHeight:400});Z.useEffect(()=>{const R=L=>{L.key==="Escape"&&y&&j(!1)};if(y)return document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)},[y]),Z.useEffect(()=>{const R=L=>{E&&!L.target.closest(".relative")&&A(!1)};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[E]);const b=()=>h?"Extracting patient data from EMR...":n==="processing"&&e?e==="ai-medical-review"?"Analyzing clinical data against Australian guidelines...":`${oi[e]||e.toUpperCase()} is analyzing your input...`:F.description,N=()=>({idle:0,recording:20,transcribing:40,classifying:60,processing:80,enhancing:90,complete:100,error:0,cancelled:0,cancelling:0})[n],S=async()=>{w(!0);const R=oe.getInstance();try{await o();const L=s.isConnected,X=s.whisperServer?.running||!1;L&&X?R.success("Services Status","All AI services are running normally"):L||X?R.warning("Partial Service Status",`${L?"LMStudio connected":"LMStudio offline"}, ${X?"Whisper running":"Whisper stopped"}`):R.error("Services Offline","Both LMStudio and Whisper server are offline")}catch(L){R.error("Status Check Failed",L instanceof Error?L.message:"Failed to check service status")}finally{w(!1)}},M=()=>{const R=s.isConnected,L=s.whisperServer?.running||!1;return R&&L?"healthy":R||L?"partial":"offline"},D=R=>R===0?"N/A":R<1e3?`${R}ms`:`${(R/1e3).toFixed(1)}s`,O=()=>{if(!s.lastPing)return"Never";const L=Date.now()-s.lastPing;return L<6e4?"Just now":L<36e5?`${Math.floor(L/6e4)}m ago`:`${Math.floor(L/36e5)}h ago`};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`w-full h-16 ${F.bgColor} border-b border-white/20 px-4 py-3`,children:[t.jsxs("div",{className:"flex items-center justify-between h-full",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(pa,{onWorkflowSelect:l,activeWorkflow:c,isRecording:i,disabled:n==="processing"||n==="transcribing",voiceActivityLevel:m,recordingTime:p,whisperServerRunning:s.whisperServer?.running})}),t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx(x,{className:`w-5 h-5 ${F.color} ${F.animate||h?"motion-safe:animate-spin":""}`}),F.animate&&t.jsx("div",{className:`absolute inset-0 rounded-full border-2 ${F.color.replace("text-","border-")} motion-safe:animate-ping opacity-30`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"flex items-center space-x-2",children:t.jsx("h3",{className:`font-medium text-sm ${F.color}`,children:i?"Ready":F.label})}),t.jsx("p",{className:"text-ink-secondary text-xs mt-0.5 truncate",children:b()}),n==="idle"&&!i&&t.jsx("div",{className:"mt-1",children:t.jsx(ii,{disabled:!1})})]}),(n==="transcribing"||n==="processing"||n==="cancelling")&&r&&t.jsx("div",{className:"flex-shrink-0 ml-2",children:t.jsxs("button",{onClick:r,disabled:n==="cancelling",className:`px-2 py-1 text-xs font-medium rounded-md transition-all duration-200 flex items-center space-x-1 ${n==="cancelling"?"bg-orange-500/10 border border-orange-300 text-orange-600 cursor-not-allowed":"bg-red-500/10 border border-red-300 text-red-600 hover:bg-red-500/20 hover:border-red-400"}`,title:n==="transcribing"?"Cancel audio transcription":"Cancel AI report generation",children:[n==="cancelling"?t.jsx(ze,{className:"w-3 h-3 animate-spin"}):t.jsx(xe,{className:"w-3 h-3"}),t.jsx("span",{children:n==="cancelling"?"Cancelling...":"Cancel"})]})})]}),t.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[!i&&t.jsx("div",{className:"text-xs text-ink-secondary hidden md:block",children:D(s.latency)}),T&&I&&t.jsx("button",{onClick:I,disabled:i||["recording","transcribing","processing","enhancing","cancelling"].includes(n),className:`glass-button p-2 rounded-lg transition-all ${i||["recording","transcribing","processing","enhancing","cancelling"].includes(n)?"opacity-50 cursor-not-allowed bg-surface-tertiary":"hover:bg-green-50 hover:border-green-300 bg-surface-tertiary"}`,title:"Clear previous recording and start fresh",children:t.jsx(Ka,{className:`w-4 h-4 ${i||["recording","transcribing","processing","enhancing","cancelling"].includes(n)?"text-ink-secondary":"text-green-600"}`})}),u.length>0&&t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>A(!E),className:`glass-button p-2 rounded-lg transition-all bg-surface-tertiary hover:bg-surface-primary relative ${i?"scale-90":""}`,title:`${u.length} recent session${u.length!==1?"s":""}`,"data-dropdown-trigger":!0,children:[t.jsx(Qa,{className:"w-4 h-4 text-accent-violet"}),t.jsx("div",{className:`absolute -top-1 -right-1 bg-red-500 rounded-full flex items-center justify-center border-2 border-white ${i?"w-4 h-4":"w-5 h-5"}`,children:t.jsx("span",{className:"font-bold text-surface-primary leading-none text-xs",children:u.length>9?"9+":u.length})})]}),t.jsx(ha,{sessions:u,onRemoveSession:f||(()=>{}),onClearAllSessions:g||(()=>{}),onSessionSelect:v,isOpen:E,onClose:()=>A(!1)})]}),t.jsx("button",{ref:P,"data-dropdown-trigger":!0,onClick:()=>j(!y),className:"inline-flex items-center justify-center w-11 h-11 rounded focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500","aria-label":"AI services status",title:"AI Services Status",children:t.jsx(Ot,{className:`w-5 h-5 ${M()==="healthy"?"text-accent-emerald":M()==="partial"?"text-accent-amber":"text-accent-red"}`})})]})]}),n!=="idle"&&n!=="error"&&t.jsx("div",{className:"mt-1",children:t.jsx("div",{className:"w-full bg-white/10 rounded-full h-1",children:t.jsx("div",{className:`h-1 rounded-full transition-all duration-500 ease-out ${F.color.replace("text-","bg-")}`,style:{width:`${N()}%`}})})})]}),t.jsx(an,{isOpen:y,onClickOutside:()=>j(!1),children:t.jsx("div",{"data-dropdown-menu":!0,className:"glass rounded-lg border border-white/20 p-4",style:{position:"fixed",top:$.top,left:$.left,right:$.right,maxHeight:$.maxHeight,width:320,zIndex:9999},children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"text-ink-primary font-medium text-sm flex items-center space-x-2",children:[t.jsx(Ot,{className:"w-4 h-4"}),t.jsx("span",{children:"AI Services Status"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:S,disabled:C,className:"glass-button p-1.5 rounded hover:bg-white/20 transition-colors",title:"Refresh all services",children:t.jsx(Ct,{className:`w-3 h-3 text-accent-violet ${C?"motion-safe:animate-spin":""}`})}),t.jsx("button",{onClick:()=>j(!1),className:"glass-button p-1.5 rounded hover:bg-white/20 transition-colors",title:"Close",children:t.jsx(xe,{className:"w-3 h-3 text-ink-secondary"})})]})]}),t.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ot,{className:"w-4 h-4 text-ink-primary"}),t.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"LMStudio"})]}),t.jsxs("div",{className:`flex items-center space-x-1 ${s.isConnected?"text-accent-emerald":"text-accent-red"}`,children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${s.isConnected?"bg-accent-emerald":"bg-accent-red"}`}),t.jsx("span",{className:"text-xs",children:s.isConnected?"Connected":"Offline"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Latency:"}),t.jsx("span",{className:"text-ink-primary font-mono ml-1",children:D(s.latency)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Last Check:"}),t.jsx("span",{className:"text-ink-secondary ml-1",children:O()})]})]})]}),t.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Se,{className:"w-4 h-4 text-ink-primary"}),t.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"Whisper Server"})]}),t.jsxs("div",{className:`flex items-center space-x-1 ${s.whisperServer?.running?"text-accent-emerald":"text-accent-red"}`,children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${s.whisperServer?.running?"bg-accent-emerald":"bg-accent-red"}`}),t.jsx("span",{className:"text-xs",children:s.whisperServer?.running?"Running":"Stopped"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Port:"}),t.jsx("span",{className:"text-ink-primary font-mono ml-1",children:s.whisperServer?.port||"8001"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Model:"}),t.jsx("span",{className:"text-ink-secondary ml-1 truncate",children:s.whisperServer?.model||"whisper-large-v3-turbo"})]})]}),!s.whisperServer?.running&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded p-2",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(tt,{className:"w-3 h-3 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-amber-800 text-xs font-medium",children:s.whisperServer?.error?.includes("timeout")?"Server Starting Up":"Manual Start Required"}),t.jsx("p",{className:"text-amber-700 text-xs mt-1 leading-relaxed",children:s.whisperServer?.error?.includes("timeout")?t.jsx(t.Fragment,{children:'Server may be initializing. Use "Refresh All Services" button above to check again.'}):t.jsxs(t.Fragment,{children:["Run in terminal: ",t.jsx("code",{className:"bg-amber-100 px-1 rounded",children:"./start-whisper-server.sh"})]})})]})]})}),s.whisperServer?.error&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(tt,{className:"w-3 h-3 text-red-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-red-800 text-xs font-medium",children:"Connection Error"}),t.jsx("p",{className:"text-red-700 text-xs mt-1 leading-relaxed",children:s.whisperServer.error})]})]})})]}),!s.isConnected&&t.jsx("div",{className:"border-t border-gray-200 pt-3",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(tt,{className:"w-4 h-4 text-yellow-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-yellow-400 text-xs font-medium",children:"LMStudio Disconnected"}),t.jsxs("div",{className:"text-gray-500 text-xs mt-1 leading-relaxed space-y-1",children:[t.jsx("p",{children:"To fix this:"}),t.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 ml-1",children:[t.jsx("li",{children:"Open LMStudio application"}),t.jsx("li",{children:"Load MedGemma-27b MLX model"}),t.jsx("li",{children:"Start server on localhost:1234"})]})]})]})]})}),k&&t.jsx("div",{className:"border-t border-gray-200 pt-3",children:t.jsxs("button",{onClick:k,className:"w-full glass-button p-2 rounded flex items-center justify-center space-x-2 hover:bg-gray-50 transition-colors",children:[t.jsx(Vt,{className:"w-3 h-3 text-accent-violet"}),t.jsx("span",{className:"text-ink-primary text-xs",children:"Performance Metrics"})]})}),t.jsx("div",{className:"border-t border-gray-200 pt-3",children:t.jsxs("button",{className:"w-full glass-button p-2 rounded flex items-center justify-center space-x-2 hover:bg-surface-tertiary transition-colors",children:[t.jsx(Ya,{className:"w-3 h-3 text-ink-secondary"}),t.jsx("span",{className:"text-ink-primary text-xs",children:"Open Settings"})]})})]})})})]})},ci=({type:n})=>{const e={className:"w-4 h-4 flex-shrink-0"};switch(n){case"success":return t.jsx(ot,{...e,className:"w-4 h-4 text-emerald-600 flex-shrink-0"});case"error":return t.jsx(nn,{...e,className:"w-4 h-4 text-red-600 flex-shrink-0"});case"warning":return t.jsx(tt,{...e,className:"w-4 h-4 text-amber-600 flex-shrink-0"});case"info":return t.jsx(yt,{...e,className:"w-4 h-4 text-blue-600 flex-shrink-0"});default:return t.jsx(yt,{...e})}},di=({toast:n,onRemove:e})=>{const a=()=>{const r="glass border rounded-lg p-3 shadow-lg backdrop-blur-sm";switch(n.type){case"success":return`${r} bg-emerald-50/90 border-emerald-200`;case"error":return`${r} bg-red-50/90 border-red-200`;case"warning":return`${r} bg-amber-50/90 border-amber-200`;case"info":return`${r} bg-blue-50/90 border-blue-200`;default:return`${r} bg-gray-50/90 border-gray-200`}};return t.jsx("div",{className:`${a()} animate-in slide-in-from-right-full duration-300`,children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(ci,{type:n.type}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-gray-900 font-medium text-sm",children:n.title}),n.message&&t.jsx("p",{className:"text-gray-600 text-xs mt-1 leading-relaxed",children:n.message})]}),t.jsx("button",{onClick:()=>e(n.id),className:"glass-button p-1 rounded hover:bg-white/20 transition-colors",title:"Dismiss",children:t.jsx(xe,{className:"w-3 h-3 text-gray-500"})})]})})},mi=()=>{const[n,e]=d.useState([]);d.useEffect(()=>oe.getInstance().subscribe(e),[]);const a=r=>{oe.getInstance().remove(r)};return n.length===0?null:t.jsx("div",{className:"fixed top-4 right-4 z-[99999] space-y-2 w-80 max-w-full","aria-live":"polite",role:"status",children:n.map(r=>t.jsx(di,{toast:r,onRemove:a},r.id))})},ui=({isOpen:n,onClose:e,onStartReview:a,calendarData:r,isExtracting:i=!1,extractError:s})=>{const[o,l]=d.useState(new Set),[c,m]=d.useState("all"),[p,h]=d.useState(!1);if(d.useEffect(()=>{n&&r&&(l(new Set),m("all"))},[n,r]),!n)return null;const u=x=>{const y=new Set(o);y.has(x)?y.delete(x):y.add(x),l(y)},f=()=>{if(!r)return;const x=g(),y=x.every(C=>o.has(C.fileNumber)),j=new Set(o);x.forEach(C=>{y?j.delete(C.fileNumber):j.add(C.fileNumber)}),l(j)},g=()=>r?r.patients.filter(x=>{switch(c){case"confirmed":return x.confirmed;case"new":return x.isFirstAppointment;case"routine":return!x.isFirstAppointment;default:return!0}}):[],v=async()=>{if(!r||o.size===0)return;h(!0);const x=r.patients.filter(y=>o.has(y.fileNumber));try{await a(x)}catch(y){console.error("Failed to start batch review:",y)}finally{h(!1)}},k=x=>{switch(x.toLowerCase()){case"canew":return"bg-blue-100 text-blue-800";case"car20":case"carvi":return"bg-green-100 text-green-800";case"canvi":return"bg-purple-100 text-purple-800";case"phone":return"bg-gray-100 text-gray-800";case"unav":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},I=g(),T=o.size,F=Math.ceil(T*2.5);return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden mx-4",children:[t.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Le,{className:"w-6 h-6 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Batch AI Medical Review"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Select patients for sequential AI review and analysis"})]})]}),t.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:p,children:t.jsx(xe,{className:"w-5 h-5 text-gray-500"})})]}),r&&t.jsxs("div",{className:"mt-4 flex items-center space-x-6 text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(bt,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"font-medium",children:r.appointmentDate})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Le,{className:"w-4 h-4 text-purple-600"}),t.jsxs("span",{children:[r.totalCount," total appointments"]})]})]})]}),t.jsx("div",{className:"flex-1 overflow-hidden",children:i?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(ze,{className:"w-8 h-8 text-purple-600 animate-spin mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extracting Patient Data"}),t.jsx("p",{className:"text-gray-600",children:"Reading appointment information from calendar..."})]})}):s?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(tt,{className:"w-8 h-8 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extraction Failed"}),t.jsx("p",{className:"text-red-600 mb-4",children:s}),t.jsx("p",{className:"text-sm text-gray-600",children:"Please ensure you're on the appointment book page and try again."})]})}):!r||r.patients.length===0?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Le,{className:"w-8 h-8 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Patients Found"}),t.jsx("p",{className:"text-gray-600",children:"No appointments with patient data were found on this calendar page."})]})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(Ja,{className:"w-4 h-4 text-gray-500"}),t.jsxs("select",{value:c,onChange:x=>m(x.target.value),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm",disabled:p,children:[t.jsxs("option",{value:"all",children:["All Appointments (",r.patients.length,")"]}),t.jsxs("option",{value:"confirmed",children:["Confirmed Only (",r.patients.filter(x=>x.confirmed).length,")"]}),t.jsxs("option",{value:"new",children:["New Patients (",r.patients.filter(x=>x.isFirstAppointment).length,")"]}),t.jsxs("option",{value:"routine",children:["Return Visits (",r.patients.filter(x=>!x.isFirstAppointment).length,")"]})]})]}),t.jsx("button",{onClick:f,className:"text-sm text-purple-600 hover:text-purple-700 font-medium",disabled:p,children:I.every(x=>o.has(x.fileNumber))?"Deselect All":"Select All"})]})}),t.jsx("div",{className:"overflow-y-auto max-h-96 p-6",children:t.jsx("div",{className:"space-y-3",children:I.map(x=>t.jsx("div",{className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${o.has(x.fileNumber)?"border-purple-300 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>u(x.fileNumber),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("input",{type:"checkbox",checked:o.has(x.fileNumber),onChange:()=>u(x.fileNumber),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500",disabled:p}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:x.name}),x.isFirstAppointment&&t.jsx(Za,{className:"w-4 h-4 text-yellow-500"})]}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mt-1",children:[t.jsxs("span",{children:["DOB: ",x.dob]}),t.jsxs("span",{children:["File: ",x.fileNumber]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Ye,{className:"w-3 h-3"}),t.jsx("span",{children:x.appointmentTime})]})]}),x.notes&&t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:x.notes})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k(x.appointmentType)}`,children:x.appointmentType}),x.confirmed&&t.jsx(ot,{className:"w-4 h-4 text-green-500"})]})]})},x.fileNumber))})})]})}),r&&r.patients.length>0&&!i&&!s&&t.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:T})," patient",T!==1?"s":""," selected",T>0&&t.jsxs("span",{className:"ml-2",children:["â€¢ Estimated time: ",t.jsxs("span",{className:"font-medium",children:[F," minutes"]})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:p,children:"Cancel"}),t.jsx("button",{onClick:v,disabled:T===0||p,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:p?t.jsxs(t.Fragment,{children:[t.jsx(ze,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:"Starting..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ln,{className:"w-4 h-4"}),t.jsx("span",{children:"Start AI Review"})]})})]})]})})]})})},pi=({onGenerate:n,isGenerating:e,isVisible:a,onClose:r,emrExtractionError:i,onRetryExtraction:s})=>{const[o,l]=d.useState("medium"),[c,m]=d.useState(["diet_nutrition","physical_activity"]),[p,h]=d.useState({}),[u,f]=d.useState(""),[g,v]=d.useState(!1),[k,I]=d.useState(null),[T,F]=d.useState(null),[x,y]=d.useState(!1);d.useEffect(()=>{a&&(async()=>{if(!(T||x)){y(!0);try{const{PatientEducationAgent:N}=await je(async()=>{const{PatientEducationAgent:S}=await import("./chunks/PatientEducationAgent.Dp4R0RAp.js");return{PatientEducationAgent:S}},__vite__mapDeps([0,1,2]));F({getPriorityOptions:N.getPriorityOptions.bind(N),getAvailableModules:N.getAvailableModules.bind(N)})}catch(N){console.error("Failed to load PatientEducationAgent:",N)}finally{y(!1)}}})()},[a,T,x]);const j=T?.getPriorityOptions()||[],C=T?.getAvailableModules()||[],w=d.useCallback(b=>{m(N=>N.includes(b)?(h(S=>{const M={...S};return delete M[b],M}),N.filter(S=>S!==b)):[...N,b])},[]),E=d.useCallback((b,N)=>{h(S=>{const M=S[b]||[];if(M.includes(N)){const D=M.filter(O=>O!==N);if(D.length===0){const O={...S};return delete O[b],O}return{...S,[b]:D}}else return{...S,[b]:[...M,N]}})},[]),A=d.useCallback(async()=>{if(c.length!==0){v(!0);try{const b=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),N=await chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA",fields:["background","medications","investigations"]}),S={demographics:"",background:N?.background||"",medications:N?.medications||"",investigations:N?.investigations||""},M=b?.success&&b?.data?b.data:null;console.log("ðŸŽ“ Extracted patient data:",M),console.log("ðŸŽ“ Extracted EMR data for Patient Education:",S),I(S);const D={patientPriority:o,selectedModules:c,selectedSubFocus:Object.keys(p).length>0?p:void 0,emrData:S,patientData:M,patientContext:u.trim()||void 0};await n(D)}catch(b){console.warn("âš ï¸ EMR extraction failed, proceeding with user context only:",b);const N={demographics:"",background:"",medications:"",investigations:""},S={patientPriority:o,selectedModules:c,selectedSubFocus:Object.keys(p).length>0?p:void 0,emrData:N,patientData:null,patientContext:u.trim()||void 0};await n(S)}finally{v(!1)}}},[o,c,p,u,n]),P=d.useCallback(async()=>{if(s){v(!0);try{await s()}finally{v(!1)}}},[s]);if(!a)return null;if(x||!T)return t.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ft,{className:"w-4 h-4"}),t.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),t.jsx("button",{onClick:r,className:"text-emerald-100 hover:text-white transition-colors",children:t.jsx(xe,{className:"w-4 h-4"})})]})}),t.jsx("div",{className:"p-8 flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($t,{className:"w-5 h-5 animate-spin text-emerald-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading education modules..."})]})})]});const $=b=>{const N=c.includes(b.id),S=p[b.id]||[];return t.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-start space-x-3 p-3 hover:border-blue-300 transition-colors",children:[t.jsx("button",{onClick:()=>w(b.id),className:"flex-shrink-0 mt-0.5",disabled:e||g,children:N?t.jsx(Ke,{className:"w-5 h-5 text-blue-600"}):t.jsx(cn,{className:"w-5 h-5 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`font-medium text-sm ${N?"text-blue-900":"text-gray-700"}`,children:b.label}),t.jsxs("div",{className:"group relative inline-block",title:b.tooltip,children:[t.jsx(yt,{className:"w-4 h-4 text-gray-400 hover:text-blue-600 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:b.tooltip})]})]}),t.jsx("p",{className:"text-xs text-gray-600 mt-1",children:b.description})]})]}),N&&b.subFocusPoints&&b.subFocusPoints.length>0&&t.jsxs("div",{className:"border-t border-gray-100 bg-gray-50 p-3 space-y-2",children:[t.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Focus on specific areas (optional):"}),b.subFocusPoints.map(M=>{const D=S.includes(M.id);return t.jsxs("div",{className:"flex items-start space-x-2 ml-2",children:[t.jsx("button",{onClick:()=>E(b.id,M.id),className:"flex-shrink-0 mt-0.5",disabled:e||g,children:D?t.jsx(Ke,{className:"w-4 h-4 text-emerald-600"}):t.jsx(cn,{className:"w-4 h-4 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("span",{className:`text-xs ${D?"text-emerald-800 font-medium":"text-gray-600"}`,children:M.label}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:M.description})]})]},M.id)})]})]},b.id)};return t.jsx("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:t.jsxs("div",{className:"bg-white w-full overflow-hidden rounded-xl",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ft,{className:"w-4 h-4"}),t.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),t.jsx("button",{onClick:r,className:"text-emerald-100 hover:text-white transition-colors",disabled:e||g,children:t.jsx(xe,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"p-4 overflow-y-auto max-h-full",children:[i&&t.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(nn,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"EMR Extraction Issue"}),t.jsx("p",{className:"text-xs text-amber-700 mt-1",children:i}),s&&t.jsx("button",{onClick:P,disabled:g,className:"mt-2 px-3 py-1 bg-amber-100 hover:bg-amber-200 text-amber-800 text-xs rounded-md font-medium transition-colors disabled:opacity-50",children:g?t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx($t,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:"Retrying..."})]}):t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(Ct,{className:"w-3 h-3"}),t.jsx("span",{children:"Retry Extraction"})]})})]})]})}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Priority Level"}),t.jsx("div",{className:"space-y-2",children:j.map(b=>t.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"priority",value:b.value,checked:o===b.value,onChange:N=>l(N.target.value),className:"mt-1 text-emerald-600 focus:ring-emerald-500",disabled:e||g}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.label}),t.jsx("p",{className:"text-xs text-gray-600",children:b.description})]})]},b.value))})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Specific Priorities & Goals"}),t.jsx("textarea",{value:u,onChange:b=>f(b.target.value),placeholder:"Enter specific patient priorities and goals (e.g., lose weight, stop smoking, improve fitness, reduce blood pressure, manage diabetes)...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none text-sm",rows:3,disabled:e||g}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Optional: Describe what's most important for this patient to help personalize the lifestyle advice."})]}),k&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Extracted Patient Information"}),t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-2",children:[k.background&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Background:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:k.background})]}),k.medications&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Medications:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:k.medications})]}),k.investigations&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Recent Investigations:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:k.investigations})]}),!k.background&&!k.medications&&!k.investigations&&t.jsx("p",{className:"text-xs text-gray-500 italic",children:"No patient data found in EMR fields"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This information will be used to personalize the lifestyle advice."})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Select Lifestyle Areas (Choose at least 1)"}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:C.map($)}),c.length===0&&t.jsx("p",{className:"text-xs text-red-600 mt-2",children:"Please select at least one lifestyle area"})]}),t.jsx("div",{className:"mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(yt,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-xs text-blue-800",children:[t.jsx("p",{className:"font-medium",children:"Education Only"}),t.jsx("p",{className:"mt-1",children:"This tool provides lifestyle education and general wellness advice only. It does not diagnose conditions or recommend medication changes."})]})]})}),t.jsx("div",{className:"flex justify-end border-t border-gray-200 pt-4 mt-6",children:t.jsx("button",{onClick:A,disabled:e||g||c.length===0,className:"px-8 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 shadow-lg",children:e||g?t.jsxs(t.Fragment,{children:[t.jsx($t,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:g?"Extracting Data...":"Generating Advice..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(ft,{className:"w-4 h-4"}),t.jsx("span",{children:"Generate Lifestyle Advice"})]})})}),(e||g)&&t.jsxs("div",{className:"mt-4 text-center",children:[t.jsx("div",{className:"text-xs text-gray-600",children:g?"Extracting patient data from EMR...":"Generating personalized lifestyle advice..."}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:t.jsx("div",{className:"bg-emerald-600 h-2 rounded-full animate-pulse",style:{width:"60%"}})})]})]})]})})},zt=[{name:"background",displayName:"Background History",icon:Et},{name:"investigations",displayName:"Investigation Results",icon:Me},{name:"medications-problemlist",displayName:"Medications & Problems",icon:tn}],hi=({isActive:n,onComplete:e,className:a=""})=>{const[r,i]=d.useState([]),[s,o]=d.useState("Initializing..."),[l,c]=d.useState(0);d.useEffect(()=>{if(n){const k=zt.map(I=>({...I,status:"discovering",timestamp:Date.now()}));i(k),o("Discovering EMR fields..."),c(10),m()}else i([]),o(""),c(0)},[n]);const m=async()=>{o("Locating EMR sections..."),await p("extracting",200,10,25),o("Extracting Background section..."),await h(0,"complete",300,35),o("Extracting Investigations section..."),await h(1,"complete",400,55),o("Extracting Medications section..."),await h(2,"complete",350,75),o("Validating extracted data..."),c(85),await u(600),o("Preparing data for AI analysis..."),c(95),await u(500),c(100),o("Complete! Starting AI medical review..."),setTimeout(()=>{e()},1e3)},p=async(k,I,T,F)=>{const x=(F-T)/zt.length;for(let y=0;y<zt.length;y++)await u(I),i(j=>j.map((C,w)=>w===y?{...C,status:k,timestamp:Date.now()}:C)),c(T+x*(y+1))},h=async(k,I,T,F)=>{await u(T),i(x=>x.map((y,j)=>j===k?{...y,status:I,timestamp:Date.now()}:y)),c(F)},u=k=>new Promise(I=>setTimeout(I,k)),f=k=>{switch(k){case"discovering":return t.jsx(Me,{className:"w-4 h-4 text-blue-500 animate-pulse"});case"extracting":return t.jsx(ze,{className:"w-4 h-4 text-amber-500 animate-spin"});case"complete":return t.jsx(ot,{className:"w-4 h-4 text-green-500"});case"not-found":case"error":return t.jsx(er,{className:"w-4 h-4 text-red-500"});default:return t.jsx(Me,{className:"w-4 h-4 text-gray-400"})}},g=k=>{switch(k){case"discovering":return"Scanning...";case"extracting":return"Extracting...";case"complete":return"Complete";case"not-found":return"Not found";case"error":return"Error";default:return"Pending"}},v=k=>{switch(k){case"discovering":return"border-blue-200 bg-blue-50";case"extracting":return"border-amber-200 bg-amber-50";case"complete":return"border-green-200 bg-green-50";case"not-found":case"error":return"border-red-200 bg-red-50";default:return"border-gray-200 bg-gray-50"}};return n?t.jsx("div",{className:`absolute inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"field-ingestion-title","aria-describedby":"field-ingestion-description",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 m-4 max-w-md w-full motion-safe:animate-in motion-safe:fade-in motion-safe:slide-in-from-bottom-4 motion-reduce:transition-none",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3",children:t.jsx(Me,{className:"w-6 h-6 text-indigo-600"})}),t.jsx("h3",{id:"field-ingestion-title",className:"text-lg font-semibold text-gray-900 mb-2",children:"AI Medical Review"}),t.jsx("p",{id:"field-ingestion-description",className:"text-sm text-gray-600",children:"Analyzing EMR data for clinical insights"})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),t.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(l),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",role:"progressbar","aria-valuenow":l,"aria-valuemin":0,"aria-valuemax":100,children:t.jsx("div",{className:"bg-indigo-600 h-2 rounded-full motion-safe:transition-all motion-safe:duration-500 motion-safe:ease-out motion-reduce:transition-none",style:{width:`${l}%`}})})]}),t.jsx("div",{className:"space-y-3",children:r.map((k,I)=>t.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg border motion-safe:transition-all motion-safe:duration-300 motion-reduce:transition-none ${v(k.status)}`,role:"status","aria-label":`${k.displayName}: ${g(k.status)}`,children:[t.jsx(k.icon,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:k.displayName}),t.jsxs("div",{className:"flex items-center space-x-2",children:[f(k.status),t.jsx("span",{className:"text-xs text-gray-600",children:g(k.status)})]})]})})]},k.name))}),t.jsx("div",{className:"mt-6 text-center",children:t.jsx("p",{className:"text-xs text-gray-500",children:"Processing EMR data locally with MedGemma-27b"})})]})}):null},ht=[{id:"extraction",label:"Field Extraction",description:"Discovering and extracting EMR field content",icon:Me,progressRange:[0,30]},{id:"analysis",label:"AI Analysis",description:"Processing data with MedGemma-27b model",icon:vt,progressRange:[30,90]},{id:"generation",label:"Advisory Generation",description:"Creating clinical advisory cards",icon:tr,progressRange:[90,100]}],gi=({currentProgress:n,isActive:e,className:a="",startTime:r=Date.now(),agentType:i,transcriptionLength:s,showTimeEstimate:o=!0,onProcessingComplete:l})=>{const[c,m]=d.useState(""),[p,h]=d.useState(new Set),[u,f]=d.useState(0),[g,v]=d.useState(null),[k]=d.useState(()=>Fe.getInstance());d.useEffect(()=>{let w;return e?w=window.setInterval(()=>{f(Date.now()-r)},100):f(0),()=>{w&&clearInterval(w)}},[e,r]),d.useEffect(()=>{if(!e){m(""),h(new Set);return}const w=ht.find(E=>n>=E.progressRange[0]&&n<=E.progressRange[1]);if(w){m(w.id);const E=new Set;ht.forEach(A=>{A.progressRange[1]<=n&&E.add(A.id)}),h(E)}},[n,e]),d.useEffect(()=>{if(e&&i&&s&&o&&!g)try{const w=k.predictProcessingTime(i,s,{includeTranscriptionTime:!1});v(w),console.log(`ðŸ“Š Time prediction for ${i}:`,w.displayText)}catch(w){console.warn("Failed to generate time prediction:",w)}else if(!e){if(g&&n>=100&&l){const w=u;if(l(w),i&&s){k.recordActualProcessingTime(i,s,w);const E=k.updatePredictionAccuracy(g,w);console.log(`ðŸŽ¯ Prediction accuracy: ${Math.round(E.accuracy*100)}%`)}}v(null)}},[e,i,s,o,g,n,u,l,k]);const I=w=>{const E=Math.floor(w/1e3);if(E<60)return`${E}s`;{const A=Math.floor(E/60),P=E%60;return`${A}m ${P.toString().padStart(2,"0")}s`}},T=w=>p.has(w.id)?"completed":c===w.id?"active":"pending",F=w=>{const[E,A]=w.progressRange;return n<=E?0:n>=A?100:(n-E)/(A-E)*100},x=w=>{switch(w){case"completed":return"text-green-600 bg-green-100 border-green-200";case"active":return"text-indigo-600 bg-indigo-100 border-indigo-200";default:return"text-gray-400 bg-gray-50 border-gray-200"}},y=(w,E)=>{if(E==="completed")return t.jsx(ot,{className:"w-5 h-5 text-green-600"});const A=w.icon,P=E==="active"?"w-5 h-5 text-indigo-600":"w-5 h-5 text-gray-400";return t.jsx(A,{className:P})},j=()=>{if(!g||n>=100)return{timeMs:0,isEstimate:!1};const w=(100-n)/100,E=g.estimatedDurationMs*w,A=g.estimatedDurationMs*(n/100),P=u/Math.max(A,100),$=E*P;return{timeMs:Math.max(0,$),isEstimate:!0}},C=w=>{const E=Math.ceil(w/1e3);if(E<60)return`~${E}s left`;{const A=Math.floor(E/60),P=E%60;return`~${A}m ${P}s left`}};return e?t.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 p-4 ${a}`,role:"status","aria-labelledby":"processing-status-title","aria-describedby":"processing-status-description",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{id:"processing-status-title",className:"text-sm font-medium text-gray-900",children:i?i.charAt(0).toUpperCase()+i.slice(1).replace("-"," "):"AI Medical Review"}),t.jsxs("div",{className:"flex items-center space-x-1 text-indigo-600",children:[t.jsx(Ye,{className:"w-3 h-3"}),t.jsx("span",{className:"text-xs font-mono font-medium","aria-live":"polite",children:I(u)})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[g&&o&&(()=>{const w=j();return w.isEstimate&&w.timeMs>1e3?t.jsxs("div",{className:"flex items-center space-x-1 text-purple-600",children:[t.jsx(Wn,{className:"w-3 h-3"}),t.jsx("span",{className:"text-xs font-medium","aria-live":"polite",children:C(w.timeMs)})]}):null})(),t.jsxs("span",{className:"text-xs text-gray-500","aria-live":"polite",children:[Math.round(n),"%"]})]})]}),t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Overall processing progress",children:t.jsx("div",{className:"bg-indigo-600 h-1.5 rounded-full motion-safe:transition-all motion-safe:duration-300 motion-safe:ease-out motion-reduce:transition-none",style:{width:`${n}%`}})})}),t.jsx("div",{className:"space-y-3",children:ht.map((w,E)=>{const A=T(w),P=F(w);return t.jsxs("div",{className:`relative flex items-start space-x-3 p-3 rounded-lg border motion-safe:transition-all motion-safe:duration-300 motion-reduce:transition-none ${x(A)}`,role:"listitem","aria-label":`${w.label}: ${A==="completed"?"Complete":A==="active"?"In progress":"Pending"}`,children:[t.jsx("div",{className:"flex-shrink-0 mt-0.5",children:y(w,A)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h5",{className:"text-sm font-medium text-gray-900",children:w.label}),A==="active"&&t.jsxs("span",{className:"text-xs text-indigo-600 font-medium",children:[Math.round(P),"%"]})]}),t.jsx("p",{className:"text-xs text-gray-600 mb-2",children:w.description}),A==="active"&&t.jsx("div",{className:"w-full bg-indigo-200 rounded-full h-1",role:"progressbar","aria-valuenow":P,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`${w.label} progress`,children:t.jsx("div",{className:"bg-indigo-600 h-1 rounded-full motion-safe:transition-all motion-safe:duration-200 motion-safe:ease-out motion-reduce:transition-none",style:{width:`${P}%`}})})]}),E<ht.length-1&&t.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-4 bg-gray-200"})]},w.id)})}),t.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[t.jsx("p",{className:"text-xs text-gray-500 text-center",children:n>=100?"âœ… Processing complete - clinical advisory ready":"ðŸ”„ Local processing with MedGemma-27b model"}),g&&o&&n<100&&t.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs",children:[t.jsx("span",{className:"text-purple-600 font-medium",children:g.displayText}),g.confidenceLevel==="high"&&t.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:"High confidence"}),g.confidenceLevel==="medium"&&t.jsx("span",{className:"px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded text-xs",children:"Medium confidence"}),g.confidenceLevel==="low"&&t.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded text-xs",children:"Low confidence"})]})]})})]}):null},ga=[{id:"tavi",title:"TAVI Procedure Recording",description:"Transcatheter Aortic Valve Implantation - Comprehensive procedural documentation",estimatedTime:"8-12 minutes",sections:[{title:"Preamble Information",icon:"ðŸ“‹",items:["Patient demographics and clinical indication",'Preoperative CT findings: "suitable anatomy for valve implant"',"Valve morphology: tricuspid/bicuspid, calcification burden","Calcium score and LVOT assessment","Transthoracic echo: mean gradient, systolic function","Valve selection rationale with sizing logic"]},{title:"Procedural Details",icon:"âš•ï¸",items:["Anaesthesia approach: local anaesthesia and deep sedation","Vascular access: radial planning, femoral with ultrasound guidance","Pre-closure technique: ProStyle sutures or equivalent","Sheath sizes: specific French sizes (e.g., 16F Cook sheath)","Valve crossing: AL1, straight wire, invasive gradient, LVEDP","Lunderquist wire placement at left ventricular apex","Pre-dilation: balloon size and technique","Valve deployment: positioning at annular plane","Immediate assessment: aortic regurgitation, coronary patency"]},{title:"Outcomes & Assessment",icon:"âœ…",items:["Valve deployment success and positioning","Final aortic regurgitation grade","Post-procedural echo findings","Arteriotomy closure method and success","Overall procedural success statement","Immediate post-procedural valve performance"]}],tips:["Use Australian spelling: anaesthesia, recognised, utilised","Include precise measurements with units (mmHg, cmÂ², French sizes)","Preserve original stenosis terminology (mild/moderate/severe)","Document valve manufacturer and model specifically"],terminology:["Edwards Sapien 3 Ultra/Medtronic Evolut series","Annular perimeter and area, LVOT calcium burden","Well-seated valve, patent coronaries","Partial recaptures for optimal positioning"]},{id:"angiogram-pci",title:"Angiogram/PCI Recording",description:"Cardiac catheterization and coronary interventions - Diagnostic and interventional procedures",estimatedTime:"8-15 minutes",sections:[{title:"Vessel Assessment",icon:"ðŸ«€",items:["Left Main coronary artery findings","LAD: proximal, mid, distal segments and diagonal branches","Circumflex: segments and obtuse marginal branches","RCA: segments including dominance pattern","Coronary dominance (right/left/co-dominant)","Collateral circulation if present"]},{title:"Procedural Information",icon:"ðŸ”§",items:["Vascular access site and approach","Catheter selection and sizes","Target lesion characteristics and location","Intervention strategy and rationale","Device specifications: stent type, manufacturer, size","Balloon pre-dilation details","Deployment technique and positioning"]},{title:"Results & Outcomes",icon:"ðŸ“Š",items:["TIMI flow assessment (pre and post)","Final angiographic result","Residual stenosis percentage","Procedural complications if any","Hemodynamic measurements","Antiplatelet therapy plan"]}],tips:["Preserve stenosis grading as stated by clinician","Use descriptive TIMI flow language","Include specific device details when mentioned","Document both diagnostic and intervention aspects"],terminology:["Drug-eluting stent (DES), bare metal stent (BMS)","TIMI III flow, complete perfusion","Proximal/mid/distal vessel segments","Optimal angiographic result"]},{id:"quick-letter",title:"Quick Letter Recording",description:"Medical correspondence and consultation letters - Professional communication",estimatedTime:"1-3 minutes",sections:[{title:"Patient Presentation",icon:"ðŸ‘¤",items:["Clinical presentation and chief complaint","Relevant history and context","Current symptoms and functional status","Reason for referral or consultation","Timeline of events"]},{title:"Clinical Assessment",icon:"ðŸ”",items:["Investigation findings and interpretation","Clinical examination relevant findings","Diagnostic considerations","Risk stratification if applicable"]},{title:"Management Plan",icon:"ðŸ“",items:["Treatment recommendations","Medication changes or additions","Follow-up arrangements","Specialist referrals if needed","Patient education provided"]}],tips:['Use first-person voice: "I reviewed", "I examined"',"Keep paragraphs flowing and professional","Include specific timeframes and measurements","Use Australian spelling and medical terminology"],terminology:["Clinical assessment, management plan","Follow-up arrangements, specialist review","Patient education, shared decision-making","Routine/semi-urgent/urgent referral"]},{id:"consultation",title:"Consultation Recording",description:"Comprehensive patient assessments - Detailed clinical evaluation",estimatedTime:"2-4 minutes",sections:[{title:"Clinical History",icon:"ðŸ“š",items:["Presenting complaint and history","Past medical history and comorbidities","Current medications and allergies","Family history if relevant","Social history and functional status"]},{title:"Examination & Investigations",icon:"ðŸ”¬",items:["Physical examination findings","Vital signs and measurements","Investigation results and interpretation","Imaging findings if applicable","Laboratory results correlation"]},{title:"Assessment & Plan",icon:"ðŸŽ¯",items:["Clinical impression and differential diagnosis","Risk assessment and stratification","Management strategy and rationale","Investigation plan if needed","Follow-up and monitoring plan"]}],tips:["Capture comprehensive clinical reasoning","Include functional assessment (NYHA class, etc.)","Document shared decision-making process","Note patient understanding and concerns"],terminology:["Clinical impression, differential diagnosis","Risk stratification, management strategy","Functional class, symptom assessment","Patient-centred care, shared decisions"]},{id:"mteer",title:"mTEER Procedure Recording",description:"Mitral transcatheter edge-to-edge repair - Structural heart intervention",estimatedTime:"7-10 minutes",sections:[{title:"Pre-procedural Assessment",icon:"ðŸ”",items:["Mitral regurgitation severity and mechanism","Valve anatomy and morphology","TOE assessment and measurements","Procedural planning and approach","Patient selection criteria"]},{title:"Procedural Technique",icon:"âš™ï¸",items:["Transseptal puncture technique","Device delivery and positioning","Clip deployment and assessment","TOE guidance throughout procedure","Immediate haemodynamic changes"]},{title:"Results & Follow-up",icon:"ðŸ“ˆ",items:["Final mitral regurgitation grade","Mitral valve gradient assessment","Procedural success metrics","Complications if any","Post-procedural monitoring plan including TTE next day"]}],tips:["Document TOE guidance detail","Include specific device information","Note immediate haemodynamic improvement","Record precise regurgitation grading"],terminology:["Edge-to-edge repair, MitraClip device","Functional vs degenerative MR","TOE guidance, transseptal puncture","Immediate haemodynamic improvement"]},{id:"pfo-closure",title:"PFO Closure Recording",description:"Patent foramen ovale closure - Structural heart intervention",estimatedTime:"5-8 minutes",sections:[{title:"Pre-procedural Assessment",icon:"ðŸ”Ž",items:["PFO anatomy and tunnel length","Shunt assessment and grading","Device selection rationale","Imaging findings (TOE/ICE)","Clinical indication for closure"]},{title:"Deployment Technique",icon:"ðŸŽ¯",items:["Device delivery and positioning","Deployment sequence and technique","Position confirmation","Immediate closure assessment","Device stability evaluation"]},{title:"Procedural Outcome",icon:"âœ¨",items:["Successful device deployment","Residual shunt assessment","Device position and stability","Procedural complications if any","Post-procedural monitoring requirements"]}],tips:["Document device sizing rationale","Include immediate closure success","Note any residual shunt","Record device stability assessment"],terminology:["Patent foramen ovale, atrial septal anatomy","Device deployment, positioning confirmation","Residual shunt, complete closure","TOE/ICE guidance, device stability"]},{id:"right-heart-cath",title:"Right Heart Catheterisation",description:"Right heart catheterisation with haemodynamic assessment",estimatedTime:"6-10 minutes",sections:[{title:"Haemodynamic Assessment",icon:"ðŸ“Š",items:["Right atrial pressure measurements","Right ventricular pressures","Pulmonary artery pressures","Pulmonary capillary wedge pressure","Cardiac output and index","Pulmonary vascular resistance","TPG, RVSWI"]},{title:"Technical Details",icon:"ðŸ”§",items:["Vascular access approach","Catheter selection and positioning","Measurement technique and validation","Thermodilution or Fick method","Complications if any"]},{title:"Clinical Interpretation",icon:"ðŸ“‹",items:["Haemodynamic interpretation","Pulmonary hypertension assessment","Heart failure classification","Treatment implications","Follow-up recommendations"]}],tips:["Include precise pressure measurements","Document calculation methods used","Note any technical challenges","Correlate with clinical presentation"],terminology:["Pulmonary vascular resistance, cardiac index","Thermodilution, Fick equation","Pulmonary hypertension, right heart failure","Haemodynamic profile, pressure gradients"]},{id:"investigation-summary",title:"Investigation Summary Recording",description:"Formatting voice-dictated investigation results into structured summaries",estimatedTime:"30-60 seconds",sections:[{title:"Test Information",icon:"ðŸ”¬",items:["Investigation type (TTE, CTCA, Bloods, etc.)","Date of investigation (DD MMM YYYY format)","Location/institution if relevant","Test methodology or approach if specified"]},{title:"Key Findings",icon:"ðŸ“‹",items:["Primary findings and measurements","Normal and abnormal values with units","Qualitative descriptions (mild/moderate/severe)","Relevant anatomical observations","Clinical significance if stated"]},{title:"Measurements & Values",icon:"ðŸ“",items:["Exact numerical values with units","Reference ranges when mentioned","Percentage values (e.g., EF 55%)","Pressure measurements (mmHg)","Laboratory values with proper abbreviations"]}],tips:["Use standard medical abbreviations (TChol, LDL, HDL, etc.)","Include units with all measurements","Preserve qualitative terms exactly as stated","Format as: TEST (date): comma-separated findings"],terminology:["TTE, TOE, CTCA, CMRI, RHC, Bloods","TChol, TG, HDL, LDL, HbA1c, Cr, eGFR","EF%, MPG, PPG, RVSP, TIMI flow","Normal, mild, moderate, severe"]},{id:"background",title:"Background & History Recording",description:"Patient medical background, history, and contextual information",estimatedTime:"1-2 minutes",sections:[{title:"Medical History",icon:"ðŸ¥",items:["Past medical conditions and diagnoses","Previous cardiovascular events or procedures","Chronic conditions and comorbidities","Surgical history relevant to current care","Hospital admissions and major events"]},{title:"Family & Social History",icon:"ðŸ‘¥",items:["Family history of cardiovascular disease","Hereditary conditions or risk factors","Social circumstances affecting care","Functional status and mobility","Support systems and care arrangements"]},{title:"Risk Factors",icon:"âš ï¸",items:["Smoking history (current/former/never)","Alcohol consumption patterns","Exercise tolerance and activity levels","Occupational or environmental exposures","Lifestyle factors affecting health"]}],tips:["Use chronological order for medical events","Include dates and timeframes when mentioned","Note functional impact of conditions","Use arrow notation (â†’) for progression or outcomes"],terminology:["CAD, MI, CABG, PCI, valve disease","DM, HTN, dyslipidaemia, CKD","NYHA class, functional capacity","Family Hx, social circumstances"]},{id:"medication",title:"Medication Recording",description:"Current medications, changes, and pharmaceutical management",estimatedTime:"1-2 minutes",sections:[{title:"Current Medications",icon:"ðŸ’Š",items:["Drug name (generic preferred)","Dosage and strength","Frequency and timing","Route of administration","Duration of therapy if specified"]},{title:"Recent Changes",icon:"ðŸ”„",items:["New medications started","Dose adjustments made","Medications discontinued","Reason for changes","Timing of modifications"]},{title:"Compliance & Effects",icon:"âœ…",items:["Adherence to current regimen","Side effects experienced","Therapeutic response noted","Patient understanding and concerns","Monitoring requirements"]}],tips:["Use generic drug names when possible","Include exact dosages with units (mg, mcg)","Note timing (morning, evening, with meals)","Document reasons for any changes"],terminology:["ACE inhibitor, ARB, beta-blocker, statin","BD, TDS, QID, PRN, with meals","mg, mcg, g, units, mL","Commenced, ceased, increased, decreased"]}];function fi(n){return ga.find(e=>e.id===n)}function Nn(n){return ga.some(e=>e.id===n)}const xi=Z.memo(({agentType:n,isVisible:e,onClose:a,onStartRecording:r,compactMode:i=!1})=>{const[s,o]=d.useState({}),l=fi(n);Math.random()<.001&&console.log("ðŸ“‹ Recording prompt shown for:",n);const c=d.useCallback(p=>{o(h=>({...h,[p]:!h[p]}))},[]);if(d.useCallback(()=>{r?.(),a?.()},[r,a]),!e||!l)return null;const m=(p,h)=>{const u=s[p.title]??(i?!1:h===0);return t.jsxs("div",{className:`border border-gray-200 rounded-lg overflow-hidden ${i?"mb-2":"mb-3"}`,children:[t.jsxs("button",{onClick:()=>c(p.title),className:`w-full bg-gray-50 hover:bg-gray-100 flex items-center justify-between text-left transition-colors ${i?"px-3 py-2":"px-4 py-3"}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:i?"text-sm":"text-lg",children:p.icon}),t.jsx("span",{className:`font-semibold text-gray-800 ${i?"text-xs":"text-sm"}`,children:p.title})]}),u?t.jsx(at,{className:`text-gray-500 ${i?"w-3 h-3":"w-4 h-4"}`}):t.jsx(Wt,{className:`text-gray-500 ${i?"w-3 h-3":"w-4 h-4"}`})]}),u&&t.jsx("div",{className:`bg-white ${i?"px-3 py-2":"px-4 py-3"}`,children:t.jsx("ul",{className:i?"space-y-1":"space-y-2",children:p.items.map((f,g)=>t.jsxs("li",{className:`flex items-start space-x-2 text-gray-700 ${i?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-blue-500 rounded-full mt-2 flex-shrink-0 ${i?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{children:f})]},g))})})]},p.title)};return t.jsx("div",{className:`w-full bg-white border border-gray-200 ${i?"rounded-lg shadow-md":"max-w-none mx-2 rounded-xl shadow-lg mb-4"}`,children:t.jsxs("div",{className:`bg-white w-full overflow-hidden ${i?"rounded-lg max-h-[40vh]":"rounded-xl max-h-[70vh]"}`,children:[t.jsx("div",{className:`bg-gradient-to-r from-red-600 to-red-700 text-white ${i?"px-3 py-2":"px-4 py-3"}`,children:t.jsxs("div",{className:"flex items-center space-x-2",children:[!i&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-300 rounded-full animate-pulse"}),t.jsx("span",{className:"text-sm font-semibold",children:"RECORDING"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(dn,{className:i?"w-3 h-3":"w-4 h-4"}),t.jsx("span",{className:`font-medium ${i?"text-xs":"text-sm"}`,children:i?l.title.replace(" Recording",""):`Recording Guide: ${l.title.replace(" Recording","")}`})]})]})}),t.jsxs("div",{className:`overflow-y-auto ${i?"p-3 max-h-[35vh]":"p-4 max-h-[60vh]"}`,children:[!i&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 rounded-lg border border-red-200",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(nr,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),t.jsx("div",{children:t.jsx("p",{className:"text-red-700 text-sm font-medium",children:"Include these key elements while recording to ensure a comprehensive medical report:"})})]})}),t.jsxs("div",{className:i?"mb-3":"mb-6",children:[!i&&t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center space-x-2",children:[t.jsx(dn,{className:"w-4 h-4"}),t.jsx("span",{children:"What to Include"})]}),l.sections.map(m)]}),l.tips.length>0&&t.jsxs("div",{className:i?"mb-3":"mb-6",children:[t.jsxs("h3",{className:`font-semibold text-gray-800 ${i?"mb-2 text-sm":"mb-3"}`,children:["ðŸ’¡ ",i?"Tips":"Recording Tips"]}),t.jsx("div",{className:`bg-yellow-50 border border-yellow-200 rounded-lg ${i?"p-2":"p-4"}`,children:t.jsx("ul",{className:i?"space-y-1":"space-y-2",children:l.tips.map((p,h)=>t.jsxs("li",{className:`flex items-start space-x-2 text-yellow-800 ${i?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-yellow-500 rounded-full mt-2 flex-shrink-0 ${i?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{children:p})]},h))})})]}),l.terminology.length>0&&t.jsxs("div",{className:i?"mb-2":"mb-6",children:[t.jsxs("h3",{className:`font-semibold text-gray-800 ${i?"mb-2 text-sm":"mb-3"}`,children:["ðŸ“š ",i?"Terms":"Key Terminology"]}),t.jsx("div",{className:`bg-green-50 border border-green-200 rounded-lg ${i?"p-2":"p-4"}`,children:t.jsx("div",{className:`grid gap-2 ${i?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:l.terminology.map((p,h)=>t.jsxs("div",{className:`flex items-center space-x-2 text-green-800 ${i?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-green-500 rounded-full flex-shrink-0 ${i?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{className:"font-medium",children:p})]},h))})})]})]})]})})}),bi=({isOpen:n,onClose:e})=>{const[a,r]=d.useState(null),[i,s]=d.useState([]),[o,l]=d.useState(!0);d.useEffect(()=>{n&&c()},[n]);const c=async()=>{l(!0);try{const g=Te.getInstance(),[v,k]=await Promise.all([g.getAnalytics(),g.getAllMetrics()]);r(v),s(k.slice(0,10))}catch(g){console.error("Failed to load metrics:",g)}finally{l(!1)}},m=async()=>{confirm("Are you sure you want to clear all performance metrics? This cannot be undone.")&&(await Te.getInstance().clearAllMetrics(),await c())},p=async()=>{try{const v=await Te.getInstance().exportMetrics(),k=new Blob([v],{type:"application/json"}),I=URL.createObjectURL(k),T=document.createElement("a");T.href=I,T.download=`xestro-metrics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(I)}catch(g){console.error("Failed to export metrics:",g)}},h=g=>{if(g<1e3)return`${g}ms`;if(g<6e4)return`${(g/1e3).toFixed(1)}s`;const v=Math.floor(g/6e4),k=Math.floor(g%6e4/1e3);return`${v}m ${k}s`},u=g=>({tavi:"â¤ï¸","angiogram-pci":"ðŸ«€",mteer:"ðŸ”§",tteer:"ðŸ«€","pfo-closure":"ðŸ¥","asd-closure":"ðŸ¥","pvl-plug":"ðŸ”Œ","bypass-graft":"ðŸ›¤ï¸","right-heart-cath":"ðŸ“Š","tavi-workup":"ðŸ”","quick-letter":"ðŸ“",consultation:"ðŸ‘¨â€âš•ï¸","investigation-summary":"ðŸ”","ai-medical-review":"ðŸ›¡ï¸","batch-ai-review":"ðŸ“‹","patient-education":"ðŸŽ“",background:"ðŸ“‹",medication:"ðŸ’Š",bloods:"ðŸ©¸",imaging:"ðŸ“·",enhancement:"âœ¨",transcription:"ðŸŽ¤",generation:"ðŸ¤–"})[g]||"ðŸ¤–",f=g=>g>0?"text-green-600":g<0?"text-red-600":"text-gray-600";return n?t.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl max-h-[90vh] overflow-hidden w-full",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Vt,{className:"w-6 h-6 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Performance Analytics"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Historical recording metrics and trends"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:p,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Export Metrics",children:t.jsx(rt,{className:"w-4 h-4"})}),t.jsx("button",{onClick:c,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:t.jsx(Ct,{className:"w-4 h-4"})}),t.jsx("button",{onClick:m,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear All Metrics",children:t.jsx(Tt,{className:"w-4 h-4"})}),t.jsx("button",{onClick:e,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Close",children:t.jsx(xe,{className:"w-4 h-4"})})]})]})}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:o?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})}):a&&a.totalRecordings>0?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(ar,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Total Recordings"})]}),t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:a.totalRecordings})]}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(qt,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-800",children:"Avg Transcription"})]}),t.jsx("div",{className:"text-2xl font-bold text-green-900",children:h(a.averageTranscriptionTime)})]}),t.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(vt,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-purple-800",children:"Avg Processing"})]}),t.jsx("div",{className:"text-2xl font-bold text-purple-900",children:h(a.averageProcessingTime)})]}),t.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Ye,{className:"w-4 h-4 text-orange-600"}),t.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Avg Total"})]}),t.jsx("div",{className:"text-2xl font-bold text-orange-900",children:h(a.averageTotalDuration)})]})]}),a.recentTrend.last25Avg>0&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.recentTrend.improvementPercent>0?t.jsx(Wn,{className:"w-4 h-4 text-green-600"}):a.recentTrend.improvementPercent<0?t.jsx(rr,{className:"w-4 h-4 text-red-600"}):t.jsx(qt,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-800",children:"Performance Trend"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Last 10 Average"}),t.jsx("div",{className:"font-semibold",children:h(a.recentTrend.last10Avg)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Last 25 Average"}),t.jsx("div",{className:"font-semibold",children:h(a.recentTrend.last25Avg)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Improvement"}),t.jsxs("div",{className:`font-semibold ${f(a.recentTrend.improvementPercent)}`,children:[a.recentTrend.improvementPercent>0?"+":"",a.recentTrend.improvementPercent,"%"]})]})]})]}),Object.keys(a.agentTypeBreakdown).length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Agent Performance Breakdown"}),t.jsx("div",{className:"space-y-3",children:Object.entries(a.agentTypeBreakdown).map(([g,v])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"text-xl",children:u(g)}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 capitalize",children:g.replace("-"," ")}),t.jsxs("div",{className:"text-sm text-gray-600",children:[v.count," recordings"]})]})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:h(v.avgTotal)}),t.jsxs("div",{className:"text-gray-600",children:[h(v.avgTranscription)," + ",h(v.avgProcessing)]})]})]},g))})]}),i.length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Recordings"}),t.jsx("div",{className:"space-y-2",children:i.map((g,v)=>t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"text-sm",children:u(g.agentType)}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 capitalize",children:g.agentType.replace("-"," ")}),t.jsx("div",{className:"text-xs text-gray-500",children:new Date(g.timestamp).toLocaleString()})]})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:h(g.totalDuration)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[h(g.transcriptionTime)," + ",h(g.processingTime)]})]})]},g.sessionId))})]}),Object.keys(a.modelPerformance).length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Model Performance"}),t.jsx("div",{className:"space-y-2",children:Object.entries(a.modelPerformance).map(([g,v])=>t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(en,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:g})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:h(v.avgTime)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[v.count," recordings"]})]})]},g))})]})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Vt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Metrics Available"}),t.jsx("p",{className:"text-gray-600",children:"Start recording to see performance analytics appear here."})]})})]})}):null},vi=({isRecording:n,voiceActivityLevel:e,frequencyData:a,audioLevelHistory:r,recordingTime:i,activeDeviceInfo:s,onStop:o,className:l=""})=>{const[c,m]=Z.useState({status:"idle",color:"gray",message:"Not recording"}),[p,h]=Z.useState(!1),u=Z.useRef();Z.useEffect(()=>{n&&a.length>0&&e>.05&&Math.random()<.05&&console.log("ðŸ“Š Visualizer Debug:",{isRecording:n,frequencyDataLength:a.length,voiceLevel:Math.round(e*100)+"%",freqAvg:Math.round(a.reduce((x,y)=>x+y,0)/a.length*100)+"%"})},[n,a,e]);const f=r.slice(-10).some(x=>x>.05),g=()=>n?r.length<5?{status:"initializing",color:"blue",message:"Initializing..."}:f?{status:"active",color:"green",message:"Audio detected"}:e>.01?{status:"low",color:"yellow",message:"Low audio"}:{status:"silent",color:"red",message:"No audio detected"}:{status:"idle",color:"gray",message:"Not recording"};Z.useEffect(()=>{const x=g();if(u.current&&clearTimeout(u.current),x.status==="active"||x.status==="initializing"){m(x),h(!1);return}return x.status==="silent"||x.status==="low"?u.current=setTimeout(()=>{m(x),x.status==="silent"&&r.length>50&&h(!0)},2500):(m(x),h(!1)),()=>{u.current&&clearTimeout(u.current)}},[n,f,e,r.length]);const v=c,k=x=>{const y=Math.floor(x/60),j=x%60;return`${y}:${j.toString().padStart(2,"0")}`},I=Math.min(e*180,180),F=(x=>x.length===0?[]:[...[...x].reverse(),...x])(a);return t.jsxs("div",{className:`flex-1 flex flex-col items-center justify-center p-4 space-y-4 ${l}`,children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"w-24 h-24 rounded-full border-6 border-line-primary relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-1.5 rounded-full border-3 border-line-secondary"}),t.jsx("div",{className:"absolute inset-1.5 rounded-full border-3 transition-all duration-100",style:{borderColor:v.color==="green"?"var(--accent-emerald)":v.color==="yellow"?"var(--accent-amber)":v.color==="red"?"var(--accent-red)":v.color==="blue"?"var(--accent-violet)":"var(--line-primary)",clipPath:`polygon(50% 50%, 50% 0%, ${50+Math.sin(I*Math.PI/180)*50}% ${50-Math.cos(I*Math.PI/180)*50}%, 50% 50%)`}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:v.status==="active"?t.jsx(Se,{className:"w-6 h-6",style:{color:"var(--accent-emerald)"}}):v.status==="silent"?t.jsx(ir,{className:"w-6 h-6",style:{color:"var(--accent-red)"}}):t.jsx(Se,{className:"w-6 h-6 text-ink-secondary"})}),t.jsx("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2",children:t.jsxs("span",{className:"text-xs font-semibold text-ink-secondary",children:[Math.round(e*100),"%"]})})]}),n&&t.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full animate-pulse flex items-center justify-center",style:{backgroundColor:"var(--accent-red)"},children:t.jsx("div",{className:"w-2 h-2 bg-surface-primary rounded-full"})})]}),t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("h3",{className:"text-base font-semibold text-ink-primary",children:n?"Recording in progress":"Ready to record"}),t.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-ink-secondary",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:v.color==="green"?"var(--accent-emerald)":v.color==="yellow"?"var(--accent-amber)":v.color==="red"?"var(--accent-red)":v.color==="blue"?"var(--accent-violet)":"var(--ink-tertiary)"}}),t.jsx("span",{children:v.message})]}),s&&t.jsx("div",{className:"text-xs text-ink-tertiary truncate max-w-xs",children:s.label}),n&&t.jsx("div",{className:"text-lg font-mono font-semibold text-ink-primary bg-surface-tertiary rounded-full px-3 py-1",children:k(i)})]}),n&&t.jsxs("div",{className:"w-full max-w-sm",children:[t.jsx("div",{className:"text-xs text-ink-tertiary text-center mb-2",children:"Live audio spectrum"}),t.jsx("div",{className:"h-16 bg-surface-tertiary rounded-2xl border border-line-primary flex items-center justify-center px-2 overflow-hidden",children:F.length>0?t.jsx("div",{className:"flex items-center justify-center space-x-0.5 h-full w-full",children:F.map((x,y)=>{const j=Math.floor(F.length/2),C=Math.abs(y-j);return t.jsx("div",{className:"flex-1 max-w-1 rounded-full transition-all duration-100",style:{backgroundColor:x>.7||x>.4?"var(--accent-emerald)":x>.2||x>.1?"var(--accent-violet)":x>.05?"var(--ink-tertiary)":"var(--line-primary)",height:`${Math.max(x*90,2)}%`,minHeight:"2px",animationDelay:`${C*5}ms`}},y)})}):t.jsxs("div",{className:"flex items-center space-x-2 text-gray-400",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-pulse",style:{animationDelay:"0.4s"}}),t.jsx("span",{className:"text-xs",children:"Waiting for audio..."})]})}),t.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-ink-tertiary",children:[t.jsx("span",{children:"Audio level:"}),t.jsxs("span",{className:"font-semibold text-ink-secondary",children:[Math.round(e*100),"%"]})]})]}),n&&t.jsxs("button",{onClick:o,className:"flex items-center space-x-2 bg-ink-primary hover:bg-ink-secondary text-surface-primary px-6 py-3 rounded-full transition-all duration-160 shadow-sm micro-lift",children:[t.jsx(sr,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium",children:"Stop recording"})]}),t.jsxs("div",{className:"w-full max-w-sm min-h-[60px] flex items-center justify-center",children:[n&&p&&t.jsxs("div",{className:"w-full bg-surface-tertiary border border-line-primary rounded-2xl p-3 transition-all duration-300",children:[t.jsxs("div",{className:"text-xs text-ink-primary font-medium mb-1 flex items-center space-x-1",children:[t.jsx("div",{className:"w-1 h-1 rounded-full transition-colors duration-300",style:{backgroundColor:v.color==="red"?"var(--accent-red)":"var(--accent-amber)"}}),t.jsx("span",{children:v.message})]}),t.jsxs("div",{className:"text-xs text-ink-secondary",children:["â€¢ Check if microphone is muted",t.jsx("br",{}),"â€¢ Ensure device is connected",t.jsx("br",{}),"â€¢ Try speaking louder",t.jsx("br",{}),"â€¢ Switch microphones if available"]})]}),n&&!p&&t.jsx("div",{className:"text-xs text-ink-tertiary text-center opacity-60",children:"Audio monitoring active"})]})]})};var fa={exports:{}},yi="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",wi=yi,ki=wi;function xa(){}function ba(){}ba.resetWarningCache=xa;var ji=function(){function n(r,i,s,o,l,c){if(c!==ki){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}}n.isRequired=n;function e(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:ba,resetWarningCache:xa};return a.PropTypes=a,a};fa.exports=ji();var Ni=fa.exports;const J=cr(Ni);function Be(n,e,a,r){function i(s){return s instanceof a?s:new a(function(o){o(s)})}return new(a||(a=Promise))(function(s,o){function l(p){try{m(r.next(p))}catch(h){o(h)}}function c(p){try{m(r.throw(p))}catch(h){o(h)}}function m(p){p.done?s(p.value):i(p.value).then(l,c)}m((r=r.apply(n,e||[])).next())})}const Si=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Qe(n,e,a){const r=Ci(n),{webkitRelativePath:i}=n,s=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${n.name}`;return typeof r.path!="string"&&Sn(r,"path",s),Sn(r,"relativePath",s),r}function Ci(n){const{name:e}=n;if(e&&e.lastIndexOf(".")!==-1&&!n.type){const r=e.split(".").pop().toLowerCase(),i=Si.get(r);i&&Object.defineProperty(n,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return n}function Sn(n,e,a){Object.defineProperty(n,e,{value:a,writable:!1,configurable:!1,enumerable:!0})}const Ti=[".DS_Store","Thumbs.db"];function Ei(n){return Be(this,void 0,void 0,function*(){return jt(n)&&Pi(n.dataTransfer)?Ii(n.dataTransfer,n.type):Ai(n)?Ri(n):Array.isArray(n)&&n.every(e=>"getFile"in e&&typeof e.getFile=="function")?Mi(n):[]})}function Pi(n){return jt(n)}function Ai(n){return jt(n)&&jt(n.target)}function jt(n){return typeof n=="object"&&n!==null}function Ri(n){return Kt(n.target.files).map(e=>Qe(e))}function Mi(n){return Be(this,void 0,void 0,function*(){return(yield Promise.all(n.map(a=>a.getFile()))).map(a=>Qe(a))})}function Ii(n,e){return Be(this,void 0,void 0,function*(){if(n.items){const a=Kt(n.items).filter(i=>i.kind==="file");if(e!=="drop")return a;const r=yield Promise.all(a.map(Di));return Cn(va(r))}return Cn(Kt(n.files).map(a=>Qe(a)))})}function Cn(n){return n.filter(e=>Ti.indexOf(e.name)===-1)}function Kt(n){if(n===null)return[];const e=[];for(let a=0;a<n.length;a++){const r=n[a];e.push(r)}return e}function Di(n){if(typeof n.webkitGetAsEntry!="function")return Tn(n);const e=n.webkitGetAsEntry();return e&&e.isDirectory?ya(e):Tn(n,e)}function va(n){return n.reduce((e,a)=>[...e,...Array.isArray(a)?va(a):[a]],[])}function Tn(n,e){return Be(this,void 0,void 0,function*(){var a;if(globalThis.isSecureContext&&typeof n.getAsFileSystemHandle=="function"){const s=yield n.getAsFileSystemHandle();if(s===null)throw new Error(`${n} is not a File`);if(s!==void 0){const o=yield s.getFile();return o.handle=s,Qe(o)}}const r=n.getAsFile();if(!r)throw new Error(`${n} is not a File`);return Qe(r,(a=e?.fullPath)!==null&&a!==void 0?a:void 0)})}function Oi(n){return Be(this,void 0,void 0,function*(){return n.isDirectory?ya(n):$i(n)})}function ya(n){const e=n.createReader();return new Promise((a,r)=>{const i=[];function s(){e.readEntries(o=>Be(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(Oi));i.push(l),s()}else try{const l=yield Promise.all(i);a(l)}catch(l){r(l)}}),o=>{r(o)})}s()})}function $i(n){return Be(this,void 0,void 0,function*(){return new Promise((e,a)=>{n.file(r=>{const i=Qe(r,n.fullPath);e(i)},r=>{a(r)})})})}var Bt=function(n,e){if(n&&e){var a=Array.isArray(e)?e:e.split(",");if(a.length===0)return!0;var r=n.name||"",i=(n.type||"").toLowerCase(),s=i.replace(/\/.*$/,"");return a.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?r.toLowerCase().endsWith(l):l.endsWith("/*")?s===l.replace(/\/.*$/,""):i===l})}return!0};function En(n){return Li(n)||Fi(n)||ka(n)||_i()}function _i(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fi(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Li(n){if(Array.isArray(n))return Qt(n)}function Pn(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),a.push.apply(a,r)}return a}function An(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Pn(Object(a),!0).forEach(function(r){wa(n,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Pn(Object(a)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(a,r))})}return n}function wa(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function st(n,e){return Ui(n)||Bi(n,e)||ka(n,e)||zi()}function zi(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ka(n,e){if(n){if(typeof n=="string")return Qt(n,e);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qt(n,e)}}function Qt(n,e){(e==null||e>n.length)&&(e=n.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=n[a];return r}function Bi(n,e){var a=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var r=[],i=!0,s=!1,o,l;try{for(a=a.call(n);!(i=(o=a.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,l=c}finally{try{!i&&a.return!=null&&a.return()}finally{if(s)throw l}}return r}}function Ui(n){if(Array.isArray(n))return n}var qi=typeof Bt=="function"?Bt:Bt.default,Hi="file-invalid-type",Wi="file-too-large",Gi="file-too-small",Vi="too-many-files",Xi=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=e.split(","),r=a.length>1?"one of ".concat(a.join(", ")):a[0];return{code:Hi,message:"File type must be ".concat(r)}},Rn=function(e){return{code:Wi,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},Mn=function(e){return{code:Gi,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Ki={code:Vi,message:"Too many files"};function ja(n,e){var a=n.type==="application/x-moz-file"||qi(n,e);return[a,a?null:Xi(e)]}function Na(n,e,a){if($e(n.size))if($e(e)&&$e(a)){if(n.size>a)return[!1,Rn(a)];if(n.size<e)return[!1,Mn(e)]}else{if($e(e)&&n.size<e)return[!1,Mn(e)];if($e(a)&&n.size>a)return[!1,Rn(a)]}return[!0,null]}function $e(n){return n!=null}function Qi(n){var e=n.files,a=n.accept,r=n.minSize,i=n.maxSize,s=n.multiple,o=n.maxFiles,l=n.validator;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(c){var m=ja(c,a),p=st(m,1),h=p[0],u=Na(c,r,i),f=st(u,1),g=f[0],v=l?l(c):null;return h&&g&&!v})}function Nt(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function gt(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!n.target&&!!n.target.files}function In(n){n.preventDefault()}function Yi(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function Ji(n){return n.indexOf("Edge/")!==-1}function Zi(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Yi(n)||Ji(n)}function ke(){for(var n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.some(function(l){return!Nt(r)&&l&&l.apply(void 0,[r].concat(s)),Nt(r)})}}function es(){return"showOpenFilePicker"in window}function ts(n){if($e(n)){var e=Object.entries(n).filter(function(a){var r=st(a,2),i=r[0],s=r[1],o=!0;return Sa(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(s)||!s.every(Ca))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(a,r){var i=st(r,2),s=i[0],o=i[1];return An(An({},a),{},wa({},s,o))},{});return[{description:"Files",accept:e}]}return n}function ns(n){if($e(n))return Object.entries(n).reduce(function(e,a){var r=st(a,2),i=r[0],s=r[1];return[].concat(En(e),[i],En(s))},[]).filter(function(e){return Sa(e)||Ca(e)}).join(",")}function as(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function rs(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}function Sa(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||n==="application/*"||/\w+\/[-+.\w]+/g.test(n)}function Ca(n){return/^.*\.[\w]+$/.test(n)}var is=["children"],ss=["open"],os=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],ls=["refKey","onChange","onClick"];function cs(n){return us(n)||ms(n)||Ta(n)||ds()}function ds(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ms(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function us(n){if(Array.isArray(n))return Yt(n)}function Ut(n,e){return gs(n)||hs(n,e)||Ta(n,e)||ps()}function ps(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ta(n,e){if(n){if(typeof n=="string")return Yt(n,e);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Yt(n,e)}}function Yt(n,e){(e==null||e>n.length)&&(e=n.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=n[a];return r}function hs(n,e){var a=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var r=[],i=!0,s=!1,o,l;try{for(a=a.call(n);!(i=(o=a.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,l=c}finally{try{!i&&a.return!=null&&a.return()}finally{if(s)throw l}}return r}}function gs(n){if(Array.isArray(n))return n}function Dn(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),a.push.apply(a,r)}return a}function re(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Dn(Object(a),!0).forEach(function(r){Jt(n,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Dn(Object(a)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(a,r))})}return n}function Jt(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function St(n,e){if(n==null)return{};var a=fs(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(a[r]=n[r])}return a}function fs(n,e){if(n==null)return{};var a={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(a[i]=n[i]);return a}var sn=d.forwardRef(function(n,e){var a=n.children,r=St(n,is),i=Pa(r),s=i.open,o=St(i,ss);return d.useImperativeHandle(e,function(){return{open:s}},[s]),Z.createElement(d.Fragment,null,a(re(re({},o),{},{open:s})))});sn.displayName="Dropzone";var Ea={disabled:!1,getFilesFromEvent:Ei,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};sn.defaultProps=Ea;sn.propTypes={children:J.func,accept:J.objectOf(J.arrayOf(J.string)),multiple:J.bool,preventDropOnDocument:J.bool,noClick:J.bool,noKeyboard:J.bool,noDrag:J.bool,noDragEventsBubbling:J.bool,minSize:J.number,maxSize:J.number,maxFiles:J.number,disabled:J.bool,getFilesFromEvent:J.func,onFileDialogCancel:J.func,onFileDialogOpen:J.func,useFsAccessApi:J.bool,autoFocus:J.bool,onDragEnter:J.func,onDragLeave:J.func,onDragOver:J.func,onDrop:J.func,onDropAccepted:J.func,onDropRejected:J.func,onError:J.func,validator:J.func};var Zt={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Pa(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=re(re({},Ea),n),a=e.accept,r=e.disabled,i=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,l=e.multiple,c=e.maxFiles,m=e.onDragEnter,p=e.onDragLeave,h=e.onDragOver,u=e.onDrop,f=e.onDropAccepted,g=e.onDropRejected,v=e.onFileDialogCancel,k=e.onFileDialogOpen,I=e.useFsAccessApi,T=e.autoFocus,F=e.preventDropOnDocument,x=e.noClick,y=e.noKeyboard,j=e.noDrag,C=e.noDragEventsBubbling,w=e.onError,E=e.validator,A=d.useMemo(function(){return ns(a)},[a]),P=d.useMemo(function(){return ts(a)},[a]),$=d.useMemo(function(){return typeof k=="function"?k:On},[k]),b=d.useMemo(function(){return typeof v=="function"?v:On},[v]),N=d.useRef(null),S=d.useRef(null),M=d.useReducer(xs,Zt),D=Ut(M,2),O=D[0],R=D[1],L=O.isFocused,X=O.isFileDialogActive,W=d.useRef(typeof window<"u"&&window.isSecureContext&&I&&es()),ee=function(){!W.current&&X&&setTimeout(function(){if(S.current){var q=S.current.files;q.length||(R({type:"closeDialog"}),b())}},300)};d.useEffect(function(){return window.addEventListener("focus",ee,!1),function(){window.removeEventListener("focus",ee,!1)}},[S,X,b,W]);var Y=d.useRef([]),ge=function(q){N.current&&N.current.contains(q.target)||(q.preventDefault(),Y.current=[])};d.useEffect(function(){return F&&(document.addEventListener("dragover",In,!1),document.addEventListener("drop",ge,!1)),function(){F&&(document.removeEventListener("dragover",In),document.removeEventListener("drop",ge))}},[N,F]),d.useEffect(function(){return!r&&T&&N.current&&N.current.focus(),function(){}},[N,T,r]);var ce=d.useCallback(function(_){w?w(_):console.error(_)},[w]),Ee=d.useCallback(function(_){_.preventDefault(),_.persist(),V(_),Y.current=[].concat(cs(Y.current),[_.target]),gt(_)&&Promise.resolve(i(_)).then(function(q){if(!(Nt(_)&&!C)){var ae=q.length,se=ae>0&&Qi({files:q,accept:A,minSize:o,maxSize:s,multiple:l,maxFiles:c,validator:E}),de=ae>0&&!se;R({isDragAccept:se,isDragReject:de,isDragActive:!0,type:"setDraggedFiles"}),m&&m(_)}}).catch(function(q){return ce(q)})},[i,m,ce,C,A,o,s,l,c,E]),Pe=d.useCallback(function(_){_.preventDefault(),_.persist(),V(_);var q=gt(_);if(q&&_.dataTransfer)try{_.dataTransfer.dropEffect="copy"}catch{}return q&&h&&h(_),!1},[h,C]),z=d.useCallback(function(_){_.preventDefault(),_.persist(),V(_);var q=Y.current.filter(function(se){return N.current&&N.current.contains(se)}),ae=q.indexOf(_.target);ae!==-1&&q.splice(ae,1),Y.current=q,!(q.length>0)&&(R({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),gt(_)&&p&&p(_))},[N,p,C]),B=d.useCallback(function(_,q){var ae=[],se=[];_.forEach(function(de){var me=ja(de,A),ue=Ut(me,2),De=ue[0],Ue=ue[1],Oe=Na(de,o,s),lt=Ut(Oe,2),Rt=lt[0],Mt=lt[1],It=E?E(de):null;if(De&&Rt&&!It)ae.push(de);else{var Dt=[Ue,Mt];It&&(Dt=Dt.concat(It)),se.push({file:de,errors:Dt.filter(function(Oa){return Oa})})}}),(!l&&ae.length>1||l&&c>=1&&ae.length>c)&&(ae.forEach(function(de){se.push({file:de,errors:[Ki]})}),ae.splice(0)),R({acceptedFiles:ae,fileRejections:se,isDragReject:se.length>0,type:"setFiles"}),u&&u(ae,se,q),se.length>0&&g&&g(se,q),ae.length>0&&f&&f(ae,q)},[R,l,A,o,s,c,u,f,g,E]),Q=d.useCallback(function(_){_.preventDefault(),_.persist(),V(_),Y.current=[],gt(_)&&Promise.resolve(i(_)).then(function(q){Nt(_)&&!C||B(q,_)}).catch(function(q){return ce(q)}),R({type:"reset"})},[i,B,ce,C]),K=d.useCallback(function(){if(W.current){R({type:"openDialog"}),$();var _={multiple:l,types:P};window.showOpenFilePicker(_).then(function(q){return i(q)}).then(function(q){B(q,null),R({type:"closeDialog"})}).catch(function(q){as(q)?(b(q),R({type:"closeDialog"})):rs(q)?(W.current=!1,S.current?(S.current.value=null,S.current.click()):ce(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):ce(q)});return}S.current&&(R({type:"openDialog"}),$(),S.current.value=null,S.current.click())},[R,$,b,I,B,ce,P,l]),G=d.useCallback(function(_){!N.current||!N.current.isEqualNode(_.target)||(_.key===" "||_.key==="Enter"||_.keyCode===32||_.keyCode===13)&&(_.preventDefault(),K())},[N,K]),ie=d.useCallback(function(){R({type:"focus"})},[]),Ae=d.useCallback(function(){R({type:"blur"})},[]),we=d.useCallback(function(){x||(Zi()?setTimeout(K,0):K())},[x,K]),pe=function(q){return r?null:q},fe=function(q){return y?null:pe(q)},H=function(q){return j?null:pe(q)},V=function(q){C&&q.stopPropagation()},te=d.useMemo(function(){return function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},q=_.refKey,ae=q===void 0?"ref":q,se=_.role,de=_.onKeyDown,me=_.onFocus,ue=_.onBlur,De=_.onClick,Ue=_.onDragEnter,Oe=_.onDragOver,lt=_.onDragLeave,Rt=_.onDrop,Mt=St(_,os);return re(re(Jt({onKeyDown:fe(ke(de,G)),onFocus:fe(ke(me,ie)),onBlur:fe(ke(ue,Ae)),onClick:pe(ke(De,we)),onDragEnter:H(ke(Ue,Ee)),onDragOver:H(ke(Oe,Pe)),onDragLeave:H(ke(lt,z)),onDrop:H(ke(Rt,Q)),role:typeof se=="string"&&se!==""?se:"presentation"},ae,N),!r&&!y?{tabIndex:0}:{}),Mt)}},[N,G,ie,Ae,we,Ee,Pe,z,Q,y,j,r]),Je=d.useCallback(function(_){_.stopPropagation()},[]),Ze=d.useMemo(function(){return function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},q=_.refKey,ae=q===void 0?"ref":q,se=_.onChange,de=_.onClick,me=St(_,ls),ue=Jt({accept:A,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:pe(ke(se,Q)),onClick:pe(ke(de,Je)),tabIndex:-1},ae,S);return re(re({},ue),me)}},[S,a,l,Q,r]);return re(re({},O),{},{isFocused:L&&!r,getRootProps:te,getInputProps:Ze,rootRef:N,inputRef:S,open:pe(K)})}function xs(n,e){switch(e.type){case"focus":return re(re({},n),{},{isFocused:!0});case"blur":return re(re({},n),{},{isFocused:!1});case"openDialog":return re(re({},Zt),{},{isFileDialogActive:!0});case"closeDialog":return re(re({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":return re(re({},n),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return re(re({},n),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return re({},Zt);default:return n}}function On(){}class bs{screenshots=[];gridSlots=[null,null,null,null];maxScreenshots=4;constructor(e=4){this.maxScreenshots=e}addScreenshot(e){this.screenshots.length>=this.maxScreenshots&&(console.warn(`Maximum ${this.maxScreenshots} screenshots reached. Replacing oldest.`),this.screenshots.shift()),this.screenshots.push(e),console.log(`Screenshot added. Total: ${this.screenshots.length}/${this.maxScreenshots}`)}setGrid(e){const a=[null,null,null,null];for(let r=0;r<4;r++)a[r]=e[r]||null;this.gridSlots=a,this.screenshots=this.gridSlots.filter(r=>r!==null)}removeScreenshot(e){const a=this.screenshots.findIndex(r=>r.id===e);return a!==-1?(this.screenshots.splice(a,1),console.log(`Screenshot removed. Remaining: ${this.screenshots.length}`),!0):!1}getScreenshots(){return[...this.screenshots]}getScreenshotCount(){return this.screenshots.length}canAddMore(){return this.screenshots.length<this.maxScreenshots}clear(){this.screenshots=[],this.gridSlots=[null,null,null,null],console.log("All screenshots cleared")}async combineScreenshots(){if(this.screenshots.length===0)throw new Error("No screenshots to combine");console.log(`Combining ${this.screenshots.length} screenshots into 2x2 grid (10x10 cm)...`);try{const a={dataUrl:await this.createCombinedCanvas(),width:0,height:0,screenshotCount:this.screenshots.length,timestamp:Date.now()};return console.log(`âœ… Successfully combined ${this.screenshots.length} screenshots`),a}catch(e){throw console.error("Failed to combine screenshots:",e),new Error(`Screenshot combination failed: ${e instanceof Error?e.message:"Unknown error"}`)}}drawCombinedCanvas(){return new Promise((e,a)=>{try{const r=document.createElement("canvas"),i=r.getContext("2d");if(!i){a(new Error("Could not get canvas context"));return}const s=96/2.54,o=Math.round(10*s),l=Math.round(5*s),c=Math.max(1,Math.floor(window.devicePixelRatio||1));r.width=o*c,r.height=o*c,i.scale(c,c),console.log(`Canvas dimensions: ${o}x${o} (CSS px), DPR=${c}`),i.fillStyle="#ffffff",i.fillRect(0,0,o,o);const m=(g,v,k,I)=>{i.save(),i.beginPath(),i.rect(v,k,I,I),i.clip();const T=Math.max(I/g.width,I/g.height),F=g.width*T,x=g.height*T,y=v+(I-F)/2,j=k+(I-x)/2;i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(g,y,j,F,x),i.restore()},p=this.gridSlots,h=[null,null,null,null];let u=p.filter(Boolean).length;if(u===0){e(r);return}const f=()=>{if(u--,u===0){const g=[{x:0,y:0},{x:l,y:0},{x:0,y:l},{x:l,y:l}];for(let v=0;v<4;v++){const k=h[v];if(!k)continue;const I=g[v];m(k,I.x,I.y,l),console.log(`Drew slot ${v+1} at (${I.x}, ${I.y}), cell ${l}x${l}`)}console.log("âœ… Canvas combination completed"),e(r)}};p.forEach((g,v)=>{if(!g)return;const k=new Image;k.onload=()=>{h[v]=k,console.log(`Loaded slot ${v+1} image - ${k.width}x${k.height}`),f()},k.onerror=I=>{console.error(`Failed to load slot ${v+1} image:`,I),h[v]=null,f()},k.src=g.dataUrl})}catch(r){console.error("Error setting up canvas combination:",r),a(r)}})}createCombinedCanvas(){return this.drawCombinedCanvas().then(e=>e.toDataURL("image/png"))}async copyToClipboard(){if(this.screenshots.length===0)throw new Error("No screenshots to copy");try{const e=await this.drawCombinedCanvas(),a=await new Promise((i,s)=>{e.toBlob(o=>o?i(o):s(new Error("toBlob failed")),"image/png")}),r=new ClipboardItem({"image/png":a});await navigator.clipboard.write([r]),console.log("âœ… Combined screenshot copied to clipboard")}catch(e){throw console.error("Failed to copy to clipboard:",e),new Error(`Clipboard copy failed: ${e instanceof Error?e.message:"Unknown error"}`)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}}const vs=({isOpen:n,onClose:e})=>{const[a,r]=d.useState([null,null,null,null]),[i,s]=d.useState(!1),[o,l]=d.useState(null),[c,m]=d.useState(0),p=d.useRef(new bs(4)),h=d.useRef(null);if(!n)return null;const u=()=>{r([null,null,null,null]),s(!1),p.current.clear(),m(0);try{chrome.tabs.query({active:!0,currentWindow:!0},y=>{const j=y?.[0]?.id;j&&chrome.tabs.sendMessage(j,{type:"SET_FILE_DROP_GUARD",enabled:!1})})}catch{}e()};d.useEffect(()=>{const y=async j=>{try{const w=(await chrome.tabs.query({active:!0,currentWindow:!0}))?.[0]?.id;w&&await chrome.tabs.sendMessage(w,{type:"SET_FILE_DROP_GUARD",enabled:j})}catch(C){console.warn("SET_FILE_DROP_GUARD send failed (likely non-EMR tab):",C)}try{await chrome.runtime.sendMessage({type:"SET_FILE_DROP_GUARD",enabled:j})}catch(C){console.warn("SET_FILE_DROP_GUARD to background failed:",C)}};return n&&y(!0),()=>{y(!1)}},[n]);const f=d.useCallback((y,j)=>{if(!y.type.startsWith("image/")){oe.getInstance().error("Invalid File","Please select an image file (PNG, JPG, GIF)");return}const C=new FileReader;C.onload=w=>{const E=w.target?.result,A=new Image;A.onload=()=>{const P={id:`slot-${j}-${Date.now()}`,dataUrl:E,timestamp:Date.now(),width:A.width,height:A.height};r($=>{const b=[...$];return b[j]=P,b}),oe.getInstance().success("Image Added",`Screenshot ${j+1} loaded successfully`)},A.src=E},C.readAsDataURL(y)},[]);d.useEffect(()=>{m(y=>{if(y!=null&&a[y]===null)return y;const j=a.findIndex(C=>C===null);return j>=0?j:y??0})},[a]),d.useEffect(()=>{try{const y=(c??0)+1;chrome.runtime.sendMessage({type:"SET_DROP_HINT",data:{slot:y}})}catch{}},[c]),d.useCallback((y,j)=>{y.preventDefault(),console.log("ðŸŽ¯ Drag enter on drop zone",j),l(j)},[]),d.useCallback((y,j)=>{if(y.preventDefault(),y.dataTransfer)try{y.dataTransfer.dropEffect="copy"}catch{}l(j)},[]),d.useCallback(y=>{y.preventDefault(),console.log("ðŸš« Drag leave drop zone"),l(null)},[]),d.useCallback((y,j)=>{if(y.preventDefault(),y.dataTransfer)try{y.dataTransfer.dropEffect="copy"}catch{}if(console.log("ðŸŽ¯ Drop event triggered on zone",j,"with files:",y.dataTransfer?.files?.length??0),l(null),!y.dataTransfer)return console.log("âŒ No dataTransfer on drag event"),oe.getInstance().error("No Files","No files were detected in the drag operation"),!1;let C=[];if(y.dataTransfer.files&&y.dataTransfer.files.length>0)C=Array.from(y.dataTransfer.files);else if(y.dataTransfer.items&&y.dataTransfer.items.length>0){const E=[];for(const A of Array.from(y.dataTransfer.items))if(A.kind==="file"){const P=A.getAsFile();P&&E.push(P)}C=E}if(!C.length)return console.log("âŒ No file items present in drag operation"),oe.getInstance().error("No Files","No files were detected in the drag operation"),!1;console.log("ðŸ“ Files detected:",C.map(E=>`${E.name} (${E.type})`));const w=C.find(E=>E.type.startsWith("image/"));return w?(console.log("âœ… Processing image file:",w.name,w.type),f(w,j)):(console.log("âŒ No valid image files found"),oe.getInstance().error("Invalid File","Please drop an image file (PNG, JPG, GIF)")),!1},[f]),d.useCallback((y,j)=>{const C=y.target.files;C&&C.length>0&&f(C[0],j),y.target.value=""},[f]);const g=d.useCallback(y=>{r(j=>{const C=[...j];return C[y]=null,C}),oe.getInstance().success("Screenshot Removed",`Slot ${y+1} cleared`)},[]),v=d.useCallback((y,j)=>{try{const C=new Image;C.onload=()=>{const w={id:`slot-${j}-${Date.now()}`,dataUrl:y,timestamp:Date.now(),width:C.width,height:C.height};r(E=>{const A=[...E];return A[j]=w,A}),oe.getInstance().success("Image Added",`Screenshot ${j+1} loaded successfully`)},C.src=y}catch(C){console.error("Failed to import data URL image",C),oe.getInstance().error("Import Failed","Could not load dropped image")}},[]);d.useEffect(()=>{const y=j=>{if(j?.type==="PAGE_FILE_DROPPED"&&j.payload?.dataUrl){let C=c;if(C==null||a[C]!==null){const w=a.findIndex(E=>E===null);C=w>=0?w:0}v(j.payload.dataUrl,C)}};return chrome.runtime.onMessage.addListener(y),()=>chrome.runtime.onMessage.removeListener(y)},[a,c,v]);const k=({index:y,screenshot:j})=>{const C=d.useCallback(b=>{console.log("ðŸ“¥ react-dropzone onDrop accepted:",b.map(N=>`${N.name} (${N.type||"unknown"})`)),b&&b.length>0?f(b[0],y):oe.getInstance().error("Invalid File","Please drop an image file (PNG, JPG, GIF)")},[f,y]),{getRootProps:w,getInputProps:E,isDragActive:A,open:P}=Pa({onDrop:C,onDragEnter:()=>{console.log("ðŸŸ¦ dropzone dragenter",y),l(y)},onDragOver:()=>{l(y)},onDragLeave:()=>{console.log("â¬œ dropzone dragleave",y),l(b=>b===y?null:b)},accept:{"image/*":[]},multiple:!1,noKeyboard:!0,useFsAccessApi:!1}),$=A||o===y;return t.jsxs("div",{...w({className:`
          relative aspect-video rounded-lg border-2 border-dashed cursor-pointer transition-all duration-200
          ${$?"border-blue-500 bg-blue-50 scale-105":j?"border-gray-300 bg-gray-50":"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-25"} ${c===y?"ring-2 ring-blue-500":""}
        `,onClick:b=>{b.preventDefault(),m(y),P()},"data-drop-zone":"true"}),children:[t.jsx("input",{...E({accept:"image/*"})}),j?t.jsxs("div",{className:"relative w-full h-full group",children:[t.jsx("img",{src:j.dataUrl,alt:`Screenshot ${y+1}`,className:"w-full h-full object-cover rounded-lg",draggable:!1,onDragStart:b=>b.preventDefault()}),t.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:y+1}),t.jsx("button",{onClick:b=>{b.preventDefault(),b.stopPropagation(),g(y)},className:"absolute top-2 left-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx(xe,{className:"w-3 h-3"})}),t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 rounded-lg transition-all"})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center",children:[t.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-3 ${$?"bg-blue-200":"bg-gray-200"}`,children:$?t.jsx(or,{className:"w-6 h-6 text-blue-600"}):t.jsx(lr,{className:"w-6 h-6 text-gray-500"})}),t.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-1 flex items-center justify-center gap-2",children:[t.jsxs("span",{children:["Slot ",y+1]}),c===y&&t.jsx("span",{className:"text-xs text-blue-600 font-semibold",children:"Next"})]}),t.jsx("div",{className:"text-xs text-gray-500",children:$?"Drop image here":"Drag image or click"})]})]})},I=d.useCallback(async()=>{if(!a.some(j=>j!==null)){oe.getInstance().error("No Screenshots","Please add at least one screenshot to combine");return}s(!0);try{p.current.clear(),p.current.setGrid(a),await p.current.copyToClipboard();const j=a.filter(Boolean).length;oe.getInstance().success("Screenshots Combined!",`${j} screenshots combined and copied to clipboard`)}catch(j){console.error("Failed to combine and copy screenshots:",j),oe.getInstance().error("Combine Failed",j instanceof Error?j.message:"Failed to combine screenshots")}finally{s(!1)}},[a]),T=d.useCallback(()=>{r([null,null,null,null]),m(0),p.current.clear(),oe.getInstance().success("Cleared","All screenshots removed")},[]),F=a.filter(y=>y!==null).length,x=F>0&&!i;return d.useEffect(()=>{const y=C=>{C.preventDefault()},j=C=>{C.target?.closest('[data-drop-zone="true"]')||C.preventDefault()};return window.addEventListener("dragover",y,!0),window.addEventListener("drop",y,!0),window.addEventListener("dragenter",j,!0),()=>{window.removeEventListener("dragover",y,!0),window.removeEventListener("drop",y,!0),window.removeEventListener("dragenter",j,!0)}},[]),t.jsx("div",{ref:h,className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center",onClick:y=>{y.target===y.currentTarget&&u()},children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx(qn,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Screenshot Combiner"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Drag and drop up to 4 screenshots to combine them"})]})]}),t.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(xe,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"px-6 py-4 border-b border-gray-100 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-600",children:F===0?"No screenshots added yet":`${F}/4 screenshots ready`}),i&&t.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-sm",children:"Combining..."})]})]})}),t.jsxs("div",{className:"flex-1 p-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.jsx(k,{index:0,screenshot:a[0]}),t.jsx(k,{index:1,screenshot:a[1]}),t.jsx(k,{index:2,screenshot:a[2]}),t.jsx(k,{index:3,screenshot:a[3]})]}),t.jsxs("div",{className:"text-center text-sm text-gray-600 space-y-2",children:[t.jsx("p",{children:"Drag screenshots from your desktop or click to browse files."}),t.jsx("p",{children:"Supports PNG, JPG, and GIF formats. Screenshots will be combined vertically."})]})]}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[t.jsx("div",{className:"flex items-center space-x-2",children:F>0&&t.jsxs("button",{onClick:T,className:"flex items-center space-x-2 px-3 py-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:[t.jsx(Tt,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Clear All"})]})}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:u,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Close"}),t.jsxs("button",{onClick:I,disabled:!x||i,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[i?t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):t.jsx(Fn,{className:"w-4 h-4"}),t.jsx("span",{children:i?"Combining...":"Combine & Copy"})]})]})]})]})})},Aa={isRecording:!1,isProcessing:!1,currentAgent:null,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,missingInfo:null,missingInfoAnswers:{},processingStatus:"idle",voiceActivityLevel:0,frequencyData:[],modelStatus:{isConnected:!1,classifierModel:"",processorModel:"",lastPing:0,latency:0},recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,currentAgentName:null,processingStartTime:null,failedAudioRecordings:[],reviewData:null,patientVersion:null,isGeneratingPatientVersion:!1,patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null,ui:{activeWorkflow:null,isCancelling:!1,showAlerts:!0,showPatientSelectionModal:!1,showScreenshotAnnotationModal:!1,showPatientEducationConfig:!1,showMainMenu:!1,showRecordingPrompts:!1,showMetricsDashboard:!1,isExtractingPatients:!1,isBatchProcessing:!1,showFieldIngestionOverlay:!1,showProcessingPhase:!1,processingProgress:0,processingStartTime:0,warnings:[],errors:[],resultSummary:"",calendarData:null,extractError:null,batchProcessingProgress:null}};function ys(n,e){switch(e.type){case"SET_RECORDING":return n.isRecording===e.payload?n:{...n,isRecording:e.payload};case"SET_PROCESSING":return n.isProcessing===e.payload?n:{...n,isProcessing:e.payload};case"SET_CURRENT_AGENT":return n.currentAgent===e.payload?n:{...n,currentAgent:e.payload};case"SET_TRANSCRIPTION":return n.transcription===e.payload?n:{...n,transcription:e.payload};case"SET_RESULTS":return n.results===e.payload?n:{...n,results:e.payload};case"SET_RESULTS_SUMMARY":return n.resultsSummary===e.payload?n:{...n,resultsSummary:e.payload};case"SET_AI_GENERATED_SUMMARY":return n.aiGeneratedSummary===e.payload?n:{...n,aiGeneratedSummary:e.payload};case"SET_MISSING_INFO":return{...n,missingInfo:e.payload};case"SET_MISSING_INFO_ANSWERS":return{...n,missingInfoAnswers:e.payload};case"CLEAR_MISSING_INFO":return{...n,missingInfo:null,missingInfoAnswers:{}};case"SET_PROCESSING_STATUS":return n.processingStatus===e.payload?n:{...n,processingStatus:e.payload};case"SET_VOICE_ACTIVITY":return Date.now()-(n.modelStatus.lastPing||0)<200?n:{...n,voiceActivityLevel:e.payload.level,frequencyData:e.payload.frequencyData,modelStatus:{...n.modelStatus,lastPing:Date.now()}};case"SET_MODEL_STATUS":return{...n,modelStatus:e.payload};case"SET_TIMING_DATA":return{...n,...e.payload};case"SET_CURRENT_AGENT_NAME":return n.currentAgentName===e.payload?n:{...n,currentAgentName:e.payload};case"SET_FAILED_RECORDINGS":return{...n,failedAudioRecordings:e.payload};case"SET_REVIEW_DATA":return{...n,reviewData:e.payload};case"SET_ACTIVE_WORKFLOW":return n.ui.activeWorkflow===e.payload?n:{...n,ui:{...n.ui,activeWorkflow:e.payload}};case"SET_CANCELLING":return n.ui.isCancelling===e.payload?n:{...n,ui:{...n.ui,isCancelling:e.payload}};case"SET_WARNINGS":return{...n,ui:{...n.ui,warnings:e.payload}};case"SET_ERRORS":return{...n,ui:{...n.ui,errors:e.payload}};case"SET_ALERTS_VISIBLE":return n.ui.showAlerts===e.payload?n:{...n,ui:{...n.ui,showAlerts:e.payload}};case"SET_RESULT_SUMMARY":return n.ui.resultSummary===e.payload?n:{...n,ui:{...n.ui,resultSummary:e.payload}};case"SET_PATIENT_MODAL":return n.ui.showPatientSelectionModal===e.payload?n:{...n,ui:{...n.ui,showPatientSelectionModal:e.payload}};case"SET_SCREENSHOT_ANNOTATION_MODAL":return n.ui.showScreenshotAnnotationModal===e.payload?n:{...n,ui:{...n.ui,showScreenshotAnnotationModal:e.payload}};case"SET_PATIENT_EDUCATION_CONFIG":return n.ui.showPatientEducationConfig===e.payload?n:{...n,ui:{...n.ui,showPatientEducationConfig:e.payload}};case"SET_MAIN_MENU":return n.ui.showMainMenu===e.payload?n:{...n,ui:{...n.ui,showMainMenu:e.payload}};case"SET_RECORDING_PROMPTS":return n.ui.showRecordingPrompts===e.payload?n:{...n,ui:{...n.ui,showRecordingPrompts:e.payload}};case"SET_METRICS_DASHBOARD":return n.ui.showMetricsDashboard===e.payload?n:{...n,ui:{...n.ui,showMetricsDashboard:e.payload}};case"SET_CALENDAR_DATA":return{...n,ui:{...n.ui,calendarData:e.payload}};case"SET_EXTRACTING_PATIENTS":return n.ui.isExtractingPatients===e.payload?n:{...n,ui:{...n.ui,isExtractingPatients:e.payload}};case"SET_EXTRACT_ERROR":return n.ui.extractError===e.payload?n:{...n,ui:{...n.ui,extractError:e.payload}};case"SET_BATCH_PROCESSING":return n.ui.isBatchProcessing===e.payload?n:{...n,ui:{...n.ui,isBatchProcessing:e.payload}};case"SET_BATCH_PROGRESS":return{...n,ui:{...n.ui,batchProcessingProgress:e.payload}};case"SET_PROCESSING_START_TIME":return{...n,processingStartTime:e.payload};case"RESET_STATE":return Aa;case"CLEAR_RECORDING":return console.log("ðŸ”„ CLEAR_RECORDING: Clearing state for new recording",{hadResults:!!n.results,hadReviewData:!!n.reviewData,currentAgent:n.currentAgent,processingStatus:n.processingStatus}),{...n,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,processingStatus:"idle",currentAgent:null,currentAgentName:null,recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,processingStartTime:null,reviewData:null,ui:{...n.ui,activeWorkflow:null,warnings:[],errors:[],resultSummary:"",isCancelling:!1}};case"SET_CURRENT_PATIENT_INFO":return{...n,currentPatientInfo:e.payload};case"ADD_PATIENT_SESSION":return{...n,patientSessions:[e.payload,...n.patientSessions]};case"UPDATE_PATIENT_SESSION":return{...n,patientSessions:n.patientSessions.map(r=>r.id===e.payload.id?{...r,...e.payload.updates}:r)};case"REMOVE_PATIENT_SESSION":return{...n,patientSessions:n.patientSessions.filter(r=>r.id!==e.payload)};case"CLEAR_PATIENT_SESSIONS":return{...n,patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null};case"SET_CURRENT_SESSION_ID":return{...n,currentSessionId:e.payload};case"SET_SELECTED_SESSION_ID":return{...n,selectedSessionId:e.payload};case"SET_FIELD_INGESTION_OVERLAY":return{...n,ui:{...n.ui,showFieldIngestionOverlay:e.payload}};case"SET_PROCESSING_PHASE":return{...n,ui:{...n.ui,showProcessingPhase:e.payload}};case"SET_PROCESSING_PROGRESS":return{...n,ui:{...n.ui,processingProgress:e.payload}};case"SET_AI_REVIEW_START_TIME":return{...n,ui:{...n.ui,processingStartTime:e.payload}};case"SET_PATIENT_VERSION":return n.patientVersion===e.payload?n:{...n,patientVersion:e.payload};case"SET_GENERATING_PATIENT_VERSION":return n.isGeneratingPatientVersion===e.payload?n:{...n,isGeneratingPatientVersion:e.payload};default:return n}}function ws(){const[n,e]=d.useReducer(ys,Aa),a=d.useRef(0),r={setRecording:d.useCallback(i=>{e({type:"SET_RECORDING",payload:i})},[]),setProcessing:d.useCallback(i=>{e({type:"SET_PROCESSING",payload:i})},[]),setCurrentAgent:d.useCallback(i=>{e({type:"SET_CURRENT_AGENT",payload:i})},[]),setTranscription:d.useCallback(i=>{e({type:"SET_TRANSCRIPTION",payload:i})},[]),setResults:d.useCallback(i=>{e({type:"SET_RESULTS",payload:i})},[]),setResultsSummary:d.useCallback(i=>{e({type:"SET_RESULTS_SUMMARY",payload:i})},[]),setAiGeneratedSummary:d.useCallback(i=>{e({type:"SET_AI_GENERATED_SUMMARY",payload:i})},[]),setMissingInfo:d.useCallback(i=>{e({type:"SET_MISSING_INFO",payload:i})},[]),setMissingInfoAnswers:d.useCallback(i=>{e({type:"SET_MISSING_INFO_ANSWERS",payload:i})},[]),clearMissingInfo:d.useCallback(()=>{e({type:"CLEAR_MISSING_INFO"})},[]),setProcessingStatus:d.useCallback(i=>{e({type:"SET_PROCESSING_STATUS",payload:i})},[]),setVoiceActivity:d.useCallback((i,s)=>{const o=Date.now();o-a.current>=200&&(a.current=o,e({type:"SET_VOICE_ACTIVITY",payload:{level:i,frequencyData:s}}))},[]),setModelStatus:d.useCallback(i=>{e({type:"SET_MODEL_STATUS",payload:i})},[]),setTimingData:d.useCallback(i=>{e({type:"SET_TIMING_DATA",payload:i})},[]),setCurrentAgentName:d.useCallback(i=>{e({type:"SET_CURRENT_AGENT_NAME",payload:i})},[]),setFailedRecordings:d.useCallback(i=>{e({type:"SET_FAILED_RECORDINGS",payload:i})},[]),setReviewData:d.useCallback(i=>{e({type:"SET_REVIEW_DATA",payload:i})},[]),setActiveWorkflow:d.useCallback(i=>{e({type:"SET_ACTIVE_WORKFLOW",payload:i})},[]),setCancelling:d.useCallback(i=>{e({type:"SET_CANCELLING",payload:i})},[]),setWarnings:d.useCallback(i=>{e({type:"SET_WARNINGS",payload:i})},[]),setErrors:d.useCallback(i=>{e({type:"SET_ERRORS",payload:i})},[]),setAlertsVisible:d.useCallback(i=>{e({type:"SET_ALERTS_VISIBLE",payload:i})},[]),setResultSummary:d.useCallback(i=>{e({type:"SET_RESULT_SUMMARY",payload:i})},[]),setPatientModal:d.useCallback(i=>{e({type:"SET_PATIENT_MODAL",payload:i})},[]),setScreenshotAnnotationModal:d.useCallback(i=>{e({type:"SET_SCREENSHOT_ANNOTATION_MODAL",payload:i})},[]),setPatientEducationConfig:d.useCallback(i=>{e({type:"SET_PATIENT_EDUCATION_CONFIG",payload:i})},[]),setMainMenu:d.useCallback(i=>{e({type:"SET_MAIN_MENU",payload:i})},[]),setRecordingPrompts:d.useCallback(i=>{e({type:"SET_RECORDING_PROMPTS",payload:i})},[]),setMetricsDashboard:d.useCallback(i=>{e({type:"SET_METRICS_DASHBOARD",payload:i})},[]),setCalendarData:d.useCallback(i=>{e({type:"SET_CALENDAR_DATA",payload:i})},[]),setExtractingPatients:d.useCallback(i=>{e({type:"SET_EXTRACTING_PATIENTS",payload:i})},[]),setExtractError:d.useCallback(i=>{e({type:"SET_EXTRACT_ERROR",payload:i})},[]),setBatchProcessing:d.useCallback(i=>{e({type:"SET_BATCH_PROCESSING",payload:i})},[]),setBatchProgress:d.useCallback(i=>{e({type:"SET_BATCH_PROGRESS",payload:i})},[]),setProcessingStartTime:d.useCallback(i=>{e({type:"SET_PROCESSING_START_TIME",payload:i})},[]),resetState:d.useCallback(()=>{e({type:"RESET_STATE"})},[]),clearRecording:d.useCallback(()=>{e({type:"CLEAR_RECORDING"})},[]),setCurrentPatientInfo:d.useCallback(i=>{e({type:"SET_CURRENT_PATIENT_INFO",payload:i})},[]),addPatientSession:d.useCallback(i=>{e({type:"ADD_PATIENT_SESSION",payload:i})},[]),updatePatientSession:d.useCallback((i,s)=>{e({type:"UPDATE_PATIENT_SESSION",payload:{id:i,updates:s}})},[]),removePatientSession:d.useCallback(i=>{e({type:"REMOVE_PATIENT_SESSION",payload:i})},[]),clearPatientSessions:d.useCallback(()=>{e({type:"CLEAR_PATIENT_SESSIONS"})},[]),setCurrentSessionId:d.useCallback(i=>{e({type:"SET_CURRENT_SESSION_ID",payload:i})},[]),setSelectedSessionId:d.useCallback(i=>{e({type:"SET_SELECTED_SESSION_ID",payload:i})},[]),setFieldIngestionOverlay:d.useCallback(i=>{e({type:"SET_FIELD_INGESTION_OVERLAY",payload:i})},[]),setProcessingPhase:d.useCallback(i=>{e({type:"SET_PROCESSING_PHASE",payload:i})},[]),setProcessingProgress:d.useCallback(i=>{e({type:"SET_PROCESSING_PROGRESS",payload:i})},[]),setAIReviewStartTime:d.useCallback(i=>{e({type:"SET_AI_REVIEW_START_TIME",payload:i})},[]),setPatientVersion:d.useCallback(i=>{e({type:"SET_PATIENT_VERSION",payload:i})},[]),setGeneratingPatientVersion:d.useCallback(i=>{e({type:"SET_GENERATING_PATIENT_VERSION",payload:i})},[])};return{state:n,actions:r}}class Ra{static defaultConfig={enabledForAllAgents:!0,alwaysEnabledForLongProcesses:!0,onlyWhenUnfocused:!1};static async showCompletionNotification(e,a,r,i){try{if(!await this.shouldShowNotification(e,a))return;await chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("assets/icons/icon-48.png"),title:this.getAgentTitle(e,i),message:this.getCompletionMessage(e,a,r)}),console.log(`ðŸ”” Notification sent: ${e} completed in ${a}ms${i?` for ${i}`:""}`)}catch(s){console.error("âŒ Failed to send notification:",s)}}static async showErrorNotification(e,a,r){try{await chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("assets/icons/icon-48.png"),title:`âŒ ${this.getAgentDisplayName(e)} Failed`,message:r||`Processing failed after ${this.formatTime(a)}. Please try again.`}),console.log(`ðŸ”” Error notification sent: ${e} failed after ${a}ms`)}catch(i){console.error("âŒ Failed to send error notification:",i)}}static async shouldShowNotification(e,a){if(a>3e4)return!0;if(!this.defaultConfig.enabledForAllAgents)return!1;if(this.defaultConfig.onlyWhenUnfocused)try{if((await chrome.windows.getAll({populate:!1})).find(s=>s.focused))return!1}catch(r){console.warn("Could not check window focus, showing notification anyway:",r)}return!0}static getAgentTitle(e,a){const i={tavi:"ðŸ«€ TAVI Report Complete","angiogram-pci":"ðŸ©º Angiogram/PCI Report Complete","quick-letter":"ðŸ’Œ Medical Letter Complete",consultation:"ðŸ‘¨â€âš•ï¸ Consultation Report Complete","investigation-summary":"ðŸ“Š Investigation Summary Complete",background:"ðŸ“‹ Background Report Complete",medication:"ðŸ’Š Medication Report Complete",bloods:"ðŸ©¸ Blood Test Order Complete",imaging:"ðŸ“· Imaging Order Complete",mteer:"ðŸ«€ mTEER Report Complete",tteer:"ðŸ«€ tTEER Report Complete","pfo-closure":"ðŸ«€ PFO Closure Report Complete","asd-closure":"ðŸ«€ ASD Closure Report Complete","right-heart-cath":"ðŸ«€ RHC Report Complete","pvl-plug":"ðŸ«€ PVL Plug Report Complete","bypass-graft":"ðŸ«€ Bypass Graft Report Complete","tavi-workup":"ðŸ«€ TAVI Workup Complete","ai-medical-review":"ðŸ” AI Medical Review Complete","batch-ai-review":"ðŸ“‹ Batch AI Review Complete","patient-education":"ðŸŽ“ Patient Education Complete",enhancement:"âœ¨ Enhancement Complete",transcription:"ðŸŽ¤ Transcription Complete",generation:"âš¡ Generation Complete"}[e]||"âœ… Medical Report Complete";return a&&a!=="unknown patient"?`${i} - ${a}`:i}static getCompletionMessage(e,a,r){const i=`Generated in ${this.formatTime(a)}`,s=this.getAgentContext(e,r);return s?`${i} â€¢ ${s}`:i}static getAgentContext(e,a){return a||{"ai-medical-review":"Review findings ready","batch-ai-review":"All patients processed","quick-letter":"Ready to copy or insert","investigation-summary":"Summary formatted for EMR",tavi:"Hemodynamics & valve assessment complete","angiogram-pci":"Vessel analysis & intervention plan ready"}[e]||"Click to view results"}static getAgentDisplayName(e){return{tavi:"TAVI Agent","angiogram-pci":"Angiogram/PCI Agent","quick-letter":"Quick Letter Agent",consultation:"Consultation Agent","investigation-summary":"Investigation Summary Agent",background:"Background Agent",medication:"Medication Agent",bloods:"Bloods Agent",imaging:"Imaging Agent",mteer:"mTEER Agent",tteer:"tTEER Agent","pfo-closure":"PFO Closure Agent","asd-closure":"ASD Closure Agent","right-heart-cath":"RHC Agent","pvl-plug":"PVL Plug Agent","bypass-graft":"Bypass Graft Agent","tavi-workup":"TAVI Workup Agent","ai-medical-review":"AI Medical Review","batch-ai-review":"Batch AI Review","patient-education":"Patient Education Agent",enhancement:"Enhancement Agent",transcription:"Transcription Agent",generation:"Generation Agent"}[e]||e.toUpperCase()}static formatTime(e){if(e<1e3)return`${e}ms`;if(e<6e4)return`${(e/1e3).toFixed(1)}s`;const a=Math.floor(e/6e4),r=Math.floor(e%6e4/1e3);return r>0?`${a}m ${r}s`:`${a}m`}static updateConfig(e){this.defaultConfig={...this.defaultConfig,...e}}static getConfig(){return{...this.defaultConfig}}}class qe{static instance;defaultTimeout=15e3;defaultInterval=500;debugMode=!1;constructor(){}static getInstance(){return qe.instance||(qe.instance=new qe),qe.instance}setDebugMode(e){this.debugMode=e}async waitForPatientDataLoad(e,a,r=this.defaultTimeout){const i=[{name:"content_script_responsive",checker:()=>this.checkContentScriptResponsive(e),description:"Content script is responsive",timeout:5e3,interval:200},{name:"xestro_boxes_present",checker:()=>this.checkXestroBoxesPresent(e),description:"XestroBox elements are present",timeout:r,interval:this.defaultInterval},{name:"patient_data_populated",checker:()=>this.checkPatientDataPopulated(e,a),description:"Patient data fields are populated",timeout:r,interval:this.defaultInterval},{name:"clinical_sections_ready",checker:()=>this.checkClinicalSectionsReady(e),description:"Clinical sections have content",timeout:r,interval:this.defaultInterval}];return this.waitForMultipleConditions(i,{requireAll:!1,minConditions:2,earlyReturnOnCritical:!0})}async waitForClinicalSection(e,a,r=this.defaultTimeout){const i=[{name:`${a}_section_present`,checker:()=>this.checkSectionPresent(e,a),description:`${a} section is present in DOM`,timeout:r/2,interval:this.defaultInterval},{name:`${a}_content_loaded`,checker:()=>this.checkSectionContentLoaded(e,a),description:`${a} section has content`,timeout:r,interval:this.defaultInterval}];return this.waitForMultipleConditions(i,{requireAll:!0,minConditions:2,earlyReturnOnCritical:!1})}async waitForPatientActivation(e,a,r=1e4){const i=[{name:"patient_row_highlighted",checker:()=>this.checkPatientRowHighlighted(e,a),description:"Patient row is highlighted/selected",timeout:r/3,interval:200},{name:"patient_record_loading",checker:()=>this.checkPatientRecordLoading(e),description:"Patient record is loading",timeout:r/2,interval:this.defaultInterval},{name:"patient_record_loaded",checker:()=>this.checkPatientRecordLoaded(e),description:"Patient record is fully loaded",timeout:r,interval:this.defaultInterval}];return this.waitForMultipleConditions(i,{requireAll:!1,minConditions:1,earlyReturnOnCritical:!0,sequentialChecking:!0})}async waitForDOMStability(e,a=1e3,r=this.defaultTimeout){const i=Date.now(),s=[];let o=Date.now(),l="";for(;Date.now()-i<r;)try{const c=await this.getDOMHash(e),m=Date.now();if(c!==l)o=m,l=c,s.push({timestamp:m,conditionName:"dom_changed",passed:!1,details:"DOM structure changed"});else if(m-o>=a)return s.push({timestamp:m,conditionName:"dom_stable",passed:!0,details:`DOM stable for ${a}ms`}),{success:!0,timeElapsed:m-i,conditionMet:"dom_stable",intermediateChecks:s};await this.sleep(200)}catch(c){this.log("Error checking DOM stability:",c),await this.sleep(this.defaultInterval)}return{success:!1,timeElapsed:Date.now()-i,conditionMet:null,error:`DOM did not stabilize within ${r}ms`,intermediateChecks:s}}async waitForCondition(e,a={}){const r=Date.now(),i=[],{earlyReturn:s=!0,logProgress:o=this.debugMode}=a;for(this.log(`Starting wait for condition: ${e.name} - ${e.description}`);Date.now()-r<e.timeout;)try{const c=await e.checker(),m=Date.now();if(i.push({timestamp:m,conditionName:e.name,passed:c,details:c?"Condition met":"Condition not met"}),c){const p=m-r;return this.log(`âœ… Condition '${e.name}' met in ${p}ms`),{success:!0,timeElapsed:p,conditionMet:e.name,intermediateChecks:i}}o&&i.length%10===0&&this.log(`â³ Still waiting for '${e.name}' (${Date.now()-r}ms elapsed)`),await this.sleep(e.interval)}catch(c){i.push({timestamp:Date.now(),conditionName:e.name,passed:!1,details:`Error: ${c instanceof Error?c.message:String(c)}`}),this.log(`âŒ Error checking condition '${e.name}':`,c),await this.sleep(e.interval)}const l=Date.now()-r;return this.log(`â° Timeout waiting for condition '${e.name}' after ${l}ms`),{success:!1,timeElapsed:l,conditionMet:null,error:`Timeout waiting for condition '${e.name}'`,intermediateChecks:i}}async waitForMultipleConditions(e,a){const r=Date.now(),i=[],s=new Set,o=Math.max(...e.map(p=>p.timeout));if(this.log(`Starting multi-condition wait: ${e.length} conditions`),a.sequentialChecking)for(const p of e){const h=await this.waitForCondition(p);if(i.push(...h.intermediateChecks),h.success)s.add(p.name);else if(a.requireAll)return{success:!1,timeElapsed:Date.now()-r,conditionMet:null,error:`Sequential condition failed: ${p.name}`,intermediateChecks:i}}else for(;Date.now()-r<o;){for(const h of e)if(!s.has(h.name))try{const u=await h.checker(),f=Date.now();i.push({timestamp:f,conditionName:h.name,passed:u,details:u?"Condition met":"Condition not met"}),u&&(s.add(h.name),this.log(`âœ… Condition met: ${h.name}`))}catch(u){i.push({timestamp:Date.now(),conditionName:h.name,passed:!1,details:`Error: ${u instanceof Error?u.message:String(u)}`})}const p=s.size;if(a.requireAll&&p===e.length)break;if(!a.requireAll&&p>=a.minConditions)break;await this.sleep(Math.min(...e.map(h=>h.interval)))}const l=s.size,c=a.requireAll?l===e.length:l>=a.minConditions,m=Date.now()-r;return c?this.log(`âœ… Multi-condition wait successful: ${l}/${e.length} conditions met`):this.log(`âŒ Multi-condition wait failed: ${l}/${e.length} conditions met`),{success:c,timeElapsed:m,conditionMet:c?Array.from(s).join(", "):null,error:c?void 0:`Insufficient conditions met: ${l}/${a.minConditions}`,intermediateChecks:i}}async checkContentScriptResponsive(e){try{return!!await this.sendMessage(e,{type:"PING"},2e3)}catch{return!1}}async checkXestroBoxesPresent(e){try{return(await this.sendMessage(e,{type:"CHECK_XESTRO_BOXES"},3e3))?.found===!0}catch{return!1}}async checkPatientDataPopulated(e,a){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_DATA",data:{expectedPatientName:a}},3e3))?.populated===!0}catch{return!1}}async checkClinicalSectionsReady(e){try{return(await this.sendMessage(e,{type:"CHECK_CLINICAL_SECTIONS"},3e3))?.sectionsReady===!0}catch{return!1}}async checkSectionPresent(e,a){try{return(await this.sendMessage(e,{type:"CHECK_SECTION_PRESENT",data:{sectionType:a}},3e3))?.present===!0}catch{return!1}}async checkSectionContentLoaded(e,a){try{const r=await this.sendMessage(e,{type:"CHECK_SECTION_CONTENT",data:{sectionType:a}},3e3);return r?.hasContent===!0&&r?.wordCount>0}catch{return!1}}async checkPatientRowHighlighted(e,a){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_ROW_HIGHLIGHTED",data:{patientIndex:a}},2e3))?.highlighted===!0}catch{return!1}}async checkPatientRecordLoading(e){try{const a=await this.sendMessage(e,{type:"CHECK_PATIENT_RECORD_STATE"},2e3);return a?.state==="loading"||a?.state==="loaded"}catch{return!1}}async checkPatientRecordLoaded(e){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_RECORD_STATE"},2e3))?.state==="loaded"}catch{return!1}}async getDOMHash(e){try{return(await this.sendMessage(e,{type:"GET_DOM_HASH"},2e3))?.hash||""}catch{return""}}async sendMessage(e,a,r=5e3){return new Promise((i,s)=>{const o=setTimeout(()=>{s(new Error(`Message timeout after ${r}ms`))},r);try{chrome.tabs.sendMessage(e,a,l=>{if(clearTimeout(o),chrome.runtime.lastError){s(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}i(l)})}catch(l){clearTimeout(o),s(l)}})}async sleep(e){return new Promise(a=>setTimeout(a,e))}log(...e){this.debugMode&&console.log("[DynamicWaitUtils]",...e)}setDefaultTimeout(e){this.defaultTimeout=e}setDefaultInterval(e){this.defaultInterval=e}getDefaultTimeout(){return this.defaultTimeout}getDefaultInterval(){return this.defaultInterval}}class He{static instance;debugMode=!1;medicalTermPatterns=[];commonErrorPatterns=[];defaultConfig={fields:["background","investigations","medications"],fallbackSelectors:{background:['textarea[data-field="background"]',"#background",".background textarea",'.XestroBox:contains("Background") textarea','textarea[placeholder*="background" i]'],investigations:['textarea[data-field="investigations"]',"#investigations",".investigations textarea",'.XestroBox:contains("Investigation") textarea','textarea[placeholder*="investigation" i]'],medications:['textarea[data-field="medications"]',"#medications",".medications textarea",'.XestroBox:contains("Medication") textarea','textarea[placeholder*="medication" i]']},qualityThresholds:{minWordCount:5,minMedicalTerms:1,minCompletenessScore:.3,acceptableConfidenceLevel:"medium"},retryAttempts:3,timeout:1e4,screenshotOnFailure:!0};constructor(){this.initializeMedicalPatterns(),this.initializeErrorPatterns()}static getInstance(){return He.instance||(He.instance=new He),He.instance}async extractPatientClinicalData(e,a,r={}){const i={...this.defaultConfig,...r},s=Date.now();this.log(`ðŸ” Starting data extraction for patient: ${a.name}`);const o=await this.preExtractionValidation(e,a);if(!o.isValid)throw new Error(`Pre-extraction validation failed: ${o.errors.join(", ")}`);const l=new Map;for(const h of i.fields)try{const u=await this.extractField(e,h,i);l.set(h,u),u.success?this.log(`âœ… Successfully extracted ${h}: ${u.content.length} chars`):this.log(`âŒ Failed to extract ${h}: ${u.errorMessage}`)}catch(u){this.log(`âŒ Exception extracting ${h}:`,u),l.set(h,{fieldName:h,content:"",extractionTime:0,success:!1,errorMessage:u instanceof Error?u.message:String(u),quality:this.createEmptyQualityReport(),fallbackUsed:!1,selectorUsed:"none"})}const c={background:l.get("background")?.content||"",investigations:l.get("investigations")?.content||"",medications:l.get("medications")?.content||"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:this.calculateOverallQualityScore(l)},m=this.assessDataQuality(c);if(this.log("ðŸ“Š Data quality assessment:",{completeness:m.completenessScore,richness:m.contentRichness,confidence:m.confidenceLevel,medicalTerms:m.medicalTermsFound}),m.completenessScore<i.qualityThresholds.minCompletenessScore){this.log("âš ï¸ Low quality data detected, attempting fallback extraction");const h=await this.attemptFallbackExtraction(e,c,l,i);if(h)return h}const p=Date.now()-s;return this.log(`âœ… Data extraction completed in ${p}ms`),c}assessDataQuality(e){const a=["background","investigations","medications"],r=a.length;let i=0,s=0,o=0;const l=[],c=[];for(const f of a){const g=e[f];if(this.isContentMeaningful(g)){i++;const v=this.countWords(g),k=this.countMedicalTerms(g);s+=v,o+=k,this.containsErrorPatterns(g)&&c.push(`${f} contains potential error text`),v<5&&c.push(`${f} has very little content (${v} words)`)}else l.push(f)}const m=i/r,p=i>0?s/i:0,h=Math.min(1,p/50*.7+o/10*.3);let u="low";return m>=.8&&h>=.6&&o>=3?u="high":m>=.5&&h>=.3&&o>=1&&(u="medium"),{completenessScore:m,contentRichness:h,confidenceLevel:u,missingFields:l,extractionWarnings:c,medicalTermsFound:o,estimatedWordCount:s}}async verifyPatientIdentity(e,a){try{const r=await this.sendMessage(e,{type:"VERIFY_PATIENT_IDENTITY",data:{expectedName:a.name,expectedFileNumber:a.fileNumber,expectedDOB:a.dob}});if(r?.verified===!0)return{isValid:!0,errors:[],warnings:[],score:1};{const i=[`Patient identity mismatch. Expected: ${a.name} (${a.fileNumber})`];return r?.currentPatient&&i.push(`Current patient: ${r.currentPatient.name} (${r.currentPatient.fileNumber})`),{isValid:!1,errors:i,warnings:r?.warnings||[],score:0}}}catch(r){return{isValid:!1,errors:[`Failed to verify patient identity: ${r}`],warnings:[],score:0}}}async extractField(e,a,r){const i=Date.now(),s=r.fallbackSelectors[a]||[];for(let o=0;o<s.length;o++){const l=s[o],c=o===0;try{this.log(`ðŸ” Extracting ${a} with selector: ${l} (attempt ${o+1})`);const m=await this.sendMessage(e,{type:"EXTRACT_FIELD_DATA",data:{fieldName:a,selector:l,timeout:r.timeout/s.length}});if(m?.success&&m?.content){const p=this.sanitizeContent(m.content),h=this.assessFieldQuality(a,p);return{fieldName:a,content:p,extractionTime:Date.now()-i,success:!0,quality:h,fallbackUsed:!c,selectorUsed:l}}}catch(m){if(this.log(`âŒ Extraction attempt ${o+1} failed for ${a}:`,m),o<s.length-1)continue;return{fieldName:a,content:"",extractionTime:Date.now()-i,success:!1,errorMessage:m instanceof Error?m.message:String(m),quality:this.createEmptyQualityReport(),fallbackUsed:!c,selectorUsed:l}}}return{fieldName:a,content:"",extractionTime:Date.now()-i,success:!1,errorMessage:"All selectors failed",quality:this.createEmptyQualityReport(),fallbackUsed:!0,selectorUsed:"none"}}async preExtractionValidation(e,a){const r=[],i=[];try{const s=await this.verifyPatientIdentity(e,a);s.isValid||r.push(...s.errors),i.push(...s.warnings);const o=await this.sendMessage(e,{type:"CHECK_PAGE_READY_FOR_EXTRACTION"});o?.ready||(r.push("Page not ready for data extraction"),o?.reason&&r.push(`Reason: ${o.reason}`));const l=await this.sendMessage(e,{type:"CHECK_CLINICAL_SECTIONS_EXIST"});l?.allSectionsFound||(i.push("Some clinical sections may not be available"),l?.missingSections&&i.push(`Missing: ${l.missingSections.join(", ")}`))}catch(s){r.push(`Pre-extraction validation failed: ${s}`)}return{isValid:r.length===0,errors:r,warnings:i,score:r.length===0?1:0}}async attemptFallbackExtraction(e,a,r,i){this.log("ðŸ”„ Attempting fallback extraction strategies");const s=[];for(const[c,m]of r)(!m.success||m.quality.completenessScore<.5)&&s.push(c);if(s.length===0)return null;const o={...a};let l=!1;for(const c of s)try{const m=await this.tryOCRExtraction(e,c);if(m&&this.isContentMeaningful(m)&&(c==="background"||c==="investigations"||c==="medications")){o[c]=m,l=!0,this.log(`âœ… OCR extraction successful for ${c}`);continue}const p=await this.trySemanticExtraction(e,c);if(p&&this.isContentMeaningful(p)&&(c==="background"||c==="investigations"||c==="medications")){o[c]=p,l=!0,this.log(`âœ… Semantic extraction successful for ${c}`);continue}}catch(m){this.log(`âŒ Fallback extraction failed for ${c}:`,m)}return l?(o.extractionAttempts++,o.qualityScore=this.calculateOverallQualityScore(new Map([["improved",{fieldName:"improved",content:JSON.stringify(o),extractionTime:0,success:!0,quality:this.assessDataQuality(o),fallbackUsed:!0,selectorUsed:"fallback"}]])),o):null}async tryOCRExtraction(e,a){try{return(await this.sendMessage(e,{type:"EXTRACT_FIELD_OCR",data:{fieldName:a}}))?.content||null}catch{return null}}async trySemanticExtraction(e,a){try{return(await this.sendMessage(e,{type:"EXTRACT_FIELD_SEMANTIC",data:{fieldName:a}}))?.content||null}catch{return null}}isContentMeaningful(e){if(!e||typeof e!="string")return!1;const a=e.trim();return a.length<3?!1:![/^(\s*|-|n\/a|none|nil|not?\s*applicable?)$/i,/^\s*\[.*extraction.*failed.*\]\s*$/i,/^\s*loading\.+\s*$/i,/^\s*please\s+wait\.+\s*$/i].some(i=>i.test(a))}countWords(e){return e?e.trim().split(/\s+/).filter(a=>a.length>0).length:0}countMedicalTerms(e){if(!e)return 0;let a=0;for(const r of this.medicalTermPatterns){const i=e.match(r);i&&(a+=i.length)}return a}containsErrorPatterns(e){return this.commonErrorPatterns.some(a=>a.test(e))}sanitizeContent(e){return e?e.trim().replace(/\s+/g," ").replace(/[\x00-\x1F\x7F]/g,""):""}assessFieldQuality(e,a){const r=this.countWords(a),i=this.countMedicalTerms(a),s=this.isContentMeaningful(a),o=s?1:0,l=Math.min(1,r/20);let c="low";return o===1&&r>=10&&i>=1?c="high":o===1&&r>=5&&(c="medium"),{completenessScore:o,contentRichness:l,confidenceLevel:c,missingFields:s?[]:[e],extractionWarnings:this.containsErrorPatterns(a)?["Contains error patterns"]:[],medicalTermsFound:i,estimatedWordCount:r}}createEmptyQualityReport(){return{completenessScore:0,contentRichness:0,confidenceLevel:"low",missingFields:[],extractionWarnings:[],medicalTermsFound:0,estimatedWordCount:0}}calculateOverallQualityScore(e){const a=Array.from(e.values());if(a.length===0)return 0;const r=a.reduce((o,l)=>o+l.quality.completenessScore,0)/a.length,i=a.reduce((o,l)=>o+l.quality.contentRichness,0)/a.length,s=a.filter(o=>o.success).length/a.length;return r*.4+i*.3+s*.3}initializeMedicalPatterns(){this.medicalTermPatterns=[/\b(?:diagnosis|treatment|medication|prescription|symptom|condition|disease|disorder|syndrome)\b/gi,/\b\d+\s*(?:mg|mcg|g|ml|cc|units?|mmHg|bpm|kg|lbs?)\b/gi,/\b(?:angiogram|angioplasty|stent|bypass|catheter|biopsy|surgery|procedure)\b/gi,/\b(?:abnormal|normal|elevated|decreased|hypertension|diabetes|coronary|cardiac|pulmonary)\b/gi,/\b(?:paracetamol|lignocaine|adrenaline|salbutamol|glyceryl trinitrate)\b/gi]}initializeErrorPatterns(){this.commonErrorPatterns=[/error|failed|timeout|exception|null|undefined/gi,/loading\.+|please\s+wait\.+/gi,/access\s+denied|permission\s+denied/gi,/not\s+found|404|500|503/gi]}async sendMessage(e,a,r=5e3){return new Promise((i,s)=>{const o=setTimeout(()=>{s(new Error(`Message timeout after ${r}ms`))},r);try{chrome.tabs.sendMessage(e,a,l=>{if(clearTimeout(o),chrome.runtime.lastError){s(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}i(l)})}catch(l){clearTimeout(o),s(l)}})}log(...e){this.debugMode&&console.log("[DataValidation]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.defaultConfig,e)}getConfig(){return{...this.defaultConfig}}}class We{static instance;strategies;circuitBreakers;failureHistory;config;debugMode=!1;constructor(){this.strategies=new Map,this.circuitBreakers=new Map,this.failureHistory=[],this.config=this.getDefaultConfig(),this.initializeStrategies()}static getInstance(){return We.instance||(We.instance=new We),We.instance}async executeWithRecovery(e,a,r){const i=`${a.operation}_${a.patientIndex}`;if(this.isCircuitBreakerOpen(i))throw new Error(`Circuit breaker is open for operation: ${a.operation}`);let s=null,o=0;const l=this.getMaxAttempts(a.operation);for(;o<l;)try{this.log(`ðŸ”„ Executing ${a.operation} (attempt ${o+1}/${l})`);const c=await e();return this.resetCircuitBreaker(i),this.log(`âœ… Operation ${a.operation} succeeded on attempt ${o+1}`),c}catch(c){o++,s=c instanceof Error?c:new Error(String(c)),this.log(`âŒ Attempt ${o} failed for ${a.operation}:`,s.message);const m=this.classifyError(s),p={patientIndex:a.patientIndex,patient:a.patient,operation:a.operation,error:s.message,timestamp:Date.now(),context:a,recoveryAttempted:!1},h=this.getStrategy(m,r);if(!h.shouldRetry(s,o,a)||o>=l){this.recordCircuitBreakerFailure(i),this.recordFailure(p);break}p.recoveryAttempted=!0,await this.applyRecoveryStrategy(h,s,o,a),this.recordFailure(p)}if(this.recordCircuitBreakerFailure(i),this.config.enableGracefulDegradation){const c=await this.attemptGracefulDegradation(a,s);if(c!==null)return this.log(`ðŸ”„ Graceful degradation successful for ${a.operation}`),c}throw new Error(`Operation ${a.operation} failed after ${o} attempts. Last error: ${s?.message}`)}shouldRetryOperation(e,a,r){const i=this.classifyError(a),s=this.strategies.get(i);if(!s)return!1;const o={operation:e,patientIndex:0,patient:{name:"",dob:"",fileNumber:"",appointmentTime:"",appointmentType:"",confirmed:!1,isFirstAppointment:!1},timestamp:Date.now(),environmentState:{tabId:0,currentUrl:"",contentScriptVersion:"",lastHealthCheck:0},previousAttempts:r-1};return s.shouldRetry(a,r,o)}getRetryDelay(e,a){const r=this.strategies.get(e);return r?this.calculateBackoffDelay(r.backoffStrategy,a,1e3):1e3}resetCircuitBreaker(e){const a=this.circuitBreakers.get(e);a&&(a.failures=0,a.state="closed",a.resetAttempts=0)}getFailureStats(){const e=new Map,a=new Map;for(const s of this.failureHistory){const o=this.classifyError(new Error(s.error));e.set(o,(e.get(o)||0)+1),a.set(s.operation,(a.get(s.operation)||0)+1)}const r=this.failureHistory.filter(s=>Date.now()-s.timestamp<3e5).slice(-10),i=Array.from(this.circuitBreakers.entries()).filter(([s,o])=>o.state==="open").map(([s,o])=>s);return{totalFailures:this.failureHistory.length,failuresByType:e,failuresByOperation:a,recentFailures:r,circuitBreakersOpen:i}}initializeStrategies(){this.strategies.set("network_timeout",{errorType:"network_timeout",maxRetries:3,backoffStrategy:"exponential",recoveryTimeout:3e4,shouldRetry:(e,a,r)=>a<=3&&!e.message.includes("permanent")}),this.strategies.set("dom_not_found",{errorType:"dom_not_found",maxRetries:5,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(e,a,r)=>a<=5,fallbackAction:async()=>null}),this.strategies.set("content_script_unresponsive",{errorType:"content_script_unresponsive",maxRetries:2,backoffStrategy:"fixed",recoveryTimeout:15e3,shouldRetry:(e,a,r)=>a<=2,fallbackAction:async()=>null}),this.strategies.set("extraction_failed",{errorType:"extraction_failed",maxRetries:4,backoffStrategy:"fibonacci",recoveryTimeout:25e3,shouldRetry:(e,a,r)=>a<=4&&!e.message.includes("no data available")}),this.strategies.set("ai_processing_failed",{errorType:"ai_processing_failed",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:6e4,shouldRetry:(e,a,r)=>a<=2&&!e.message.includes("model unavailable")}),this.strategies.set("navigation_failed",{errorType:"navigation_failed",maxRetries:3,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(e,a,r)=>a<=3}),this.strategies.set("permission_denied",{errorType:"permission_denied",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:5e3,shouldRetry:(e,a,r)=>!1}),this.strategies.set("memory_limit",{errorType:"memory_limit",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:1e4,shouldRetry:(e,a,r)=>a===1,fallbackAction:async()=>{try{window.gc&&window.gc()}catch{}return null}}),this.strategies.set("unknown",{errorType:"unknown",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:15e3,shouldRetry:(e,a,r)=>a<=2})}classifyError(e){const a=e.message.toLowerCase();return a.includes("timeout")||a.includes("timed out")?"network_timeout":a.includes("not found")||a.includes("element")||a.includes("selector")?"dom_not_found":a.includes("content script")||a.includes("script not responsive")?"content_script_unresponsive":a.includes("extraction")||a.includes("data")||a.includes("field")?"extraction_failed":a.includes("ai")||a.includes("model")||a.includes("processing")?"ai_processing_failed":a.includes("navigation")||a.includes("navigate")||a.includes("tab")?"navigation_failed":a.includes("permission")||a.includes("access denied")?"permission_denied":a.includes("memory")||a.includes("heap")||a.includes("out of memory")?"memory_limit":"unknown"}getStrategy(e,a){const r=this.strategies.get(e)||this.strategies.get("unknown");return a?{...r,...a}:r}async applyRecoveryStrategy(e,a,r,i){const s=this.calculateBackoffDelay(e.backoffStrategy,r);if(this.log(`ðŸ”„ Applying recovery strategy for ${e.errorType}, waiting ${s}ms`),e.fallbackAction)try{await e.fallbackAction(),this.log(`âœ… Fallback action executed for ${e.errorType}`)}catch(o){this.log(`âŒ Fallback action failed for ${e.errorType}:`,o)}await this.sleep(s),await this.performContextSpecificRecovery(i,e.errorType)}async performContextSpecificRecovery(e,a){switch(a){case"content_script_unresponsive":await this.recoverContentScript(e.environmentState.tabId);break;case"dom_not_found":await this.recoverDOMElements(e.environmentState.tabId);break;case"navigation_failed":await this.recoverNavigation(e.environmentState.tabId);break;case"memory_limit":await this.recoverMemory();break}}async recoverContentScript(e){try{this.log(`ðŸ”§ Attempting to recover content script on tab ${e}`),await chrome.scripting.executeScript({target:{tabId:e},files:["content-script.js"]}),await this.sleep(2e3)}catch(a){this.log("âŒ Content script recovery failed:",a)}}async recoverDOMElements(e){try{this.log(`ðŸ”§ Attempting to recover DOM elements on tab ${e}`),await this.sleep(1e3),await chrome.tabs.sendMessage(e,{type:"REFRESH_PAGE_SECTION"})}catch(a){this.log("âŒ DOM recovery failed:",a)}}async recoverNavigation(e){try{if(this.log(`ðŸ”§ Attempting to recover navigation on tab ${e}`),!await chrome.tabs.get(e))throw new Error("Tab no longer exists");await this.sleep(3e3)}catch(a){this.log("âŒ Navigation recovery failed:",a)}}async recoverMemory(){this.log("ðŸ”§ Attempting memory recovery"),this.failureHistory.length>100&&(this.failureHistory=this.failureHistory.slice(-50));const e=Date.now();for(const[a,r]of this.circuitBreakers)e-r.lastFailureTime>3e5&&this.circuitBreakers.delete(a);try{window.gc&&window.gc()}catch{}}calculateBackoffDelay(e,a,r=1e3){switch(e){case"exponential":return Math.min(r*Math.pow(2,a-1),3e4);case"linear":return Math.min(r*a,2e4);case"fibonacci":return Math.min(this.fibonacci(a)*r,25e3);case"fixed":default:return r}}fibonacci(e){if(e<=1)return 1;if(e===2)return 2;let a=1,r=2;for(let i=3;i<=e;i++){const s=a+r;a=r,r=s}return r}isCircuitBreakerOpen(e){const a=this.circuitBreakers.get(e);return a&&a.state==="open"?Date.now()-a.lastFailureTime>this.config.circuitBreakerResetTime?(a.state="half-open",a.resetAttempts++,!1):!0:!1}recordCircuitBreakerFailure(e){let a=this.circuitBreakers.get(e);a||(a={failures:0,lastFailureTime:0,state:"closed",resetAttempts:0},this.circuitBreakers.set(e,a)),a.failures++,a.lastFailureTime=Date.now(),a.failures>=this.config.circuitBreakerThreshold&&(a.state="open",this.log(`ðŸš¨ Circuit breaker opened for operation: ${e}`))}recordFailure(e){this.failureHistory.push(e),this.failureHistory.length>500&&(this.failureHistory=this.failureHistory.slice(-250))}getMaxAttempts(e){const a=["extract-data","ai-review"],r=["navigate","activate-patient"];return a.some(i=>e.includes(i))?5:r.some(i=>e.includes(i))?3:2}async attemptGracefulDegradation(e,a){switch(this.log(`ðŸ”„ Attempting graceful degradation for ${e.operation}`),e.operation){case"extract-data":return{background:"[Data extraction failed - manual review required]",investigations:"[Data extraction failed]",medications:"[Data extraction failed]"};case"ai-review":return{summary:"[AI review failed - manual review required]",findings:[],recommendations:[]};default:return null}}getDefaultConfig(){return{strategy:"conservative",maxTotalRetries:10,circuitBreakerThreshold:5,circuitBreakerResetTime:3e5,enableGracefulDegradation:!0,userNotificationEnabled:!0}}async sleep(e){return new Promise(a=>setTimeout(a,e))}log(...e){this.debugMode&&console.log("[ErrorRecoveryManager]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}clearHistory(){this.failureHistory=[],this.circuitBreakers.clear()}addCustomStrategy(e,a){this.strategies.set(e,a)}}class Ge{static instance;memoryCache=new Map;config;stats;invalidationRules=[];cleanupInterval;debugMode=!1;constructor(){this.config=this.getDefaultConfig(),this.stats=this.initializeStats(),this.initializeInvalidationRules(),this.startPeriodicCleanup()}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}async set(e,a,r,i){const s=this.generateCacheKey(e),o=Date.now(),l=await this.calculateDataHash(a),c=o+(i||this.config.defaultTtlMs);this.log(`ðŸ’¾ Caching data for key: ${s}`);const m={key:s,patientId:e.patientId,extractedData:a,timestamp:o,dataHash:l,quality:r||this.createDefaultQuality(),expiryTime:c,accessCount:0,lastAccessed:o};this.memoryCache.set(s,m),this.config.persistToDisk&&await this.saveToPersistentStorage(s,m),this.updateStats("set"),await this.checkSizeConstraints(),this.log(`âœ… Cached data for key: ${s} (expires: ${new Date(c).toISOString()})`)}async get(e){const a=this.generateCacheKey(e);this.log(`ðŸ” Looking for cached data: ${a}`);let r=this.memoryCache.get(a);if(!r&&this.config.persistToDisk){const i=await this.loadFromPersistentStorage(a);i&&(r=i,this.memoryCache.set(a,r))}return r?Date.now()>r.expiryTime?(this.memoryCache.delete(a),await this.removeFromPersistentStorage(a),this.updateStats("miss"),this.log(`â° Cache expired for key: ${a}`),{hit:!1,reason:"expired"}):(r.accessCount++,r.lastAccessed=Date.now(),this.updateStats("hit"),this.log(`âœ… Cache hit for key: ${a} (accessed ${r.accessCount} times)`),{hit:!0,data:r.extractedData,entry:r}):(this.updateStats("miss"),this.log(`âŒ Cache miss for key: ${a}`),{hit:!1,reason:"not_found"})}async hasChanged(e,a){const r=await this.get(e);return!r.hit||!r.entry?!0:await this.calculateDataHash(a)!==r.entry.dataHash}async invalidate(e){const a=this.generateCacheKey(e);this.log(`ðŸ—‘ï¸ Invalidating cache entry: ${a}`),this.memoryCache.delete(a),await this.removeFromPersistentStorage(a)}async invalidatePatient(e){let a=0;for(const[r,i]of this.memoryCache)i.patientId===e&&(this.memoryCache.delete(r),await this.removeFromPersistentStorage(r),a++);return this.log(`ðŸ—‘ï¸ Invalidated ${a} cache entries for patient: ${e}`),a}async applyInvalidationRules(){let e=0;const a=[],r=[];for(const[i,s]of this.memoryCache)for(const o of this.invalidationRules)if(o.condition(s)){switch(o.action){case"remove":a.push(i);break;case"refresh":r.push(i);break}e++;break}for(const i of a)this.memoryCache.delete(i),await this.removeFromPersistentStorage(i);for(const i of r){const s=this.memoryCache.get(i);s&&(s.expiryTime=Date.now())}return this.log(`ðŸ§¹ Applied invalidation rules: ${e} entries processed, ${a.length} removed, ${r.length} marked for refresh`),e}getStats(){const e=Date.now();let a=0,r=e,i=0;for(const s of this.memoryCache.values())a+=this.estimateEntrySize(s),r=Math.min(r,s.timestamp),i=Math.max(i,s.timestamp);return{...this.stats,totalSizeBytes:a,entryCount:this.memoryCache.size,oldestEntry:r===e?0:r,newestEntry:i}}getCacheInfo(){const e=Array.from(this.memoryCache.values()),a=Date.now(),r=e.sort((o,l)=>l.accessCount-o.accessCount).slice(0,10),i=e.filter(o=>o.expiryTime-a<3e5).sort((o,l)=>o.expiryTime-l.expiryTime),s=new Map;for(const o of e){const l=s.get(o.patientId)||0;s.set(o.patientId,l+this.estimateEntrySize(o))}return{memoryEntries:e,topAccessed:r,expiringSoon:i,sizeByPatient:s}}async clear(){this.log("ðŸ§¹ Clearing all cache data"),this.memoryCache.clear(),this.config.persistToDisk&&await this.clearPersistentStorage(),this.stats=this.initializeStats()}async exportCache(){const e={timestamp:new Date().toISOString(),config:this.config,stats:this.getStats(),entries:Array.from(this.memoryCache.values()).map(a=>({...a,extractedData:"[DATA_REDACTED]"}))};return JSON.stringify(e,null,2)}generateCacheKey(e){const a=e.version||"v1";return`${e.patientId}_${e.dataType}_${a}`}async calculateDataHash(e){const a=JSON.stringify(e),i=new TextEncoder().encode(a),s=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(s)).map(l=>l.toString(16).padStart(2,"0")).join("")}estimateEntrySize(e){const a=JSON.stringify(e);return new Blob([a]).size}async checkSizeConstraints(){const e=this.getStats();e.totalSizeBytes>this.config.maxSizeBytes&&await this.evictLeastRecentlyUsed(Math.floor(this.memoryCache.size*.2)),e.entryCount>this.config.maxEntries&&await this.evictLeastRecentlyUsed(e.entryCount-this.config.maxEntries)}async evictLeastRecentlyUsed(e){const a=Array.from(this.memoryCache.entries());a.sort(([,i],[,s])=>i.lastAccessed-s.lastAccessed);const r=a.slice(0,e);for(const[i]of r)this.memoryCache.delete(i),await this.removeFromPersistentStorage(i);this.log(`ðŸ—‘ï¸ Evicted ${r.length} least recently used entries`)}initializeInvalidationRules(){this.invalidationRules=[{name:"expired_entries",condition:e=>Date.now()>e.expiryTime,action:"remove"},{name:"low_quality_old_data",condition:e=>{const a=Date.now()-e.timestamp;return e.quality.confidenceLevel==="low"&&a>18e5},action:"remove"},{name:"unused_entries",condition:e=>{const a=Date.now()-e.lastAccessed;return e.accessCount===0&&a>36e5},action:"remove"},{name:"refresh_high_access",condition:e=>{const a=Date.now()-e.timestamp;return e.accessCount>10&&a>72e5},action:"refresh"}]}startPeriodicCleanup(){this.cleanupInterval=setInterval(async()=>{await this.applyInvalidationRules(),await this.checkSizeConstraints()},3e5)}stopPeriodicCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=void 0)}updateStats(e){switch(this.stats.totalRequests++,e){case"hit":this.stats.hitCount++;break;case"miss":this.stats.missCount++;break}this.stats.hitRate=this.stats.totalRequests>0?this.stats.hitCount/this.stats.totalRequests:0}createDefaultQuality(){return{completenessScore:1,contentRichness:1,confidenceLevel:"high",missingFields:[],extractionWarnings:[],medicalTermsFound:0,estimatedWordCount:0}}async saveToPersistentStorage(e,a){try{const r=`cache_${e}`;let i=JSON.stringify(a);this.config.compressionEnabled&&(i=await this.compressData(i)),await chrome.storage.local.set({[r]:i})}catch(r){this.log("âŒ Failed to save to persistent storage:",r)}}async loadFromPersistentStorage(e){try{const a=`cache_${e}`,r=await chrome.storage.local.get(a);if(!r[a])return null;let i=r[a];return this.config.compressionEnabled&&(i=await this.decompressData(i)),JSON.parse(i)}catch(a){return this.log("âŒ Failed to load from persistent storage:",a),null}}async removeFromPersistentStorage(e){try{const a=`cache_${e}`;await chrome.storage.local.remove(a)}catch(a){this.log("âŒ Failed to remove from persistent storage:",a)}}async clearPersistentStorage(){try{const e=await chrome.storage.local.get(null),a=Object.keys(e).filter(r=>r.startsWith("cache_"));await chrome.storage.local.remove(a)}catch(e){this.log("âŒ Failed to clear persistent storage:",e)}}async compressData(e){return btoa(e)}async decompressData(e){return atob(e)}getDefaultConfig(){return{maxSizeBytes:50*1024*1024,maxEntries:1e3,defaultTtlMs:36e5,compressionEnabled:!0,persistToDisk:!0}}initializeStats(){return{hitCount:0,missCount:0,totalRequests:0,hitRate:0,totalSizeBytes:0,entryCount:0,oldestEntry:0,newestEntry:0}}log(...e){this.debugMode&&console.log("[CacheManager]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}addInvalidationRule(e){this.invalidationRules.push(e)}removeInvalidationRule(e){const a=this.invalidationRules.findIndex(r=>r.name===e);return a>=0?(this.invalidationRules.splice(a,1),!0):!1}cleanup(){this.stopPeriodicCleanup(),this.memoryCache.clear()}async warmup(e){this.log(`ðŸ”¥ Warming up cache for ${e.length} patients`);for(const a of e){const r=[{patientId:a.fileNumber,dataType:"extracted_data"},{patientId:a.fileNumber,dataType:"ai_review"},{patientId:a.fileNumber,dataType:"validation_result"}];for(const i of r)(await this.get(i)).hit||await this.set(i,null,void 0,6e4)}}async preload(e){let a=0;for(const r of e)try{const i={patientId:r.patientId,dataType:r.dataType,version:r.version};await this.set(i,r.content,r.quality,r.ttl),a++}catch(i){this.log("âŒ Failed to preload cache entry:",i)}return this.log(`ðŸ“¥ Preloaded ${a} cache entries`),a}}class Ve{static instance;config;storagePrefix="batch_checkpoint_";backupPrefix="backup_checkpoint_";debugMode=!1;constructor(){this.config=this.getDefaultConfig()}static getInstance(){return Ve.instance||(Ve.instance=new Ve),Ve.instance}async saveCheckpoint(e,a,r,i,s,o,l,c){const m=this.generateCheckpointId(e),p=Date.now();this.log(`ðŸ’¾ Saving checkpoint: ${m}`);const h={lastSuccessfulOperation:this.getLastSuccessfulOperation(r),skippedPatients:this.getSkippedPatients(r),retryQueue:this.buildRetryQueue(s),environmentState:c},u={id:m,batchId:e,timestamp:p,version:"1.0.0",totalPatients:a.selectedPatients.length,completedPatients:r,currentPatientIndex:i,failedAttempts:s,configuration:o,performanceMetrics:l,resumeData:h,integrityHash:""};u.integrityHash=await this.calculateIntegrityHash(u);try{const f=this.config.compressionEnabled?await this.compressData(u):JSON.stringify(u),g=this.config.encryptionEnabled?await this.encryptData(f):f,v=this.storagePrefix+m;if(await this.saveToStorage(v,g),this.config.backupEnabled){const k=this.backupPrefix+m;await this.saveToStorage(k,g)}return this.log(`âœ… Checkpoint saved successfully: ${m}`),await this.cleanupOldCheckpoints(e),m}catch(f){throw this.log("âŒ Failed to save checkpoint:",f),new Error(`Checkpoint save failed: ${f instanceof Error?f.message:String(f)}`)}}async loadCheckpoint(e){this.log(`ðŸ“‚ Loading checkpoint: ${e}`);try{let a=await this.loadFromStorage(this.storagePrefix+e);if(!a&&this.config.backupEnabled&&(this.log("âš ï¸ Primary checkpoint not found, trying backup"),a=await this.loadFromStorage(this.backupPrefix+e)),!a)throw new Error(`Checkpoint not found: ${e}`);const r=this.config.encryptionEnabled?await this.decryptData(a):a,i=this.config.compressionEnabled?await this.decompressData(r):JSON.parse(r);if(this.config.integrityChecking&&!await this.validateIntegrity(i))throw new Error("Checkpoint integrity validation failed");const s=this.validateCheckpointStructure(i);if(!s.isValid)throw new Error(`Invalid checkpoint structure: ${s.errors.join(", ")}`);return this.log(`âœ… Checkpoint loaded successfully: ${e}`),i}catch(a){throw this.log("âŒ Failed to load checkpoint:",a),new Error(`Checkpoint load failed: ${a instanceof Error?a.message:String(a)}`)}}async resumeFromCheckpoint(e,a,r={}){this.log(`ðŸ”„ Resuming from checkpoint: ${e}`);const i=await this.loadCheckpoint(e),s={skipFailedPatients:!1,retryFailedPatients:!0,validateEnvironment:!0,allowConfigChanges:!0,resumeFromLastSuccessful:!0,...r},o=[];if(s.validateEnvironment){const c=await this.validateEnvironment(i.resumeData.environmentState);if(!c.isValid&&(o.push(`Environment validation warnings: ${c.warnings.join(", ")}`),c.errors.length>0))throw new Error(`Environment validation failed: ${c.errors.join(", ")}`)}if(a){if(!s.allowConfigChanges)throw new Error("Configuration changes not allowed during resume");const c=this.compareConfigurations(i.configuration,a);c.hasSignificantChanges&&o.push(`Significant configuration changes detected: ${c.changes.join(", ")}`),i.configuration={...i.configuration,...a}}const l=this.determineResumeStrategy(i,s);return i.resumeData.lastSuccessfulOperation=`resumed_from_checkpoint_${Date.now()}`,this.log("âœ… Resume strategy determined:",l),{checkpoint:i,resumeStrategy:l,warnings:o}}async listCheckpoints(e){try{const r=await chrome.storage.local.get(null),i=[];for(const[s,o]of Object.entries(r))if(s.startsWith(this.storagePrefix))try{const l=await this.extractCheckpointInfo(s,o);(!e||l.batchId===e)&&i.push(l)}catch(l){this.log(`âš ï¸ Error reading checkpoint ${s}:`,l)}return i.sort((s,o)=>o.timestamp-s.timestamp),i}catch(a){return this.log("âŒ Failed to list checkpoints:",a),[]}}async deleteCheckpoint(e){try{const a=chrome.storage.local,r=[this.storagePrefix+e,this.backupPrefix+e];await a.remove(r),this.log(`ðŸ—‘ï¸ Checkpoint deleted: ${e}`)}catch(a){throw this.log("âŒ Failed to delete checkpoint:",a),new Error(`Checkpoint deletion failed: ${a instanceof Error?a.message:String(a)}`)}}async cleanupOldCheckpoints(e){try{const a=await this.listCheckpoints(e);if(a.length<=this.config.maxCheckpoints)return 0;const r=a.slice(this.config.maxCheckpoints);let i=0;for(const s of r)try{await this.deleteCheckpoint(s.id),i++}catch(o){this.log(`âš ï¸ Failed to delete old checkpoint ${s.id}:`,o)}return this.log(`ðŸ§¹ Cleaned up ${i} old checkpoints`),i}catch(a){return this.log("âŒ Cleanup failed:",a),0}}generateCheckpointId(e){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async calculateIntegrityHash(e){const a={...e};delete a.integrityHash;const r=JSON.stringify(a),s=new TextEncoder().encode(r),o=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(o)).map(c=>c.toString(16).padStart(2,"0")).join("")}async validateIntegrity(e){const a=e.integrityHash,r=await this.calculateIntegrityHash(e);return a===r}validateCheckpointStructure(e){const a=[],r=[],i=["id","batchId","timestamp","version","totalPatients","completedPatients","currentPatientIndex"];for(const s of i)(e[s]===void 0||e[s]===null)&&a.push(`Missing required field: ${s}`);return typeof e.currentPatientIndex!="number"&&a.push("currentPatientIndex must be a number"),Array.isArray(e.completedPatients)||a.push("completedPatients must be an array"),(e.currentPatientIndex<0||e.currentPatientIndex>e.totalPatients)&&r.push("currentPatientIndex seems out of bounds"),e.version!=="1.0.0"&&r.push(`Checkpoint version ${e.version} may not be fully compatible`),{isValid:a.length===0,errors:a,warnings:r,score:a.length===0?1:0}}async validateEnvironment(e){const a=[],r=[];try{if(e.tabId)try{await chrome.tabs.get(e.tabId)}catch{r.push("Original tab no longer exists")}if(e.currentUrl)try{new URL(e.currentUrl)}catch{r.push("Current URL appears invalid")}e.contentScriptVersion&&r.push("Content script version compatibility not verified"),Date.now()-e.lastHealthCheck>36e5&&r.push("Environment state is quite old (>1 hour)")}catch(i){a.push(`Environment validation error: ${i}`)}return{isValid:a.length===0,errors:a,warnings:r,score:a.length===0?1:0}}compareConfigurations(e,a){const r=[],i=["maxRetries","timeoutMs","errorRecoveryStrategy"];for(const[o,l]of Object.entries(a)){const c=e[o];c!==l&&r.push(`${o}: ${c} â†’ ${l}`)}return{hasSignificantChanges:r.some(o=>i.some(l=>o.startsWith(l))),changes:r}}determineResumeStrategy(e,a){const r={startIndex:e.currentPatientIndex,skipPatients:[],retryPatients:[],forceReprocessPatients:[],resumeMode:"continue"};if(a.resumeFromLastSuccessful){const i=this.findLastSuccessfulPatientIndex(e.completedPatients);r.startIndex=Math.max(i+1,e.currentPatientIndex)}return a.skipFailedPatients?r.skipPatients=e.failedAttempts.map(i=>i.patientIndex):a.retryFailedPatients&&(r.retryPatients=e.failedAttempts.map(i=>i.patientIndex)),r.retryPatients.length>0?r.resumeMode="retry_failed":r.skipPatients.length>0?r.resumeMode="skip_failed":r.resumeMode="continue",r}getLastSuccessfulOperation(e){const a=e.filter(i=>i.success);return a.length===0?"batch_start":`patient_completed_${a[a.length-1].patient.fileNumber}`}getSkippedPatients(e){const a=new Set(e.map((i,s)=>s)),r=[];for(let i=0;i<e.length;i++)a.has(i)||r.push(i);return r}buildRetryQueue(e){const a=[],r=new Map;for(const i of e){const s=r.get(i.patientIndex)||[];s.push(i),r.set(i.patientIndex,s)}for(const[i,s]of r){const o=s[s.length-1];a.push({patientIndex:i,patient:o.patient,lastError:o.error,retryCount:s.length,nextRetryTime:Date.now()+s.length*6e4})}return a}findLastSuccessfulPatientIndex(e){for(let a=e.length-1;a>=0;a--)if(e[a].success)return a;return-1}async extractCheckpointInfo(e,a){try{const r=e.replace(this.storagePrefix,"");let i;return this.config.encryptionEnabled?i={id:r,timestamp:0,batchId:"encrypted"}:this.config.compressionEnabled?i=await this.decompressData(a):i=JSON.parse(a),{id:i.id||r,batchId:i.batchId||"unknown",timestamp:i.timestamp||0,totalPatients:i.totalPatients||0,completedPatients:i.completedPatients?.length||0,currentIndex:i.currentPatientIndex||0,hasFailures:(i.failedAttempts?.length||0)>0}}catch(r){throw new Error(`Failed to extract checkpoint info: ${r}`)}}async saveToStorage(e,a){await chrome.storage.local.set({[e]:a})}async loadFromStorage(e){return(await chrome.storage.local.get(e))[e]||null}async compressData(e){return JSON.stringify(e).replace(/\s+/g,"").replace(/"completedPatients"/g,'"cp"').replace(/"currentPatientIndex"/g,'"ci"').replace(/"failedAttempts"/g,'"fa"').replace(/"timestamp"/g,'"ts"')}async decompressData(e){const a=e.replace(/"cp"/g,'"completedPatients"').replace(/"ci"/g,'"currentPatientIndex"').replace(/"fa"/g,'"failedAttempts"').replace(/"ts"/g,'"timestamp"');return JSON.parse(a)}async encryptData(e){return btoa(e)}async decryptData(e){return atob(e)}getDefaultConfig(){return{autoSaveInterval:5,maxCheckpoints:10,compressionEnabled:!0,encryptionEnabled:!1,integrityChecking:!0,backupEnabled:!0}}log(...e){this.debugMode&&console.log("[CheckpointManager]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}}class Xe{static instance;metrics;config;memorySnapshots=[];activeOperations=new Map;memoryMonitorInterval;debugMode=!1;constructor(){this.config=this.getDefaultConfig(),this.metrics=this.initializeMetrics(),this.startMemoryMonitoring()}static getInstance(){return Xe.instance||(Xe.instance=new Xe),Xe.instance}startSession(e){this.log(`ðŸ“Š Starting metrics session: ${e}`),this.metrics=this.initializeMetrics(),this.metrics.sessionId=e,this.metrics.batchStartTime=Date.now(),this.config.enablePerformanceMarks&&performance.mark(`batch-start-${e}`)}endSession(){const e=Date.now();this.metrics.totalProcessingTime=e-this.metrics.batchStartTime,this.log(`ðŸ“Š Ending metrics session: ${this.metrics.sessionId}`),this.config.enablePerformanceMarks&&(performance.mark(`batch-end-${this.metrics.sessionId}`),performance.measure(`batch-duration-${this.metrics.sessionId}`,`batch-start-${this.metrics.sessionId}`,`batch-end-${this.metrics.sessionId}`));const a=this.generateReport();return this.config.autoExport&&this.exportMetrics(a),a}startOperation(e,a,r){const i=Date.now();this.activeOperations.set(e,i),this.log(`â±ï¸ Started operation: ${a} (${e})`),this.config.enablePerformanceMarks&&performance.mark(`op-start-${e}`)}endOperation(e,a,r,i,s){const o=Date.now(),l=this.activeOperations.get(e);if(!l)return this.log(`âš ï¸ No start time found for operation: ${e}`),this.createEmptyTiming(a,e);const c=o-l;this.activeOperations.delete(e);const m={operation:a,startTime:l,endTime:o,duration:c,success:r,patientIndex:i,metadata:s};switch(this.metrics.operationTimings.push(m),a){case"patient-activation":this.metrics.patientActivationTimes.push(c);break;case"data-extraction":this.metrics.dataExtractionTimes.push(c);break;case"ai-review":this.metrics.aiReviewTimes.push(c);break;case"content-script-response":this.metrics.contentScriptResponseTimes.push(c);break}if(!r){const p=this.metrics.retryCount.get(a)||0;this.metrics.retryCount.set(a,p+1)}return this.log(`âœ… Completed operation: ${a} in ${c}ms (success: ${r})`),this.config.enablePerformanceMarks&&(performance.mark(`op-end-${e}`),performance.measure(`op-duration-${e}`,`op-start-${e}`,`op-end-${e}`)),m}recordError(e,a,r){const i=this.classifyError(a),s=this.metrics.errorFrequency.get(i)||0;this.metrics.errorFrequency.set(i,s+1);const o=this.metrics.errorFrequency.get(e)||0;this.metrics.errorFrequency.set(e,o+1),this.log(`âŒ Recorded error: ${i} in ${e} (patient ${r})`)}takeMemorySnapshot(){const e={timestamp:Date.now(),heapUsed:0,heapTotal:0,external:0};if(performance.memory){const a=performance.memory;e.heapUsed=a.usedJSHeapSize,e.heapTotal=a.totalJSHeapSize,e.external=a.usedJSHeapSize}return this.memorySnapshots.push(e),this.metrics.memoryUsageHistory.push(e),this.memorySnapshots.length>1e3&&(this.memorySnapshots=this.memorySnapshots.slice(-500)),e}getPerformanceIndicators(){const e=this.getRecentTimings(3e5),a=this.metrics.operationTimings.length,r=this.metrics.operationTimings.filter(u=>u.success).length,i=e.filter(u=>u.patientIndex!==void 0),s=i.length>0?i.reduce((u,f)=>u+f.duration,0)/i.length:0,o=a>0?r/a:1;let l="normal";s>0&&(s<3e4?l="fast":s<6e4?l="normal":s<12e4?l="slow":l="degraded");const c=Array.from(this.metrics.errorFrequency.values()).reduce((u,f)=>u+f,0),m=a>0?c/a:0,p=this.memorySnapshots[this.memorySnapshots.length-1],h=p?p.heapUsed/(1024*1024):0;return{averageTimePerPatient:s,successRate:o,currentSpeed:l,errorRate:m,memoryUsage:h}}generateReport(){const e=this.generateSummary(),a=this.analyzeTimings(),r=this.analyzeMemory(),i=this.analyzeErrors(),s=this.generateInsights(),o=this.generateRecommendations(s);return{summary:e,timingAnalysis:a,memoryAnalysis:r,errorAnalysis:i,performanceInsights:s,recommendations:o}}async exportMetrics(e){const a=new Date().toISOString().replace(/[:.]/g,"-"),r=`batch-metrics-${e.summary.sessionId}-${a}`;return this.config.exportFormat==="csv"?this.exportAsCSV(e,r):this.exportAsJSON(e,r)}generateSummary(){const e=new Set(this.metrics.operationTimings.filter(m=>m.patientIndex!==void 0).map(m=>m.patientIndex)).size,a=new Set(this.metrics.operationTimings.filter(m=>m.patientIndex!==void 0&&m.success).map(m=>m.patientIndex)).size,r=e-a,i=this.metrics.operationTimings.filter(m=>m.patientIndex!==void 0),s=i.length>0?i.reduce((m,p)=>m+p.duration,0)/i.length:0,o=e>0?a/e:0,l=this.metrics.totalProcessingTime/(1e3*60*60),c=l>0?e/l:0;return{sessionId:this.metrics.sessionId,totalDuration:this.metrics.totalProcessingTime,totalPatients:e,successfulPatients:a,failedPatients:r,averageTimePerPatient:s,successRate:o,throughputPatientsPerHour:c}}analyzeTimings(){const e=new Map,a=[];for(const o of this.metrics.operationTimings){a.push(o.duration);let l=e.get(o.operation);l||(l={operation:o.operation,count:0,totalTime:0,averageTime:0,minTime:1/0,maxTime:0,standardDeviation:0,successRate:0},e.set(o.operation,l)),l.count++,l.totalTime+=o.duration,l.minTime=Math.min(l.minTime,o.duration),l.maxTime=Math.max(l.maxTime,o.duration),o.success&&l.successRate++}for(const o of e.values()){o.averageTime=o.totalTime/o.count,o.successRate=o.successRate/o.count;const l=this.metrics.operationTimings.filter(m=>m.operation===o.operation).map(m=>m.duration),c=l.reduce((m,p)=>m+Math.pow(p-o.averageTime,2),0)/l.length;o.standardDeviation=Math.sqrt(c)}a.sort((o,l)=>o-l);const r={p50:this.getPercentile(a,50),p90:this.getPercentile(a,90),p95:this.getPercentile(a,95),p99:this.getPercentile(a,99)},i=this.identifyBottlenecks(e),s=this.determineCriticalPath(e);return{operationBreakdown:e,criticalPath:s,bottlenecks:i,percentiles:r}}analyzeMemory(){if(this.memorySnapshots.length<2)return{peakUsage:0,averageUsage:0,growthRate:0,leakDetection:[],gcImpact:0};const e=this.memorySnapshots.map(p=>p.heapUsed),a=Math.max(...e),r=e.reduce((p,h)=>p+h,0)/e.length,i=this.memorySnapshots[0],s=this.memorySnapshots[this.memorySnapshots.length-1],o=(s.timestamp-i.timestamp)/(1e3*60),l=(s.heapUsed-i.heapUsed)/(1024*1024),c=o>0?l/o:0,m=this.detectMemoryLeaks();return{peakUsage:a/(1024*1024),averageUsage:r/(1024*1024),growthRate:c,leakDetection:m,gcImpact:0}}analyzeErrors(){const e=Array.from(this.metrics.errorFrequency.values()).reduce((f,g)=>f+g,0),a=this.metrics.operationTimings.length,r=this.metrics.operationTimings.filter(f=>f.success).length,i=a>0?e/a:0,s=a>e?(r-(a-e))/e:0,o=new Map,l=new Map;for(const[f,g]of this.metrics.errorFrequency)this.isErrorType(f)?o.set(f,g):l.set(f,g);const c=this.metrics.operationTimings.filter(f=>!f.success),m=c.length>0?c.reduce((f,g)=>f+g.duration,0)/c.length:0,p=this.metrics.operationTimings.filter(f=>f.success),h=p.length>0?p.reduce((f,g)=>f+g.duration,0)/p.length:0,u=h>0?(m-h)/h:0;return{totalErrors:e,errorsByType:o,errorsByOperation:l,errorRate:i,recoveryRate:s,impactOnPerformance:u}}generateInsights(){const e=[],a=this.getPerformanceIndicators();return a.currentSpeed==="degraded"&&e.push({type:"warning",title:"Severely Degraded Performance",description:`Average processing time per patient is ${Math.round(a.averageTimePerPatient/1e3)}s, indicating severe performance issues.`,impact:"high",actionRequired:!0}),a.errorRate>.1&&e.push({type:"warning",title:"High Error Rate",description:`Error rate of ${Math.round(a.errorRate*100)}% is concerning and may indicate system issues.`,impact:"high",actionRequired:!0}),a.memoryUsage>500&&e.push({type:"warning",title:"High Memory Usage",description:`Memory usage of ${Math.round(a.memoryUsage)}MB is high and may cause performance issues.`,impact:"medium",actionRequired:!1}),a.successRate<.9&&e.push({type:"optimization",title:"Low Success Rate",description:`Success rate of ${Math.round(a.successRate*100)}% suggests opportunities for improvement.`,impact:"medium",actionRequired:!1}),e}generateRecommendations(e){const a=[];for(const r of e)switch(r.title){case"Severely Degraded Performance":a.push("Consider reducing batch size or increasing timeout values"),a.push("Check for network connectivity issues");break;case"High Error Rate":a.push("Review error logs to identify common failure patterns"),a.push("Consider implementing additional retry strategies");break;case"High Memory Usage":a.push("Implement more frequent garbage collection"),a.push("Reduce the number of concurrent operations");break;case"Low Success Rate":a.push("Improve error handling and recovery mechanisms"),a.push("Add more robust validation checks");break}return a}identifyBottlenecks(e){const a=[];for(const r of e.values()){let i="low",s="";r.averageTime>6e4?(i="critical",s="This operation is extremely slow and should be optimized immediately"):r.averageTime>3e4?(i="high",s="Consider optimizing this operation or implementing caching"):r.averageTime>15e3&&(i="medium",s="Monitor this operation for potential optimization opportunities"),i!=="low"&&a.push({operation:r.operation,averageTime:r.averageTime,impact:i,description:`${r.operation} takes an average of ${Math.round(r.averageTime/1e3)}s`,suggestion:s})}return a.sort((r,i)=>i.averageTime-r.averageTime)}determineCriticalPath(e){return Array.from(e.values()).sort((r,i)=>i.averageTime*i.count-r.averageTime*r.count).slice(0,5).map(r=>r.operation)}detectMemoryLeaks(){const e=[];if(this.memorySnapshots.length<10)return e;const a=this.memorySnapshots.slice(-10),r=[];for(let s=1;s<a.length;s++){const o=a[s].heapUsed-a[s-1].heapUsed;r.push(o)}const i=r.reduce((s,o)=>s+o,0)/r.length;return a[a.length-1].heapUsed-a[0].heapUsed,i>1024*1024&&e.push({suspected:!0,confidence:Math.min(i/(5*1024*1024),1),description:"Consistent memory growth detected",growthPattern:"linear"}),e}getPercentile(e,a){const r=Math.ceil(a/100*e.length)-1;return e[Math.max(0,Math.min(r,e.length-1))]||0}getRecentTimings(e){const a=Date.now()-e;return this.metrics.operationTimings.filter(r=>r.startTime>=a)}classifyError(e){const a=e.toLowerCase();return a.includes("timeout")?"timeout":a.includes("network")?"network":a.includes("permission")?"permission":a.includes("not found")?"not_found":a.includes("memory")?"memory":"unknown"}isErrorType(e){return["timeout","network","permission","not_found","memory","unknown"].includes(e)}createEmptyTiming(e,a){return{operation:e,startTime:Date.now(),endTime:Date.now(),duration:0,success:!1,metadata:{error:"No start time found",operationId:a}}}async exportAsJSON(e,a){const r=JSON.stringify(e,null,2);if(typeof window<"u"){const i=new Blob([r],{type:"application/json"}),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=`${a}.json`,o.click(),URL.revokeObjectURL(s)}return r}async exportAsCSV(e,a){const r=[];r.push("Category,Metric,Value,Unit"),r.push(`Summary,Session ID,${e.summary.sessionId},`),r.push(`Summary,Total Duration,${e.summary.totalDuration},ms`),r.push(`Summary,Total Patients,${e.summary.totalPatients},count`),r.push(`Summary,Success Rate,${e.summary.successRate},percentage`),r.push(`Summary,Avg Time Per Patient,${e.summary.averageTimePerPatient},ms`);for(const[s,o]of e.timingAnalysis.operationBreakdown)r.push(`Timing,${s} Count,${o.count},count`),r.push(`Timing,${s} Avg Time,${o.averageTime},ms`),r.push(`Timing,${s} Success Rate,${o.successRate},percentage`);r.push(`Memory,Peak Usage,${e.memoryAnalysis.peakUsage},MB`),r.push(`Memory,Average Usage,${e.memoryAnalysis.averageUsage},MB`),r.push(`Memory,Growth Rate,${e.memoryAnalysis.growthRate},MB/min`);const i=r.join(`
`);if(typeof window<"u"){const s=new Blob([i],{type:"text/csv"}),o=URL.createObjectURL(s),l=document.createElement("a");l.href=o,l.download=`${a}.csv`,l.click(),URL.revokeObjectURL(o)}return i}startMemoryMonitoring(){this.config.enableMemoryTracking&&(this.memoryMonitorInterval=setInterval(()=>{this.takeMemorySnapshot()},this.config.sampleInterval))}stopMemoryMonitoring(){this.memoryMonitorInterval&&(clearInterval(this.memoryMonitorInterval),this.memoryMonitorInterval=void 0)}initializeMetrics(){return{sessionId:"",batchStartTime:0,patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}getDefaultConfig(){return{enableDetailedTiming:!0,enableMemoryTracking:!0,enablePerformanceMarks:!0,sampleInterval:5e3,retentionPeriod:36e5,exportFormat:"json",autoExport:!1}}log(...e){this.debugMode&&console.log("[MetricsCollector]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e),(e.sampleInterval!==void 0||e.enableMemoryTracking!==void 0)&&(this.stopMemoryMonitoring(),this.startMemoryMonitoring())}getConfig(){return{...this.config}}getMetrics(){return{...this.metrics}}clearMetrics(){this.metrics=this.initializeMetrics(),this.memorySnapshots=[],this.activeOperations.clear()}cleanup(){this.stopMemoryMonitoring(),this.clearMetrics()}}class ks{batchPatientReviewAgent;dynamicWait;dataValidation;errorRecovery;cacheManager;checkpointManager;metricsCollector;isProcessing=!1;abortController=null;currentBatchId=null;config;currentProcessingContext=null;constructor(e={}){this.batchPatientReviewAgent=null,this.dynamicWait=qe.getInstance(),this.dataValidation=He.getInstance(),this.errorRecovery=We.getInstance(),this.cacheManager=Ge.getInstance(),this.checkpointManager=Ve.getInstance(),this.metricsCollector=Xe.getInstance(),this.config=this.getDefaultConfig(),this.updateConfig(e),this.log("ðŸš€ Enhanced Batch AI Review Orchestrator initialized")}async loadAgent(){if(!this.batchPatientReviewAgent){const{BatchPatientReviewAgent:e}=await je(async()=>{const{BatchPatientReviewAgent:a}=await import("./chunks/BatchPatientReviewAgent.uf_0rG-p.js");return{BatchPatientReviewAgent:a}},__vite__mapDeps([3,1,2]));this.batchPatientReviewAgent=new e}}async processBatch(e,a){if(this.isProcessing)throw new Error("Batch processing already in progress");this.isProcessing=!0,this.abortController=new AbortController,this.currentBatchId=this.generateBatchId(e);const r=Date.now(),i=[],s=[];this.log(`ðŸ”„ Starting enhanced batch AI review for ${e.selectedPatients.length} patients`),this.config.enableMetrics&&this.metricsCollector.startSession(this.currentBatchId),this.config.enableCaching&&await this.cacheManager.warmup(e.selectedPatients);try{const o=await this.checkForResumableCheckpoint(this.currentBatchId);let l=0;o&&await this.handleResumeOption(o,a)&&(i.push(...o.completedPatients),l=o.currentPatientIndex,this.log(`ðŸ“‚ Resuming from checkpoint at patient ${l}`));const c=e.selectedPatients.slice(l);if(this.config.parallelProcessing&&c.length>1){this.log(`ðŸš€ Using PARALLEL processing for ${c.length} patients (max ${this.config.maxConcurrentOperations} concurrent)`);const h=await this.processPatientsBatchParallel(c,l,a,r);i.push(...h.results),s.push(...h.errors)}else{this.log(`ðŸ”„ Using SEQUENTIAL processing for ${c.length} patients`);for(let h=0;h<c.length;h++){const u=c[h],f=l+h;if(this.abortController?.signal.aborted)throw this.log("ðŸ›‘ Batch processing was cancelled by user"),new Error("Batch processing was cancelled");await this.validateAppointmentBookState(u,f);const g=this.createEnhancedProgress(f,e.selectedPatients.length,u,i,s,r);a?.(g);try{this.log(`ðŸ§­ Processing patient ${f+1}/${e.selectedPatients.length}: ${u.name}`);const v=await this.processIndividualPatientEnhanced(u,f,(k,I)=>{g.phase=k,g.subPhase=I,a?.(g)});i.push(v),this.log(`âœ… Completed patient ${f+1}: ${u.name}`),this.config.enableCheckpoints&&(f+1)%this.config.checkpointInterval===0&&await this.saveProgressCheckpoint(e,i,f+1,s,r)}catch(v){const k=v instanceof Error?v.message:"Unknown error";this.log(`âŒ Failed to process patient ${u.name}:`,k),this.config.enableMetrics&&this.metricsCollector.recordError("patient-processing",k,f),i.push({patient:u,reviewReport:null,extractedData:{background:"",investigations:"",medications:""},processingTime:0,success:!1,error:k}),s.push(`${u.name}: ${k}`);const I=s.length/(f+1);if(I>.5&&s.length>3)throw this.log(`ðŸš¨ High error rate detected (${Math.round(I*100)}%), stopping batch`),new Error(`Batch stopped due to high error rate: ${Math.round(I*100)}%`)}}}const m=this.createEnhancedProgress(e.selectedPatients.length,e.selectedPatients.length,null,i,s,r);m.phase="completed",a?.(m);const p=await this.generateEnhancedBatchReport(e,i,r,Date.now());this.log(`ðŸŽ‰ Batch processing completed: ${i.filter(h=>h.success).length}/${e.selectedPatients.length} successful`);try{const h=Date.now()-r,u=i.filter(v=>v.success).length,f=e.selectedPatients.length,g=`${u}/${f} patients processed successfully`;await Ra.showCompletionNotification("batch-ai-review",h,g),console.log(`ðŸ”” Batch completion notification sent: ${u}/${f} patients (${h}ms)`)}catch(h){console.warn("Failed to send batch completion notification:",h)}return p}catch(o){this.log("âŒ Batch processing failed:",o);const l=this.createEnhancedProgress(0,e.selectedPatients.length,null,i,[...s,o instanceof Error?o.message:"Unknown error"],r);throw l.phase="error",a?.(l),o}finally{await this.finalizeProcessing()}}async resumeFromCheckpoint(e,a){this.log(`ðŸ”„ Resuming batch processing from checkpoint: ${e}`);const{checkpoint:r,resumeStrategy:i,warnings:s}=await this.checkpointManager.resumeFromCheckpoint(e);for(const l of s)this.log(`âš ï¸ Resume warning: ${l}`);const o={selectedPatients:[],appointmentDate:new Date().toISOString(),calendarUrl:r.resumeData.environmentState?.currentUrl||""};return this.processBatch(o,a)}cancelProcessing(){this.abortController&&(this.abortController.abort(),this.log("ðŸ›‘ Batch processing cancelled by user"))}isCurrentlyProcessing(){return this.isProcessing}getProcessingStats(){return{isProcessing:this.isProcessing,currentBatchId:this.currentBatchId,performanceIndicators:this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():null,cacheStats:this.config.enableCaching?this.cacheManager.getStats():null,errorStats:this.errorRecovery.getFailureStats()}}async processPatientsBatchParallel(e,a,r,i){const s=[],o=[];this.log(`ðŸš€ Starting parallel batch processing for ${e.length} patients`),this.log(`ðŸ“Š PHASE 1: Collecting data from all ${e.length} patients...`);const l=[];for(let p=0;p<e.length;p++){const h=e[p],u=a+p;if(this.abortController?.signal.aborted)throw new Error("Batch processing was cancelled");r?.({currentPatientIndex:u,totalPatients:e.length,currentPatient:h,phase:"extracting",subPhase:`collecting-data-${p+1}/${e.length}`,completedPatients:[],errors:[],percentComplete:p/e.length*50,estimatedTimeRemaining:0,currentOperationDetails:`Collecting data from ${h.name}`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}});try{await this.validateAppointmentBookState(h,u);const f=await this.getCurrentTabId(),g=await this.extractPatientDataEnhanced(f,h);l.push({patient:h,extractedData:g,patientIndex:u,success:!0}),this.log(`âœ… Phase 1: Collected data for ${h.name} (${p+1}/${e.length})`)}catch(f){const g=f instanceof Error?f.message:"Unknown error";this.log(`âŒ Phase 1: Failed to collect data for ${h.name}: ${g}`),l.push({patient:h,extractedData:{background:"",investigations:"",medications:"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:0},patientIndex:u,success:!1,error:g}),o.push(`${h.name}: ${g}`)}}this.log(`ðŸ“Š PHASE 1 COMPLETE: Collected data from ${l.length} patients`),this.log(`ðŸ¤– PHASE 2: Processing AI reviews in parallel (max ${this.config.maxConcurrentOperations} concurrent)...`);const c=l.filter(p=>p.success),m=this.chunkArray(c,this.config.maxConcurrentOperations);for(const p of m){const h=p.map(async(f,g)=>{try{const v=50+s.length/e.length*50;r?.({currentPatientIndex:f.patientIndex,totalPatients:e.length,currentPatient:f.patient,phase:"reviewing",subPhase:"ai-processing-parallel",completedPatients:s,errors:[],percentComplete:v,estimatedTimeRemaining:0,currentOperationDetails:`AI review: ${f.patient.name} (parallel)`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}}),this.log(`ðŸ¤– Processing AI review for ${f.patient.name} (parallel batch)`);const k=await this.performAIReviewWithCaching(f.extractedData,f.patient),I={patient:f.patient,reviewReport:k,extractedData:f.extractedData,processingTime:0,success:!0};return this.log(`âœ… Completed AI review for ${f.patient.name}`),I}catch(v){const k=v instanceof Error?v.message:"Unknown error";this.log(`âŒ AI review failed for ${f.patient.name}: ${k}`);const I={patient:f.patient,reviewReport:null,extractedData:f.extractedData,processingTime:0,success:!1,error:k};return o.push(`${f.patient.name}: ${k}`),I}}),u=await Promise.allSettled(h);for(const f of u)f.status==="fulfilled"&&s.push(f.value);this.log(`âœ… Completed AI processing chunk: ${s.filter(f=>f.success).length}/${s.length} successful`)}for(const p of l.filter(h=>!h.success))s.push({patient:p.patient,reviewReport:null,extractedData:p.extractedData,processingTime:0,success:!1,error:p.error});return this.log(`ðŸŽ‰ PARALLEL PROCESSING COMPLETE: ${s.filter(p=>p.success).length}/${s.length} patients successful`),{results:s,errors:o}}chunkArray(e,a){const r=[];for(let i=0;i<e.length;i+=a)r.push(e.slice(i,i+a));return r}async processIndividualPatientEnhanced(e,a,r){const i=Date.now();this.currentProcessingContext={patient:e};const s={operation:"process-patient",patientIndex:a,patient:e,timestamp:i,environmentState:await this.getCurrentEnvironmentState(),previousAttempts:0};try{const o=`patient-${a}`;this.config.enableMetrics&&this.metricsCollector.startOperation(o,"patient-processing",a),r?.("navigating","activating-patient"),this.log(`ðŸ–±ï¸ Activating patient ${a}: ${e.name} (${e.fileNumber})`),await this.errorRecovery.executeWithRecovery(()=>this.activatePatientWithIntelligentWaiting(a),{...s,operation:"patient-activation"}),r?.("waiting-for-load","patient-data-loading");const l=await this.getCurrentTabId(),c=await this.dynamicWait.waitForPatientDataLoad(l,e.name);if(!c.success)throw new Error(`Patient data failed to load: ${c.error}`);r?.("extracting","clinical-data-extraction"),this.log(`ðŸ“‹ Extracting clinical data for: ${e.name}`);const m=await this.errorRecovery.executeWithRecovery(()=>this.extractPatientDataEnhanced(l,e),{...s,operation:"data-extraction"});r?.("reviewing","ai-medical-review"),m.dataCompleteness&&!m.dataCompleteness.hasRealData?this.log(`ðŸ¤– Running AI review for ${e.name} (incomplete data - ${m.dataCompleteness.emptyFieldCount}/${m.dataCompleteness.totalFields} fields empty)`):this.log(`ðŸ¤– Running AI review for: ${e.name}`);const p=await this.errorRecovery.executeWithRecovery(()=>this.performAIReviewWithCaching(m,e),{...s,operation:"ai-review"}),h=Date.now()-i;return this.config.enableMetrics&&this.metricsCollector.endOperation(o,"patient-processing",!0,a,{processingTime:h,dataQuality:m.qualityScore}),{patient:e,reviewReport:p,extractedData:m,processingTime:h,success:!0}}catch(o){const l=Date.now()-i;throw this.log(`âŒ Failed to process patient ${e.name}:`,o),this.config.enableMetrics&&this.metricsCollector.endOperation(`patient-${a}`,"patient-processing",!1,a,{processingTime:l,error:o instanceof Error?o.message:String(o)}),o}finally{this.currentProcessingContext=null}}async activatePatientWithIntelligentWaiting(e){const a=await this.getCurrentTabId(),r=this.getCurrentProcessingContext();if(!r?.patient)throw new Error("No patient context available for activation");const i=r.patient;try{this.log(`ðŸ‘† SPA Workflow: Starting patient processing for ${i.name} (${i.fileNumber})`),this.log(`ðŸ‘† Step 1: Double-clicking patient ${i.name}`);const s=await this.sendMessageWithTimeout(a,{type:"EXECUTE_ACTION",action:"double-click-patient",data:{patientName:i.name,patientId:i.fileNumber}},1e4);if(!s?.success)throw new Error(`Double-click patient failed: ${s?.error||"Unknown error"}`);this.log("ðŸ¥ Step 2: Navigating to Patient Record view");const o=await this.sendMessageWithTimeout(a,{type:"EXECUTE_ACTION",action:"navigate-to-patient-record",data:{}},15e3);if(!o?.success)throw new Error(`Navigate to patient record failed: ${o?.error||"Unknown error"}`);await this.waitForPatientDataReady(a,i.name),this.log(`âœ… SPA Workflow: Patient ${i.name} activated and Patient Record view ready`)}catch(s){throw this.log("âŒ SPA Workflow activation failed:",s),new Error(`SPA patient activation failed: ${s instanceof Error?s.message:"Unknown error"}`)}}getCurrentProcessingContext(){return this.currentProcessingContext||null}async waitForPatientDataReady(e,a){this.log(`â³ Waiting for patient data to load for: ${a}`);for(let s=0;s<30;s++)try{const o=await this.sendMessageWithTimeout(e,{type:"CHECK_XESTRO_BOXES"},3e3);if(o?.found&&o.count>0){this.log(`âœ… Patient data ready after ${(s+1)*500}ms (${o.count} XestroBoxes found)`),await this.sleep(1e3);return}s%5===0&&this.log(`â³ Still waiting for patient data... (attempt ${s+1}/30, ${o?.count||0} XestroBoxes)`),await this.sleep(500)}catch(o){if(this.log(`âŒ Error checking patient data readiness (attempt ${s+1}):`,o),o instanceof Error&&o.message.includes("message channel")?(this.log("ðŸ”§ Message channel error detected, waiting longer before retry..."),await this.sleep(500*2)):await this.sleep(500),s===29)throw new Error(`Patient data failed to load after ${30*500}ms: ${o instanceof Error?o.message:"Unknown error"}`)}throw new Error(`Patient data did not load within ${30*500}ms for patient: ${a}`)}async sleep(e){return new Promise(a=>setTimeout(a,e))}async sendMessageWithTimeout(e,a,r=5e3){return new Promise((i,s)=>{const o=setTimeout(()=>{s(new Error(`Message timeout after ${r}ms`))},r);try{chrome.tabs.sendMessage(e,a,l=>{if(clearTimeout(o),chrome.runtime.lastError){s(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}i(l)})}catch(l){clearTimeout(o),s(l)}})}async extractPatientDataEnhanced(e,a){if(this.config.enableCaching){const r={patientId:a.fileNumber,dataType:"extracted_data"},i=await this.cacheManager.get(r);if(i.hit&&i.data)return this.log(`ðŸ’¾ Using cached data for patient: ${a.name}`),await this.navigateBackToAppointmentBook(e),i.data}try{this.log(`ðŸ“‹ Step 3: Extracting patient fields for ${a.name}`);const r=await this.sendMessageWithTimeout(e,{type:"EXECUTE_ACTION",action:"extract-patient-fields",data:{}},3e4);if(!r?.success||!r?.data)throw new Error(`Patient fields extraction failed: ${r?.error||"No data returned"}`);const i=r.data,s=i.hasAnyData;this.log(`ðŸ“Š Data completeness check for ${a.name}:`,{hasAnyData:s,backgroundLength:i.background?.length||0,investigationsLength:i.investigations?.length||0,medicationsLength:i.medications?.length||0});const o=i.background?.trim()?i.background:"No data available in Background section",l=i.investigations?.trim()?i.investigations:"No data available in Investigations section",c=i.medications?.trim()?i.medications:"No data available in Medications section";this.log(`ðŸ“ Processed field data for ${a.name}:`,{backgroundMarked:!i.background?.trim(),investigationsMarked:!i.investigations?.trim(),medicationsMarked:!i.medications?.trim(),hasAnyRealData:s});const m={background:o,investigations:l,medications:c,extractionTimestamp:i.extractionTimestamp||Date.now(),extractionAttempts:1,qualityScore:this.calculateDataQuality(i),dataCompleteness:{hasRealData:s,emptyFieldCount:[!i.background?.trim(),!i.investigations?.trim(),!i.medications?.trim()].filter(Boolean).length,totalFields:3}};if(await this.navigateBackToAppointmentBook(e),this.config.enableCaching){const p={patientId:a.fileNumber,dataType:"extracted_data"},h=this.dataValidation.assessDataQuality(m);await this.cacheManager.set(p,m,h)}return this.log(`âœ… SPA Workflow: Patient ${a.name} data extraction completed and returned to appointment book`),m}catch(r){this.log("âŒ SPA Workflow extraction failed:",r);try{await this.navigateBackToAppointmentBook(e)}catch(i){this.log("âŒ Failed to navigate back to appointment book:",i)}throw new Error(`SPA data extraction failed: ${r instanceof Error?r.message:"Unknown error"}`)}}async navigateBackToAppointmentBook(e){this.log("ðŸ“… Step 4: Navigating back to Appointment Book");const a=await this.sendMessageWithTimeout(e,{type:"EXECUTE_ACTION",action:"navigate-to-appointment-book",data:{}},15e3);if(!a?.success)throw new Error(`Navigate to appointment book failed: ${a?.error||"Unknown error"}`)}calculateDataQuality(e){let a=0,r=0;return["background","investigations","medications"].forEach(s=>{r++;const o=e[s]||"";o.trim().length>0&&(a+=1,o.trim().length>50&&(a+=.5))}),Math.min(a/(r*1.5),1)}async performAIReviewWithCaching(e,a){if(this.config.enableCaching){const s={patientId:a.fileNumber,dataType:"ai_review"},o=await this.cacheManager.get(s);if(o.hit&&o.data&&!await this.cacheManager.hasChanged({patientId:a.fileNumber,dataType:"extracted_data"},e))return this.log(`ðŸ’¾ Using cached AI review for patient: ${a.name}`),o.data}const r=this.formatReviewInput(e,a);await this.loadAgent();const i=await this.batchPatientReviewAgent.process(r);if(this.config.enableCaching){const s={patientId:a.fileNumber,dataType:"ai_review"};await this.cacheManager.set(s,i)}return i}createEnhancedProgress(e,a,r,i,s,o){const c=Date.now()-o,m=i.filter(v=>v.success).length,p=e>0?c/e:0,u=(a-e)*p,f=a>0?e/a*100:0,g=this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():{averageTimePerPatient:p,successRate:e>0?m/e:1,currentSpeed:"normal",errorRate:e>0?s.length/e:0,memoryUsage:0};return{currentPatientIndex:e,totalPatients:a,currentPatient:r,phase:"navigating",completedPatients:i,errors:s,percentComplete:f,estimatedTimeRemaining:u,currentOperationDetails:r?`Processing ${r.name} (${r.fileNumber})`:"Initializing...",performanceIndicators:g}}async generateEnhancedBatchReport(e,a,r,i){const s=a.filter(f=>f.success),o=a.filter(f=>!f.success);let l=null;this.config.enableMetrics&&(l=this.metricsCollector.endSession());let c=0,m=0,p=0;const h=[];return s.forEach(f=>{if(f.reviewReport?.reviewData){const g=f.reviewReport.reviewData;c+=g.findings?.length||0,m+=g.findings?.filter(v=>v.urgency==="Immediate").length||0,p+=g.medicationSafetyIssues||0,g.findings?.forEach(v=>{v.finding&&!h.includes(v.finding)&&h.push(v.finding)})}}),{id:`batch-${Date.now()}`,agentName:"Enhanced Batch AI Review Orchestrator v3.0",content:`Enhanced batch AI medical review completed for ${e.selectedPatients.length} patients on ${e.appointmentDate}`,sections:[],metadata:{confidence:s.length/e.selectedPatients.length,processingTime:i-r,modelUsed:"BatchPatientReviewAgent",enhancedFeatures:{intelligentWaiting:!0,dataValidation:!0,errorRecovery:!0,caching:this.config.enableCaching,checkpointing:this.config.enableCheckpoints,metrics:this.config.enableMetrics}},timestamp:i,warnings:o.map(f=>`Failed to process ${f.patient.name}: ${f.error}`),errors:o.map(f=>f.error||"Unknown error"),batchData:{appointmentDate:e.appointmentDate,totalPatients:e.selectedPatients.length,successfulReviews:s.length,failedReviews:o.length,processingStartTime:r,processingEndTime:i,patientResults:a,summary:{totalFindings:c,immediateFindings:m,medicationSafetyIssues:p,commonFindings:h.slice(0,10)},enhancedMetrics:l}}}async checkForResumableCheckpoint(e){if(!this.config.enableCheckpoints)return null;try{const a=await this.checkpointManager.listCheckpoints(e);if(a.length>0){const r=a[0];return this.log(`ðŸ“‚ Found resumable checkpoint: ${r.id}`),await this.checkpointManager.loadCheckpoint(r.id)}}catch(a){this.log("âŒ Error checking for resumable checkpoint:",a)}return null}async handleResumeOption(e,a){return this.log(`ðŸ”„ Auto-resuming from checkpoint with ${e.completedPatients.length} completed patients`),!0}async saveProgressCheckpoint(e,a,r,i,s){if(!(!this.config.enableCheckpoints||!this.currentBatchId))try{const o=await this.getCurrentEnvironmentState(),l=this.config.enableMetrics?this.metricsCollector.getMetrics():this.createEmptyMetrics(),c=await this.checkpointManager.saveCheckpoint(this.currentBatchId,e,a,r,[],this.getBatchConfiguration(),l,o);this.log(`ðŸ’¾ Saved checkpoint: ${c} (${a.length} patients completed)`)}catch(o){this.log("âŒ Failed to save checkpoint:",o)}}async getCurrentTabId(){const e=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e[0]?.id)throw new Error("No active tab found");return e[0].id}async getCurrentEnvironmentState(){const e=await chrome.tabs.query({active:!0,currentWindow:!0});return{tabId:e[0]?.id||0,currentUrl:e[0]?.url||"",contentScriptVersion:"2.6.0",lastHealthCheck:Date.now()}}formatReviewInput(e,a){let r="";if(e.dataCompleteness){const{hasRealData:i,emptyFieldCount:s,totalFields:o}=e.dataCompleteness;i?s>0&&(r=`

DATA COMPLETENESS NOTE: ${s}/${o} clinical sections are incomplete. Consider if missing information is clinically significant.`):r=`

DATA COMPLETENESS ALERT: This patient record has ${s}/${o} empty clinical sections. Please assess if missing data represents a clinical oversight or if additional data collection is needed.`}return`Patient: ${a.name} (DOB: ${a.dob}, File: ${a.fileNumber})

Background: ${e.background}

Investigations: ${e.investigations}

Medications: ${e.medications}${r}`}generateBatchId(e){return`batch-${e.appointmentDate}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getBatchConfiguration(){return{maxRetries:this.config.retryAttempts,timeoutMs:this.config.timeoutMs,parallelProcessing:this.config.parallelProcessing,cacheEnabled:this.config.enableCaching,diagnosticsEnabled:this.config.enableAdvancedDiagnostics,checkpointInterval:this.config.checkpointInterval,errorRecoveryStrategy:"conservative"}}createEmptyMetrics(){return{sessionId:this.currentBatchId||"",batchStartTime:Date.now(),patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}async finalizeProcessing(){this.isProcessing=!1,this.abortController=null,this.currentBatchId=null,this.config.enableCaching&&await this.cacheManager.applyInvalidationRules(),this.log("ðŸ Batch processing finalized")}getDefaultConfig(){return{enableCheckpoints:!0,checkpointInterval:5,enableCaching:!0,enableMetrics:!0,enableAdvancedDiagnostics:!1,parallelProcessing:!0,maxConcurrentOperations:3,timeoutMs:3e5,retryAttempts:3}}updateConfig(e){Object.assign(this.config,e),this.dynamicWait.setDebugMode(e.enableAdvancedDiagnostics||!1),this.dataValidation.setDebugMode(e.enableAdvancedDiagnostics||!1),this.errorRecovery.setDebugMode(e.enableAdvancedDiagnostics||!1),this.cacheManager.setDebugMode(e.enableAdvancedDiagnostics||!1),this.checkpointManager.setDebugMode(e.enableAdvancedDiagnostics||!1),this.metricsCollector.setDebugMode(e.enableAdvancedDiagnostics||!1)}getConfig(){return{...this.config}}async validateAppointmentBookState(e,a){const r=await this.getCurrentTabId();this.log(`ðŸ” Validating appointment book state for patient ${a}: ${e.name}`);try{const i=await this.sendMessageWithTimeout(r,{type:"EXECUTE_ACTION",action:"extract-calendar-patients",data:{}},1e4);if(!i?.success||!i?.data?.patients){this.log("âš ï¸ WARNING: Could not validate current patient list");return}const s=i.data.patients;if(this.log(`ðŸ” Current appointment book has ${s.length} patients`),this.log("ðŸ” Current patient list:",s.map((o,l)=>({index:l,name:o.name,fileNumber:o.fileNumber,dob:o.dob}))),a<s.length){const o=s[a];if(this.log(`ðŸ” Expected patient at index ${a}:`,{name:e.name,fileNumber:e.fileNumber,dob:e.dob}),this.log(`ðŸ” Actual patient at index ${a}:`,{name:o.name,fileNumber:o.fileNumber,dob:o.dob}),o.fileNumber!==e.fileNumber)throw this.log("ðŸš¨ CRITICAL ERROR: Patient mismatch detected!"),this.log(`ðŸš¨ Expected: ${e.name} (${e.fileNumber})`),this.log(`ðŸš¨ Found: ${o.name} (${o.fileNumber})`),new Error(`Patient list state corrupted. Expected ${e.name} but found ${o.name} at index ${a}`);this.log(`âœ… Patient validation successful: ${e.name} is at correct position ${a}`)}else throw this.log(`ðŸš¨ CRITICAL ERROR: Patient index ${a} is out of bounds (current list has ${s.length} patients)`),new Error(`Patient index ${a} is out of bounds for current appointment book`)}catch(i){throw this.log("âŒ Patient validation failed:",i),new Error(`Patient validation failed: ${i instanceof Error?i.message:"Unknown error"}`)}}log(...e){console.log("[Enhanced BatchAIReviewOrchestrator]",...e)}async getAvailableCheckpoints(){return this.checkpointManager.listCheckpoints()}async deleteCheckpoint(e){return this.checkpointManager.deleteCheckpoint(e)}async exportMetrics(){if(!this.config.enableMetrics)throw new Error("Metrics collection is disabled");const e=this.metricsCollector.generateReport();return this.metricsCollector.exportMetrics(e)}async clearCaches(){return this.cacheManager.clear()}getDetailedStats(){return{processing:this.getProcessingStats(),cache:this.config.enableCaching?this.cacheManager.getCacheInfo():null,errors:this.errorRecovery.getFailureStats(),metrics:this.config.enableMetrics?this.metricsCollector.getMetrics():null}}}const js={background:"background","investigation-summary":"investigation-summary",medication:"medications",bloods:null,imaging:null,tavi:null,"angiogram-pci":null,mteer:null,tteer:null,"pfo-closure":null,"asd-closure":null,"pvl-plug":null,"bypass-graft":null,"right-heart-cath":null,"tavi-workup":null,"quick-letter":null,consultation:null,"ai-medical-review":null,"batch-ai-review":null,"patient-education":null,enhancement:null,transcription:null,generation:null},Ns={background:"Background","investigation-summary":"Investigation Summary",medications:"Medications (Problem List for Phil)","social-history":"Social & Family History"};function Ma(n){return n&&js[n]||null}function $n(n){return Ns[n]||n}function Ss(n){return n!==null&&Ma(n)!==null}function Cs(n){const{onRecordingComplete:e,onVoiceActivityUpdate:a,onRecordingTimeUpdate:r,onError:i,selectedMicrophoneId:s,getMicrophoneId:o}=n,[l,c]=d.useState({isRecording:!1,isPaused:!1,recordingTime:0,voiceActivityLevel:0,frequencyData:[],hasPermission:null,isRequestingPermission:!1,activeDeviceInfo:null,audioLevelHistory:[]}),m=d.useRef(null),p=d.useRef(null),h=d.useRef(null),u=d.useRef(null),f=d.useRef([]),g=d.useRef(),v=d.useRef(),k=d.useRef(!1),I=d.useCallback(async()=>{try{const w=h.current,E=p.current;if(!w){console.log("ðŸ”‡ detectVoiceActivity: analyser is null");return}if(!k.current){console.log("ðŸ”‡ detectVoiceActivity: not recording (ref check)");return}if(!E){console.log("ðŸ”‡ detectVoiceActivity: audio context is null");return}if(E.state!=="running")if(console.log("ðŸ”‡ detectVoiceActivity: audio context state is",E.state),E.state==="suspended"){console.log("ðŸŽ¤ Attempting to resume suspended audio context...");try{await E.resume(),console.log("âœ… Audio context resumed successfully")}catch(R){console.error("âŒ Failed to resume audio context:",R);return}}else return;const A=w.frequencyBinCount,P=new Uint8Array(A);w.getByteFrequencyData(P);const $=Math.max(...P),b=$>0;Math.random()<.01&&console.log("ðŸŽ¤ detectVoiceActivity debug:",{bufferLength:A,firstFewValues:Array.from(P.slice(0,5)),maxValue:$,hasAudioData:b,contextState:E.state,analyserConnected:w.numberOfInputs>0}),!b&&Math.random()<.05&&console.warn("âš ï¸ No audio data detected in frequency analysis:",{contextState:E.state,analyserFftSize:w.fftSize,bufferLength:A,isRecording:k.current});const N=P.reduce((R,L)=>R+L,0)/A,S=Math.min(N/128,1),M=64,D=[],O=Math.floor(A/M);for(let R=0;R<M;R++){let L=0;const X=R*O,W=Math.min(X+O,A);for(let Y=X;Y<W;Y++)L+=P[Y];const ee=Math.min(L/(W-X)/128,1);D.push(Math.pow(ee,.7))}c(R=>{const L=[...R.audioLevelHistory,S].slice(-30),W=(L.length>10?L.slice(-10).reduce((ee,Y)=>ee+Y,0)/10:0)>.01||S>.05;return S>.05&&Math.random()<.03&&console.log("ðŸŽ¤ Audio Debug:",{level:Math.round(S*100)+"%",frequencyBars:D.length,avgFreq:Math.round(D.reduce((ee,Y)=>ee+Y,0)/D.length*100)+"%",maxFreq:Math.round(Math.max(...D)*100)+"%"}),{...R,voiceActivityLevel:S,frequencyData:D,audioLevelHistory:L,activeDeviceInfo:R.activeDeviceInfo?{...R.activeDeviceInfo,isWorking:W}:null}}),a?.(S,D),k.current&&(g.current=requestAnimationFrame(()=>I()))}catch(w){console.error("ðŸ”‡ detectVoiceActivity error:",w),k.current&&(g.current=requestAnimationFrame(()=>I()))}},[a]),T=d.useCallback(()=>{c(w=>({...w,recordingTime:0})),v.current=setInterval(()=>{c(w=>{const E=w.recordingTime+1;return r?.(E),{...w,recordingTime:E}})},1e3)},[r]),F=d.useCallback(()=>{v.current&&(clearInterval(v.current),v.current=void 0)},[]),x=d.useCallback(async()=>{try{const w=await navigator.permissions.query({name:"microphone"});c(E=>({...E,hasPermission:w.state==="granted"})),w.addEventListener("change",()=>{c(E=>({...E,hasPermission:w.state==="granted"}))})}catch{c(E=>({...E,hasPermission:null}))}},[]),y=d.useCallback(async()=>{console.log("ðŸŽ¤ useRecorder.startRecording() called"),c(w=>({...w,isRequestingPermission:!0}));try{const w=o?.()||s,E={audio:w?{deviceId:{exact:w},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}};let A;try{A=await navigator.mediaDevices.getUserMedia(E)}catch(D){if(w){console.warn("âš ï¸ Exact device constraint failed, attempting fallback:",{requestedDevice:w,error:D?.message||"Unknown error"});const O={audio:{deviceId:w,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}};try{A=await navigator.mediaDevices.getUserMedia(O),console.log("âœ… Fallback constraint succeeded")}catch(R){throw console.error("âŒ Both exact and fallback constraints failed:",R),R}}else throw D}u.current=A;const P=A.getAudioTracks();let $=null;if(P.length>0){const D=P[0],O=D.getSettings(),R=D.getConstraints();if($={label:D.label||"Unknown Microphone",deviceId:O.deviceId||"unknown",isWorking:!1,hasMismatch:!1},console.log("ðŸŽ¤ Audio device details:",{label:D.label,deviceId:O.deviceId,requestedDeviceId:w,sampleRate:O.sampleRate,channelCount:O.channelCount,constraints:R,deviceMatch:O.deviceId===w}),w&&O.deviceId!==w){const L={requested:w,actual:O.deviceId,actualLabel:D.label,isExactConstraint:R.deviceId&&typeof R.deviceId=="object"&&"exact"in R.deviceId,isDefaultDevice:O.deviceId==="default"||!O.deviceId};console.warn("âš ï¸ Device mismatch detected:",L),L.isDefaultDevice?(console.warn("ðŸ’¡ Falling back to system default microphone"),console.warn("   - AirPods may not be properly connected or available"),console.warn("   - Check Bluetooth connection and system audio settings")):(console.warn("ðŸ’¡ Using different device than requested:"),console.warn(`   - Requested: ${w}`),console.warn(`   - Actually using: "${D.label}" (${O.deviceId})`),console.warn("   - This may indicate device availability issues")),$&&($.hasMismatch=!0,$.requestedDeviceId=w)}else w&&(console.log("âœ… Device match confirmed:",{requested:w,actual:O.deviceId,label:D.label}),$&&($.hasMismatch=!1))}k.current=!0,c(D=>({...D,hasPermission:!0,isRequestingPermission:!1,isRecording:!0,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:$,audioLevelHistory:[]}));const b=new AudioContext,N=b.createMediaStreamSource(A),S=b.createAnalyser();S.fftSize=256,S.smoothingTimeConstant=.8,N.connect(S),console.log("ðŸŽ¤ Web Audio API setup:",{contextState:b.state,analyserFFTSize:S.fftSize,frequencyBinCount:S.frequencyBinCount,sampleRate:b.sampleRate}),p.current=b,h.current=S,b.state==="suspended"&&(console.log("ðŸŽ¤ Resuming suspended audio context..."),await b.resume());const M=new MediaRecorder(A,{mimeType:"audio/webm;codecs=opus"});f.current=[],M.ondataavailable=D=>{D.data.size>0&&f.current.push(D.data)},M.onstop=()=>{const D=new Blob(f.current,{type:"audio/webm;codecs=opus"});console.log("ðŸŽ¤ Audio recording completed:",{size:D.size,type:D.type,chunks:f.current.length,recordingTime:l.recordingTime}),e(D),C()},M.start(100),m.current=M,T(),setTimeout(async()=>{console.log("ðŸŽ¤ Starting voice activity detection..."),await I()},100)}catch(w){console.error("ðŸŽ¤ Recording start failed:",w),k.current=!1,c(E=>({...E,hasPermission:!1,isRequestingPermission:!1})),i?.(w)}},[s,e,i,I,T,l.recordingTime]),j=d.useCallback(()=>{console.log("ðŸ›‘ useRecorder.stopRecording() called"),k.current=!1,m.current&&m.current.state==="recording"&&m.current.stop(),c(w=>({...w,isRecording:!1})),F(),g.current&&(cancelAnimationFrame(g.current),g.current=void 0)},[F]),C=d.useCallback(()=>{k.current=!1,F(),g.current&&(cancelAnimationFrame(g.current),g.current=void 0),m.current&&m.current.state==="recording"&&m.current.stop(),u.current&&(u.current.getTracks().forEach(w=>w.stop()),u.current=null),p.current&&(p.current.close(),p.current=null),c(w=>({...w,isRecording:!1,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:null,audioLevelHistory:[]}))},[F]);return Z.useEffect(()=>(x(),C),[x,C]),{...l,startRecording:y,stopRecording:j,cleanup:C}}const Ia=d.memo(()=>t.jsx(gr,{children:t.jsx(fr,{children:t.jsx(Da,{})})})),Da=d.memo(()=>{const{state:n,actions:e}=ws(),a=Kn(),r=d.useRef(null),i=d.useRef(null),s=d.useRef(null),o=d.useRef(0),l=d.useRef(null),c=d.useRef(null),m=d.useRef(dr.getInstance()).current,p=d.useRef(mr.getInstance()).current,h=d.useRef(null),u=d.useRef(null);d.useCallback(()=>(h.current||(h.current=new ks),h.current),[]);const f=d.useCallback((b,N,S,M,D)=>{const O={id:`failed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,audioBlob:b,timestamp:Date.now(),agentType:N,errorMessage:S,transcriptionAttempt:M,metadata:{duration:D||o.current||0,fileSize:b.size,recordingTime:D||o.current||0}};e.setFailedRecordings([O,...n.failedAudioRecordings.slice(0,4)]),console.log("ðŸ“± Stored failed audio recording:",{id:O.id,agentType:N,errorMessage:S,fileSize:b.size,duration:O.metadata.duration})},[e,n.failedAudioRecordings]);d.useCallback(()=>{e.setFailedRecordings([]),console.log("ðŸ—‘ï¸ Cleared all failed audio recordings")},[e]);const g=d.useCallback(async(b,N,S)=>{console.log("ðŸ”„ Starting background processing for session:",b);const M=new AbortController,D=new AbortController;try{e.updatePatientSession(b,{transcriptionStartTime:Date.now()}),console.log("ðŸ”„ Transcribing session:",b);const O=Date.now(),R=_e.getInstance(),L=await m.transcribeAudio(N,M.signal,S),X=Date.now()-O;R.recordMetrics("transcription",X,{agentType:S,audioSize:N.size}),console.log("âœ… Transcription complete for session:",b),console.log("ðŸ“ Transcription result:",L.substring(0,200)+(L.length>200?"...":""));const W=L.trim(),ee=W.length<10,Y=W.length===0,ge=W.startsWith("[")&&W.endsWith("]"),ce=W.toLowerCase().includes("transcription failed")||W.toLowerCase().includes("server not running")||W.toLowerCase().includes("timed out");if(Y||ee||ge||ce){console.warn("âŒ Transcription validation failed:",{length:W.length,isEmpty:Y,tooShort:ee,isPlaceholder:ge,isError:ce,preview:W.substring(0,100)}),f(N,S,`Transcription validation failed: ${Y?"Empty transcription":ee?`Too short (${W.length} chars)`:ge?"Placeholder response":"Transcription error"}`,W),e.updatePatientSession(b,{transcription:W,status:"error",errors:[`Audio transcription failed: ${Y?"No audio detected. Please ensure your microphone is working and try again.":ee?"Recording too short. Please record for at least 3-5 seconds.":ge?"Transcription service unavailable. Please check if the Whisper server is running.":"Transcription service error. Please try again or check the server status."}`],completedTime:Date.now()}),e.setTranscription(W),e.setErrors([`Audio transcription failed: ${Y?"No audio detected. Please ensure your microphone is working and try again.":ee?"Recording too short. Please record for at least 3-5 seconds.":ge?"Transcription service unavailable. Please check if the Whisper server is running.":"Transcription service error. Please try again or check the server status."}`]),e.setProcessingStatus("error"),console.log("ðŸš« Skipping agent processing due to transcription validation failure");return}console.log("âœ… Transcription validation passed, proceeding with agent processing"),e.updatePatientSession(b,{transcription:L,status:"processing",processingStartTime:Date.now()}),e.setTranscription(L),e.setProcessingStatus("processing"),console.log("ðŸ”„ Processing with agent for session:",b,S);const Ee=Date.now(),{AgentFactory:Pe}=await je(async()=>{const{AgentFactory:G}=await import("./chunks/AgentFactory.BUZB8vXp.js");return{AgentFactory:G}},__vite__mapDeps([4,5,6,7,2])),z=await Pe.processWithAgent(S,L,void 0,D.signal,{skipNotification:!0}),B=Date.now()-Ee;if(R.recordMetrics("agent-processing",B,{agentType:S}),console.log("âœ… Agent processing complete for session:",b),e.updatePatientSession(b,{results:z.content,summary:z.summary||"",agentName:z.agentName,status:"completed",completed:!0,completedTime:Date.now(),processingTime:z.processingTime,warnings:z.warnings,errors:z.errors}),R.recordMetrics("complete",Date.now()-O,{agentType:S}),e.setTranscription(L),e.setResults(z.content),e.setMissingInfo(z.missingInfo||null),S==="bloods")try{console.log("ðŸ©¸ Bloods workflow completed - inserting results into Tests Requested field");const G={content:z.content};(await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods-insert",data:G}))?.success?console.log("âœ… Blood test results inserted into Tests Requested field successfully"):console.warn("âš ï¸ Failed to insert blood test results into Tests Requested field")}catch(G){console.error("âŒ Failed to insert blood test results into Tests Requested field:",G)}z.summary&&z.summary.trim()?(mn.debug("Setting AI-generated summary",{component:"summary",length:z.summary.length}),e.setAiGeneratedSummary(z.summary)):e.setAiGeneratedSummary(void 0),e.setCurrentAgent(S);const Q=n.patientSessions.find(G=>G.id===b),K=Q?.recordingStartTime?O-Q.recordingStartTime:0;e.setTimingData({recordingTime:K,transcriptionTime:X,agentProcessingTime:B,totalProcessingTime:K+X+B,processingStartTime:O}),e.setProcessingStatus("complete"),e.setProcessing(!1),console.log("âœ… Session completed in background:",b);try{const G=n.patientSessions.find(ie=>ie.id===b)?.patient.name||"Unknown Patient";await Ra.showCompletionNotification(S,z.processingTime||0,void 0,G),console.log("ðŸŽ‰ Background session completed for:",G)}catch(G){console.warn("Failed to send completion notification:",G)}try{const G=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;setTimeout(()=>{const ie=u.current||document.getElementById("results-section");ie&&typeof ie.scrollIntoView=="function"&&ie.scrollIntoView({behavior:G?"auto":"smooth",block:"start"})},50)}catch{}}catch(O){console.error("âŒ Background processing failed for session:",b,O),e.setProcessing(!1),e.setProcessingStatus("idle"),O.name==="AbortError"?e.updatePatientSession(b,{status:"cancelled",errors:["Processing was cancelled"]}):(e.updatePatientSession(b,{status:"error",errors:[O.message||"Processing failed"]}),e.setErrors([O.message||"Processing failed"])),f(N,S,O.message||"Background processing failed","",0)}},[e,m,f,n.patientSessions]),v=d.useCallback(async b=>{if(s.current=b,n.ui.isCancelling){console.log("ðŸ›‘ Recording completed but cancellation in progress - ignoring"),e.setCancelling(!1);return}const N=r.current||n.ui.activeWorkflow,S=i.current||n.currentSessionId;if(!N){console.error("âŒ No active workflow selected"),e.setErrors(["No workflow selected. Please select a workflow type before recording."]);return}if(!S){console.error("âŒ No current session found"),e.setErrors(["No active session. Please start a new recording."]);return}console.log("ðŸŽ¤ Recording completed, starting background processing for session:",S),e.updatePatientSession(S,{status:"transcribing",audioBlob:b}),e.setProcessing(!0),e.setProcessingStatus("transcribing"),e.setCurrentAgent(N),e.setCurrentSessionId(null),i.current=null,e.setActiveWorkflow(null),r.current=null,g(S,b,N),console.log("ðŸš€ Background processing started for session:",S,"- ready for new recordings!")},[e,g,n.ui.isCancelling,n.currentSessionId]),k=d.useCallback(b=>{console.log("ðŸ“‹ Selected patient session:",b.patient.name,"with status:",b.status),e.setSelectedSessionId(b.id),b.transcription&&e.setTranscription(b.transcription),b.results&&e.setResults(b.results),b.summary&&e.setAiGeneratedSummary(b.summary),b.agentType&&(e.setCurrentAgent(b.agentType),e.setCurrentAgentName(b.agentName||b.agentType)),e.setCurrentPatientInfo(b.patient),e.setActiveWorkflow(null),e.setProcessingStatus("complete"),e.clearMissingInfo(),console.log("âœ… Session data loaded for patient:",b.patient.name)},[e]),I=d.useCallback(b=>{const N=b.split(/[.!?]+/).filter(D=>D.trim().length>0);if(N.length===0)return b.substring(0,150)+"...";const S=["stenosis","regurgitation","valve","artery","diagnosis","treatment"],M=N.filter(D=>S.some(O=>D.toLowerCase().includes(O)));return M.length>0?M.slice(0,2).join(". ").trim()+".":N[0]?.trim()+"."},[]);d.useCallback((b,N)=>N&&N.trim()?N.trim():I(b),[I]);const T=Cs({onRecordingComplete:v,onVoiceActivityUpdate:d.useCallback((b,N)=>{d.startTransition(()=>{e.setVoiceActivity(b,N)})},[e]),onRecordingTimeUpdate:d.useCallback(b=>{o.current=b},[]),getMicrophoneId:()=>a.selectedMicrophoneId}),F=d.useCallback(async()=>{try{console.log("ðŸ‘¤ Extracting patient data from EMR...");const b=await chrome.tabs.query({active:!0,currentWindow:!0});console.log("ðŸ” Current active tab:",b[0]?.url);const N=3;let S=null;for(let M=1;M<=N;M++){console.log(`ðŸ” Attempt ${M}/${N}: Sending extraction request to content script...`);try{const D=await Promise.race([chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),new Promise((O,R)=>setTimeout(()=>R(new Error("Patient extraction timeout")),1e4))]);if(console.log("ðŸ“¬ Received response from content script:",D),D?.success&&D?.data){const O=D.data;console.log(`âœ… Patient data extraction succeeded on attempt ${M}:`,O);const R=O.name&&O.name.trim()!=="",L=O.id&&O.id.trim()!=="";if(R||L)return console.log("âœ… Patient data validation passed - returning data"),O;console.warn(`âš ï¸ Attempt ${M}: Extracted data lacks name and ID - will retry`),S=new Error("Extracted data lacks required patient name or ID")}else console.warn(`âš ï¸ Attempt ${M}: No valid patient data in response`),S=new Error(D?.error||"No patient data found in response")}catch(D){if(console.warn(`âš ï¸ Attempt ${M} failed:`,D.message),S=D,M<N){const O=Math.min(1e3*Math.pow(2,M-1),5e3);console.log(`â³ Waiting ${O}ms before retry...`),await new Promise(R=>setTimeout(R,O))}}}return console.error("âŒ All patient extraction attempts failed. Last error:",S),null}catch(b){return console.error("âŒ Critical error in patient data extraction:",b),console.error("ðŸ” Error details:",{name:b instanceof Error?b.name:"Unknown",message:b instanceof Error?b.message:b,stack:b instanceof Error?b.stack:void 0}),null}},[]),x=d.useCallback(async b=>{console.log("ðŸŽ¯ Workflow selected:",b),n.processingStatus==="error"&&(console.log("ðŸ”„ Auto-recovering from error state - resetting to idle for new recording"),e.setProcessingStatus("idle"),e.setErrors([]),e.setWarnings([]),e.clearRecording()),(n.results?.trim().length>0||n.transcription?.trim().length>0)&&(console.log("ðŸ”„ Clearing previous session before starting new workflow:",b),e.clearRecording()),n.selectedSessionId&&(console.log("ðŸ”„ Clearing selected session view for new recording"),e.setSelectedSessionId(null));const N=n.patientSessions.filter(M=>["recording","transcribing","processing"].includes(M.status)),S=n.patientSessions.filter(M=>M.status==="recording");if(T.isRecording&&n.ui.activeWorkflow===b)console.log("ðŸ›‘ Stopping current recording for:",b),T.stopRecording();else if(!T.isRecording){if(N.length>=3){e.setErrors([`Too many active sessions (${N.length}). Please wait for some to complete before starting new recordings.`]);return}if(S.length>0){e.setErrors(["Another recording is already in progress. Please complete or cancel the current recording first."]);return}if(console.log("ðŸ” Checking Whisper server status before recording..."),!n.modelStatus.whisperServer?.running){console.error("âŒ Whisper server not running"),e.setErrors(["Whisper server is not running. Please start the server first using: ./start-whisper-server.sh"]);return}console.log("ðŸ“‹ Extracting patient data for new recording..."),e.setExtractingPatients(!0);let M=null;try{const R=await F();if(R&&(R.name||R.id))M={name:R.name||"Patient",id:R.id||"No ID",dob:R.dob||"",age:R.age||"",phone:R.phone,email:R.email,medicare:R.medicare,insurance:R.insurance,address:R.address,extractedAt:R.extractedAt||Date.now()},e.setCurrentPatientInfo(M),console.log("âœ… Patient data extracted successfully:",R.name,"(ID:",R.id+")");else{console.log("âš ï¸ No patient data extracted from EMR - generating fallback patient info");const L=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});M={name:`Patient ${(n.patientSessions?.length||0)+1} (${L})`,id:`Session-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},e.setCurrentPatientInfo(M),console.log("ðŸ“ Generated fallback patient info:",M.name)}}catch(R){console.error("âŒ Patient extraction failed with error:",R);const L=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});M={name:`Patient ${(n.patientSessions?.length||0)+1} (${L})`,id:`Session-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},e.setCurrentPatientInfo(M),console.log("ðŸ“ Generated fallback patient info after extraction error:",M.name)}finally{e.setExtractingPatients(!1)}const D=`session-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,O={id:D,patient:M,transcription:"",results:"",agentType:b,agentName:"",timestamp:Date.now(),status:"recording",completed:!1,recordingStartTime:Date.now()};e.addPatientSession(O),e.setCurrentSessionId(D),i.current=D,console.log("ðŸ“ Created new session:",D,"for patient:",O.patient.name),console.log("âœ… Whisper server is running, starting recording..."),e.setActiveWorkflow(b),r.current=b,T.startRecording(),e.setProcessingStartTime(Date.now())}},[T,n.ui.activeWorkflow,e,F,n.patientSessions,n.modelStatus]),y=d.useCallback(()=>{console.log("ðŸ›‘ Cancellation requested"),e.setCancelling(!0),l.current&&(l.current.abort(),l.current=null),c.current&&(c.current.abort(),c.current=null),T.isRecording&&T.stopRecording();const b=i.current||n.currentSessionId;b&&(console.log("ðŸ§¹ Cleaning up current session:",b),e.removePatientSession(b),e.setCurrentSessionId(null),i.current=null),e.setActiveWorkflow(null),e.setProcessing(!1),e.setProcessingStatus("idle"),e.setWarnings([]),e.setErrors([]),e.setResults(""),e.setResultsSummary(""),r.current=null,setTimeout(()=>e.setCancelling(!1),1e3)},[T,e]),j=d.useCallback(async b=>{try{await navigator.clipboard.writeText(b),console.log("ðŸ“‹ Text copied to clipboard")}catch(N){throw console.error("Failed to copy text:",N),N}},[]),C=d.useCallback(async b=>{try{if(console.log("ðŸ”„ Reprocessing transcription with agent:",b),!n.transcription||n.transcription.trim().length===0){console.error("âŒ No transcription available for reprocessing"),e.setErrors(["No transcription available for reprocessing"]);return}if(n.isProcessing){console.warn("âš ï¸ Already processing, ignoring reprocess request");return}e.setResults(""),e.setWarnings([]),e.setErrors([]),e.setResultsSummary(""),e.setProcessing(!0),e.setProcessingStatus("processing"),e.setCurrentAgent(b),e.setProcessingStartTime(Date.now()),console.log("ðŸ”„ Starting agent processing with:",b),e.setMissingInfo(null);const{AgentFactory:N}=await je(async()=>{const{AgentFactory:M}=await import("./chunks/AgentFactory.BUZB8vXp.js");return{AgentFactory:M}},__vite__mapDeps([4,5,6,7,2])),S=await N.processWithAgent(b,n.transcription,void 0,c.current?.signal);console.log("âœ… Agent reprocessing completed"),e.setResults(S.content),e.setMissingInfo(S.missingInfo||null),S.summary&&S.summary.trim()?(mn.debug("Setting AI-generated summary from reprocessing",{component:"summary",agent:b}),e.setAiGeneratedSummary(S.summary)):e.setAiGeneratedSummary(void 0),e.setTimingData({agentProcessingTime:S.processingTime,totalProcessingTime:S.processingTime}),e.setCurrentAgentName(S.agentName),e.setProcessingStatus("complete"),e.setProcessing(!1),S.warnings?.length&&e.setWarnings(S.warnings),S.errors?.length&&e.setErrors(S.errors)}catch(N){console.error("âŒ Agent reprocessing failed:",N),e.setProcessing(!1),e.setProcessingStatus("idle"),N.name==="AbortError"?console.log("ðŸ›‘ Agent reprocessing was cancelled"):e.setErrors([N.message||"Reprocessing failed"])}},[n.transcription,n.isProcessing,e]),w=d.useCallback(async b=>{try{if(!n.transcription||!n.currentAgent)return;e.setProcessing(!0),e.setProcessingStatus("processing");const N=Object.entries(b).filter(([O,R])=>R&&R.trim().length>0).map(([O,R])=>`- ${O}: ${R.trim()}`).join(`
`),S=`${n.transcription}

Additional details provided by clinician to fill missing information:
${N}`,{AgentFactory:M}=await je(async()=>{const{AgentFactory:O}=await import("./chunks/AgentFactory.BUZB8vXp.js");return{AgentFactory:O}},__vite__mapDeps([4,5,6,7,2])),D=await M.processWithAgent(n.currentAgent,S,void 0,c.current?.signal);e.setResults(D.content),e.setMissingInfo(D.missingInfo||null),e.setProcessingStatus("complete"),e.setProcessing(!1)}catch(N){console.error("Reprocess with missing info failed:",N),e.setProcessing(!1),e.setProcessingStatus("idle")}},[n.transcription,n.currentAgent,e]),E=d.useCallback(async()=>{if(!(!n.results||n.currentAgent!=="quick-letter"||n.isGeneratingPatientVersion))try{console.log("ðŸŽ¯ Generating patient-friendly version of letter"),e.setGeneratingPatientVersion(!0);const{QuickLetterAgent:b}=await je(async()=>{const{QuickLetterAgent:M}=await import("./chunks/agents.BCwlpfSj.js").then(D=>D.Q);return{QuickLetterAgent:M}},__vite__mapDeps([1,2])),S=await new b().generatePatientVersion(n.results);e.setPatientVersion(S),console.log("âœ… Patient version generated successfully")}catch(b){console.error("âŒ Failed to generate patient version:",b),e.setPatientVersion("Error generating patient version. Please try again.")}finally{e.setGeneratingPatientVersion(!1)}},[n.results,n.currentAgent,n.isGeneratingPatientVersion,e]),A=d.useCallback(async(b,N)=>{try{const S=n.currentAgent||n.ui.activeWorkflow,M=N||Ma(S);M&&Ss(S)?(console.log(`ðŸ“ Inserting to specific EMR field: ${M} (${$n(M)})`),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:M,data:{content:b,insertMode:"append"}}),console.log(`âœ… Text inserted to ${$n(M)} field with append mode`)):(console.log("ðŸ“ Using generic EMR text insertion (no specific field mapping)"),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insertText",data:{text:b}}),console.log("ðŸ“ Text inserted to EMR (generic)"))}catch(S){throw console.error("Failed to insert text to EMR:",S),S}},[n.currentAgent,n.ui.activeWorkflow]),P=e.setModelStatus,$=d.useCallback(async()=>{try{const b=await m.checkConnection();p.invalidateCache();const N=await p.checkServerStatus(!0),S={...b,whisperServer:N};d.startTransition(()=>{P(S)})}catch(b){d.startTransition(()=>{P({isConnected:!1,classifierModel:"",processorModel:"",lastPing:Date.now(),latency:0,whisperServer:{running:!1,model:"whisper-large-v3-turbo",port:8001,lastChecked:Date.now(),error:b instanceof Error?b.message:"Status check failed"}})})}},[m,p,P]);return d.useEffect(()=>{$();const b=setInterval($,3e4);return()=>clearInterval(b)},[$]),d.useEffect(()=>{T.isRecording&&n.ui.activeWorkflow&&Nn(n.ui.activeWorkflow)?e.setRecordingPrompts(!0):T.isRecording||e.setRecordingPrompts(!1)},[T.isRecording,n.ui.activeWorkflow]),d.useEffect(()=>{let b,N;const S=async()=>{try{console.log("ðŸš€ Initializing critical agents for improved performance...");const{AgentFactory:D}=await je(async()=>{const{AgentFactory:O}=await import("./chunks/AgentFactory.BUZB8vXp.js");return{AgentFactory:O}},__vite__mapDeps([4,5,6,7,2]));await D.preloadCriticalAgents(),b=setTimeout(async()=>{try{console.log("ðŸ”„ Background preloading of common agents..."),await D.preloadCommonAgents(),console.log("âœ… Background agent preloading completed")}catch(O){console.warn("âš ï¸ Background preloading failed:",O)}},5e3)}catch(D){console.warn("âš ï¸ Critical agent preloading failed:",D)}},M=()=>{N=setInterval(async()=>{try{const{AgentFactory:D}=await je(async()=>{const{AgentFactory:R}=await import("./chunks/AgentFactory.BUZB8vXp.js");return{AgentFactory:R}},__vite__mapDeps([4,5,6,7,2])),O=D.getMemoryEstimate();console.log(`ðŸ“Š Agent memory usage: ${O.totalAgents} agents (~${O.estimatedMemoryMB}MB)`),O.totalAgents>8&&(console.log("ðŸ§¹ Optimizing agent cache due to high memory usage..."),D.optimizeCache())}catch(D){console.warn("âš ï¸ Memory optimization failed:",D)}},6e5)};return S(),M(),()=>{b&&clearTimeout(b),N&&clearInterval(N)}},[]),t.jsxs("div",{className:"relative h-full max-h-full flex flex-col bg-surface-secondary overflow-hidden",children:[t.jsx("div",{className:"flex-shrink-0 bg-white/80 backdrop-blur-sm border-b border-line-primary",children:t.jsx(li,{status:T.isRecording?"recording":n.processingStatus,currentAgent:n.currentAgent||n.ui.activeWorkflow,isRecording:T.isRecording,modelStatus:n.modelStatus,onRefreshServices:$,onCompleteRecording:T.stopRecording,onCancelProcessing:y,onWorkflowSelect:x,activeWorkflow:n.ui.activeWorkflow,voiceActivityLevel:n.voiceActivityLevel,recordingTime:T.recordingTime,isExtractingPatients:n.ui.isExtractingPatients,patientSessions:n.patientSessions,onRemoveSession:e.removePatientSession,onClearAllSessions:e.clearPatientSessions,onSessionSelect:k,onShowMetrics:()=>e.setMetricsDashboard(!0),onNewRecording:e.clearRecording,showNewRecording:n.results?.trim().length>0||n.patientSessions.some(b=>b.status==="completed")})}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",ref:u,id:"results-section",children:[T.isRecording&&!n.results&&t.jsxs("div",{className:"flex flex-col space-y-4 p-4",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(vi,{isRecording:T.isRecording,voiceActivityLevel:T.voiceActivityLevel,frequencyData:T.frequencyData,audioLevelHistory:T.audioLevelHistory,recordingTime:T.recordingTime,activeDeviceInfo:T.activeDeviceInfo,onStop:T.stopRecording,className:"min-h-0"})}),n.ui.activeWorkflow&&Nn(n.ui.activeWorkflow)&&t.jsx("div",{className:"flex-shrink-0",children:t.jsx(xi,{agentType:n.ui.activeWorkflow,isVisible:!0,compactMode:!0})})]}),!T.isRecording&&(n.processingStatus==="transcribing"||n.processingStatus==="processing")&&n.transcription&&!n.results&&t.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto p-6 space-y-4",children:t.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg border border-blue-200 p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx("div",{className:"w-2 h-2 bg-accent-violet rounded-full animate-pulse"}),t.jsx("h3",{className:"text-lg font-semibold text-blue-800",children:n.processingStatus==="transcribing"?"Transcribing Audio...":"Processing Report..."})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Transcription:"}),t.jsx("div",{className:"text-gray-800 text-sm leading-relaxed whitespace-pre-wrap max-h-64 overflow-y-auto",children:n.transcription})]}),n.processingStatus==="processing"&&t.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-sm text-blue-600",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsxs("span",{children:["Generating ",n.currentAgent," report..."]})]})]})}),n.reviewData&&t.jsx("div",{className:"flex-shrink-0 bg-white/80 backdrop-blur-sm border-b border-line-primary",children:t.jsx(Zr,{onQuickAction:async(b,N)=>{console.log("ðŸ”§ Quick action:",b,N)},processingAction:""})}),n.ui.showPatientEducationConfig&&t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:t.jsx(pi,{isVisible:n.ui.showPatientEducationConfig,onClose:()=>e.setPatientEducationConfig(!1),isGenerating:n.isProcessing&&n.currentAgent==="patient-education",onGenerate:async b=>{try{e.setProcessing(!0),e.setCurrentAgent("patient-education"),e.setResults(""),e.setErrors([]);const{AgentFactory:N}=await je(async()=>{const{AgentFactory:M}=await import("./chunks/AgentFactory.BUZB8vXp.js");return{AgentFactory:M}},__vite__mapDeps([4,5,6,7,2]));console.log("ðŸŽ“ Processing Patient Education with input:",b);const S=await N.processWithAgent("patient-education",JSON.stringify(b));e.setResults(S.content),e.setPatientEducationConfig(!1),console.log("âœ… Patient Education generation completed")}catch(N){console.error("âŒ Patient Education generation failed:",N);const S=N instanceof Error?N.message:String(N);e.setErrors([`Patient Education generation failed: ${S}`])}finally{e.setProcessing(!1)}}})}),n.results&&n.results.trim().length>0&&t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:t.jsx(sa,{results:n.results,resultsSummary:n.aiGeneratedSummary||"",warnings:n.ui.warnings,errors:n.ui.errors,agentType:n.currentAgent,onCopy:j,onInsertToEMR:A,originalTranscription:n.transcription,onTranscriptionCopy:j,onTranscriptionInsert:A,onAgentReprocess:C,missingInfo:n.missingInfo,onReprocessWithAnswers:w,onDismissMissingInfo:()=>e.clearMissingInfo(),currentAgent:n.currentAgent,isProcessing:n.isProcessing,audioBlob:s.current,transcriptionTime:n.transcriptionTime,agentProcessingTime:n.agentProcessingTime,totalProcessingTime:n.totalProcessingTime,processingStatus:n.processingStatus,currentAgentName:n.currentAgentName,selectedSessionId:n.selectedSessionId,selectedPatientName:n.selectedSessionId?n.patientSessions.find(b=>b.id===n.selectedSessionId)?.patient.name:void 0,patientVersion:n.patientVersion,isGeneratingPatientVersion:n.isGeneratingPatientVersion,onGeneratePatientVersion:E})})]}),t.jsx("div",{className:"flex-shrink-0 bg-white/80 backdrop-blur-sm border-t border-line-primary p-4",children:t.jsx(ma,{onQuickAction:async(b,N)=>{console.log("ðŸ”§ Quick action triggered:",b,N);try{if(b==="annotate-screenshots"){console.log("ðŸ“¸ Opening screenshot annotation modal"),e.setScreenshotAnnotationModal(!0);return}if(b==="patient-education"&&N?.type==="show-config"){console.log("ðŸŽ“ Showing Patient Education configuration card"),e.setPatientEducationConfig(!0);return}if(b==="bloods"&&N?.type==="prepare-modal"){console.log("ðŸ©¸ Preparing bloods modal for dictation..."),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods",data:{}}),console.log("âœ… Bloods modal opened for dictation");return}if(["investigation-summary","background","medications","social-history","bloods","bloods-insert","imaging","quick-letter","appointment-wrap-up","profile-photo","create-task"].includes(b)){const S={};n.results&&n.results.trim().length>0&&N?.type!=="manual"?(S.content=n.results,console.log("ðŸ”§ Sending content to EMR field:",b)):console.log("ðŸ”§ Opening EMR field for manual entry:",b),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:b,data:S}),console.log("âœ… Quick action completed:",b)}else if(b==="ai-medical-review")if(console.log("ðŸ¤– Processing AI Medical Review with data:",N),N?.formattedInput){e.setProcessing(!0),e.setCurrentAgent("ai-medical-review"),e.setResults(""),e.setErrors([]);try{const{AgentFactory:S}=await je(async()=>{const{AgentFactory:D}=await import("./chunks/AgentFactory.BUZB8vXp.js");return{AgentFactory:D}},__vite__mapDeps([4,5,6,7,2]));console.log("ðŸ¤– Processing with BatchPatientReviewAgent...");const M=await S.processWithAgent("ai-medical-review",N.formattedInput);e.setResults(M.content),e.setMissingInfo(M.missingInfo||null),e.setProcessing(!1),console.log("âœ… AI Medical Review completed successfully")}catch(S){console.error("âŒ AI Medical Review processing failed:",S),e.setErrors([`AI Medical Review failed: ${S instanceof Error?S.message:"Unknown error"}`]),e.setProcessing(!1)}}else console.error("âŒ AI Medical Review: No formatted input provided"),e.setErrors(["AI Medical Review failed: No patient data available"]);else b==="batch-ai-review"&&N?.type==="show-modal"?(console.log("ðŸ‘¥ Batch AI Review: Triggering patient selection modal"),e.setPatientModal(!0)):console.log("â„¹ï¸ Unhandled quick action:",b)}catch(S){console.error("âŒ Quick action failed:",b,S),e.setErrors([`Failed to execute ${b}: ${S instanceof Error?S.message:"Unknown error"}`])}},onStartWorkflow:b=>x(b),isFooter:!0})})]}),n.ui.showPatientSelectionModal&&t.jsx(ui,{isOpen:n.ui.showPatientSelectionModal,onClose:()=>e.setPatientModal(!1),onStartReview:()=>{console.log("ðŸ”„ Starting patient review")},calendarData:n.ui.calendarData,isExtracting:n.ui.isExtractingPatients,extractError:n.ui.extractError}),n.ui.showScreenshotAnnotationModal&&t.jsx(vs,{isOpen:n.ui.showScreenshotAnnotationModal,onClose:()=>e.setScreenshotAnnotationModal(!1)}),t.jsx(hi,{isActive:n.ui.showFieldIngestionOverlay,onComplete:()=>e.setFieldIngestionOverlay(!1)}),n.ui.showProcessingPhase&&t.jsx("div",{className:"absolute top-4 left-4 right-4 z-40",children:t.jsx(gi,{currentProgress:n.ui.processingProgress,isActive:n.ui.showProcessingPhase,startTime:n.ui.processingStartTime,agentType:n.currentAgent||void 0,transcriptionLength:n.transcription?n.transcription.length:void 0,showTimeEstimate:!0,onProcessingComplete:b=>{console.log(`â±ï¸ Processing completed in ${b}ms`)}})}),t.jsx(bi,{isOpen:n.ui.showMetricsDashboard,onClose:()=>e.setMetricsDashboard(!1)}),t.jsx(mi,{})]})});Da.displayName="OptimizedAppContent";Ia.displayName="OptimizedApp";const Ts=()=>{const n=e=>{e.preventDefault()};window.addEventListener("dragover",n,{capture:!0}),window.addEventListener("drop",n,{capture:!0}),document.addEventListener("dragover",n,{capture:!0}),document.addEventListener("drop",n,{capture:!0}),document.documentElement?.addEventListener?.("dragover",n,{capture:!0}),document.documentElement?.addEventListener?.("drop",n,{capture:!0}),document.body?.addEventListener?.("dragover",n,{capture:!0}),document.body?.addEventListener?.("drop",n,{capture:!0})};Ts();class Es extends Z.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,a){console.error("React Error Boundary caught an error:",e,a)}render(){return this.state.hasError?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-500 to-red-700 p-4 flex items-center justify-center",children:t.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md text-center",children:[t.jsx("h1",{className:"text-white text-xl font-bold mb-4",children:"Extension Error"}),t.jsx("p",{className:"text-white/80 mb-4",children:"The Operator Chrome Extension encountered an error."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors",children:"Reload Extension"}),this.state.error&&t.jsxs("details",{className:"mt-4 text-left",children:[t.jsx("summary",{className:"text-white/60 cursor-pointer text-sm",children:"Error Details"}),t.jsx("pre",{className:"text-xs text-white/50 mt-2 p-2 bg-black/20 rounded",children:this.state.error.message})]})]})}):this.props.children}}window.addEventListener("error",n=>{console.error("Global error in sidepanel:",n.error)});window.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection in sidepanel:",n.reason)});function _n(){console.log("ðŸ¥ Initializing Operator Chrome Extension...",new Date().toISOString()),console.log("ðŸ”§ Extension context check:",typeof chrome<"u"&&chrome.runtime);const n=document.getElementById("root");if(!n){console.error("âŒ Root element not found!"),document.body.innerHTML=`
      <div style="padding: 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px);">
          <h1 style="color: white; margin-bottom: 1rem;">Mount Error</h1>
          <p style="color: rgba(255,255,255,0.8);">Could not find root element</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `;return}typeof chrome>"u"||!chrome.runtime?console.warn("âš ï¸ Chrome extension APIs not available"):console.log("âœ… Chrome extension context detected");try{Vn(n).render(t.jsx(Z.StrictMode,{children:t.jsx(Es,{children:t.jsx(Ia,{})})})),console.log("âœ… React app rendered successfully")}catch(e){console.error("âŒ Failed to render React app:",e),n.innerHTML=`
      <div style="padding: 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px);">
          <h1 style="color: white; margin-bottom: 1rem;">Render Error</h1>
          <p style="color: rgba(255,255,255,0.8);">${e instanceof Error?e.message:"Unknown error"}</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `}}document.readyState==="loading"?(console.log("â³ Waiting for DOM to load..."),document.addEventListener("DOMContentLoaded",_n)):(console.log("âœ… DOM already loaded, initializing immediately"),_n());typeof window<"u"&&(window.operatorDebug={version:"1.0.0",timestamp:new Date().toISOString(),userAgent:navigator.userAgent,chromeAvailable:typeof chrome<"u",extensionId:chrome?.runtime?.id||"unknown"},console.log("ðŸ”§ Debug info:",window.operatorDebug));export{Ra as N,je as _};
