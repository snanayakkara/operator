const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/AIReasoningModal.Dqwz6ibF.js","chunks/vendor-ui.98gftEja.js","chunks/vendor.DxVDkWSy.js","chunks/modulepreload-polyfill.B5Qt9EMX.js","chunks/AgentFactory.DJn3AVz8.js","chunks/agents.B5B7lzIs.js","chunks/services.DnrVKXEr.js","chunks/settings-components.DsvIyr9e.js","assets/AgentFactory.css","chunks/PatientEducationAgent.C-Yxs4I4.js","chunks/BatchPatientReviewAgent.BhfBedt1.js","chunks/InvestigationSummarySystemPrompts.DOXkk-rD.js","chunks/MedicationSystemPrompts.Cx6BM4t2.js"])))=>i.map(i=>d[i]);
import"./chunks/modulepreload-polyfill.B5Qt9EMX.js";import{j as t,q as la,r as Xe,s as bn,Z as st,m as Qe,t as si,o as yt,u as oi,e as ca,i as li,V as ci,D as Et,R as nn,h as di,P as ui,v as mi,B as lt,T as an,w as B,x as Ae,y as ot,a as Mn,E as pi,K as vn,U as Pt,z as Ye,F as En,G as da,H as ua,I as ma,J as gi,L as pa,N as Ot,O as xt,C as Gt,Q as Vt,W as In,p as yn,Y as ga,_ as wn,$ as hi,a0 as fi,X as Ie,a1 as xi,a2 as bi,l as _t,k as jt,a3 as Ge,a4 as Xt,a5 as vi,a6 as yi,a7 as wi,n as sn,a8 as ji,a9 as ki,A as bt,aa as Qt,ab as Ni,ac as Si,ad as on,ae as Dn,g as Ci,af as Ti,f as ha,ag as On,ah as Ei,ai as Pi,aj as Ai,ak as Ri,c as Mi,al as Ii}from"./chunks/vendor-ui.98gftEja.js";import{r as d,R as oe,a as Di,g as Oi}from"./chunks/vendor.DxVDkWSy.js";import{_ as ke,A as _i,N as fa,Q as $i,c as Fi}from"./chunks/AgentFactory.DJn3AVz8.js";import{l as Z,C as Li}from"./chunks/agents.B5B7lzIs.js";import{A as _n,O as zi}from"./chunks/settings-components.DsvIyr9e.js";import{L as Ui,W as qi,s as Bi,M as kt}from"./chunks/services.DnrVKXEr.js";const xa=d.createContext(void 0),Hi=({children:n})=>{const[e,a]=d.useState(null),[i,r]=d.useState(null),[s,o]=d.useState("auto"),[l,c]=d.useState("auto"),u=(h,m=!1)=>{if(a(h),o(m?"manual":"auto"),m&&h)try{localStorage.setItem("xestro-preferred-microphone",h)}catch(b){console.warn("Failed to persist microphone preference:",b)}},f=(h,m=!1)=>{if(r(h),c(m?"manual":"auto"),m&&h)try{localStorage.setItem("xestro-preferred-speaker",h)}catch(b){console.warn("Failed to persist speaker preference:",b)}};return t.jsx(xa.Provider,{value:{selectedMicrophoneId:e,selectedSpeakerId:i,microphoneSelectionType:s,speakerSelectionType:l,setSelectedMicrophoneId:u,setSelectedSpeakerId:f},children:n})},ba=()=>{const n=d.useContext(xa);if(n===void 0)throw new Error("useAudioDeviceContext must be used within an AudioDeviceProvider");return n},va=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"m12 1 0 11"}),t.jsx("path",{d:"m18 7c0 4.97-4.03 9-9 9s-9-4.03-9-9"}),t.jsx("path",{d:"m12 20 0 3"}),t.jsx("path",{d:"m8 23 8 0"})]}),Wi=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),At=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t.jsx("polyline",{points:"14,2 14,8 20,8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),t.jsx("polyline",{points:"10,9 9,9 8,9"})]}),Vi=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"22,12 18,12 15,21 9,3 6,12 2,12"})}),Gi=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"}),t.jsx("path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"}),t.jsx("circle",{cx:"20",cy:"10",r:"2"})]}),Xi=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("circle",{cx:"12",cy:"12",r:"1"})]}),Fe=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"20,6 9,17 4,12"})}),Rt=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),Ze=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"})}),Qi=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("polygon",{points:"11,5 6,9 2,9 2,15 6,15 11,19"}),t.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"})]}),Ji=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("path",{d:"m21 21-4.35-4.35"})]}),Ki=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Yi=({className:n,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[t.jsx("path",{d:"M10.5 20.5 L3.5 13.5 L10.5 6.5 L17.5 13.5 Z"}),t.jsx("path",{d:"M13.5 3.5 L20.5 10.5 L13.5 17.5 L6.5 10.5 Z"})]}),Zi=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),ya=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"6,9 12,15 18,9"})}),wa=({className:n,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:t.jsx("polyline",{points:"18,15 12,9 6,15"})}),Ee={immediate:.15,quick:.2,normal:.3},ze={sharp:[.4,0,.6,1],gentle:[.25,.46,.45,.94],professional:[.4,0,.2,1]},vt={gentle:{type:"spring",damping:25,stiffness:300,mass:1},responsive:{type:"spring",damping:30,stiffness:400,mass:.8}},Je=(n,e=ze.professional)=>({duration:n,ease:e,type:"tween"}),St=(n=vt.gentle)=>n,Mt={tight:.03,normal:.05},tt={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:Je(Ee.quick,ze.gentle)},exit:{opacity:0,y:-10,scale:.98,transition:Je(Ee.immediate,ze.sharp)}},er={idle:{scale:1,y:0},hover:{scale:1.02,y:-1,transition:St(vt.responsive)},tap:{scale:.98,y:0,transition:Je(Ee.immediate,ze.sharp)},success:{scale:[1,1.05,1],transition:{duration:.6,times:[0,.3,1],ease:ze.gentle}}},Jt={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:Mt.normal,delayChildren:.1,when:"beforeChildren"}},exit:{opacity:0,transition:{staggerChildren:Mt.tight,staggerDirection:-1,when:"afterChildren"}}},ja={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:St(vt.gentle)},exit:{opacity:0,scale:.95,y:10,transition:Je(Ee.quick,ze.sharp)}},ka={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(4px)",transition:Je(Ee.normal,ze.gentle)},exit:{opacity:0,backdropFilter:"blur(0px)",transition:Je(Ee.quick,ze.sharp)}},It={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:Je(Ee.quick,ze.gentle)}},Ct={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:Je(Ee.quick,ze.gentle)},exit:{opacity:0,x:20,transition:Je(Ee.immediate,ze.sharp)}},pe=n=>{if(!(typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches))return n;const a={};return Object.keys(n).forEach(i=>{const r=n[i];typeof r=="object"&&r!==null?a[i]={...r,transition:{duration:.01}}:a[i]=r}),a},Tt=({className:n="w-4 h-4",title:e})=>{const[a,i]=d.useState(!1),r=()=>{i(!0),setTimeout(()=>i(!1),300)};return t.jsx("span",{onMouseEnter:r,onFocus:r,className:"relative inline-flex items-center justify-center group","aria-hidden":e?void 0:!0,title:e,children:t.jsx(la,{className:`${n} transition-transform duration-300 ${a?"animate-bounce":"group-hover:scale-110"}`})})};class at{static instance;metrics=[];maxMetricsHistory=100;constructor(){}static getInstance(){return at.instance||(at.instance=new at),at.instance}recordMetrics(e,a,i){const r={timestamp:Date.now(),processingPhase:e,duration:a,memoryUsage:this.getMemoryInfo(),systemLoad:this.getSystemLoad(),...i};this.metrics.push(r),this.metrics.length>this.maxMetricsHistory&&(this.metrics=this.metrics.slice(-this.maxMetricsHistory)),console.log(`ðŸ“Š Performance: ${e} completed in ${a}ms`,{phase:e,duration:a,agentType:i?.agentType,audioSize:i?.audioSize?Math.round(i.audioSize/1024)+"KB":void 0,memoryUsage:r.memoryUsage?.estimatedMemoryMB+"MB"}),this.detectPerformanceIssues(r)}getMemoryInfo(){let e={totalAgents:0,estimatedMemoryMB:0};try{typeof window<"u"&&window.AgentFactory&&(e=window.AgentFactory.getMemoryEstimate())}catch{}const a=window.performance;let i={jsHeapSizeLimit:0,jsHeapTotalSize:0,jsHeapUsedSize:0};return a&&a.memory&&(i={jsHeapSizeLimit:a.memory.jsHeapSizeLimit,jsHeapTotalSize:a.memory.totalJSHeapSize,jsHeapUsedSize:a.memory.usedJSHeapSize}),{...e,...i}}getSystemLoad(){const e=this.metrics.slice(-5);if(e.length===0)return{};const a=e.reduce((o,l)=>o+l.duration,0)/e.length,i={transcription:2e3,"agent-loading":500,"agent-processing":5e3,complete:0};let r=0;e.forEach(o=>{const l=i[o.processingPhase]||1e3,c=o.duration/l;r+=Math.min(c,3)});const s=r/e.length*100;return{cpuUsage:Math.min(s,100),isMainThreadBlocked:a>1e4,frameDrops:s>200?Math.floor(s/50):0}}detectPerformanceIssues(e){const a=[];e.processingPhase==="transcription"&&e.duration>1e4&&a.push(`Slow transcription (${e.duration}ms) - check MLX Whisper server`),e.processingPhase==="agent-processing"&&e.duration>3e4&&a.push(`Slow processing (${e.duration}ms) - agent: ${e.agentType}`),e.memoryUsage&&e.memoryUsage.jsHeapUsedSize>100*1024*1024&&a.push(`High memory usage (${Math.round(e.memoryUsage.jsHeapUsedSize/1024/1024)}MB)`),e.memoryUsage&&e.memoryUsage.totalAgents>8&&a.push(`Too many agents loaded (${e.memoryUsage.totalAgents}) - consider cache optimization`),a.length>0&&console.warn("âš ï¸ Performance issues detected:",a)}getPerformanceSummary(){if(this.metrics.length===0)return{totalSessions:0,averageTranscriptionTime:0,averageProcessingTime:0,averageCompressionRatio:0,memoryTrend:"stable",recommendedOptimizations:["Start using the extension to collect performance data"]};const e=this.metrics.filter(u=>u.processingPhase==="transcription"),a=this.metrics.filter(u=>u.processingPhase==="agent-processing"),i=this.metrics.filter(u=>u.compressionRatio!==void 0),r=e.length>0?e.reduce((u,f)=>u+f.duration,0)/e.length:0,s=a.length>0?a.reduce((u,f)=>u+f.duration,0)/a.length:0,o=i.length>0?i.reduce((u,f)=>u+(f.compressionRatio||0),0)/i.length:0,l=this.analyzeMemoryTrend(),c=this.generateOptimizationRecommendations(r,s,o,l);return{totalSessions:Math.floor(this.metrics.filter(u=>u.processingPhase==="complete").length),averageTranscriptionTime:Math.round(r),averageProcessingTime:Math.round(s),averageCompressionRatio:Math.round(o*10)/10,memoryTrend:l,recommendedOptimizations:c}}analyzeMemoryTrend(){const e=this.metrics.slice(-20).filter(l=>l.memoryUsage);if(e.length<5)return"stable";const a=e.slice(0,Math.floor(e.length/2)),i=e.slice(Math.floor(e.length/2)),r=a.reduce((l,c)=>l+(c.memoryUsage?.jsHeapUsedSize||0),0)/a.length,o=(i.reduce((l,c)=>l+(c.memoryUsage?.jsHeapUsedSize||0),0)/i.length-r)/r*100;return o>10?"increasing":o<-10?"decreasing":"stable"}generateOptimizationRecommendations(e,a,i,r){const s=[];return e>8e3&&(s.push("Transcription is slow - check MLX Whisper server performance"),s.push("Consider restarting the Whisper server: ./start-whisper-server.sh")),a>2e4&&s.push("Agent processing is slow - consider using lighter models for simple tasks"),i<20&&s.push("Low compression ratio - audio files may benefit from better compression"),r==="increasing"&&(s.push("Memory usage is increasing - enable automatic cache optimization"),s.push("Consider restarting the extension periodically for long sessions")),s.length===0&&(s.push("Performance is optimal - no specific optimizations needed"),s.push("Continue using agent preloading for best performance")),s}clearMetrics(){this.metrics=[],console.log("ðŸ§¹ Performance metrics cleared")}exportMetrics(){return[...this.metrics]}getRecentIssues(e=5){const a=Date.now()-e*60*1e3,i=this.metrics.filter(s=>s.timestamp>a),r=[];return i.forEach(s=>{s.processingPhase==="transcription"&&s.duration>1e4&&r.push(`Slow transcription: ${s.duration}ms`),s.processingPhase==="agent-processing"&&s.duration>3e4&&r.push(`Slow ${s.agentType} processing: ${s.duration}ms`)}),[...new Set(r)]}}class it{static instance;historicalData=[];maxHistorySize=200;performanceService;agentProfiles={"investigation-summary":{baselineMs:1500,lengthScalingFactor:.8,modelComplexity:"lightweight",expectedRange:{min:1e3,max:3e3}},medication:{baselineMs:1800,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3500}},background:{baselineMs:2e3,lengthScalingFactor:1,modelComplexity:"lightweight",expectedRange:{min:1500,max:4e3}},bloods:{baselineMs:1600,lengthScalingFactor:.85,modelComplexity:"lightweight",expectedRange:{min:1100,max:3200}},imaging:{baselineMs:1700,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3400}},"quick-letter":{baselineMs:4e3,lengthScalingFactor:1.2,modelComplexity:"standard",expectedRange:{min:2500,max:8e3}},consultation:{baselineMs:5e3,lengthScalingFactor:1.4,modelComplexity:"standard",expectedRange:{min:3e3,max:12e3}},tavi:{baselineMs:6e3,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},"angiogram-pci":{baselineMs:6500,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},mteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},tteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},"pfo-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"asd-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"right-heart-cath":{baselineMs:5800,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:3800,max:13e3}},"pvl-plug":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"bypass-graft":{baselineMs:7e3,lengthScalingFactor:2,modelComplexity:"heavy",expectedRange:{min:4500,max:18e3}},"tavi-workup":{baselineMs:6500,lengthScalingFactor:1.9,modelComplexity:"heavy",expectedRange:{min:4e3,max:16e3}},"ai-medical-review":{baselineMs:8e3,lengthScalingFactor:2.2,modelComplexity:"heavy",expectedRange:{min:5e3,max:2e4}},"batch-ai-review":{baselineMs:15e3,lengthScalingFactor:3,modelComplexity:"heavy",expectedRange:{min:1e4,max:45e3}},"patient-education":{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:3e3,max:1e4}},enhancement:{baselineMs:3e3,lengthScalingFactor:1.1,modelComplexity:"standard",expectedRange:{min:2e3,max:6e3}},transcription:{baselineMs:2e3,lengthScalingFactor:.5,modelComplexity:"lightweight",expectedRange:{min:1e3,max:4e3}},generation:{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:2500,max:9e3}}};constructor(){this.performanceService=at.getInstance(),this.loadHistoricalData()}static getInstance(){return it.instance||(it.instance=new it),it.instance}predictProcessingTime(e,a,i){const r=this.agentProfiles[e];if(!r)throw new Error(`Unknown agent type: ${e}`);const s=this.historicalData.filter(R=>R.agentType===e),o=this.categorizeTranscriptionLength(a),l=r.baselineMs,c=this.calculateLengthFactor(a,r.lengthScalingFactor),u=this.calculateHistoricalAdjustment(e,a,s),f=this.calculateSystemPerformanceFactor(i?.systemPerformance),h=l*c*u*f,m=Math.max(r.expectedRange.min,Math.min(r.expectedRange.max,h)),b=i?.includeTranscriptionTime?m+this.estimateTranscriptionTime(a):m,g=this.calculateConfidenceLevel(s.length,o),x=g==="high"?.2:g==="medium"?.4:.6,w={min:Math.round(b*(1-x)),max:Math.round(b*(1+x))},I=[{name:"Agent baseline",impact:l,description:`${r.modelComplexity} model baseline`,type:"additive"},{name:"Transcription length",impact:c,description:`${o.category} transcription (${a} chars)`,type:"multiplier"}];return u!==1&&I.push({name:"Historical performance",impact:u,description:`Based on ${s.length} similar sessions`,type:"multiplier"}),f!==1&&I.push({name:"System performance",impact:f,description:i?.systemPerformance?`Current system load: ${i.systemPerformance}%`:"System performance adjustment",type:"multiplier"}),{estimatedDurationMs:Math.round(b),confidenceLevel:g,factors:I,range:w,basedOnSessions:s.length,displayText:this.formatEstimateForDisplay(w,g,s.length)}}categorizeTranscriptionLength(e){return e<300?{category:"short",range:{min:0,max:300},description:"Short dictation (< 300 characters)"}:e<800?{category:"medium",range:{min:300,max:800},description:"Medium dictation (300-800 characters)"}:e<1500?{category:"long",range:{min:800,max:1500},description:"Long dictation (800-1500 characters)"}:{category:"very-long",range:{min:1500,max:1/0},description:"Very long dictation (> 1500 characters)"}}calculateLengthFactor(e,a){const r=e/500;return 1+Math.log(r+1)*a*.3}calculateHistoricalAdjustment(e,a,i){if(i.length<3)return 1;const r={min:a*.5,max:a*1.5},s=i.filter(o=>o.transcriptionLength>=r.min&&o.transcriptionLength<=r.max);return s.length<2?this.calculateAveragePerformanceRatio(i,e):this.calculateAveragePerformanceRatio(s,e)}calculateAveragePerformanceRatio(e,a){const i=this.agentProfiles[a],r=e.map(o=>{const l=i.baselineMs*this.calculateLengthFactor(o.transcriptionLength,i.lengthScalingFactor);return o.actualProcessingTime/l}),s=r.reduce((o,l)=>o+l,0)/r.length;return Math.max(.5,Math.min(2,s))}calculateSystemPerformanceFactor(e){return e?2-Math.max(0,Math.min(100,e))/100*1.2:(this.performanceService.getPerformanceSummary(),this.performanceService.getRecentIssues(2).length>0?1.3:1)}estimateTranscriptionTime(e){return 1500+Math.log(e/100+1)*200}calculateConfidenceLevel(e,a){return e>=20?"high":e>=8?"medium":"low"}formatEstimateForDisplay(e,a,i){const r=this.formatDuration(e.min),s=this.formatDuration(e.max),o=a==="high"?"High confidence":a==="medium"?"Medium confidence":"Low confidence";return i>0?`Expected: ${r}-${s} (${o}, ${i} sessions)`:`Expected: ${r}-${s} (${o})`}formatDuration(e){if(e<1e3)return`${Math.round(e)}ms`;const a=e/1e3;return a<10?`${a.toFixed(1)}s`:`${Math.round(a)}s`}recordActualProcessingTime(e,a,i,r){const s={agentType:e,transcriptionLength:a,actualProcessingTime:i,timestamp:Date.now(),systemPerformance:r};this.historicalData.push(s),this.historicalData.length>this.maxHistorySize&&(this.historicalData=this.historicalData.slice(-this.maxHistorySize)),this.saveHistoricalData(),Z.info(`Recorded processing time for ${e}`,{component:"processing-predictor",operation:"record-time",agentType:e,transcriptionLength:a,processingTime:i})}updatePredictionAccuracy(e,a){const i=a>=e.range.min&&a<=e.range.max,r=1-Math.abs(e.estimatedDurationMs-a)/e.estimatedDurationMs;return Z.info(`Prediction accuracy: ${Math.round(r*100)}%, within range: ${i}`,{component:"processing-predictor",operation:"accuracy-check",accuracy:Math.round(r*100),withinRange:i}),{accuracy:Math.max(0,r),wasWithinRange:i}}getAgentPerformanceStats(e){const a=this.historicalData.filter(s=>s.agentType===e);if(a.length===0)return{averageTime:this.agentProfiles[e]?.baselineMs||5e3,sessionCount:0,accuracyTrend:"stable"};const i=a.reduce((s,o)=>s+o.actualProcessingTime,0)/a.length,r=this.analyzeTrend(a);return{averageTime:Math.round(i),sessionCount:a.length,accuracyTrend:r}}analyzeTrend(e){if(e.length<6)return"stable";const a=Math.floor(e.length/2),i=e.slice(0,a),r=e.slice(a),s=i.reduce((c,u)=>c+u.actualProcessingTime,0)/i.length,l=(r.reduce((c,u)=>c+u.actualProcessingTime,0)/r.length-s)/s*100;return l<-10?"improving":l>10?"declining":"stable"}async loadHistoricalData(){try{const e=await chrome.storage.local.get("processingTimeHistory");e.processingTimeHistory&&(this.historicalData=e.processingTimeHistory.slice(-this.maxHistorySize),Z.info(`Loaded ${this.historicalData.length} historical processing time data points`,{component:"processing-predictor",operation:"load-data",dataPoints:this.historicalData.length}))}catch(e){Z.warn("Failed to load historical processing time data",{component:"processing-predictor",operation:"load-data",error:e instanceof Error?e.message:String(e)})}}async saveHistoricalData(){try{await chrome.storage.local.set({processingTimeHistory:this.historicalData})}catch(e){Z.warn("Failed to save historical processing time data",{component:"processing-predictor",operation:"save-data",error:e instanceof Error?e.message:String(e)})}}clearHistoricalData(){this.historicalData=[],chrome.storage.local.remove("processingTimeHistory"),Z.info("Cleared historical processing time data",{component:"processing-predictor",operation:"clear-data"})}exportHistoricalData(){return[...this.historicalData]}}const Ft={"quick-letter":{min:3e4,max:6e4,complexity:"low"},consultation:{min:12e4,max:24e4,complexity:"medium"},"investigation-summary":{min:1e4,max:3e4,complexity:"low"},tavi:{min:48e4,max:72e4,complexity:"high"},mteer:{min:42e4,max:6e5,complexity:"high"},"pfo-closure":{min:3e5,max:48e4,complexity:"medium"},"right-heart-cath":{min:36e4,max:6e5,complexity:"medium"},"angiogram-pci":{min:48e4,max:9e5,complexity:"high"},"ai-medical-review":{min:18e4,max:24e4,complexity:"medium"}},tr=({appState:n,isRecording:e=!1,recordingTime:a=0,transcriptionLength:i})=>{const[r,s]=d.useState(0),[o,l]=d.useState(null),[c]=d.useState(()=>it.getInstance());d.useEffect(()=>{let m;return(n.processingStatus==="transcribing"||n.processingStatus==="processing")&&(m=window.setInterval(()=>{n.processingStartTime&&s(Date.now()-n.processingStartTime)},100)),()=>{m&&clearInterval(m)}},[n.processingStatus,n.processingStartTime]),d.useEffect(()=>{try{if(n.currentAgent&&typeof i=="number"&&i>0){const m=c.predictProcessingTime(n.currentAgent,i,{includeTranscriptionTime:!0});l(m)}else l(null)}catch(m){console.warn("Failed to predict processing time:",m),l(null)}},[n.currentAgent,i,c]);const u=m=>{if(m===null)return"0s";const b=Math.floor(m/1e3);if(b<60)return`${(m/1e3).toFixed(1)}s`;{const g=Math.floor(b/60),x=b%60;return`${g}m ${x}s`}},f=m=>{if(m===null)return"0s";const b=Math.floor(m/1e3);if(b<60)return`${b}s`;{const g=Math.floor(b/60),x=b%60;return`${g}m ${x.toString().padStart(2,"0")}s`}},h=(m,b)=>{if(o)return m<o.range.min?{icon:"ðŸŸ¢",color:"text-green-600",label:"Fast"}:m<=o.range.max?{icon:"ðŸŸ¡",color:"text-yellow-600",label:"Normal"}:{icon:"ðŸ”´",color:"text-red-600",label:"Slow"};if(!b||!Ft[b])return{icon:"ðŸŸ¡",color:"text-yellow-600",label:"Normal"};const g=Ft[b];return m<g.min?{icon:"ðŸŸ¢",color:"text-green-600",label:"Fast"}:m<=g.max?{icon:"ðŸŸ¡",color:"text-yellow-600",label:"Normal"}:{icon:"ðŸ”´",color:"text-red-600",label:"Slow"}};if(e&&a>0)return t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Xe,{className:"h-4 w-4 text-red-600 animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-red-800",children:"Recording..."}),t.jsxs("span",{className:"text-sm text-red-600 font-mono",children:["(",f(a)," elapsed)"]})]})});if(n.processingStatus==="transcribing")return t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(bn,{className:"h-4 w-4 text-blue-600 animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Transcribing..."}),t.jsxs("span",{className:"text-sm text-blue-600 font-mono",children:["(",f(r)," elapsed)"]})]})});if(n.processingStatus==="processing")return t.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(st,{className:"h-4 w-4 text-purple-600 animate-pulse"}),t.jsxs("span",{className:"text-sm font-medium text-purple-800",children:[n.currentAgentName||"Agent"," Processing..."]}),t.jsxs("span",{className:"text-sm text-purple-600 font-mono",children:["(",f(r)," elapsed)"]})]})});if(n.processingStatus==="complete"&&n.totalProcessingTime){const m=h(n.totalProcessingTime,n.currentAgent),b=n.recordingTime?Math.round(n.recordingTime/n.totalProcessingTime*100):0,g=n.transcriptionTime?Math.round(n.transcriptionTime/n.totalProcessingTime*100):0,x=n.agentProcessingTime?Math.round(n.agentProcessingTime/n.totalProcessingTime*100):0;return t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qe,{className:"h-4 w-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-800",children:"Processing Complete"}),t.jsxs("span",{className:`text-xs ${m.color}`,children:[m.icon," ",m.label]})]}),t.jsx("span",{className:"text-sm font-semibold text-green-800",children:u(n.totalProcessingTime)})]}),t.jsxs("div",{className:"space-y-2",children:[n.recordingTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),t.jsx("span",{className:"text-gray-700",children:"Recording (Voice Input)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-red-400 h-1.5 rounded-full",style:{width:`${b}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:u(n.recordingTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[b,"%"]})]})]}),n.transcriptionTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),t.jsx("span",{className:"text-gray-700",children:"Transcription (MLX Whisper)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-blue-400 h-1.5 rounded-full",style:{width:`${g}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:u(n.transcriptionTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[g,"%"]})]})]}),n.agentProcessingTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),t.jsxs("span",{className:"text-gray-700",children:[n.currentAgentName||"Agent"," (MedGemma-27b MLX)"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-purple-400 h-1.5 rounded-full",style:{width:`${x}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:u(n.agentProcessingTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[x,"%"]})]})]})]}),(()=>{if(o)return t.jsx("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:o.displayText});if(n.currentAgent&&Ft[n.currentAgent]){const w=Ft[n.currentAgent];return t.jsxs("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:["Expected: ",u(w.min)," - ",u(w.max)," (",w.complexity," complexity)"]})}return null})()]})})}return null};class We{static instance;STORAGE_KEY="xestro-recording-metrics";MAX_STORED_METRICS=500;constructor(){}static getInstance(){return We.instance||(We.instance=new We),We.instance}async storeMetric(e){try{const a={...e,sessionId:this.generateSessionId(),timestamp:new Date},i=await this.getAllMetrics(),r=[a,...i].slice(0,this.MAX_STORED_METRICS);await chrome.storage.local.set({[this.STORAGE_KEY]:JSON.stringify(r)}),console.log("ðŸ“Š Metric stored:",{agent:e.agentType,transcription:`${e.transcriptionTime}ms`,processing:`${e.processingTime}ms`,total:`${e.totalDuration}ms`})}catch(a){console.error("Failed to store metric:",a)}}async getAllMetrics(){try{const a=(await chrome.storage.local.get(this.STORAGE_KEY))[this.STORAGE_KEY];return a?JSON.parse(a).map(r=>({...r,timestamp:new Date(r.timestamp)})):[]}catch(e){return console.error("Failed to get metrics:",e),[]}}async getAnalytics(){const a=(await this.getAllMetrics()).filter(m=>m.success);if(a.length===0)return this.getEmptyAnalytics();const i={},r={};a.forEach(m=>{i[m.agentType]||(i[m.agentType]={count:0,totalTranscription:0,totalProcessing:0,totalDuration:0});const b=i[m.agentType];b.count++,b.totalTranscription+=m.transcriptionTime,b.totalProcessing+=m.processingTime,b.totalDuration+=m.totalDuration,r[m.modelUsed]||(r[m.modelUsed]={count:0,totalTime:0}),r[m.modelUsed].count++,r[m.modelUsed].totalTime+=m.processingTime});const s={};Object.entries(i).forEach(([m,b])=>{s[m]={count:b.count,avgTranscription:Math.round(b.totalTranscription/b.count),avgProcessing:Math.round(b.totalProcessing/b.count),avgTotal:Math.round(b.totalDuration/b.count)}});const o={};Object.entries(r).forEach(([m,b])=>{o[m]={count:b.count,avgTime:Math.round(b.totalTime/b.count)}});const l=a.slice(0,10),c=a.slice(0,25),u=l.length>0?Math.round(l.reduce((m,b)=>m+b.totalDuration,0)/l.length):0,f=c.length>0?Math.round(c.reduce((m,b)=>m+b.totalDuration,0)/c.length):0,h=f>0&&u>0?Math.round((f-u)/f*100):0;return{totalRecordings:a.length,averageTranscriptionTime:Math.round(a.reduce((m,b)=>m+b.transcriptionTime,0)/a.length),averageProcessingTime:Math.round(a.reduce((m,b)=>m+b.processingTime,0)/a.length),averageTotalDuration:Math.round(a.reduce((m,b)=>m+b.totalDuration,0)/a.length),agentTypeBreakdown:s,recentTrend:{last10Avg:u,last25Avg:f,improvementPercent:h},modelPerformance:o}}async clearAllMetrics(){try{await chrome.storage.local.remove(this.STORAGE_KEY),console.log("ðŸ“Š All metrics cleared")}catch(e){console.error("Failed to clear metrics:",e)}}async getMetricsByAgent(e){return(await this.getAllMetrics()).filter(i=>i.agentType===e)}async exportMetrics(){const e=await this.getAllMetrics();return JSON.stringify(e,null,2)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getEmptyAnalytics(){return{totalRecordings:0,averageTranscriptionTime:0,averageProcessingTime:0,averageTotalDuration:0,agentTypeBreakdown:{},recentTrend:{last10Avg:0,last25Avg:0,improvementPercent:0},modelPerformance:{}}}}const Na=d.memo(({results:n,agentType:e,className:a=""})=>{const[i,r]=d.useState(!0),[s,o]=d.useState(!1),l=d.useMemo(()=>{const m=n.split(/\s+/).filter(w=>w.length>0).length,b=Math.ceil(m/200),g=n.length,x=n.split(`
`).length;return{wordCount:m,readingTime:b,charCount:g,lineCount:x}},[n]),c=n.length>1e3,u=d.useMemo(()=>!c||s?n:n.substring(0,500)+"...",[n,c,s]),f=d.useMemo(()=>{const m=[],b=u.split(`
`);let g={title:"",content:""};for(const x of b){const w=x.trim();w.match(/^[A-Z][A-Z\s]+:?$/)||w.match(/^[A-Z][a-z\s]+:$/)?(g.content.trim()&&m.push({...g}),g={title:w.replace(":",""),content:""}):w&&(g.content+=x+`
`)}return g.content.trim()&&m.push(g),m.length===0&&m.push({title:"Medical Report",content:u}),m},[u]),h=m=>m?{tavi:"TAVI Report","angiogram-pci":"Angiogram/PCI Report","quick-letter":"Quick Letter",consultation:"Consultation Report","investigation-summary":"Investigation Summary",background:"Background Summary",medication:"Medication Review",bloods:"Blood Test Order",imaging:"Imaging Order",mteer:"mTEER Report",tteer:"TTEER Report","pfo-closure":"PFO Closure Report","asd-closure":"ASD Closure Report","pvl-plug":"PVL Plug Report","bypass-graft":"Bypass Graft Report","right-heart-cath":"Right Heart Catheterisation","tavi-workup":"TAVI Workup","ai-medical-review":"AI Medical Review","batch-ai-review":"Batch AI Review","patient-education":"Patient Education",enhancement:"Enhanced Report",transcription:"Transcription",generation:"Generated Report"}[m]||m.toUpperCase():"Medical Report";return n?t.jsxs("div",{className:`glass rounded-2xl overflow-hidden ${a}`,children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>r(!i),className:"p-1 hover:bg-gray-100 rounded transition-colors","aria-label":i?"Collapse report":"Expand report",children:i?t.jsx(si,{className:"w-5 h-5 text-gray-600"}):t.jsx(yt,{className:"w-5 h-5 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-semibold text-sm",children:h(e)}),t.jsxs("div",{className:"text-gray-600 text-xs mt-1",children:[t.jsxs("span",{children:[l.wordCount," words"]}),t.jsx("span",{className:"mx-2",children:"â€¢"}),t.jsxs("span",{children:[l.readingTime," min read"]}),t.jsx("span",{className:"mx-2",children:"â€¢"}),t.jsx("span",{children:new Date().toLocaleTimeString()})]})]})]}),c&&t.jsx("button",{onClick:()=>o(!s),className:"text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:s?"Show Less":"Show More"})]})}),i&&t.jsxs("div",{className:"report-content",children:[f.length>1?t.jsx("div",{className:"space-y-4 p-4",children:f.map((m,b)=>t.jsxs("div",{className:"section",children:[m.title&&t.jsx("h4",{className:"font-semibold text-gray-900 border-b border-gray-200 pb-1 mb-2 text-sm",children:m.title}),t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:m.content})]},b))}):t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap font-mono",children:u})}),c&&!s&&t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("button",{onClick:()=>o(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1 transition-colors",children:[t.jsxs("span",{children:["Show complete report (",l.charCount," characters)"]}),t.jsx(yt,{className:"w-4 h-4"})]})})]})]}):null});Na.displayName="ReportDisplay";const Sa=({audioBlob:n,fileName:e="investigation-audio",className:a="",onAnalysisUpdate:i})=>{const[r,s]=d.useState(!1),[o,l]=d.useState(0),[c,u]=d.useState(0),[f,h]=d.useState(1),[m,b]=d.useState(1),[g,x]=d.useState([]),[w,I]=d.useState(""),[R,D]=d.useState(null),[v,y]=d.useState(!1),[S,C]=d.useState(!1),T=d.useRef(null),M=d.useRef(null),k=d.useRef(),j=d.useRef();d.useEffect(()=>{const U=URL.createObjectURL(n);return I(U),()=>{URL.revokeObjectURL(U)}},[n]);const A=d.useCallback(async()=>{if(n)try{const U=await n.arrayBuffer(),p=new AudioContext,N=await p.decodeAudioData(U),E=N.getChannelData(0),q=N.sampleRate,O=N.duration;let $=0,X=0;const se=.01;for(let xe=0;xe<E.length;xe++){const Ce=Math.abs(E[xe]);$+=Ce,Ce<se&&X++}const ce=$/E.length,ie=X/q,ve=[...E].map(Math.abs).sort((xe,Ce)=>xe-Ce),we=ve[Math.floor(ve.length*.1)],de=ve[Math.floor(ve.length*.9)],fe=de>0?20*Math.log10(de/(we+.001)):0;let F="good";ce<.005||ie>O*.8||fe<10?F="poor":(ce<.02||ie>O*.5||fe<20)&&(F="fair");const L=200,ee=Math.floor(E.length/L),le=[];for(let xe=0;xe<L;xe++){let Ce=0;const V=xe*ee,ne=Math.min(V+ee,E.length);for(let ae=V;ae<ne;ae++)Ce+=Math.abs(E[ae]);le.push(Ce/(ne-V))}const je={duration:O,fileSize:n.size,quality:F,avgVolume:ce,silenceDuration:ie,estimatedSNR:fe};x(le),D(je),i?.(je),await p.close()}catch(U){console.error("Audio analysis failed:",U)}},[n,i]);d.useEffect(()=>{w&&A()},[w,A]);const P=d.useCallback(()=>{const U=M.current;if(!U||!g.length||!c)return;const p=U.getContext("2d");if(!p)return;const{width:N,height:E}=U,q=o/c;p.clearRect(0,0,N,E);const O=N/g.length,$=Math.max(...g);g.forEach((se,ce)=>{const ie=Math.max(2,se/$*E*.8),ve=ce*O,we=(E-ie)/2;ce/g.length<=q?p.fillStyle=v?"#1d4ed8":"#3b82f6":p.fillStyle="#d1d5db",p.fillRect(ve,we,Math.max(1,O-1),ie)});const X=q*N;p.strokeStyle=v?"#dc2626":"#ef4444",p.lineWidth=v?3:2,p.beginPath(),p.moveTo(X,0),p.lineTo(X,E),p.stroke(),v&&(p.fillStyle="rgba(239, 68, 68, 0.2)",p.fillRect(X-2,0,4,E))},[g,o,c,v]);d.useEffect(()=>{P()},[P]);const _=()=>{if(T.current&&!v&&!S){const U=T.current.currentTime;isFinite(U)&&U>=0&&l(U)}},z=()=>{if(T.current){const U=T.current.duration;isFinite(U)&&U>0?u(U):(console.warn("Invalid audio duration detected:",U),u(0))}},Q=()=>{s(!1),K()},G=d.useCallback(()=>{j.current&&(window.clearTimeout(j.current),j.current=void 0),y(!1),T.current&&isFinite(T.current.currentTime)&&l(T.current.currentTime)},[]),J=d.useCallback(()=>{j.current&&(window.clearTimeout(j.current),j.current=void 0),y(!1),T.current&&isFinite(T.current.currentTime)&&l(T.current.currentTime)},[]),H=d.useCallback(()=>{if(!r||!T.current||v||S)return;const U=()=>{T.current&&r&&!v&&!S&&(l(T.current.currentTime),k.current=requestAnimationFrame(U))};k.current=requestAnimationFrame(U)},[r,v,S]),K=d.useCallback(()=>{k.current&&(cancelAnimationFrame(k.current),k.current=void 0)},[]),Ne=d.useCallback(()=>{!T.current||v||(r?(T.current.pause(),s(!1),K()):T.current.play().then(()=>{s(!0),!S&&!v&&H()}).catch(U=>{console.error("Audio playback failed:",U),s(!1)}))},[r,v,S,H,K]),be=d.useCallback(U=>{if(!T.current||!c||!isFinite(c)||c<=0){console.log("âŒ seekTo validation failed:",{hasAudioRef:!!T.current,duration:c,isFiniteDuration:isFinite(c||0),durationValid:(c||0)>0});return}if(!isFinite(U)||U<0||U>100){console.error("âŒ Invalid percentage in seekTo:",{percentage:U,isFinite:isFinite(U),inRange:U>=0&&U<=100});return}if(v)return;y(!0);const p=U/100*c,N=Math.max(0,Math.min(c,p));if(!isFinite(N)){console.error("âŒ Calculated newTime is non-finite:",{percentage:U,duration:c,rawNewTime:p,newTime:N}),y(!1);return}console.log("ðŸŽ¯ Seeking to:",{percentage:U.toFixed(2),newTime:N.toFixed(2),duration:c.toFixed(2)}),j.current&&(window.clearTimeout(j.current),j.current=void 0),l(N);try{isFinite(N)&&N>=0&&N<=c?(T.current.currentTime=N,j.current=window.setTimeout(()=>{y(!1),T.current&&isFinite(T.current.currentTime)&&l(T.current.currentTime)},200)):(console.error("âŒ Final validation failed for currentTime:",{newTime:N,duration:c}),y(!1))}catch(E){console.error("âŒ Seek failed:",E),y(!1),j.current&&(window.clearTimeout(j.current),j.current=void 0)}},[c,v]),te=d.useCallback(U=>{U.preventDefault(),U.stopPropagation();const p=M.current;if(!p||!c||!isFinite(c)||c<=0){console.log("âŒ Cannot seek: canvas or duration not available",{canvas:!!p,duration:c,isFiniteDuration:isFinite(c||0)});return}if(v){console.log("â­ï¸ Seek already in progress, ignoring click");return}const N=p.getBoundingClientRect(),E=U.clientX-N.left,q=E/N.width*100,O=Math.max(0,Math.min(100,q));if(!isFinite(O)){console.error("âŒ Invalid percentage calculated:",{x:E,width:N.width,rawPercentage:q,percentage:O});return}console.log("ðŸŽ¯ Waveform clicked:",{x:E.toFixed(2),width:N.width.toFixed(2),percentage:O.toFixed(2)});try{be(O)}catch($){console.error("âŒ Waveform seek failed:",$)}},[c,v,be]),Y=d.useCallback(()=>{K(),s(!1),C(!1),T.current&&T.current.pause(),be(0)},[be,K]),Te=()=>{const U=URL.createObjectURL(n),p=document.createElement("a");p.href=U,p.download=`${e}-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.webm`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(U)},ye=U=>{if(!isFinite(U)||isNaN(U)||U<0)return"0:00";const p=Math.floor(U/60),N=Math.floor(U%60);return`${p}:${N.toString().padStart(2,"0")}`},Be=U=>{switch(U){case"good":return"text-green-600";case"fair":return"text-yellow-600";case"poor":return"text-red-600";default:return"text-gray-600"}},_e=U=>{switch(U){case"good":return"âœ…";case"fair":return"âš ï¸";case"poor":return"âŒ";default:return"â“"}};return d.useEffect(()=>{r||K()},[r,K]),d.useEffect(()=>()=>{j.current&&window.clearTimeout(j.current)},[]),d.useEffect(()=>()=>{K(),j.current&&window.clearTimeout(j.current)},[K]),t.jsxs("div",{className:`space-y-4 p-4 bg-gray-50 rounded-lg border ${a}`,children:[t.jsx("audio",{ref:T,src:w,onTimeUpdate:_,onLoadedMetadata:z,onEnded:Q,onSeeked:G,onError:J,onRateChange:()=>h(T.current?.playbackRate||1),preload:"metadata"}),R&&t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Quality:"}),t.jsxs("span",{className:`font-medium ${Be(R.quality)}`,children:[_e(R.quality)," ",R.quality.toUpperCase()]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Duration:"}),t.jsx("span",{className:"text-gray-900",children:ye(R.duration)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"File Size:"}),t.jsxs("span",{className:"text-gray-900",children:[(R.fileSize/1024).toFixed(1),"KB"]})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Avg Volume:"}),t.jsxs("span",{className:"text-gray-900",children:[(R.avgVolume*100).toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Silence:"}),t.jsx("span",{className:"text-gray-900",children:ye(R.silenceDuration)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Est. SNR:"}),t.jsxs("span",{className:"text-gray-900",children:[R.estimatedSNR.toFixed(1),"dB"]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("canvas",{ref:M,width:400,height:80,className:`w-full h-20 bg-white rounded border transition-all duration-200 ${v?"cursor-grabbing border-blue-400 shadow-md":"cursor-pointer hover:bg-gray-50 hover:border-gray-300"}`,onClick:te,onMouseMove:U=>{const p=M.current;if(p&&c&&isFinite(c)&&c>0&&!v){const N=p.getBoundingClientRect(),E=U.clientX-N.left,O=Math.max(0,Math.min(100,E/N.width*100))/100*c;p.title=`Click to seek to ${ye(O)}`}else p&&v&&(p.title="Seeking...")},style:{touchAction:"none"}}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[t.jsx("span",{children:ye(o)}),t.jsx("span",{className:v?"text-blue-600 font-medium":"",children:v?"Seeking...":"Click waveform to seek"}),t.jsx("span",{children:ye(c)})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("input",{type:"range",min:"0",max:"100",step:"0.1",value:c&&isFinite(c)&&c>0?o/c*100:0,onMouseDown:()=>{C(!0),K()},onMouseUp:()=>{C(!1),r&&!v&&H()},onTouchStart:()=>{C(!0),K()},onTouchEnd:()=>{C(!1),r&&!v&&H()},onInput:U=>{if(S){const p=parseFloat(U.target.value);isFinite(p)&&be(p)}},onChange:()=>{},className:"w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",disabled:!c||!isFinite(c)||c<=0}),t.jsx("div",{className:"text-xs text-gray-400 text-center",children:"Alternative: Use slider above to seek"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:Ne,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition-colors",disabled:!w,children:r?t.jsx(oi,{className:"w-5 h-5"}):t.jsx(ca,{className:"w-5 h-5 ml-1"})}),t.jsx("button",{onClick:Y,className:"flex items-center justify-center w-8 h-8 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-full transition-colors",disabled:!w,children:t.jsx(li,{className:"w-4 h-4"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ci,{className:"w-4 h-4 text-gray-600"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:m,onChange:U=>{const p=parseFloat(U.target.value);b(p),T.current&&(T.current.volume=p)},className:"w-20 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("select",{value:f,onChange:U=>{const p=parseFloat(U.target.value);h(p),T.current&&(T.current.playbackRate=p)},className:"text-xs bg-white border border-gray-300 rounded px-2 py-1",children:[t.jsx("option",{value:.5,children:"0.5x"}),t.jsx("option",{value:.75,children:"0.75x"}),t.jsx("option",{value:1,children:"1.0x"}),t.jsx("option",{value:1.25,children:"1.25x"}),t.jsx("option",{value:1.5,children:"1.5x"}),t.jsx("option",{value:2,children:"2.0x"})]}),t.jsx("button",{onClick:Te,className:"flex items-center justify-center w-8 h-8 bg-green-600 hover:bg-green-700 text-white rounded transition-colors",title:"Download audio file",children:t.jsx(Et,{className:"w-4 h-4"})})]})]}),R&&R.quality!=="good"&&t.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3",children:t.jsx("div",{className:"flex items-start",children:t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Audio Quality Issues Detected"}),t.jsxs("div",{className:"mt-1 text-xs text-yellow-600 space-y-1",children:[R.avgVolume<.005&&t.jsx("p",{children:"â€¢ Recording is very quiet - check microphone levels"}),R.silenceDuration>R.duration*.5&&t.jsx("p",{children:"â€¢ Recording contains significant silence"}),R.estimatedSNR<15&&t.jsx("p",{children:"â€¢ High background noise detected"}),R.duration<2&&t.jsx("p",{children:"â€¢ Recording is very short - may affect transcription accuracy"})]})]})})})]})},Ca=d.memo(({originalTranscription:n,onTranscriptionCopy:e,onTranscriptionInsert:a,onTranscriptionEdit:i,transcriptionSaveStatus:r,onAgentReprocess:s,currentAgent:o,isProcessing:l=!1,className:c="",audioBlob:u,defaultExpanded:f=!1,collapseWhen:h,approvalState:m,onTranscriptionApprove:b})=>{const[g,x]=d.useState(!!f),[w,I]=d.useState(!1),[R,D]=d.useState(!1),[v,y]=d.useState(n);oe.useEffect(()=>{h&&g&&x(!1)},[h]),oe.useEffect(()=>{y(n)},[n]);const S=j=>{y(j),i&&i(j)},C=[{id:"tavi",label:"TAVI",icon:"ðŸ«€"},{id:"angiogram-pci",label:"Angiogram/PCI",icon:"ðŸ©º"},{id:"quick-letter",label:"Quick Letter",icon:"ðŸ“"},{id:"consultation",label:"Consultation",icon:"ðŸ‘¨â€âš•ï¸"},{id:"investigation-summary",label:"Investigation",icon:"ðŸ”¬"}],T=async()=>{if(e)try{await e(v),I(!0),setTimeout(()=>I(!1),2e3)}catch(j){console.error("Failed to copy transcription:",j)}},M=async()=>{if(a)try{await a(v),D(!0),setTimeout(()=>D(!1),2e3)}catch(j){console.error("Failed to insert transcription:",j)}},k=j=>{s&&!l&&s(j)};return t.jsxs("div",{className:`border-b border-gray-200/50 ${c} ${l?"bg-blue-50/30 border-b-blue-200/50":""}`,children:[t.jsxs("button",{onClick:()=>x(!g),className:`w-full p-4 text-left transition-colors flex items-center justify-between ${l?"hover:bg-blue-50/60":"hover:bg-gray-50/50"}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(At,{className:`w-4 h-4 ${l?"text-blue-600":"text-gray-600"}`}),t.jsx("span",{className:`font-medium text-sm ${l?"text-blue-900":"text-gray-900"}`,children:"Original Transcription"}),l&&t.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-medium",children:"Processing..."}),t.jsxs("span",{className:"text-xs text-gray-500",children:[v.split(" ").length," words",v!==n&&t.jsx("span",{className:"text-blue-600 ml-1",children:"(edited)"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[e&&t.jsxs("button",{onClick:j=>{j.stopPropagation(),T()},className:`px-2 py-1.5 rounded transition-all duration-200 flex items-center space-x-1 ${l?"bg-blue-50 border border-blue-200 hover:bg-blue-100 shadow-sm":"p-1.5 hover:bg-gray-100"}`,title:l?"Copy raw transcription":"Copy transcription",children:[w?t.jsx(Fe,{className:"w-3.5 h-3.5 text-green-600"}):t.jsx(Tt,{className:"w-3.5 h-3.5 text-blue-600",title:"Copy transcription"}),l&&t.jsx("span",{className:"text-xs text-blue-700 font-medium",children:"Copy Raw"})]}),a&&t.jsx("button",{onClick:j=>{j.stopPropagation(),M()},className:"p-1.5 rounded hover:bg-gray-100 transition-colors",title:"Insert transcription to EMR",children:R?t.jsx(Fe,{className:"w-3.5 h-3.5 text-green-600"}):t.jsx(Ze,{className:"w-3.5 h-3.5 text-blue-500"})}),s&&t.jsx("div",{className:"p-1.5",children:t.jsx(nn,{className:`w-3.5 h-3.5 text-purple-500 ${l?"animate-spin":""}`})}),g?t.jsx(wa,{className:"w-4 h-4 text-gray-400"}):t.jsx(ya,{className:"w-4 h-4 text-gray-400"})]})]}),g&&t.jsxs("div",{className:"px-4 pb-4",children:[t.jsxs("div",{className:"bg-gray-50/80 rounded-lg p-2 border border-gray-200/50",children:[r&&r.status!=="idle"&&t.jsxs("div",{className:`flex items-center space-x-2 mb-2 p-2 rounded text-xs ${r.status==="saving"?"bg-yellow-50 text-yellow-700 border border-yellow-200":r.status==="saved"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[r.status==="saving"&&t.jsx("div",{className:"w-3 h-3 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{children:r.message}),r.timestamp&&t.jsxs("span",{className:"opacity-70",children:["at ",r.timestamp.toLocaleTimeString()]})]}),m&&b&&t.jsxs("div",{className:"mb-3 p-3 bg-white border rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Training Data Quality Control"}),t.jsxs("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${m.status==="pending"?"bg-gray-100 text-gray-700":m.status==="approved"?"bg-green-100 text-green-700":m.status==="edited"?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-500"}`,children:[m.status==="pending"&&"â³ Not Reviewed",m.status==="approved"&&"âœ… Approved",m.status==="edited"&&"âœï¸ Edited",m.status==="skipped"&&"â­ï¸ Skipped"]})]}),t.jsxs("p",{className:"text-xs text-gray-600 mb-3",children:[m.status==="pending"&&"Choose how to handle this transcription for AI training:",m.status==="approved"&&"This transcription has been approved and will be used for training.",m.status==="edited"&&"Your corrections will improve future transcriptions.",m.status==="skipped"&&"This transcription won't be used for training."]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:()=>b("approved"),disabled:m.status==="approved",className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${m.status==="approved"?"bg-green-100 text-green-700 border border-green-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-green-400 hover:bg-green-50"}`,title:"Mark this transcription as perfect for training",children:[t.jsx(di,{className:"w-4 h-4"}),t.jsx("span",{children:"Perfect"})]}),t.jsxs("button",{onClick:()=>{m.status!=="edited"&&b("edited")},className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${m.status==="edited"?"bg-orange-100 text-orange-700 border border-orange-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-orange-400 hover:bg-orange-50"}`,title:"Edit this transcription to improve accuracy",children:[t.jsx(ui,{className:"w-4 h-4"}),t.jsx("span",{children:"Edit"})]}),t.jsxs("button",{onClick:()=>b("skipped"),disabled:m.status==="skipped",className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${m.status==="skipped"?"bg-gray-100 text-gray-700 border border-gray-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-gray-400 hover:bg-gray-50"}`,title:"Skip this transcription for training",children:[t.jsx(mi,{className:"w-4 h-4"}),t.jsx("span",{children:"Skip"})]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{value:v,onChange:j=>S(j.target.value),className:"w-full h-32 p-2 pb-6 text-sm text-gray-900 bg-white border border-gray-200 rounded resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 leading-relaxed",placeholder:"Edit transcription to improve accuracy - corrections will be submitted for training only with your approval...",title:"Edit the transcription to improve accuracy. Training data is only submitted when you explicitly approve it."}),t.jsxs("div",{className:"absolute bottom-1 right-2 flex items-center space-x-2 text-xs text-gray-400",children:[t.jsx("span",{children:"ðŸ§  Training AI"}),t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:[v.split(" ").length," words"]}),v!==n&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"â€¢"}),t.jsx("span",{className:"text-blue-600",children:"edited"})]})]})]})]}),t.jsx("div",{className:"mt-2 text-center",children:t.jsxs("p",{className:"text-xs text-gray-500",children:[m?.status==="pending"?"Choose how to handle this transcription above - training data is only submitted with your explicit approval.":m?.status==="approved"?"This approved transcription will help train Whisper.":m?.status==="edited"?"Your corrections will help train Whisper to be more accurate.":m?.status==="skipped"?"This transcription will not be used for training.":"Training data is only submitted with your explicit approval."," ",t.jsx("button",{className:"text-blue-600 underline hover:text-blue-800",onClick:()=>{console.log("ðŸŽ¯ User wants to view training contributions - would open settings modal")},children:"View your contributions"})]})}),u&&t.jsx("div",{className:"mt-3",children:t.jsx(Sa,{audioBlob:u,fileName:`transcription-${o||"recording"}`,className:"bg-white border-gray-200"})}),s&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Reprocess with different agent:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(j=>t.jsxs("button",{onClick:()=>k(j.id),disabled:l,className:`px-2 py-1 text-xs rounded-md border transition-colors flex items-center space-x-1 ${o===j.id?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"} ${l?"opacity-50 cursor-not-allowed":""}`,children:[t.jsx("span",{children:j.icon}),t.jsx("span",{children:j.label}),o===j.id&&t.jsx("span",{className:"text-xs text-blue-500",children:"â€¢"})]},j.id))})]})]})]})});Ca.displayName="TranscriptionSection";const Ta=d.memo(({reviewData:n,className:e=""})=>{const[a,i]=d.useState(new Set),[r,s]=d.useState(!1),[o,l]=d.useState(new Set);console.log("ðŸŽ´ AI REVIEW CARDS: Component render with data:",{hasReviewData:!!n,reviewDataType:typeof n,reviewDataKeys:n?Object.keys(n):null,findingsArray:n?.findings,findingsType:typeof n?.findings,findingsCount:n?.findings?.length||0,isBatchReview:n?.isBatchReview,timestamp:n?.timestamp,findingsPreview:Array.isArray(n?.findings)?n.findings.slice(0,2):"Not an array"});const c=Array.isArray(n?.findings)?n.findings:[];d.useEffect(()=>{c.length>0&&(i(new Set),l(new Set),s(!0),console.log("ðŸ”„ Reset AI Review acknowledged findings for new review data"),c.forEach((h,m)=>{setTimeout(()=>{l(b=>new Set([...b,m]))},m*200+300)}),setTimeout(()=>{s(!1)},c.length*200+800))},[c.length,n?.timestamp]);const u=h=>{switch(h){case"Immediate":return"red";case"Soon":return"amber";default:return"blue"}},f=h=>{const m=new Set(a);a.has(h)?m.delete(h):m.add(h),i(m)};return t.jsxs("div",{className:`space-y-3 ${e}`,children:[t.jsxs("div",{className:`flex items-center justify-between mb-4 transition-all duration-500 ${o.size>0||c.length===0?"opacity-100 translate-y-0":"opacity-0 translate-y-2"}`,children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Clinical Advisory Cards"}),t.jsx("div",{className:"text-xs text-gray-500",children:c.length>0?`${a.size} of ${c.length} reviewed`:"No findings"})]}),c.length===0?t.jsxs("div",{className:"text-center py-8 bg-green-50 border border-green-200 rounded-lg",children:[t.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),t.jsx("h4",{className:"text-green-800 font-medium mb-2",children:"No Clinical Oversights Identified"}),t.jsx("p",{className:"text-green-700 text-sm",children:n?.noFindingsReason||"The AI review found no major clinical oversights based on Australian guidelines."})]}):c.map((h,m)=>{const b=a.has(m),g=u(h.urgency),x=o.has(m);return t.jsx("div",{className:`border rounded-lg motion-safe:transition-all motion-safe:duration-500 motion-safe:transform motion-reduce:transition-none ${x?"opacity-100 translate-y-0 scale-100":"opacity-0 translate-y-4 scale-95"} ${b?"opacity-60 border-gray-200 bg-gray-50":`border-${g}-200 bg-white`}`,style:{transitionDelay:x?"0ms":`${m*100}ms`},role:"article","aria-labelledby":`finding-${m}-title`,"aria-describedby":`finding-${m}-description`,children:t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("button",{onClick:()=>f(m),className:`flex-shrink-0 w-5 h-5 rounded border-2 motion-safe:transition-colors motion-reduce:transition-none flex items-center justify-center ${b?"bg-green-500 border-green-500":`border-${g}-300 hover:border-${g}-400`}`,"aria-label":b?"Mark as unreviewed":"Mark as reviewed","aria-pressed":b,children:b&&t.jsx(Fe,{className:"w-3 h-3 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("h4",{id:`finding-${m}-title`,className:`font-medium text-sm ${b?"text-gray-500":"text-gray-900"}`,children:h.finding}),t.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${g==="red"?"bg-red-100 text-red-800":g==="amber"?"bg-amber-100 text-amber-800":"bg-blue-100 text-blue-800"}`,children:h.urgency}),h.patientName&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:h.patientName})]}),h.patientFileNumber&&t.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["File: ",h.patientFileNumber]}),!b&&t.jsxs("div",{id:`finding-${m}-description`,className:"space-y-2",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-medium",children:"Guideline:"})," ",h.australianGuideline]}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-medium",children:"Reasoning:"})," ",h.clinicalReasoning]}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-medium",children:"Recommendation:"})," ",h.recommendedAction]}),h.heartFoundationLink&&t.jsx("div",{className:"text-sm",children:t.jsx("a",{href:h.heartFoundationLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 underline",children:"Heart Foundation Resource â†’"})})]})]})]})})},m)})]})});Ta.displayName="AIReviewCards";const nr=oe.lazy(()=>ke(()=>import("./chunks/AIReasoningModal.Dqwz6ibF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Ea=d.memo(({results:n,agentType:e,onCopy:a,onInsertToEMR:i,className:r="",reportMetadata:s,agentName:o})=>{const[l,c]=d.useState(!1),[u,f]=d.useState(!1),[h,m]=d.useState(!1),b=s?.reasoningArtifacts?.hasReasoningContent||s?.rawAIOutput&&s.rawAIOutput.trim().length>0,g=async()=>{try{await a(n),c(!0),setTimeout(()=>c(!1),2e3)}catch(I){console.error("Failed to copy:",I)}},x=async()=>{try{typeof i=="function"&&await i(n,void 0,e),f(!0),setTimeout(()=>f(!1),2e3)}catch(I){console.error("Failed to insert to EMR:",I)}},w=()=>{const I=new Blob([n],{type:"text/plain"}),R=URL.createObjectURL(I),D=document.createElement("a");D.href=R,D.download=`medical-report-${e||"report"}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(R)};return t.jsxs("div",{className:`p-4 border-t border-emerald-200/50 ${r}`,children:[t.jsxs("div",{className:`grid gap-2 ${b?"grid-cols-4":"grid-cols-3"}`,children:[t.jsxs("button",{onClick:g,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${l?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,children:[l?t.jsx(Fe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Tt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${l?"text-emerald-700":"text-gray-700"}`,children:l?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:x,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${u?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,children:[u?t.jsx(Fe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Ze,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${u?"text-emerald-700":"text-gray-700"}`,children:u?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:w,className:"bg-white/60 border border-emerald-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-emerald-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(Et,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]}),b&&t.jsxs("button",{onClick:()=>m(!0),className:"bg-white border-2 border-gray-300 p-3 rounded-lg flex flex-col items-center space-y-1 hover:border-gray-400 hover:shadow-sm transition-all duration-200 ease-out btn-micro-press",title:"View AI Reasoning Process",children:[t.jsx(lt,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Reasoning"})]})]}),t.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-green-400"}),t.jsx("span",{className:"text-green-400 text-xs",children:"Report generated successfully"})]}),t.jsx("div",{className:"text-gray-500 text-xs",children:"Confidence: 95%"})]}),t.jsx("div",{className:"mt-3 p-2 bg-emerald-50/50 rounded-lg border border-emerald-100",children:t.jsxs("p",{className:"text-emerald-700 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Full Letter:"})," Complete medical correspondence ready for EMR insertion or sharing.",b&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),"ðŸ§  ",t.jsx("strong",{children:"AI Reasoning:"})," View how the AI processed your dictation for transparency."]})]})}),b&&t.jsx(d.Suspense,{fallback:null,children:t.jsx(nr,{isOpen:h,onClose:()=>m(!1),reasoningArtifacts:s?.reasoningArtifacts,rawAIOutput:s?.rawAIOutput,agentName:o})})]})});Ea.displayName="ActionButtons";const Pa=d.memo(({warnings:n=[],onDismissWarnings:e,className:a=""})=>{const[i,r]=d.useState(!1);return!n||n.length===0?null:t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>r(!i),className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 hover:bg-orange-200 transition-colors",title:`${n.length} warning${n.length!==1?"s":""} - click to ${i?"hide":"view"}`,children:[t.jsx(Rt,{className:"w-3 h-3"}),t.jsx("span",{children:n.length})]}),i&&t.jsx("div",{className:`p-4 border-b border-orange-200/50 bg-orange-50/30 ${a}`,children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Rt,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-orange-800 font-medium text-sm mb-2",children:"Content Warnings"}),t.jsx("ul",{className:"space-y-1",children:n.map((s,o)=>t.jsxs("li",{className:"text-orange-700 text-sm leading-relaxed",children:["â€¢ ",s]},o))}),e&&t.jsx("button",{onClick:()=>{e(),r(!1)},className:"mt-3 text-orange-600 hover:text-orange-700 text-xs font-medium transition-colors",children:"Dismiss warnings"})]})]})})]})});Pa.displayName="WarningsPanel";const Aa=d.memo(({failedAudioRecordings:n,errors:e,onClearFailedRecordings:a,className:i=""})=>{const[r,s]=d.useState(!1),[o,l]=d.useState(null);return n.length>0&&e.length>0&&e.some(u=>u.includes("could not be parsed coherently")||u.includes("Investigation dictation could not be parsed"))?t.jsxs("div",{className:`border-t border-red-200/50 bg-red-50/30 ${i}`,children:[t.jsxs("button",{onClick:()=>s(!r),className:"w-full p-4 text-left hover:bg-red-50/50 transition-colors flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"w-4 h-4 text-red-600"}),t.jsx("span",{className:"text-red-900 font-medium text-sm",children:"ðŸ”Š Troubleshoot Audio Recording"}),t.jsxs("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-0.5 rounded-full",children:[n.length," recording",n.length!==1?"s":""]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[a&&t.jsx("button",{onClick:u=>{u.stopPropagation(),a()},className:"p-1.5 rounded hover:bg-red-100 transition-colors",title:"Clear all failed recordings",children:t.jsx(an,{className:"w-3.5 h-3.5 text-red-500"})}),r?t.jsx(wa,{className:"w-4 h-4 text-red-400"}):t.jsx(ya,{className:"w-4 h-4 text-red-400"})]})]}),r&&t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-sm text-red-700 bg-red-100/50 p-3 rounded-lg border border-red-200",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Investigation parsing failed"}),t.jsx("p",{className:"text-red-600 mt-1 text-xs",children:"The recording could not be processed into a structured investigation summary. Use the audio playback below to identify potential issues:"}),t.jsxs("ul",{className:"mt-2 text-xs text-red-600 space-y-1",children:[t.jsx("li",{children:"â€¢ Check if audio is too quiet or contains too much silence"}),t.jsx("li",{children:"â€¢ Verify medical terminology is clearly spoken"}),t.jsx("li",{children:"â€¢ Ensure recording duration is adequate (â‰¥2 seconds)"}),t.jsx("li",{children:"â€¢ Look for background noise or audio quality issues"})]})]})]})}),n.length>1&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-red-700 mb-2",children:"Select recording to troubleshoot:"}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:n.map((u,f)=>t.jsx("button",{onClick:()=>l(u),className:`p-3 rounded-lg border text-left transition-colors ${o?.id===u.id?"bg-red-100 border-red-300 text-red-800":"bg-white border-red-200 hover:bg-red-50 text-red-700"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-sm",children:["Recording #",n.length-f]}),t.jsxs("div",{className:"text-xs opacity-75 mt-1",children:[new Date(u.timestamp).toLocaleString()," â€¢",u.metadata.recordingTime,"s â€¢",(u.metadata.fileSize/1024).toFixed(1),"KB"]})]}),o?.id===u.id&&t.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})]})},u.id))})]}),(o||n.length===1)&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-red-700 mb-1",children:"Audio Playback & Analysis"}),t.jsx("p",{className:"text-xs text-red-600",children:"Listen to the recording and check the audio quality metrics below:"})]}),t.jsx(Sa,{audioBlob:(o||n[0]).audioBlob,fileName:`investigation-failed-${(o||n[0]).agentType}`,className:"border-red-200"}),(o||n[0]).transcriptionAttempt&&t.jsxs("div",{className:"mt-3",children:[t.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Transcription Result:"}),t.jsx("div",{className:"bg-white p-3 rounded-lg border border-red-200 text-sm text-gray-800",children:t.jsx("p",{className:"whitespace-pre-wrap",children:(o||n[0]).transcriptionAttempt})}),t.jsx("p",{className:"text-xs text-red-600 mt-2",children:"The transcription above was successful, but could not be parsed into a structured investigation summary."})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Error Details:"}),t.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:t.jsx("p",{className:"text-sm text-red-800 font-mono",children:(o||n[0]).errorMessage})})]})]})]})})]}):null});Aa.displayName="TroubleshootingSection";const ar=({missingInfo:n,onSubmit:e,onDismiss:a})=>{const i=d.useMemo(()=>{const c=[];return Array.isArray(n?.missing_diagnostic)&&c.push(...n.missing_diagnostic),Array.isArray(n?.missing_intervention)&&c.push(...n.missing_intervention),Array.isArray(n?.missing_purpose)&&c.push(...n.missing_purpose),Array.isArray(n?.missing_clinical)&&c.push(...n.missing_clinical),Array.isArray(n?.missing_recommendations)&&c.push(...n.missing_recommendations),c},[n]),[r,s]=d.useState({}),o=(c,u)=>{s(f=>({...f,[c]:u}))},l=n?.completeness_score||"";return i.length===0?null:t.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50",children:[t.jsxs("div",{className:"p-3 border-b border-amber-200 bg-amber-100 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-amber-900 font-semibold text-sm",children:"Missing Information"}),l&&t.jsxs("p",{className:"text-amber-700 text-xs",children:["Completeness: ",l]})]}),a&&t.jsx("button",{className:"text-amber-700 text-xs underline",onClick:a,children:"Dismiss"})]}),t.jsx("div",{className:"p-3 space-y-3",children:i.map(c=>t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-medium text-amber-900 block",children:c}),t.jsx("input",{type:"text",className:"w-full text-sm p-2 border border-amber-200 rounded focus:outline-none focus:ring-2 focus:ring-amber-300 bg-white",placeholder:"Add detail...",value:r[c]||"",onChange:u=>o(c,u.target.value)})]},c))}),t.jsxs("div",{className:"p-3 border-t border-amber-200 bg-amber-50 flex items-center justify-end space-x-2",children:[a&&t.jsx("button",{className:"px-3 py-2 text-xs rounded border border-amber-200 bg-white hover:bg-amber-50",onClick:a,children:"Skip for now"}),t.jsx("button",{className:"px-3 py-2 text-xs rounded bg-amber-600 text-white hover:bg-amber-700",onClick:()=>e(r),children:"Reprocess with answers"})]})]})},Ra=d.memo(({results:n,resultsSummary:e="",agentType:a,onCopy:i,onInsertToEMR:r,warnings:s=[],onDismissWarnings:o,selectedSessionId:l=null,selectedPatientName:c="",originalTranscription:u,onTranscriptionCopy:f,onTranscriptionInsert:h,onTranscriptionEdit:m,transcriptionSaveStatus:b,currentAgent:g,onAgentReprocess:x,missingInfo:w,onReprocessWithAnswers:I,onDismissMissingInfo:R,isProcessing:D=!1,failedAudioRecordings:v=[],onClearFailedRecordings:y,errors:S=[],reviewData:C,audioBlob:T,transcriptionTime:M=null,agentProcessingTime:k=null,totalProcessingTime:j=null,processingStatus:A="idle",currentAgentName:P=null,patientVersion:_=null,isGeneratingPatientVersion:z=!1,onGeneratePatientVersion:Q,streaming:G=!1,streamBuffer:J="",ttftMs:H=null,onStopStreaming:K,approvalState:Ne,onTranscriptionApprove:be,isStreaming:te=!1,streamingTokens:Y="",onCancelStreaming:Te})=>{const[ye,Be]=d.useState(!0),[_e,U]=d.useState(u||"");d.useEffect(()=>{u&&U(u)},[u]),d.useEffect(()=>{(async()=>{A==="complete"&&j&&M&&k&&a&&await We.getInstance().storeMetric({agentType:a,transcriptionTime:M,processingTime:k,totalDuration:j,modelUsed:P||"Unknown",success:!0})})().catch(ne=>{console.error("Failed to store metrics:",ne)})},[A,j,M,k,a,P]);const p=d.useMemo(()=>{if(!n||n.trim().length===0)return{wordCount:0,readingTime:0};const V=n.split(/\s+/).filter(ae=>ae.length>0).length,ne=Math.ceil(V/200);return{wordCount:V,readingTime:ne}},[n]),[N,E]=d.useState({copied:!1,inserted:!1}),[q,O]=d.useState({copied:!1,inserted:!1}),[$,X]=d.useState({copied:!1,inserted:!1}),se=d.useCallback(async()=>{await i(e||"No summary available"),E(ne=>({...ne,copied:!0})),setTimeout(()=>E(ne=>({...ne,copied:!1})),2e3)},[i,e]),ce=d.useCallback(async()=>{await r(e||"No summary available"),E(ne=>({...ne,inserted:!0})),setTimeout(()=>E(ne=>({...ne,inserted:!1})),2e3)},[r,e]),ie=d.useCallback(async()=>{await i(n),O(V=>({...V,copied:!0})),setTimeout(()=>O(V=>({...V,copied:!1})),2e3)},[i,n]),ve=d.useCallback(async()=>{await r(n),O(V=>({...V,inserted:!0})),setTimeout(()=>O(V=>({...V,inserted:!1})),2e3)},[r,n]),we=d.useCallback(()=>{const V=new Blob([e],{type:"text/plain"}),ne=URL.createObjectURL(V),ae=document.createElement("a");ae.href=ne,ae.download=`medical-summary-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ne)},[e]);d.useCallback(()=>{const V=new Blob([n],{type:"text/plain"}),ne=URL.createObjectURL(V),ae=document.createElement("a");ae.href=ne,ae.download=`medical-letter-${a||"report"}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ne)},[n,a]);const de=d.useCallback(async()=>{_&&(await i(_),X(V=>({...V,copied:!0})),setTimeout(()=>X(V=>({...V,copied:!1})),2e3))},[i,_]),fe=d.useCallback(async()=>{_&&(await r(_),X(V=>({...V,inserted:!0})),setTimeout(()=>X(V=>({...V,inserted:!1})),2e3))},[r,_]),F=d.useCallback(()=>{if(_){const V=new Blob([_],{type:"text/plain"}),ne=URL.createObjectURL(V),ae=document.createElement("a");ae.href=ne,ae.download=`patient-version-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ne)}},[_]),L=a==="ai-medical-review"&&C,ee=a==="quick-letter"&&n,xe=a==="quick-letter"&&!!n&&!!e||a!=="quick-letter"&&!!n,Ce=()=>t.jsxs(B.div,{className:"p-4 border-b border-emerald-200/50",initial:"hidden",animate:"visible",variants:pe(tt),children:[l&&c&&t.jsx(B.div,{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2,duration:Ee.quick},children:t.jsxs(B.div,{className:"flex items-center space-x-2",variants:pe(It),children:[t.jsx(Mn,{className:"w-3 h-3 text-blue-600"}),t.jsxs("span",{className:"text-blue-800 text-xs font-medium",children:["Viewing session for: ",c]})]})}),t.jsxs(B.div,{className:"flex items-center justify-between",variants:pe(Ct),children:[t.jsx("div",{className:"flex items-center space-x-2",children:L?t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"w-4 h-4 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:C.isBatchReview?"Batch AI Medical Review":"AI Medical Review"}),t.jsx("p",{className:"text-blue-700 text-xs",children:C.isBatchReview?"Multi-patient clinical oversight recommendations":"Australian clinical oversight recommendations"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx(At,{className:"w-4 h-4 text-emerald-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Final Proof"}),t.jsx("p",{className:"text-emerald-700 text-xs",children:l?"Viewing previous session":"Processed output ready for review"})]})]})}),t.jsx("button",{onClick:()=>Be(!ye),className:"bg-white/60 border border-emerald-200 p-2 rounded-lg hover:bg-emerald-50/60 transition-colors",title:ye?"Collapse":"Expand",children:ye?t.jsx(pi,{className:"w-4 h-4 text-emerald-600"}):t.jsx(Mn,{className:"w-4 h-4 text-emerald-600"})})]}),t.jsxs(B.div,{className:"flex items-center space-x-4 mt-2 text-xs",variants:pe(It),transition:{delay:.1},children:[L?t.jsxs("div",{className:"text-blue-600 flex items-center space-x-2",children:[t.jsxs("span",{children:[C.findings.length," clinical findings"]}),t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:[C.findings.filter(V=>V.urgency==="Immediate").length," immediate"]}),C.isBatchReview&&C.batchSummary&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:[C.batchSummary.totalPatients," patients"]})]}),t.jsx("span",{children:"â€¢"}),t.jsx("span",{children:new Date().toLocaleTimeString()}),s.length>0&&t.jsx("span",{children:"â€¢"})]}):t.jsxs("div",{className:"text-emerald-600 flex items-center space-x-2",children:[t.jsxs("span",{children:[p.wordCount," words"]}),t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:[p.readingTime," min read"]}),t.jsx("span",{children:"â€¢"}),t.jsx("span",{children:new Date().toLocaleTimeString()}),s.length>0&&t.jsx("span",{children:"â€¢"})]}),s.length>0&&t.jsx(Pa,{warnings:s,onDismissWarnings:o})]})]});return t.jsxs(B.div,{className:"letter-card rounded-2xl overflow-hidden shadow-lg border",initial:"hidden",animate:"visible",variants:pe(tt),children:[Ce(),t.jsx(Ae,{children:u&&!G&&t.jsx(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:Ee.normal},children:t.jsx(Ca,{originalTranscription:u,onTranscriptionCopy:f,onTranscriptionInsert:h,onTranscriptionEdit:m,transcriptionSaveStatus:b,onAgentReprocess:x,currentAgent:g,isProcessing:D,audioBlob:T,defaultExpanded:!xe,collapseWhen:xe,approvalState:Ne,onTranscriptionApprove:be})})}),t.jsx(Ae,{children:ye&&t.jsxs(B.div,{className:"p-4",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:Ee.normal},children:[t.jsx(Ae,{children:G&&t.jsxs(B.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:Ee.quick},children:[u&&t.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 bg-gray-100",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(At,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"font-medium text-sm text-gray-900",children:"Original Transcription"}),t.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs rounded",children:"Editable"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[_e.split(" ").length," words",_e!==u&&t.jsx("span",{className:"text-blue-600 ml-1",children:"(edited)"})]}),b&&b.status!=="idle"&&t.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${b.status==="saving"?"bg-yellow-100 text-yellow-700":b.status==="saved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:b.message})]}),t.jsx("div",{className:"flex items-center space-x-2",children:f&&t.jsx("button",{onClick:()=>f?.(u),className:"px-2 py-1 text-xs rounded border border-gray-300 hover:bg-gray-200 transition-colors",children:"Copy"})})]}),t.jsx("div",{className:"p-3 max-h-32 overflow-y-auto",children:t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{value:_e,onChange:V=>{const ne=V.target.value;U(ne),m?.(ne)},className:"w-full h-24 p-2 pb-6 text-sm text-gray-900 bg-white border border-gray-200 rounded resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 leading-relaxed",placeholder:"Edit transcription - your corrections train Whisper to be more accurate for medical dictation...",title:"Your edits are automatically saved as training data to improve future transcription accuracy"}),t.jsx("div",{className:"absolute bottom-1 right-2 text-xs text-gray-400",children:"ðŸ§  Training AI with your corrections"})]})})]}),t.jsxs("div",{className:"rounded-lg border border-emerald-300 bg-emerald-50",children:[t.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-emerald-200 bg-emerald-100",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-emerald-600 text-sm",children:"â— Live Output"}),H!=null&&t.jsxs("span",{className:"text-xs text-emerald-700",children:["TTFT: ",H," ms"]})]}),t.jsx("button",{onClick:K,className:"text-xs px-2 py-1 rounded border border-red-300 text-red-700 bg-red-50 hover:bg-red-100",children:"Stop"})]}),t.jsx("div",{className:"p-3 max-h-64 overflow-y-auto",children:t.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-900",children:J})})]})]})}),t.jsx(Ae,{children:w&&(w.missing_diagnostic?.length>0||w.missing_intervention?.length>0||w.missing_purpose?.length>0||w.missing_clinical?.length>0||w.missing_recommendations?.length>0)&&t.jsx(B.div,{className:"mb-4",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:Ee.quick},children:t.jsx(ar,{missingInfo:w,onSubmit:V=>I&&I(V),onDismiss:R})})}),te&&Y?t.jsxs(B.div,{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",variants:pe(tt),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"p-3 border-b border-blue-200 bg-blue-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),t.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Generating Response..."})]}),Te&&t.jsx("button",{onClick:Te,className:"text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors","aria-label":"Cancel streaming",children:"Cancel"})]}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"text-gray-800 text-sm leading-relaxed whitespace-pre-wrap font-mono",children:[Y,t.jsx("span",{className:"inline-block w-2 h-4 bg-blue-500 animate-pulse ml-1"})]}),t.jsx("div",{className:"mt-3 text-xs text-blue-600",children:"Real-time generation in progress..."})]})]}):L?t.jsxs(t.Fragment,{children:[console.log("ðŸ–¼ï¸ RESULTS PANEL: Rendering AIReviewCards with data:",C),t.jsx(Ta,{reviewData:C})]}):a==="quick-letter"&&n&&!G?(console.log("âœ… DISPLAY: Using QuickLetter dual-card display"),null,t.jsxs(B.div,{className:"space-y-4",variants:pe(Jt),initial:"hidden",animate:"visible",transition:{staggerChildren:Mt.normal,delayChildren:.1},children:[t.jsxs(B.div,{className:"letter-card rounded-lg border border-emerald-200 bg-emerald-50",variants:pe(tt),children:[t.jsx("div",{className:"p-3 border-b border-emerald-200 bg-emerald-100",children:t.jsx("h4",{className:"text-emerald-800 font-semibold text-sm",children:"Summary"})}),t.jsx("div",{className:"p-3 max-h-48 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:e||t.jsx("div",{className:"text-gray-500 italic",children:"Summary not available - displaying full letter content below"})})}),t.jsx("div",{className:"p-3 border-t border-emerald-200 bg-emerald-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:se,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${N.copied?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[N.copied?t.jsx(Fe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Tt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${N.copied?"text-emerald-700":"text-gray-700"}`,children:N.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:ce,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${N.inserted?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[N.inserted?t.jsx(Fe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Ze,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${N.inserted?"text-emerald-700":"text-gray-700"}`,children:N.inserted?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:we,className:"bg-white/60 border border-emerald-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-emerald-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(Et,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]}),t.jsxs(B.div,{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",variants:pe(tt),children:[t.jsx("div",{className:"p-3 border-b border-blue-200 bg-blue-100",children:t.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Letter"})}),t.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:n})}),t.jsx("div",{className:"p-3 border-t border-blue-200 bg-blue-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:ie,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${q.copied?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[q.copied?t.jsx(Fe,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(Tt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${q.copied?"text-blue-700":"text-gray-700"}`,children:q.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:ve,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${q.inserted?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[q.inserted?t.jsx(Fe,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(Ze,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${q.inserted?"text-blue-700":"text-gray-700"}`,children:q.inserted?"Inserted!":"Insert"})]}),t.jsx("button",{onClick:Q,disabled:z,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${z?"bg-blue-100/60 border-blue-300 text-blue-500 cursor-not-allowed":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:z?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-300 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-xs text-blue-500",children:"Generating"})]}):t.jsxs(t.Fragment,{children:[t.jsx(ot,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Patient Version"})]})})]})})]}),t.jsx(Ae,{children:_&&t.jsxs(B.div,{className:"letter-card rounded-lg border border-purple-200 bg-purple-50",variants:pe(tt),initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.2},children:[t.jsx("div",{className:"p-3 border-b border-purple-200 bg-purple-100",children:t.jsx("h4",{className:"text-purple-800 font-semibold text-sm",children:"Patient-Friendly Version"})}),t.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:_})}),t.jsx("div",{className:"p-3 border-t border-purple-200 bg-purple-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:de,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${$.copied?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[$.copied?t.jsx(Fe,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):t.jsx(Tt,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${$.copied?"text-purple-700":"text-gray-700"}`,children:$.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:fe,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${$.inserted?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[$.inserted?t.jsx(Fe,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):t.jsx(Ze,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${$.inserted?"text-purple-700":"text-gray-700"}`,children:$.inserted?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:F,className:"bg-white/60 border border-purple-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-purple-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(Et,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]})})]})):t.jsx(Na,{results:n,agentType:a})]})}),t.jsx(Ae,{children:!L&&!ee&&t.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.3},children:t.jsx(Ea,{results:n,agentType:a,onCopy:i,onInsertToEMR:r})})}),t.jsx(Ae,{children:(j||A!=="idle")&&t.jsx(B.div,{className:"px-4 pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.4},children:t.jsx(tr,{appState:{processingStatus:A,totalProcessingTime:j,transcriptionTime:M,agentProcessingTime:k,currentAgent:a,currentAgentName:P,processingStartTime:null},isRecording:!1,recordingTime:0,transcriptionLength:u?u.length:0})})}),t.jsx(Aa,{failedAudioRecordings:v,errors:S,onClearFailedRecordings:y})]})});Ra.displayName="OptimizedResultsPanel";function Se(n,e){e===void 0&&(e={});var a=e.insertAt;if(n&&typeof document<"u"){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",a==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}Se(`.react-loading-indicator-normalize,
[class$=rli-bounding-box] {
  font-size: 1rem;
  display: inline-block;
  box-sizing: border-box;
  text-align: unset;
  isolation: isolate;
}

.rli-d-i-b {
  display: inline-block;
}

.rli-text-format {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 600;
  width: 90%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.7em;
  letter-spacing: 0.5px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Avenir Next", "Avenir", "Segoe UI", "Lucida Grande", "Helvetica Neue", "Helvetica", "Fira Sans", "Roboto", "Noto", "Droid Sans", "Cantarell", "Oxygen", "Ubuntu", "Franklin Gothic Medium", "Century Gothic", "Liberation Sans", sans-serif;
}`);var qe=function(){return qe=Object.assign||function(n){for(var e,a=1,i=arguments.length;a<i;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},qe.apply(this,arguments)};function Kt(n){return Kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(n)}var ir=/^\s+/,rr=/\s+$/;function W(n,e){if(e=e||{},(n=n||"")instanceof W)return n;if(!(this instanceof W))return new W(n,e);var a=function(i){var r={r:0,g:0,b:0},s=1,o=null,l=null,c=null,u=!1,f=!1;typeof i=="string"&&(i=function(g){g=g.replace(ir,"").replace(rr,"").toLowerCase();var x,w=!1;if(jn[g])g=jn[g],w=!0;else if(g=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(x=$e.rgb.exec(g))?{r:x[1],g:x[2],b:x[3]}:(x=$e.rgba.exec(g))?{r:x[1],g:x[2],b:x[3],a:x[4]}:(x=$e.hsl.exec(g))?{h:x[1],s:x[2],l:x[3]}:(x=$e.hsla.exec(g))?{h:x[1],s:x[2],l:x[3],a:x[4]}:(x=$e.hsv.exec(g))?{h:x[1],s:x[2],v:x[3]}:(x=$e.hsva.exec(g))?{h:x[1],s:x[2],v:x[3],a:x[4]}:(x=$e.hex8.exec(g))?{r:Oe(x[1]),g:Oe(x[2]),b:Oe(x[3]),a:qn(x[4]),format:w?"name":"hex8"}:(x=$e.hex6.exec(g))?{r:Oe(x[1]),g:Oe(x[2]),b:Oe(x[3]),format:w?"name":"hex"}:(x=$e.hex4.exec(g))?{r:Oe(x[1]+""+x[1]),g:Oe(x[2]+""+x[2]),b:Oe(x[3]+""+x[3]),a:qn(x[4]+""+x[4]),format:w?"name":"hex8"}:(x=$e.hex3.exec(g))?{r:Oe(x[1]+""+x[1]),g:Oe(x[2]+""+x[2]),b:Oe(x[3]+""+x[3]),format:w?"name":"hex"}:!1}(i)),Kt(i)=="object"&&(He(i.r)&&He(i.g)&&He(i.b)?(h=i.r,m=i.g,b=i.b,r={r:255*ge(h,255),g:255*ge(m,255),b:255*ge(b,255)},u=!0,f=String(i.r).substr(-1)==="%"?"prgb":"rgb"):He(i.h)&&He(i.s)&&He(i.v)?(o=Nt(i.s),l=Nt(i.v),r=function(g,x,w){g=6*ge(g,360),x=ge(x,100),w=ge(w,100);var I=Math.floor(g),R=g-I,D=w*(1-x),v=w*(1-R*x),y=w*(1-(1-R)*x),S=I%6,C=[w,v,D,D,y,w][S],T=[y,w,w,v,D,D][S],M=[D,D,y,w,w,v][S];return{r:255*C,g:255*T,b:255*M}}(i.h,o,l),u=!0,f="hsv"):He(i.h)&&He(i.s)&&He(i.l)&&(o=Nt(i.s),c=Nt(i.l),r=function(g,x,w){var I,R,D;function v(C,T,M){return M<0&&(M+=1),M>1&&(M-=1),M<1/6?C+6*(T-C)*M:M<.5?T:M<2/3?C+(T-C)*(2/3-M)*6:C}if(g=ge(g,360),x=ge(x,100),w=ge(w,100),x===0)I=R=D=w;else{var y=w<.5?w*(1+x):w+x-w*x,S=2*w-y;I=v(S,y,g+1/3),R=v(S,y,g),D=v(S,y,g-1/3)}return{r:255*I,g:255*R,b:255*D}}(i.h,o,c),u=!0,f="hsl"),i.hasOwnProperty("a")&&(s=i.a));var h,m,b;return s=Ma(s),{ok:u,format:i.format||f,r:Math.min(255,Math.max(r.r,0)),g:Math.min(255,Math.max(r.g,0)),b:Math.min(255,Math.max(r.b,0)),a:s}}(n);this._originalInput=n,this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||a.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=a.ok}function $n(n,e,a){n=ge(n,255),e=ge(e,255),a=ge(a,255);var i,r,s=Math.max(n,e,a),o=Math.min(n,e,a),l=(s+o)/2;if(s==o)i=r=0;else{var c=s-o;switch(r=l>.5?c/(2-s-o):c/(s+o),s){case n:i=(e-a)/c+(e<a?6:0);break;case e:i=(a-n)/c+2;break;case a:i=(n-e)/c+4}i/=6}return{h:i,s:r,l}}function Fn(n,e,a){n=ge(n,255),e=ge(e,255),a=ge(a,255);var i,r,s=Math.max(n,e,a),o=Math.min(n,e,a),l=s,c=s-o;if(r=s===0?0:c/s,s==o)i=0;else{switch(s){case n:i=(e-a)/c+(e<a?6:0);break;case e:i=(a-n)/c+2;break;case a:i=(n-e)/c+4}i/=6}return{h:i,s:r,v:l}}function Ln(n,e,a,i){var r=[Le(Math.round(n).toString(16)),Le(Math.round(e).toString(16)),Le(Math.round(a).toString(16))];return i&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function zn(n,e,a,i){return[Le(Ia(i)),Le(Math.round(n).toString(16)),Le(Math.round(e).toString(16)),Le(Math.round(a).toString(16))].join("")}function sr(n,e){e=e===0?0:e||10;var a=W(n).toHsl();return a.s-=e/100,a.s=rn(a.s),W(a)}function or(n,e){e=e===0?0:e||10;var a=W(n).toHsl();return a.s+=e/100,a.s=rn(a.s),W(a)}function lr(n){return W(n).desaturate(100)}function cr(n,e){e=e===0?0:e||10;var a=W(n).toHsl();return a.l+=e/100,a.l=rn(a.l),W(a)}function dr(n,e){e=e===0?0:e||10;var a=W(n).toRgb();return a.r=Math.max(0,Math.min(255,a.r-Math.round(-e/100*255))),a.g=Math.max(0,Math.min(255,a.g-Math.round(-e/100*255))),a.b=Math.max(0,Math.min(255,a.b-Math.round(-e/100*255))),W(a)}function ur(n,e){e=e===0?0:e||10;var a=W(n).toHsl();return a.l-=e/100,a.l=rn(a.l),W(a)}function mr(n,e){var a=W(n).toHsl(),i=(a.h+e)%360;return a.h=i<0?360+i:i,W(a)}function pr(n){var e=W(n).toHsl();return e.h=(e.h+180)%360,W(e)}function Un(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var a=W(n).toHsl(),i=[W(n)],r=360/e,s=1;s<e;s++)i.push(W({h:(a.h+s*r)%360,s:a.s,l:a.l}));return i}function gr(n){var e=W(n).toHsl(),a=e.h;return[W(n),W({h:(a+72)%360,s:e.s,l:e.l}),W({h:(a+216)%360,s:e.s,l:e.l})]}function hr(n,e,a){e=e||6,a=a||30;var i=W(n).toHsl(),r=360/a,s=[W(n)];for(i.h=(i.h-(r*e>>1)+720)%360;--e;)i.h=(i.h+r)%360,s.push(W(i));return s}function fr(n,e){e=e||6;for(var a=W(n).toHsv(),i=a.h,r=a.s,s=a.v,o=[],l=1/e;e--;)o.push(W({h:i,s:r,v:s})),s=(s+l)%1;return o}W.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var n=this.toRgb();return(299*n.r+587*n.g+114*n.b)/1e3},getLuminance:function(){var n,e,a,i=this.toRgb();return n=i.r/255,e=i.g/255,a=i.b/255,.2126*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))},setAlpha:function(n){return this._a=Ma(n),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var n=Fn(this._r,this._g,this._b);return{h:360*n.h,s:n.s,v:n.v,a:this._a}},toHsvString:function(){var n=Fn(this._r,this._g,this._b),e=Math.round(360*n.h),a=Math.round(100*n.s),i=Math.round(100*n.v);return this._a==1?"hsv("+e+", "+a+"%, "+i+"%)":"hsva("+e+", "+a+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var n=$n(this._r,this._g,this._b);return{h:360*n.h,s:n.s,l:n.l,a:this._a}},toHslString:function(){var n=$n(this._r,this._g,this._b),e=Math.round(360*n.h),a=Math.round(100*n.s),i=Math.round(100*n.l);return this._a==1?"hsl("+e+", "+a+"%, "+i+"%)":"hsla("+e+", "+a+"%, "+i+"%, "+this._roundA+")"},toHex:function(n){return Ln(this._r,this._g,this._b,n)},toHexString:function(n){return"#"+this.toHex(n)},toHex8:function(n){return function(e,a,i,r,s){var o=[Le(Math.round(e).toString(16)),Le(Math.round(a).toString(16)),Le(Math.round(i).toString(16)),Le(Ia(r))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this._r,this._g,this._b,this._a,n)},toHex8String:function(n){return"#"+this.toHex8(n)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*ge(this._r,255))+"%",g:Math.round(100*ge(this._g,255))+"%",b:Math.round(100*ge(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*ge(this._r,255))+"%, "+Math.round(100*ge(this._g,255))+"%, "+Math.round(100*ge(this._b,255))+"%)":"rgba("+Math.round(100*ge(this._r,255))+"%, "+Math.round(100*ge(this._g,255))+"%, "+Math.round(100*ge(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(xr[Ln(this._r,this._g,this._b,!0)]||!1)},toFilter:function(n){var e="#"+zn(this._r,this._g,this._b,this._a),a=e,i=this._gradientType?"GradientType = 1, ":"";if(n){var r=W(n);a="#"+zn(r._r,r._g,r._b,r._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+e+",endColorstr="+a+")"},toString:function(n){var e=!!n;n=n||this._format;var a=!1,i=this._a<1&&this._a>=0;return e||!i||n!=="hex"&&n!=="hex6"&&n!=="hex3"&&n!=="hex4"&&n!=="hex8"&&n!=="name"?(n==="rgb"&&(a=this.toRgbString()),n==="prgb"&&(a=this.toPercentageRgbString()),n!=="hex"&&n!=="hex6"||(a=this.toHexString()),n==="hex3"&&(a=this.toHexString(!0)),n==="hex4"&&(a=this.toHex8String(!0)),n==="hex8"&&(a=this.toHex8String()),n==="name"&&(a=this.toName()),n==="hsl"&&(a=this.toHslString()),n==="hsv"&&(a=this.toHsvString()),a||this.toHexString()):n==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return W(this.toString())},_applyModification:function(n,e){var a=n.apply(null,[this].concat([].slice.call(e)));return this._r=a._r,this._g=a._g,this._b=a._b,this.setAlpha(a._a),this},lighten:function(){return this._applyModification(cr,arguments)},brighten:function(){return this._applyModification(dr,arguments)},darken:function(){return this._applyModification(ur,arguments)},desaturate:function(){return this._applyModification(sr,arguments)},saturate:function(){return this._applyModification(or,arguments)},greyscale:function(){return this._applyModification(lr,arguments)},spin:function(){return this._applyModification(mr,arguments)},_applyCombination:function(n,e){return n.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(hr,arguments)},complement:function(){return this._applyCombination(pr,arguments)},monochromatic:function(){return this._applyCombination(fr,arguments)},splitcomplement:function(){return this._applyCombination(gr,arguments)},triad:function(){return this._applyCombination(Un,[3])},tetrad:function(){return this._applyCombination(Un,[4])}},W.fromRatio=function(n,e){if(Kt(n)=="object"){var a={};for(var i in n)n.hasOwnProperty(i)&&(a[i]=i==="a"?n[i]:Nt(n[i]));n=a}return W(n,e)},W.equals=function(n,e){return!(!n||!e)&&W(n).toRgbString()==W(e).toRgbString()},W.random=function(){return W.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},W.mix=function(n,e,a){a=a===0?0:a||50;var i=W(n).toRgb(),r=W(e).toRgb(),s=a/100;return W({r:(r.r-i.r)*s+i.r,g:(r.g-i.g)*s+i.g,b:(r.b-i.b)*s+i.b,a:(r.a-i.a)*s+i.a})},W.readability=function(n,e){var a=W(n),i=W(e);return(Math.max(a.getLuminance(),i.getLuminance())+.05)/(Math.min(a.getLuminance(),i.getLuminance())+.05)},W.isReadable=function(n,e,a){var i,r,s=W.readability(n,e);switch(r=!1,(i=function(o){var l,c;return l=((o=o||{level:"AA",size:"small"}).level||"AA").toUpperCase(),c=(o.size||"small").toLowerCase(),l!=="AA"&&l!=="AAA"&&(l="AA"),c!=="small"&&c!=="large"&&(c="small"),{level:l,size:c}}(a)).level+i.size){case"AAsmall":case"AAAlarge":r=s>=4.5;break;case"AAlarge":r=s>=3;break;case"AAAsmall":r=s>=7}return r},W.mostReadable=function(n,e,a){var i,r,s,o,l=null,c=0;r=(a=a||{}).includeFallbackColors,s=a.level,o=a.size;for(var u=0;u<e.length;u++)(i=W.readability(n,e[u]))>c&&(c=i,l=W(e[u]));return W.isReadable(n,l,{level:s,size:o})||!r?l:(a.includeFallbackColors=!1,W.mostReadable(n,["#fff","#000"],a))};var jn=W.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},xr=W.hexNames=function(n){var e={};for(var a in n)n.hasOwnProperty(a)&&(e[n[a]]=a);return e}(jn);function Ma(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function ge(n,e){(function(i){return typeof i=="string"&&i.indexOf(".")!=-1&&parseFloat(i)===1})(n)&&(n="100%");var a=function(i){return typeof i=="string"&&i.indexOf("%")!=-1}(n);return n=Math.min(e,Math.max(0,parseFloat(n))),a&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function rn(n){return Math.min(1,Math.max(0,n))}function Oe(n){return parseInt(n,16)}function Le(n){return n.length==1?"0"+n:""+n}function Nt(n){return n<=1&&(n=100*n+"%"),n}function Ia(n){return Math.round(255*parseFloat(n)).toString(16)}function qn(n){return Oe(n)/255}var Ke,Lt,zt,$e=(Lt="[\\s|\\(]+("+(Ke="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Ke+")[,|\\s]+("+Ke+")\\s*\\)?",zt="[\\s|\\(]+("+Ke+")[,|\\s]+("+Ke+")[,|\\s]+("+Ke+")[,|\\s]+("+Ke+")\\s*\\)?",{CSS_UNIT:new RegExp(Ke),rgb:new RegExp("rgb"+Lt),rgba:new RegExp("rgba"+zt),hsl:new RegExp("hsl"+Lt),hsla:new RegExp("hsla"+zt),hsv:new RegExp("hsv"+Lt),hsva:new RegExp("hsva"+zt),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function He(n){return!!$e.CSS_UNIT.exec(n)}var br=function(n,e){var a=(typeof n=="string"?parseInt(n):n)||0;if(a>=-5&&a<=5){var i=a,r=parseFloat(e),s=r+i*(r/5)*-1;return(s==0||s<=Number.EPSILON)&&(s=.1),{animationPeriod:s+"s"}}return{animationPeriod:e}},vr=function(n,e){var a=n||{},i="";switch(e){case"small":i="12px";break;case"medium":i="16px";break;case"large":i="20px";break;default:i=void 0}var r={};if(a.fontSize){var s=a.fontSize;r=function(o,l){var c={};for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&l.indexOf(u)<0&&(c[u]=o[u]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var f=0;for(u=Object.getOwnPropertySymbols(o);f<u.length;f++)l.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(o,u[f])&&(c[u[f]]=o[u[f]])}return c}(a,["fontSize"]),i=s}return{fontSize:i,styles:r}},yr={color:"currentColor",mixBlendMode:"difference",width:"unset",display:"block",paddingTop:"2px"},wr=function(n){var e=n.className,a=n.text,i=n.textColor,r=n.staticText,s=n.style;return a?oe.createElement("span",{className:"rli-d-i-b rli-text-format ".concat(e||"").trim(),style:qe(qe(qe({},r&&yr),i&&{color:i,mixBlendMode:"unset"}),s&&s)},typeof a=="string"&&a.length?a:"loading"):null},Da="rgb(50, 205, 50)";function jr(n,e){if(e===void 0&&(e=0),n.length===0)throw new Error("Input array cannot be empty!");var a=[];return function i(r,s){return s===void 0&&(s=0),a.push.apply(a,r),a.length<s&&i(a,s),a.slice(0,s)}(n,e)}Se(`.atom-rli-bounding-box {
  --atom-phase1-rgb: 50, 205, 50;
  color: rgba(var(--atom-phase1-rgb), 1);
  font-size: 16px;
  position: relative;
  text-align: unset;
  isolation: isolate;
}
.atom-rli-bounding-box .atom-indicator {
  width: 6em;
  height: 6em;
  position: relative;
  perspective: 6em;
  overflow: hidden;
  color: rgba(var(--atom-phase1-rgb), 1);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator::after, .atom-rli-bounding-box .atom-indicator::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 0.48em;
  height: 0.48em;
  margin: auto;
  border-radius: 50%;
  background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7eg;
}
.atom-rli-bounding-box .atom-indicator::before {
  filter: drop-shadow(0px 0px 0.0625em currentColor);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit {
  color: rgba(var(--atom-phase1-rgb), 0.85);
  border: 0;
  border-left: 0.4em solid currentColor;
  box-sizing: border-box;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  width: 4.8em;
  height: 4.8em;
  background-color: transparent;
  border-radius: 50%;
  transform-style: preserve-3d;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7fj, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gy;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  color: rgba(var(--atom-phase1-rgb), 0.18);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7hv;
  border: 0.125em solid currentColor;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::before {
  content: "";
  width: 0.192em;
  height: 0.192em;
  position: absolute;
  border-radius: 50%;
  top: -0.096em;
  right: 0;
  bottom: 0;
  left: 0;
  margin: 0 auto;
  color: rgba(var(--atom-phase1-rgb), 1);
  box-shadow: 0px 0px 0.0625em 0.0625em currentColor, 0px 0px 0.0625em 0.125em currentColor;
  background-color: currentColor;
  transform: rotateY(-70deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7ew, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(1) {
  --orbit-vector-factor: -1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(2) {
  --orbit-vector-factor: 1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3) {
  --orbit-vector-factor: 0;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3)::before {
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --atom-phase1-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase2-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase3-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase4-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7fj {
  from {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(0deg);
  }
  to {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(360deg);
  }
}
@keyframes uxlv7ew {
  from {
    transform: rotateY(-70deg) rotateX(0deg);
  }
  to {
    transform: rotateY(-70deg) rotateX(-360deg);
  }
}
@keyframes uxlv7eg {
  100%, 0% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  20% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  25% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  45% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  50% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  70% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  75% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  95% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
}
@keyframes uxlv7gg {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
}
@keyframes uxlv7gy {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
}
@keyframes uxlv7hv {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
}`);W(Da).toRgb();Array.from({length:4},function(n,e){return"--atom-phase".concat(e+1,"-rgb")});Se(`.commet-rli-bounding-box {
  --commet-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  width: 6.85em;
  height: 6.85em;
  overflow: hidden;
  display: inline-block;
  box-sizing: border-box;
  position: relative;
  isolation: isolate;
}
.commet-rli-bounding-box .commet-indicator {
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  box-sizing: border-box;
  width: 6em;
  height: 6em;
  color: var(--commet-phase1-color);
  display: inline-block;
  isolation: isolate;
  position: absolute;
  z-index: 0;
  animation: calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite uxlv7cp;
}
.commet-rli-bounding-box .commet-indicator .commet-box {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  animation: uxlv7bx var(--rli-animation-duration, 1.2s) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(1) {
  width: 100%;
  height: 100%;
  animation-direction: normal;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(2) {
  width: 70%;
  height: 70%;
  animation-direction: reverse;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  display: inline-block;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box::before {
  content: "";
  width: 0.5em;
  height: 0.5em;
  border-radius: 50%;
  background-color: currentColor;
  position: absolute;
  top: -0.125em;
  left: 50%;
  transform: translateX(-50%);
  box-shadow: 0 0 0.2em 0em currentColor, 0 0 0.6em 0em currentColor;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  box-sizing: border-box;
  border-style: solid;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail1 {
  border-color: currentColor transparent transparent currentColor;
  border-width: 0.25em 0.25em 0 0;
  transform: rotateZ(-45deg);
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail2 {
  border-color: currentColor currentColor transparent transparent;
  border-width: 0.25em 0 0 0.25em;
  transform: rotateZ(45deg);
}
.commet-rli-bounding-box .commet-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--commet-phase1-color);
}

@property --commet-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7bx {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7cp {
  100%, 0% {
    color: var(--commet-phase1-color);
  }
  20% {
    color: var(--commet-phase1-color);
  }
  25% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  45% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  50% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  70% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  75% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
  95% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--commet-phase".concat(e+1,"-color")});Se(`.OP-annulus-rli-bounding-box {
  --OP-annulus-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .whirl {
  animation: uxlv7n7 calc(var(--rli-animation-duration, 1.5s) * 1.33) linear infinite;
  height: 100%;
  transform-origin: center center;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .path {
  stroke-dasharray: 1, 125;
  stroke-dashoffset: 0;
  animation: var(--rli-animation-duration, 1.5s) var(--rli-animation-function, ease-in-out) infinite uxlv7oa, calc(var(--rli-animation-duration, 1.5s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7p5;
  stroke-linecap: round;
}
.OP-annulus-rli-bounding-box .OP-annulus-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7n7 {
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7oa {
  0% {
    stroke-dasharray: 1, 125;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -35px;
  }
  100% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -124px;
  }
}
@keyframes uxlv7p5 {
  100%, 0% {
    stroke: var(--OP-annulus-phase1-color);
  }
  22% {
    stroke: var(--OP-annulus-phase1-color);
  }
  25% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  42% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  50% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  72% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  75% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
  97% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--OP-annulus-phase".concat(e+1,"-color")});function ln(n){return n&&n.Math===Math&&n}Se(`.OP-dotted-rli-bounding-box {
  --OP-dotted-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-dotted-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .OP-dotted-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder .dot {
  display: block;
  margin: 0 auto;
  width: 15%;
  height: 15%;
  background-color: currentColor;
  border-radius: 50%;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) infinite uxlv7nu, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7ol;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) {
  transform: rotate(0deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 12 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) {
  transform: rotate(30deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 11 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) {
  transform: rotate(60deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 10 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) {
  transform: rotate(90deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 9 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) {
  transform: rotate(120deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 8 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) {
  transform: rotate(150deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 7 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) {
  transform: rotate(180deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 6 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) {
  transform: rotate(210deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 5 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) {
  transform: rotate(240deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 4 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) {
  transform: rotate(270deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 3 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) {
  transform: rotate(300deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 2 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) {
  transform: rotate(330deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 1 * -1);
}

@property --OP-dotted-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7nu {
  0%, 39%, 100% {
    opacity: 0;
  }
  40% {
    opacity: 1;
  }
}
@keyframes uxlv7ol {
  100%, 0% {
    background-color: var(--OP-dotted-phase1-color);
  }
  22% {
    background-color: var(--OP-dotted-phase1-color);
  }
  25% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  47% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  50% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  72% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  75% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
  97% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
}`);ln(typeof window=="object"&&window)||ln(typeof self=="object"&&self)||ln(typeof global=="object"&&global)||function(){return this}()||Function("return this")();Array.from({length:4},function(n,e){return"--OP-dotted-phase".concat(e+1,"-color")});Se(`.OP-spokes-rli-bounding-box {
  --OP-spokes-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  position: relative;
  color: var(--OP-spokes-phase1-color);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator {
  width: 4.8em;
  height: 4.8em;
  display: block;
  position: relative;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke {
  position: absolute;
  height: 1.2em;
  width: 0.4em;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: auto auto auto 50%;
  background-color: var(--OP-spokes-phase1-color);
  border-radius: 0.24em;
  opacity: 0;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) backwards infinite uxlv7pw, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7qn;
  transform-origin: left center;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(1) {
  transform: rotate(calc(0 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(11 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(2) {
  transform: rotate(calc(1 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(10 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(3) {
  transform: rotate(calc(2 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(9 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(4) {
  transform: rotate(calc(3 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(8 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(5) {
  transform: rotate(calc(4 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(7 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(6) {
  transform: rotate(calc(5 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(6 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(7) {
  transform: rotate(calc(6 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(5 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(8) {
  transform: rotate(calc(7 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(4 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(9) {
  transform: rotate(calc(8 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(3 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(10) {
  transform: rotate(calc(9 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(2 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(11) {
  transform: rotate(calc(10 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(1 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(12) {
  transform: rotate(calc(11 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(0 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--OP-spokes-phase1-color);
  z-index: -2;
}

@property --OP-spokes-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7pw {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@keyframes uxlv7qn {
  100%, 0% {
    background-color: var(--OP-spokes-phase1-color);
  }
  22% {
    background-color: var(--OP-spokes-phase1-color);
  }
  25% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  42% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  50% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  72% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  75% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
  97% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--OP-spokes-phase".concat(e+1,"-color")});Se(`.OP-annulus-dual-sectors-rli-bounding-box {
  --OP-annulus-dual-sectors-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator {
  width: 5em;
  height: 5em;
  display: inline-block;
  position: relative;
  z-index: 0;
  color: var(--OP-annulus-dual-sectors-phase1-color);
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .annulus-sectors {
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border-width: 0.34em;
  border-style: solid;
  border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent var(--OP-annulus-dual-sectors-phase1-color) transparent;
  background-color: transparent;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) infinite uxlv7ra, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) infinite uxlv7sv;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .OP-annulus-dual-sectors-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-dual-sectors-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7ra {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7sv {
  100%, 0% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  20% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  25% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  45% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  50% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  70% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  75% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  95% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
}`);Array.from({length:4},function(n,e){return"--OP-annulus-dual-sectors-phase".concat(e+1,"-color")});Se(`.OP-annulus-sector-track-rli-bounding-box {
  --OP-annulus-track-phase1-color: rgba(50, 205, 50, 0.22);
  --OP-annulus-sector-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-sector-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .annulus-track-ring {
  width: 100%;
  height: 100%;
  border-width: 0.34em;
  border-style: solid;
  border-radius: 50%;
  box-sizing: border-box;
  border-color: var(--OP-annulus-track-phase1-color);
  border-top-color: var(--OP-annulus-sector-phase1-color);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7rl, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7tf;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .OP-annulus-sector-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-track-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-sector-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7rl {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7tf {
  100%, 0% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  18% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  25% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  43% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  50% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  68% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  75% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
  93% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return["--OP-annulus-track-phase".concat(e+1,"-color"),"--OP-annulus-sector-phase".concat(e+1,"-color")]});Se(`.foursquare-rli-bounding-box {
  --four-square-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  color: var(--four-square-phase1-color);
  display: inline-block;
  overflow: hidden;
}
.foursquare-rli-bounding-box .foursquare-indicator {
  height: 5.3033008589em;
  width: 5.3033008589em;
  position: relative;
  display: block;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container {
  position: absolute;
  z-index: 0;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  height: 2.5em;
  width: 2.5em;
  color: inherit;
  will-change: color, width, height;
  transform: rotate(45deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7dk, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7es;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square {
  position: absolute;
  width: 1.25em;
  height: 1.25em;
  border-radius: 0.1875em;
  background-color: currentColor;
  animation: uxlv7dd var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) both infinite;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square1 {
  top: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square2 {
  top: 0;
  right: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square3 {
  bottom: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square4 {
  bottom: 0;
  right: 0;
}

@property --four-square-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7dk {
  0% {
    width: 2.5em;
    height: 2.5em;
  }
  10% {
    width: 2.5em;
    height: 2.5em;
  }
  50% {
    width: 3.75em;
    height: 3.75em;
  }
  90% {
    width: 2.5em;
    height: 2.5em;
  }
  100% {
    width: 2.5em;
    height: 2.5em;
  }
}
@keyframes uxlv7dd {
  0% {
    transform: rotateZ(0deg);
  }
  10% {
    transform: rotateZ(0deg);
  }
  50% {
    transform: rotateZ(90deg);
  }
  90% {
    transform: rotateZ(90deg);
  }
  100% {
    transform: rotateZ(90deg);
  }
}
@keyframes uxlv7es {
  100%, 0% {
    color: var(--four-square-phase1-color);
  }
  20% {
    color: var(--four-square-phase1-color);
  }
  25% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  45% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  50% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  70% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  75% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
  95% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--four-square-phase".concat(e+1,"-color")});Se(`.mosaic-rli-bounding-box {
  --mosaic-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  color: var(--mosaic-phase1-color);
}
.mosaic-rli-bounding-box .mosaic-indicator {
  width: 5em;
  height: 5em;
  color: currentColor;
  display: grid;
  gap: 0.125em;
  grid-template-columns: repeat(3, 1fr);
  grid-template-areas: "a b c" "d e f" "g h i";
  position: relative;
  z-index: 0;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  z-index: -2;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube {
  background-color: var(--mosaic-phase1-color);
  animation-name: uxlv7i4, uxlv7is;
  animation-duration: var(--rli-animation-duration, 1.5s), calc(var(--rli-animation-duration, 1.5s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in-out);
  animation-iteration-count: infinite;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube1 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
  grid-area: a;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube2 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
  grid-area: b;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube3 {
  grid-area: c;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 4);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube4 {
  grid-area: d;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube5 {
  grid-area: e;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube6 {
  grid-area: f;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube7 {
  grid-area: g;
  animation-delay: 0s;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube8 {
  grid-area: h;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube9 {
  grid-area: i;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}

@property --mosaic-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7i4 {
  0%, 60%, 100% {
    transform: scale3D(1, 1, 1);
  }
  30% {
    transform: scale3D(0, 0, 1);
  }
}
@keyframes uxlv7is {
  100%, 0% {
    background-color: var(--mosaic-phase1-color);
  }
  25% {
    background-color: var(--mosaic-phase2-color, var(--mosaic-phase1-color));
  }
  50% {
    background-color: var(--mosaic-phase3-color, var(--mosaic-phase1-color));
  }
  75% {
    background-color: var(--mosaic-phase4-color, var(--mosaic-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--mosaic-phase".concat(e+1,"-color")});Se(`.riple-rli-bounding-box {
  --riple-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--riple-phase1-color);
}
.riple-rli-bounding-box .riple-indicator {
  display: inline-block;
  width: 5em;
  height: 5em;
  position: relative;
  z-index: 0;
}
.riple-rli-bounding-box .riple-indicator .riple-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.riple-rli-bounding-box .riple-indicator .riple {
  --border-width: 0.25em;
  position: absolute;
  border: var(--border-width) solid var(--riple-phase1-color);
  opacity: 1;
  border-radius: 50%;
  will-change: top, right, left, bottom, border-color;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7i1, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7io;
}
.riple-rli-bounding-box .riple-indicator .riple:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 1s) / 2 * -1);
}

@property --riple-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7i1 {
  0% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  4.9% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  5% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 1;
  }
  100% {
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
  }
}
@keyframes uxlv7io {
  100%, 0% {
    border-color: var(--riple-phase1-color);
  }
  24.9% {
    border-color: var(--riple-phase1-color);
  }
  25% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  49.9% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  50% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  74.9% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  75% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
  99.9% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--riple-phase".concat(e+1,"-color")});Se(`.pulsate-rli-bounding-box {
  --TD-pulsate-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
  box-sizing: border-box;
  color: var(--TD-pulsate-phase1-color);
}
.pulsate-rli-bounding-box .pulsate-indicator {
  width: 4.4em;
  height: 1.1em;
  text-align: center;
  position: relative;
  z-index: 0;
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  align-items: center;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot {
  width: 1.1em;
  height: 1.1em;
  border-radius: 50%;
  background-color: var(--TD-pulsate-phase1-color);
  transform: scale(0);
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7s0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7to;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(1) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15 * -1);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(2) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(3) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15);
}
.pulsate-rli-bounding-box .pulsate-text {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 80%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.6em;
  letter-spacing: 0.5px;
  font-family: sans-serif;
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --TD-pulsate-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7s0 {
  0%, 90%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}
@keyframes uxlv7to {
  0%, 100% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  24.9% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  25% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  49.9% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  50% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  74.9% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  75% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
  99.9% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-pulsate-phase".concat(e+1,"-color")});Se(`.brick-stack-rli-bounding-box {
  --TD-brick-stack-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-brick-stack-phase1-color);
}
.brick-stack-rli-bounding-box .brick-stack-indicator {
  width: 2.8em;
  height: 2.8em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.brick-stack-rli-bounding-box .brick-stack {
  width: 100%;
  height: 100%;
  background: radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 0/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 100%/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 100% 100%/40% 40% no-repeat;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, ease-out) infinite uxlv7tu, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, ease-out) infinite uxlv7us;
}

@property --TD-brick-stack-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7tu {
  0% {
    background-position: 0 0, 0 100%, 100% 100%;
  }
  25% {
    background-position: 100% 0, 0 100%, 100% 100%;
  }
  50% {
    background-position: 100% 0, 0 0, 100% 100%;
  }
  75% {
    background-position: 100% 0, 0 0, 0 100%;
  }
  100% {
    background-position: 100% 100%, 0 0, 0 100%;
  }
}
@keyframes uxlv7us {
  100%, 0% {
    color: var(--TD-brick-stack-phase1-color);
  }
  20% {
    color: var(--TD-brick-stack-phase1-color);
  }
  25% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  45% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  50% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  70% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  75% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
  95% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-brick-stack-phase".concat(e+1,"-color")});Se(`.bob-rli-bounding-box {
  --TD-bob-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-bob-phase1-color);
}
.bob-rli-bounding-box .bob-indicator {
  width: 4.4em;
  height: 2.2em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bob-rli-bounding-box .bob-indicator .bobbing,
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  width: 1.1em;
  height: 100%;
  display: grid;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) var(--delay) infinite uxlv7u0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) var(--delay) infinite uxlv7vq;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  content: "";
  grid-area: 1/1;
}
.bob-rli-bounding-box .bob-indicator .bobbing {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12 * -1);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
  transform: translateX(150%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12);
  transform: translateX(300%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}

@property --TD-bob-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7u0 {
  100%, 0% {
    background-position: 50% 50%;
  }
  15% {
    background-position: 50% 10%;
  }
  30% {
    background-position: 50% 100%;
  }
  40% {
    background-position: 50% 0%;
  }
  50% {
    background-position: 50% 90%;
  }
  70% {
    background-position: 50% 10%;
  }
  98% {
    background-position: 50% 50%;
  }
}
@keyframes uxlv7vq {
  100%, 0% {
    color: var(--TD-bob-phase1-color);
  }
  22% {
    color: var(--TD-bob-phase1-color);
  }
  25% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  47% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  50% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  72% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  75% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
  97% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-bob-phase".concat(e+1,"-color")});Se(`.bounce-rli-bounding-box {
  --TD-bounce-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--TD-bounce-phase1-color);
  display: inline-block;
  padding-bottom: 0.25125em;
}
.bounce-rli-bounding-box .wrapper {
  --dot1-delay: 0s;
  --dot1-x-offset: 0.55em;
  --dot2-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.75) * -1);
  --dot2-x-offset: 2.2em;
  --dot3-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.5) * -1);
  --dot3-x-offset: 3.85em;
  width: 5.5em;
  height: 3.125em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bounce-rli-bounding-box .wrapper .group {
  display: block;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.bounce-rli-bounding-box .wrapper .group .dot {
  width: 1.1em;
  height: 1.1em;
  position: absolute;
  border-radius: 50%;
  background-color: var(--TD-bounce-phase1-color);
  transform-origin: 50%;
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7wc, calc(var(--rli-animation-duration, 0.5s) * 4) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) infinite uxlv7x6;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .shadow {
  width: 1.1em;
  height: 0.22em;
  border-radius: 50%;
  background-color: rgba(0, 0, 0, 0.5);
  position: absolute;
  top: 101%;
  transform-origin: 50%;
  z-index: -1;
  filter: blur(1px);
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7ww;
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay);
}

@property --TD-bounce-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 0.5s;
}
@keyframes uxlv7wc {
  0% {
    top: 0%;
  }
  60% {
    height: 1.25em;
    border-radius: 50%;
    transform: scaleX(1);
  }
  100% {
    top: 100%;
    height: 0.22em;
    transform: scaleX(1.5);
    filter: blur(0.4px);
  }
}
@keyframes uxlv7ww {
  0% {
    transform: scaleX(0.2);
    opacity: 0.2;
  }
  60% {
    opacity: 0.4;
  }
  100% {
    transform: scaleX(1.5);
    opacity: 0.6;
  }
}
@keyframes uxlv7x6 {
  0%, 100% {
    background-color: var(--TD-bounce-phase1-color);
  }
  20% {
    background-color: var(--TD-bounce-phase1-color);
  }
  25% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  45% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  50% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  70% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  75% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
  95% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--TD-bounce-phase".concat(e+1,"-color")});Se(`.blink-blur-rli-bounding-box {
  --shape-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--shape-phase1-color);
}
.blink-blur-rli-bounding-box .blink-blur-indicator {
  isolation: isolate;
  display: flex;
  flex-direction: row;
  -moz-column-gap: 0.4em;
       column-gap: 0.4em;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape {
  --x-deg: -20deg;
  width: 1.8em;
  height: 2.25em;
  border-radius: 0.25em;
  color: inherit;
  transform: skewX(var(--x-deg));
  background-color: var(--shape-phase1-color);
  animation-name: uxlv7id, uxlv7jl;
  animation-duration: var(--rli-animation-duration, 1.2s), calc(var(--rli-animation-duration, 1.2s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in);
  animation-iteration-count: infinite;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape1 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.5 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape2 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.4 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape3 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.3 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape4 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.2 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape5 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.1 * -1);
}

@property --shape-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7id {
  100%, 0% {
    opacity: 0.3;
    filter: blur(0.0675em) drop-shadow(0 0 0.0625em);
    transform: skewX(var(--x-deg)) scale(1.2, 1.45);
  }
  39% {
    opacity: 0.8;
  }
  40%, 41%, 42% {
    opacity: 0;
  }
  43% {
    opacity: 0.8;
  }
  50% {
    opacity: 1;
    filter: blur(0em) drop-shadow(0 0 0em);
    transform: skewX(var(--x-deg)) scale(1, 1);
  }
}
@keyframes uxlv7jl {
  100%, 0% {
    color: var(--shape-phase1-color);
    background-color: var(--shape-phase1-color);
  }
  25% {
    color: var(--shape-phase2-color, var(--shape-phase1-color));
    background-color: var(--shape-phase2-color, var(--shape-phase1-color));
  }
  50% {
    color: var(--shape-phase3-color, var(--shape-phase1-color));
    background-color: var(--shape-phase3-color, var(--shape-phase1-color));
  }
  75% {
    color: var(--shape-phase4-color, var(--shape-phase1-color));
    background-color: var(--shape-phase4-color, var(--shape-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--shape-phase".concat(e+1,"-color")});Se(`.trophy-spin-rli-bounding-box {
  --trophySpin-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  position: relative;
  isolation: isolate;
  color: var(--trophySpin-phase1-color);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator {
  width: 4em;
  perspective: 1000px;
  transform-style: preserve-3d;
  display: block;
  margin: 0 auto;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade {
  display: block;
  width: 4em;
  height: 0.5em;
  background: var(--trophySpin-phase1-color);
  animation: uxlv7ki var(--rli-animation-duration, 2.5s) var(--rli-animation-function, linear) infinite, uxlv7l2 calc(var(--rli-animation-duration, 2.5s) * 0.5) var(--rli-animation-function, linear) infinite, uxlv7ly calc(var(--rli-animation-duration, 2.5s) * 4) var(--rli-animation-function, linear) infinite;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(8) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 0 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(7) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 1 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(6) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 2 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(5) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 3 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(4) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 4 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(3) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 5 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 6 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(1) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 7 * -1);
}

@property --trophySpin-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2.5s;
}
@keyframes uxlv7ki {
  to {
    transform: rotateY(1turn) rotateX(-25deg);
  }
}
@keyframes uxlv7l2 {
  100%, 0% {
    filter: brightness(1);
    opacity: 1;
  }
  15% {
    filter: brightness(1);
  }
  25% {
    opacity: 0.96;
  }
  30% {
    filter: brightness(0.92);
  }
  50% {
    filter: brightness(0.7);
    opacity: 1;
  }
  75% {
    filter: brightness(0.92);
    opacity: 0.96;
  }
  90% {
    filter: brightness(1);
  }
}
@keyframes uxlv7ly {
  100%, 0% {
    background-color: var(--trophySpin-phase1-color);
  }
  18% {
    background-color: var(--trophySpin-phase1-color);
  }
  25% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  43% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  50% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  68% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  75% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
  93% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
}`);var Ut=Array.from({length:4},function(n,e){return"--trophySpin-phase".concat(e+1,"-color")}),kr=function(n){var e,a=vr(n?.style,n?.size),i=a.styles,r=a.fontSize,s=n?.easing,o=br(n?.speedPlus,"2.5s").animationPeriod,l=function(c){var u={},f=Ut.length;if(c instanceof Array){for(var h=jr(c,f),m=0;m<h.length&&!(m>=4);m++)u[Ut[m]]=h[m];return u}try{if(typeof c!="string")throw new Error("Color String expected");for(var b=0;b<f;b++)u[Ut[b]]=c}catch(g){for(g instanceof Error?console.warn("[".concat(g.message,']: Received "').concat(typeof c,'" instead with value, ').concat(JSON.stringify(c))):console.warn("".concat(JSON.stringify(c)," received in <TrophySpin /> indicator cannot be processed. Using default instead!")),b=0;b<f;b++)u[Ut[b]]=Da}return u}((e=n?.color)!==null&&e!==void 0?e:"");return oe.createElement("span",{className:"rli-d-i-b trophy-spin-rli-bounding-box",style:qe(qe(qe(qe(qe({},r&&{fontSize:r}),o&&{"--rli-animation-duration":o}),s&&{"--rli-animation-function":s}),l),i),role:"status","aria-live":"polite","aria-label":"Loading"},oe.createElement("span",{className:"rli-d-i-b trophy-spin-indicator"},oe.createElement("span",{className:"blade"}),oe.createElement("span",{className:"blade"}),oe.createElement("span",{className:"blade"}),oe.createElement("span",{className:"blade"}),oe.createElement("span",{className:"blade"}),oe.createElement("span",{className:"blade"}),oe.createElement("span",{className:"blade"}),oe.createElement("span",{className:"blade"})),oe.createElement(wr,{staticText:!0,text:n?.text,textColor:n?.textColor}))};Se(`.slab-rli-bounding-box {
  --slab-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--slab-phase1-color);
  position: relative;
}
.slab-rli-bounding-box .slab-indicator {
  position: relative;
  display: block;
  width: 7em;
  height: 4em;
  margin: 0 auto;
  overflow: hidden;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper {
  width: 4em;
  height: 4em;
  transform: perspective(15em) rotateX(66deg) rotateZ(-25deg);
  transform-style: preserve-3d;
  transform-origin: 50% 100%;
  display: block;
  position: absolute;
  bottom: 0;
  right: 0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--slab-phase1-color);
  opacity: 0;
  box-shadow: -0.08em 0.15em 0 rgba(0, 0, 0, 0.45);
  transform-origin: 0% 0%;
  animation: calc(var(--rli-animation-duration-unitless, 3) * 1s) var(--rli-animation-function, linear) infinite uxlv7md, calc(var(--rli-animation-duration-unitless, 3) * 4s) var(--rli-animation-function, linear) infinite uxlv7n0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(1) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 3 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(2) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 2 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(3) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(4) {
  animation-delay: 0s;
}

@property --slab-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration-unitless {
  syntax: "<number>";
  inherits: true;
  initial-value: 3;
}
@keyframes uxlv7md {
  0% {
    transform: translateY(0) rotateX(30deg);
    opacity: 0;
  }
  10% {
    transform: translateY(-40%) rotateX(0deg);
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  100% {
    transform: translateY(-400%) rotateX(0deg);
    opacity: 0;
  }
}
@keyframes uxlv7n0 {
  100%, 0% {
    background-color: var(--slab-phase1-color);
  }
  24.9% {
    background-color: var(--slab-phase1-color);
  }
  25% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  49.9% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  50% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  74.9% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  75% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
  99.9% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--slab-phase".concat(e+1,"-color")});Se(`.lifeline-rli-bounding-box {
  --life-line-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  isolation: isolate;
  color: var(--life-line-phase1-color);
}
.lifeline-rli-bounding-box .lifeline-indicator {
  position: relative;
  text-align: center;
}
.lifeline-rli-bounding-box .lifeline-indicator path.rli-lifeline {
  stroke-dasharray: 474.7616760254 30.3039367676;
  animation: var(--rli-animation-duration, 2s) var(--rli-animation-function, linear) infinite uxlv7k3, calc(var(--rli-animation-duration, 2s) * 4) var(--rli-animation-function, linear) infinite uxlv7kg;
}
.lifeline-rli-bounding-box .lifeline-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --life-line-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2s;
}
@keyframes uxlv7k3 {
  to {
    stroke-dashoffset: -1010.1312255859;
  }
}
@keyframes uxlv7kg {
  100%, 0% {
    color: var(--life-line-phase1-color);
  }
  20% {
    color: var(--life-line-phase1-color);
  }
  25% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  45% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  50% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  70% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  75% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
  95% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
}`);Array.from({length:4},function(n,e){return"--life-line-phase".concat(e+1,"-color")});const Nr={sm:14,md:20,lg:32,xl:48},Oa=({size:n="md",color:e="#3b82f6",speedPlus:a=1,className:i=""})=>{const r=Nr[n];return t.jsx("div",{className:`flex items-center justify-center ${i}`,children:t.jsx(kr,{color:e,size:r,speedPlus:a,style:{width:`${r}px`,height:`${r}px`}})})},Yt=({className:n})=>t.jsx(Oa,{size:"sm",className:n}),cn=({className:n,color:e})=>t.jsx(Oa,{size:"md",color:e,className:n}),Bn=({config:n,onStartWorkflow:e,onQuickAction:a,processingAction:i,isFooter:r=!1})=>{const[s,o]=d.useState(!1),l=i===n.actionId,c=n.icon,u=d.useCallback(()=>{l||o(!0)},[l]),f=d.useCallback(()=>{o(!1)},[]),h=d.useCallback(async()=>{n.actionId==="bloods"&&a&&await a(n.actionId,{type:"prepare-modal"}),e&&e(n.workflowId),o(!1)},[e,a,n.workflowId,n.actionId]),m=d.useCallback(async()=>{await a(n.actionId,{type:"manual"}),o(!1)},[a,n.actionId]);return r?t.jsxs("div",{className:"relative overflow-hidden min-h-10",onMouseEnter:u,onMouseLeave:f,style:{minHeight:"40px"},children:[t.jsx("div",{className:`
          absolute inset-0 transition-all duration-200 ease-out
          ${s&&!l?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100"}
        `,children:t.jsxs("button",{disabled:l,className:`
              bg-transparent hover:bg-gray-50 transition-all duration-200 ease-out rounded-lg text-left w-full h-full p-1.5
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx(c,{className:`w-3 h-3 text-${n.color}-600 flex-shrink-0`}),t.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:n.label})]}),l&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx("div",{className:`w-3 h-3 border-2 border-gray-300 border-t-${n.color}-600 rounded-full animate-spin`})})]})}),t.jsx("div",{className:`
          absolute inset-0 transition-all duration-200 ease-out
          ${s&&!l?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}
        `,children:t.jsxs("div",{className:"grid grid-cols-2 gap-1 h-full",children:[t.jsxs("button",{onClick:h,disabled:l,className:`
                bg-transparent hover:bg-gray-50 transition-all duration-200 ease-out rounded-lg 
                relative flex items-center justify-center p-1 text-left
                ${l?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsx(Xe,{className:`w-2.5 h-2.5 text-${n.color}-600 flex-shrink-0 mr-1`}),t.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:"Dictate"})]}),t.jsxs("button",{onClick:m,disabled:l,className:`
                bg-transparent hover:bg-gray-50 transition-all duration-200 ease-out rounded-lg 
                relative flex items-center justify-center p-1 text-left
                ${l?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsx(vn,{className:`w-2.5 h-2.5 text-${n.color}-600 flex-shrink-0 mr-1`}),t.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:"Type"})]})]})})]}):t.jsxs("div",{className:"relative overflow-hidden",onMouseEnter:u,onMouseLeave:f,children:[t.jsx("div",{className:`
        transition-all duration-200 ease-out
        ${s&&!l?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100"}
      `,children:t.jsxs("button",{disabled:l,className:`
            bg-transparent hover:bg-gray-50 relative flex items-center p-3 rounded-lg transition-all 
            hover:bg-gray-50 text-left w-full
            ${l?"opacity-50 cursor-not-allowed":""}
          `,children:[t.jsx(c,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-gray-900 font-medium text-sm",children:n.label}),t.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Quick entry and processing"})]}),l&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx("div",{className:`w-4 h-4 border-2 border-gray-300 border-t-${n.color}-600 rounded-full animate-spin`})})]})}),t.jsx("div",{className:`
        transition-all duration-200 ease-out
        ${s&&!l?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}
      `,children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs("button",{onClick:h,disabled:l,className:`
              bg-transparent hover:bg-gray-50 relative flex items-center p-3 rounded-lg transition-all 
              hover:bg-${n.color}-50 text-left w-full
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[t.jsx(Xe,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"text-gray-900 font-medium text-sm",children:["Dictate ",n.label]}),t.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Voice recording and AI processing"})]})]}),t.jsxs("button",{onClick:m,disabled:l,className:`
              bg-transparent hover:bg-gray-50 relative flex items-center p-3 rounded-lg transition-all 
              hover:bg-${n.color}-50 text-left w-full
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[t.jsx(vn,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"text-gray-900 font-medium text-sm",children:["Type ",n.label]}),t.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Manual entry and quick processing"})]})]})]})})]})},Sr=[{id:"preset-116-fup-3mth",displayName:"116 + FUP 3mth",itemCode:"116",notes:"Face to face follow up in 3 months please"},{id:"preset-91824-fup-3mth",displayName:"91824 + FUP 3mth",itemCode:"91824",notes:"TH follow up in 3 months please"}],Cr=[{id:"dictate",label:"Dictate",icon:Xe,description:"Voice-to-text with AI formatting"},{id:"type",label:"Type",icon:vn,description:"Open field for manual entry"}],qt={"investigation-summary":{icon:Ye,label:"Investigations",actionId:"investigation-summary",workflowId:"investigation-summary",color:"emerald"},background:{icon:Pt,label:"Background",actionId:"background",workflowId:"background",color:"blue"},medications:{icon:En,label:"Medications",actionId:"medications",workflowId:"medication",color:"purple"},"social-history":{icon:da,label:"Social",actionId:"social-history",workflowId:"background",color:"indigo"},bloods:{icon:ua,label:"Bloods",actionId:"bloods",workflowId:"bloods",color:"red"},imaging:{icon:ma,label:"Imaging",actionId:"imaging",workflowId:"imaging",color:"cyan"}},Tr=[{id:"background",label:"Background",icon:Pt,description:"Access patient background notes",category:"emr"},{id:"investigation-summary",label:"Investigations",icon:Ye,description:"Open investigation summary field",category:"emr"},{id:"medications",label:"Medications",icon:En,description:"View/edit medication list",category:"emr"},{id:"social-history",label:"Social History",icon:da,description:"Access social & family history section",category:"emr"},{id:"bloods",label:"Bloods",icon:ua,description:"Blood test results and analysis",category:"emr"},{id:"imaging",label:"Imaging",icon:ma,description:"Medical imaging reports and analysis",category:"emr"},{id:"profile-photo",label:"Photo",icon:gi,description:"Capture screenshot for patient profile",category:"emr"},{id:"annotate-screenshots",label:"Canvas",icon:pa,description:"Capture, annotate, and combine multiple screenshots",category:"emr"},{id:"quick-letter",label:"Quick Letter",icon:Ot,description:"Generate quick medical letter",category:"documentation"},{id:"create-task",label:"Create Task",icon:xt,description:"Add new task to workflow",category:"workflow"},{id:"appointment-wrap-up",label:"Wrap Up",icon:Gt,description:"Complete appointment workflow",category:"workflow"},{id:"patient-education",label:"Patient Education",icon:Vt,description:"Generate lifestyle advice and education",category:"documentation"}],Er=[{id:"ai-medical-review",label:"AI Medical Review",icon:ga,description:"Australian clinical oversight and guidelines review (analyzes existing EMR data)",category:"analysis"},{id:"batch-ai-review",label:"Batch AI Review",icon:ot,description:"AI review for multiple patients from appointment book",category:"analysis"}],_a=d.memo(({onQuickAction:n,onStartWorkflow:e,isFooter:a=!1})=>{const[i,r]=d.useState(null),[s,o]=d.useState(!1),[l,c]=d.useState(!1),u=async(v,y)=>{if(v==="appointment-wrap-up"&&!y){o(!0);return}if(v==="investigation-summary"&&!y){c(!0);return}if(v==="patient-education"){try{r(v),console.log("ðŸŽ“ Starting Patient Education..."),await n(v,{type:"show-config"}),console.log("âœ… Patient Education config triggered")}catch(S){console.error("âŒ Patient Education failed:",S)}finally{r(null)}return}if(v==="batch-ai-review"){try{r(v),console.log("ðŸ‘¥ Starting Batch AI Review..."),await n(v,{type:"show-modal"}),console.log("âœ… Batch AI Review modal triggered")}catch(S){console.error("âŒ Batch AI Review failed:",S)}finally{r(null)}return}if(v==="ai-medical-review"){try{r(v),console.log("ðŸ” Starting AI Medical Review..."),console.log("ðŸ“‹ Extracting EMR data for AI medical review...");const S=await f();if(S){const C={background:{hasContent:!!S.background.trim(),length:S.background.length},investigations:{hasContent:!!S.investigations.trim(),length:S.investigations.length},medications:{hasContent:!!S.medications.trim(),length:S.medications.length}},T=Object.entries(C).filter(([,j])=>j.hasContent),M=Object.keys(C).length;if(console.log("ðŸ“‹ EMR DATA VALIDATION:",{fieldsWithData:T.length,totalFields:M,details:C,extractionMeta:S.extractionMeta}),T.length===0){const j=Object.entries(C).filter(([,A])=>!A.hasContent).map(([A])=>A).join(", ");throw new Error(`No clinical data found - all EMR fields are empty: ${j}. Please ensure the patient record contains data in Background, Investigations, or Medications fields.`)}if(T.length<M){const j=Object.entries(C).filter(([,A])=>!A.hasContent).map(([A])=>A);console.warn(`âš ï¸ EMR PARTIAL DATA: Processing with ${T.length}/${M} fields. Missing: ${j.join(", ")}`)}console.log(`âœ… EMR data validation passed: ${T.length}/${M} fields available`),console.log("ðŸ”„ Processing with Australian Medical Review Agent...");const k=m(S);await n(v,{emrData:S,formattedInput:k,type:"australian-medical-review"}),console.log("âœ… AI Medical Review completed successfully")}else throw console.error("âŒ EMR EXTRACTION: extractEMRData returned null - critical extraction failure"),new Error("EMR data extraction failed - unable to connect to content script or read EMR fields. Please refresh the EMR page and ensure you are on a patient record page.")}catch(S){console.error("âŒ AI MEDICAL REVIEW FAILED:",S);const C=S instanceof Error?S.message:"Unknown error";if(console.error("ðŸš¨ AI Review Error Details:",{message:C,stack:S instanceof Error?S.stack:"No stack trace",timestamp:new Date().toISOString()}),C.includes("Content script not responding")||C.includes("all EMR fields are empty")||C.includes("extraction failed"),typeof window<"u"){const T=C.includes("Unknown message type")?"Please reload the extension in chrome://extensions and try again":C.includes("No clinical data")?"Please navigate to a patient page with clinical data and try again":`AI Review failed: ${C}`;alert(`AI Medical Review Error

${T}`)}}finally{r(null)}return}try{r(v),console.log("âš¡ Calling onQuickAction..."),await n(v,y),console.log("âš¡ onQuickAction completed successfully"),o(!1),c(!1)}catch(S){console.error(`âŒ Quick action ${v} failed:`,S)}finally{r(null)}},f=async()=>{try{console.log("ðŸ“‹ EMR EXTRACTION: Starting EMR data extraction..."),console.log("ðŸ“‹ EMR EXTRACTION: Current tab info:",await chrome.tabs.query({active:!0,currentWindow:!0})),console.log("ðŸ“‹ EMR EXTRACTION: Testing content script connection...");try{const H=await chrome.runtime.sendMessage({type:"PING"});console.log("ðŸ“‹ EMR EXTRACTION: Content script ping response:",H)}catch(H){throw console.error("ðŸ“‹ EMR EXTRACTION: Content script ping failed:",H),new Error("Content script not responding - please refresh the EMR page and try again")}console.log("ðŸ“‹ EMR EXTRACTION: Making individual EXECUTE_ACTION calls...");const v=[{name:"background",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"background",data:{extractOnly:!0}})},{name:"investigation-summary",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"investigation-summary",data:{extractOnly:!0}})},{name:"medications",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"medications",data:{extractOnly:!0}})}],y=await Promise.allSettled(v.map(H=>H.promise)),[S,C,T]=y;console.log("ðŸ“‹ EMR EXTRACTION: Detailed extraction results:"),y.forEach((H,K)=>{const Ne=v[K].name;H.status==="fulfilled"?console.log(`ðŸ“‹ EMR EXTRACTION: ${Ne} - SUCCESS:`,H.value):console.error(`ðŸ“‹ EMR EXTRACTION: ${Ne} - FAILED:`,H.reason)});const M=S.status==="fulfilled"?S.value:null,k=C.status==="fulfilled"?C.value:null,j=T.status==="fulfilled"?T.value:null,A={background:{response:M,success:M?.success||!1,hasData:!!M?.data,error:S.status==="rejected"?S.reason:null},investigations:{response:k,success:k?.success||!1,hasData:!!k?.data,error:C.status==="rejected"?C.reason:null},medications:{response:j,success:j?.success||!1,hasData:!!j?.data,error:T.status==="rejected"?T.reason:null}};console.log("ðŸ“‹ EMR EXTRACTION: Detailed response validation:",A);const P=h(M,"Background"),_=h(k,"Investigation Summary"),z=h(j,"Medications"),Q={background:{length:P.length,hasContent:!!P.trim()},investigations:{length:_.length,hasContent:!!_.trim()},medications:{length:z.length,hasContent:!!z.trim()}};console.log("ðŸ“‹ EMR EXTRACTION: Final extraction summary:",Q);const G=Object.values(Q).filter(H=>H.hasContent).length;console.log(`ðŸ“‹ EMR EXTRACTION: Successfully extracted ${G}/3 fields`);const J=[];return!Q.background.hasContent&&A.background.error&&J.push(`Background: ${A.background.error.message||A.background.error}`),!Q.investigations.hasContent&&A.investigations.error&&J.push(`Investigations: ${A.investigations.error.message||A.investigations.error}`),!Q.medications.hasContent&&A.medications.error&&J.push(`Medications: ${A.medications.error.message||A.medications.error}`),J.length>0&&console.warn("ðŸ“‹ EMR EXTRACTION: Some fields failed to extract:",J),{background:P,investigations:_,medications:z,extractionMeta:{successfulFields:G,totalFields:3,failedFields:J,fieldDetails:Q}}}catch(v){throw console.error("âŒ EMR EXTRACTION: Critical error in extraction process:",v),new Error(`EMR data extraction failed: ${v instanceof Error?v.message:"Unknown error"}`)}},h=(v,y="Unknown")=>{if(console.log(`ðŸ“‹ EMR EXTRACTION: Parsing ${y} response:`,v),!v)return console.log(`ðŸ“‹ EMR EXTRACTION: ${y} - No response received`),"";let S="";return typeof v=="string"?S=v:v.data&&typeof v.data=="string"?S=v.data:v.content&&typeof v.content=="string"?S=v.content:v.text&&typeof v.text=="string"?S=v.text:v.value&&typeof v.value=="string"&&(S=v.value),console.log(`ðŸ“‹ EMR EXTRACTION: ${y} - Extracted ${S.length} characters:`,S?`"${S.substring(0,100)}${S.length>100?"...":""}"`:"(empty)"),S},m=v=>`BACKGROUND: ${v.background||"Not provided"}

INVESTIGATIONS: ${v.investigations||"Not provided"}

MEDICATIONS: ${v.medications||"Not provided"}`,b=async v=>{await u("appointment-wrap-up",{preset:v})},g=v=>{v.id==="dictate"?e&&(e("investigation-summary"),c(!1)):v.id==="type"&&u("investigation-summary",{type:"manual"})},x=()=>{o(!1),c(!1)},w=Tr,I=w.reduce((v,y)=>(v[y.category]||(v[y.category]=[]),v[y.category].push(y),v),{}),R={emr:"EMR Navigation",documentation:"Documentation",workflow:"Workflow",analysis:"Clinical Analysis"},D={emr:hi,documentation:Ot,workflow:xt,analysis:wn};return l?t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:x,className:"flex items-center text-blue-600 hover:text-blue-700",children:t.jsx(In,{className:"w-4 h-4 mr-1"})}),t.jsx(Ye,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Investigation Summary"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Choose how to add your summary"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 gap-3",children:Cr.map(v=>t.jsxs("button",{onClick:()=>g(v),disabled:i==="investigation-summary",className:`
                  bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded-lg p-4 text-left
                  ${i==="investigation-summary"?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(v.icon,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:v.label}),t.jsx("div",{className:"text-gray-600 text-xs leading-tight",children:v.description})]}),t.jsx(yn,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]}),i==="investigation-summary"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx(cn,{})})]},v.id))})}),t.jsx("div",{className:"p-4 bg-gray-50",children:t.jsxs("p",{className:"text-gray-600 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Dictate uses AI to format your speech, Type opens the field for manual entry"]})})]}):s?t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:x,className:"flex items-center text-blue-600 hover:text-blue-700",children:t.jsx(In,{className:"w-4 h-4 mr-1"})}),t.jsx(Gt,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Appointment Wrap-up Presets"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Choose a preset to apply"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 gap-3",children:Sr.map(v=>t.jsxs("button",{onClick:()=>b(v),disabled:i==="appointment-wrap-up",className:`
                  bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded-lg p-4 text-left
                  ${i==="appointment-wrap-up"?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Gt,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:v.displayName}),t.jsxs("div",{className:"text-gray-600 text-xs mb-2",children:[t.jsx("span",{className:"font-medium",children:"Item Code:"})," ",v.itemCode]}),t.jsxs("div",{className:"text-gray-600 text-xs leading-tight",children:[t.jsx("span",{className:"font-medium",children:"Notes:"}),' "',v.notes,'"']})]}),t.jsx(yn,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]}),i==="appointment-wrap-up"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx(cn,{})})]},v.id))})}),t.jsx("div",{className:"p-4 bg-gray-50",children:t.jsxs("p",{className:"text-gray-600 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Presets will automatically fill the Item Code and Appointment Notes fields"]})})]}):a?t.jsxs(B.div,{className:"bg-white",variants:pe(Jt),initial:"hidden",animate:"visible",children:[t.jsxs(B.div,{className:"flex items-center space-x-2 mb-3",variants:pe(Ct),children:[t.jsx(xt,{className:"w-3 h-3 text-blue-600"}),t.jsx("h3",{className:"text-gray-900 font-medium text-xs",children:"Quick Actions"})]}),t.jsxs(B.div,{className:"grid grid-cols-4 gap-2",variants:pe(Jt),transition:{staggerChildren:Mt.tight,delayChildren:.1},children:[w.map((v,y)=>t.jsx(B.div,{variants:pe(Ct),custom:y,children:qt[v.id]?t.jsx(Bn,{config:qt[v.id],onStartWorkflow:e,onQuickAction:n,processingAction:i,isFooter:!0}):t.jsxs(B.button,{onClick:()=>{console.log("ðŸ”§ Button clicked:",v.id,"at",new Date().toISOString()),u(v.id)},disabled:i===v.id,className:`
                    relative p-2 rounded-2xl transition-all duration-150 text-left min-h-10 flex items-center
                    hover:bg-surface-primary hover:border hover:border-line-primary hover:shadow-sm
                    ${v.category==="analysis"?"hover:border-accent-violet/30":""}
                    ${i===v.id?"opacity-50 cursor-not-allowed":""}
                  `,variants:pe(er),whileHover:i!==v.id?"hover":void 0,whileTap:i!==v.id?"tap":void 0,children:[t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx(v.icon,{className:`w-3 h-3 flex-shrink-0 ${v.category==="analysis"?"text-accent-violet":"text-accent-emerald"}`}),t.jsx("div",{className:"text-ink-primary text-[10px] font-medium leading-tight min-w-0 flex-1",children:v.label})]}),t.jsx(Ae,{children:i===v.id&&t.jsx(B.div,{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.jsx(Yt,{})})})]})},v.id)),t.jsx(B.div,{className:"relative rounded-2xl min-h-10 flex transition-all duration-150 hover:bg-surface-primary hover:border hover:border-accent-violet/30",variants:pe(Ct),whileHover:{scale:1.02},transition:{type:"spring",damping:25,stiffness:300},children:t.jsx("div",{className:"flex h-full",children:Er.map((v,y)=>t.jsxs(B.button,{onClick:()=>{console.log("ðŸ”§ AI Button clicked:",v.id,"at",new Date().toISOString()),u(v.id)},disabled:i===v.id,className:`
                    flex-1 relative p-1 transition-all text-left
                    ${y===0?"rounded-l-2xl border-r border-line-primary":"rounded-r-2xl"}
                    hover:bg-surface-tertiary
                    ${i===v.id?"opacity-50 cursor-not-allowed":""}
                  `,whileHover:i!==v.id?{scale:1.05}:void 0,whileTap:i!==v.id?{scale:.95}:void 0,children:[t.jsxs("div",{className:"flex items-center justify-center flex-col space-y-0.5",children:[t.jsx(v.icon,{className:"w-3 h-3 flex-shrink-0 text-accent-violet"}),t.jsx("div",{className:"text-ink-primary text-[9px] font-medium leading-tight text-center",children:v.id==="ai-medical-review"?"AI Review":"Batch AI"})]}),t.jsx(Ae,{children:i===v.id&&t.jsx(B.div,{className:"absolute inset-0 flex items-center justify-center bg-surface-tertiary rounded-lg",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:t.jsx(Yt,{})})})]},v.id))})})]})]}):t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(xt,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Quick Actions"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"EMR shortcuts and workflows"})]})]})}),t.jsxs("div",{children:[Object.entries(I).map(([v,y])=>{const S=D[v];return t.jsxs("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx(S,{className:"w-4 h-4 text-gray-500"}),t.jsx("h4",{className:"text-gray-700 text-xs font-medium uppercase tracking-wide",children:R[v]})]}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:y.map(C=>qt[C.id]?t.jsx(Bn,{config:qt[C.id],onStartWorkflow:e,onQuickAction:n,processingAction:i,isFooter:!1},C.id):t.jsxs("button",{onClick:()=>u(C.id),disabled:i===C.id,className:`
                          p-3 rounded-2xl text-left transition-all duration-150 micro-press micro-lift
                          hover:bg-surface-primary hover:border hover:border-line-primary hover:shadow-sm
                          ${C.category==="analysis"?"hover:border-accent-violet/30":""}
                          ${i===C.id?"opacity-50 cursor-not-allowed":""}
                        `,children:[t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(C.icon,{className:`w-4 h-4 mt-0.5 flex-shrink-0 ${C.category==="analysis"?"text-accent-violet":"text-accent-emerald"}`}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-ink-primary text-xs font-medium truncate",children:C.label}),t.jsx("div",{className:"text-ink-secondary text-xs mt-1 leading-tight",children:C.description})]})]}),i===C.id&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:t.jsx(cn,{})})]},C.id))})]},v)}),t.jsx("div",{className:"p-4 bg-surface-tertiary",children:t.jsxs("p",{className:"text-ink-secondary text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Quick actions provide fast access to EMR fields and workflows"]})})]})]})});_a.displayName="QuickActions";const Hn=[{id:"ai-medical-review",label:"AI Medical Review",icon:ga,description:"Australian clinical oversight and guidelines review (analyzes existing EMR data)"},{id:"batch-ai-review",label:"Batch AI Review",icon:ot,description:"AI review for multiple patients from appointment book"}],Pr=({onQuickAction:n,processingAction:e,isFooter:a=!1})=>{const[i,r]=d.useState(null),s=async(l,c)=>{if(l==="ai-medical-review"){r(l),console.log("ðŸ¤– AI Medical Review action triggered...");try{console.log("ðŸ“‹ EMR EXTRACTION: Starting EMR data extraction via service worker...");const u=await new Promise(f=>{console.log("ðŸ“‹ EMR EXTRACTION: Sending EXTRACT_EMR_DATA_AI_REVIEW message to service worker"),chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA_AI_REVIEW",fields:["background","investigations","medications-problemlist"]},h=>{if(console.log("ðŸ“‹ EMR EXTRACTION: Response from service worker:",h),chrome.runtime.lastError){console.error("ðŸ“‹ EMR EXTRACTION: Chrome runtime error:",chrome.runtime.lastError),f({success:!1,error:`Chrome runtime error: ${chrome.runtime.lastError.message}`});return}if(!h){console.error("ðŸ“‹ EMR EXTRACTION: No response received from service worker"),f({success:!1,error:"No response from service worker"});return}f(h)})});if(u.success&&u.data){const f=u.data;if(console.log("ðŸ“‹ EMR EXTRACTION: Successfully received data:",f),Object.entries(f).filter(([b,g])=>g&&typeof g=="string"&&g.trim().length>0).length===0)throw new Error("No EMR data found. Please ensure you're on a patient page with clinical data.");const m=`
Background: ${f.background||"No background data available"}

Investigations: ${f.investigations||"No investigations data available"}

Medications: ${f["medications-problemlist"]||"No medications data available"}
          `.trim();console.log("ðŸ“‹ EMR EXTRACTION: Processing EMR data for AI review"),await n(l,{emrData:f,formattedInput:m,type:"australian-medical-review"}),console.log("âœ… AI Medical Review completed successfully")}else{const f=u.error||"Unknown extraction error";throw new Error(`Failed to extract EMR data: ${f}`)}}catch(u){console.error("âŒ AI Medical Review failed:",u);const f=u instanceof Error?u.message:"Unknown error";console.error("AI Review Error:",f),typeof window<"u"&&alert(`AI Medical Review Error

${f}`)}finally{r(null)}return}try{r(l),console.log("âš¡ Calling onQuickAction for AI Review..."),await n(l,c),console.log("âš¡ AI Review onQuickAction completed successfully")}catch(u){console.error(`âŒ AI Review action ${l} failed:`,u)}finally{r(null)}},o=l=>e===l||i===l;return a?t.jsxs("div",{className:"bg-white",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(wn,{className:"w-3 h-3 text-indigo-600"}),t.jsx("h3",{className:"text-gray-900 font-medium text-xs",children:"AI Medical Review"})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Hn.map(l=>t.jsxs("button",{onClick:()=>s(l.id),disabled:o(l.id),className:`
                bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 relative p-2 rounded-lg transition-all text-center btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(l.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[t.jsx(l.icon,{className:"w-3 h-3 text-indigo-600 flex-shrink-0"}),t.jsx("div",{className:"text-gray-900 text-xs font-medium leading-tight",children:l.label})]}),o(l.id)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:t.jsx(Yt,{})})]},l.id))})]}):t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(wn,{className:"w-5 h-5 text-indigo-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"AI Medical Review"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Clinical analysis and guidelines review"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 gap-3",children:Hn.map(l=>t.jsxs("button",{onClick:()=>s(l.id),disabled:o(l.id),className:`
                bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 p-3 rounded-lg text-left transition-all btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(l.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(l.icon,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-indigo-600"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-xs font-medium truncate",children:l.label}),t.jsx("div",{className:"text-gray-600 text-xs mt-1 leading-tight",children:l.description})]})]}),o(l.id)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:t.jsx(Yt,{})})]},l.id))})}),t.jsx("div",{className:"p-4 bg-indigo-50",children:t.jsxs("p",{className:"text-indigo-700 text-xs",children:["ðŸ’¡ ",t.jsx("strong",{children:"Note:"})," AI Review uses MedGemma-27b for comprehensive clinical analysis"]})})]})},$a=n=>{const{isOpen:e,offset:a={x:0,y:8},alignment:i="right",maxHeight:r=320}=n,s=d.useRef(null),o=d.useRef(null),[l,c]=d.useState({top:0,left:0}),u=d.useCallback(()=>{if(!s.current||!e)return;const f=s.current.getBoundingClientRect(),h={width:window.innerWidth,height:window.innerHeight};let m=f.bottom+a.y,b=f.left+a.x,g;i==="right"?(b=f.right-280,g=h.width-f.right+a.x):i==="center"&&(b=f.left+f.width/2-140),b<8?(b=8,g=void 0):b+280>h.width-8&&(b=h.width-280-8,g=8);const x=h.height-f.bottom-8,w=f.top-8;let I=r;x<r&&w>x?(m=f.top-r-a.y,I=Math.min(r,w)):I=Math.min(r,x),c({top:m,left:g!==void 0?void 0:b,right:g,maxHeight:I})},[e,a,i,r]);return d.useEffect(()=>{if(e){u();const f=()=>u(),h=()=>u();return window.addEventListener("resize",f),window.addEventListener("scroll",h,!0),()=>{window.removeEventListener("resize",f),window.removeEventListener("scroll",h,!0)}}},[e,u]),{triggerRef:s,dropdownRef:o,position:l,calculatePosition:u}},Ar=(n="portal-root")=>{const e=d.useRef(null);return d.useEffect(()=>{let a=document.getElementById(n);return a||(a=document.createElement("div"),a.id=n,a.style.position="relative",a.style.zIndex="999999",a.style.pointerEvents="none",document.body.appendChild(a)),e.current=a,()=>{if(a&&a.parentNode===document.body&&a.children.length===0)try{document.body.removeChild(a)}catch{console.debug("Portal container already removed:",n)}}},[n]),e.current},Pn=({isOpen:n,children:e,onClickOutside:a})=>{const i=Ar("dropdown-portal");return d.useEffect(()=>{if(!n||!a)return;const r=o=>{const l=o.target;!l.closest("[data-dropdown-menu]")&&!l.closest("[data-dropdown-trigger]")&&a()},s=setTimeout(()=>{document.addEventListener("mousedown",r)},0);return()=>{clearTimeout(s),document.removeEventListener("mousedown",r)}},[n,a]),!n||!i?null:Di.createPortal(t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:50},children:t.jsx("div",{style:{pointerEvents:"auto"},children:e})}),i)},dn=[{id:"quick-letter",label:"Quick Letter",description:"Medical correspondence and consultation letters",agent:"QuickLetterAgent",icon:"FileText",color:"green",category:"documentation",estimatedTime:"1-3 min",complexity:"low"},{id:"consultation",label:"Consultation",description:"Comprehensive patient assessments",agent:"ConsultationAgent",icon:"Stethoscope",color:"blue",category:"documentation",estimatedTime:"2-4 min",complexity:"medium"},{id:"angiogram-pci",label:"Angiogram/PCI",description:"Cardiac catheterization and coronary interventions",agent:"AngiogramPCIAgent",icon:"Heart",color:"red",category:"procedure",estimatedTime:"8-15 min",complexity:"high"},{id:"tavi",label:"TAVI Report",description:"Transcatheter aortic valve implantation",agent:"TAVIAgent",icon:"CircleDot",color:"red",category:"procedure",estimatedTime:"8-12 min",complexity:"high"},{id:"mteer",label:"mTEER Report",description:"Mitral transcatheter edge-to-edge repair",agent:"MTEERAgent",icon:"Zap",color:"purple",category:"procedure",estimatedTime:"7-10 min",complexity:"high"},{id:"pfo-closure",label:"PFO Closure",description:"Patent foramen ovale closure",agent:"PFOClosureAgent",icon:"Shield",color:"green",category:"procedure",estimatedTime:"5-8 min",complexity:"medium"},{id:"right-heart-cath",label:"Right Heart Cath",description:"Right heart catheterisation with haemodynamic assessment",agent:"RightHeartCathAgent",icon:"Activity",color:"orange",category:"procedure",estimatedTime:"6-10 min",complexity:"medium"}],Rr={Heart:Wi,FileText:At,Activity:Vi,Stethoscope:Gi,CircleDot:Xi,Mic:va,Square:Ze,Search:Ji,User:Ki,Pill:Yi,Shield:Zi},Fa=d.memo(({onWorkflowSelect:n,activeWorkflow:e,isRecording:a,disabled:i=!1,voiceActivityLevel:r=0,recordingTime:s=0,whisperServerRunning:o=!0})=>{const[l,c]=d.useState(!1),[u,f]=d.useState(!1),h=d.useRef(null),m=d.useRef(!1),b=d.useRef(null),g=d.useRef(`record-menu-${Math.random().toString(36).slice(2)}`),{triggerRef:x,position:w}=$a({isOpen:l,alignment:"center",offset:{x:0,y:8},maxHeight:400}),I=j=>{const A=Math.floor(j/60),P=j%60;return`${A}:${P.toString().padStart(2,"0")}`},R=()=>{if(i){console.log("ðŸš« Mouse enter ignored - button disabled");return}console.log("ðŸ–±ï¸ Mouse entered record button",{isExpanded:l,hasTimeout:!!h.current,isHoveringRefCurrent:m.current,whisperServerRunning:o,disabled:i,isRecording:a,activeWorkflow:e}),m.current=!0,f(!0),h.current&&(console.log("ðŸ§¹ Clearing existing hover timeout"),window.clearTimeout(h.current),h.current=null),l||(console.log("â° Setting expand timeout"),h.current=window.setTimeout(()=>{m.current?(console.log("ðŸŽ¯ Expanding card after hover delay"),c(!0)):console.log("ðŸš« Not expanding - mouse already left"),h.current=null},50))},D=()=>{console.log("ðŸ–±ï¸ Mouse left record button",{isExpanded:l,isHoveringRefCurrent:m.current}),m.current=!1,f(!1),h.current&&(console.log("ðŸ§¹ Clearing existing timeout on mouse leave"),window.clearTimeout(h.current),h.current=null),console.log("â° Setting collapse timeout"),h.current=window.setTimeout(()=>{m.current?console.log("ðŸš« Not collapsing - mouse returned"):(console.log("ðŸ”½ Collapsing card - mouse completely away"),c(!1)),h.current=null},150)},v=()=>{console.log("ðŸ–±ï¸ Mouse entered card",{isExpanded:l,hasTimeout:!!h.current}),m.current=!0,f(!0),h.current&&(console.log("ðŸ§¹ Clearing timeout on card enter"),window.clearTimeout(h.current),h.current=null)},y=()=>{console.log("ðŸ–±ï¸ Mouse left card",{isExpanded:l,isHoveringRefCurrent:m.current}),m.current=!1,f(!1),h.current&&(console.log("ðŸ§¹ Clearing timeout on card leave"),window.clearTimeout(h.current),h.current=null),console.log("â° Setting collapse timeout from card"),h.current=window.setTimeout(()=>{m.current?console.log("ðŸš« Not collapsing - mouse returned to hover area"):(console.log("ðŸ”½ Collapsing card - mouse left card area"),c(!1)),h.current=null},150)};d.useEffect(()=>{if(!a&&e){console.log("ðŸ”„ Recording stopped - resetting dropdown state after delay",{activeWorkflow:e,isExpanded:l,isHovering:u,hasTimeout:!!h.current});const j=window.setTimeout(()=>{console.log("ðŸ”§ Performing full dropdown state reset",{wasExpanded:l,wasHovering:u}),c(!1),f(!1),m.current=!1,h.current&&(console.log("ðŸ§¹ Clearing hover timeout during recording stop reset"),window.clearTimeout(h.current),h.current=null),console.log("âœ… Dropdown state reset complete - ready for next recording")},1e3);return()=>{console.log("ðŸ§¹ Cleaning up recording stop timeout"),window.clearTimeout(j)}}},[a,e]),d.useEffect(()=>()=>{console.log("ðŸ§¹ RecordPanel unmounting - cleaning up timeouts and refs"),h.current&&(window.clearTimeout(h.current),h.current=null),m.current=!1},[]),d.useEffect(()=>{console.log("ðŸ”§ RecordPanel state check:",{isExpanded:l,isHovering:u,isHoveringRefCurrent:m.current,disabled:i,whisperServerRunning:o,isRecording:a,activeWorkflow:e,hasTimeout:!!h.current,timestamp:Date.now()});const j=l&&!m.current&&!a,A=!i&&o;j&&(console.warn("ðŸš¨ DETECTED STALE EXPANDED STATE - auto-fixing to restore hover functionality",{isExpanded:l,isHoveringRefCurrent:m.current,isRecording:a,isButtonAccessible:A}),c(!1),f(!1),m.current=!1,h.current&&(console.log("ðŸ§¹ Clearing stale timeout during auto-fix"),window.clearTimeout(h.current),h.current=null),console.log("âœ… Stale state auto-fix complete - hover should work now")),A||console.log("âš ï¸ Button not accessible:",{disabled:i,whisperServerRunning:o,reason:i?"disabled=true":"whisper server not running"})},[i,o,a,l,e]),d.useEffect(()=>{let j;return j=window.setTimeout(()=>{!a&&!i&&o&&console.log("ðŸ” HOVER FUNCTIONALITY CHECK - button should be responsive",{componentReady:!0,buttonAccessible:!i&&o,isExpanded:l,isHovering:u,currentState:"ready-for-hover"})},2e3),()=>{window.clearTimeout(j)}},[a,i,o,e]);const S=()=>{const j="relative flex items-center justify-center transition-all duration-300 cursor-pointer w-11 h-11 rounded-full border-2";return i?`${j} bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed`:a?`${j} bg-red-500 border-red-600 record-button-recording text-white shadow-lg`:`${j} bg-emerald-100 border-emerald-300 record-button-idle text-emerald-600 hover:bg-emerald-200 hover:border-emerald-400`},C=(j,A)=>{const P="relative w-full h-12 rounded-lg border-2 flex items-center justify-start font-medium transition-all duration-200 overflow-hidden hover:shadow-md";if(i||!o)return`${P} bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 border-gray-300 opacity-50 cursor-not-allowed`;if(A&&a){const z=j.category==="procedure"?"procedure-card":j.category==="documentation"?"documentation-card":"investigation-card";return`${P} ${z} recording-glow border-2`}const _=j.category==="procedure"?"btn-procedure-outline":j.category==="documentation"?"btn-documentation-outline":"btn-investigation-outline";return`${P} ${_} border-2 btn-hover-enhanced`},T=j=>{const A=Rr[j.icon]||At,P=e===j.id,_=()=>o?`${j.description} â€¢ ${j.estimatedTime} â€¢ ${j.complexity} complexity`:"Whisper server not running. Please start server: ./start-whisper-server.sh";return t.jsx("button",{onClick:()=>n(j.id),disabled:i||a&&!P||!o,className:C(j,P),title:_(),tabIndex:0,children:t.jsxs("div",{className:"relative flex items-center justify-start w-full h-full px-3 py-2",children:[t.jsx("div",{className:"relative flex-shrink-0 mr-3",children:P&&a?t.jsxs(t.Fragment,{children:[t.jsx(Ze,{className:"w-5 h-5"}),t.jsx("div",{className:"absolute inset-0 rounded-full bg-red-500/20 motion-safe:animate-ping"})]}):t.jsx(A,{className:"w-5 h-5"})}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("span",{className:`text-sm font-semibold ${P&&a?"text-red-700 font-bold":""}`,children:P&&a?"Complete Recording":j.label}),t.jsx("div",{className:`text-xs mt-0.5 ${P&&a?"text-red-600":"text-gray-500"}`,children:P&&a?I(s):j.estimatedTime})]}),P&&a&&t.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:t.jsx("div",{className:"w-6 h-0.5 rounded-full transition-all duration-150",style:{backgroundColor:r>.1?"#10b981":"#e5e7eb",opacity:.3+r*.7}})})]})},j.id)},M=j=>{i||(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),c(A=>!A))};d.useEffect(()=>{if(l){const j=b.current;j&&setTimeout(()=>{const A=j.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');A.length>0&&A[0].focus()},0)}},[l]);const k=j=>{if(l){if(j.key==="Escape"){j.stopPropagation(),c(!1),f(!1),x.current?.focus?.();return}if(j.key==="Tab"){const A=b.current;if(!A)return;const P=Array.from(A.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(Q=>!Q.hasAttribute("disabled"));if(P.length===0)return;const _=P[0],z=P[P.length-1];j.shiftKey?document.activeElement===_&&(j.preventDefault(),z.focus()):document.activeElement===z&&(j.preventDefault(),_.focus())}}};return t.jsxs("div",{className:"relative",children:[t.jsxs("button",{ref:x,type:"button","data-dropdown-trigger":!0,onMouseEnter:R,onMouseLeave:D,onClick:j=>{console.log("ðŸ–±ï¸ Record button clicked",{disabled:i,isExpanded:l,whisperServerRunning:o,currentTarget:j.currentTarget,timestamp:Date.now()}),!i&&o?(h.current&&(window.clearTimeout(h.current),h.current=null),c(A=>{const P=!A;return console.log("ðŸŽ¯ Toggling dropdown expansion:",A,"->",P),P})):console.log("âš ï¸ Click ignored - button disabled or whisper server not running")},onKeyDown:M,"aria-haspopup":"dialog","aria-expanded":l,"aria-controls":g.current,"aria-label":a?"Recording menu, recording in progress":"Open recording menu",className:S(),disabled:i,children:[t.jsx(fi,{className:`w-5 h-5 ${a?"fill-current":""}`}),a&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-red-300 motion-safe:animate-ping opacity-40"}),t.jsx("div",{className:"absolute inset-0 rounded-full border-1 border-white opacity-60"})]})]}),t.jsx(Pn,{isOpen:l,onClickOutside:()=>{console.log("ðŸ–±ï¸ Click outside detected - closing card"),c(!1),f(!1),m.current=!1},children:t.jsxs("div",{"data-dropdown-menu":!0,id:g.current,role:"dialog","aria-labelledby":`${g.current}-label`,ref:b,onKeyDown:k,onMouseEnter:v,onMouseLeave:y,className:"record-card glass rounded-xl p-4 w-[390px] bg-white border border-gray-200 shadow-xl",style:{position:"fixed",top:w.top,left:w.left,zIndex:999999},children:[t.jsxs("div",{className:"mb-3 text-center",children:[t.jsx("h2",{id:`${g.current}-label`,className:"text-gray-900 text-base font-semibold",children:"Record Now"}),t.jsx("p",{className:"text-gray-600 text-sm",children:a?`Recording ${dn.find(j=>j.id===e)?.label}...`:"Choose the type of medical report to create"})]}),t.jsx("div",{className:"flex flex-col gap-2 mb-3",children:dn.map(T)}),!a&&t.jsx("div",{className:"text-center text-gray-500 text-sm",children:o?t.jsx("p",{children:"Tap workflow to start recording"}):t.jsxs("p",{className:"text-red-600 font-medium flex items-center justify-center gap-2",children:[t.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-red-500","aria-hidden":"true"})," Whisper server not running - Please start server first"]})}),a&&e&&t.jsxs("div",{className:"glass rounded-lg p-2 text-center bg-red-50 border border-red-200",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full motion-safe:animate-pulse"}),t.jsxs("span",{className:"text-red-800 text-xs font-bold",children:["Recording ",dn.find(j=>j.id===e)?.label]})]}),t.jsxs("p",{className:"text-red-700 text-sm font-medium flex items-center justify-center gap-2",children:[r>.1?t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx(va,{className:"w-3.5 h-3.5"})," Listening..."]}):t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx(Ze,{className:"w-3.5 h-3.5"})," Speak now"]})," â€¢ Tap ",t.jsx("strong",{children:"Complete"})," when done"]})]})]})})]})});Fa.displayName="RecordPanel";const un=d.memo(({session:n,onRemoveSession:e,onSessionClick:a,showRemoveButton:i=!1,isCompact:r=!1})=>{const s=c=>new Date(c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),o=c=>t.jsx(Ot,{className:"w-4 h-4"}),l=c=>{switch(c){case"recording":return{icon:t.jsx(Xe,{className:"w-3 h-3 text-red-500"}),label:"Recording",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200"};case"transcribing":return{icon:t.jsx(Ge,{className:"w-3 h-3 text-blue-500 animate-spin"}),label:"Transcribing",bgColor:"bg-blue-50",textColor:"text-blue-700",borderColor:"border-blue-200"};case"processing":return{icon:t.jsx(st,{className:"w-3 h-3 text-purple-500"}),label:"Processing",bgColor:"bg-purple-50",textColor:"text-purple-700",borderColor:"border-purple-200"};case"completed":return{icon:t.jsx(jt,{className:"w-3 h-3 text-green-500"}),label:"Completed",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200"};case"error":return{icon:t.jsx(_t,{className:"w-3 h-3 text-red-500"}),label:"Error",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200"};case"cancelled":return{icon:t.jsx(Ie,{className:"w-3 h-3 text-gray-500"}),label:"Cancelled",bgColor:"bg-gray-50",textColor:"text-gray-700",borderColor:"border-gray-200"};default:return{icon:t.jsx(Qe,{className:"w-3 h-3 text-gray-500"}),label:"Unknown",bgColor:"bg-gray-50",textColor:"text-gray-700",borderColor:"border-gray-200"}}};if(r){const c=l(n.status);return t.jsxs("div",{className:`flex items-center space-x-3 p-2 ${c.bgColor} rounded-lg border ${c.borderColor}`,children:[t.jsx(Pt,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col flex-1",children:[t.jsx("span",{className:`text-sm font-semibold truncate ${c.textColor}`,children:n.patient.name}),t.jsx("span",{className:"text-xs text-gray-600 font-medium",children:n.agentName||n.agentType})]}),t.jsxs("div",{className:`flex items-center space-x-1 px-2 py-0.5 rounded-full text-xs font-medium ${c.bgColor} ${c.textColor}`,children:[c.icon,t.jsx("span",{children:c.label})]})]}),t.jsxs("div",{className:"flex items-center space-x-2 mt-1 text-xs text-gray-600",children:[t.jsxs("span",{children:["ID: ",n.patient.id]}),t.jsx("span",{children:"â€¢"}),t.jsx("span",{children:s(n.timestamp)})]})]}),i&&e&&t.jsx("button",{onClick:u=>{u.stopPropagation(),e(n.id)},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Remove session",children:t.jsx(Ie,{className:"w-4 h-4"})})]})}return t.jsx("div",{className:`glass rounded-xl p-4 border-l-4 border-blue-500 ${a?"cursor-pointer hover:bg-gray-50/50 transition-colors":""}`,onClick:()=>a?.(n),children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Pt,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:n.patient.name}),t.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[o(n.agentType),t.jsx("span",{className:"text-sm text-blue-600 font-medium",children:n.agentName||n.agentType})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-700 mb-3",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"ID:"})," ",n.patient.id]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Age:"})," ",n.patient.age]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"DOB:"})," ",n.patient.dob]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Qe,{className:"w-3 h-3"}),t.jsx("span",{children:s(n.timestamp)})]})]}),(n.patient.phone||n.patient.medicare)&&t.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[n.patient.phone&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(xi,{className:"w-3.5 h-3.5"})," ",n.patient.phone]}),n.patient.medicare&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(bi,{className:"w-3.5 h-3.5"})," Medicare: ",n.patient.medicare]})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[n.completed&&t.jsx("div",{className:"text-green-600 bg-green-100 px-2 py-1 rounded-full text-xs font-medium",children:"âœ“ Complete"}),i&&e&&t.jsx("button",{onClick:c=>{c.stopPropagation(),e(n.id)},className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove session",children:t.jsx(Ie,{className:"w-4 h-4"})})]})]})})}),mn=3,pn=8,La=d.memo(({sessions:n,onRemoveSession:e,onClearAllSessions:a,onSessionSelect:i,isOpen:r,onClose:s,triggerRef:o,position:l})=>{const[c,u]=d.useState(!1),[f,h]=d.useState(!1),[m,b]=d.useState(!1),g=d.useMemo(()=>{const k=performance.now();console.time("ðŸ“Š Session Categorization Performance"),console.log("ðŸ“Š Starting session categorization...",{totalSessions:n.length});const j=[],A=[],P=[];n.forEach(z=>{switch(z.status){case"completed":j.push(z);break;case"recording":case"transcribing":case"processing":A.push(z);break;case"error":case"cancelled":P.push(z);break}});const _=performance.now();return console.timeEnd("ðŸ“Š Session Categorization Performance"),console.log("ðŸ“Š Session categorization completed",{duration:`${(_-k).toFixed(2)}ms`,completed:j.length,inProgress:A.length,errored:P.length}),{completed:j,inProgress:A,errored:P}},[n]),x=d.useMemo(()=>{const k=performance.now();console.time("ðŸ“‹ Visible Sessions Calculation Performance");const j=c?pn:mn,A=f?pn:mn,P=m?pn:mn,_={completed:g.completed.slice(0,j),inProgress:g.inProgress.slice(0,A),errored:g.errored.slice(0,P),hasMoreCompleted:g.completed.length>j,hasMoreInProgress:g.inProgress.length>A,hasMoreErrored:g.errored.length>P},z=performance.now();return console.timeEnd("ðŸ“‹ Visible Sessions Calculation Performance"),console.log("ðŸ“‹ Visible sessions calculation completed",{duration:`${(z-k).toFixed(2)}ms`,visibleCompleted:_.completed.length,visibleInProgress:_.inProgress.length,visibleErrored:_.errored.length}),_},[g,c,f,m]),w=k=>{console.log("ðŸ–±ï¸ Session clicked in dropdown",{sessionId:k.id,patientName:k.patient.name,status:k.status,hasTranscription:!!k.transcription,hasResults:!!k.results,transcriptionLength:k.transcription?.length||0,resultsLength:k.results?.length||0,agentType:k.agentType,onSessionSelectExists:!!i}),i?(console.log("ðŸš€ Calling onSessionSelect..."),i(k),console.log("âœ… onSessionSelect called successfully")):console.warn("âš ï¸ onSessionSelect callback not provided!"),console.log("ðŸ”’ Closing session dropdown..."),s()},I=k=>{e(k)},R=()=>{a(),s()},[D,v]=d.useState(null),y=oe.useRef(),S=d.useCallback(()=>{if(l){v(l);return}if(o?.current){requestAnimationFrame(()=>{if(o?.current){const k=o.current.getBoundingClientRect();v({top:Math.round(k.bottom+8),right:Math.round(window.innerWidth-k.right)})}});return}v(null)},[l,o]),C=({onClick:k,hiddenCount:j,category:A})=>t.jsxs("button",{onClick:k,className:"w-full px-3 py-2 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors flex items-center justify-center space-x-1",children:[t.jsx(yt,{className:"w-3 h-3"}),t.jsxs("span",{children:["Show ",j," more ",A]})]});d.useEffect(()=>{if(!r)return;S();const k=()=>S();return window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k),y.current&&clearTimeout(y.current)}},[r,S]);const T=d.useCallback(()=>D?{position:"absolute",top:D.top,left:D.left,right:D.right,width:"320px",maxHeight:"384px",zIndex:999999}:{position:"fixed",top:"60px",right:"16px",width:"320px",maxHeight:"384px",zIndex:999999},[D]);if(!r||n.length===0)return console.log("ðŸ” SessionDropdown not rendering:",{isOpen:r,sessionsLength:n.length,reason:r?"no sessions":"not open"}),null;console.log("ðŸ” SessionDropdown rendering with sessions:",{totalSessions:n.length,completedSessions:x.completed.length,inProgressSessions:x.inProgress.length,erroredSessions:x.errored.length});const M=t.jsxs("div",{style:T(),className:"bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden","data-dropdown-menu":!0,children:[t.jsx("div",{className:"p-3 border-b border-gray-100 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ot,{className:"w-4 h-4 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Recent Sessions"}),t.jsxs("p",{className:"text-gray-600 text-xs",children:[n.length," total â€¢ ",g.inProgress.length," processing â€¢ ",g.completed.length," completed",g.errored.length>0&&` â€¢ ${g.errored.length} error${g.errored.length!==1?"s":""}`]})]})]}),n.length>0&&t.jsx("button",{onClick:R,className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear all sessions",children:t.jsx(an,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[g.inProgress.length>0&&t.jsxs("div",{className:"p-2",children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx(Qe,{className:"w-3 h-3 text-amber-600"}),t.jsx("span",{className:"text-xs font-medium text-amber-700",children:"In Progress"})]}),t.jsxs("div",{className:"space-y-2",children:[x.inProgress.map(k=>t.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:j=>{console.log("ðŸ–±ï¸ Raw in-progress session clicked!",{sessionId:k.id,patientName:k.patient.name}),j.preventDefault(),j.stopPropagation(),w(k)},children:t.jsx(un,{session:k,onRemoveSession:I,showRemoveButton:!0,isCompact:!0})},k.id)),x.hasMoreInProgress&&t.jsx(C,{onClick:()=>h(!0),hiddenCount:g.inProgress.length-x.inProgress.length,category:"in progress"})]})]}),g.errored.length>0&&t.jsxs("div",{className:`p-2 ${g.inProgress.length>0?"border-t border-gray-100":""}`,children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full flex-shrink-0"}),t.jsx("span",{className:"text-xs font-medium text-red-700",children:"Issues"})]}),t.jsxs("div",{className:"space-y-2",children:[x.errored.map(k=>t.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>w(k),children:t.jsx(un,{session:k,onRemoveSession:I,showRemoveButton:!0,isCompact:!0})},k.id)),x.hasMoreErrored&&t.jsx(C,{onClick:()=>b(!0),hiddenCount:g.errored.length-x.errored.length,category:"issues"})]})]}),g.completed.length>0&&t.jsxs("div",{className:`p-2 ${g.inProgress.length>0||g.errored.length>0?"border-t border-gray-100":""}`,children:[(g.inProgress.length>0||g.errored.length>0)&&t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full flex-shrink-0"}),t.jsx("span",{className:"text-xs font-medium text-emerald-700",children:"Completed"})]}),t.jsxs("div",{className:"space-y-2",children:[x.completed.map(k=>t.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:j=>{console.log("ðŸ–±ï¸ Raw completed session div clicked!",{sessionId:k.id,patientName:k.patient.name,event:j.type,target:j.target,currentTarget:j.currentTarget}),j.preventDefault(),j.stopPropagation(),w(k)},onMouseDown:j=>{console.log("ðŸ–±ï¸ Completed session mousedown!",k.id)},children:t.jsx(un,{session:k,onRemoveSession:I,showRemoveButton:!0,isCompact:!0})},k.id)),x.hasMoreCompleted&&t.jsx(C,{onClick:()=>u(!0),hiddenCount:g.completed.length-x.completed.length,category:"completed"})]})]})]}),n.length===0&&t.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No recent sessions"})]});return t.jsx(Pn,{isOpen:r,onClickOutside:s,children:M})},(n,e)=>{if(n.isOpen!==e.isOpen||n.sessions.length!==e.sessions.length||n.onRemoveSession!==e.onRemoveSession||n.onClearAllSessions!==e.onClearAllSessions||n.onSessionSelect!==e.onSessionSelect)return!1;const a=n.position,i=e.position;return!(a?.top!==i?.top||a?.left!==i?.left||a?.right!==i?.right)});La.displayName="SessionDropdown";const Mr={"quick-letter":"urgent",tavi:"urgent","angiogram-pci":"urgent",consultation:"high",mteer:"high","pfo-closure":"high","right-heart-cath":"high","investigation-summary":"normal",bloods:"normal","aus-medical-review":"normal",background:"low",medication:"low"};class rt{static instance;queue=[];activeJobs=new Map;completedJobs=[];isProcessing=!1;maxConcurrentJobs=2;maxQueueSize=10;maxRetries=3;retryDelayMs=1e3;jobTimeoutMs=3e5;processingTimes=[];lastCleanup=Date.now();cleanupIntervalMs=3e5;constructor(){this.startPeriodicCleanup()}static getInstance(){return rt.instance||(rt.instance=new rt),rt.instance}async addJob(e,a,i,r){if(this.queue.length>=this.maxQueueSize){const o=`Queue is full (${this.maxQueueSize} jobs). Please try again later.`;throw Z.warn("Audio processing queue is full",{component:"AudioProcessingQueueService",queueSize:this.queue.length,maxQueueSize:this.maxQueueSize}),r?.onError&&r.onError(o),new Error(o)}const s={id:`job-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sessionId:e,audioBlob:a,workflowId:i,priority:Mr[i]||"normal",status:"queued",queuedAt:Date.now(),retryCount:0,maxRetries:this.maxRetries,onProgress:r?.onProgress,onComplete:r?.onComplete,onError:r?.onError};return this.insertJobByPriority(s),Z.info("Audio processing job queued",{component:"AudioProcessingQueueService",jobId:s.id,sessionId:e,workflowId:i,priority:s.priority,queuePosition:this.getJobPosition(s.id),totalQueued:this.queue.length,processing:this.activeJobs.size}),s.onProgress&&s.onProgress("queued"),this.processQueue(),s.id}cancelJob(e){const a=this.queue.findIndex(r=>r.id===e);if(a!==-1){const r=this.queue[a];return r.status="cancelled",this.queue.splice(a,1),r.onProgress&&r.onProgress("cancelled"),Z.info("Audio processing job cancelled from queue",{component:"AudioProcessingQueueService",jobId:e,sessionId:r.sessionId}),!0}const i=this.activeJobs.get(e);return i?(i.status="cancelled",i.onProgress&&i.onProgress("cancelled"),Z.info("Audio processing job cancelled while processing",{component:"AudioProcessingQueueService",jobId:e,sessionId:i.sessionId}),!0):!1}getQueueStats(){const e=this.queue.length+this.activeJobs.size+this.completedJobs.length,a=this.processingTimes.length>0?this.processingTimes.reduce((i,r)=>i+r,0)/this.processingTimes.length:0;return{totalJobs:e,queuedJobs:this.queue.length,processingJobs:this.activeJobs.size,completedJobs:this.completedJobs.filter(i=>i.status==="completed").length,failedJobs:this.completedJobs.filter(i=>i.status==="failed").length,averageProcessingTime:a,currentConcurrency:this.activeJobs.size,maxConcurrency:this.maxConcurrentJobs}}getJobPosition(e){const a=this.queue.findIndex(i=>i.id===e);return a===-1?-1:a+1}getJobStatus(e){const a=this.queue.find(s=>s.id===e);if(a)return a.status;const i=this.activeJobs.get(e);if(i)return i.status;const r=this.completedJobs.find(s=>s.id===e);return r?r.status:null}updateConcurrencySettings(e,a){this.maxConcurrentJobs=Math.max(1,Math.min(e,5)),a!==void 0&&(this.maxQueueSize=Math.max(5,Math.min(a,20))),Z.info("Audio processing queue settings updated",{component:"AudioProcessingQueueService",maxConcurrentJobs:this.maxConcurrentJobs,maxQueueSize:this.maxQueueSize}),this.processQueue()}clearCompletedJobs(){const e=this.completedJobs.length;this.completedJobs=[],this.processingTimes=[],Z.info("Cleared completed audio processing jobs",{component:"AudioProcessingQueueService",clearedCount:e})}insertJobByPriority(e){const a=["urgent","high","normal","low"],i=a.indexOf(e.priority);let r=this.queue.length;for(let s=0;s<this.queue.length;s++){const o=a.indexOf(this.queue[s].priority);if(i<o){r=s;break}}this.queue.splice(r,0,e)}async processQueue(){if(!this.isProcessing){this.isProcessing=!0;try{for(;this.queue.length>0&&this.activeJobs.size<this.maxConcurrentJobs;){const e=this.queue.shift();!e||e.status==="cancelled"||(this.activeJobs.set(e.id,e),e.status="processing",e.startedAt=Date.now(),e.onProgress&&e.onProgress("processing"),this.processJobAsync(e))}}finally{this.isProcessing=!1}}}async processJobAsync(e){try{Z.info("Starting audio processing job",{component:"AudioProcessingQueueService",jobId:e.id,sessionId:e.sessionId,workflowId:e.workflowId,priority:e.priority,retryCount:e.retryCount});const{LMStudioService:a}=await ke(async()=>{const{LMStudioService:c}=await import("./chunks/services.DnrVKXEr.js").then(u=>u.a);return{LMStudioService:c}},__vite__mapDeps([6,5])),i=a.getInstance(),r=new Promise((c,u)=>{setTimeout(()=>u(new Error("Job timeout")),this.jobTimeoutMs)}),s=i.transcribeAudio(e.audioBlob,void 0,e.workflowId),o=await Promise.race([s,r]);e.status="completed",e.completedAt=Date.now();const l=e.completedAt-(e.startedAt||e.queuedAt);this.processingTimes.push(l),this.processingTimes.length>50&&(this.processingTimes=this.processingTimes.slice(-50)),Z.info("Audio processing job completed",{component:"AudioProcessingQueueService",jobId:e.id,sessionId:e.sessionId,processingTime:l,resultLength:o.length}),e.onComplete&&e.onComplete(o),e.onProgress&&e.onProgress("completed")}catch(a){const i=a instanceof Error?a.message:"Unknown error";if(Z.error("Audio processing job failed",{component:"AudioProcessingQueueService",jobId:e.id,sessionId:e.sessionId,error:i,retryCount:e.retryCount,maxRetries:e.maxRetries}),e.retryCount<e.maxRetries&&e.status!=="cancelled"){e.retryCount++;const r=this.retryDelayMs*Math.pow(2,e.retryCount-1);Z.info("Retrying audio processing job",{component:"AudioProcessingQueueService",jobId:e.id,retryCount:e.retryCount,retryDelay:r}),setTimeout(()=>{e.status!=="cancelled"&&(e.status="queued",this.insertJobByPriority(e),this.processQueue())},r)}else e.status="failed",e.completedAt=Date.now(),e.error=i,e.onError&&e.onError(i),e.onProgress&&e.onProgress("failed",i)}finally{this.activeJobs.delete(e.id),(e.status==="completed"||e.status==="failed")&&this.completedJobs.push(e),setTimeout(()=>this.processQueue(),100)}}startPeriodicCleanup(){setInterval(()=>{const e=Date.now(),a=e-36e5,i=this.completedJobs.length;this.completedJobs=this.completedJobs.filter(r=>(r.completedAt||r.queuedAt)>a),this.completedJobs.length<i&&Z.info("Cleaned up old completed audio processing jobs",{component:"AudioProcessingQueueService",removedCount:i-this.completedJobs.length,remainingCount:this.completedJobs.length}),this.lastCleanup=e},this.cleanupIntervalMs)}}const Ir=Object.freeze(Object.defineProperty({__proto__:null,AudioProcessingQueueService:rt},Symbol.toStringTag,{value:"Module"})),Dr=({isCompact:n=!1,className:e=""})=>{const[a,i]=d.useState(null),[r,s]=d.useState(!1);if(d.useEffect(()=>{const l=rt.getInstance(),c=()=>{const f=l.getQueueStats();i(f);const h=f.queuedJobs>0||f.processingJobs>0;s(h)};c();const u=setInterval(c,2e3);return()=>clearInterval(u)},[]),!r||!a)return null;const o=l=>l<1e3?`${Math.round(l)}ms`:l<6e4?`${Math.round(l/1e3)}s`:`${Math.round(l/6e4)}m`;return n?t.jsxs("div",{className:`inline-flex items-center space-x-2 text-xs text-gray-600 ${e}`,children:[a.processingJobs>0&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(st,{className:"w-3 h-3 text-blue-500"}),t.jsxs("span",{children:[a.processingJobs," processing"]})]}),a.queuedJobs>0&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Qe,{className:"w-3 h-3 text-amber-500"}),t.jsxs("span",{children:[a.queuedJobs," queued"]})]})]}):t.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-3 shadow-sm ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Xt,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Audio Queue"})]}),a.currentConcurrency>0&&t.jsxs("div",{className:"flex items-center space-x-1 text-xs text-green-600",children:[t.jsx(st,{className:"w-3 h-3"}),t.jsxs("span",{children:[a.currentConcurrency,"/",a.maxConcurrency]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{className:"space-y-1",children:[a.processingJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Processing"}),t.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[t.jsx(st,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:a.processingJobs})]})]}),a.queuedJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Queued"}),t.jsxs("div",{className:"flex items-center space-x-1 text-amber-600",children:[t.jsx(Qe,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:a.queuedJobs})]})]})]}),t.jsxs("div",{className:"space-y-1",children:[a.completedJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Completed"}),t.jsx("span",{className:"font-medium text-green-600",children:a.completedJobs})]}),a.failedJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Failed"}),t.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[t.jsx(_t,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:a.failedJobs})]})]}),a.averageProcessingTime>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Avg Time"}),t.jsx("span",{className:"font-medium text-gray-900",children:o(a.averageProcessingTime)})]})]})]}),a.processingJobs>0&&t.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-1",children:t.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${a.processingJobs/a.maxConcurrency*100}%`}})}),t.jsxs("span",{className:"text-xs text-gray-500",children:[a.processingJobs,"/",a.maxConcurrency]})]})})]})};class Ve{static instance;toasts=[];listeners=new Set;autoRemoveTimers=new Map;constructor(){}static getInstance(){return Ve.instance||(Ve.instance=new Ve),Ve.instance}subscribe(e){return this.listeners.add(e),e([...this.toasts]),()=>{this.listeners.delete(e)}}notifyListeners(){requestAnimationFrame(()=>{this.listeners.forEach(e=>{e([...this.toasts])})})}show(e){const a=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={...e,id:a,timestamp:Date.now(),duration:e.duration??(e.type==="error"?4e3:3e3)};if(this.toasts.unshift(i),this.toasts.length>5&&this.toasts.splice(5).forEach(s=>{const o=this.autoRemoveTimers.get(s.id);o&&(clearTimeout(o),this.autoRemoveTimers.delete(s.id))}),this.notifyListeners(),i.duration&&i.duration>0){const r=window.setTimeout(()=>{this.remove(a)},i.duration);this.autoRemoveTimers.set(a,r)}return a}remove(e){const a=this.toasts.findIndex(i=>i.id===e);if(a!==-1){this.toasts.splice(a,1);const i=this.autoRemoveTimers.get(e);i&&(clearTimeout(i),this.autoRemoveTimers.delete(e)),this.notifyListeners()}}clear(){this.autoRemoveTimers.forEach(e=>clearTimeout(e)),this.autoRemoveTimers.clear(),this.toasts=[],this.notifyListeners()}success(e,a,i){return this.show({type:"success",title:e,message:a,duration:i})}error(e,a,i){return this.show({type:"error",title:e,message:a,duration:i})}warning(e,a,i){return this.show({type:"warning",title:e,message:a,duration:i})}info(e,a,i){return this.show({type:"info",title:e,message:a,duration:i})}}const Or=n=>{const e=n.find(s=>s.deviceId==="default");if(e)return e;const a=n.find(s=>s.label.toLowerCase().includes("built-in")||s.label.toLowerCase().includes("internal")||s.label.toLowerCase().includes("macbook"));if(a)return a;const i=n.find(s=>s.deviceId!=="default"&&s.label&&!s.label.includes("Microphone ")&&!An(s.label));if(i)return i;const r=n.find(s=>s.deviceId!=="default");return r||n[0]},_r=n=>{const e=n.find(s=>s.deviceId==="default");if(e)return e;const a=n.find(s=>s.label.toLowerCase().includes("built-in")||s.label.toLowerCase().includes("internal")||s.label.toLowerCase().includes("macbook"));if(a)return a;const i=n.find(s=>s.deviceId!=="default"&&s.label&&!s.label.includes("Speaker ")&&!An(s.label));if(i)return i;const r=n.find(s=>s.deviceId!=="default");return r||n[0]},An=n=>{const e=n.toLowerCase();return["iphone","ipad","airpods","bluetooth","wireless","headphones","headset","earbuds","watch"].some(i=>e.includes(i))},Wn=(n,e,a)=>{if(n.deviceId==="default")return"system default device";const i=n.label.toLowerCase();return i.includes("built-in")||i.includes("internal")||i.includes("macbook")?"built-in device":An(n.label)?n.deviceId!=="default"?"non-default device fallback":"first available device":"preferred non-mobile device"},$r=()=>{const[n,e]=d.useState([]),[a,i]=d.useState([]),[r,s]=d.useState(!0),[o,l]=d.useState(!1),{selectedMicrophoneId:c,selectedSpeakerId:u,microphoneSelectionType:f,speakerSelectionType:h,setSelectedMicrophoneId:m,setSelectedSpeakerId:b}=ba(),g=d.useCallback(async()=>{try{s(!0);const S=(await navigator.permissions.query({name:"microphone"})).state==="granted";l(S);const C=await navigator.mediaDevices.enumerateDevices(),T=C.filter(k=>k.kind==="audioinput").map(k=>({deviceId:k.deviceId,label:k.label||`Microphone ${k.deviceId.slice(0,8)}`,groupId:k.groupId,kind:"audioinput"})),M=C.filter(k=>k.kind==="audiooutput").map(k=>({deviceId:k.deviceId,label:k.label||`Speaker ${k.deviceId.slice(0,8)}`,groupId:k.groupId,kind:"audiooutput"}));if(e(T),i(M),T.length>0&&(!c||f==="auto")){let k=null;if(f==="auto")try{const j=localStorage.getItem("xestro-preferred-microphone");j&&(k=T.find(A=>A.deviceId===j)||null,k&&console.log("ðŸŽ¤ Using saved microphone preference:",k.label))}catch(j){console.warn("Failed to read microphone preference:",j)}k||(k=Or(T),console.log("ðŸŽ¤ Auto-selected microphone:",{deviceId:k.deviceId,label:k.label,selectionReason:Wn(k,T,"microphone")})),m(k.deviceId,!1)}if(M.length>0&&(!u||h==="auto")){let k=null;if(h==="auto")try{const j=localStorage.getItem("xestro-preferred-speaker");j&&(k=M.find(A=>A.deviceId===j)||null,k&&console.log("ðŸ”Š Using saved speaker preference:",k.label))}catch(j){console.warn("Failed to read speaker preference:",j)}k||(k=_r(M),console.log("ðŸ”Š Auto-selected speaker:",{deviceId:k.deviceId,label:k.label,selectionReason:Wn(k,M,"speaker")})),b(k.deviceId,!1)}console.log("ðŸŽ¤ Audio devices enumerated:",{microphones:T.length,speakers:M.length})}catch(y){console.error("ðŸŽ¤ Failed to enumerate audio devices:",y)}finally{s(!1)}},[c,u,f,h]),x=d.useCallback(async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(S=>S.stop()),l(!0),await g()}catch(y){console.error("ðŸŽ¤ Failed to get microphone permission:",y),l(!1)}},[g]),w=d.useCallback(y=>{console.log("ðŸŽ¤ Manually selecting microphone:",y),m(y,!0)},[m]),I=d.useCallback(y=>{console.log("ðŸ”Š Manually selecting speaker:",y),b(y,!0)},[b]),R=d.useCallback(()=>{if(!c)return"No microphone";const y=n.find(S=>S.deviceId===c);return y?y.label:c==="default"?"Default microphone":"Unknown microphone"},[c,n]),D=d.useCallback(()=>{if(!u)return"No speaker";const y=a.find(S=>S.deviceId===u);return y?y.label:u==="default"?"Default speaker":"Unknown speaker"},[u,a]),v=d.useCallback(async()=>{await g()},[g]);return d.useEffect(()=>{g();const y=()=>{console.log("ðŸŽ¤ Audio devices changed, re-enumerating..."),g()};return navigator.mediaDevices.addEventListener("devicechange",y),()=>{navigator.mediaDevices.removeEventListener("devicechange",y)}},[g]),{microphones:n,speakers:a,selectedMicrophoneId:c,selectedSpeakerId:u,isLoading:r,hasPermission:o,setSelectedMicrophone:w,setSelectedSpeaker:I,requestPermission:x,refreshDevices:v,getCurrentMicrophoneLabel:R,getCurrentSpeakerLabel:D}},Fr=({disabled:n=!1})=>{const{microphones:e,speakers:a,selectedMicrophoneId:i,selectedSpeakerId:r,setSelectedMicrophone:s,setSelectedSpeaker:o,getCurrentMicrophoneLabel:l,getCurrentSpeakerLabel:c,isLoading:u,hasPermission:f,requestPermission:h}=$r(),[m,b]=d.useState(!1),[g,x]=d.useState(!1);oe.useEffect(()=>{const R=D=>{D.target.closest("[data-audio-dropdown]")||(b(!1),x(!1))};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[]);const w=R=>{R.kind==="audioinput"?(s(R.deviceId),b(!1)):(o(R.deviceId),x(!1))},I=(R,D=15)=>R.length<=D?R:R.substring(0,D-1)+"â€¦";return u?t.jsx("div",{className:"text-gray-500 text-[10px]",children:"Loading devices..."}):f?t.jsxs("div",{className:"flex items-center space-x-2 text-[10px]","data-audio-dropdown":!0,children:[t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>!n&&b(!m),disabled:n,className:`
            flex items-center space-x-1 text-gray-500 hover:text-gray-700 transition-colors
            ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,title:`Current microphone: ${l()}`,children:[t.jsx("span",{children:"ðŸŽ¤"}),t.jsx("span",{className:"max-w-[80px] truncate",children:I(l(),20)}),t.jsx(yt,{className:`w-2 h-2 transition-transform ${m?"transform rotate-180":""}`})]}),m&&!n&&e.length>0&&t.jsx("div",{className:"absolute top-full left-0 mt-1 z-[9998] bg-white border border-gray-200 rounded-md shadow-lg min-w-[200px] max-w-[250px]",children:t.jsx("div",{className:"py-1",children:e.map(R=>t.jsxs("button",{onClick:()=>w(R),className:`
                    w-full px-3 py-1.5 text-left text-xs hover:bg-gray-50 
                    transition-colors flex items-center space-x-2
                    ${i===R.deviceId?"bg-blue-50 text-blue-900":"text-gray-800"}
                  `,children:[t.jsx(Xe,{className:`w-3 h-3 ${i===R.deviceId?"text-blue-600":"text-gray-400"}`}),t.jsx("span",{className:"truncate",children:R.label}),i===R.deviceId&&t.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full ml-auto flex-shrink-0"})]},R.deviceId))})})]}),t.jsx("span",{className:"text-gray-400",children:"â€¢"}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>!n&&x(!g),disabled:n,className:`
            flex items-center space-x-1 text-gray-500 hover:text-gray-700 transition-colors
            ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,title:`Current speaker: ${c()}`,children:[t.jsx("span",{children:"ðŸ”Š"}),t.jsx("span",{className:"max-w-[80px] truncate",children:I(c(),20)}),t.jsx(yt,{className:`w-2 h-2 transition-transform ${g?"transform rotate-180":""}`})]}),g&&!n&&a.length>0&&t.jsx("div",{className:"absolute top-full left-0 mt-1 z-[9998] bg-white border border-gray-200 rounded-md shadow-lg min-w-[200px] max-w-[250px]",children:t.jsx("div",{className:"py-1",children:a.map(R=>t.jsxs("button",{onClick:()=>w(R),className:`
                    w-full px-3 py-1.5 text-left text-xs hover:bg-gray-50 
                    transition-colors flex items-center space-x-2
                    ${r===R.deviceId?"bg-blue-50 text-blue-900":"text-gray-800"}
                  `,children:[t.jsx(vi,{className:`w-3 h-3 ${r===R.deviceId?"text-blue-600":"text-gray-400"}`}),t.jsx("span",{className:"truncate",children:R.label}),r===R.deviceId&&t.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full ml-auto flex-shrink-0"})]},R.deviceId))})})]})]}):t.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-700 text-[10px] transition-colors",disabled:n,children:"Enable audio access"})},Lr={idle:{icon:Xe,label:"operator",description:"Ready to record",color:"text-ink-secondary",bgColor:"bg-surface-tertiary",animate:!1},recording:{icon:Xe,label:"Recording",description:"Listening to your voice...",color:"text-accent-red",bgColor:"bg-surface-tertiary",animate:!1},transcribing:{icon:Ge,label:"Transcribing",description:"Converting speech to text...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},classifying:{icon:lt,label:"Analyzing",description:"Determining the best medical agent...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},processing:{icon:st,label:"Processing",description:"Generating medical report...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},enhancing:{icon:lt,label:"Enhancing",description:"Refining medical content...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},complete:{icon:jt,label:"Complete",description:"Medical report generated successfully",color:"text-accent-emerald",bgColor:"bg-surface-tertiary",animate:!1},error:{icon:_t,label:"Error",description:"Something went wrong. Click any workflow to restart.",color:"text-accent-red",bgColor:"bg-surface-tertiary",animate:!1},cancelled:{icon:Ie,label:"Cancelled",description:"Recording cancelled. Click any workflow to start again.",color:"text-ink-secondary",bgColor:"bg-surface-tertiary",animate:!1},cancelling:{icon:Ge,label:"Cancelling",description:"Cancelling operation...",color:"text-accent-amber",bgColor:"bg-surface-tertiary",animate:!0}},zr={tavi:"TAVI Agent","angiogram-pci":"Angiogram/PCI Agent","quick-letter":"Quick Letter Agent",consultation:"Consultation Agent","investigation-summary":"Investigation Summary Agent",background:"Background Agent",medication:"Medication Agent",mteer:"MTEER Agent",tteer:"TTEER Agent","pfo-closure":"PFO Closure Agent","asd-closure":"ASD Closure Agent","right-heart-cath":"RHC Agent","pvl-plug":"PVL Plug Agent","bypass-graft":"Bypass Graft Agent","tavi-workup":"TAVI Workup Agent",enhancement:"Enhancement Agent",transcription:"Transcription Agent",generation:"Generation Agent","ai-medical-review":"AI Medical Review"},Ur=({status:n,currentAgent:e,onCompleteRecording:a,onCancelProcessing:i,isRecording:r=!1,modelStatus:s,onRefreshServices:o,onWorkflowSelect:l,activeWorkflow:c,voiceActivityLevel:u=0,recordingTime:f=0,isExtractingPatients:h=!1,patientSessions:m=[],onRemoveSession:b,onClearAllSessions:g,onSessionSelect:x,onShowMetrics:w,onNewRecording:I,showNewRecording:R=!1})=>{const D=Lr[n],v=h?Ge:D.icon,[y,S]=d.useState(!1),[C,T]=d.useState(!1),[M,k]=d.useState(null),[j,A]=d.useState(!1),[P,_]=d.useState(!1),z=d.useRef(null),{triggerRef:Q,position:G}=$a({isOpen:y,alignment:"right",offset:{x:0,y:8},maxHeight:400});oe.useEffect(()=>{const te=Y=>{Y.key==="Escape"&&y&&S(!1)};if(y)return document.addEventListener("keydown",te),()=>document.removeEventListener("keydown",te)},[y]),d.useEffect(()=>{const te=()=>{try{const Te=_i.getPhase4PerformanceStats();k(Te)}catch(Te){console.warn("Phase 4 stats not available:",Te),k(null)}};te();const Y=setInterval(te,3e4);return()=>clearInterval(Y)},[]);const J=()=>h?"Extracting patient data from EMR...":n==="processing"&&e?e==="ai-medical-review"?"Analyzing clinical data against Australian guidelines...":`${zr[e]||e.toUpperCase()} is analyzing your input...`:D.description,H=()=>({idle:0,recording:20,transcribing:40,classifying:60,processing:80,enhancing:90,complete:100,error:0,cancelled:0,cancelling:0})[n],K=async()=>{T(!0);const te=Ve.getInstance();try{await o();const Y=s.isConnected,Te=s.whisperServer?.running||!1;Y&&Te?te.success("Services Status","All AI services are running normally"):Y||Te?te.warning("Partial Service Status",`${Y?"LMStudio connected":"LMStudio offline"}, ${Te?"Whisper running":"Whisper stopped"}`):te.error("Services Offline","Both LMStudio and Whisper server are offline")}catch(Y){te.error("Status Check Failed",Y instanceof Error?Y.message:"Failed to check service status")}finally{T(!1)}},Ne=te=>te===0?"N/A":te<1e3?`${te}ms`:`${(te/1e3).toFixed(1)}s`,be=()=>{if(!s.lastPing)return"Never";const Y=Date.now()-s.lastPing;return Y<6e4?"Just now":Y<36e5?`${Math.floor(Y/6e4)}m ago`:`${Math.floor(Y/36e5)}h ago`};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`w-full h-16 ${D.bgColor} border-b border-white/20 px-4 py-3`,children:[t.jsxs("div",{className:"flex items-center justify-between h-full",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Fa,{onWorkflowSelect:l,activeWorkflow:c,isRecording:r,disabled:!1,voiceActivityLevel:u,recordingTime:f,whisperServerRunning:s.whisperServer?.running})}),t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx(v,{className:`w-5 h-5 ${D.color} ${D.animate||h?"motion-safe:animate-spin":""}`}),D.animate&&t.jsx("div",{className:`absolute inset-0 rounded-full border-2 ${D.color.replace("text-","border-")} motion-safe:animate-ping opacity-30`})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"flex items-center space-x-2",children:t.jsx("h3",{className:`font-medium text-sm ${D.color}`,children:r?"Ready":D.label})}),t.jsx("p",{className:"text-ink-secondary text-xs mt-0.5 truncate",children:J()}),n==="idle"&&!r&&t.jsx("div",{className:"mt-1",children:t.jsx(Fr,{disabled:!1})})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Dr,{isCompact:!0,className:"mx-2"})}),(n==="transcribing"||n==="processing"||n==="cancelling")&&i&&t.jsx("div",{className:"flex-shrink-0 ml-2",children:t.jsxs("button",{onClick:i,disabled:n==="cancelling",className:`px-2 py-1 text-xs font-medium rounded-md transition-all duration-200 flex items-center space-x-1 ${n==="cancelling"?"bg-orange-500/10 border border-orange-300 text-orange-600 cursor-not-allowed":"bg-red-500/10 border border-red-300 text-red-600 hover:bg-red-500/20 hover:border-red-400"}`,title:n==="transcribing"?"Cancel audio transcription":"Cancel AI report generation",children:[n==="cancelling"?t.jsx(Ge,{className:"w-3 h-3 animate-spin"}):t.jsx(Ie,{className:"w-3 h-3"}),t.jsx("span",{children:n==="cancelling"?"Cancelling...":"Cancel"})]})})]}),t.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[!r&&t.jsx("div",{className:"text-xs text-ink-secondary hidden md:block",children:Ne(s.latency)}),R&&I&&t.jsx("button",{onClick:I,disabled:r||["recording","transcribing","processing","enhancing","cancelling"].includes(n),className:`bg-white border border-gray-200 transition-all duration-200 ease-out rounded-lg p-2 ${r||["recording","transcribing","processing","enhancing","cancelling"].includes(n)?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 hover:border-gray-300 cursor-pointer"}`,title:"Clear previous recording and start fresh",children:t.jsx(yi,{className:`w-4 h-4 ${r||["recording","transcribing","processing","enhancing","cancelling"].includes(n)?"text-ink-secondary":"text-green-600"}`})}),m.length>0&&t.jsxs("div",{className:"relative",children:[t.jsxs("button",{ref:z,onClick:()=>{console.time("ðŸ”” Notification Bell Click Performance");const te=performance.now();console.log("ðŸ”” Bell clicked, opening sessions dropdown...",{sessionCount:m.length,timestamp:Date.now()}),_(!0),A(!j),setTimeout(()=>{_(!1);const Y=performance.now();console.timeEnd("ðŸ”” Notification Bell Click Performance"),console.log("ðŸ”” Bell opening completed",{duration:`${(Y-te).toFixed(2)}ms`,sessionCount:m.length})},180)},className:`bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded-lg p-2 relative ${r?"scale-90":""}`,title:`${m.length} recent session${m.length!==1?"s":""}`,"data-dropdown-trigger":!0,children:[t.jsx(wi,{className:"w-4 h-4 text-accent-violet"}),P&&t.jsx("span",{className:"absolute -top-1 -left-1",children:t.jsx(Ge,{className:"w-3 h-3 text-accent-violet animate-spin"})}),t.jsx("div",{className:`absolute -top-1 -right-1 bg-red-500 rounded-full flex items-center justify-center border-2 border-white ${r?"w-4 h-4":"w-5 h-5"}`,children:t.jsx("span",{className:"font-bold text-surface-primary leading-none text-xs",children:m.length>9?"9+":m.length})})]}),t.jsx(La,{sessions:m,onRemoveSession:b||(()=>{}),onClearAllSessions:g||(()=>{}),onSessionSelect:x,isOpen:j,onClose:()=>A(!1),triggerRef:z})]}),t.jsx("button",{ref:Q,"data-dropdown-trigger":!0,onClick:()=>S(!y),className:"inline-flex items-center justify-center w-11 h-11 rounded focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500","aria-label":"Settings quick view",title:"Settings Quick View",children:t.jsx(sn,{className:"w-5 h-5 text-ink-secondary"})})]})]}),n!=="idle"&&n!=="error"&&t.jsx("div",{className:"mt-1",children:t.jsx("div",{className:"w-full bg-white/10 rounded-full h-1",children:t.jsx("div",{className:`h-1 rounded-full transition-all duration-500 ease-out ${D.color.replace("text-","bg-")}`,style:{width:`${H()}%`}})})})]}),t.jsx(Pn,{isOpen:y,onClickOutside:()=>S(!1),children:t.jsx("div",{"data-dropdown-menu":!0,className:"glass rounded-lg border border-white/20 p-4",style:{position:"fixed",top:G.top,left:G.left,right:G.right,maxHeight:G.maxHeight,width:320,zIndex:9999},children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"text-ink-primary font-medium text-sm flex items-center space-x-2",children:[t.jsx(sn,{className:"w-4 h-4"}),t.jsx("span",{children:"Settings Quick View"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:K,disabled:C,className:"bg-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 transition-all duration-200 ease-out rounded p-1.5",title:"Refresh all services",children:t.jsx(nn,{className:`w-3 h-3 text-accent-violet ${C?"motion-safe:animate-spin":""}`})}),t.jsx("button",{onClick:()=>S(!1),className:"bg-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 transition-all duration-200 ease-out rounded p-1.5",title:"Close",children:t.jsx(Ie,{className:"w-3 h-3 text-ink-secondary"})})]})]}),t.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ji,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"Phase 4 Intelligence"})]}),t.jsx("div",{className:"text-xs text-ink-secondary",children:M?"Active":"Loading..."})]}),M?t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Agent Cache:"}),t.jsxs("span",{className:"text-ink-primary ml-1",children:[Math.round((M.agentLoader?.cacheHitRate||0)*100),"%"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Avg Load:"}),t.jsx("span",{className:"text-ink-primary ml-1",children:(M.agentLoader?.averageLoadTime||0)>0?`${Math.round(M.agentLoader.averageLoadTime)}ms`:"â€”"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Cross-Agent:"}),t.jsx("span",{className:"text-ink-primary ml-1",children:M.crossAgentIntelligence?.globalInsights||"Learning"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Profiles:"}),t.jsx("span",{className:"text-ink-primary ml-1",children:M.crossAgentIntelligence?.activeProfiles||"â€”"})]})]}):t.jsx("div",{className:"text-xs text-ink-tertiary",children:"Gathering performance metricsâ€¦"})]}),t.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ki,{className:"w-4 h-4 text-ink-primary"}),t.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"LMStudio"})]}),t.jsxs("div",{className:`flex items-center space-x-1 ${s.isConnected?"text-accent-emerald":"text-accent-red"}`,children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${s.isConnected?"bg-accent-emerald":"bg-accent-red"}`}),t.jsx("span",{className:"text-xs",children:s.isConnected?"Connected":"Offline"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Latency:"}),t.jsx("span",{className:"text-ink-primary font-mono ml-1",children:Ne(s.latency)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Last Check:"}),t.jsx("span",{className:"text-ink-secondary ml-1",children:be()})]})]})]}),t.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Xe,{className:"w-4 h-4 text-ink-primary"}),t.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"Whisper Server"})]}),t.jsxs("div",{className:`flex items-center space-x-1 ${s.whisperServer?.running?"text-accent-emerald":"text-accent-red"}`,children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${s.whisperServer?.running?"bg-accent-emerald":"bg-accent-red"}`}),t.jsx("span",{className:"text-xs",children:s.whisperServer?.running?"Running":"Stopped"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Port:"}),t.jsx("span",{className:"text-ink-primary font-mono ml-1",children:s.whisperServer?.port||"8001"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-ink-secondary",children:"Model:"}),t.jsx("span",{className:"text-ink-secondary ml-1 truncate",children:s.whisperServer?.model||"whisper-large-v3-turbo"})]})]}),!s.whisperServer?.running&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded p-2",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(bt,{className:"w-3 h-3 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-amber-800 text-xs font-medium",children:s.whisperServer?.error?.includes("timeout")?"Server Starting Up":"Manual Start Required"}),t.jsx("p",{className:"text-amber-700 text-xs mt-1 leading-relaxed",children:s.whisperServer?.error?.includes("timeout")?t.jsx(t.Fragment,{children:'Server may be initializing. Use "Refresh All Services" button above to check again.'}):t.jsxs(t.Fragment,{children:["Run in terminal: ",t.jsx("code",{className:"bg-amber-100 px-1 rounded",children:"./start-whisper-server.sh"})]})})]})]})}),s.whisperServer?.error&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(bt,{className:"w-3 h-3 text-red-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-red-800 text-xs font-medium",children:"Connection Error"}),t.jsx("p",{className:"text-red-700 text-xs mt-1 leading-relaxed",children:s.whisperServer.error})]})]})})]}),!s.isConnected&&t.jsx("div",{className:"border-t border-gray-200 pt-3",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(bt,{className:"w-4 h-4 text-yellow-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-yellow-400 text-xs font-medium",children:"LMStudio Disconnected"}),t.jsxs("div",{className:"text-gray-500 text-xs mt-1 leading-relaxed space-y-1",children:[t.jsx("p",{children:"To fix this:"}),t.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 ml-1",children:[t.jsx("li",{children:"Open LMStudio application"}),t.jsx("li",{children:"Load MedGemma-27b MLX model"}),t.jsx("li",{children:"Start server on localhost:1234"})]})]})]})]})}),w&&t.jsx("div",{className:"border-t border-gray-200 pt-3",children:t.jsxs("button",{onClick:w,className:"w-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded p-2 flex items-center justify-center space-x-2",children:[t.jsx(Xt,{className:"w-3 h-3 text-accent-violet"}),t.jsx("span",{className:"text-ink-primary text-xs",children:"Performance Metrics"})]})}),t.jsx("div",{className:"border-t border-gray-200 pt-3",children:t.jsxs("button",{onClick:()=>{chrome?.runtime?.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("src/options/index.html"),"_blank")},className:"w-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded p-2 flex items-center justify-center space-x-2",title:"Open settings page in new tab",children:[t.jsx(sn,{className:"w-3 h-3 text-ink-secondary"}),t.jsx("span",{className:"text-ink-primary text-xs",children:"Open Full Settings"})]})})]})})})]})},qr=({type:n})=>{const e={className:"w-4 h-4 flex-shrink-0"};switch(n){case"success":return t.jsx(jt,{...e,className:"w-4 h-4 text-emerald-600 flex-shrink-0"});case"error":return t.jsx(_t,{...e,className:"w-4 h-4 text-red-600 flex-shrink-0"});case"warning":return t.jsx(bt,{...e,className:"w-4 h-4 text-amber-600 flex-shrink-0"});case"info":return t.jsx(Qt,{...e,className:"w-4 h-4 text-blue-600 flex-shrink-0"});default:return t.jsx(Qt,{...e})}},Br=({toast:n,onRemove:e})=>{const a=()=>{const i="bg-white border rounded-lg p-3 shadow-lg backdrop-blur-sm";switch(n.type){case"success":return`${i} border-emerald-200 bg-emerald-50/95`;case"error":return`${i} border-red-200 bg-red-50/95`;case"warning":return`${i} border-amber-200 bg-amber-50/95`;case"info":return`${i} border-blue-200 bg-blue-50/95`;default:return`${i} border-gray-200 bg-gray-50/95`}};return t.jsx("div",{className:`${a()} animate-in slide-in-from-right-full duration-300`,children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(qr,{type:n.type}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-gray-900 font-semibold text-sm leading-tight",children:n.title}),n.message&&t.jsx("p",{className:"text-gray-700 text-xs mt-1.5 leading-relaxed",children:n.message})]}),t.jsx("button",{onClick:()=>e(n.id),className:"flex-shrink-0 bg-transparent text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 ease-out rounded-md p-1",title:"Dismiss notification","aria-label":"Dismiss notification",children:t.jsx(Ie,{className:"w-3.5 h-3.5"})})]})})},Hr=()=>{const[n,e]=d.useState([]);d.useEffect(()=>Ve.getInstance().subscribe(e),[]);const a=i=>{Ve.getInstance().remove(i)};return n.length===0?null:t.jsx("div",{className:"fixed top-4 right-4 z-[99999] space-y-2 w-80 max-w-[calc(100vw-2rem)] pointer-events-none","aria-live":"polite",role:"status",style:{maxWidth:"min(20rem, calc(100vw - 2rem))",position:"fixed",top:"1rem",right:"1rem"},children:n.map(i=>t.jsx("div",{className:"pointer-events-auto",children:t.jsx(Br,{toast:i,onRemove:a})},i.id))})},Wr=({isOpen:n,onClose:e,onStartReview:a,calendarData:i,isExtracting:r=!1,extractError:s})=>{const[o,l]=d.useState(new Set),[c,u]=d.useState("all"),[f,h]=d.useState(!1);if(d.useEffect(()=>{n&&i&&(l(new Set),u("all"))},[n,i]),!n)return null;const m=v=>{const y=new Set(o);y.has(v)?y.delete(v):y.add(v),l(y)},b=()=>{if(!i)return;const v=g(),y=v.every(C=>o.has(C.fileNumber)),S=new Set(o);v.forEach(C=>{y?S.delete(C.fileNumber):S.add(C.fileNumber)}),l(S)},g=()=>i?i.patients.filter(v=>{switch(c){case"confirmed":return v.confirmed;case"new":return v.isFirstAppointment;case"routine":return!v.isFirstAppointment;default:return!0}}):[],x=async()=>{if(!i||o.size===0)return;h(!0);const v=i.patients.filter(y=>o.has(y.fileNumber));try{await a(v)}catch(y){console.error("Failed to start batch review:",y)}finally{h(!1)}},w=v=>{switch(v.toLowerCase()){case"canew":return"bg-blue-100 text-blue-800";case"car20":case"carvi":return"bg-green-100 text-green-800";case"canvi":return"bg-purple-100 text-purple-800";case"phone":return"bg-gray-100 text-gray-800";case"unav":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},I=g(),R=o.size,D=Math.ceil(R*2.5);return t.jsx(Ae,{children:t.jsx(B.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",variants:pe(ka),initial:"hidden",animate:"visible",exit:"exit",onClick:e,children:t.jsxs(B.div,{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden mx-4",variants:pe(ja),initial:"hidden",animate:"visible",exit:"exit",onClick:v=>v.stopPropagation(),children:[t.jsxs(B.div,{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",variants:pe(It),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(ot,{className:"w-6 h-6 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Batch AI Medical Review"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Select patients for sequential AI review and analysis"})]})]}),t.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:f,children:t.jsx(Ie,{className:"w-5 h-5 text-gray-500"})})]}),i&&t.jsxs("div",{className:"mt-4 flex items-center space-x-6 text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gt,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"font-medium",children:i.appointmentDate})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ot,{className:"w-4 h-4 text-purple-600"}),t.jsxs("span",{children:[i.totalCount," total appointments"]})]})]})]}),t.jsx(B.div,{className:"flex-1 overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:r?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Ge,{className:"w-8 h-8 text-purple-600 animate-spin mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extracting Patient Data"}),t.jsx("p",{className:"text-gray-600",children:"Reading appointment information from calendar..."})]})}):s?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(bt,{className:"w-8 h-8 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extraction Failed"}),t.jsx("p",{className:"text-red-600 mb-4",children:s}),t.jsx("p",{className:"text-sm text-gray-600",children:"Please ensure you're on the appointment book page and try again."})]})}):!i||i.patients.length===0?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(ot,{className:"w-8 h-8 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Patients Found"}),t.jsx("p",{className:"text-gray-600",children:"No appointments with patient data were found on this calendar page."})]})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(Ni,{className:"w-4 h-4 text-gray-500"}),t.jsxs("select",{value:c,onChange:v=>u(v.target.value),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm",disabled:f,children:[t.jsxs("option",{value:"all",children:["All Appointments (",i.patients.length,")"]}),t.jsxs("option",{value:"confirmed",children:["Confirmed Only (",i.patients.filter(v=>v.confirmed).length,")"]}),t.jsxs("option",{value:"new",children:["New Patients (",i.patients.filter(v=>v.isFirstAppointment).length,")"]}),t.jsxs("option",{value:"routine",children:["Return Visits (",i.patients.filter(v=>!v.isFirstAppointment).length,")"]})]})]}),t.jsx("button",{onClick:b,className:"text-sm text-purple-600 hover:text-purple-700 font-medium",disabled:f,children:I.every(v=>o.has(v.fileNumber))?"Deselect All":"Select All"})]})}),t.jsx("div",{className:"overflow-y-auto max-h-96 p-6",children:t.jsx("div",{className:"space-y-3",children:I.map(v=>t.jsx("div",{className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${o.has(v.fileNumber)?"border-purple-300 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>m(v.fileNumber),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("input",{type:"checkbox",checked:o.has(v.fileNumber),onChange:()=>m(v.fileNumber),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500",disabled:f}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:v.name}),v.isFirstAppointment&&t.jsx(Si,{className:"w-4 h-4 text-yellow-500"})]}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mt-1",children:[t.jsxs("span",{children:["DOB: ",v.dob]}),t.jsxs("span",{children:["File: ",v.fileNumber]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Qe,{className:"w-3 h-3"}),t.jsx("span",{children:v.appointmentTime})]})]}),v.notes&&t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:v.notes})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${w(v.appointmentType)}`,children:v.appointmentType}),v.confirmed&&t.jsx(jt,{className:"w-4 h-4 text-green-500"})]})]})},v.fileNumber))})})]})}),i&&i.patients.length>0&&!r&&!s&&t.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:R})," patient",R!==1?"s":""," selected",R>0&&t.jsxs("span",{className:"ml-2",children:["â€¢ Estimated time: ",t.jsxs("span",{className:"font-medium",children:[D," minutes"]})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:f,children:"Cancel"}),t.jsx("button",{onClick:x,disabled:R===0||f,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:f?t.jsxs(t.Fragment,{children:[t.jsx(Ge,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:"Starting..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(ca,{className:"w-4 h-4"}),t.jsx("span",{children:"Start AI Review"})]})})]})]})})]})})})},Vr=({onGenerate:n,isGenerating:e,isVisible:a,onClose:i,emrExtractionError:r,onRetryExtraction:s})=>{const[o,l]=d.useState("medium"),[c,u]=d.useState(["diet_nutrition","physical_activity"]),[f,h]=d.useState({}),[m,b]=d.useState(""),[g,x]=d.useState(!1),[w,I]=d.useState(null),[R,D]=d.useState(null),[v,y]=d.useState(!1);d.useEffect(()=>{a&&(async()=>{if(!(R||v)){y(!0);try{const{PatientEducationAgent:_}=await ke(async()=>{const{PatientEducationAgent:z}=await import("./chunks/PatientEducationAgent.C-Yxs4I4.js");return{PatientEducationAgent:z}},__vite__mapDeps([9,5,6]));D({getPriorityOptions:_.getPriorityOptions.bind(_),getAvailableModules:_.getAvailableModules.bind(_)})}catch(_){console.error("Failed to load PatientEducationAgent:",_)}finally{y(!1)}}})()},[a,R,v]);const S=R?.getPriorityOptions()||[],C=R?.getAvailableModules()||[],T=d.useCallback(P=>{u(_=>_.includes(P)?(h(z=>{const Q={...z};return delete Q[P],Q}),_.filter(z=>z!==P)):[..._,P])},[]),M=d.useCallback((P,_)=>{h(z=>{const Q=z[P]||[];if(Q.includes(_)){const G=Q.filter(J=>J!==_);if(G.length===0){const J={...z};return delete J[P],J}return{...z,[P]:G}}else return{...z,[P]:[...Q,_]}})},[]),k=d.useCallback(async()=>{if(c.length!==0){x(!0);try{const P=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),_=await chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA",fields:["background","medications","investigations"]}),z={demographics:"",background:_?.background||"",medications:_?.medications||"",investigations:_?.investigations||""},Q=P?.success&&P?.data?P.data:null;console.log("ðŸŽ“ Extracted patient data:",Q),console.log("ðŸŽ“ Extracted EMR data for Patient Education:",z),I(z);const G={patientPriority:o,selectedModules:c,selectedSubFocus:Object.keys(f).length>0?f:void 0,emrData:z,patientData:Q,patientContext:m.trim()||void 0};await n(G)}catch(P){console.warn("âš ï¸ EMR extraction failed, proceeding with user context only:",P);const _={demographics:"",background:"",medications:"",investigations:""},z={patientPriority:o,selectedModules:c,selectedSubFocus:Object.keys(f).length>0?f:void 0,emrData:_,patientData:null,patientContext:m.trim()||void 0};await n(z)}finally{x(!1)}}},[o,c,f,m,n]),j=d.useCallback(async()=>{if(s){x(!0);try{await s()}finally{x(!1)}}},[s]);if(!a)return null;if(v||!R)return t.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vt,{className:"w-4 h-4"}),t.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),t.jsx("button",{onClick:i,className:"text-emerald-100 hover:text-white transition-colors",children:t.jsx(Ie,{className:"w-4 h-4"})})]})}),t.jsx("div",{className:"p-8 flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(on,{className:"w-5 h-5 animate-spin text-emerald-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading education modules..."})]})})]});const A=P=>{const _=c.includes(P.id),z=f[P.id]||[];return t.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-start space-x-3 p-3 hover:border-blue-300 transition-colors",children:[t.jsx("button",{onClick:()=>T(P.id),className:"flex-shrink-0 mt-0.5",disabled:e||g,children:_?t.jsx(xt,{className:"w-5 h-5 text-blue-600"}):t.jsx(Dn,{className:"w-5 h-5 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`font-medium text-sm ${_?"text-blue-900":"text-gray-700"}`,children:P.label}),t.jsxs("div",{className:"group relative inline-block",title:P.tooltip,children:[t.jsx(Qt,{className:"w-4 h-4 text-gray-400 hover:text-blue-600 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:P.tooltip})]})]}),t.jsx("p",{className:"text-xs text-gray-600 mt-1",children:P.description})]})]}),_&&P.subFocusPoints&&P.subFocusPoints.length>0&&t.jsxs("div",{className:"border-t border-gray-100 bg-gray-50 p-3 space-y-2",children:[t.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Focus on specific areas (optional):"}),P.subFocusPoints.map(Q=>{const G=z.includes(Q.id);return t.jsxs("div",{className:"flex items-start space-x-2 ml-2",children:[t.jsx("button",{onClick:()=>M(P.id,Q.id),className:"flex-shrink-0 mt-0.5",disabled:e||g,children:G?t.jsx(xt,{className:"w-4 h-4 text-emerald-600"}):t.jsx(Dn,{className:"w-4 h-4 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("span",{className:`text-xs ${G?"text-emerald-800 font-medium":"text-gray-600"}`,children:Q.label}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:Q.description})]})]},Q.id)})]})]},P.id)};return t.jsx("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:t.jsxs("div",{className:"bg-white w-full overflow-hidden rounded-xl",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vt,{className:"w-4 h-4"}),t.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),t.jsx("button",{onClick:i,className:"text-emerald-100 hover:text-white transition-colors",disabled:e||g,children:t.jsx(Ie,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"p-4 overflow-y-auto max-h-full",children:[r&&t.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(_t,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"EMR Extraction Issue"}),t.jsx("p",{className:"text-xs text-amber-700 mt-1",children:r}),s&&t.jsx("button",{onClick:j,disabled:g,className:"mt-2 px-3 py-1 bg-amber-100 hover:bg-amber-200 text-amber-800 text-xs rounded-md font-medium transition-colors disabled:opacity-50",children:g?t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(on,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:"Retrying..."})]}):t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(nn,{className:"w-3 h-3"}),t.jsx("span",{children:"Retry Extraction"})]})})]})]})}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Priority Level"}),t.jsx("div",{className:"space-y-2",children:S.map(P=>t.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"priority",value:P.value,checked:o===P.value,onChange:_=>l(_.target.value),className:"mt-1 text-emerald-600 focus:ring-emerald-500",disabled:e||g}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:P.label}),t.jsx("p",{className:"text-xs text-gray-600",children:P.description})]})]},P.value))})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Specific Priorities & Goals"}),t.jsx("textarea",{value:m,onChange:P=>b(P.target.value),placeholder:"Enter specific patient priorities and goals (e.g., lose weight, stop smoking, improve fitness, reduce blood pressure, manage diabetes)...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none text-sm",rows:3,disabled:e||g}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Optional: Describe what's most important for this patient to help personalize the lifestyle advice."})]}),w&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Extracted Patient Information"}),t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-2",children:[w.background&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Background:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:w.background})]}),w.medications&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Medications:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:w.medications})]}),w.investigations&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Recent Investigations:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:w.investigations})]}),!w.background&&!w.medications&&!w.investigations&&t.jsx("p",{className:"text-xs text-gray-500 italic",children:"No patient data found in EMR fields"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This information will be used to personalize the lifestyle advice."})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Select Lifestyle Areas (Choose at least 1)"}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:C.map(A)}),c.length===0&&t.jsx("p",{className:"text-xs text-red-600 mt-2",children:"Please select at least one lifestyle area"})]}),t.jsx("div",{className:"mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Qt,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-xs text-blue-800",children:[t.jsx("p",{className:"font-medium",children:"Education Only"}),t.jsx("p",{className:"mt-1",children:"This tool provides lifestyle education and general wellness advice only. It does not diagnose conditions or recommend medication changes."})]})]})}),t.jsx("div",{className:"flex justify-end border-t border-gray-200 pt-4 mt-6",children:t.jsx("button",{onClick:k,disabled:e||g||c.length===0,className:"px-8 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 shadow-lg",children:e||g?t.jsxs(t.Fragment,{children:[t.jsx(on,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:g?"Extracting Data...":"Generating Advice..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(Vt,{className:"w-4 h-4"}),t.jsx("span",{children:"Generate Lifestyle Advice"})]})})}),(e||g)&&t.jsxs("div",{className:"mt-4 text-center",children:[t.jsx("div",{className:"text-xs text-gray-600",children:g?"Extracting patient data from EMR...":"Generating personalized lifestyle advice..."}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:t.jsx("div",{className:"bg-emerald-600 h-2 rounded-full animate-pulse",style:{width:"60%"}})})]})]})]})})},gn=[{name:"background",displayName:"Background History",icon:Ot},{name:"investigations",displayName:"Investigation Results",icon:Ye},{name:"medications-problemlist",displayName:"Medications & Problems",icon:En}],Gr=({isActive:n,onComplete:e,className:a=""})=>{const[i,r]=d.useState([]),[s,o]=d.useState("Initializing..."),[l,c]=d.useState(0);d.useEffect(()=>{if(n){const w=gn.map(I=>({...I,status:"discovering",timestamp:Date.now()}));r(w),o("Discovering EMR fields..."),c(10),u()}else r([]),o(""),c(0)},[n]);const u=async()=>{o("Locating EMR sections..."),await f("extracting",200,10,25),o("Extracting Background section..."),await h(0,"complete",300,35),o("Extracting Investigations section..."),await h(1,"complete",400,55),o("Extracting Medications section..."),await h(2,"complete",350,75),o("Validating extracted data..."),c(85),await m(600),o("Preparing data for AI analysis..."),c(95),await m(500),c(100),o("Complete! Starting AI medical review..."),setTimeout(()=>{e()},1e3)},f=async(w,I,R,D)=>{const v=(D-R)/gn.length;for(let y=0;y<gn.length;y++)await m(I),r(S=>S.map((C,T)=>T===y?{...C,status:w,timestamp:Date.now()}:C)),c(R+v*(y+1))},h=async(w,I,R,D)=>{await m(R),r(v=>v.map((y,S)=>S===w?{...y,status:I,timestamp:Date.now()}:y)),c(D)},m=w=>new Promise(I=>setTimeout(I,w)),b=w=>{switch(w){case"discovering":return t.jsx(Ye,{className:"w-4 h-4 text-blue-500 animate-pulse"});case"extracting":return t.jsx(Ge,{className:"w-4 h-4 text-amber-500 animate-spin"});case"complete":return t.jsx(jt,{className:"w-4 h-4 text-green-500"});case"not-found":case"error":return t.jsx(Ci,{className:"w-4 h-4 text-red-500"});default:return t.jsx(Ye,{className:"w-4 h-4 text-gray-400"})}},g=w=>{switch(w){case"discovering":return"Scanning...";case"extracting":return"Extracting...";case"complete":return"Complete";case"not-found":return"Not found";case"error":return"Error";default:return"Pending"}},x=w=>{switch(w){case"discovering":return"border-blue-200 bg-blue-50";case"extracting":return"border-amber-200 bg-amber-50";case"complete":return"border-green-200 bg-green-50";case"not-found":case"error":return"border-red-200 bg-red-50";default:return"border-gray-200 bg-gray-50"}};return n?t.jsx("div",{className:`absolute inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"field-ingestion-title","aria-describedby":"field-ingestion-description",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 m-4 max-w-md w-full motion-safe:animate-in motion-safe:fade-in motion-safe:slide-in-from-bottom-4 motion-reduce:transition-none",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3",children:t.jsx(Ye,{className:"w-6 h-6 text-indigo-600"})}),t.jsx("h3",{id:"field-ingestion-title",className:"text-lg font-semibold text-gray-900 mb-2",children:"AI Medical Review"}),t.jsx("p",{id:"field-ingestion-description",className:"text-sm text-gray-600",children:"Analyzing EMR data for clinical insights"})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),t.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(l),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",role:"progressbar","aria-valuenow":l,"aria-valuemin":0,"aria-valuemax":100,children:t.jsx("div",{className:"bg-indigo-600 h-2 rounded-full motion-safe:transition-all motion-safe:duration-500 motion-safe:ease-out motion-reduce:transition-none",style:{width:`${l}%`}})})]}),t.jsx("div",{className:"space-y-3",children:i.map((w,I)=>t.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg border motion-safe:transition-all motion-safe:duration-300 motion-reduce:transition-none ${x(w.status)}`,role:"status","aria-label":`${w.displayName}: ${g(w.status)}`,children:[t.jsx(w.icon,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:w.displayName}),t.jsxs("div",{className:"flex items-center space-x-2",children:[b(w.status),t.jsx("span",{className:"text-xs text-gray-600",children:g(w.status)})]})]})})]},w.name))}),t.jsx("div",{className:"mt-6 text-center",children:t.jsx("p",{className:"text-xs text-gray-500",children:"Processing EMR data locally with MedGemma-27b"})})]})}):null},Bt=[{id:"extraction",label:"Field Extraction",description:"Discovering and extracting EMR field content",icon:Ye,progressRange:[0,30]},{id:"analysis",label:"AI Analysis",description:"Processing data with MedGemma-27b model",icon:lt,progressRange:[30,90]},{id:"generation",label:"Advisory Generation",description:"Creating clinical advisory cards",icon:Ti,progressRange:[90,100]}],Xr=({currentProgress:n,isActive:e,className:a="",startTime:i=Date.now(),agentType:r,transcriptionLength:s,showTimeEstimate:o=!0,onProcessingComplete:l,streaming:c=!1,tokenCount:u})=>{const[f,h]=d.useState(""),[m,b]=d.useState(new Set),[g,x]=d.useState(0),[w,I]=d.useState(null),[R]=d.useState(()=>it.getInstance());d.useEffect(()=>{let k;return e?k=window.setInterval(()=>{x(Date.now()-i)},100):x(0),()=>{k&&clearInterval(k)}},[e,i]),d.useEffect(()=>{if(!e){h(""),b(new Set);return}const k=Bt.find(j=>n>=j.progressRange[0]&&n<=j.progressRange[1]);if(k){h(k.id);const j=new Set;Bt.forEach(A=>{A.progressRange[1]<=n&&j.add(A.id)}),b(j)}},[n,e]),d.useEffect(()=>{if(e&&r&&s&&o&&!w)try{const k=R.predictProcessingTime(r,s,{includeTranscriptionTime:!1});I(k),console.log(`ðŸ“Š Time prediction for ${r}:`,k.displayText)}catch(k){console.warn("Failed to generate time prediction:",k)}else if(!e){if(w&&n>=100&&l){const k=g;if(l(k),r&&s){R.recordActualProcessingTime(r,s,k);const j=R.updatePredictionAccuracy(w,k);console.log(`ðŸŽ¯ Prediction accuracy: ${Math.round(j.accuracy*100)}%`)}}I(null)}},[e,r,s,o,w,n,g,l,R]);const D=k=>{const j=Math.floor(k/1e3);if(j<60)return`${j}s`;{const A=Math.floor(j/60),P=j%60;return`${A}m ${P.toString().padStart(2,"0")}s`}},v=k=>m.has(k.id)?"completed":f===k.id?"active":"pending",y=k=>{const[j,A]=k.progressRange;return n<=j?0:n>=A?100:(n-j)/(A-j)*100},S=k=>{switch(k){case"completed":return"text-green-600 bg-green-100 border-green-200";case"active":return"text-indigo-600 bg-indigo-100 border-indigo-200";default:return"text-gray-400 bg-gray-50 border-gray-200"}},C=(k,j)=>{if(j==="completed")return t.jsx(jt,{className:"w-5 h-5 text-green-600"});const A=k.icon,P=j==="active"?"w-5 h-5 text-indigo-600":"w-5 h-5 text-gray-400";return t.jsx(A,{className:P})},T=()=>{if(!w||n>=100)return{timeMs:0,isEstimate:!1};const k=(100-n)/100,j=w.estimatedDurationMs*k,A=w.estimatedDurationMs*(n/100),P=g/Math.max(A,100),_=j*P;return{timeMs:Math.max(0,_),isEstimate:!0}},M=k=>{const j=Math.ceil(k/1e3);if(j<60)return`~${j}s left`;{const A=Math.floor(j/60),P=j%60;return`~${A}m ${P}s left`}};return e?t.jsxs(B.div,{className:`bg-white rounded-lg border border-gray-200 p-4 ${a}`,role:"status","aria-labelledby":"processing-status-title","aria-describedby":"processing-status-description",initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:St(vt.gentle),children:[t.jsxs(B.div,{className:"flex items-center justify-between mb-4",variants:pe(It),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{id:"processing-status-title",className:"text-sm font-medium text-gray-900",children:r?r.charAt(0).toUpperCase()+r.slice(1).replace("-"," "):"AI Medical Review"}),c&&t.jsxs("span",{className:"ml-2 text-xs px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700",children:["Generating (streamingâ€¦)",typeof u=="number"?` â€¢ ${u}`:""]}),t.jsxs("div",{className:"flex items-center space-x-1 text-indigo-600",children:[t.jsx(Qe,{className:"w-3 h-3"}),t.jsx("span",{className:"text-xs font-mono font-medium","aria-live":"polite",children:D(g)})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[w&&o&&(()=>{const k=T();return k.isEstimate&&k.timeMs>1e3?t.jsxs("div",{className:"flex items-center space-x-1 text-purple-600",children:[t.jsx(ha,{className:"w-3 h-3"}),t.jsx("span",{className:"text-xs font-medium","aria-live":"polite",children:M(k.timeMs)})]}):null})(),t.jsxs("span",{className:"text-xs text-gray-500","aria-live":"polite",children:[Math.round(n),"%"]})]})]}),t.jsx(B.div,{className:"mb-4",initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},transition:{delay:.2,duration:Ee.normal},children:t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Overall processing progress",children:t.jsx(B.div,{className:"bg-indigo-600 h-1.5 rounded-full",initial:{width:0},animate:{width:`${n}%`},transition:St(vt.gentle)})})}),t.jsx(B.div,{className:"space-y-3",variants:pe(Jt),initial:"hidden",animate:"visible",transition:{staggerChildren:Mt.tight,delayChildren:.3},children:Bt.map((k,j)=>{const A=v(k),P=y(k);return t.jsxs(B.div,{className:`relative flex items-start space-x-3 p-3 rounded-lg border ${S(A)}`,role:"listitem","aria-label":`${k.label}: ${A==="completed"?"Complete":A==="active"?"In progress":"Pending"}`,variants:pe(Ct),animate:{scale:A==="active"?[1,1.02,1]:1,borderColor:A==="active"?["rgb(199, 210, 254)","rgb(129, 140, 248)","rgb(199, 210, 254)"]:void 0},transition:{scale:{duration:2,repeat:A==="active"?1/0:0,ease:"easeInOut"},...St(vt.gentle)},children:[t.jsx(B.div,{className:"flex-shrink-0 mt-0.5",animate:{scale:A==="active"?[1,1.1,1]:1,rotate:A==="active"&&k.icon===lt?[0,5,-5,0]:0},transition:{scale:{duration:1.5,repeat:A==="active"?1/0:0,ease:"easeInOut"},rotate:{duration:2,repeat:A==="active"&&k.icon===lt?1/0:0,ease:"easeInOut"}},children:C(k,A)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h5",{className:"text-sm font-medium text-gray-900",children:k.label}),A==="active"&&t.jsxs("span",{className:"text-xs text-indigo-600 font-medium",children:[Math.round(P),"%"]})]}),t.jsx("p",{className:"text-xs text-gray-600 mb-2",children:k.description}),t.jsx(Ae,{children:A==="active"&&t.jsx(B.div,{className:"w-full bg-indigo-200 rounded-full h-1",role:"progressbar","aria-valuenow":P,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`${k.label} progress`,initial:{opacity:0,height:0},animate:{opacity:1,height:4},exit:{opacity:0,height:0},transition:{duration:Ee.quick},children:t.jsx(B.div,{className:"bg-indigo-600 h-1 rounded-full",initial:{width:0},animate:{width:`${P}%`},transition:{type:"spring",damping:25,stiffness:400,mass:.5}})})})]}),j<Bt.length-1&&t.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-4 bg-gray-200"})]},k.id)})}),t.jsx(B.div,{className:"mt-4 pt-3 border-t border-gray-200",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:Ee.quick},children:t.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[t.jsx("p",{className:"text-xs text-gray-500 text-center",children:n>=100?"âœ… Processing complete - clinical advisory ready":"ðŸ”„ Local processing with MedGemma-27b model"}),w&&o&&n<100&&t.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs",children:[t.jsx("span",{className:"text-purple-600 font-medium",children:w.displayText}),w.confidenceLevel==="high"&&t.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:"High confidence"}),w.confidenceLevel==="medium"&&t.jsx("span",{className:"px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded text-xs",children:"Medium confidence"}),w.confidenceLevel==="low"&&t.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded text-xs",children:"Low confidence"})]})]})})]}):null},za=[{id:"tavi",title:"TAVI Procedure Recording",description:"Transcatheter Aortic Valve Implantation - Comprehensive procedural documentation",estimatedTime:"8-12 minutes",sections:[{title:"Preamble Information",icon:"ðŸ“‹",items:["Patient demographics and clinical indication",'Preoperative CT findings: "suitable anatomy for valve implant"',"Valve morphology: tricuspid/bicuspid, calcification burden","Calcium score and LVOT assessment","Transthoracic echo: mean gradient, systolic function","Valve selection rationale with sizing logic"]},{title:"Procedural Details",icon:"âš•ï¸",items:["Anaesthesia approach: local anaesthesia and deep sedation","Vascular access: radial planning, femoral with ultrasound guidance","Pre-closure technique: ProStyle sutures or equivalent","Sheath sizes: specific French sizes (e.g., 16F Cook sheath)","Valve crossing: AL1, straight wire, invasive gradient, LVEDP","Lunderquist wire placement at left ventricular apex","Pre-dilation: balloon size and technique","Valve deployment: positioning at annular plane","Immediate assessment: aortic regurgitation, coronary patency"]},{title:"Outcomes & Assessment",icon:"âœ…",items:["Valve deployment success and positioning","Final aortic regurgitation grade","Post-procedural echo findings","Arteriotomy closure method and success","Overall procedural success statement","Immediate post-procedural valve performance"]}],tips:["Use Australian spelling: anaesthesia, recognised, utilised","Include precise measurements with units (mmHg, cmÂ², French sizes)","Preserve original stenosis terminology (mild/moderate/severe)","Document valve manufacturer and model specifically"],terminology:["Edwards Sapien 3 Ultra/Medtronic Evolut series","Annular perimeter and area, LVOT calcium burden","Well-seated valve, patent coronaries","Partial recaptures for optimal positioning"]},{id:"angiogram-pci",title:"Angiogram/PCI Recording",description:"Cardiac catheterization and coronary interventions - Diagnostic and interventional procedures",estimatedTime:"8-15 minutes",sections:[{title:"Vessel Assessment",icon:"ðŸ«€",items:["Left Main coronary artery findings","LAD: proximal, mid, distal segments and diagonal branches","Circumflex: segments and obtuse marginal branches","RCA: segments including dominance pattern","Coronary dominance (right/left/co-dominant)","Collateral circulation if present"]},{title:"Procedural Information",icon:"ðŸ”§",items:["Vascular access site and approach","Catheter selection and sizes","Target lesion characteristics and location","Intervention strategy and rationale","Device specifications: stent type, manufacturer, size","Balloon pre-dilation details","Deployment technique and positioning"]},{title:"Results & Outcomes",icon:"ðŸ“Š",items:["TIMI flow assessment (pre and post)","Final angiographic result","Residual stenosis percentage","Procedural complications if any","Hemodynamic measurements","Antiplatelet therapy plan"]}],tips:["Preserve stenosis grading as stated by clinician","Use descriptive TIMI flow language","Include specific device details when mentioned","Document both diagnostic and intervention aspects"],terminology:["Drug-eluting stent (DES), bare metal stent (BMS)","TIMI III flow, complete perfusion","Proximal/mid/distal vessel segments","Optimal angiographic result"]},{id:"quick-letter",title:"Quick Letter Recording",description:"Medical correspondence and consultation letters - Professional communication",estimatedTime:"1-3 minutes",sections:[{title:"Patient Presentation",icon:"ðŸ‘¤",items:["Clinical presentation and chief complaint","Relevant history and context","Current symptoms and functional status","Reason for referral or consultation","Timeline of events"]},{title:"Clinical Assessment",icon:"ðŸ”",items:["Investigation findings and interpretation","Clinical examination relevant findings","Diagnostic considerations","Risk stratification if applicable"]},{title:"Management Plan",icon:"ðŸ“",items:["Treatment recommendations","Medication changes or additions","Follow-up arrangements","Specialist referrals if needed","Patient education provided"]}],tips:['Use first-person voice: "I reviewed", "I examined"',"Keep paragraphs flowing and professional","Include specific timeframes and measurements","Use Australian spelling and medical terminology"],terminology:["Clinical assessment, management plan","Follow-up arrangements, specialist review","Patient education, shared decision-making","Routine/semi-urgent/urgent referral"]},{id:"consultation",title:"Consultation Recording",description:"Comprehensive patient assessments - Detailed clinical evaluation",estimatedTime:"2-4 minutes",sections:[{title:"Clinical History",icon:"ðŸ“š",items:["Presenting complaint and history","Past medical history and comorbidities","Current medications and allergies","Family history if relevant","Social history and functional status"]},{title:"Examination & Investigations",icon:"ðŸ”¬",items:["Physical examination findings","Vital signs and measurements","Investigation results and interpretation","Imaging findings if applicable","Laboratory results correlation"]},{title:"Assessment & Plan",icon:"ðŸŽ¯",items:["Clinical impression and differential diagnosis","Risk assessment and stratification","Management strategy and rationale","Investigation plan if needed","Follow-up and monitoring plan"]}],tips:["Capture comprehensive clinical reasoning","Include functional assessment (NYHA class, etc.)","Document shared decision-making process","Note patient understanding and concerns"],terminology:["Clinical impression, differential diagnosis","Risk stratification, management strategy","Functional class, symptom assessment","Patient-centred care, shared decisions"]},{id:"mteer",title:"mTEER Procedure Recording",description:"Mitral transcatheter edge-to-edge repair - Structural heart intervention",estimatedTime:"7-10 minutes",sections:[{title:"Pre-procedural Assessment",icon:"ðŸ”",items:["Mitral regurgitation severity and mechanism","Valve anatomy and morphology","TOE assessment and measurements","Procedural planning and approach","Patient selection criteria"]},{title:"Procedural Technique",icon:"âš™ï¸",items:["Transseptal puncture technique","Device delivery and positioning","Clip deployment and assessment","TOE guidance throughout procedure","Immediate haemodynamic changes"]},{title:"Results & Follow-up",icon:"ðŸ“ˆ",items:["Final mitral regurgitation grade","Mitral valve gradient assessment","Procedural success metrics","Complications if any","Post-procedural monitoring plan including TTE next day"]}],tips:["Document TOE guidance detail","Include specific device information","Note immediate haemodynamic improvement","Record precise regurgitation grading"],terminology:["Edge-to-edge repair, MitraClip device","Functional vs degenerative MR","TOE guidance, transseptal puncture","Immediate haemodynamic improvement"]},{id:"pfo-closure",title:"PFO Closure Recording",description:"Patent foramen ovale closure - Structural heart intervention",estimatedTime:"5-8 minutes",sections:[{title:"Pre-procedural Assessment",icon:"ðŸ”Ž",items:["PFO anatomy and tunnel length","Shunt assessment and grading","Device selection rationale","Imaging findings (TOE/ICE)","Clinical indication for closure"]},{title:"Deployment Technique",icon:"ðŸŽ¯",items:["Device delivery and positioning","Deployment sequence and technique","Position confirmation","Immediate closure assessment","Device stability evaluation"]},{title:"Procedural Outcome",icon:"âœ¨",items:["Successful device deployment","Residual shunt assessment","Device position and stability","Procedural complications if any","Post-procedural monitoring requirements"]}],tips:["Document device sizing rationale","Include immediate closure success","Note any residual shunt","Record device stability assessment"],terminology:["Patent foramen ovale, atrial septal anatomy","Device deployment, positioning confirmation","Residual shunt, complete closure","TOE/ICE guidance, device stability"]},{id:"right-heart-cath",title:"Right Heart Catheterisation",description:"Right heart catheterisation with haemodynamic assessment",estimatedTime:"6-10 minutes",sections:[{title:"Haemodynamic Assessment",icon:"ðŸ“Š",items:["Right atrial pressure measurements","Right ventricular pressures","Pulmonary artery pressures","Pulmonary capillary wedge pressure","Cardiac output and index","Pulmonary vascular resistance","TPG, RVSWI"]},{title:"Technical Details",icon:"ðŸ”§",items:["Vascular access approach","Catheter selection and positioning","Measurement technique and validation","Thermodilution or Fick method","Complications if any"]},{title:"Clinical Interpretation",icon:"ðŸ“‹",items:["Haemodynamic interpretation","Pulmonary hypertension assessment","Heart failure classification","Treatment implications","Follow-up recommendations"]}],tips:["Include precise pressure measurements","Document calculation methods used","Note any technical challenges","Correlate with clinical presentation"],terminology:["Pulmonary vascular resistance, cardiac index","Thermodilution, Fick equation","Pulmonary hypertension, right heart failure","Haemodynamic profile, pressure gradients"]},{id:"investigation-summary",title:"Investigation Summary Recording",description:"Formatting voice-dictated investigation results into structured summaries",estimatedTime:"30-60 seconds",sections:[{title:"Test Information",icon:"ðŸ”¬",items:["Investigation type (TTE, CTCA, Bloods, etc.)","Date of investigation (DD MMM YYYY format)","Location/institution if relevant","Test methodology or approach if specified"]},{title:"Key Findings",icon:"ðŸ“‹",items:["Primary findings and measurements","Normal and abnormal values with units","Qualitative descriptions (mild/moderate/severe)","Relevant anatomical observations","Clinical significance if stated"]},{title:"Measurements & Values",icon:"ðŸ“",items:["Exact numerical values with units","Reference ranges when mentioned","Percentage values (e.g., EF 55%)","Pressure measurements (mmHg)","Laboratory values with proper abbreviations"]}],tips:["Use standard medical abbreviations (TChol, LDL, HDL, etc.)","Include units with all measurements","Preserve qualitative terms exactly as stated","Format as: TEST (date): comma-separated findings"],terminology:["TTE, TOE, CTCA, CMRI, RHC, Bloods","TChol, TG, HDL, LDL, HbA1c, Cr, eGFR","EF%, MPG, PPG, RVSP, TIMI flow","Normal, mild, moderate, severe"]},{id:"background",title:"Background & History Recording",description:"Patient medical background, history, and contextual information",estimatedTime:"1-2 minutes",sections:[{title:"Medical History",icon:"ðŸ¥",items:["Past medical conditions and diagnoses","Previous cardiovascular events or procedures","Chronic conditions and comorbidities","Surgical history relevant to current care","Hospital admissions and major events"]},{title:"Family & Social History",icon:"ðŸ‘¥",items:["Family history of cardiovascular disease","Hereditary conditions or risk factors","Social circumstances affecting care","Functional status and mobility","Support systems and care arrangements"]},{title:"Risk Factors",icon:"âš ï¸",items:["Smoking history (current/former/never)","Alcohol consumption patterns","Exercise tolerance and activity levels","Occupational or environmental exposures","Lifestyle factors affecting health"]}],tips:["Use chronological order for medical events","Include dates and timeframes when mentioned","Note functional impact of conditions","Use arrow notation (â†’) for progression or outcomes"],terminology:["CAD, MI, CABG, PCI, valve disease","DM, HTN, dyslipidaemia, CKD","NYHA class, functional capacity","Family Hx, social circumstances"]},{id:"medication",title:"Medication Recording",description:"Current medications, changes, and pharmaceutical management",estimatedTime:"1-2 minutes",sections:[{title:"Current Medications",icon:"ðŸ’Š",items:["Drug name (generic preferred)","Dosage and strength","Frequency and timing","Route of administration","Duration of therapy if specified"]},{title:"Recent Changes",icon:"ðŸ”„",items:["New medications started","Dose adjustments made","Medications discontinued","Reason for changes","Timing of modifications"]},{title:"Compliance & Effects",icon:"âœ…",items:["Adherence to current regimen","Side effects experienced","Therapeutic response noted","Patient understanding and concerns","Monitoring requirements"]}],tips:["Use generic drug names when possible","Include exact dosages with units (mg, mcg)","Note timing (morning, evening, with meals)","Document reasons for any changes"],terminology:["ACE inhibitor, ARB, beta-blocker, statin","BD, TDS, QID, PRN, with meals","mg, mcg, g, units, mL","Commenced, ceased, increased, decreased"]}];function Qr(n){return za.find(e=>e.id===n)}function Vn(n){return za.some(e=>e.id===n)}const Jr=oe.memo(({agentType:n,isVisible:e,onClose:a,onStartRecording:i,compactMode:r=!1})=>{const[s,o]=d.useState({}),l=Qr(n);Math.random()<.001&&console.log("ðŸ“‹ Recording prompt shown for:",n);const c=d.useCallback(f=>{o(h=>({...h,[f]:!h[f]}))},[]);if(d.useCallback(()=>{i?.(),a?.()},[i,a]),!e||!l)return null;const u=(f,h)=>{const m=s[f.title]??(r?!1:h===0);return t.jsxs("div",{className:`border border-gray-200 rounded-lg overflow-hidden ${r?"mb-2":"mb-3"}`,children:[t.jsxs("button",{onClick:()=>c(f.title),className:`w-full bg-gray-50 hover:bg-gray-100 flex items-center justify-between text-left transition-colors ${r?"px-3 py-2":"px-4 py-3"}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:r?"text-sm":"text-lg",children:f.icon}),t.jsx("span",{className:`font-semibold text-gray-800 ${r?"text-xs":"text-sm"}`,children:f.title})]}),m?t.jsx(yt,{className:`text-gray-500 ${r?"w-3 h-3":"w-4 h-4"}`}):t.jsx(yn,{className:`text-gray-500 ${r?"w-3 h-3":"w-4 h-4"}`})]}),m&&t.jsx("div",{className:`bg-white ${r?"px-3 py-2":"px-4 py-3"}`,children:t.jsx("ul",{className:r?"space-y-1":"space-y-2",children:f.items.map((b,g)=>t.jsxs("li",{className:`flex items-start space-x-2 text-gray-700 ${r?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-blue-500 rounded-full mt-2 flex-shrink-0 ${r?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{children:b})]},g))})})]},f.title)};return t.jsx("div",{className:`w-full bg-white border border-gray-200 ${r?"rounded-lg shadow-md":"max-w-none mx-2 rounded-xl shadow-lg mb-4"}`,children:t.jsxs("div",{className:`bg-white w-full overflow-hidden ${r?"rounded-lg max-h-[40vh]":"rounded-xl max-h-[70vh]"}`,children:[t.jsx("div",{className:`bg-gradient-to-r from-red-600 to-red-700 text-white ${r?"px-3 py-2":"px-4 py-3"}`,children:t.jsxs("div",{className:"flex items-center space-x-2",children:[!r&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-300 rounded-full animate-pulse"}),t.jsx("span",{className:"text-sm font-semibold",children:"RECORDING"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(On,{className:r?"w-3 h-3":"w-4 h-4"}),t.jsx("span",{className:`font-medium ${r?"text-xs":"text-sm"}`,children:r?l.title.replace(" Recording",""):`Recording Guide: ${l.title.replace(" Recording","")}`})]})]})}),t.jsxs("div",{className:`overflow-y-auto ${r?"p-3 max-h-[35vh]":"p-4 max-h-[60vh]"}`,children:[!r&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 rounded-lg border border-red-200",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Ei,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),t.jsx("div",{children:t.jsx("p",{className:"text-red-700 text-sm font-medium",children:"Include these key elements while recording to ensure a comprehensive medical report:"})})]})}),t.jsxs("div",{className:r?"mb-3":"mb-6",children:[!r&&t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center space-x-2",children:[t.jsx(On,{className:"w-4 h-4"}),t.jsx("span",{children:"What to Include"})]}),l.sections.map(u)]}),l.tips.length>0&&t.jsxs("div",{className:r?"mb-3":"mb-6",children:[t.jsxs("h3",{className:`font-semibold text-gray-800 ${r?"mb-2 text-sm":"mb-3"}`,children:["ðŸ’¡ ",r?"Tips":"Recording Tips"]}),t.jsx("div",{className:`bg-yellow-50 border border-yellow-200 rounded-lg ${r?"p-2":"p-4"}`,children:t.jsx("ul",{className:r?"space-y-1":"space-y-2",children:l.tips.map((f,h)=>t.jsxs("li",{className:`flex items-start space-x-2 text-yellow-800 ${r?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-yellow-500 rounded-full mt-2 flex-shrink-0 ${r?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{children:f})]},h))})})]}),l.terminology.length>0&&t.jsxs("div",{className:r?"mb-2":"mb-6",children:[t.jsxs("h3",{className:`font-semibold text-gray-800 ${r?"mb-2 text-sm":"mb-3"}`,children:["ðŸ“š ",r?"Terms":"Key Terminology"]}),t.jsx("div",{className:`bg-green-50 border border-green-200 rounded-lg ${r?"p-2":"p-4"}`,children:t.jsx("div",{className:`grid gap-2 ${r?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:l.terminology.map((f,h)=>t.jsxs("div",{className:`flex items-center space-x-2 text-green-800 ${r?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-green-500 rounded-full flex-shrink-0 ${r?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{className:"font-medium",children:f})]},h))})})]})]})]})})}),Kr=({isOpen:n,onClose:e})=>{const[a,i]=d.useState(null),[r,s]=d.useState([]),[o,l]=d.useState(!0);d.useEffect(()=>{n&&c()},[n]);const c=async()=>{l(!0);try{const g=We.getInstance(),[x,w]=await Promise.all([g.getAnalytics(),g.getAllMetrics()]);i(x),s(w.slice(0,10))}catch(g){console.error("Failed to load metrics:",g)}finally{l(!1)}},u=async()=>{confirm("Are you sure you want to clear all performance metrics? This cannot be undone.")&&(await We.getInstance().clearAllMetrics(),await c())},f=async()=>{try{const x=await We.getInstance().exportMetrics(),w=new Blob([x],{type:"application/json"}),I=URL.createObjectURL(w),R=document.createElement("a");R.href=I,R.download=`xestro-metrics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(I)}catch(g){console.error("Failed to export metrics:",g)}},h=g=>{if(g<1e3)return`${g}ms`;if(g<6e4)return`${(g/1e3).toFixed(1)}s`;const x=Math.floor(g/6e4),w=Math.floor(g%6e4/1e3);return`${x}m ${w}s`},m=g=>({tavi:"â¤ï¸","angiogram-pci":"ðŸ«€",mteer:"ðŸ”§",tteer:"ðŸ«€","pfo-closure":"ðŸ¥","asd-closure":"ðŸ¥","pvl-plug":"ðŸ”Œ","bypass-graft":"ðŸ›¤ï¸","right-heart-cath":"ðŸ“Š","tavi-workup":"ðŸ”","quick-letter":"ðŸ“",consultation:"ðŸ‘¨â€âš•ï¸","investigation-summary":"ðŸ”","ai-medical-review":"ðŸ›¡ï¸","batch-ai-review":"ðŸ“‹","patient-education":"ðŸŽ“",background:"ðŸ“‹",medication:"ðŸ’Š",bloods:"ðŸ©¸",imaging:"ðŸ“·",enhancement:"âœ¨",transcription:"ðŸŽ¤",generation:"ðŸ¤–"})[g]||"ðŸ¤–",b=g=>g>0?"text-green-600":g<0?"text-red-600":"text-gray-600";return n?t.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl max-h-[90vh] overflow-hidden w-full",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Xt,{className:"w-6 h-6 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Performance Analytics"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Historical recording metrics and trends"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:f,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Export Metrics",children:t.jsx(Et,{className:"w-4 h-4"})}),t.jsx("button",{onClick:c,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:t.jsx(nn,{className:"w-4 h-4"})}),t.jsx("button",{onClick:u,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear All Metrics",children:t.jsx(an,{className:"w-4 h-4"})}),t.jsx("button",{onClick:e,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Close",children:t.jsx(Ie,{className:"w-4 h-4"})})]})]})}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:o?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})}):a&&a.totalRecordings>0?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Pi,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Total Recordings"})]}),t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:a.totalRecordings})]}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(bn,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-800",children:"Avg Transcription"})]}),t.jsx("div",{className:"text-2xl font-bold text-green-900",children:h(a.averageTranscriptionTime)})]}),t.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(lt,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-purple-800",children:"Avg Processing"})]}),t.jsx("div",{className:"text-2xl font-bold text-purple-900",children:h(a.averageProcessingTime)})]}),t.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Qe,{className:"w-4 h-4 text-orange-600"}),t.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Avg Total"})]}),t.jsx("div",{className:"text-2xl font-bold text-orange-900",children:h(a.averageTotalDuration)})]})]}),a.recentTrend.last25Avg>0&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.recentTrend.improvementPercent>0?t.jsx(ha,{className:"w-4 h-4 text-green-600"}):a.recentTrend.improvementPercent<0?t.jsx(Ai,{className:"w-4 h-4 text-red-600"}):t.jsx(bn,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-800",children:"Performance Trend"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Last 10 Average"}),t.jsx("div",{className:"font-semibold",children:h(a.recentTrend.last10Avg)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Last 25 Average"}),t.jsx("div",{className:"font-semibold",children:h(a.recentTrend.last25Avg)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Improvement"}),t.jsxs("div",{className:`font-semibold ${b(a.recentTrend.improvementPercent)}`,children:[a.recentTrend.improvementPercent>0?"+":"",a.recentTrend.improvementPercent,"%"]})]})]})]}),Object.keys(a.agentTypeBreakdown).length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Agent Performance Breakdown"}),t.jsx("div",{className:"space-y-3",children:Object.entries(a.agentTypeBreakdown).map(([g,x])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"text-xl",children:m(g)}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 capitalize",children:g.replace("-"," ")}),t.jsxs("div",{className:"text-sm text-gray-600",children:[x.count," recordings"]})]})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:h(x.avgTotal)}),t.jsxs("div",{className:"text-gray-600",children:[h(x.avgTranscription)," + ",h(x.avgProcessing)]})]})]},g))})]}),r.length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Recordings"}),t.jsx("div",{className:"space-y-2",children:r.map((g,x)=>t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"text-sm",children:m(g.agentType)}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 capitalize",children:g.agentType.replace("-"," ")}),t.jsx("div",{className:"text-xs text-gray-500",children:new Date(g.timestamp).toLocaleString()})]})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:h(g.totalDuration)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[h(g.transcriptionTime)," + ",h(g.processingTime)]})]})]},g.sessionId))})]}),Object.keys(a.modelPerformance).length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Model Performance"}),t.jsx("div",{className:"space-y-2",children:Object.entries(a.modelPerformance).map(([g,x])=>t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(st,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:g})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:h(x.avgTime)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[x.count," recordings"]})]})]},g))})]})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Xt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Metrics Available"}),t.jsx("p",{className:"text-gray-600",children:"Start recording to see performance analytics appear here."})]})})]})}):null},Yr=({isRecording:n,voiceActivityLevel:e,frequencyData:a,audioLevelHistory:i,recordingTime:r,activeDeviceInfo:s,onStop:o,className:l=""})=>{const[c,u]=oe.useState({status:"idle",color:"gray",message:"Not recording"}),[f,h]=oe.useState(!1),m=oe.useRef();oe.useEffect(()=>{n&&!s?.isWorking&&Math.random()<.01&&console.warn("âš ï¸ Audio device may not be working properly")},[n,s]);const b=i.slice(-10).some(D=>D>.05),g=()=>n?i.length<5?{status:"initializing",color:"blue",message:"Initializing..."}:b?{status:"active",color:"green",message:"Audio detected"}:e>.01?{status:"low",color:"yellow",message:"Low audio"}:{status:"silent",color:"red",message:"No audio detected"}:{status:"idle",color:"gray",message:"Not recording"};oe.useEffect(()=>{const D=g();if(m.current&&clearTimeout(m.current),D.status==="active"||D.status==="initializing"){u(D),h(!1);return}return D.status==="silent"||D.status==="low"?m.current=setTimeout(()=>{u(D),D.status==="silent"&&i.length>50&&h(!0)},2500):(u(D),h(!1)),()=>{m.current&&clearTimeout(m.current)}},[n,b,e,i.length]);const x=c,w=D=>{const v=Math.floor(D/60),y=D%60;return`${v}:${y.toString().padStart(2,"0")}`},R=(D=>D.length===0?[]:[...[...D].reverse(),...D])(a);return oe.useEffect(()=>{if(n&&a.length>0&&Math.random()<.1){const D=Math.max(...a),v=a.reduce((y,S)=>y+S,0)/a.length;console.log("ðŸ“Š LiveAudioVisualizer Debug:",{originalFreqData:a.length,symmetricalLength:R.length,maxOriginal:D.toFixed(3),avgOriginal:v.toFixed(3),voiceLevel:Math.round(e*100)+"%",firstFew:a.slice(0,3).map(y=>y.toFixed(3))})}},[n,a,R,e]),t.jsxs(B.div,{className:`flex-1 flex flex-col items-center justify-center p-4 space-y-4 ${l}`,variants:pe(tt),initial:"hidden",animate:"visible",children:[t.jsxs(B.div,{className:"text-center space-y-1",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,type:"spring",damping:20,stiffness:300},children:[t.jsx(B.h3,{className:"text-base font-semibold text-gray-900",animate:{color:n?"#3b82f6":"#1f2937"},transition:{duration:300},children:n?"Recording in progress":"Ready to record"}),t.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-600",children:[t.jsx(B.div,{className:"w-2 h-2 rounded-full",style:{backgroundColor:x.color==="green"?"#10b981":x.color==="yellow"?"#f59e0b":x.color==="red"?"#ef4444":x.color==="blue"?"#3b82f6":"#9ca3af"},animate:{scale:x.status==="active"?[1,1.3,1]:1},transition:{duration:2,repeat:x.status==="active"?1/0:0,ease:"easeInOut"}}),t.jsx(B.span,{animate:{color:x.status==="active"?"#10b981":"#6b7280"},transition:{duration:300},children:x.message})]}),t.jsx(Ae,{children:s&&t.jsx(B.div,{className:"text-xs text-gray-500 truncate max-w-xs",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:20,stiffness:300},children:s.label})}),t.jsx(Ae,{children:n&&t.jsx(B.div,{className:"text-lg font-mono font-semibold text-gray-900 bg-gray-100 rounded-full px-3 py-1",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},transition:{type:"spring",damping:20,stiffness:300},children:w(r)})})]}),t.jsx(Ae,{children:n&&t.jsxs(B.div,{className:"w-full max-w-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:20,stiffness:300,delay:.1},children:[t.jsx(B.div,{className:"text-sm text-ink-secondary text-center mb-4 font-medium",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"Live Audio Spectrum"}),t.jsx("div",{className:"h-40 bg-gray-100 rounded-3xl border border-gray-200 flex items-center justify-center px-6 overflow-hidden shadow-sm",children:R.length>0?t.jsx("div",{className:"flex items-end justify-center gap-0.5 h-full w-full px-2",children:R.map((D,v)=>{const y=Math.floor(R.length/2),S=Math.abs(v-y),C=Math.pow(D*3,.6),T=Math.max(C*90,8),M=k=>k>.3?"#10b981":k>.2?"#059669":k>.15?"#3b82f6":k>.1?"#6366f1":k>.05?"#f59e0b":k>.02?"#9ca3af":"#d1d5db";return v<5&&Math.random()<.1&&console.log(`Bar ${v}: freq=${D.toFixed(3)}, amplified=${C.toFixed(3)}, height=${T}px`),t.jsx(B.div,{className:"flex-1 min-w-[2px] max-w-[4px] rounded-full",style:{backgroundColor:M(C),height:`${Math.min(T,95)}%`,minHeight:"8px"},initial:{height:"8px"},animate:{height:`${Math.min(T,95)}%`},transition:{type:"spring",damping:20,stiffness:400,mass:.2,delay:S*.003}},v)})}):t.jsxs("div",{className:"flex items-center space-x-4 text-gray-400",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(B.div,{className:"w-4 h-4 bg-blue-400 rounded-full",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),t.jsx(B.div,{className:"w-4 h-4 bg-blue-500 rounded-full",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.2}}),t.jsx(B.div,{className:"w-4 h-4 bg-blue-600 rounded-full",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.4}})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Waiting for audio..."}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Speak into your microphone to see the waveform"})]})]})}),t.jsxs(B.div,{className:"mt-4 flex items-center justify-between text-sm bg-gray-50 rounded-2xl px-4 py-3 border border-gray-200",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[t.jsx("span",{className:"text-gray-600 font-medium",children:"Audio Level:"}),t.jsxs(B.span,{className:"font-bold text-lg",animate:{color:e>.3?"#10b981":e>.1?"#3b82f6":"#6b7280",scale:e>.5?1.1:1},transition:{type:"spring",damping:25,stiffness:300},children:[Math.round(e*100),"%"]})]})]})}),t.jsx(Ae,{children:n&&t.jsxs(B.button,{onClick:o,className:"flex items-center space-x-2 bg-gray-900 hover:bg-gray-800 text-white px-6 py-3 rounded-full shadow-sm",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},whileHover:{scale:1.05,y:-2,boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)"},whileTap:{scale:.95},transition:{type:"spring",damping:20,stiffness:300,delay:.4},children:[t.jsx(Ri,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium",children:"Stop recording"})]})}),t.jsxs("div",{className:"w-full max-w-sm min-h-[60px] flex items-center justify-center",children:[n&&f&&t.jsxs("div",{className:"w-full bg-gray-50 border border-gray-200 rounded-2xl p-3 transition-all duration-300",children:[t.jsxs("div",{className:"text-xs text-gray-900 font-medium mb-1 flex items-center space-x-1",children:[t.jsx("div",{className:"w-1 h-1 rounded-full transition-colors duration-300",style:{backgroundColor:x.color==="red"?"#ef4444":"#f59e0b"}}),t.jsx("span",{children:x.message})]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["â€¢ Check if microphone is muted",t.jsx("br",{}),"â€¢ Ensure device is connected",t.jsx("br",{}),"â€¢ Try speaking louder",t.jsx("br",{}),"â€¢ Switch microphones if available"]})]}),n&&!f&&t.jsx("div",{className:"text-xs text-gray-500 text-center opacity-60",children:"Audio monitoring active"})]})]})};var Ua={exports:{}},Zr="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",es=Zr,ts=es;function qa(){}function Ba(){}Ba.resetWarningCache=qa;var ns=function(){function n(i,r,s,o,l,c){if(c!==ts){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}n.isRequired=n;function e(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Ba,resetWarningCache:qa};return a.PropTypes=a,a};Ua.exports=ns();var as=Ua.exports;const me=Oi(as);function ct(n,e,a,i){function r(s){return s instanceof a?s:new a(function(o){o(s)})}return new(a||(a=Promise))(function(s,o){function l(f){try{u(i.next(f))}catch(h){o(h)}}function c(f){try{u(i.throw(f))}catch(h){o(h)}}function u(f){f.done?s(f.value):r(f.value).then(l,c)}u((i=i.apply(n,e||[])).next())})}const is=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function wt(n,e,a){const i=rs(n),{webkitRelativePath:r}=n,s=typeof e=="string"?e:typeof r=="string"&&r.length>0?r:`./${n.name}`;return typeof i.path!="string"&&Gn(i,"path",s),Gn(i,"relativePath",s),i}function rs(n){const{name:e}=n;if(e&&e.lastIndexOf(".")!==-1&&!n.type){const i=e.split(".").pop().toLowerCase(),r=is.get(i);r&&Object.defineProperty(n,"type",{value:r,writable:!1,configurable:!1,enumerable:!0})}return n}function Gn(n,e,a){Object.defineProperty(n,e,{value:a,writable:!1,configurable:!1,enumerable:!0})}const ss=[".DS_Store","Thumbs.db"];function os(n){return ct(this,void 0,void 0,function*(){return Zt(n)&&ls(n.dataTransfer)?ms(n.dataTransfer,n.type):cs(n)?ds(n):Array.isArray(n)&&n.every(e=>"getFile"in e&&typeof e.getFile=="function")?us(n):[]})}function ls(n){return Zt(n)}function cs(n){return Zt(n)&&Zt(n.target)}function Zt(n){return typeof n=="object"&&n!==null}function ds(n){return kn(n.target.files).map(e=>wt(e))}function us(n){return ct(this,void 0,void 0,function*(){return(yield Promise.all(n.map(a=>a.getFile()))).map(a=>wt(a))})}function ms(n,e){return ct(this,void 0,void 0,function*(){if(n.items){const a=kn(n.items).filter(r=>r.kind==="file");if(e!=="drop")return a;const i=yield Promise.all(a.map(ps));return Xn(Ha(i))}return Xn(kn(n.files).map(a=>wt(a)))})}function Xn(n){return n.filter(e=>ss.indexOf(e.name)===-1)}function kn(n){if(n===null)return[];const e=[];for(let a=0;a<n.length;a++){const i=n[a];e.push(i)}return e}function ps(n){if(typeof n.webkitGetAsEntry!="function")return Qn(n);const e=n.webkitGetAsEntry();return e&&e.isDirectory?Wa(e):Qn(n,e)}function Ha(n){return n.reduce((e,a)=>[...e,...Array.isArray(a)?Ha(a):[a]],[])}function Qn(n,e){return ct(this,void 0,void 0,function*(){var a;if(globalThis.isSecureContext&&typeof n.getAsFileSystemHandle=="function"){const s=yield n.getAsFileSystemHandle();if(s===null)throw new Error(`${n} is not a File`);if(s!==void 0){const o=yield s.getFile();return o.handle=s,wt(o)}}const i=n.getAsFile();if(!i)throw new Error(`${n} is not a File`);return wt(i,(a=e?.fullPath)!==null&&a!==void 0?a:void 0)})}function gs(n){return ct(this,void 0,void 0,function*(){return n.isDirectory?Wa(n):hs(n)})}function Wa(n){const e=n.createReader();return new Promise((a,i)=>{const r=[];function s(){e.readEntries(o=>ct(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(gs));r.push(l),s()}else try{const l=yield Promise.all(r);a(l)}catch(l){i(l)}}),o=>{i(o)})}s()})}function hs(n){return ct(this,void 0,void 0,function*(){return new Promise((e,a)=>{n.file(i=>{const r=wt(i,n.fullPath);e(r)},i=>{a(i)})})})}var hn=function(n,e){if(n&&e){var a=Array.isArray(e)?e:e.split(",");if(a.length===0)return!0;var i=n.name||"",r=(n.type||"").toLowerCase(),s=r.replace(/\/.*$/,"");return a.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?i.toLowerCase().endsWith(l):l.endsWith("/*")?s===l.replace(/\/.*$/,""):r===l})}return!0};function Jn(n){return bs(n)||xs(n)||Ga(n)||fs()}function fs(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xs(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function bs(n){if(Array.isArray(n))return Nn(n)}function Kn(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),a.push.apply(a,i)}return a}function Yn(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Kn(Object(a),!0).forEach(function(i){Va(n,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Kn(Object(a)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(a,i))})}return n}function Va(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function Dt(n,e){return ws(n)||ys(n,e)||Ga(n,e)||vs()}function vs(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ga(n,e){if(n){if(typeof n=="string")return Nn(n,e);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Nn(n,e)}}function Nn(n,e){(e==null||e>n.length)&&(e=n.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=n[a];return i}function ys(n,e){var a=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var i=[],r=!0,s=!1,o,l;try{for(a=a.call(n);!(r=(o=a.next()).done)&&(i.push(o.value),!(e&&i.length===e));r=!0);}catch(c){s=!0,l=c}finally{try{!r&&a.return!=null&&a.return()}finally{if(s)throw l}}return i}}function ws(n){if(Array.isArray(n))return n}var js=typeof hn=="function"?hn:hn.default,ks="file-invalid-type",Ns="file-too-large",Ss="file-too-small",Cs="too-many-files",Ts=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=e.split(","),i=a.length>1?"one of ".concat(a.join(", ")):a[0];return{code:ks,message:"File type must be ".concat(i)}},Zn=function(e){return{code:Ns,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},ea=function(e){return{code:Ss,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Es={code:Cs,message:"Too many files"};function Xa(n,e){var a=n.type==="application/x-moz-file"||js(n,e);return[a,a?null:Ts(e)]}function Qa(n,e,a){if(nt(n.size))if(nt(e)&&nt(a)){if(n.size>a)return[!1,Zn(a)];if(n.size<e)return[!1,ea(e)]}else{if(nt(e)&&n.size<e)return[!1,ea(e)];if(nt(a)&&n.size>a)return[!1,Zn(a)]}return[!0,null]}function nt(n){return n!=null}function Ps(n){var e=n.files,a=n.accept,i=n.minSize,r=n.maxSize,s=n.multiple,o=n.maxFiles,l=n.validator;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(c){var u=Xa(c,a),f=Dt(u,1),h=f[0],m=Qa(c,i,r),b=Dt(m,1),g=b[0],x=l?l(c):null;return h&&g&&!x})}function en(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function Ht(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!n.target&&!!n.target.files}function ta(n){n.preventDefault()}function As(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function Rs(n){return n.indexOf("Edge/")!==-1}function Ms(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return As(n)||Rs(n)}function Ue(){for(var n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return e.some(function(l){return!en(i)&&l&&l.apply(void 0,[i].concat(s)),en(i)})}}function Is(){return"showOpenFilePicker"in window}function Ds(n){if(nt(n)){var e=Object.entries(n).filter(function(a){var i=Dt(a,2),r=i[0],s=i[1],o=!0;return Ja(r)||(console.warn('Skipped "'.concat(r,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(s)||!s.every(Ka))&&(console.warn('Skipped "'.concat(r,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(a,i){var r=Dt(i,2),s=r[0],o=r[1];return Yn(Yn({},a),{},Va({},s,o))},{});return[{description:"Files",accept:e}]}return n}function Os(n){if(nt(n))return Object.entries(n).reduce(function(e,a){var i=Dt(a,2),r=i[0],s=i[1];return[].concat(Jn(e),[r],Jn(s))},[]).filter(function(e){return Ja(e)||Ka(e)}).join(",")}function _s(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function $s(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}function Ja(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||n==="application/*"||/\w+\/[-+.\w]+/g.test(n)}function Ka(n){return/^.*\.[\w]+$/.test(n)}var Fs=["children"],Ls=["open"],zs=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Us=["refKey","onChange","onClick"];function qs(n){return Ws(n)||Hs(n)||Ya(n)||Bs()}function Bs(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hs(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Ws(n){if(Array.isArray(n))return Sn(n)}function fn(n,e){return Xs(n)||Gs(n,e)||Ya(n,e)||Vs()}function Vs(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ya(n,e){if(n){if(typeof n=="string")return Sn(n,e);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Sn(n,e)}}function Sn(n,e){(e==null||e>n.length)&&(e=n.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=n[a];return i}function Gs(n,e){var a=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var i=[],r=!0,s=!1,o,l;try{for(a=a.call(n);!(r=(o=a.next()).done)&&(i.push(o.value),!(e&&i.length===e));r=!0);}catch(c){s=!0,l=c}finally{try{!r&&a.return!=null&&a.return()}finally{if(s)throw l}}return i}}function Xs(n){if(Array.isArray(n))return n}function na(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),a.push.apply(a,i)}return a}function he(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?na(Object(a),!0).forEach(function(i){Cn(n,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):na(Object(a)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(a,i))})}return n}function Cn(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function tn(n,e){if(n==null)return{};var a=Qs(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(a[i]=n[i])}return a}function Qs(n,e){if(n==null)return{};var a={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(a[r]=n[r]);return a}var Rn=d.forwardRef(function(n,e){var a=n.children,i=tn(n,Fs),r=ei(i),s=r.open,o=tn(r,Ls);return d.useImperativeHandle(e,function(){return{open:s}},[s]),oe.createElement(d.Fragment,null,a(he(he({},o),{},{open:s})))});Rn.displayName="Dropzone";var Za={disabled:!1,getFilesFromEvent:os,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Rn.defaultProps=Za;Rn.propTypes={children:me.func,accept:me.objectOf(me.arrayOf(me.string)),multiple:me.bool,preventDropOnDocument:me.bool,noClick:me.bool,noKeyboard:me.bool,noDrag:me.bool,noDragEventsBubbling:me.bool,minSize:me.number,maxSize:me.number,maxFiles:me.number,disabled:me.bool,getFilesFromEvent:me.func,onFileDialogCancel:me.func,onFileDialogOpen:me.func,useFsAccessApi:me.bool,autoFocus:me.bool,onDragEnter:me.func,onDragLeave:me.func,onDragOver:me.func,onDrop:me.func,onDropAccepted:me.func,onDropRejected:me.func,onError:me.func,validator:me.func};var Tn={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function ei(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=he(he({},Za),n),a=e.accept,i=e.disabled,r=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,l=e.multiple,c=e.maxFiles,u=e.onDragEnter,f=e.onDragLeave,h=e.onDragOver,m=e.onDrop,b=e.onDropAccepted,g=e.onDropRejected,x=e.onFileDialogCancel,w=e.onFileDialogOpen,I=e.useFsAccessApi,R=e.autoFocus,D=e.preventDropOnDocument,v=e.noClick,y=e.noKeyboard,S=e.noDrag,C=e.noDragEventsBubbling,T=e.onError,M=e.validator,k=d.useMemo(function(){return Os(a)},[a]),j=d.useMemo(function(){return Ds(a)},[a]),A=d.useMemo(function(){return typeof w=="function"?w:aa},[w]),P=d.useMemo(function(){return typeof x=="function"?x:aa},[x]),_=d.useRef(null),z=d.useRef(null),Q=d.useReducer(Js,Tn),G=fn(Q,2),J=G[0],H=G[1],K=J.isFocused,Ne=J.isFileDialogActive,be=d.useRef(typeof window<"u"&&window.isSecureContext&&I&&Is()),te=function(){!be.current&&Ne&&setTimeout(function(){if(z.current){var L=z.current.files;L.length||(H({type:"closeDialog"}),P())}},300)};d.useEffect(function(){return window.addEventListener("focus",te,!1),function(){window.removeEventListener("focus",te,!1)}},[z,Ne,P,be]);var Y=d.useRef([]),Te=function(L){_.current&&_.current.contains(L.target)||(L.preventDefault(),Y.current=[])};d.useEffect(function(){return D&&(document.addEventListener("dragover",ta,!1),document.addEventListener("drop",Te,!1)),function(){D&&(document.removeEventListener("dragover",ta),document.removeEventListener("drop",Te))}},[_,D]),d.useEffect(function(){return!i&&R&&_.current&&_.current.focus(),function(){}},[_,R,i]);var ye=d.useCallback(function(F){T?T(F):console.error(F)},[T]),Be=d.useCallback(function(F){F.preventDefault(),F.persist(),ve(F),Y.current=[].concat(qs(Y.current),[F.target]),Ht(F)&&Promise.resolve(r(F)).then(function(L){if(!(en(F)&&!C)){var ee=L.length,le=ee>0&&Ps({files:L,accept:k,minSize:o,maxSize:s,multiple:l,maxFiles:c,validator:M}),je=ee>0&&!le;H({isDragAccept:le,isDragReject:je,isDragActive:!0,type:"setDraggedFiles"}),u&&u(F)}}).catch(function(L){return ye(L)})},[r,u,ye,C,k,o,s,l,c,M]),_e=d.useCallback(function(F){F.preventDefault(),F.persist(),ve(F);var L=Ht(F);if(L&&F.dataTransfer)try{F.dataTransfer.dropEffect="copy"}catch{}return L&&h&&h(F),!1},[h,C]),U=d.useCallback(function(F){F.preventDefault(),F.persist(),ve(F);var L=Y.current.filter(function(le){return _.current&&_.current.contains(le)}),ee=L.indexOf(F.target);ee!==-1&&L.splice(ee,1),Y.current=L,!(L.length>0)&&(H({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Ht(F)&&f&&f(F))},[_,f,C]),p=d.useCallback(function(F,L){var ee=[],le=[];F.forEach(function(je){var xe=Xa(je,k),Ce=fn(xe,2),V=Ce[0],ne=Ce[1],ae=Qa(je,o,s),et=fn(ae,2),dt=et[0],re=et[1],ue=M?M(je):null;if(V&&dt&&!ue)ee.push(je);else{var Pe=[ne,re];ue&&(Pe=Pe.concat(ue)),le.push({file:je,errors:Pe.filter(function($t){return $t})})}}),(!l&&ee.length>1||l&&c>=1&&ee.length>c)&&(ee.forEach(function(je){le.push({file:je,errors:[Es]})}),ee.splice(0)),H({acceptedFiles:ee,fileRejections:le,isDragReject:le.length>0,type:"setFiles"}),m&&m(ee,le,L),le.length>0&&g&&g(le,L),ee.length>0&&b&&b(ee,L)},[H,l,k,o,s,c,m,b,g,M]),N=d.useCallback(function(F){F.preventDefault(),F.persist(),ve(F),Y.current=[],Ht(F)&&Promise.resolve(r(F)).then(function(L){en(F)&&!C||p(L,F)}).catch(function(L){return ye(L)}),H({type:"reset"})},[r,p,ye,C]),E=d.useCallback(function(){if(be.current){H({type:"openDialog"}),A();var F={multiple:l,types:j};window.showOpenFilePicker(F).then(function(L){return r(L)}).then(function(L){p(L,null),H({type:"closeDialog"})}).catch(function(L){_s(L)?(P(L),H({type:"closeDialog"})):$s(L)?(be.current=!1,z.current?(z.current.value=null,z.current.click()):ye(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):ye(L)});return}z.current&&(H({type:"openDialog"}),A(),z.current.value=null,z.current.click())},[H,A,P,I,p,ye,j,l]),q=d.useCallback(function(F){!_.current||!_.current.isEqualNode(F.target)||(F.key===" "||F.key==="Enter"||F.keyCode===32||F.keyCode===13)&&(F.preventDefault(),E())},[_,E]),O=d.useCallback(function(){H({type:"focus"})},[]),$=d.useCallback(function(){H({type:"blur"})},[]),X=d.useCallback(function(){v||(Ms()?setTimeout(E,0):E())},[v,E]),se=function(L){return i?null:L},ce=function(L){return y?null:se(L)},ie=function(L){return S?null:se(L)},ve=function(L){C&&L.stopPropagation()},we=d.useMemo(function(){return function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},L=F.refKey,ee=L===void 0?"ref":L,le=F.role,je=F.onKeyDown,xe=F.onFocus,Ce=F.onBlur,V=F.onClick,ne=F.onDragEnter,ae=F.onDragOver,et=F.onDragLeave,dt=F.onDrop,re=tn(F,zs);return he(he(Cn({onKeyDown:ce(Ue(je,q)),onFocus:ce(Ue(xe,O)),onBlur:ce(Ue(Ce,$)),onClick:se(Ue(V,X)),onDragEnter:ie(Ue(ne,Be)),onDragOver:ie(Ue(ae,_e)),onDragLeave:ie(Ue(et,U)),onDrop:ie(Ue(dt,N)),role:typeof le=="string"&&le!==""?le:"presentation"},ee,_),!i&&!y?{tabIndex:0}:{}),re)}},[_,q,O,$,X,Be,_e,U,N,y,S,i]),de=d.useCallback(function(F){F.stopPropagation()},[]),fe=d.useMemo(function(){return function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},L=F.refKey,ee=L===void 0?"ref":L,le=F.onChange,je=F.onClick,xe=tn(F,Us),Ce=Cn({accept:k,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:se(Ue(le,N)),onClick:se(Ue(je,de)),tabIndex:-1},ee,z);return he(he({},Ce),xe)}},[z,a,l,N,i]);return he(he({},J),{},{isFocused:K&&!i,getRootProps:we,getInputProps:fe,rootRef:_,inputRef:z,open:se(E)})}function Js(n,e){switch(e.type){case"focus":return he(he({},n),{},{isFocused:!0});case"blur":return he(he({},n),{},{isFocused:!1});case"openDialog":return he(he({},Tn),{},{isFileDialogActive:!0});case"closeDialog":return he(he({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":return he(he({},n),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return he(he({},n),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return he({},Tn);default:return n}}function aa(){}class Ks{screenshots=[];gridSlots=[null,null,null,null];maxScreenshots=4;constructor(e=4){this.maxScreenshots=e}addScreenshot(e){this.screenshots.length>=this.maxScreenshots&&(Z.warn(`Maximum ${this.maxScreenshots} screenshots reached. Replacing oldest.`,{component:"screenshot-combiner",operation:"add-screenshot",maxScreenshots:this.maxScreenshots}),this.screenshots.shift()),this.screenshots.push(e),Z.info(`Screenshot added. Total: ${this.screenshots.length}/${this.maxScreenshots}`,{component:"screenshot-combiner",operation:"add-screenshot",current:this.screenshots.length,max:this.maxScreenshots})}setGrid(e){const a=[null,null,null,null];for(let i=0;i<4;i++)a[i]=e[i]||null;this.gridSlots=a,this.screenshots=this.gridSlots.filter(i=>i!==null)}removeScreenshot(e){const a=this.screenshots.findIndex(i=>i.id===e);return a!==-1?(this.screenshots.splice(a,1),Z.info(`Screenshot removed. Remaining: ${this.screenshots.length}`,{component:"screenshot-combiner",operation:"remove-screenshot",remaining:this.screenshots.length}),!0):!1}getScreenshots(){return[...this.screenshots]}getScreenshotCount(){return this.screenshots.length}canAddMore(){return this.screenshots.length<this.maxScreenshots}clear(){this.screenshots=[],this.gridSlots=[null,null,null,null],Z.info("All screenshots cleared",{component:"screenshot-combiner",operation:"clear"})}async combineScreenshots(){if(this.screenshots.length===0)throw new Error("No screenshots to combine");Z.info(`Combining ${this.screenshots.length} screenshots into 2x2 grid (10x10 cm)`,{component:"screenshot-combiner",operation:"combine-start",count:this.screenshots.length});try{const a={dataUrl:await this.createCombinedCanvas(),width:0,height:0,screenshotCount:this.screenshots.length,timestamp:Date.now()};return Z.info(`Successfully combined ${this.screenshots.length} screenshots`,{component:"screenshot-combiner",operation:"combine-success",count:this.screenshots.length}),a}catch(e){throw Z.error("Failed to combine screenshots",e instanceof Error?e:void 0,{component:"screenshot-combiner",operation:"combine-error"}),new Error(`Screenshot combination failed: ${e instanceof Error?e.message:"Unknown error"}`)}}drawCombinedCanvas(){return new Promise((e,a)=>{try{const i=document.createElement("canvas"),r=i.getContext("2d");if(!r){a(new Error("Could not get canvas context"));return}const s=96/2.54,o=Math.round(10*s),l=Math.round(5*s),c=Math.max(1,Math.floor(window.devicePixelRatio||1));i.width=o*c,i.height=o*c,r.scale(c,c),Z.debug(`Canvas dimensions: ${o}x${o} (CSS px), DPR=${c}`,{component:"screenshot-combiner",operation:"canvas-setup",width:o,height:o,dpr:c}),r.fillStyle="#ffffff",r.fillRect(0,0,o,o);const u=(g,x,w,I)=>{r.save(),r.beginPath(),r.rect(x,w,I,I),r.clip();const R=Math.max(I/g.width,I/g.height),D=g.width*R,v=g.height*R,y=x+(I-D)/2,S=w+(I-v)/2;r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(g,y,S,D,v),r.restore()},f=this.gridSlots,h=[null,null,null,null];let m=f.filter(Boolean).length;if(m===0){e(i);return}const b=()=>{if(m--,m===0){const g=[{x:0,y:0},{x:l,y:0},{x:0,y:l},{x:l,y:l}];for(let x=0;x<4;x++){const w=h[x];if(!w)continue;const I=g[x];u(w,I.x,I.y,l),Z.debug(`Drew slot ${x+1} at (${I.x}, ${I.y}), cell ${l}x${l}`,{component:"screenshot-combiner",operation:"draw-slot",slot:x+1,x:I.x,y:I.y,cellSize:l})}Z.info("Canvas combination completed",{component:"screenshot-combiner",operation:"canvas-complete"}),e(i)}};f.forEach((g,x)=>{if(!g)return;const w=new Image;w.onload=()=>{h[x]=w,Z.debug(`Loaded slot ${x+1} image - ${w.width}x${w.height}`,{component:"screenshot-combiner",operation:"load-image",slot:x+1,width:w.width,height:w.height}),b()},w.onerror=I=>{Z.error(`Failed to load slot ${x+1} image`,void 0,{component:"screenshot-combiner",operation:"load-image",slot:x+1,error:I instanceof Error?I.message:String(I)}),h[x]=null,b()},w.src=g.dataUrl})}catch(i){Z.error("Error setting up canvas combination",i instanceof Error?i:void 0,{component:"screenshot-combiner",operation:"canvas-setup"}),a(i)}})}createCombinedCanvas(){return this.drawCombinedCanvas().then(e=>e.toDataURL("image/png"))}async copyToClipboard(){if(this.screenshots.length===0)throw new Error("No screenshots to copy");try{const e=await this.drawCombinedCanvas(),a=await new Promise((r,s)=>{e.toBlob(o=>o?r(o):s(new Error("toBlob failed")),"image/png")}),i=new ClipboardItem({"image/png":a});await navigator.clipboard.write([i]),Z.info("Combined screenshot copied to clipboard",{component:"screenshot-combiner",operation:"copy-clipboard"})}catch(e){throw Z.error("Failed to copy to clipboard",e instanceof Error?e:void 0,{component:"screenshot-combiner",operation:"copy-clipboard"}),new Error(`Clipboard copy failed: ${e instanceof Error?e.message:"Unknown error"}`)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}}const Re=Ve.getInstance(),Me={success:3e3,error:4e3,brief:2e3,extended:6e3},Wt={recordingStarted:n=>Re.success("Recording Started",`${n} recording in progress`,Me.brief),recordingSent:(n,e)=>Re.success("Recording Sent for Processing",`${n}'s ${e} recording is being processed. Ready for next recording.`,Me.success),sessionReady:(n,e)=>Re.success("Session Ready for Review",`${n}'s ${e} results are ready. Click the notification bell to view.`,Me.extended),processingFailed:n=>Re.error("Processing Failed",`${n}'s recording failed`,Me.error),transcriptionFailed:n=>{const e={"no-audio":"No audio detected","too-short":"Recording too short","service-unavailable":"Transcription service unavailable",error:"Transcription service error"};return Re.error("Audio Transcription Failed",e[n],Me.error)}},De={imageAdded:n=>Re.success("Image Added",`Screenshot ${n+1} loaded successfully`,Me.brief),imageRemoved:n=>Re.success("Screenshot Removed",`Slot ${n+1} cleared`,Me.brief),imagesCombined:n=>Re.success("Screenshots Combined!",`${n} screenshots combined and copied to clipboard`,Me.success),allCleared:()=>Re.success("Cleared","All screenshots removed",Me.brief),invalidFile:(n="PNG, JPG, GIF")=>Re.error("Invalid File",`Please select an image file (${n})`,Me.error),noFiles:()=>Re.error("No Files","No files were detected in the drag operation",Me.error),combineFailed:n=>Re.error("Combine Failed",n||"Failed to combine screenshots",Me.error),importFailed:()=>Re.error("Import Failed","Could not load dropped image",Me.error),noScreenshots:()=>Re.error("No Screenshots","Please add at least one screenshot to combine",Me.error)},Ys=({isOpen:n,onClose:e})=>{const[a,i]=d.useState([null,null,null,null]),[r,s]=d.useState(!1),[o,l]=d.useState(null),[c,u]=d.useState(0),f=d.useRef(new Ks(4)),h=d.useRef(null);if(!n)return null;const m=()=>{i([null,null,null,null]),s(!1),f.current.clear(),u(0);try{chrome.tabs.query({active:!0,currentWindow:!0},y=>{const S=y?.[0]?.id;S&&chrome.tabs.sendMessage(S,{type:"SET_FILE_DROP_GUARD",enabled:!1})})}catch(y){console.debug("Failed to disable file drop guard on modal close:",y instanceof Error?y.message:y)}e()};d.useEffect(()=>{const y=async S=>{try{const T=(await chrome.tabs.query({active:!0,currentWindow:!0}))?.[0]?.id;T&&await chrome.tabs.sendMessage(T,{type:"SET_FILE_DROP_GUARD",enabled:S})}catch(C){console.warn("SET_FILE_DROP_GUARD send failed (likely non-EMR tab):",C)}try{await chrome.runtime.sendMessage({type:"SET_FILE_DROP_GUARD",enabled:S})}catch(C){console.warn("SET_FILE_DROP_GUARD to background failed:",C)}};return n&&y(!0),()=>{y(!1)}},[n]);const b=d.useCallback((y,S)=>{if(!y.type.startsWith("image/")){De.invalidFile();return}const C=new FileReader;C.onload=T=>{const M=T.target?.result,k=new Image;k.onload=()=>{const j={id:`slot-${S}-${Date.now()}`,dataUrl:M,timestamp:Date.now(),width:k.width,height:k.height};i(A=>{const P=[...A];return P[S]=j,P}),De.imageAdded(S)},k.src=M},C.readAsDataURL(y)},[]);d.useEffect(()=>{u(y=>{if(y!=null&&a[y]===null)return y;const S=a.findIndex(C=>C===null);return S>=0?S:y??0})},[a]),d.useEffect(()=>{try{const y=(c??0)+1;chrome.runtime.sendMessage({type:"SET_DROP_HINT",data:{slot:y}})}catch(y){console.debug("Failed to send drop hint message for slot",(c??0)+1,":",y instanceof Error?y.message:y)}},[c]),d.useCallback((y,S)=>{y.preventDefault(),console.log("ðŸŽ¯ Drag enter on drop zone",S),l(S)},[]),d.useCallback((y,S)=>{if(y.preventDefault(),y.dataTransfer)try{y.dataTransfer.dropEffect="copy"}catch(C){console.debug("Cannot set dropEffect on dataTransfer (browser security):",C instanceof Error?C.message:C)}l(S)},[]),d.useCallback(y=>{y.preventDefault(),console.log("ðŸš« Drag leave drop zone"),l(null)},[]),d.useCallback((y,S)=>{if(y.preventDefault(),y.dataTransfer)try{y.dataTransfer.dropEffect="copy"}catch(M){console.debug("Cannot set dropEffect on dataTransfer (browser security):",M instanceof Error?M.message:M)}if(console.log("ðŸŽ¯ Drop event triggered on zone",S,"with files:",y.dataTransfer?.files?.length??0),l(null),!y.dataTransfer)return console.log("âŒ No dataTransfer on drag event"),De.noFiles(),!1;let C=[];if(y.dataTransfer.files&&y.dataTransfer.files.length>0)C=Array.from(y.dataTransfer.files);else if(y.dataTransfer.items&&y.dataTransfer.items.length>0){const M=[];for(const k of Array.from(y.dataTransfer.items))if(k.kind==="file"){const j=k.getAsFile();j&&M.push(j)}C=M}if(!C.length)return console.log("âŒ No file items present in drag operation"),De.noFiles(),!1;console.log("ðŸ“ Files detected:",C.map(M=>`${M.name} (${M.type})`));const T=C.find(M=>M.type.startsWith("image/"));return T?(console.log("âœ… Processing image file:",T.name,T.type),b(T,S)):(console.log("âŒ No valid image files found"),De.invalidFile()),!1},[b]),d.useCallback((y,S)=>{const C=y.target.files;C&&C.length>0&&b(C[0],S),y.target.value=""},[b]);const g=d.useCallback(y=>{i(S=>{const C=[...S];return C[y]=null,C}),De.imageRemoved(y)},[]),x=d.useCallback((y,S)=>{try{const C=new Image;C.onload=()=>{const T={id:`slot-${S}-${Date.now()}`,dataUrl:y,timestamp:Date.now(),width:C.width,height:C.height};i(M=>{const k=[...M];return k[S]=T,k}),De.imageAdded(S)},C.src=y}catch(C){console.error("Failed to import data URL image",C),De.importFailed()}},[]);d.useEffect(()=>{const y=S=>{if(S?.type==="PAGE_FILE_DROPPED"&&S.payload?.dataUrl){let C=c;if(C==null||a[C]!==null){const T=a.findIndex(M=>M===null);C=T>=0?T:0}x(S.payload.dataUrl,C)}};return chrome.runtime.onMessage.addListener(y),()=>chrome.runtime.onMessage.removeListener(y)},[a,c,x]);const w=({index:y,screenshot:S})=>{const C=d.useCallback(P=>{console.log("ðŸ“¥ react-dropzone onDrop accepted:",P.map(_=>`${_.name} (${_.type||"unknown"})`)),P&&P.length>0?b(P[0],y):De.invalidFile()},[b,y]),{getRootProps:T,getInputProps:M,isDragActive:k,open:j}=ei({onDrop:C,onDragEnter:()=>{console.log("ðŸŸ¦ dropzone dragenter",y),l(y)},onDragOver:()=>{l(y)},onDragLeave:()=>{console.log("â¬œ dropzone dragleave",y),l(P=>P===y?null:P)},accept:{"image/*":[]},multiple:!1,noKeyboard:!0,useFsAccessApi:!1}),A=k||o===y;return t.jsxs("div",{...T({className:`
          relative aspect-video rounded-lg border-2 border-dashed cursor-pointer transition-all duration-200
          ${A?"border-blue-500 bg-blue-50 scale-105":S?"border-gray-300 bg-gray-50":"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-25"} ${c===y?"ring-2 ring-blue-500":""}
        `,onClick:P=>{P.preventDefault(),u(y),j()},"data-drop-zone":"true"}),children:[t.jsx("input",{...M({accept:"image/*"})}),S?t.jsxs("div",{className:"relative w-full h-full group",children:[t.jsx("img",{src:S.dataUrl,alt:`Screenshot ${y+1}`,className:"w-full h-full object-cover rounded-lg",draggable:!1,onDragStart:P=>P.preventDefault()}),t.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:y+1}),t.jsx("button",{onClick:P=>{P.preventDefault(),P.stopPropagation(),g(y)},className:"absolute top-2 left-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx(Ie,{className:"w-3 h-3"})}),t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 rounded-lg transition-all"})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center",children:[t.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-3 ${A?"bg-blue-200":"bg-gray-200"}`,children:A?t.jsx(Mi,{className:"w-6 h-6 text-blue-600"}):t.jsx(Ii,{className:"w-6 h-6 text-gray-500"})}),t.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-1 flex items-center justify-center gap-2",children:[t.jsxs("span",{children:["Slot ",y+1]}),c===y&&t.jsx("span",{className:"text-xs text-blue-600 font-semibold",children:"Next"})]}),t.jsx("div",{className:"text-xs text-gray-500",children:A?"Drop image here":"Drag image or click"})]})]})},I=d.useCallback(async()=>{if(!a.some(S=>S!==null)){De.noScreenshots();return}s(!0);try{f.current.clear(),f.current.setGrid(a),await f.current.copyToClipboard();const S=a.filter(Boolean).length;De.imagesCombined(S)}catch(S){console.error("Failed to combine and copy screenshots:",S),De.combineFailed(S instanceof Error?S.message:void 0)}finally{s(!1)}},[a]),R=d.useCallback(()=>{i([null,null,null,null]),u(0),f.current.clear(),De.allCleared()},[]),D=a.filter(y=>y!==null).length,v=D>0&&!r;return d.useEffect(()=>{const y=C=>{C.preventDefault()},S=C=>{C.target?.closest('[data-drop-zone="true"]')||C.preventDefault()};return window.addEventListener("dragover",y,!0),window.addEventListener("drop",y,!0),window.addEventListener("dragenter",S,!0),()=>{window.removeEventListener("dragover",y,!0),window.removeEventListener("drop",y,!0),window.removeEventListener("dragenter",S,!0)}},[]),t.jsx(Ae,{children:t.jsx(B.div,{ref:h,className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center",variants:pe(ka),initial:"hidden",animate:"visible",exit:"exit",onClick:y=>{y.target===y.currentTarget&&m()},children:t.jsxs(B.div,{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",variants:pe(ja),initial:"hidden",animate:"visible",exit:"exit",onClick:y=>y.stopPropagation(),children:[t.jsxs(B.div,{className:"flex items-center justify-between p-6 border-b border-gray-200",variants:pe(It),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx(pa,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Screenshot Combiner"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Drag and drop up to 4 screenshots to combine them"})]})]}),t.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(Ie,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"px-6 py-4 border-b border-gray-100 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-600",children:D===0?"No screenshots added yet":`${D}/4 screenshots ready`}),r&&t.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-sm",children:"Combining..."})]})]})}),t.jsxs("div",{className:"flex-1 p-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.jsx(w,{index:0,screenshot:a[0]}),t.jsx(w,{index:1,screenshot:a[1]}),t.jsx(w,{index:2,screenshot:a[2]}),t.jsx(w,{index:3,screenshot:a[3]})]}),t.jsxs("div",{className:"text-center text-sm text-gray-600 space-y-2",children:[t.jsx("p",{children:"Drag screenshots from your desktop or click to browse files."}),t.jsx("p",{children:"Supports PNG, JPG, and GIF formats. Screenshots will be combined vertically."})]})]}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[t.jsx("div",{className:"flex items-center space-x-2",children:D>0&&t.jsxs("button",{onClick:R,className:"flex items-center space-x-2 px-3 py-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:[t.jsx(an,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Clear All"})]})}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:m,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Close"}),t.jsxs("button",{onClick:I,disabled:!v||r,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r?t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):t.jsx(la,{className:"w-4 h-4"}),t.jsx("span",{children:r?"Combining...":"Combine & Copy"})]})]})]})]})})})},Zs=({isOpen:n,comparison:e,textToInsert:a,onConfirm:i,onCancel:r,onRefreshEMR:s})=>{if(!n||!e)return null;const o=u=>{switch(u){case"high":return"text-green-600";case"medium":return"text-yellow-600";case"low":return"text-red-600";default:return"text-gray-600"}},c=e.isMatch?{border:"border-green-200",bg:"bg-green-50",iconColor:"text-green-600",title:"Patient Names Match"}:e.similarityScore>.5?{border:"border-yellow-200",bg:"bg-yellow-50",iconColor:"text-yellow-600",title:"Patient Name Similarity Warning"}:{border:"border-red-200",bg:"bg-red-50",iconColor:"text-red-600",title:"Patient Name Mismatch Warning"};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:`bg-white rounded-2xl shadow-xl max-w-md w-full ${c.border} border-2`,children:[t.jsx("div",{className:`${c.bg} px-6 py-4 rounded-t-2xl border-b border-gray-200`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(bt,{className:`w-6 h-6 ${c.iconColor}`}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:c.title})]}),t.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 transition-colors",children:t.jsx(Ie,{className:"w-5 h-5"})})]})}),t.jsxs("div",{className:"px-6 py-4 space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Pt,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Session Patient Name:"})]}),t.jsxs("div",{className:"ml-6 p-3 bg-blue-50 rounded-lg border",children:[t.jsx("div",{className:"text-sm font-medium text-blue-900",children:e.sessionPatientName}),t.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"From dictation session"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ot,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current EMR Patient:"})]}),t.jsxs("div",{className:"ml-6 p-3 bg-green-50 rounded-lg border",children:[t.jsx("div",{className:"text-sm font-medium text-green-900",children:e.emrPatientName}),t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Currently open EMR file"})]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Similarity Score:"}),t.jsxs("span",{className:`text-sm font-bold ${o(e.confidence)}`,children:[Math.round(e.similarityScore*100),"%"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Confidence Level:"}),t.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${e.confidence==="high"?"bg-green-100 text-green-800":e.confidence==="medium"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:e.confidence.toUpperCase()})]})]}),e.warnings.length>0&&t.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:[t.jsx("div",{className:"text-sm font-medium text-orange-800 mb-2",children:"Warnings:"}),t.jsx("ul",{className:"text-xs text-orange-700 space-y-1",children:e.warnings.map((u,f)=>t.jsxs("li",{className:"flex items-start space-x-1",children:[t.jsx("span",{className:"w-1 h-1 bg-orange-600 rounded-full mt-1.5 flex-shrink-0"}),t.jsx("span",{children:u})]},f))})]}),a&&t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Text to Insert:"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 max-h-32 overflow-y-auto",children:[t.jsx("div",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:a.length>200?`${a.substring(0,200)}...`:a}),a.length>200&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Showing first 200 characters (",a.length," total)"]})]})]}),t.jsx("div",{className:`p-3 rounded-lg ${e.isMatch?"bg-green-100 border-green-200":"bg-red-100 border-red-200"} border`,children:t.jsx("div",{className:`text-sm ${e.isMatch?"text-green-800":"text-red-800"}`,children:e.isMatch?"The patient names appear to match. You can proceed with inserting the text.":"You are about to insert session results into a potentially different patient's EMR file. Please verify this is intentional."})})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Cancel"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[s&&t.jsx("button",{onClick:s,className:"px-4 py-2 text-blue-700 bg-blue-100 border border-blue-300 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium",children:"Refresh EMR"}),t.jsx("button",{onClick:i,className:`px-4 py-2 text-white rounded-lg font-medium text-sm transition-colors ${e.isMatch?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:e.isMatch?"Insert Text":"Insert Anyway"})]})]})})]})})},ti={isRecording:!1,isProcessing:!1,currentAgent:null,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,missingInfo:null,missingInfoAnswers:{},processingStatus:"idle",voiceActivityLevel:0,frequencyData:[],modelStatus:{isConnected:!1,classifierModel:"",processorModel:"",lastPing:0,latency:0},recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,currentAgentName:null,processingStartTime:null,failedAudioRecordings:[],reviewData:null,patientVersion:null,isGeneratingPatientVersion:!1,streamBuffer:"",ttftMs:null,streaming:!1,transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},patientMismatchData:{comparison:null,textToInsert:null,onConfirm:null,onCancel:null},patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null},ui:{activeWorkflow:null,isCancelling:!1,showAlerts:!0,showPatientSelectionModal:!1,showScreenshotAnnotationModal:!1,showPatientEducationConfig:!1,showPatientMismatchModal:!1,showMainMenu:!1,showRecordingPrompts:!1,showMetricsDashboard:!1,isExtractingPatients:!1,isBatchProcessing:!1,showFieldIngestionOverlay:!1,showProcessingPhase:!1,processingProgress:0,processingStartTime:0,warnings:[],errors:[],resultSummary:"",calendarData:null,extractError:null,batchProcessingProgress:null}};function eo(n,e){switch(e.type){case"SET_RECORDING":return n.isRecording===e.payload?n:{...n,isRecording:e.payload};case"SET_PROCESSING":return n.isProcessing===e.payload?n:{...n,isProcessing:e.payload};case"SET_CURRENT_AGENT":return n.currentAgent===e.payload?n:{...n,currentAgent:e.payload};case"SET_TRANSCRIPTION":return n.transcription===e.payload?n:{...n,transcription:e.payload};case"SET_RESULTS":return n.results===e.payload?n:{...n,results:e.payload};case"SET_RESULTS_SUMMARY":return n.resultsSummary===e.payload?n:{...n,resultsSummary:e.payload};case"SET_AI_GENERATED_SUMMARY":return n.aiGeneratedSummary===e.payload?n:{...n,aiGeneratedSummary:e.payload};case"SET_MISSING_INFO":return{...n,missingInfo:e.payload};case"SET_MISSING_INFO_ANSWERS":return{...n,missingInfoAnswers:e.payload};case"CLEAR_MISSING_INFO":return{...n,missingInfo:null,missingInfoAnswers:{}};case"SET_PROCESSING_STATUS":return n.processingStatus===e.payload?n:{...n,processingStatus:e.payload};case"SET_VOICE_ACTIVITY":return Date.now()-(n.modelStatus.lastPing||0)<200?n:{...n,voiceActivityLevel:e.payload.level,frequencyData:e.payload.frequencyData,modelStatus:{...n.modelStatus,lastPing:Date.now()}};case"SET_MODEL_STATUS":return{...n,modelStatus:e.payload};case"SET_TIMING_DATA":return{...n,...e.payload};case"SET_CURRENT_AGENT_NAME":return n.currentAgentName===e.payload?n:{...n,currentAgentName:e.payload};case"SET_FAILED_RECORDINGS":return{...n,failedAudioRecordings:e.payload};case"SET_REVIEW_DATA":return{...n,reviewData:e.payload};case"SET_ACTIVE_WORKFLOW":return n.ui.activeWorkflow===e.payload?n:{...n,ui:{...n.ui,activeWorkflow:e.payload}};case"SET_CANCELLING":return n.ui.isCancelling===e.payload?n:{...n,ui:{...n.ui,isCancelling:e.payload}};case"SET_WARNINGS":return{...n,ui:{...n.ui,warnings:e.payload}};case"SET_ERRORS":return{...n,ui:{...n.ui,errors:e.payload}};case"SET_ALERTS_VISIBLE":return n.ui.showAlerts===e.payload?n:{...n,ui:{...n.ui,showAlerts:e.payload}};case"SET_RESULT_SUMMARY":return n.ui.resultSummary===e.payload?n:{...n,ui:{...n.ui,resultSummary:e.payload}};case"SET_PATIENT_MODAL":return n.ui.showPatientSelectionModal===e.payload?n:{...n,ui:{...n.ui,showPatientSelectionModal:e.payload}};case"SET_SCREENSHOT_ANNOTATION_MODAL":return n.ui.showScreenshotAnnotationModal===e.payload?n:{...n,ui:{...n.ui,showScreenshotAnnotationModal:e.payload}};case"SET_PATIENT_EDUCATION_CONFIG":return n.ui.showPatientEducationConfig===e.payload?n:{...n,ui:{...n.ui,showPatientEducationConfig:e.payload}};case"SET_PATIENT_MISMATCH_MODAL":return n.ui.showPatientMismatchModal===e.payload?n:{...n,ui:{...n.ui,showPatientMismatchModal:e.payload}};case"SET_PATIENT_MISMATCH_DATA":return{...n,patientMismatchData:e.payload};case"SET_MAIN_MENU":return n.ui.showMainMenu===e.payload?n:{...n,ui:{...n.ui,showMainMenu:e.payload}};case"SET_RECORDING_PROMPTS":return n.ui.showRecordingPrompts===e.payload?n:{...n,ui:{...n.ui,showRecordingPrompts:e.payload}};case"SET_METRICS_DASHBOARD":return n.ui.showMetricsDashboard===e.payload?n:{...n,ui:{...n.ui,showMetricsDashboard:e.payload}};case"SET_CALENDAR_DATA":return{...n,ui:{...n.ui,calendarData:e.payload}};case"SET_EXTRACTING_PATIENTS":return n.ui.isExtractingPatients===e.payload?n:{...n,ui:{...n.ui,isExtractingPatients:e.payload}};case"SET_EXTRACT_ERROR":return n.ui.extractError===e.payload?n:{...n,ui:{...n.ui,extractError:e.payload}};case"SET_BATCH_PROCESSING":return n.ui.isBatchProcessing===e.payload?n:{...n,ui:{...n.ui,isBatchProcessing:e.payload}};case"SET_BATCH_PROGRESS":return{...n,ui:{...n.ui,batchProcessingProgress:e.payload}};case"SET_PROCESSING_START_TIME":return{...n,processingStartTime:e.payload};case"RESET_STATE":return ti;case"CLEAR_RECORDING":return console.log("ðŸ”„ CLEAR_RECORDING: Clearing state for new recording",{hadResults:!!n.results,hadReviewData:!!n.reviewData,currentAgent:n.currentAgent,processingStatus:n.processingStatus,wasDisplayingSession:n.displaySession.isDisplayingSession,wasStreaming:n.streaming,hadStreamBuffer:!!n.streamBuffer,currentSessionId:n.currentSessionId}),{...n,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,patientVersion:null,processingStatus:"idle",currentAgent:null,currentAgentName:null,recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,processingStartTime:null,reviewData:null,streaming:!1,streamBuffer:"",ttftMs:null,currentSessionId:null,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null},transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},ui:{...n.ui,activeWorkflow:null,warnings:[],errors:[],resultSummary:"",isCancelling:!1}};case"SET_CURRENT_PATIENT_INFO":return{...n,currentPatientInfo:e.payload};case"ADD_PATIENT_SESSION":return{...n,patientSessions:[e.payload,...n.patientSessions]};case"UPDATE_PATIENT_SESSION":return{...n,patientSessions:n.patientSessions.map(r=>r.id===e.payload.id?{...r,...e.payload.updates}:r)};case"REMOVE_PATIENT_SESSION":return{...n,patientSessions:n.patientSessions.filter(r=>r.id!==e.payload)};case"CLEAR_PATIENT_SESSIONS":return{...n,patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null};case"SET_CURRENT_SESSION_ID":return{...n,currentSessionId:e.payload};case"SET_SELECTED_SESSION_ID":return{...n,selectedSessionId:e.payload};case"SET_FIELD_INGESTION_OVERLAY":return{...n,ui:{...n.ui,showFieldIngestionOverlay:e.payload}};case"SET_PROCESSING_PHASE":return{...n,ui:{...n.ui,showProcessingPhase:e.payload}};case"SET_PROCESSING_PROGRESS":return{...n,ui:{...n.ui,processingProgress:e.payload}};case"SET_AI_REVIEW_START_TIME":return{...n,ui:{...n.ui,processingStartTime:e.payload}};case"SET_PATIENT_VERSION":return n.patientVersion===e.payload?n:{...n,patientVersion:e.payload};case"SET_GENERATING_PATIENT_VERSION":return n.isGeneratingPatientVersion===e.payload?n:{...n,isGeneratingPatientVersion:e.payload};case"RESULTS_STREAMING":return{...n,streaming:e.payload};case"RESULTS_CLEAR_STREAM":return{...n,streamBuffer:"",ttftMs:null};case"RESULTS_APPEND_STREAM_CHUNK":return{...n,streamBuffer:(n.streamBuffer||"")+e.payload};case"RESULTS_TTFT":return{...n,ttftMs:e.payload};case"RESULTS_STREAM_DONE":return{...n,results:e.payload.final,streamBuffer:"",streaming:!1,ttftMs:e.payload.ttftMs??n.ttftMs??null,processingStatus:"complete"};case"RESULTS_STREAM_ERROR":return{...n,ui:{...n.ui,errors:[...n.ui.errors,e.payload]},streaming:!1};case"RESULTS_STREAM_CANCELLED":return{...n,streaming:!1};case"SET_TRANSCRIPTION_APPROVAL":return{...n,transcriptionApproval:e.payload};case"SET_DISPLAY_SESSION":const i=e.payload.session;return{...n,selectedSessionId:i.id,displaySession:{isDisplayingSession:!0,displaySessionId:i.id,displayTranscription:i.transcription||"",displayResults:i.results||"",displaySummary:i.summary,displayAgent:i.agentType||null,displayAgentName:i.agentName||null,displayPatientInfo:i.patient||null}};case"CLEAR_DISPLAY_SESSION":return{...n,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null}};default:return n}}function to(){const[n,e]=d.useReducer(eo,ti),a=d.useRef(0),i={setRecording:d.useCallback(r=>{e({type:"SET_RECORDING",payload:r})},[]),setProcessing:d.useCallback(r=>{e({type:"SET_PROCESSING",payload:r})},[]),setCurrentAgent:d.useCallback(r=>{e({type:"SET_CURRENT_AGENT",payload:r})},[]),setTranscription:d.useCallback(r=>{e({type:"SET_TRANSCRIPTION",payload:r})},[]),setResults:d.useCallback(r=>{e({type:"SET_RESULTS",payload:r})},[]),setResultsSummary:d.useCallback(r=>{e({type:"SET_RESULTS_SUMMARY",payload:r})},[]),setAiGeneratedSummary:d.useCallback(r=>{e({type:"SET_AI_GENERATED_SUMMARY",payload:r})},[]),setMissingInfo:d.useCallback(r=>{e({type:"SET_MISSING_INFO",payload:r})},[]),setMissingInfoAnswers:d.useCallback(r=>{e({type:"SET_MISSING_INFO_ANSWERS",payload:r})},[]),clearMissingInfo:d.useCallback(()=>{e({type:"CLEAR_MISSING_INFO"})},[]),setProcessingStatus:d.useCallback(r=>{e({type:"SET_PROCESSING_STATUS",payload:r})},[]),setVoiceActivity:d.useCallback((r,s)=>{const o=Date.now();o-a.current>=200&&(a.current=o,e({type:"SET_VOICE_ACTIVITY",payload:{level:r,frequencyData:s}}))},[]),setModelStatus:d.useCallback(r=>{e({type:"SET_MODEL_STATUS",payload:r})},[]),setTimingData:d.useCallback(r=>{e({type:"SET_TIMING_DATA",payload:r})},[]),setCurrentAgentName:d.useCallback(r=>{e({type:"SET_CURRENT_AGENT_NAME",payload:r})},[]),setFailedRecordings:d.useCallback(r=>{e({type:"SET_FAILED_RECORDINGS",payload:r})},[]),setReviewData:d.useCallback(r=>{e({type:"SET_REVIEW_DATA",payload:r})},[]),setActiveWorkflow:d.useCallback(r=>{e({type:"SET_ACTIVE_WORKFLOW",payload:r})},[]),setCancelling:d.useCallback(r=>{e({type:"SET_CANCELLING",payload:r})},[]),setWarnings:d.useCallback(r=>{e({type:"SET_WARNINGS",payload:r})},[]),setErrors:d.useCallback(r=>{e({type:"SET_ERRORS",payload:r})},[]),setAlertsVisible:d.useCallback(r=>{e({type:"SET_ALERTS_VISIBLE",payload:r})},[]),setResultSummary:d.useCallback(r=>{e({type:"SET_RESULT_SUMMARY",payload:r})},[]),setPatientModal:d.useCallback(r=>{e({type:"SET_PATIENT_MODAL",payload:r})},[]),setScreenshotAnnotationModal:d.useCallback(r=>{e({type:"SET_SCREENSHOT_ANNOTATION_MODAL",payload:r})},[]),setPatientEducationConfig:d.useCallback(r=>{e({type:"SET_PATIENT_EDUCATION_CONFIG",payload:r})},[]),setPatientMismatchModal:d.useCallback(r=>{e({type:"SET_PATIENT_MISMATCH_MODAL",payload:r})},[]),setPatientMismatchData:d.useCallback(r=>{e({type:"SET_PATIENT_MISMATCH_DATA",payload:r})},[]),setMainMenu:d.useCallback(r=>{e({type:"SET_MAIN_MENU",payload:r})},[]),setRecordingPrompts:d.useCallback(r=>{e({type:"SET_RECORDING_PROMPTS",payload:r})},[]),setMetricsDashboard:d.useCallback(r=>{e({type:"SET_METRICS_DASHBOARD",payload:r})},[]),setCalendarData:d.useCallback(r=>{e({type:"SET_CALENDAR_DATA",payload:r})},[]),setExtractingPatients:d.useCallback(r=>{e({type:"SET_EXTRACTING_PATIENTS",payload:r})},[]),setExtractError:d.useCallback(r=>{e({type:"SET_EXTRACT_ERROR",payload:r})},[]),setBatchProcessing:d.useCallback(r=>{e({type:"SET_BATCH_PROCESSING",payload:r})},[]),setBatchProgress:d.useCallback(r=>{e({type:"SET_BATCH_PROGRESS",payload:r})},[]),setProcessingStartTime:d.useCallback(r=>{e({type:"SET_PROCESSING_START_TIME",payload:r})},[]),resetState:d.useCallback(()=>{e({type:"RESET_STATE"})},[]),clearRecording:d.useCallback(()=>{e({type:"CLEAR_RECORDING"})},[]),setCurrentPatientInfo:d.useCallback(r=>{e({type:"SET_CURRENT_PATIENT_INFO",payload:r})},[]),addPatientSession:d.useCallback(r=>{e({type:"ADD_PATIENT_SESSION",payload:r})},[]),updatePatientSession:d.useCallback((r,s)=>{e({type:"UPDATE_PATIENT_SESSION",payload:{id:r,updates:s}})},[]),removePatientSession:d.useCallback(r=>{e({type:"REMOVE_PATIENT_SESSION",payload:r})},[]),clearPatientSessions:d.useCallback(()=>{e({type:"CLEAR_PATIENT_SESSIONS"})},[]),setCurrentSessionId:d.useCallback(r=>{e({type:"SET_CURRENT_SESSION_ID",payload:r})},[]),setSelectedSessionId:d.useCallback(r=>{e({type:"SET_SELECTED_SESSION_ID",payload:r})},[]),setFieldIngestionOverlay:d.useCallback(r=>{e({type:"SET_FIELD_INGESTION_OVERLAY",payload:r})},[]),setProcessingPhase:d.useCallback(r=>{e({type:"SET_PROCESSING_PHASE",payload:r})},[]),setProcessingProgress:d.useCallback(r=>{e({type:"SET_PROCESSING_PROGRESS",payload:r})},[]),setAIReviewStartTime:d.useCallback(r=>{e({type:"SET_AI_REVIEW_START_TIME",payload:r})},[]),setPatientVersion:d.useCallback(r=>{e({type:"SET_PATIENT_VERSION",payload:r})},[]),setGeneratingPatientVersion:d.useCallback(r=>{e({type:"SET_GENERATING_PATIENT_VERSION",payload:r})},[]),setStreaming:d.useCallback(r=>{e({type:"RESULTS_STREAMING",payload:r})},[]),clearStream:d.useCallback(()=>{e({type:"RESULTS_CLEAR_STREAM"})},[]),appendStreamChunk:d.useCallback(r=>{e({type:"RESULTS_APPEND_STREAM_CHUNK",payload:r})},[]),setTTFT:d.useCallback(r=>{e({type:"RESULTS_TTFT",payload:r})},[]),streamDone:d.useCallback((r,s,o)=>{e({type:"RESULTS_STREAM_DONE",payload:{final:r,usage:s,ttftMs:o}})},[]),streamError:d.useCallback(r=>{e({type:"RESULTS_STREAM_ERROR",payload:r})},[]),streamCancelled:d.useCallback(()=>{e({type:"RESULTS_STREAM_CANCELLED"})},[]),setTranscriptionApproval:d.useCallback(r=>{e({type:"SET_TRANSCRIPTION_APPROVAL",payload:r})},[]),setDisplaySession:d.useCallback(r=>{e({type:"SET_DISPLAY_SESSION",payload:{session:r}})},[]),clearDisplaySession:d.useCallback(()=>{e({type:"CLEAR_DISPLAY_SESSION"})},[])};return{state:n,actions:i}}class ut{static instance;defaultTimeout=15e3;defaultInterval=500;debugMode=!1;constructor(){}static getInstance(){return ut.instance||(ut.instance=new ut),ut.instance}setDebugMode(e){this.debugMode=e}async waitForPatientDataLoad(e,a,i=this.defaultTimeout){const r=[{name:"content_script_responsive",checker:()=>this.checkContentScriptResponsive(e),description:"Content script is responsive",timeout:5e3,interval:200},{name:"xestro_boxes_present",checker:()=>this.checkXestroBoxesPresent(e),description:"XestroBox elements are present",timeout:i,interval:this.defaultInterval},{name:"patient_data_populated",checker:()=>this.checkPatientDataPopulated(e,a),description:"Patient data fields are populated",timeout:i,interval:this.defaultInterval},{name:"clinical_sections_ready",checker:()=>this.checkClinicalSectionsReady(e),description:"Clinical sections have content",timeout:i,interval:this.defaultInterval}];return this.waitForMultipleConditions(r,{requireAll:!1,minConditions:2,earlyReturnOnCritical:!0})}async waitForClinicalSection(e,a,i=this.defaultTimeout){const r=[{name:`${a}_section_present`,checker:()=>this.checkSectionPresent(e,a),description:`${a} section is present in DOM`,timeout:i/2,interval:this.defaultInterval},{name:`${a}_content_loaded`,checker:()=>this.checkSectionContentLoaded(e,a),description:`${a} section has content`,timeout:i,interval:this.defaultInterval}];return this.waitForMultipleConditions(r,{requireAll:!0,minConditions:2,earlyReturnOnCritical:!1})}async waitForPatientActivation(e,a,i=1e4){const r=[{name:"patient_row_highlighted",checker:()=>this.checkPatientRowHighlighted(e,a),description:"Patient row is highlighted/selected",timeout:i/3,interval:200},{name:"patient_record_loading",checker:()=>this.checkPatientRecordLoading(e),description:"Patient record is loading",timeout:i/2,interval:this.defaultInterval},{name:"patient_record_loaded",checker:()=>this.checkPatientRecordLoaded(e),description:"Patient record is fully loaded",timeout:i,interval:this.defaultInterval}];return this.waitForMultipleConditions(r,{requireAll:!1,minConditions:1,earlyReturnOnCritical:!0,sequentialChecking:!0})}async waitForDOMStability(e,a=1e3,i=this.defaultTimeout){const r=Date.now(),s=[];let o=Date.now(),l="";for(;Date.now()-r<i;)try{const c=await this.getDOMHash(e),u=Date.now();if(c!==l)o=u,l=c,s.push({timestamp:u,conditionName:"dom_changed",passed:!1,details:"DOM structure changed"});else if(u-o>=a)return s.push({timestamp:u,conditionName:"dom_stable",passed:!0,details:`DOM stable for ${a}ms`}),{success:!0,timeElapsed:u-r,conditionMet:"dom_stable",intermediateChecks:s};await this.sleep(200)}catch(c){this.log("Error checking DOM stability:",c),await this.sleep(this.defaultInterval)}return{success:!1,timeElapsed:Date.now()-r,conditionMet:null,error:`DOM did not stabilize within ${i}ms`,intermediateChecks:s}}async waitForCondition(e,a={}){const i=Date.now(),r=[],{earlyReturn:s=!0,logProgress:o=this.debugMode}=a;for(this.log(`Starting wait for condition: ${e.name} - ${e.description}`);Date.now()-i<e.timeout;)try{const c=await e.checker(),u=Date.now();if(r.push({timestamp:u,conditionName:e.name,passed:c,details:c?"Condition met":"Condition not met"}),c){const f=u-i;return this.log(`âœ… Condition '${e.name}' met in ${f}ms`),{success:!0,timeElapsed:f,conditionMet:e.name,intermediateChecks:r}}o&&r.length%10===0&&this.log(`â³ Still waiting for '${e.name}' (${Date.now()-i}ms elapsed)`),await this.sleep(e.interval)}catch(c){r.push({timestamp:Date.now(),conditionName:e.name,passed:!1,details:`Error: ${c instanceof Error?c.message:String(c)}`}),this.log(`âŒ Error checking condition '${e.name}':`,c),await this.sleep(e.interval)}const l=Date.now()-i;return this.log(`â° Timeout waiting for condition '${e.name}' after ${l}ms`),{success:!1,timeElapsed:l,conditionMet:null,error:`Timeout waiting for condition '${e.name}'`,intermediateChecks:r}}async waitForMultipleConditions(e,a){const i=Date.now(),r=[],s=new Set,o=Math.max(...e.map(f=>f.timeout));if(this.log(`Starting multi-condition wait: ${e.length} conditions`),a.sequentialChecking)for(const f of e){const h=await this.waitForCondition(f);if(r.push(...h.intermediateChecks),h.success)s.add(f.name);else if(a.requireAll)return{success:!1,timeElapsed:Date.now()-i,conditionMet:null,error:`Sequential condition failed: ${f.name}`,intermediateChecks:r}}else for(;Date.now()-i<o;){for(const h of e)if(!s.has(h.name))try{const m=await h.checker(),b=Date.now();r.push({timestamp:b,conditionName:h.name,passed:m,details:m?"Condition met":"Condition not met"}),m&&(s.add(h.name),this.log(`âœ… Condition met: ${h.name}`))}catch(m){r.push({timestamp:Date.now(),conditionName:h.name,passed:!1,details:`Error: ${m instanceof Error?m.message:String(m)}`})}const f=s.size;if(a.requireAll&&f===e.length)break;if(!a.requireAll&&f>=a.minConditions)break;await this.sleep(Math.min(...e.map(h=>h.interval)))}const l=s.size,c=a.requireAll?l===e.length:l>=a.minConditions,u=Date.now()-i;return c?this.log(`âœ… Multi-condition wait successful: ${l}/${e.length} conditions met`):this.log(`âŒ Multi-condition wait failed: ${l}/${e.length} conditions met`),{success:c,timeElapsed:u,conditionMet:c?Array.from(s).join(", "):null,error:c?void 0:`Insufficient conditions met: ${l}/${a.minConditions}`,intermediateChecks:r}}async checkContentScriptResponsive(e){try{return!!await this.sendMessage(e,{type:"PING"},2e3)}catch{return!1}}async checkXestroBoxesPresent(e){try{return(await this.sendMessage(e,{type:"CHECK_XESTRO_BOXES"},3e3))?.found===!0}catch{return!1}}async checkPatientDataPopulated(e,a){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_DATA",data:{expectedPatientName:a}},3e3))?.populated===!0}catch{return!1}}async checkClinicalSectionsReady(e){try{return(await this.sendMessage(e,{type:"CHECK_CLINICAL_SECTIONS"},3e3))?.sectionsReady===!0}catch{return!1}}async checkSectionPresent(e,a){try{return(await this.sendMessage(e,{type:"CHECK_SECTION_PRESENT",data:{sectionType:a}},3e3))?.present===!0}catch{return!1}}async checkSectionContentLoaded(e,a){try{const i=await this.sendMessage(e,{type:"CHECK_SECTION_CONTENT",data:{sectionType:a}},3e3);return i?.hasContent===!0&&i?.wordCount>0}catch{return!1}}async checkPatientRowHighlighted(e,a){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_ROW_HIGHLIGHTED",data:{patientIndex:a}},2e3))?.highlighted===!0}catch{return!1}}async checkPatientRecordLoading(e){try{const a=await this.sendMessage(e,{type:"CHECK_PATIENT_RECORD_STATE"},2e3);return a?.state==="loading"||a?.state==="loaded"}catch{return!1}}async checkPatientRecordLoaded(e){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_RECORD_STATE"},2e3))?.state==="loaded"}catch{return!1}}async getDOMHash(e){try{return(await this.sendMessage(e,{type:"GET_DOM_HASH"},2e3))?.hash||""}catch{return""}}async sendMessage(e,a,i=5e3){return new Promise((r,s)=>{const o=setTimeout(()=>{s(new Error(`Message timeout after ${i}ms`))},i);try{chrome.tabs.sendMessage(e,a,l=>{if(clearTimeout(o),chrome.runtime.lastError){s(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}r(l)})}catch(l){clearTimeout(o),s(l)}})}async sleep(e){return new Promise(a=>setTimeout(a,e))}log(...e){this.debugMode&&console.log("[DynamicWaitUtils]",...e)}setDefaultTimeout(e){this.defaultTimeout=e}setDefaultInterval(e){this.defaultInterval=e}getDefaultTimeout(){return this.defaultTimeout}getDefaultInterval(){return this.defaultInterval}}class mt{static instance;debugMode=!1;medicalTermPatterns=[];commonErrorPatterns=[];defaultConfig={fields:["background","investigations","medications"],fallbackSelectors:{background:['textarea[data-field="background"]',"#background",".background textarea",'.XestroBox:contains("Background") textarea','textarea[placeholder*="background" i]'],investigations:['textarea[data-field="investigations"]',"#investigations",".investigations textarea",'.XestroBox:contains("Investigation") textarea','textarea[placeholder*="investigation" i]'],medications:['textarea[data-field="medications"]',"#medications",".medications textarea",'.XestroBox:contains("Medication") textarea','textarea[placeholder*="medication" i]']},qualityThresholds:{minWordCount:5,minMedicalTerms:1,minCompletenessScore:.3,acceptableConfidenceLevel:"medium"},retryAttempts:3,timeout:1e4,screenshotOnFailure:!0};constructor(){this.initializeMedicalPatterns(),this.initializeErrorPatterns()}static getInstance(){return mt.instance||(mt.instance=new mt),mt.instance}async extractPatientClinicalData(e,a,i={}){const r={...this.defaultConfig,...i},s=Date.now();this.log(`ðŸ” Starting data extraction for patient: ${a.name}`);const o=await this.preExtractionValidation(e,a);if(!o.isValid)throw new Error(`Pre-extraction validation failed: ${o.errors.join(", ")}`);const l=new Map;for(const h of r.fields)try{const m=await this.extractField(e,h,r);l.set(h,m),m.success?this.log(`âœ… Successfully extracted ${h}: ${m.content.length} chars`):this.log(`âŒ Failed to extract ${h}: ${m.errorMessage}`)}catch(m){this.log(`âŒ Exception extracting ${h}:`,m),l.set(h,{fieldName:h,content:"",extractionTime:0,success:!1,errorMessage:m instanceof Error?m.message:String(m),quality:this.createEmptyQualityReport(),fallbackUsed:!1,selectorUsed:"none"})}const c={background:l.get("background")?.content||"",investigations:l.get("investigations")?.content||"",medications:l.get("medications")?.content||"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:this.calculateOverallQualityScore(l)},u=this.assessDataQuality(c);if(this.log("ðŸ“Š Data quality assessment:",{completeness:u.completenessScore,richness:u.contentRichness,confidence:u.confidenceLevel,medicalTerms:u.medicalTermsFound}),u.completenessScore<r.qualityThresholds.minCompletenessScore){this.log("âš ï¸ Low quality data detected, attempting fallback extraction");const h=await this.attemptFallbackExtraction(e,c,l,r);if(h)return h}const f=Date.now()-s;return this.log(`âœ… Data extraction completed in ${f}ms`),c}assessDataQuality(e){const a=["background","investigations","medications"],i=a.length;let r=0,s=0,o=0;const l=[],c=[];for(const b of a){const g=e[b];if(this.isContentMeaningful(g)){r++;const x=this.countWords(g),w=this.countMedicalTerms(g);s+=x,o+=w,this.containsErrorPatterns(g)&&c.push(`${b} contains potential error text`),x<5&&c.push(`${b} has very little content (${x} words)`)}else l.push(b)}const u=r/i,f=r>0?s/r:0,h=Math.min(1,f/50*.7+o/10*.3);let m="low";return u>=.8&&h>=.6&&o>=3?m="high":u>=.5&&h>=.3&&o>=1&&(m="medium"),{completenessScore:u,contentRichness:h,confidenceLevel:m,missingFields:l,extractionWarnings:c,medicalTermsFound:o,estimatedWordCount:s}}async verifyPatientIdentity(e,a){try{const i=await this.sendMessage(e,{type:"VERIFY_PATIENT_IDENTITY",data:{expectedName:a.name,expectedFileNumber:a.fileNumber,expectedDOB:a.dob}});if(i?.verified===!0)return{isValid:!0,errors:[],warnings:[],score:1};{const r=[`Patient identity mismatch. Expected: ${a.name} (${a.fileNumber})`];return i?.currentPatient&&r.push(`Current patient: ${i.currentPatient.name} (${i.currentPatient.fileNumber})`),{isValid:!1,errors:r,warnings:i?.warnings||[],score:0}}}catch(i){return{isValid:!1,errors:[`Failed to verify patient identity: ${i}`],warnings:[],score:0}}}async extractField(e,a,i){const r=Date.now(),s=i.fallbackSelectors[a]||[];for(let o=0;o<s.length;o++){const l=s[o],c=o===0;try{this.log(`ðŸ” Extracting ${a} with selector: ${l} (attempt ${o+1})`);const u=await this.sendMessage(e,{type:"EXTRACT_FIELD_DATA",data:{fieldName:a,selector:l,timeout:i.timeout/s.length}});if(u?.success&&u?.content){const f=this.sanitizeContent(u.content),h=this.assessFieldQuality(a,f);return{fieldName:a,content:f,extractionTime:Date.now()-r,success:!0,quality:h,fallbackUsed:!c,selectorUsed:l}}}catch(u){if(this.log(`âŒ Extraction attempt ${o+1} failed for ${a}:`,u),o<s.length-1)continue;return{fieldName:a,content:"",extractionTime:Date.now()-r,success:!1,errorMessage:u instanceof Error?u.message:String(u),quality:this.createEmptyQualityReport(),fallbackUsed:!c,selectorUsed:l}}}return{fieldName:a,content:"",extractionTime:Date.now()-r,success:!1,errorMessage:"All selectors failed",quality:this.createEmptyQualityReport(),fallbackUsed:!0,selectorUsed:"none"}}async preExtractionValidation(e,a){const i=[],r=[];try{const s=await this.verifyPatientIdentity(e,a);s.isValid||i.push(...s.errors),r.push(...s.warnings);const o=await this.sendMessage(e,{type:"CHECK_PAGE_READY_FOR_EXTRACTION"});o?.ready||(i.push("Page not ready for data extraction"),o?.reason&&i.push(`Reason: ${o.reason}`));const l=await this.sendMessage(e,{type:"CHECK_CLINICAL_SECTIONS_EXIST"});l?.allSectionsFound||(r.push("Some clinical sections may not be available"),l?.missingSections&&r.push(`Missing: ${l.missingSections.join(", ")}`))}catch(s){i.push(`Pre-extraction validation failed: ${s}`)}return{isValid:i.length===0,errors:i,warnings:r,score:i.length===0?1:0}}async attemptFallbackExtraction(e,a,i,r){this.log("ðŸ”„ Attempting fallback extraction strategies");const s=[];for(const[c,u]of i)(!u.success||u.quality.completenessScore<.5)&&s.push(c);if(s.length===0)return null;const o={...a};let l=!1;for(const c of s)try{const u=await this.tryOCRExtraction(e,c);if(u&&this.isContentMeaningful(u)&&(c==="background"||c==="investigations"||c==="medications")){o[c]=u,l=!0,this.log(`âœ… OCR extraction successful for ${c}`);continue}const f=await this.trySemanticExtraction(e,c);if(f&&this.isContentMeaningful(f)&&(c==="background"||c==="investigations"||c==="medications")){o[c]=f,l=!0,this.log(`âœ… Semantic extraction successful for ${c}`);continue}}catch(u){this.log(`âŒ Fallback extraction failed for ${c}:`,u)}return l?(o.extractionAttempts++,o.qualityScore=this.calculateOverallQualityScore(new Map([["improved",{fieldName:"improved",content:JSON.stringify(o),extractionTime:0,success:!0,quality:this.assessDataQuality(o),fallbackUsed:!0,selectorUsed:"fallback"}]])),o):null}async tryOCRExtraction(e,a){try{return(await this.sendMessage(e,{type:"EXTRACT_FIELD_OCR",data:{fieldName:a}}))?.content||null}catch{return null}}async trySemanticExtraction(e,a){try{return(await this.sendMessage(e,{type:"EXTRACT_FIELD_SEMANTIC",data:{fieldName:a}}))?.content||null}catch{return null}}isContentMeaningful(e){if(!e||typeof e!="string")return!1;const a=e.trim();return a.length<3?!1:![/^(\s*|-|n\/a|none|nil|not?\s*applicable?)$/i,/^\s*\[.*extraction.*failed.*\]\s*$/i,/^\s*loading\.+\s*$/i,/^\s*please\s+wait\.+\s*$/i].some(r=>r.test(a))}countWords(e){return e?e.trim().split(/\s+/).filter(a=>a.length>0).length:0}countMedicalTerms(e){if(!e)return 0;let a=0;for(const i of this.medicalTermPatterns){const r=e.match(i);r&&(a+=r.length)}return a}containsErrorPatterns(e){return this.commonErrorPatterns.some(a=>a.test(e))}sanitizeContent(e){return e?e.trim().replace(/\s+/g," ").replace(/[\x00-\x1F\x7F]/g,""):""}assessFieldQuality(e,a){const i=this.countWords(a),r=this.countMedicalTerms(a),s=this.isContentMeaningful(a),o=s?1:0,l=Math.min(1,i/20);let c="low";return o===1&&i>=10&&r>=1?c="high":o===1&&i>=5&&(c="medium"),{completenessScore:o,contentRichness:l,confidenceLevel:c,missingFields:s?[]:[e],extractionWarnings:this.containsErrorPatterns(a)?["Contains error patterns"]:[],medicalTermsFound:r,estimatedWordCount:i}}createEmptyQualityReport(){return{completenessScore:0,contentRichness:0,confidenceLevel:"low",missingFields:[],extractionWarnings:[],medicalTermsFound:0,estimatedWordCount:0}}calculateOverallQualityScore(e){const a=Array.from(e.values());if(a.length===0)return 0;const i=a.reduce((o,l)=>o+l.quality.completenessScore,0)/a.length,r=a.reduce((o,l)=>o+l.quality.contentRichness,0)/a.length,s=a.filter(o=>o.success).length/a.length;return i*.4+r*.3+s*.3}initializeMedicalPatterns(){this.medicalTermPatterns=[/\b(?:diagnosis|treatment|medication|prescription|symptom|condition|disease|disorder|syndrome)\b/gi,/\b\d+\s*(?:mg|mcg|g|ml|cc|units?|mmHg|bpm|kg|lbs?)\b/gi,/\b(?:angiogram|angioplasty|stent|bypass|catheter|biopsy|surgery|procedure)\b/gi,/\b(?:abnormal|normal|elevated|decreased|hypertension|diabetes|coronary|cardiac|pulmonary)\b/gi,/\b(?:paracetamol|lignocaine|adrenaline|salbutamol|glyceryl trinitrate)\b/gi]}initializeErrorPatterns(){this.commonErrorPatterns=[/error|failed|timeout|exception|null|undefined/gi,/loading\.+|please\s+wait\.+/gi,/access\s+denied|permission\s+denied/gi,/not\s+found|404|500|503/gi]}async sendMessage(e,a,i=5e3){return new Promise((r,s)=>{const o=setTimeout(()=>{s(new Error(`Message timeout after ${i}ms`))},i);try{chrome.tabs.sendMessage(e,a,l=>{if(clearTimeout(o),chrome.runtime.lastError){s(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}r(l)})}catch(l){clearTimeout(o),s(l)}})}log(...e){this.debugMode&&console.log("[DataValidation]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.defaultConfig,e)}getConfig(){return{...this.defaultConfig}}}class pt{static instance;strategies;circuitBreakers;failureHistory;config;debugMode=!1;constructor(){this.strategies=new Map,this.circuitBreakers=new Map,this.failureHistory=[],this.config=this.getDefaultConfig(),this.initializeStrategies()}static getInstance(){return pt.instance||(pt.instance=new pt),pt.instance}async executeWithRecovery(e,a,i){const r=`${a.operation}_${a.patientIndex}`;if(this.isCircuitBreakerOpen(r))throw new Error(`Circuit breaker is open for operation: ${a.operation}`);let s=null,o=0;const l=this.getMaxAttempts(a.operation);for(;o<l;)try{this.log(`ðŸ”„ Executing ${a.operation} (attempt ${o+1}/${l})`);const c=await e();return this.resetCircuitBreaker(r),this.log(`âœ… Operation ${a.operation} succeeded on attempt ${o+1}`),c}catch(c){o++,s=c instanceof Error?c:new Error(String(c)),this.log(`âŒ Attempt ${o} failed for ${a.operation}:`,s.message);const u=this.classifyError(s),f={patientIndex:a.patientIndex,patient:a.patient,operation:a.operation,error:s.message,timestamp:Date.now(),context:a,recoveryAttempted:!1},h=this.getStrategy(u,i);if(!h.shouldRetry(s,o,a)||o>=l){this.recordCircuitBreakerFailure(r),this.recordFailure(f);break}f.recoveryAttempted=!0,await this.applyRecoveryStrategy(h,s,o,a),this.recordFailure(f)}if(this.recordCircuitBreakerFailure(r),this.config.enableGracefulDegradation){const c=await this.attemptGracefulDegradation(a,s);if(c!==null)return this.log(`ðŸ”„ Graceful degradation successful for ${a.operation}`),c}throw new Error(`Operation ${a.operation} failed after ${o} attempts. Last error: ${s?.message}`)}shouldRetryOperation(e,a,i){const r=this.classifyError(a),s=this.strategies.get(r);if(!s)return!1;const o={operation:e,patientIndex:0,patient:{name:"",dob:"",fileNumber:"",appointmentTime:"",appointmentType:"",confirmed:!1,isFirstAppointment:!1},timestamp:Date.now(),environmentState:{tabId:0,currentUrl:"",contentScriptVersion:"",lastHealthCheck:0},previousAttempts:i-1};return s.shouldRetry(a,i,o)}getRetryDelay(e,a){const i=this.strategies.get(e);return i?this.calculateBackoffDelay(i.backoffStrategy,a,1e3):1e3}resetCircuitBreaker(e){const a=this.circuitBreakers.get(e);a&&(a.failures=0,a.state="closed",a.resetAttempts=0)}getFailureStats(){const e=new Map,a=new Map;for(const s of this.failureHistory){const o=this.classifyError(new Error(s.error));e.set(o,(e.get(o)||0)+1),a.set(s.operation,(a.get(s.operation)||0)+1)}const i=this.failureHistory.filter(s=>Date.now()-s.timestamp<3e5).slice(-10),r=Array.from(this.circuitBreakers.entries()).filter(([s,o])=>o.state==="open").map(([s,o])=>s);return{totalFailures:this.failureHistory.length,failuresByType:e,failuresByOperation:a,recentFailures:i,circuitBreakersOpen:r}}initializeStrategies(){this.strategies.set("network_timeout",{errorType:"network_timeout",maxRetries:3,backoffStrategy:"exponential",recoveryTimeout:3e4,shouldRetry:(e,a,i)=>a<=3&&!e.message.includes("permanent")}),this.strategies.set("dom_not_found",{errorType:"dom_not_found",maxRetries:5,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(e,a,i)=>a<=5,fallbackAction:async()=>null}),this.strategies.set("content_script_unresponsive",{errorType:"content_script_unresponsive",maxRetries:2,backoffStrategy:"fixed",recoveryTimeout:15e3,shouldRetry:(e,a,i)=>a<=2,fallbackAction:async()=>null}),this.strategies.set("extraction_failed",{errorType:"extraction_failed",maxRetries:4,backoffStrategy:"fibonacci",recoveryTimeout:25e3,shouldRetry:(e,a,i)=>a<=4&&!e.message.includes("no data available")}),this.strategies.set("ai_processing_failed",{errorType:"ai_processing_failed",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:6e4,shouldRetry:(e,a,i)=>a<=2&&!e.message.includes("model unavailable")}),this.strategies.set("navigation_failed",{errorType:"navigation_failed",maxRetries:3,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(e,a,i)=>a<=3}),this.strategies.set("permission_denied",{errorType:"permission_denied",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:5e3,shouldRetry:(e,a,i)=>!1}),this.strategies.set("memory_limit",{errorType:"memory_limit",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:1e4,shouldRetry:(e,a,i)=>a===1,fallbackAction:async()=>{try{window.gc&&window.gc()}catch{}return null}}),this.strategies.set("unknown",{errorType:"unknown",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:15e3,shouldRetry:(e,a,i)=>a<=2})}classifyError(e){const a=e.message.toLowerCase();return a.includes("timeout")||a.includes("timed out")?"network_timeout":a.includes("not found")||a.includes("element")||a.includes("selector")?"dom_not_found":a.includes("content script")||a.includes("script not responsive")?"content_script_unresponsive":a.includes("extraction")||a.includes("data")||a.includes("field")?"extraction_failed":a.includes("ai")||a.includes("model")||a.includes("processing")?"ai_processing_failed":a.includes("navigation")||a.includes("navigate")||a.includes("tab")?"navigation_failed":a.includes("permission")||a.includes("access denied")?"permission_denied":a.includes("memory")||a.includes("heap")||a.includes("out of memory")?"memory_limit":"unknown"}getStrategy(e,a){const i=this.strategies.get(e)||this.strategies.get("unknown");return a?{...i,...a}:i}async applyRecoveryStrategy(e,a,i,r){const s=this.calculateBackoffDelay(e.backoffStrategy,i);if(this.log(`ðŸ”„ Applying recovery strategy for ${e.errorType}, waiting ${s}ms`),e.fallbackAction)try{await e.fallbackAction(),this.log(`âœ… Fallback action executed for ${e.errorType}`)}catch(o){this.log(`âŒ Fallback action failed for ${e.errorType}:`,o)}await this.sleep(s),await this.performContextSpecificRecovery(r,e.errorType)}async performContextSpecificRecovery(e,a){switch(a){case"content_script_unresponsive":await this.recoverContentScript(e.environmentState.tabId);break;case"dom_not_found":await this.recoverDOMElements(e.environmentState.tabId);break;case"navigation_failed":await this.recoverNavigation(e.environmentState.tabId);break;case"memory_limit":await this.recoverMemory();break}}async recoverContentScript(e){try{this.log(`ðŸ”§ Attempting to recover content script on tab ${e}`),await chrome.scripting.executeScript({target:{tabId:e},files:["content-script.js"]}),await this.sleep(2e3)}catch(a){this.log("âŒ Content script recovery failed:",a)}}async recoverDOMElements(e){try{this.log(`ðŸ”§ Attempting to recover DOM elements on tab ${e}`),await this.sleep(1e3),await chrome.tabs.sendMessage(e,{type:"REFRESH_PAGE_SECTION"})}catch(a){this.log("âŒ DOM recovery failed:",a)}}async recoverNavigation(e){try{if(this.log(`ðŸ”§ Attempting to recover navigation on tab ${e}`),!await chrome.tabs.get(e))throw new Error("Tab no longer exists");await this.sleep(3e3)}catch(a){this.log("âŒ Navigation recovery failed:",a)}}async recoverMemory(){this.log("ðŸ”§ Attempting memory recovery"),this.failureHistory.length>100&&(this.failureHistory=this.failureHistory.slice(-50));const e=Date.now();for(const[a,i]of this.circuitBreakers)e-i.lastFailureTime>3e5&&this.circuitBreakers.delete(a);try{window.gc&&window.gc()}catch{}}calculateBackoffDelay(e,a,i=1e3){switch(e){case"exponential":return Math.min(i*Math.pow(2,a-1),3e4);case"linear":return Math.min(i*a,2e4);case"fibonacci":return Math.min(this.fibonacci(a)*i,25e3);case"fixed":default:return i}}fibonacci(e){if(e<=1)return 1;if(e===2)return 2;let a=1,i=2;for(let r=3;r<=e;r++){const s=a+i;a=i,i=s}return i}isCircuitBreakerOpen(e){const a=this.circuitBreakers.get(e);return a&&a.state==="open"?Date.now()-a.lastFailureTime>this.config.circuitBreakerResetTime?(a.state="half-open",a.resetAttempts++,!1):!0:!1}recordCircuitBreakerFailure(e){let a=this.circuitBreakers.get(e);a||(a={failures:0,lastFailureTime:0,state:"closed",resetAttempts:0},this.circuitBreakers.set(e,a)),a.failures++,a.lastFailureTime=Date.now(),a.failures>=this.config.circuitBreakerThreshold&&(a.state="open",this.log(`ðŸš¨ Circuit breaker opened for operation: ${e}`))}recordFailure(e){this.failureHistory.push(e),this.failureHistory.length>500&&(this.failureHistory=this.failureHistory.slice(-250))}getMaxAttempts(e){const a=["extract-data","ai-review"],i=["navigate","activate-patient"];return a.some(r=>e.includes(r))?5:i.some(r=>e.includes(r))?3:2}async attemptGracefulDegradation(e,a){switch(this.log(`ðŸ”„ Attempting graceful degradation for ${e.operation}`),e.operation){case"extract-data":return{background:"[Data extraction failed - manual review required]",investigations:"[Data extraction failed]",medications:"[Data extraction failed]"};case"ai-review":return{summary:"[AI review failed - manual review required]",findings:[],recommendations:[]};default:return null}}getDefaultConfig(){return{strategy:"conservative",maxTotalRetries:10,circuitBreakerThreshold:5,circuitBreakerResetTime:3e5,enableGracefulDegradation:!0,userNotificationEnabled:!0}}async sleep(e){return new Promise(a=>setTimeout(a,e))}log(...e){this.debugMode&&console.log("[ErrorRecoveryManager]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}clearHistory(){this.failureHistory=[],this.circuitBreakers.clear()}addCustomStrategy(e,a){this.strategies.set(e,a)}}class gt{static instance;config;storagePrefix="batch_checkpoint_";backupPrefix="backup_checkpoint_";debugMode=!1;constructor(){this.config=this.getDefaultConfig()}static getInstance(){return gt.instance||(gt.instance=new gt),gt.instance}async saveCheckpoint(e,a,i,r,s,o,l,c){const u=this.generateCheckpointId(e),f=Date.now();this.log(`ðŸ’¾ Saving checkpoint: ${u}`);const h={lastSuccessfulOperation:this.getLastSuccessfulOperation(i),skippedPatients:this.getSkippedPatients(i),retryQueue:this.buildRetryQueue(s),environmentState:c},m={id:u,batchId:e,timestamp:f,version:"1.0.0",totalPatients:a.selectedPatients.length,completedPatients:i,currentPatientIndex:r,failedAttempts:s,configuration:o,performanceMetrics:l,resumeData:h,integrityHash:""};m.integrityHash=await this.calculateIntegrityHash(m);try{const b=this.config.compressionEnabled?await this.compressData(m):JSON.stringify(m),g=this.config.encryptionEnabled?await this.encryptData(b):b,x=this.storagePrefix+u;if(await this.saveToStorage(x,g),this.config.backupEnabled){const w=this.backupPrefix+u;await this.saveToStorage(w,g)}return this.log(`âœ… Checkpoint saved successfully: ${u}`),await this.cleanupOldCheckpoints(e),u}catch(b){throw this.log("âŒ Failed to save checkpoint:",b),new Error(`Checkpoint save failed: ${b instanceof Error?b.message:String(b)}`)}}async loadCheckpoint(e){this.log(`ðŸ“‚ Loading checkpoint: ${e}`);try{let a=await this.loadFromStorage(this.storagePrefix+e);if(!a&&this.config.backupEnabled&&(this.log("âš ï¸ Primary checkpoint not found, trying backup"),a=await this.loadFromStorage(this.backupPrefix+e)),!a)throw new Error(`Checkpoint not found: ${e}`);const i=this.config.encryptionEnabled?await this.decryptData(a):a,r=this.config.compressionEnabled?await this.decompressData(i):JSON.parse(i);if(this.config.integrityChecking&&!await this.validateIntegrity(r))throw new Error("Checkpoint integrity validation failed");const s=this.validateCheckpointStructure(r);if(!s.isValid)throw new Error(`Invalid checkpoint structure: ${s.errors.join(", ")}`);return this.log(`âœ… Checkpoint loaded successfully: ${e}`),r}catch(a){throw this.log("âŒ Failed to load checkpoint:",a),new Error(`Checkpoint load failed: ${a instanceof Error?a.message:String(a)}`)}}async resumeFromCheckpoint(e,a,i={}){this.log(`ðŸ”„ Resuming from checkpoint: ${e}`);const r=await this.loadCheckpoint(e),s={skipFailedPatients:!1,retryFailedPatients:!0,validateEnvironment:!0,allowConfigChanges:!0,resumeFromLastSuccessful:!0,...i},o=[];if(s.validateEnvironment){const c=await this.validateEnvironment(r.resumeData.environmentState);if(!c.isValid&&(o.push(`Environment validation warnings: ${c.warnings.join(", ")}`),c.errors.length>0))throw new Error(`Environment validation failed: ${c.errors.join(", ")}`)}if(a){if(!s.allowConfigChanges)throw new Error("Configuration changes not allowed during resume");const c=this.compareConfigurations(r.configuration,a);c.hasSignificantChanges&&o.push(`Significant configuration changes detected: ${c.changes.join(", ")}`),r.configuration={...r.configuration,...a}}const l=this.determineResumeStrategy(r,s);return r.resumeData.lastSuccessfulOperation=`resumed_from_checkpoint_${Date.now()}`,this.log("âœ… Resume strategy determined:",l),{checkpoint:r,resumeStrategy:l,warnings:o}}async listCheckpoints(e){try{const i=await chrome.storage.local.get(null),r=[];for(const[s,o]of Object.entries(i))if(s.startsWith(this.storagePrefix))try{const l=await this.extractCheckpointInfo(s,o);(!e||l.batchId===e)&&r.push(l)}catch(l){this.log(`âš ï¸ Error reading checkpoint ${s}:`,l)}return r.sort((s,o)=>o.timestamp-s.timestamp),r}catch(a){return this.log("âŒ Failed to list checkpoints:",a),[]}}async deleteCheckpoint(e){try{const a=chrome.storage.local,i=[this.storagePrefix+e,this.backupPrefix+e];await a.remove(i),this.log(`ðŸ—‘ï¸ Checkpoint deleted: ${e}`)}catch(a){throw this.log("âŒ Failed to delete checkpoint:",a),new Error(`Checkpoint deletion failed: ${a instanceof Error?a.message:String(a)}`)}}async cleanupOldCheckpoints(e){try{const a=await this.listCheckpoints(e);if(a.length<=this.config.maxCheckpoints)return 0;const i=a.slice(this.config.maxCheckpoints);let r=0;for(const s of i)try{await this.deleteCheckpoint(s.id),r++}catch(o){this.log(`âš ï¸ Failed to delete old checkpoint ${s.id}:`,o)}return this.log(`ðŸ§¹ Cleaned up ${r} old checkpoints`),r}catch(a){return this.log("âŒ Cleanup failed:",a),0}}generateCheckpointId(e){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async calculateIntegrityHash(e){const a={...e};delete a.integrityHash;const i=JSON.stringify(a),s=new TextEncoder().encode(i),o=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(o)).map(c=>c.toString(16).padStart(2,"0")).join("")}async validateIntegrity(e){const a=e.integrityHash,i=await this.calculateIntegrityHash(e);return a===i}validateCheckpointStructure(e){const a=[],i=[],r=["id","batchId","timestamp","version","totalPatients","completedPatients","currentPatientIndex"];for(const s of r)(e[s]===void 0||e[s]===null)&&a.push(`Missing required field: ${s}`);return typeof e.currentPatientIndex!="number"&&a.push("currentPatientIndex must be a number"),Array.isArray(e.completedPatients)||a.push("completedPatients must be an array"),(e.currentPatientIndex<0||e.currentPatientIndex>e.totalPatients)&&i.push("currentPatientIndex seems out of bounds"),e.version!=="1.0.0"&&i.push(`Checkpoint version ${e.version} may not be fully compatible`),{isValid:a.length===0,errors:a,warnings:i,score:a.length===0?1:0}}async validateEnvironment(e){const a=[],i=[];try{if(e.tabId)try{await chrome.tabs.get(e.tabId)}catch{i.push("Original tab no longer exists")}if(e.currentUrl)try{new URL(e.currentUrl)}catch{i.push("Current URL appears invalid")}e.contentScriptVersion&&i.push("Content script version compatibility not verified"),Date.now()-e.lastHealthCheck>36e5&&i.push("Environment state is quite old (>1 hour)")}catch(r){a.push(`Environment validation error: ${r}`)}return{isValid:a.length===0,errors:a,warnings:i,score:a.length===0?1:0}}compareConfigurations(e,a){const i=[],r=["maxRetries","timeoutMs","errorRecoveryStrategy"];for(const[o,l]of Object.entries(a)){const c=e[o];c!==l&&i.push(`${o}: ${c} â†’ ${l}`)}return{hasSignificantChanges:i.some(o=>r.some(l=>o.startsWith(l))),changes:i}}determineResumeStrategy(e,a){const i={startIndex:e.currentPatientIndex,skipPatients:[],retryPatients:[],forceReprocessPatients:[],resumeMode:"continue"};if(a.resumeFromLastSuccessful){const r=this.findLastSuccessfulPatientIndex(e.completedPatients);i.startIndex=Math.max(r+1,e.currentPatientIndex)}return a.skipFailedPatients?i.skipPatients=e.failedAttempts.map(r=>r.patientIndex):a.retryFailedPatients&&(i.retryPatients=e.failedAttempts.map(r=>r.patientIndex)),i.retryPatients.length>0?i.resumeMode="retry_failed":i.skipPatients.length>0?i.resumeMode="skip_failed":i.resumeMode="continue",i}getLastSuccessfulOperation(e){const a=e.filter(r=>r.success);return a.length===0?"batch_start":`patient_completed_${a[a.length-1].patient.fileNumber}`}getSkippedPatients(e){const a=new Set(e.map((r,s)=>s)),i=[];for(let r=0;r<e.length;r++)a.has(r)||i.push(r);return i}buildRetryQueue(e){const a=[],i=new Map;for(const r of e){const s=i.get(r.patientIndex)||[];s.push(r),i.set(r.patientIndex,s)}for(const[r,s]of i){const o=s[s.length-1];a.push({patientIndex:r,patient:o.patient,lastError:o.error,retryCount:s.length,nextRetryTime:Date.now()+s.length*6e4})}return a}findLastSuccessfulPatientIndex(e){for(let a=e.length-1;a>=0;a--)if(e[a].success)return a;return-1}async extractCheckpointInfo(e,a){try{const i=e.replace(this.storagePrefix,"");let r;return this.config.encryptionEnabled?r={id:i,timestamp:0,batchId:"encrypted"}:this.config.compressionEnabled?r=await this.decompressData(a):r=JSON.parse(a),{id:r.id||i,batchId:r.batchId||"unknown",timestamp:r.timestamp||0,totalPatients:r.totalPatients||0,completedPatients:r.completedPatients?.length||0,currentIndex:r.currentPatientIndex||0,hasFailures:(r.failedAttempts?.length||0)>0}}catch(i){throw new Error(`Failed to extract checkpoint info: ${i}`)}}async saveToStorage(e,a){await chrome.storage.local.set({[e]:a})}async loadFromStorage(e){return(await chrome.storage.local.get(e))[e]||null}async compressData(e){return JSON.stringify(e).replace(/\s+/g,"").replace(/"completedPatients"/g,'"cp"').replace(/"currentPatientIndex"/g,'"ci"').replace(/"failedAttempts"/g,'"fa"').replace(/"timestamp"/g,'"ts"')}async decompressData(e){const a=e.replace(/"cp"/g,'"completedPatients"').replace(/"ci"/g,'"currentPatientIndex"').replace(/"fa"/g,'"failedAttempts"').replace(/"ts"/g,'"timestamp"');return JSON.parse(a)}async encryptData(e){return btoa(e)}async decryptData(e){return atob(e)}getDefaultConfig(){return{autoSaveInterval:5,maxCheckpoints:10,compressionEnabled:!0,encryptionEnabled:!1,integrityChecking:!0,backupEnabled:!0}}log(...e){this.debugMode&&console.log("[CheckpointManager]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}}class ht{static instance;metrics;config;memorySnapshots=[];activeOperations=new Map;memoryMonitorInterval;debugMode=!1;constructor(){this.config=this.getDefaultConfig(),this.metrics=this.initializeMetrics(),this.startMemoryMonitoring()}static getInstance(){return ht.instance||(ht.instance=new ht),ht.instance}startSession(e){this.log(`ðŸ“Š Starting metrics session: ${e}`),this.metrics=this.initializeMetrics(),this.metrics.sessionId=e,this.metrics.batchStartTime=Date.now(),this.config.enablePerformanceMarks&&performance.mark(`batch-start-${e}`)}endSession(){const e=Date.now();this.metrics.totalProcessingTime=e-this.metrics.batchStartTime,this.log(`ðŸ“Š Ending metrics session: ${this.metrics.sessionId}`),this.config.enablePerformanceMarks&&(performance.mark(`batch-end-${this.metrics.sessionId}`),performance.measure(`batch-duration-${this.metrics.sessionId}`,`batch-start-${this.metrics.sessionId}`,`batch-end-${this.metrics.sessionId}`));const a=this.generateReport();return this.config.autoExport&&this.exportMetrics(a),a}startOperation(e,a,i){const r=Date.now();this.activeOperations.set(e,r),this.log(`â±ï¸ Started operation: ${a} (${e})`),this.config.enablePerformanceMarks&&performance.mark(`op-start-${e}`)}endOperation(e,a,i,r,s){const o=Date.now(),l=this.activeOperations.get(e);if(!l)return this.log(`âš ï¸ No start time found for operation: ${e}`),this.createEmptyTiming(a,e);const c=o-l;this.activeOperations.delete(e);const u={operation:a,startTime:l,endTime:o,duration:c,success:i,patientIndex:r,metadata:s};switch(this.metrics.operationTimings.push(u),a){case"patient-activation":this.metrics.patientActivationTimes.push(c);break;case"data-extraction":this.metrics.dataExtractionTimes.push(c);break;case"ai-review":this.metrics.aiReviewTimes.push(c);break;case"content-script-response":this.metrics.contentScriptResponseTimes.push(c);break}if(!i){const f=this.metrics.retryCount.get(a)||0;this.metrics.retryCount.set(a,f+1)}return this.log(`âœ… Completed operation: ${a} in ${c}ms (success: ${i})`),this.config.enablePerformanceMarks&&(performance.mark(`op-end-${e}`),performance.measure(`op-duration-${e}`,`op-start-${e}`,`op-end-${e}`)),u}recordError(e,a,i){const r=this.classifyError(a),s=this.metrics.errorFrequency.get(r)||0;this.metrics.errorFrequency.set(r,s+1);const o=this.metrics.errorFrequency.get(e)||0;this.metrics.errorFrequency.set(e,o+1),this.log(`âŒ Recorded error: ${r} in ${e} (patient ${i})`)}takeMemorySnapshot(){const e={timestamp:Date.now(),heapUsed:0,heapTotal:0,external:0};if(performance.memory){const a=performance.memory;e.heapUsed=a.usedJSHeapSize,e.heapTotal=a.totalJSHeapSize,e.external=a.usedJSHeapSize}return this.memorySnapshots.push(e),this.metrics.memoryUsageHistory.push(e),this.memorySnapshots.length>1e3&&(this.memorySnapshots=this.memorySnapshots.slice(-500)),e}getPerformanceIndicators(){const e=this.getRecentTimings(3e5),a=this.metrics.operationTimings.length,i=this.metrics.operationTimings.filter(m=>m.success).length,r=e.filter(m=>m.patientIndex!==void 0),s=r.length>0?r.reduce((m,b)=>m+b.duration,0)/r.length:0,o=a>0?i/a:1;let l="normal";s>0&&(s<3e4?l="fast":s<6e4?l="normal":s<12e4?l="slow":l="degraded");const c=Array.from(this.metrics.errorFrequency.values()).reduce((m,b)=>m+b,0),u=a>0?c/a:0,f=this.memorySnapshots[this.memorySnapshots.length-1],h=f?f.heapUsed/(1024*1024):0;return{averageTimePerPatient:s,successRate:o,currentSpeed:l,errorRate:u,memoryUsage:h}}generateReport(){const e=this.generateSummary(),a=this.analyzeTimings(),i=this.analyzeMemory(),r=this.analyzeErrors(),s=this.generateInsights(),o=this.generateRecommendations(s);return{summary:e,timingAnalysis:a,memoryAnalysis:i,errorAnalysis:r,performanceInsights:s,recommendations:o}}async exportMetrics(e){const a=new Date().toISOString().replace(/[:.]/g,"-"),i=`batch-metrics-${e.summary.sessionId}-${a}`;return this.config.exportFormat==="csv"?this.exportAsCSV(e,i):this.exportAsJSON(e,i)}generateSummary(){const e=new Set(this.metrics.operationTimings.filter(u=>u.patientIndex!==void 0).map(u=>u.patientIndex)).size,a=new Set(this.metrics.operationTimings.filter(u=>u.patientIndex!==void 0&&u.success).map(u=>u.patientIndex)).size,i=e-a,r=this.metrics.operationTimings.filter(u=>u.patientIndex!==void 0),s=r.length>0?r.reduce((u,f)=>u+f.duration,0)/r.length:0,o=e>0?a/e:0,l=this.metrics.totalProcessingTime/(1e3*60*60),c=l>0?e/l:0;return{sessionId:this.metrics.sessionId,totalDuration:this.metrics.totalProcessingTime,totalPatients:e,successfulPatients:a,failedPatients:i,averageTimePerPatient:s,successRate:o,throughputPatientsPerHour:c}}analyzeTimings(){const e=new Map,a=[];for(const o of this.metrics.operationTimings){a.push(o.duration);let l=e.get(o.operation);l||(l={operation:o.operation,count:0,totalTime:0,averageTime:0,minTime:1/0,maxTime:0,standardDeviation:0,successRate:0},e.set(o.operation,l)),l.count++,l.totalTime+=o.duration,l.minTime=Math.min(l.minTime,o.duration),l.maxTime=Math.max(l.maxTime,o.duration),o.success&&l.successRate++}for(const o of e.values()){o.averageTime=o.totalTime/o.count,o.successRate=o.successRate/o.count;const l=this.metrics.operationTimings.filter(u=>u.operation===o.operation).map(u=>u.duration),c=l.reduce((u,f)=>u+Math.pow(f-o.averageTime,2),0)/l.length;o.standardDeviation=Math.sqrt(c)}a.sort((o,l)=>o-l);const i={p50:this.getPercentile(a,50),p90:this.getPercentile(a,90),p95:this.getPercentile(a,95),p99:this.getPercentile(a,99)},r=this.identifyBottlenecks(e),s=this.determineCriticalPath(e);return{operationBreakdown:e,criticalPath:s,bottlenecks:r,percentiles:i}}analyzeMemory(){if(this.memorySnapshots.length<2)return{peakUsage:0,averageUsage:0,growthRate:0,leakDetection:[],gcImpact:0};const e=this.memorySnapshots.map(f=>f.heapUsed),a=Math.max(...e),i=e.reduce((f,h)=>f+h,0)/e.length,r=this.memorySnapshots[0],s=this.memorySnapshots[this.memorySnapshots.length-1],o=(s.timestamp-r.timestamp)/(1e3*60),l=(s.heapUsed-r.heapUsed)/(1024*1024),c=o>0?l/o:0,u=this.detectMemoryLeaks();return{peakUsage:a/(1024*1024),averageUsage:i/(1024*1024),growthRate:c,leakDetection:u,gcImpact:0}}analyzeErrors(){const e=Array.from(this.metrics.errorFrequency.values()).reduce((b,g)=>b+g,0),a=this.metrics.operationTimings.length,i=this.metrics.operationTimings.filter(b=>b.success).length,r=a>0?e/a:0,s=a>e?(i-(a-e))/e:0,o=new Map,l=new Map;for(const[b,g]of this.metrics.errorFrequency)this.isErrorType(b)?o.set(b,g):l.set(b,g);const c=this.metrics.operationTimings.filter(b=>!b.success),u=c.length>0?c.reduce((b,g)=>b+g.duration,0)/c.length:0,f=this.metrics.operationTimings.filter(b=>b.success),h=f.length>0?f.reduce((b,g)=>b+g.duration,0)/f.length:0,m=h>0?(u-h)/h:0;return{totalErrors:e,errorsByType:o,errorsByOperation:l,errorRate:r,recoveryRate:s,impactOnPerformance:m}}generateInsights(){const e=[],a=this.getPerformanceIndicators();return a.currentSpeed==="degraded"&&e.push({type:"warning",title:"Severely Degraded Performance",description:`Average processing time per patient is ${Math.round(a.averageTimePerPatient/1e3)}s, indicating severe performance issues.`,impact:"high",actionRequired:!0}),a.errorRate>.1&&e.push({type:"warning",title:"High Error Rate",description:`Error rate of ${Math.round(a.errorRate*100)}% is concerning and may indicate system issues.`,impact:"high",actionRequired:!0}),a.memoryUsage>500&&e.push({type:"warning",title:"High Memory Usage",description:`Memory usage of ${Math.round(a.memoryUsage)}MB is high and may cause performance issues.`,impact:"medium",actionRequired:!1}),a.successRate<.9&&e.push({type:"optimization",title:"Low Success Rate",description:`Success rate of ${Math.round(a.successRate*100)}% suggests opportunities for improvement.`,impact:"medium",actionRequired:!1}),e}generateRecommendations(e){const a=[];for(const i of e)switch(i.title){case"Severely Degraded Performance":a.push("Consider reducing batch size or increasing timeout values"),a.push("Check for network connectivity issues");break;case"High Error Rate":a.push("Review error logs to identify common failure patterns"),a.push("Consider implementing additional retry strategies");break;case"High Memory Usage":a.push("Implement more frequent garbage collection"),a.push("Reduce the number of concurrent operations");break;case"Low Success Rate":a.push("Improve error handling and recovery mechanisms"),a.push("Add more robust validation checks");break}return a}identifyBottlenecks(e){const a=[];for(const i of e.values()){let r="low",s="";i.averageTime>6e4?(r="critical",s="This operation is extremely slow and should be optimized immediately"):i.averageTime>3e4?(r="high",s="Consider optimizing this operation or implementing caching"):i.averageTime>15e3&&(r="medium",s="Monitor this operation for potential optimization opportunities"),r!=="low"&&a.push({operation:i.operation,averageTime:i.averageTime,impact:r,description:`${i.operation} takes an average of ${Math.round(i.averageTime/1e3)}s`,suggestion:s})}return a.sort((i,r)=>r.averageTime-i.averageTime)}determineCriticalPath(e){return Array.from(e.values()).sort((i,r)=>r.averageTime*r.count-i.averageTime*i.count).slice(0,5).map(i=>i.operation)}detectMemoryLeaks(){const e=[];if(this.memorySnapshots.length<10)return e;const a=this.memorySnapshots.slice(-10),i=[];for(let s=1;s<a.length;s++){const o=a[s].heapUsed-a[s-1].heapUsed;i.push(o)}const r=i.reduce((s,o)=>s+o,0)/i.length;return a[a.length-1].heapUsed-a[0].heapUsed,r>1024*1024&&e.push({suspected:!0,confidence:Math.min(r/(5*1024*1024),1),description:"Consistent memory growth detected",growthPattern:"linear"}),e}getPercentile(e,a){const i=Math.ceil(a/100*e.length)-1;return e[Math.max(0,Math.min(i,e.length-1))]||0}getRecentTimings(e){const a=Date.now()-e;return this.metrics.operationTimings.filter(i=>i.startTime>=a)}classifyError(e){const a=e.toLowerCase();return a.includes("timeout")?"timeout":a.includes("network")?"network":a.includes("permission")?"permission":a.includes("not found")?"not_found":a.includes("memory")?"memory":"unknown"}isErrorType(e){return["timeout","network","permission","not_found","memory","unknown"].includes(e)}createEmptyTiming(e,a){return{operation:e,startTime:Date.now(),endTime:Date.now(),duration:0,success:!1,metadata:{error:"No start time found",operationId:a}}}async exportAsJSON(e,a){const i=JSON.stringify(e,null,2);if(typeof window<"u"){const r=new Blob([i],{type:"application/json"}),s=URL.createObjectURL(r),o=document.createElement("a");o.href=s,o.download=`${a}.json`,o.click(),URL.revokeObjectURL(s)}return i}async exportAsCSV(e,a){const i=[];i.push("Category,Metric,Value,Unit"),i.push(`Summary,Session ID,${e.summary.sessionId},`),i.push(`Summary,Total Duration,${e.summary.totalDuration},ms`),i.push(`Summary,Total Patients,${e.summary.totalPatients},count`),i.push(`Summary,Success Rate,${e.summary.successRate},percentage`),i.push(`Summary,Avg Time Per Patient,${e.summary.averageTimePerPatient},ms`);for(const[s,o]of e.timingAnalysis.operationBreakdown)i.push(`Timing,${s} Count,${o.count},count`),i.push(`Timing,${s} Avg Time,${o.averageTime},ms`),i.push(`Timing,${s} Success Rate,${o.successRate},percentage`);i.push(`Memory,Peak Usage,${e.memoryAnalysis.peakUsage},MB`),i.push(`Memory,Average Usage,${e.memoryAnalysis.averageUsage},MB`),i.push(`Memory,Growth Rate,${e.memoryAnalysis.growthRate},MB/min`);const r=i.join(`
`);if(typeof window<"u"){const s=new Blob([r],{type:"text/csv"}),o=URL.createObjectURL(s),l=document.createElement("a");l.href=o,l.download=`${a}.csv`,l.click(),URL.revokeObjectURL(o)}return r}startMemoryMonitoring(){this.config.enableMemoryTracking&&(this.memoryMonitorInterval=setInterval(()=>{this.takeMemorySnapshot()},this.config.sampleInterval))}stopMemoryMonitoring(){this.memoryMonitorInterval&&(clearInterval(this.memoryMonitorInterval),this.memoryMonitorInterval=void 0)}initializeMetrics(){return{sessionId:"",batchStartTime:0,patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}getDefaultConfig(){return{enableDetailedTiming:!0,enableMemoryTracking:!0,enablePerformanceMarks:!0,sampleInterval:5e3,retentionPeriod:36e5,exportFormat:"json",autoExport:!1}}log(...e){this.debugMode&&console.log("[MetricsCollector]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e),(e.sampleInterval!==void 0||e.enableMemoryTracking!==void 0)&&(this.stopMemoryMonitoring(),this.startMemoryMonitoring())}getConfig(){return{...this.config}}getMetrics(){return{...this.metrics}}clearMetrics(){this.metrics=this.initializeMetrics(),this.memorySnapshots=[],this.activeOperations.clear()}cleanup(){this.stopMemoryMonitoring(),this.clearMetrics()}}class no{batchPatientReviewAgent;dynamicWait;dataValidation;errorRecovery;cacheManager;checkpointManager;metricsCollector;isProcessing=!1;abortController=null;currentBatchId=null;config;currentProcessingContext=null;constructor(e={}){this.batchPatientReviewAgent=null,this.dynamicWait=ut.getInstance(),this.dataValidation=mt.getInstance(),this.errorRecovery=pt.getInstance(),this.cacheManager=Li.getInstance(),this.checkpointManager=gt.getInstance(),this.metricsCollector=ht.getInstance(),this.config=this.getDefaultConfig(),this.updateConfig(e),this.log("ðŸš€ Enhanced Batch AI Review Orchestrator initialized")}async loadAgent(){if(!this.batchPatientReviewAgent){const{BatchPatientReviewAgent:e}=await ke(async()=>{const{BatchPatientReviewAgent:a}=await import("./chunks/BatchPatientReviewAgent.BhfBedt1.js");return{BatchPatientReviewAgent:a}},__vite__mapDeps([10,5,6]));this.batchPatientReviewAgent=new e}}async processBatch(e,a){if(this.isProcessing)throw new Error("Batch processing already in progress");this.isProcessing=!0,this.abortController=new AbortController,this.currentBatchId=this.generateBatchId(e);const i=Date.now(),r=[],s=[];this.log(`ðŸ”„ Starting enhanced batch AI review for ${e.selectedPatients.length} patients`),this.config.enableMetrics&&this.metricsCollector.startSession(this.currentBatchId),this.config.enableCaching&&await this.cacheManager.warmup(e.selectedPatients);try{const o=await this.checkForResumableCheckpoint(this.currentBatchId);let l=0;o&&await this.handleResumeOption(o,a)&&(r.push(...o.completedPatients),l=o.currentPatientIndex,this.log(`ðŸ“‚ Resuming from checkpoint at patient ${l}`));const c=e.selectedPatients.slice(l);if(this.config.parallelProcessing&&c.length>1){this.log(`ðŸš€ Using PARALLEL processing for ${c.length} patients (max ${this.config.maxConcurrentOperations} concurrent)`);const h=await this.processPatientsBatchParallel(c,l,a,i);r.push(...h.results),s.push(...h.errors)}else{this.log(`ðŸ”„ Using SEQUENTIAL processing for ${c.length} patients`);for(let h=0;h<c.length;h++){const m=c[h],b=l+h;if(this.abortController?.signal.aborted)throw this.log("ðŸ›‘ Batch processing was cancelled by user"),new Error("Batch processing was cancelled");await this.validateAppointmentBookState(m,b);const g=this.createEnhancedProgress(b,e.selectedPatients.length,m,r,s,i);a?.(g);try{this.log(`ðŸ§­ Processing patient ${b+1}/${e.selectedPatients.length}: ${m.name}`);const x=await this.processIndividualPatientEnhanced(m,b,(w,I)=>{g.phase=w,g.subPhase=I,a?.(g)});r.push(x),this.log(`âœ… Completed patient ${b+1}: ${m.name}`),this.config.enableCheckpoints&&(b+1)%this.config.checkpointInterval===0&&await this.saveProgressCheckpoint(e,r,b+1,s,i)}catch(x){const w=x instanceof Error?x.message:"Unknown error";this.log(`âŒ Failed to process patient ${m.name}:`,w),this.config.enableMetrics&&this.metricsCollector.recordError("patient-processing",w,b),r.push({patient:m,reviewReport:null,extractedData:{background:"",investigations:"",medications:""},processingTime:0,success:!1,error:w}),s.push(`${m.name}: ${w}`);const I=s.length/(b+1);if(I>.5&&s.length>3)throw this.log(`ðŸš¨ High error rate detected (${Math.round(I*100)}%), stopping batch`),new Error(`Batch stopped due to high error rate: ${Math.round(I*100)}%`)}}}const u=this.createEnhancedProgress(e.selectedPatients.length,e.selectedPatients.length,null,r,s,i);u.phase="completed",a?.(u);const f=await this.generateEnhancedBatchReport(e,r,i,Date.now());this.log(`ðŸŽ‰ Batch processing completed: ${r.filter(h=>h.success).length}/${e.selectedPatients.length} successful`);try{const h=Date.now()-i,m=r.filter(x=>x.success).length,b=e.selectedPatients.length,g=`${m}/${b} patients processed successfully`;await fa.showCompletionNotification("batch-ai-review",h,g),console.log(`ðŸ”” Batch completion notification sent: ${m}/${b} patients (${h}ms)`)}catch(h){console.warn("Failed to send batch completion notification:",h)}return f}catch(o){this.log("âŒ Batch processing failed:",o);const l=this.createEnhancedProgress(0,e.selectedPatients.length,null,r,[...s,o instanceof Error?o.message:"Unknown error"],i);throw l.phase="error",a?.(l),o}finally{await this.finalizeProcessing()}}async resumeFromCheckpoint(e,a){this.log(`ðŸ”„ Resuming batch processing from checkpoint: ${e}`);const{checkpoint:i,resumeStrategy:r,warnings:s}=await this.checkpointManager.resumeFromCheckpoint(e);for(const l of s)this.log(`âš ï¸ Resume warning: ${l}`);const o={selectedPatients:[],appointmentDate:new Date().toISOString(),calendarUrl:i.resumeData.environmentState?.currentUrl||""};return this.processBatch(o,a)}cancelProcessing(){this.abortController&&(this.abortController.abort(),this.log("ðŸ›‘ Batch processing cancelled by user"))}isCurrentlyProcessing(){return this.isProcessing}getProcessingStats(){return{isProcessing:this.isProcessing,currentBatchId:this.currentBatchId,performanceIndicators:this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():null,cacheStats:this.config.enableCaching?this.cacheManager.getStats():null,errorStats:this.errorRecovery.getFailureStats()}}async processPatientsBatchParallel(e,a,i,r){const s=[],o=[];this.log(`ðŸš€ Starting parallel batch processing for ${e.length} patients`),this.log(`ðŸ“Š PHASE 1: Collecting data from all ${e.length} patients...`);const l=[];for(let f=0;f<e.length;f++){const h=e[f],m=a+f;if(this.abortController?.signal.aborted)throw new Error("Batch processing was cancelled");i?.({currentPatientIndex:m,totalPatients:e.length,currentPatient:h,phase:"extracting",subPhase:`collecting-data-${f+1}/${e.length}`,completedPatients:[],errors:[],percentComplete:f/e.length*50,estimatedTimeRemaining:0,currentOperationDetails:`Collecting data from ${h.name}`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}});try{await this.validateAppointmentBookState(h,m);const b=await this.getCurrentTabId(),g=await this.extractPatientDataEnhanced(b,h);l.push({patient:h,extractedData:g,patientIndex:m,success:!0}),this.log(`âœ… Phase 1: Collected data for ${h.name} (${f+1}/${e.length})`)}catch(b){const g=b instanceof Error?b.message:"Unknown error";this.log(`âŒ Phase 1: Failed to collect data for ${h.name}: ${g}`),l.push({patient:h,extractedData:{background:"",investigations:"",medications:"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:0},patientIndex:m,success:!1,error:g}),o.push(`${h.name}: ${g}`)}}this.log(`ðŸ“Š PHASE 1 COMPLETE: Collected data from ${l.length} patients`),this.log(`ðŸ¤– PHASE 2: Processing AI reviews in parallel (max ${this.config.maxConcurrentOperations} concurrent)...`);const c=l.filter(f=>f.success),u=this.chunkArray(c,this.config.maxConcurrentOperations);for(const f of u){const h=f.map(async(b,g)=>{try{const x=50+s.length/e.length*50;i?.({currentPatientIndex:b.patientIndex,totalPatients:e.length,currentPatient:b.patient,phase:"reviewing",subPhase:"ai-processing-parallel",completedPatients:s,errors:[],percentComplete:x,estimatedTimeRemaining:0,currentOperationDetails:`AI review: ${b.patient.name} (parallel)`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}}),this.log(`ðŸ¤– Processing AI review for ${b.patient.name} (parallel batch)`);const w=await this.performAIReviewWithCaching(b.extractedData,b.patient),I={patient:b.patient,reviewReport:w,extractedData:b.extractedData,processingTime:0,success:!0};return this.log(`âœ… Completed AI review for ${b.patient.name}`),I}catch(x){const w=x instanceof Error?x.message:"Unknown error";this.log(`âŒ AI review failed for ${b.patient.name}: ${w}`);const I={patient:b.patient,reviewReport:null,extractedData:b.extractedData,processingTime:0,success:!1,error:w};return o.push(`${b.patient.name}: ${w}`),I}}),m=await Promise.allSettled(h);for(const b of m)b.status==="fulfilled"&&s.push(b.value);this.log(`âœ… Completed AI processing chunk: ${s.filter(b=>b.success).length}/${s.length} successful`)}for(const f of l.filter(h=>!h.success))s.push({patient:f.patient,reviewReport:null,extractedData:f.extractedData,processingTime:0,success:!1,error:f.error});return this.log(`ðŸŽ‰ PARALLEL PROCESSING COMPLETE: ${s.filter(f=>f.success).length}/${s.length} patients successful`),{results:s,errors:o}}chunkArray(e,a){const i=[];for(let r=0;r<e.length;r+=a)i.push(e.slice(r,r+a));return i}async processIndividualPatientEnhanced(e,a,i){const r=Date.now();this.currentProcessingContext={patient:e};const s={operation:"process-patient",patientIndex:a,patient:e,timestamp:r,environmentState:await this.getCurrentEnvironmentState(),previousAttempts:0};try{const o=`patient-${a}`;this.config.enableMetrics&&this.metricsCollector.startOperation(o,"patient-processing",a),i?.("navigating","activating-patient"),this.log(`ðŸ–±ï¸ Activating patient ${a}: ${e.name} (${e.fileNumber})`),await this.errorRecovery.executeWithRecovery(()=>this.activatePatientWithIntelligentWaiting(a),{...s,operation:"patient-activation"}),i?.("waiting-for-load","patient-data-loading");const l=await this.getCurrentTabId(),c=await this.dynamicWait.waitForPatientDataLoad(l,e.name);if(!c.success)throw new Error(`Patient data failed to load: ${c.error}`);i?.("extracting","clinical-data-extraction"),this.log(`ðŸ“‹ Extracting clinical data for: ${e.name}`);const u=await this.errorRecovery.executeWithRecovery(()=>this.extractPatientDataEnhanced(l,e),{...s,operation:"data-extraction"});i?.("reviewing","ai-medical-review"),u.dataCompleteness&&!u.dataCompleteness.hasRealData?this.log(`ðŸ¤– Running AI review for ${e.name} (incomplete data - ${u.dataCompleteness.emptyFieldCount}/${u.dataCompleteness.totalFields} fields empty)`):this.log(`ðŸ¤– Running AI review for: ${e.name}`);const f=await this.errorRecovery.executeWithRecovery(()=>this.performAIReviewWithCaching(u,e),{...s,operation:"ai-review"}),h=Date.now()-r;return this.config.enableMetrics&&this.metricsCollector.endOperation(o,"patient-processing",!0,a,{processingTime:h,dataQuality:u.qualityScore}),{patient:e,reviewReport:f,extractedData:u,processingTime:h,success:!0}}catch(o){const l=Date.now()-r;throw this.log(`âŒ Failed to process patient ${e.name}:`,o),this.config.enableMetrics&&this.metricsCollector.endOperation(`patient-${a}`,"patient-processing",!1,a,{processingTime:l,error:o instanceof Error?o.message:String(o)}),o}finally{this.currentProcessingContext=null}}async activatePatientWithIntelligentWaiting(e){const a=await this.getCurrentTabId(),i=this.getCurrentProcessingContext();if(!i?.patient)throw new Error("No patient context available for activation");const r=i.patient;try{this.log(`ðŸ‘† SPA Workflow: Starting patient processing for ${r.name} (${r.fileNumber})`),this.log(`ðŸ‘† Step 1: Double-clicking patient ${r.name}`);const s=await this.sendMessageWithTimeout(a,{type:"EXECUTE_ACTION",action:"double-click-patient",data:{patientName:r.name,patientId:r.fileNumber}},1e4);if(!s?.success)throw new Error(`Double-click patient failed: ${s?.error||"Unknown error"}`);this.log("ðŸ¥ Step 2: Navigating to Patient Record view");const o=await this.sendMessageWithTimeout(a,{type:"EXECUTE_ACTION",action:"navigate-to-patient-record",data:{}},15e3);if(!o?.success)throw new Error(`Navigate to patient record failed: ${o?.error||"Unknown error"}`);await this.waitForPatientDataReady(a,r.name),this.log(`âœ… SPA Workflow: Patient ${r.name} activated and Patient Record view ready`)}catch(s){throw this.log("âŒ SPA Workflow activation failed:",s),new Error(`SPA patient activation failed: ${s instanceof Error?s.message:"Unknown error"}`)}}getCurrentProcessingContext(){return this.currentProcessingContext||null}async waitForPatientDataReady(e,a){this.log(`â³ Waiting for patient data to load for: ${a}`);for(let s=0;s<30;s++)try{const o=await this.sendMessageWithTimeout(e,{type:"CHECK_XESTRO_BOXES"},3e3);if(o?.found&&o.count>0){this.log(`âœ… Patient data ready after ${(s+1)*500}ms (${o.count} XestroBoxes found)`),await this.sleep(1e3);return}s%5===0&&this.log(`â³ Still waiting for patient data... (attempt ${s+1}/30, ${o?.count||0} XestroBoxes)`),await this.sleep(500)}catch(o){if(this.log(`âŒ Error checking patient data readiness (attempt ${s+1}):`,o),o instanceof Error&&o.message.includes("message channel")?(this.log("ðŸ”§ Message channel error detected, waiting longer before retry..."),await this.sleep(500*2)):await this.sleep(500),s===29)throw new Error(`Patient data failed to load after ${30*500}ms: ${o instanceof Error?o.message:"Unknown error"}`)}throw new Error(`Patient data did not load within ${30*500}ms for patient: ${a}`)}async sleep(e){return new Promise(a=>setTimeout(a,e))}async sendMessageWithTimeout(e,a,i=5e3){return new Promise((r,s)=>{const o=setTimeout(()=>{s(new Error(`Message timeout after ${i}ms`))},i);try{chrome.tabs.sendMessage(e,a,l=>{if(clearTimeout(o),chrome.runtime.lastError){s(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}r(l)})}catch(l){clearTimeout(o),s(l)}})}async extractPatientDataEnhanced(e,a){if(this.config.enableCaching){const i={patientId:a.fileNumber,dataType:"extracted_data"},r=await this.cacheManager.get(i);if(r.hit&&r.data)return this.log(`ðŸ’¾ Using cached data for patient: ${a.name}`),await this.navigateBackToAppointmentBook(e),r.data}try{this.log(`ðŸ“‹ Step 3: Extracting patient fields for ${a.name}`);const i=await this.sendMessageWithTimeout(e,{type:"EXECUTE_ACTION",action:"extract-patient-fields",data:{}},3e4);if(!i?.success||!i?.data)throw new Error(`Patient fields extraction failed: ${i?.error||"No data returned"}`);const r=i.data,s=r.hasAnyData;this.log(`ðŸ“Š Data completeness check for ${a.name}:`,{hasAnyData:s,backgroundLength:r.background?.length||0,investigationsLength:r.investigations?.length||0,medicationsLength:r.medications?.length||0});const o=r.background?.trim()?r.background:"No data available in Background section",l=r.investigations?.trim()?r.investigations:"No data available in Investigations section",c=r.medications?.trim()?r.medications:"No data available in Medications section";this.log(`ðŸ“ Processed field data for ${a.name}:`,{backgroundMarked:!r.background?.trim(),investigationsMarked:!r.investigations?.trim(),medicationsMarked:!r.medications?.trim(),hasAnyRealData:s});const u={background:o,investigations:l,medications:c,extractionTimestamp:r.extractionTimestamp||Date.now(),extractionAttempts:1,qualityScore:this.calculateDataQuality(r),dataCompleteness:{hasRealData:s,emptyFieldCount:[!r.background?.trim(),!r.investigations?.trim(),!r.medications?.trim()].filter(Boolean).length,totalFields:3}};if(await this.navigateBackToAppointmentBook(e),this.config.enableCaching){const f={patientId:a.fileNumber,dataType:"extracted_data"},h=this.dataValidation.assessDataQuality(u);await this.cacheManager.set(f,u,h)}return this.log(`âœ… SPA Workflow: Patient ${a.name} data extraction completed and returned to appointment book`),u}catch(i){this.log("âŒ SPA Workflow extraction failed:",i);try{await this.navigateBackToAppointmentBook(e)}catch(r){this.log("âŒ Failed to navigate back to appointment book:",r)}throw new Error(`SPA data extraction failed: ${i instanceof Error?i.message:"Unknown error"}`)}}async navigateBackToAppointmentBook(e){this.log("ðŸ“… Step 4: Navigating back to Appointment Book");const a=await this.sendMessageWithTimeout(e,{type:"EXECUTE_ACTION",action:"navigate-to-appointment-book",data:{}},15e3);if(!a?.success)throw new Error(`Navigate to appointment book failed: ${a?.error||"Unknown error"}`)}calculateDataQuality(e){let a=0,i=0;return["background","investigations","medications"].forEach(s=>{i++;const o=e[s]||"";o.trim().length>0&&(a+=1,o.trim().length>50&&(a+=.5))}),Math.min(a/(i*1.5),1)}async performAIReviewWithCaching(e,a){if(this.config.enableCaching){const s={patientId:a.fileNumber,dataType:"ai_review"},o=await this.cacheManager.get(s);if(o.hit&&o.data&&!await this.cacheManager.hasChanged({patientId:a.fileNumber,dataType:"extracted_data"},e))return this.log(`ðŸ’¾ Using cached AI review for patient: ${a.name}`),o.data}const i=this.formatReviewInput(e,a);await this.loadAgent();const r=await this.batchPatientReviewAgent.process(i);if(this.config.enableCaching){const s={patientId:a.fileNumber,dataType:"ai_review"};await this.cacheManager.set(s,r)}return r}createEnhancedProgress(e,a,i,r,s,o){const c=Date.now()-o,u=r.filter(x=>x.success).length,f=e>0?c/e:0,m=(a-e)*f,b=a>0?e/a*100:0,g=this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():{averageTimePerPatient:f,successRate:e>0?u/e:1,currentSpeed:"normal",errorRate:e>0?s.length/e:0,memoryUsage:0};return{currentPatientIndex:e,totalPatients:a,currentPatient:i,phase:"navigating",completedPatients:r,errors:s,percentComplete:b,estimatedTimeRemaining:m,currentOperationDetails:i?`Processing ${i.name} (${i.fileNumber})`:"Initializing...",performanceIndicators:g}}async generateEnhancedBatchReport(e,a,i,r){const s=a.filter(b=>b.success),o=a.filter(b=>!b.success);let l=null;this.config.enableMetrics&&(l=this.metricsCollector.endSession());let c=0,u=0,f=0;const h=[];return s.forEach(b=>{if(b.reviewReport?.reviewData){const g=b.reviewReport.reviewData;c+=g.findings?.length||0,u+=g.findings?.filter(x=>x.urgency==="Immediate").length||0,f+=g.medicationSafetyIssues||0,g.findings?.forEach(x=>{x.finding&&!h.includes(x.finding)&&h.push(x.finding)})}}),{id:`batch-${Date.now()}`,agentName:"Enhanced Batch AI Review Orchestrator v3.0",content:`Enhanced batch AI medical review completed for ${e.selectedPatients.length} patients on ${e.appointmentDate}`,sections:[],metadata:{confidence:s.length/e.selectedPatients.length,processingTime:r-i,modelUsed:"BatchPatientReviewAgent",enhancedFeatures:{intelligentWaiting:!0,dataValidation:!0,errorRecovery:!0,caching:this.config.enableCaching,checkpointing:this.config.enableCheckpoints,metrics:this.config.enableMetrics}},timestamp:r,warnings:o.map(b=>`Failed to process ${b.patient.name}: ${b.error}`),errors:o.map(b=>b.error||"Unknown error"),batchData:{appointmentDate:e.appointmentDate,totalPatients:e.selectedPatients.length,successfulReviews:s.length,failedReviews:o.length,processingStartTime:i,processingEndTime:r,patientResults:a,summary:{totalFindings:c,immediateFindings:u,medicationSafetyIssues:f,commonFindings:h.slice(0,10)},enhancedMetrics:l}}}async checkForResumableCheckpoint(e){if(!this.config.enableCheckpoints)return null;try{const a=await this.checkpointManager.listCheckpoints(e);if(a.length>0){const i=a[0];return this.log(`ðŸ“‚ Found resumable checkpoint: ${i.id}`),await this.checkpointManager.loadCheckpoint(i.id)}}catch(a){this.log("âŒ Error checking for resumable checkpoint:",a)}return null}async handleResumeOption(e,a){return this.log(`ðŸ”„ Auto-resuming from checkpoint with ${e.completedPatients.length} completed patients`),!0}async saveProgressCheckpoint(e,a,i,r,s){if(!(!this.config.enableCheckpoints||!this.currentBatchId))try{const o=await this.getCurrentEnvironmentState(),l=this.config.enableMetrics?this.metricsCollector.getMetrics():this.createEmptyMetrics(),c=await this.checkpointManager.saveCheckpoint(this.currentBatchId,e,a,i,[],this.getBatchConfiguration(),l,o);this.log(`ðŸ’¾ Saved checkpoint: ${c} (${a.length} patients completed)`)}catch(o){this.log("âŒ Failed to save checkpoint:",o)}}async getCurrentTabId(){const e=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e[0]?.id)throw new Error("No active tab found");return e[0].id}async getCurrentEnvironmentState(){const e=await chrome.tabs.query({active:!0,currentWindow:!0});return{tabId:e[0]?.id||0,currentUrl:e[0]?.url||"",contentScriptVersion:"2.6.0",lastHealthCheck:Date.now()}}formatReviewInput(e,a){let i="";if(e.dataCompleteness){const{hasRealData:r,emptyFieldCount:s,totalFields:o}=e.dataCompleteness;r?s>0&&(i=`

DATA COMPLETENESS NOTE: ${s}/${o} clinical sections are incomplete. Consider if missing information is clinically significant.`):i=`

DATA COMPLETENESS ALERT: This patient record has ${s}/${o} empty clinical sections. Please assess if missing data represents a clinical oversight or if additional data collection is needed.`}return`Patient: ${a.name} (DOB: ${a.dob}, File: ${a.fileNumber})

Background: ${e.background}

Investigations: ${e.investigations}

Medications: ${e.medications}${i}`}generateBatchId(e){return`batch-${e.appointmentDate}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getBatchConfiguration(){return{maxRetries:this.config.retryAttempts,timeoutMs:this.config.timeoutMs,parallelProcessing:this.config.parallelProcessing,cacheEnabled:this.config.enableCaching,diagnosticsEnabled:this.config.enableAdvancedDiagnostics,checkpointInterval:this.config.checkpointInterval,errorRecoveryStrategy:"conservative"}}createEmptyMetrics(){return{sessionId:this.currentBatchId||"",batchStartTime:Date.now(),patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}async finalizeProcessing(){this.isProcessing=!1,this.abortController=null,this.currentBatchId=null,this.config.enableCaching&&await this.cacheManager.applyInvalidationRules(),this.log("ðŸ Batch processing finalized")}getDefaultConfig(){return{enableCheckpoints:!0,checkpointInterval:5,enableCaching:!0,enableMetrics:!0,enableAdvancedDiagnostics:!1,parallelProcessing:!0,maxConcurrentOperations:3,timeoutMs:3e5,retryAttempts:3}}updateConfig(e){Object.assign(this.config,e),this.dynamicWait.setDebugMode(e.enableAdvancedDiagnostics||!1),this.dataValidation.setDebugMode(e.enableAdvancedDiagnostics||!1),this.errorRecovery.setDebugMode(e.enableAdvancedDiagnostics||!1),this.cacheManager.setDebugMode(e.enableAdvancedDiagnostics||!1),this.checkpointManager.setDebugMode(e.enableAdvancedDiagnostics||!1),this.metricsCollector.setDebugMode(e.enableAdvancedDiagnostics||!1)}getConfig(){return{...this.config}}async validateAppointmentBookState(e,a){const i=await this.getCurrentTabId();this.log(`ðŸ” Validating appointment book state for patient ${a}: ${e.name}`);try{const r=await this.sendMessageWithTimeout(i,{type:"EXECUTE_ACTION",action:"extract-calendar-patients",data:{}},1e4);if(!r?.success||!r?.data?.patients){this.log("âš ï¸ WARNING: Could not validate current patient list");return}const s=r.data.patients;if(this.log(`ðŸ” Current appointment book has ${s.length} patients`),this.log("ðŸ” Current patient list:",s.map((o,l)=>({index:l,name:o.name,fileNumber:o.fileNumber,dob:o.dob}))),a<s.length){const o=s[a];if(this.log(`ðŸ” Expected patient at index ${a}:`,{name:e.name,fileNumber:e.fileNumber,dob:e.dob}),this.log(`ðŸ” Actual patient at index ${a}:`,{name:o.name,fileNumber:o.fileNumber,dob:o.dob}),o.fileNumber!==e.fileNumber)throw this.log("ðŸš¨ CRITICAL ERROR: Patient mismatch detected!"),this.log(`ðŸš¨ Expected: ${e.name} (${e.fileNumber})`),this.log(`ðŸš¨ Found: ${o.name} (${o.fileNumber})`),new Error(`Patient list state corrupted. Expected ${e.name} but found ${o.name} at index ${a}`);this.log(`âœ… Patient validation successful: ${e.name} is at correct position ${a}`)}else throw this.log(`ðŸš¨ CRITICAL ERROR: Patient index ${a} is out of bounds (current list has ${s.length} patients)`),new Error(`Patient index ${a} is out of bounds for current appointment book`)}catch(r){throw this.log("âŒ Patient validation failed:",r),new Error(`Patient validation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}log(...e){console.log("[Enhanced BatchAIReviewOrchestrator]",...e)}async getAvailableCheckpoints(){return this.checkpointManager.listCheckpoints()}async deleteCheckpoint(e){return this.checkpointManager.deleteCheckpoint(e)}async exportMetrics(){if(!this.config.enableMetrics)throw new Error("Metrics collection is disabled");const e=this.metricsCollector.generateReport();return this.metricsCollector.exportMetrics(e)}async clearCaches(){return this.cacheManager.clear()}getDetailedStats(){return{processing:this.getProcessingStats(),cache:this.config.enableCaching?this.cacheManager.getCacheInfo():null,errors:this.errorRecovery.getFailureStats(),metrics:this.config.enableMetrics?this.metricsCollector.getMetrics():null}}}const ao={background:"background","investigation-summary":"investigation-summary",medication:"medications",bloods:null,imaging:null,tavi:null,"angiogram-pci":null,mteer:null,tteer:null,"pfo-closure":null,"asd-closure":null,"pvl-plug":null,"bypass-graft":null,"right-heart-cath":null,"tavi-workup":null,"quick-letter":null,consultation:null,"ai-medical-review":null,"batch-ai-review":null,"patient-education":null,enhancement:null,transcription:null,generation:null},io={background:"Background","investigation-summary":"Investigation Summary",medications:"Medications (Problem List for Phil)","social-history":"Social & Family History"};function ni(n){return n&&ao[n]||null}function xn(n){return io[n]||n}function ia(n){return n!==null&&ni(n)!==null}class ft{static instance;config={minSimilarityScore:.8,caseSensitive:!1,ignoreTitles:!0,allowPartialMatches:!0,enabled:!0};constructor(){Z.debug("PatientNameValidator initialized")}static getInstance(){return ft.instance||(ft.instance=new ft),ft.instance}updateConfig(e){this.config={...this.config,...e},Z.debug("PatientNameValidator config updated:",this.config)}validatePatientNames(e,a){const i=[];if(!this.config.enabled)return{sessionPatientName:e,emrPatientName:a,similarityScore:1,isMatch:!0,confidence:"high",normalizedSessionName:e,normalizedEmrName:a,warnings:["Validation disabled"]};if(!e||!a)return i.push("Missing patient name data"),{sessionPatientName:e||"Unknown",emrPatientName:a||"Unknown",similarityScore:0,isMatch:!1,confidence:"low",normalizedSessionName:"",normalizedEmrName:"",warnings:i};(this.isFallbackPatientName(e)||this.isFallbackPatientName(a))&&i.push("Fallback patient name detected - validation may be unreliable");const r=this.normalizeName(e),s=this.normalizeName(a),o=this.calculateSimilarity(r,s),l=o>=this.config.minSimilarityScore;let c;o>=.95?c="high":o>=.75?c="medium":c="low",l||(o>.5?i.push("Names are similar but not identical - possible transcription variation"):i.push("Names appear to be completely different"));const u={sessionPatientName:e,emrPatientName:a,similarityScore:o,isMatch:l,confidence:c,normalizedSessionName:r,normalizedEmrName:s,warnings:i};return Z.debug("Patient name validation result:",u),u}normalizeName(e){if(!e)return"";let a=e.trim();return this.config.ignoreTitles&&(a=a.replace(/^(Mr\.?|Mrs\.?|Ms\.?|Dr\.?|Miss)\s+/i,"")),a=a.replace(/\s*\(\d+\)$/,""),a=a.replace(/\s*\(Session-\d+\)$/,""),a=a.replace(/\s+/g," ").trim(),this.config.caseSensitive||(a=a.toLowerCase()),a}calculateSimilarity(e,a){if(!e||!a)return 0;if(e===a)return 1;if(this.config.allowPartialMatches){const s=e.length>a.length?e:a,o=e.length>a.length?a:e;if(s.includes(o)&&o.length>=3)return .85}const i=this.levenshteinDistance(e,a),r=Math.max(e.length,a.length);return r===0?1:1-i/r}levenshteinDistance(e,a){const i=[];for(let r=0;r<=a.length;r++)i[r]=[r];for(let r=0;r<=e.length;r++)i[0][r]=r;for(let r=1;r<=a.length;r++)for(let s=1;s<=e.length;s++)a.charAt(r-1)===e.charAt(s-1)?i[r][s]=i[r-1][s-1]:i[r][s]=Math.min(i[r-1][s-1]+1,i[r][s-1]+1,i[r-1][s]+1);return i[a.length][e.length]}isFallbackPatientName(e){return e?[/^Patient \d+/i,/^Patient \d+ \(\d{1,2}:\d{2}\)$/i,/^Session-\d+$/i,/^Unknown$/i,/^Patient$/i].some(i=>i.test(e.trim())):!0}getValidationExplanation(e){return this.config.enabled?e.isMatch?`Patient names match with ${Math.round(e.similarityScore*100)}% confidence.`:e.similarityScore>.5?`Patient names are similar (${Math.round(e.similarityScore*100)}% match) but may represent different patients or transcription variations.`:`Patient names appear to be different (${Math.round(e.similarityScore*100)}% match). You may be inserting into the wrong patient file.`:"Patient name validation is disabled."}shouldSkipValidation(e,a){if(!this.config.enabled)return!0;if(this.isFallbackPatientName(e)&&this.isFallbackPatientName(a))return Z.debug("Skipping validation - both names are fallback names"),!0;const i=3;return e.trim().length<i||a.trim().length<i?(Z.debug("Skipping validation - names too short to validate"),!0):!1}}const ra=ft.getInstance();function ro(n){const{onRecordingComplete:e,onVoiceActivityUpdate:a,onRecordingTimeUpdate:i,onError:r,selectedMicrophoneId:s,getMicrophoneId:o}=n,[l,c]=d.useState({isRecording:!1,isPaused:!1,recordingTime:0,voiceActivityLevel:0,frequencyData:[],hasPermission:null,isRequestingPermission:!1,activeDeviceInfo:null,audioLevelHistory:[]}),u=d.useRef(null),f=d.useRef(null),h=d.useRef(null),m=d.useRef(null),b=d.useRef([]),g=d.useRef(),x=d.useRef(),w=d.useRef(!1),I=d.useCallback(async()=>{try{const T=h.current,M=f.current;if(!T){console.log("ðŸ”‡ detectVoiceActivity: analyser is null");return}if(!w.current){console.log("ðŸ”‡ detectVoiceActivity: not recording (ref check)");return}if(!M){console.log("ðŸ”‡ detectVoiceActivity: audio context is null");return}if(M.state!=="running")if(console.log("ðŸ”‡ detectVoiceActivity: audio context state is",M.state),M.state==="suspended"){console.log("ðŸŽ¤ Attempting to resume suspended audio context...");try{await M.resume(),console.log("âœ… Audio context resumed successfully")}catch(H){console.error("âŒ Failed to resume audio context:",H);return}}else return;const k=T.frequencyBinCount,j=new Uint8Array(k);T.getByteFrequencyData(j);const A=Math.max(...j),P=A>0;Math.random()<.01&&console.log("ðŸŽ¤ detectVoiceActivity debug:",{bufferLength:k,firstFewValues:Array.from(j.slice(0,5)),maxValue:A,hasAudioData:P,contextState:M.state,analyserConnected:T.numberOfInputs>0}),!P&&Math.random()<.05&&console.warn("âš ï¸ No audio data detected in frequency analysis:",{contextState:M.state,analyserFftSize:T.fftSize,bufferLength:k,isRecording:w.current});const _=j.reduce((H,K)=>H+K,0)/k,z=Math.min(_/128,1),Q=64,G=[],J=Math.floor(k/Q);for(let H=0;H<Q;H++){let K=0;const Ne=H*J,be=Math.min(Ne+J,k);for(let Y=Ne;Y<be;Y++)K+=j[Y];const te=Math.min(K/(be-Ne)/128,1);G.push(Math.pow(te,.7))}c(H=>{const K=[...H.audioLevelHistory,z].slice(-30),be=(K.length>10?K.slice(-10).reduce((te,Y)=>te+Y,0)/10:0)>.01||z>.05;return z>.05&&Math.random()<.03&&console.log("ðŸŽ¤ Audio Debug:",{level:Math.round(z*100)+"%",frequencyBars:G.length,avgFreq:Math.round(G.reduce((te,Y)=>te+Y,0)/G.length*100)+"%",maxFreq:Math.round(Math.max(...G)*100)+"%"}),{...H,voiceActivityLevel:z,frequencyData:G,audioLevelHistory:K,activeDeviceInfo:H.activeDeviceInfo?{...H.activeDeviceInfo,isWorking:be}:null}}),a?.(z,G),w.current&&(g.current=requestAnimationFrame(()=>I()))}catch(T){console.error("ðŸ”‡ detectVoiceActivity error:",T),w.current&&(g.current=requestAnimationFrame(()=>I()))}},[a]),R=d.useCallback(()=>{c(T=>({...T,recordingTime:0})),x.current=setInterval(()=>{c(T=>{const M=T.recordingTime+1;return i?.(M),{...T,recordingTime:M}})},1e3)},[i]),D=d.useCallback(()=>{x.current&&(clearInterval(x.current),x.current=void 0)},[]),v=d.useCallback(async()=>{try{const T=await navigator.permissions.query({name:"microphone"});c(M=>({...M,hasPermission:T.state==="granted"})),T.addEventListener("change",()=>{c(M=>({...M,hasPermission:T.state==="granted"}))})}catch{c(M=>({...M,hasPermission:null}))}},[]),y=d.useCallback(async()=>{console.log("ðŸŽ¤ useRecorder.startRecording() called"),c(T=>({...T,isRequestingPermission:!0}));try{const T=o?.()||s,M={audio:T?{deviceId:{exact:T},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}};let k;try{k=await navigator.mediaDevices.getUserMedia(M)}catch(G){if(T){console.warn("âš ï¸ Exact device constraint failed, attempting fallback:",{requestedDevice:T,error:G?.message||"Unknown error"});const J={audio:{deviceId:T,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}};try{k=await navigator.mediaDevices.getUserMedia(J),console.log("âœ… Fallback constraint succeeded")}catch(H){throw console.error("âŒ Both exact and fallback constraints failed:",H),H}}else throw G}m.current=k;const j=k.getAudioTracks();let A=null;if(j.length>0){const G=j[0],J=G.getSettings(),H=G.getConstraints();if(A={label:G.label||"Unknown Microphone",deviceId:J.deviceId||"unknown",isWorking:!1,hasMismatch:!1},console.log("ðŸŽ¤ Audio device details:",{label:G.label,deviceId:J.deviceId,requestedDeviceId:T,sampleRate:J.sampleRate,channelCount:J.channelCount,constraints:H,deviceMatch:J.deviceId===T}),T&&J.deviceId!==T){const K={requested:T,actual:J.deviceId,actualLabel:G.label,isExactConstraint:H.deviceId&&typeof H.deviceId=="object"&&"exact"in H.deviceId,isDefaultDevice:J.deviceId==="default"||!J.deviceId};console.warn("âš ï¸ Device mismatch detected:",K),K.isDefaultDevice?(console.warn("ðŸ’¡ Falling back to system default microphone"),console.warn("   - AirPods may not be properly connected or available"),console.warn("   - Check Bluetooth connection and system audio settings")):(console.warn("ðŸ’¡ Using different device than requested:"),console.warn(`   - Requested: ${T}`),console.warn(`   - Actually using: "${G.label}" (${J.deviceId})`),console.warn("   - This may indicate device availability issues")),A&&(A.hasMismatch=!0,A.requestedDeviceId=T)}else T&&(console.log("âœ… Device match confirmed:",{requested:T,actual:J.deviceId,label:G.label}),A&&(A.hasMismatch=!1))}w.current=!0,c(G=>({...G,hasPermission:!0,isRequestingPermission:!1,isRecording:!0,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:A,audioLevelHistory:[]}));const P=new AudioContext,_=P.createMediaStreamSource(k),z=P.createAnalyser();z.fftSize=256,z.smoothingTimeConstant=.8,_.connect(z),console.log("ðŸŽ¤ Web Audio API setup:",{contextState:P.state,analyserFFTSize:z.fftSize,frequencyBinCount:z.frequencyBinCount,sampleRate:P.sampleRate}),f.current=P,h.current=z,P.state==="suspended"&&(console.log("ðŸŽ¤ Resuming suspended audio context..."),await P.resume());const Q=new MediaRecorder(k,{mimeType:"audio/webm;codecs=opus"});b.current=[],Q.ondataavailable=G=>{G.data.size>0&&b.current.push(G.data)},Q.onstop=()=>{const G=new Blob(b.current,{type:"audio/webm;codecs=opus"});console.log("ðŸŽ¤ Audio recording completed:",{size:G.size,type:G.type,chunks:b.current.length,recordingTime:l.recordingTime}),e(G),C()},Q.start(100),u.current=Q,R(),setTimeout(async()=>{console.log("ðŸŽ¤ Starting voice activity detection..."),await I()},100)}catch(T){console.error("ðŸŽ¤ Recording start failed:",T),w.current=!1,c(M=>({...M,hasPermission:!1,isRequestingPermission:!1})),r?.(T)}},[s,e,r,I,R,l.recordingTime]),S=d.useCallback(()=>{console.log("ðŸ›‘ useRecorder.stopRecording() called"),w.current=!1,u.current&&u.current.state==="recording"&&u.current.stop(),c(T=>({...T,isRecording:!1})),D(),g.current&&(cancelAnimationFrame(g.current),g.current=void 0)},[D]),C=d.useCallback(()=>{w.current=!1,D(),g.current&&(cancelAnimationFrame(g.current),g.current=void 0),u.current&&u.current.state==="recording"&&u.current.stop(),m.current&&(m.current.getTracks().forEach(T=>T.stop()),m.current=null),f.current&&(f.current.close(),f.current=null),c(T=>({...T,isRecording:!1,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:null,audioLevelHistory:[]}))},[D]);return oe.useEffect(()=>(v(),C),[v,C]),{...l,startRecording:y,stopRecording:S,cleanup:C}}function sa(n){return n.trim().replace(/[-â€“â€”]+\s*$/,"").trim()}function so(n){return n.replace(/\s+/g," ").replace(/\.\s*\./g,".").replace(/;\s*;/g,";").replace(/,\s*,/g,",").trim()}function oo(n){const e=[];return n.toLowerCase(),[/(?:ejection fraction|ef)\s+(?:of\s+)?(\d+%?)/gi,/(?:blood pressure|bp)\s+(?:of\s+)?(\d+\/\d+)/gi,/(?:heart rate|hr)\s+(?:of\s+)?(\d+)/gi,/(?:chest pain|dyspnoea|palpitations|dizziness|syncope)/gi,/(?:atrial fibrillation|af|coronary artery disease|cad|heart failure|hypertension)/gi,/(?:aspirin|metoprolol|ramipril|atorvastatin|warfarin|apixaban)/gi].forEach(i=>{const r=n.match(i);r&&r.forEach(s=>{e.some(o=>o.toLowerCase().includes(s.toLowerCase()))||e.push(s)})}),n.includes("normal")&&(n.includes("ejection fraction")||n.includes("ef"))&&e.push("Normal EF"),e}function lo(n){const e=n.split(/[.!?]+/).filter(r=>r.trim().length>15),i=e.filter(r=>{const s=r.toLowerCase();return!s.includes("thank you")&&!s.includes("dear")&&!s.includes("kind regards")&&!s.includes("yours sincerely")&&!s.includes("best wishes")}).slice(0,3);return i.length===0?e.length>0?e[0].trim()+".":"No summary available.":i.join(". ").trim()+"."}function co(n){const e=oo(n);if(e.length>0){const a=[],i=e.filter(o=>/(?:atrial fibrillation|af|coronary artery disease|cad|heart failure|hypertension)/i.test(o)),r=e.filter(o=>/(?:ejection fraction|blood pressure|heart rate)/i.test(o)),s=e.filter(o=>/(?:chest pain|dyspnoea|palpitations|dizziness|syncope)/i.test(o));if(i.length>0&&a.push(`Patient with ${i.slice(0,2).join(" and ")}`),s.length>0&&a.push(`presenting with ${s.slice(0,2).join(" and ")}`),r.length>0&&a.push(`${r.slice(0,2).join(", ")}`),a.length>0)return a.join(". ")+"."}return lo(n)}function ai(n){try{console.log("ðŸ”§ Parsing QuickLetter structured response for SUMMARY: and LETTER: markers");const e=n.indexOf("SUMMARY:"),a=n.indexOf("LETTER:");if(console.log("ðŸ” Found SUMMARY: at index:",e),console.log("ðŸ” Found LETTER: at index:",a),e!==-1&&a!==-1&&e<a){console.log("âœ… Found both SUMMARY: and LETTER: markers in correct order");const l=n.substring(e+8,a).trim(),c=n.substring(a+7).trim();console.log("ðŸ“‹ Extracted summary raw:",l.substring(0,100)+"..."),console.log("ðŸ“ Extracted letter content length:",c.length);const u=sa(l);return console.log("ðŸ§¹ Cleaned summary:",u),{summary:u,letterContent:c}}console.log("ðŸ” Checking for legacy --- divider pattern");const i=n.match(/SUMMARY:\s*([\s\S]+?)(?=---)/),r=n.match(/LETTER:\s*([\s\S]*)/);if(i&&r){console.log("âœ… Found legacy pattern with --- divider");const l=sa(i[1].trim()),c=r[1].trim();return{summary:l,letterContent:c}}console.log("âš ï¸ No SUMMARY:/LETTER: markers found, using fallback parsing"),console.log("ðŸ“„ Raw output for fallback:",n.substring(0,200)+"...");const s=co(n),o=s.length>150?s.substring(0,147)+"...":s;return console.log("ðŸ”„ Generated fallback summary:",o),console.log("ðŸ“ Using entire output as letter content (length:",n.length,")"),{summary:o,letterContent:n}}catch(e){console.warn("âŒ Error parsing structured response:",e);const a=n.length>150?n.substring(0,147)+"...":n;return console.log("ðŸš¨ Using emergency fallback parsing"),{summary:a,letterContent:n}}}function uo(n){const{summary:e}=ai(n);return so(e)}const ii=d.memo(()=>t.jsx($i,{children:t.jsx(Hi,{children:t.jsx(ri,{})})})),ri=d.memo(()=>{const{state:n,actions:e}=to(),a=ba(),i=d.useRef(null),r=d.useRef(null),s=d.useRef(null),o=d.useRef(0),l=d.useRef(null),c=d.useRef(null),u=d.useRef(Ui.getInstance()).current,f=d.useRef(qi.getInstance()).current,h=d.useRef(null),m=d.useRef(null),b=d.useRef(null),g=d.useRef(null),x=ro({onRecordingComplete:p=>{if(b.current)return b.current(p)},onVoiceActivityUpdate:(p,N)=>{g.current&&g.current(p,N)},onRecordingTimeUpdate:d.useCallback(p=>{o.current=p},[]),getMicrophoneId:()=>a.selectedMicrophoneId}),w=d.useMemo(()=>(x.isRecording||r.current!==null,n.selectedSessionId),[n.selectedSessionId,x.isRecording]),I=d.useMemo(()=>w?n.patientSessions.find(N=>N.id===w)?.patient?.name:void 0,[w,n.patientSessions]),R=d.useCallback(()=>{c.current&&(c.current.abort(),c.current=null),e.streamCancelled(),e.setStreaming(!1),e.setAiGeneratedSummary(void 0)},[e]),D=d.useCallback(async p=>{try{switch(p){case"quick-letter":return(await ke(()=>import("./chunks/agents.B5B7lzIs.js").then(E=>E.Q),__vite__mapDeps([5,6]))).QUICK_LETTER_SYSTEM_PROMPTS.primary;case"investigation-summary":return(await ke(()=>import("./chunks/InvestigationSummarySystemPrompts.DOXkk-rD.js"),__vite__mapDeps([11,5,6]))).INVESTIGATION_SUMMARY_SYSTEM_PROMPTS.primary;case"background":return(await ke(()=>import("./chunks/BackgroundSystemPrompts.Dx0p2kfn.js"),[])).BACKGROUND_SYSTEM_PROMPTS.primary;case"medication":return(await ke(()=>import("./chunks/MedicationSystemPrompts.Cx6BM4t2.js"),__vite__mapDeps([12,5,6]))).MEDICATION_SYSTEM_PROMPTS.primary;case"bloods":return(await ke(()=>import("./chunks/agents.B5B7lzIs.js").then(E=>E.B),__vite__mapDeps([5,6]))).BLOODS_SYSTEM_PROMPTS.primary;case"imaging":return(await ke(()=>import("./chunks/agents.B5B7lzIs.js").then(E=>E.I),__vite__mapDeps([5,6]))).IMAGING_SYSTEM_PROMPTS.primary;default:return null}}catch(N){return console.warn("Failed to load system prompt for agent",p,N),null}},[]),v=p=>{switch(p){case"investigation-summary":return{model:kt.QUICK_MODEL,maxTokens:2e3};case"background":return{model:kt.QUICK_MODEL,maxTokens:2e3};case"medication":return{model:kt.QUICK_MODEL,maxTokens:3e3};case"quick-letter":return{model:kt.REASONING_MODEL,maxTokens:5e3};default:return{model:kt.REASONING_MODEL,maxTokens:4e3}}},y=d.useCallback(async(p,N,E)=>{const q=await D(N);if(!q)return!1;e.clearStream(),e.setStreaming(!0),e.setProcessingStatus("processing");const O=new AbortController;c.current=O;const{model:$,maxTokens:X}=v(N);let se=null;const ce=performance.now();return await Bi({model:$,messages:[{role:"system",content:q},{role:"user",content:E}],temperature:.3,maxTokens:X,signal:O.signal,onMessage:ie=>{se==null&&ie?.choices?.[0]?.delta?.content&&(se=Math.round(performance.now()-ce),e.setTTFT(se))},onToken:ie=>{e.appendStreamChunk(ie)},onEnd:(ie,ve)=>{let we,de=ie;if(N==="quick-letter")try{const fe=ai(ie);we=fe.summary,de=fe.letterContent,console.log("ðŸ“‹ Parsed QuickLetter streaming output:"),console.log("   Summary:",we.substring(0,100)+"..."),console.log("   Letter content length:",de.length)}catch(fe){console.warn("âš ï¸ Failed to parse QuickLetter output:",fe),we=uo(ie),de=ie}e.streamDone(de,ve,se),we&&e.setAiGeneratedSummary(we),N==="quick-letter"&&(console.log("ðŸ” Streaming completion: detecting missing information for QuickLetter"),(async()=>{try{const{QuickLetterAgentPhase3:fe}=await ke(async()=>{const{QuickLetterAgentPhase3:je}=await import("./chunks/agents.B5B7lzIs.js").then(xe=>xe.i);return{QuickLetterAgentPhase3:je}},__vite__mapDeps([5,6])),F=new fe,L=E.toLowerCase(),ee={letter_type:"general",missing_purpose:[],missing_clinical:[],missing_recommendations:[],completeness_score:"80%"};!L.includes("refer")&&!L.includes("follow up")&&!L.includes("consultation")&&!L.includes("thank you")&&ee.missing_purpose.push("Letter purpose or reason for correspondence"),!L.includes("patient")&&!L.includes("gentleman")&&!L.includes("lady")&&!L.includes("year old")&&!L.includes("age")&&ee.missing_clinical.push("Patient demographics or context"),!L.includes("examination")&&!L.includes("found")&&!L.includes("shows")&&!L.includes("revealed")&&!L.includes("noted")&&L.length>100&&ee.missing_clinical.push("Clinical examination findings");const le=ee.missing_purpose.length+ee.missing_clinical.length+ee.missing_recommendations.length;le>0?(console.log("ðŸ“Š Setting missing information from streaming completion:",le,"items"),e.setMissingInfo(ee)):(console.log("âœ… No missing information detected during streaming completion"),e.setMissingInfo(null))}catch(fe){console.warn("âš ï¸ Failed to detect missing information during streaming:",fe)}})()),e.setProcessing(!1),e.setProcessingStatus("complete"),e.setStreaming(!1),c.current=null,e.updatePatientSession(p,{results:de,summary:we,status:"completed",completed:!0,completedTime:Date.now()})},onError:ie=>{ie.name==="AbortError"?e.streamCancelled():e.streamError(String(ie)),e.setStreaming(!1),e.setAiGeneratedSummary(void 0),c.current=null}}),!0},[e,D]),[S,C]=d.useState(!1);d.useCallback(()=>(h.current||(h.current=new no),h.current),[]);const T=d.useCallback((p,N,E,q,O)=>{const $=()=>{const X={id:`failed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,audioBlob:p,timestamp:Date.now(),agentType:N,errorMessage:E,transcriptionAttempt:q,metadata:{duration:O||o.current||0,fileSize:p.size,recordingTime:O||o.current||0}};e.setFailedRecordings([X,...n.failedAudioRecordings.slice(0,4)])};"requestIdleCallback"in window?requestIdleCallback($,{timeout:1e3}):setTimeout($,0)},[e,n.failedAudioRecordings]);d.useCallback(()=>{e.setFailedRecordings([]),console.log("ðŸ—‘ï¸ Cleared all failed audio recordings")},[e]);const M=d.useCallback(async(p,N,E)=>{console.log("ðŸ”„ Starting background processing for session:",p),console.log("ðŸŽ¯ Current selectedSessionId at start:",n.selectedSessionId);const q=new AbortController;try{e.updatePatientSession(p,{transcriptionStartTime:Date.now()}),console.log("ðŸ”„ Queuing transcription for session:",p);const O=Date.now(),$=at.getInstance(),{AudioProcessingQueueService:X}=await ke(async()=>{const{AudioProcessingQueueService:re}=await Promise.resolve().then(()=>Ir);return{AudioProcessingQueueService:re}},void 0),se=X.getInstance(),ce=await new Promise((re,ue)=>{se.addJob(p,N,E,{onProgress:(Pe,$t)=>{console.log(`ðŸ“Š Session ${p} transcription status:`,Pe,$t||""),Pe==="processing"?e.updatePatientSession(p,{status:"transcribing"}):(Pe==="failed"||Pe==="cancelled")&&e.updatePatientSession(p,{status:"error",errors:[$t||"Transcription failed"],completedTime:Date.now()})},onComplete:Pe=>{console.log("âœ… Queued transcription completed for session:",p),re(Pe)},onError:Pe=>{console.error("âŒ Queued transcription failed for session:",p,Pe),ue(new Error(Pe))}})}),ie=Date.now()-O;$.recordMetrics("transcription",ie,{agentType:E,audioSize:N.size}),console.log("âœ… Transcription complete for session:",p),console.log("ðŸ“ Transcription result:",ce.substring(0,200)+(ce.length>200?"...":""));let ve=ce,we=0;try{const ue=await _n.getInstance().applyPhrasebookCorrections(ce,E);ve=ue.correctedText,we=ue.appliedCorrections,we>0&&(console.log(`ðŸ“– Applied ${we} phrasebook corrections`),e.addToast({id:`corrections-${p}`,message:`Applied ${we} terminology correction${we===1?"":"s"}`,type:"info",duration:3e3}))}catch(re){console.warn("âš ï¸ Failed to apply phrasebook corrections:",re)}const de=ve.trim(),fe=de.length<10,F=de.length===0,L=de.startsWith("[")&&de.endsWith("]"),ee=de.toLowerCase().includes("transcription failed")||de.toLowerCase().includes("server not running")||de.toLowerCase().includes("timed out");if(F||fe||L||ee){console.warn("âŒ Transcription validation failed:",{length:de.length,isEmpty:F,tooShort:fe,isPlaceholder:L,isError:ee,preview:de.substring(0,100)}),setTimeout(()=>{T(N,E,`Transcription validation failed: ${F?"Empty transcription":fe?`Too short (${de.length} chars)`:L?"Placeholder response":"Transcription error"}`,de);const ue=F?"no-audio":fe?"too-short":L?"service-unavailable":"error";Wt.transcriptionFailed(ue);const Pe=F?"No audio detected":fe?"Recording too short":L?"Transcription service unavailable":"Transcription service error";e.updatePatientSession(p,{transcription:de,status:"error",errors:[`Audio transcription failed: ${Pe}`],completedTime:Date.now()}),e.setTranscription(de),e.setErrors([`Audio transcription failed: ${Pe}`]),e.setProcessingStatus("error")},0),console.log("ðŸš« Skipping agent processing due to transcription validation failure");return}console.log("âœ… Transcription validation passed, proceeding with agent processing");const le=Date.now();if(e.updatePatientSession(p,{transcription:ve,status:"processing",processingStartTime:le}),e.setTranscription(ve),e.setProcessingStatus("processing"),e.setTimingData({processingStartTime:le}),e.setTranscriptionApproval({status:"pending",originalText:ce,currentText:ce,hasBeenEdited:!1}),await y(p,E,ce))return;console.log("ðŸ”„ Processing with agent for session (non-streaming):",p,E);const xe=Date.now(),{AgentFactory:Ce}=await ke(async()=>{const{AgentFactory:re}=await import("./chunks/AgentFactory.DJn3AVz8.js").then(ue=>ue.a);return{AgentFactory:re}},__vite__mapDeps([4,2,1,5,6,7,8])),V=await Ce.processWithAgent(E,ve,void 0,q.signal,{skipNotification:!0}),ne=Date.now()-xe;$.recordMetrics("agent-processing",ne,{agentType:E}),console.log("âœ… Agent processing complete for session:",p),e.updatePatientSession(p,{results:V.content,summary:V.summary||"",agentName:V.agentName,status:"completed",completed:!0,completedTime:Date.now(),processingTime:V.processingTime,warnings:V.warnings,errors:V.errors}),$.recordMetrics("complete",Date.now()-O,{agentType:E});const ae=p===n.selectedSessionId;if(ae?(e.setTranscription(ce),e.setResults(V.content),e.setMissingInfo(V.missingInfo||null),console.log("ðŸŽ¯ Updated main results panel for currently selected session:",p)):console.log("ðŸ”• Background session completed, results stored in session only:",p),E==="bloods")try{console.log("ðŸ©¸ Bloods workflow completed - inserting results into Tests Requested field");const re={content:V.content};(await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods-insert",data:re}))?.success?console.log("âœ… Blood test results inserted into Tests Requested field successfully"):console.warn("âš ï¸ Failed to insert blood test results into Tests Requested field")}catch(re){console.error("âŒ Failed to insert blood test results into Tests Requested field:",re)}ae&&(V.summary&&V.summary.trim()?(Z.debug("Setting AI-generated summary",{component:"summary",length:V.summary.length}),e.setAiGeneratedSummary(V.summary)):e.setAiGeneratedSummary(void 0),e.setCurrentAgent(E),console.log("ðŸŽ¯ Updated agent and summary for currently selected session:",p));const et=n.patientSessions.find(re=>re.id===p),dt=et?.recordingStartTime?O-et.recordingStartTime:0;console.log("ðŸ” Session completion check:",{sessionId:p,currentSelectedSessionId:n.selectedSessionId,isCurrentlySelectedAtCompletion:ae,willUpdateGlobalUI:ae}),ae?(e.setTimingData({recordingTime:dt,transcriptionTime:ie,agentProcessingTime:ne,totalProcessingTime:dt+ie+ne,processingStartTime:O}),e.setProcessingStatus("complete"),e.setProcessing(!1),console.log("ðŸŽ¯ Updated global UI state for currently selected session:",p)):console.log("ðŸ”• Background session completed, skipping global UI state updates for:",p),console.log("âœ… Session completed in background:",p);try{const re=n.patientSessions.find(ue=>ue.id===p)?.patient.name||"Unknown Patient";await fa.showCompletionNotification(E,V.processingTime||0,void 0,re),console.log("ðŸŽ‰ Background session completed for:",re),Wt.sessionReady(re,E)}catch(re){console.warn("Failed to send completion notification:",re)}if(ae)try{const re=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;setTimeout(()=>{const ue=m.current||document.getElementById("results-section");ue&&typeof ue.scrollIntoView=="function"&&(ue.scrollIntoView({behavior:re?"auto":"smooth",block:"start"}),console.log("ðŸŽ¯ Auto-scrolled to results for currently selected session:",p))},50)}catch(re){console.debug("Auto-scroll to results failed (non-critical):",re instanceof Error?re.message:re);try{const ue=m.current||document.getElementById("results-section");ue&&typeof ue.focus=="function"&&ue.focus({preventScroll:!1})}catch(ue){console.debug("Fallback focus also failed:",ue instanceof Error?ue.message:ue)}}else console.log("ðŸ”• Background session completed, skipping auto-scroll for:",p)}catch(O){console.error("âŒ Background processing failed for session:",p,O),setTimeout(()=>{if(e.setProcessing(!1),e.setProcessingStatus("idle"),O.name==="AbortError")e.updatePatientSession(p,{status:"cancelled",errors:["Processing was cancelled"]});else{const se=n.patientSessions.find(ce=>ce.id===p)?.patient.name||"Unknown Patient";e.updatePatientSession(p,{status:"error",errors:[O.message||"Processing failed"]}),Wt.processingFailed(se)}T(N,E,O.message||"Background processing failed","",0)},0)}},[e,u,T,n.patientSessions]),k=d.useCallback(async p=>{if(s.current=p,n.ui.isCancelling){console.log("ðŸ›‘ Recording completed but cancellation in progress - ignoring"),e.setCancelling(!1);return}const N=i.current||n.ui.activeWorkflow,E=r.current||n.currentSessionId;if(!N){console.error("âŒ No active workflow selected"),e.setErrors(["No workflow selected. Please select a workflow type before recording."]);return}if(!E){console.error("âŒ No current session found"),e.setErrors(["No active session. Please start a new recording."]);return}console.log("ðŸŽ¤ Recording completed, starting background processing for session:",E),e.updatePatientSession(E,{status:"transcribing",audioBlob:p}),e.setCurrentSessionId(null),r.current=null,e.setActiveWorkflow(null),i.current=null,e.setSelectedSessionId(null),e.clearRecording();const O=n.patientSessions.find($=>$.id===E)?.patient.name||"Patient";Wt.recordingSent(O,N),M(E,p,N),console.log("ðŸš€ Background processing started for session:",E,"- ready for new recordings!")},[e,M,n.ui.isCancelling,n.currentSessionId]),j=d.useCallback((p,N)=>{d.startTransition(()=>{e.setVoiceActivity(p,N)})},[e]);d.useEffect(()=>{b.current=k,g.current=j},[k,j]);const A=d.useCallback(p=>{console.log("ðŸ“‹ ðŸ” USER EXPLICIT SESSION SELECTION - Selected:",{patientName:p.patient.name,sessionId:p.id,status:p.status,hasTranscription:!!p.transcription,hasResults:!!p.results,hasSummary:!!p.summary,agentType:p.agentType,currentBackgroundWork:{isRecording:x.isRecording,isProcessing:n.isProcessing,streaming:n.streaming,currentSessionId:n.currentSessionId}}),d.startTransition(()=>{console.log("ðŸ“‹ ðŸŽ¯ Loading session into isolated display state:",p.id),e.setDisplaySession(p),console.log("âœ… ðŸ“‹ SESSION SELECT COMPLETE - Session loaded in isolated display (will show even during active work):",{patientName:p.patient.name,sessionId:p.id,status:p.status,priorityLevel:"PRIORITY 1 - User Explicit Selection"}),setTimeout(()=>{console.log("ðŸ” DISPLAY STATE CHECK - Post session selection:",{isDisplayingSession:n.displaySession?.isDisplayingSession,displaySessionId:n.displaySession?.displaySessionId,displayResultsLength:n.displaySession?.displayResults?.length||0,displayTranscriptionLength:n.displaySession?.displayTranscription?.length||0,activeRecordingResults:n.results?.length||0,activeRecordingTranscription:n.transcription?.length||0,isRecording:x.isRecording,currentSessionId:n.currentSessionId})},100)})},[e,n.displaySession,n.results,n.transcription,n.currentSessionId,x.isRecording]),P=d.useCallback(p=>{const N=p.split(/[.!?]+/).filter(O=>O.trim().length>0);if(N.length===0)return p.substring(0,150)+"...";const E=["stenosis","regurgitation","valve","artery","diagnosis","treatment"],q=N.filter(O=>E.some($=>O.toLowerCase().includes($)));return q.length>0?q.slice(0,2).join(". ").trim()+".":N[0]?.trim()+"."},[]);d.useCallback((p,N)=>N&&N.trim()?N.trim():P(p),[P]);const _=d.useCallback(()=>n.displaySession.isDisplayingSession&&n.displaySession.displaySessionId?(console.log("ðŸ“‹ ðŸ¥‡ PRIORITY 1: Showing DISPLAY session data (user explicitly selected)",{displaySessionId:n.displaySession.displaySessionId,hasDisplayResults:!!n.displaySession.displayResults,hasDisplayTranscription:!!n.displaySession.displayTranscription,backgroundActiveWork:{isRecording:x.isRecording,isProcessing:n.isProcessing,streaming:n.streaming,currentSessionId:n.currentSessionId}}),{transcription:n.displaySession.displayTranscription,results:n.displaySession.displayResults,summary:n.displaySession.displaySummary,agent:n.displaySession.displayAgent,agentName:n.displaySession.displayAgentName,patientInfo:n.displaySession.displayPatientInfo,processingStatus:"complete",isDisplayingSession:!0}):x.isRecording||n.isProcessing||n.streaming||n.currentSessionId!==null?(console.log("ðŸŽ¯ ðŸ¥ˆ PRIORITY 2: Showing ACTIVE recording data (no explicit selection)",{isRecording:x.isRecording,isProcessing:n.isProcessing,streaming:n.streaming,currentSessionId:n.currentSessionId,processingStatus:n.processingStatus,streamBuffer:n.streamBuffer?.length||0}),n.streaming&&n.results&&n.processingStatus==="complete"&&console.warn("ðŸš¨ POTENTIAL STUCK STREAMING STATE DETECTED:",{streaming:n.streaming,hasResults:!!n.results,resultsLength:n.results.length,processingStatus:n.processingStatus,streamBuffer:n.streamBuffer?.length||0}),{transcription:n.transcription,results:n.results,summary:n.aiGeneratedSummary,agent:n.currentAgent,agentName:n.currentAgentName,patientInfo:n.currentPatientInfo,processingStatus:n.processingStatus,isDisplayingSession:!1}):(console.log("ðŸ”§ ðŸ¥‰ PRIORITY 3: Showing default ACTIVE recording data (empty state)",{noExplicitSelection:!n.displaySession.isDisplayingSession,noActiveWork:!0,defaultFallback:!0}),{transcription:n.transcription,results:n.results,summary:n.aiGeneratedSummary,agent:n.currentAgent,agentName:n.currentAgentName,patientInfo:n.currentPatientInfo,processingStatus:n.processingStatus,isDisplayingSession:!1}),[x.isRecording,n.isProcessing,n.streaming,n.currentSessionId,n.transcription,n.results,n.aiGeneratedSummary,n.currentAgent,n.currentAgentName,n.currentPatientInfo,n.processingStatus,n.displaySession]),z=d.useCallback(async()=>{try{console.log("ðŸ‘¤ Extracting patient data from EMR...");const p=await chrome.tabs.query({active:!0,currentWindow:!0});console.log("ðŸ” Current active tab:",p[0]?.url);const N=3;let E=null;for(let q=1;q<=N;q++){console.log(`ðŸ” Attempt ${q}/${N}: Sending extraction request to content script...`);try{const O=await Promise.race([chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),new Promise(($,X)=>setTimeout(()=>X(new Error("Patient extraction timeout")),1e4))]);if(console.log("ðŸ“¬ Received response from content script:",O),O?.success&&O?.data){const $=O.data;console.log(`âœ… Patient data extraction succeeded on attempt ${q}:`,$);const X=$.name&&$.name.trim()!=="",se=$.id&&$.id.trim()!=="";if(X||se)return console.log("âœ… Patient data validation passed - returning data"),$;console.warn(`âš ï¸ Attempt ${q}: Extracted data lacks name and ID - will retry`),E=new Error("Extracted data lacks required patient name or ID")}else console.warn(`âš ï¸ Attempt ${q}: No valid patient data in response`),E=new Error(O?.error||"No patient data found in response")}catch(O){if(console.warn(`âš ï¸ Attempt ${q} failed:`,O.message),E=O,q<N){const $=Math.min(1e3*Math.pow(2,q-1),5e3);console.log(`â³ Waiting ${$}ms before retry...`),await new Promise(X=>setTimeout(X,$))}}}return console.error("âŒ All patient extraction attempts failed. Last error:",E),null}catch(p){return console.error("âŒ Critical error in patient data extraction:",p),console.error("ðŸ” Error details:",{name:p instanceof Error?p.name:"Unknown",message:p instanceof Error?p.message:p,stack:p instanceof Error?p.stack:void 0}),null}},[]),Q=d.useCallback(async p=>{console.log("ðŸŽ¯ Workflow selected:",p),n.processingStatus==="error"&&(console.log("ðŸ”„ Auto-recovering from error state - resetting to idle for new recording"),e.setProcessingStatus("idle"),e.setErrors([]),e.setWarnings([]),e.clearRecording()),(n.results?.trim().length>0||n.transcription?.trim().length>0)&&(console.log("ðŸ”„ Clearing previous session before starting new workflow:",p),e.clearRecording()),n.displaySession.isDisplayingSession&&(console.log("ðŸ”„ Clearing display session view for new recording"),e.clearDisplaySession());const N=n.patientSessions.filter(E=>["recording","transcribing","processing"].includes(E.status));if(x.isRecording&&n.ui.activeWorkflow===p)console.log("ðŸ›‘ Stopping current recording for:",p),x.stopRecording();else if(!x.isRecording){if(N.length>=3){e.setErrors([`Too many active sessions (${N.length}). Please wait for some to complete before starting new recordings.`]);return}if(console.log(`ðŸ“Š Current active sessions: ${N.length}/3 - proceeding with new recording`),console.log("ðŸ” Checking Whisper server status before recording..."),!n.modelStatus.whisperServer?.running){console.error("âŒ Whisper server not running"),e.setErrors(["Whisper server is not running. Please start the server first using: ./start-whisper-server.sh"]);return}console.log("ðŸ“‹ Extracting patient data for new recording..."),e.setExtractingPatients(!0);let E=null;try{const $=await z();if($&&($.name||$.id))E={name:$.name||"Patient",id:$.id||"No ID",dob:$.dob||"",age:$.age||"",phone:$.phone,email:$.email,medicare:$.medicare,insurance:$.insurance,address:$.address,extractedAt:$.extractedAt||Date.now()},e.setCurrentPatientInfo(E),console.log("âœ… Patient data extracted successfully:",$.name,"(ID:",$.id+")");else{console.log("âš ï¸ No patient data extracted from EMR - generating fallback patient info");const X=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});E={name:`Patient ${(n.patientSessions?.length||0)+1} (${X})`,id:`Session-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},e.setCurrentPatientInfo(E),console.log("ðŸ“ Generated fallback patient info:",E.name)}}catch($){console.error("âŒ Patient extraction failed with error:",$);const X=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});E={name:`Patient ${(n.patientSessions?.length||0)+1} (${X})`,id:`Session-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},e.setCurrentPatientInfo(E),console.log("ðŸ“ Generated fallback patient info after extraction error:",E.name)}finally{e.setExtractingPatients(!1)}const q=`session-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,O={id:q,patient:E,transcription:"",results:"",agentType:p,agentName:"",timestamp:Date.now(),status:"recording",completed:!1,recordingStartTime:Date.now()};e.addPatientSession(O),e.setCurrentSessionId(q),r.current=q,console.log("ðŸ“ Created new session:",q,"for patient:",O.patient.name),console.log("âœ… Whisper server is running, starting recording..."),e.setActiveWorkflow(p),i.current=p,x.startRecording(),e.setProcessingStartTime(Date.now())}},[x,n.ui.activeWorkflow,e,z,n.patientSessions,n.modelStatus]),G=d.useCallback(()=>{console.log("ðŸ›‘ Cancellation requested"),e.setCancelling(!0),l.current&&(l.current.abort(),l.current=null),c.current&&(c.current.abort(),c.current=null),x.isRecording&&x.stopRecording();const p=r.current||n.currentSessionId;p&&(console.log("ðŸ§¹ Cleaning up current session:",p),e.removePatientSession(p),e.setCurrentSessionId(null),r.current=null),e.setActiveWorkflow(null),e.setProcessing(!1),e.setProcessingStatus("idle"),e.setWarnings([]),e.setErrors([]),e.setResults(""),e.setResultsSummary(""),i.current=null,setTimeout(()=>e.setCancelling(!1),1e3)},[x,e]),J=d.useCallback(async p=>{try{await navigator.clipboard.writeText(p),console.log("ðŸ“‹ Text copied to clipboard")}catch(N){throw console.error("Failed to copy text:",N),N}},[]),[H,K]=d.useState({status:"idle",message:""}),Ne=d.useCallback(async p=>{try{console.log("âœï¸ Transcription edited, length:",p.length),e.setTranscription(p);const N=n.transcription;if(N&&p!==N){const E={...n.transcriptionApproval,status:"edited",originalText:n.transcriptionApproval.originalText||N,currentText:p,hasBeenEdited:!0,editTimestamp:Date.now()};e.setTranscriptionApproval(E),K({status:"idle",message:'Edit ready - click "Perfect" to submit for training'}),console.log("âœï¸ Transcription marked as edited, ready for approval")}else if(p===N){const E={...n.transcriptionApproval,status:"pending",currentText:p,hasBeenEdited:!1};e.setTranscriptionApproval(E),K({status:"idle",message:""})}}catch(N){console.error("âŒ Failed to handle transcription edit:",N),K({status:"error",message:"âš  Failed to process edit",timestamp:new Date}),setTimeout(()=>{K({status:"idle",message:""})},5e3)}},[n.transcription,n.transcriptionApproval,n.currentAgent,n.selectedSessionId,e]),be=d.useCallback(async p=>{try{console.log("âœ… Transcription approval status changed:",p);const N=n.transcription,E=n.transcriptionApproval,q={...E,status:p,currentText:N,approvalTimestamp:p==="approved"?Date.now():E.approvalTimestamp,editTimestamp:p==="edited"?Date.now():E.editTimestamp};if(e.setTranscriptionApproval(q),p==="approved"&&N.trim()!==""){console.log("ðŸ’¾ Logging transcription for ASR training");const O=E.hasBeenEdited,$=E.originalText||N;await _n.getInstance().addCorrection({rawText:$,correctedText:N,agentType:n.currentAgent||"unknown",sessionId:n.selectedSessionId||"streaming",approvalStatus:"approved",userExplicitlyApproved:!0,approvalTimestamp:Date.now(),editTimestamp:O?E.editTimestamp||Date.now():void 0}),K({status:"saved",message:O?"âœ“ Corrected transcription saved for training":"âœ“ Perfect transcription saved for training",timestamp:new Date}),setTimeout(()=>{K({status:"idle",message:""})},3e3)}}catch(N){console.error("âŒ Failed to handle transcription approval:",N),K({status:"error",message:"âš  Failed to save approval",timestamp:new Date}),setTimeout(()=>{K({status:"idle",message:""})},5e3)}},[n.transcription,n.transcriptionApproval,n.currentAgent,n.selectedSessionId,e]),te=d.useCallback(async p=>{try{if(console.log("ðŸ”„ Reprocessing transcription with agent:",p),!n.transcription||n.transcription.trim().length===0){console.error("âŒ No transcription available for reprocessing"),e.setErrors(["No transcription available for reprocessing"]);return}if(n.isProcessing){console.warn("âš ï¸ Already processing, ignoring reprocess request");return}e.setResults(""),e.setWarnings([]),e.setErrors([]),e.setResultsSummary(""),e.setProcessing(!0),e.setProcessingStatus("processing"),e.setCurrentAgent(p),e.setProcessingStartTime(Date.now()),console.log("ðŸ”„ Starting agent processing with:",p),e.setMissingInfo(null);const{AgentFactory:N}=await ke(async()=>{const{AgentFactory:q}=await import("./chunks/AgentFactory.DJn3AVz8.js").then(O=>O.a);return{AgentFactory:q}},__vite__mapDeps([4,2,1,5,6,7,8])),E=await N.processWithAgent(p,n.transcription,{isReprocessing:!0},c.current?.signal);console.log("âœ… Agent reprocessing completed"),e.setResults(E.content),e.setMissingInfo(E.missingInfo||null),E.summary&&E.summary.trim()?(Z.debug("Setting AI-generated summary from reprocessing",{component:"summary",agent:p}),e.setAiGeneratedSummary(E.summary)):e.setAiGeneratedSummary(void 0),e.setTimingData({agentProcessingTime:E.processingTime,totalProcessingTime:E.processingTime}),e.setCurrentAgentName(E.agentName),e.setProcessingStatus("complete"),e.setProcessing(!1),E.warnings?.length&&e.setWarnings(E.warnings),E.errors?.length&&e.setErrors(E.errors)}catch(N){console.error("âŒ Agent reprocessing failed:",N),e.setProcessing(!1),e.setProcessingStatus("idle"),N.name==="AbortError"?console.log("ðŸ›‘ Agent reprocessing was cancelled"):e.setErrors([N.message||"Reprocessing failed"])}},[n.transcription,n.isProcessing,e]),Y=d.useCallback(async p=>{try{if(!n.transcription||!n.currentAgent)return;e.setProcessing(!0),e.setProcessingStatus("processing");const N=Object.entries(p).filter(([$,X])=>X&&X.trim().length>0).map(([$,X])=>`- ${$}: ${X.trim()}`).join(`
`),E=`${n.transcription}

Additional details provided by clinician to fill missing information:
${N}`,{AgentFactory:q}=await ke(async()=>{const{AgentFactory:$}=await import("./chunks/AgentFactory.DJn3AVz8.js").then(X=>X.a);return{AgentFactory:$}},__vite__mapDeps([4,2,1,5,6,7,8])),O=await q.processWithAgent(n.currentAgent,E,{isReprocessing:!0,withMissingInfo:!0},c.current?.signal);e.setResults(O.content),e.setMissingInfo(O.missingInfo||null),e.setProcessingStatus("complete"),e.setProcessing(!1)}catch(N){console.error("Reprocess with missing info failed:",N),e.setProcessing(!1),e.setProcessingStatus("idle")}},[n.transcription,n.currentAgent,e]),Te=d.useCallback(async()=>{if(!(!n.results||n.currentAgent!=="quick-letter"||n.isGeneratingPatientVersion))try{console.log("ðŸŽ¯ Generating patient-friendly version of letter"),e.setGeneratingPatientVersion(!0);const{QuickLetterAgentPhase3:p}=await ke(async()=>{const{QuickLetterAgentPhase3:q}=await import("./chunks/agents.B5B7lzIs.js").then(O=>O.i);return{QuickLetterAgentPhase3:q}},__vite__mapDeps([5,6])),E=await new p().generatePatientVersion(n.results);e.setPatientVersion(E),console.log("âœ… Patient version generated successfully")}catch(p){console.error("âŒ Failed to generate patient version:",p),e.setPatientVersion("Error generating patient version. Please try again.")}finally{e.setGeneratingPatientVersion(!1)}},[n.results,n.currentAgent,n.isGeneratingPatientVersion,e]),ye=d.useCallback(async p=>{try{console.log("ðŸ” Starting patient name validation before EMR insertion");let N="";if(n.selectedSessionId){const O=n.patientSessions.find($=>$.id===n.selectedSessionId);O&&(N=O.patient.name,console.log("ðŸ“‹ Using selected session patient name:",N))}else if(n.currentSessionId){const O=n.patientSessions.find($=>$.id===n.currentSessionId);O&&(N=O.patient.name,console.log("ðŸ“‹ Using current session patient name:",N))}else n.currentPatientInfo?.name&&(N=n.currentPatientInfo.name,console.log("ðŸ“‹ Using current patient info name:",N));let E="";try{const O=await z();O?.name?(E=O.name,console.log("ðŸ¥ Extracted fresh EMR patient name:",E)):n.currentPatientInfo?.name&&(E=n.currentPatientInfo.name,console.log("ðŸ¥ Using cached EMR patient name:",E))}catch(O){console.warn("âš ï¸ Failed to extract fresh patient data, using cached:",O),n.currentPatientInfo?.name&&(E=n.currentPatientInfo.name)}if(ra.shouldSkipValidation(N,E))return console.log("â© Skipping patient name validation - insufficient data"),!0;const q=ra.validatePatientNames(N,E);return console.log("ðŸ“Š Patient name validation result:",q),q.isMatch?(console.log("âœ… Patient names match - proceeding with insertion"),!0):(console.log("âš ï¸ Patient name mismatch detected - showing confirmation modal"),new Promise(O=>{e.setPatientMismatchData({comparison:q,textToInsert:p,onConfirm:()=>{console.log("âœ… User confirmed insertion despite mismatch"),e.setPatientMismatchModal(!1),e.setPatientMismatchData({comparison:null,textToInsert:null,onConfirm:null,onCancel:null}),O(!0)},onCancel:()=>{console.log("âŒ User cancelled insertion due to mismatch"),e.setPatientMismatchModal(!1),e.setPatientMismatchData({comparison:null,textToInsert:null,onConfirm:null,onCancel:null}),O(!1)}}),e.setPatientMismatchModal(!0)}))}catch(N){return console.error("âŒ Patient name validation failed:",N),console.log("âš ï¸ Allowing insertion due to validation error"),!0}},[n.selectedSessionId,n.currentSessionId,n.patientSessions,n.currentPatientInfo,z,e]),Be=d.useCallback(async(p,N,E)=>{try{if(!await ye(p)){console.log("ðŸ›‘ Insertion cancelled due to patient mismatch");return}console.log("âœ… Patient validation passed - proceeding with insertion");const O=_(),$=N?null:E||O.agent||n.currentAgent||n.ui.activeWorkflow,X=N||ni($);if(console.log("ðŸ” EMR insertion debug:"),console.log("  - agentContext:",E),console.log("  - currentAgent:",n.currentAgent),console.log("  - activeWorkflow:",n.ui.activeWorkflow),console.log("  - displayData.agent:",O.agent),console.log("  - currentAgentType:",$),console.log("  - targetField:",N),console.log("  - field:",X),console.log("  - supportsFieldSpecific:",ia($)),console.log("  - isDisplayingSession:",O.isDisplayingSession),X&&ia($)){console.log(`ðŸ“ Opening specific EMR field: ${X} (${xn(X)})`),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:X,data:{type:"manual"}}),console.log(`ðŸ“ Inserting text to ${xn(X)} field`);const se=X==="investigation-summary"?1e3:500;await new Promise(ie=>setTimeout(ie,se));const ce=X==="investigation-summary"?`
${p}`:p;await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insertText",data:{text:ce,fieldType:X}}),console.log(`âœ… Text inserted to ${xn(X)} field after opening`)}else console.log("ðŸ“ Using generic EMR text insertion (no specific field mapping)"),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insertText",data:{text:p}}),console.log("ðŸ“ Text inserted to EMR (generic)")}catch(q){throw console.error("Failed to insert text to EMR:",q),q}},[n.currentAgent,n.ui.activeWorkflow]),_e=e.setModelStatus,U=d.useCallback(async()=>{console.log("ðŸ” checkModelStatus called - CALL STACK:",new Error().stack),console.time("â±ï¸ Total checkModelStatus Duration");try{const p=await u.checkConnection(),N=await f.checkServerStatus(!1,{timeout:5e3,retries:2}),E={...p,whisperServer:N};d.startTransition(()=>{_e(E)}),console.timeEnd("â±ï¸ Total checkModelStatus Duration")}catch(p){console.timeEnd("â±ï¸ Total checkModelStatus Duration"),d.startTransition(()=>{_e({isConnected:!1,classifierModel:"",processorModel:"",lastPing:Date.now(),latency:0,whisperServer:{running:!1,model:"whisper-large-v3-turbo",port:8001,lastChecked:Date.now(),error:p instanceof Error?p.message:"Status check failed"}})})}},[u,f,_e]);return d.useEffect(()=>{console.log("ðŸš€ Component mounted - performing initial model status check..."),U()},[U]),d.useEffect(()=>{const p=n.results&&n.processingStatus==="complete",N=n.streaming||n.currentSessionId!==null,E=!x.isRecording&&!n.isProcessing;p&&N&&E&&(console.warn('ðŸš¨ FIXING STUCK "ACTIVELY WORKING" STATE - clearing to restore record button access',{streaming:n.streaming,currentSessionId:n.currentSessionId,processingStatus:n.processingStatus,hasResults:!!n.results}),n.streaming&&(e.setStreaming(!1),e.clearStream()),n.currentSessionId!==null&&e.setCurrentSessionId(null))},[n.streaming,n.currentSessionId,n.results,n.processingStatus,x.isRecording,n.isProcessing,e]),d.useEffect(()=>{x.isRecording&&n.ui.activeWorkflow&&Vn(n.ui.activeWorkflow)?e.setRecordingPrompts(!0):x.isRecording||e.setRecordingPrompts(!1)},[x.isRecording,n.ui.activeWorkflow]),d.useEffect(()=>{let p,N;const E=async()=>{try{console.log("ðŸš€ Initializing critical agents for improved performance...");const{AgentFactory:O}=await ke(async()=>{const{AgentFactory:$}=await import("./chunks/AgentFactory.DJn3AVz8.js").then(X=>X.a);return{AgentFactory:$}},__vite__mapDeps([4,2,1,5,6,7,8]));await O.preloadCriticalAgents(),p=setTimeout(async()=>{try{console.log("ðŸ”„ Background preloading of common agents..."),await O.preloadCommonAgents(),console.log("âœ… Background agent preloading completed")}catch($){console.warn("âš ï¸ Background preloading failed:",$)}},5e3)}catch(O){console.warn("âš ï¸ Critical agent preloading failed:",O)}},q=()=>{N=setInterval(async()=>{try{const{AgentFactory:O}=await ke(async()=>{const{AgentFactory:X}=await import("./chunks/AgentFactory.DJn3AVz8.js").then(se=>se.a);return{AgentFactory:X}},__vite__mapDeps([4,2,1,5,6,7,8])),$=O.getMemoryEstimate();console.log(`ðŸ“Š Agent memory usage: ${$.totalAgents} agents (~${$.estimatedMemoryMB}MB)`),$.totalAgents>8&&(console.log("ðŸ§¹ Optimizing agent cache due to high memory usage..."),O.optimizeCache())}catch(O){console.warn("âš ï¸ Memory optimization failed:",O)}},6e5)};return E(),q(),()=>{p&&clearTimeout(p),N&&clearInterval(N)}},[]),t.jsxs("div",{className:"relative h-full max-h-full flex flex-col bg-surface-secondary overflow-hidden",children:[t.jsx("div",{className:"flex-shrink-0 bg-white  border-b border-gray-200",children:t.jsx(Ur,{status:x.isRecording?"recording":"idle",currentAgent:n.currentAgent||n.ui.activeWorkflow,isRecording:x.isRecording,modelStatus:n.modelStatus,onRefreshServices:U,onCompleteRecording:x.stopRecording,onCancelProcessing:G,onWorkflowSelect:Q,activeWorkflow:n.ui.activeWorkflow,voiceActivityLevel:n.voiceActivityLevel,recordingTime:x.recordingTime,isExtractingPatients:n.ui.isExtractingPatients,patientSessions:n.patientSessions,onRemoveSession:e.removePatientSession,onClearAllSessions:e.clearPatientSessions,onSessionSelect:A,onShowMetrics:()=>e.setMetricsDashboard(!0),onNewRecording:e.clearRecording,showNewRecording:n.results?.trim().length>0||n.patientSessions.some(p=>p.status==="completed")})}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",ref:m,id:"results-section",children:[x.isRecording&&t.jsxs("div",{className:"flex flex-col space-y-4 p-4",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Yr,{isRecording:x.isRecording,voiceActivityLevel:x.voiceActivityLevel,frequencyData:x.frequencyData,audioLevelHistory:x.audioLevelHistory,recordingTime:x.recordingTime,activeDeviceInfo:x.activeDeviceInfo,onStop:x.stopRecording,className:"min-h-0"})}),n.ui.activeWorkflow&&Vn(n.ui.activeWorkflow)&&t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Jr,{agentType:n.ui.activeWorkflow,isVisible:!0,compactMode:!0})})]}),!x.isRecording&&(n.processingStatus==="transcribing"||n.processingStatus==="processing")&&n.transcription&&!n.results&&!n.streaming&&t.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto p-6 space-y-4",children:t.jsxs("div",{className:"bg-white  rounded-lg border border-blue-200 p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx("div",{className:"w-2 h-2 bg-accent-violet rounded-full animate-pulse"}),t.jsx("h3",{className:"text-lg font-semibold text-blue-800",children:n.processingStatus==="transcribing"?"Transcribing Audio...":"Processing Report..."})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Transcription:"}),t.jsx("div",{className:"text-gray-800 text-sm leading-relaxed whitespace-pre-wrap max-h-64 overflow-y-auto",children:n.transcription})]}),n.processingStatus==="processing"&&t.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-sm text-blue-600",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsxs("span",{children:["Generating ",n.currentAgent," report..."]})]})]})}),n.reviewData&&t.jsx("div",{className:"flex-shrink-0 bg-white  border-b border-gray-200",children:t.jsx(Pr,{onQuickAction:async(p,N)=>{console.log("ðŸ”§ Quick action:",p,N)},processingAction:""})}),n.ui.showPatientEducationConfig&&t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:t.jsx(Vr,{isVisible:n.ui.showPatientEducationConfig,onClose:()=>e.setPatientEducationConfig(!1),isGenerating:n.isProcessing&&n.currentAgent==="patient-education",onGenerate:async p=>{try{e.setProcessing(!0),e.setCurrentAgent("patient-education"),e.setResults(""),e.setErrors([]);const{AgentFactory:N}=await ke(async()=>{const{AgentFactory:q}=await import("./chunks/AgentFactory.DJn3AVz8.js").then(O=>O.a);return{AgentFactory:q}},__vite__mapDeps([4,2,1,5,6,7,8]));console.log("ðŸŽ“ Processing Patient Education with input:",p);const E=await N.processWithAgent("patient-education",JSON.stringify(p));e.setResults(E.content),e.setPatientEducationConfig(!1),console.log("âœ… Patient Education generation completed")}catch(N){console.error("âŒ Patient Education generation failed:",N);const E=N instanceof Error?N.message:String(N);e.setErrors([`Patient Education generation failed: ${E}`])}finally{e.setProcessing(!1)}}})}),w&&!n.results&&!n.streaming&&!n.isProcessing&&t.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center p-8",children:t.jsxs("div",{className:"max-w-md text-center space-y-4",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-purple-50 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-purple-600 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Loading Session"}),t.jsx("p",{className:"text-gray-600",children:(()=>{const p=n.patientSessions.find(N=>N.id===w);return p?`Loading ${p.patient.name}'s ${p.agentType} session...`:"Loading session data..."})()})]})]})}),(w||n.streaming)&&(console.log("ðŸŽ¯ RESULTS PANEL RENDERING:",{selectedSessionId:w,streaming:n.streaming,hasResults:!!n.results,hasTranscription:!!n.transcription,resultsLength:n.results?.length||0,transcriptionLength:n.transcription?.length||0,shouldRender:!0}),!0)&&t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:(()=>{const p=_();return t.jsx(Ra,{results:p.results,resultsSummary:p.summary||"",warnings:n.ui.warnings,errors:n.ui.errors,agentType:p.agent,onCopy:J,onInsertToEMR:Be,originalTranscription:p.transcription,onTranscriptionCopy:J,onTranscriptionInsert:Be,onTranscriptionEdit:p.isDisplayingSession?void 0:Ne,transcriptionSaveStatus:H,onAgentReprocess:p.isDisplayingSession?void 0:te,approvalState:p.isDisplayingSession?{status:"approved",originalText:p.transcription,currentText:p.transcription,hasBeenEdited:!1}:n.transcriptionApproval,onTranscriptionApprove:p.isDisplayingSession?void 0:be,missingInfo:p.isDisplayingSession?null:n.missingInfo,onReprocessWithAnswers:p.isDisplayingSession?void 0:Y,onDismissMissingInfo:p.isDisplayingSession?void 0:()=>e.clearMissingInfo(),currentAgent:p.agent,isProcessing:p.isDisplayingSession?!1:n.isProcessing,audioBlob:p.isDisplayingSession?null:s.current,transcriptionTime:p.isDisplayingSession?null:n.transcriptionTime,agentProcessingTime:p.isDisplayingSession?null:n.agentProcessingTime,totalProcessingTime:p.isDisplayingSession?null:n.totalProcessingTime,processingStatus:p.processingStatus,currentAgentName:p.agentName,selectedSessionId:p.isDisplayingSession?p.displayPatientInfo?.name||"Unknown":w,selectedPatientName:p.patientInfo?.name||I,patientVersion:p.isDisplayingSession?null:n.patientVersion,isGeneratingPatientVersion:p.isDisplayingSession?!1:n.isGeneratingPatientVersion,onGeneratePatientVersion:p.isDisplayingSession?void 0:Te,streaming:p.isDisplayingSession?!1:!!n.streaming,streamBuffer:p.isDisplayingSession?"":n.streamBuffer||"",ttftMs:p.isDisplayingSession?null:n.ttftMs??null,onStopStreaming:p.isDisplayingSession?void 0:R})})()}),!x.isRecording&&!n.streaming&&!w&&!n.ui.showPatientEducationConfig&&t.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center p-8",children:t.jsxs("div",{className:"max-w-md text-center space-y-6",children:[t.jsx("div",{className:"w-20 h-20 mx-auto bg-blue-50 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Ready to Record"}),t.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Select a workflow below to start recording for your next patient. Recordings will process in the background, allowing you to continue with other patients."})]}),n.patientSessions.length>0&&t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Background Processing"})]}),t.jsxs("p",{className:"text-xs text-blue-800",children:[n.patientSessions.filter(p=>["transcribing","processing"].includes(p.status)).length," sessions processing, "," ",n.patientSessions.filter(p=>p.status==="completed").length," completed. Click the notification bell to view results."]})]})]})})]}),t.jsx("div",{className:"flex-shrink-0 bg-white  border-t border-gray-200 p-4",children:t.jsx(_a,{onQuickAction:async(p,N)=>{console.log("ðŸ”§ Quick action triggered:",p,N);try{if(p==="annotate-screenshots"){console.log("ðŸ“¸ Opening screenshot annotation modal"),e.setScreenshotAnnotationModal(!0);return}if(p==="patient-education"&&N?.type==="show-config"){console.log("ðŸŽ“ Showing Patient Education configuration card"),e.setPatientEducationConfig(!0);return}if(p==="bloods"&&N?.type==="prepare-modal"){console.log("ðŸ©¸ Preparing bloods modal for dictation..."),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods",data:{}}),console.log("âœ… Bloods modal opened for dictation");return}if(["investigation-summary","background","medications","social-history","bloods","bloods-insert","imaging","quick-letter","appointment-wrap-up","profile-photo","create-task"].includes(p)){const E={};n.results&&n.results.trim().length>0&&N?.type!=="manual"?(E.content=n.results,console.log("ðŸ”§ Sending content to EMR field:",p)):console.log("ðŸ”§ Opening EMR field for manual entry:",p),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:p,data:E}),console.log("âœ… Quick action completed:",p)}else if(p==="ai-medical-review")if(console.log("ðŸ¤– Processing AI Medical Review with data:",N),N?.formattedInput){e.setProcessing(!0),e.setCurrentAgent("ai-medical-review"),e.setResults(""),e.setErrors([]);try{const{AgentFactory:E}=await ke(async()=>{const{AgentFactory:O}=await import("./chunks/AgentFactory.DJn3AVz8.js").then($=>$.a);return{AgentFactory:O}},__vite__mapDeps([4,2,1,5,6,7,8]));console.log("ðŸ¤– Processing with BatchPatientReviewAgent...");const q=await E.processWithAgent("ai-medical-review",N.formattedInput);e.setResults(q.content),e.setMissingInfo(q.missingInfo||null),e.setProcessing(!1),console.log("âœ… AI Medical Review completed successfully")}catch(E){console.error("âŒ AI Medical Review processing failed:",E),e.setErrors([`AI Medical Review failed: ${E instanceof Error?E.message:"Unknown error"}`]),e.setProcessing(!1)}}else console.error("âŒ AI Medical Review: No formatted input provided"),e.setErrors(["AI Medical Review failed: No patient data available"]);else p==="batch-ai-review"&&N?.type==="show-modal"?(console.log("ðŸ‘¥ Batch AI Review: Triggering patient selection modal"),e.setPatientModal(!0)):console.log("â„¹ï¸ Unhandled quick action:",p)}catch(E){console.error("âŒ Quick action failed:",p,E),e.setErrors([`Failed to execute ${p}: ${E instanceof Error?E.message:"Unknown error"}`])}},onStartWorkflow:p=>Q(p),isFooter:!0})})]}),n.ui.showPatientSelectionModal&&t.jsx(Wr,{isOpen:n.ui.showPatientSelectionModal,onClose:()=>e.setPatientModal(!1),onStartReview:()=>{console.log("ðŸ”„ Starting patient review")},calendarData:n.ui.calendarData,isExtracting:n.ui.isExtractingPatients,extractError:n.ui.extractError}),n.ui.showScreenshotAnnotationModal&&t.jsx(Ys,{isOpen:n.ui.showScreenshotAnnotationModal,onClose:()=>e.setScreenshotAnnotationModal(!1)}),n.ui.showPatientMismatchModal&&t.jsx(Zs,{isOpen:n.ui.showPatientMismatchModal,comparison:n.patientMismatchData.comparison,textToInsert:n.patientMismatchData.textToInsert,onConfirm:n.patientMismatchData.onConfirm||(()=>{}),onCancel:n.patientMismatchData.onCancel||(()=>{}),onRefreshEMR:async()=>{try{console.log("ðŸ”„ Refreshing EMR patient data...");const p=await z();p?.name&&(e.setCurrentPatientInfo({...n.currentPatientInfo,...p}),console.log("âœ… EMR patient data refreshed:",p.name))}catch(p){console.error("âŒ Failed to refresh EMR patient data:",p)}}}),t.jsx(Gr,{isActive:n.ui.showFieldIngestionOverlay,onComplete:()=>e.setFieldIngestionOverlay(!1)}),n.ui.showProcessingPhase&&t.jsx("div",{className:"absolute top-4 left-4 right-4 z-40",children:t.jsx(Xr,{currentProgress:n.ui.processingProgress,isActive:n.ui.showProcessingPhase,startTime:n.ui.processingStartTime,agentType:n.currentAgent||void 0,transcriptionLength:n.transcription?n.transcription.length:void 0,showTimeEstimate:!0,onProcessingComplete:p=>{console.log(`â±ï¸ Processing completed in ${p}ms`)}})}),t.jsx(Kr,{isOpen:n.ui.showMetricsDashboard,onClose:()=>e.setMetricsDashboard(!1)}),t.jsx(zi,{isOpen:S,onClose:()=>C(!1)}),t.jsx(Hr,{})]})});ri.displayName="OptimizedAppContent";ii.displayName="OptimizedApp";const mo=()=>{const n=e=>{e.preventDefault()};window.addEventListener("dragover",n,{capture:!0}),window.addEventListener("drop",n,{capture:!0}),document.addEventListener("dragover",n,{capture:!0}),document.addEventListener("drop",n,{capture:!0}),document.documentElement?.addEventListener?.("dragover",n,{capture:!0}),document.documentElement?.addEventListener?.("drop",n,{capture:!0}),document.body?.addEventListener?.("dragover",n,{capture:!0}),document.body?.addEventListener?.("drop",n,{capture:!0})};mo();class po extends oe.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,a){console.error("React Error Boundary caught an error:",e,a)}render(){return this.state.hasError?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-500 to-red-700 p-4 flex items-center justify-center",children:t.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md text-center",children:[t.jsx("h1",{className:"text-white text-xl font-bold mb-4",children:"Extension Error"}),t.jsx("p",{className:"text-white/80 mb-4",children:"The Operator Chrome Extension encountered an error."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors",children:"Reload Extension"}),this.state.error&&t.jsxs("details",{className:"mt-4 text-left",children:[t.jsx("summary",{className:"text-white/60 cursor-pointer text-sm",children:"Error Details"}),t.jsx("pre",{className:"text-xs text-white/50 mt-2 p-2 bg-black/20 rounded",children:this.state.error.message})]})]})}):this.props.children}}window.addEventListener("error",n=>{console.error("Global error in sidepanel:",n.error)});window.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection in sidepanel:",n.reason)});function oa(){console.log("ðŸ¥ Initializing Operator Chrome Extension...",new Date().toISOString()),console.log("ðŸ”§ Extension context check:",typeof chrome<"u"&&chrome.runtime);const n=document.getElementById("root");if(!n){console.error("âŒ Root element not found!"),document.body.innerHTML=`
      <div style="padding: 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px);">
          <h1 style="color: white; margin-bottom: 1rem;">Mount Error</h1>
          <p style="color: rgba(255,255,255,0.8);">Could not find root element</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `;return}typeof chrome>"u"||!chrome.runtime?console.warn("âš ï¸ Chrome extension APIs not available"):console.log("âœ… Chrome extension context detected");try{Fi(n).render(t.jsx(oe.StrictMode,{children:t.jsx(po,{children:t.jsx(ii,{})})})),console.log("âœ… React app rendered successfully")}catch(e){console.error("âŒ Failed to render React app:",e),n.innerHTML=`
      <div style="padding: 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px);">
          <h1 style="color: white; margin-bottom: 1rem;">Render Error</h1>
          <p style="color: rgba(255,255,255,0.8);">${e instanceof Error?e.message:"Unknown error"}</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `}}document.readyState==="loading"?(console.log("â³ Waiting for DOM to load..."),document.addEventListener("DOMContentLoaded",oa)):(console.log("âœ… DOM already loaded, initializing immediately"),oa());typeof window<"u"&&(window.operatorDebug={version:"1.0.0",timestamp:new Date().toISOString(),userAgent:navigator.userAgent,chromeAvailable:typeof chrome<"u",extensionId:chrome?.runtime?.id||"unknown"},console.log("ðŸ”§ Debug info:",window.operatorDebug));export{er as b,tt as c,ja as m};
