const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/AIReasoningModal.dU8SjUqO.js","chunks/vendor-ui.DYQsYz3N.js","chunks/vendor.DxVDkWSy.js","chunks/modulepreload-polyfill.B5Qt9EMX.js","chunks/vendor-3d.ClRTze-x.js","chunks/NotificationService.BHT_lCcU.js","assets/NotificationService.css","chunks/agents.w_LsrkjM.js","chunks/services.BERoZOqc.js","chunks/RHCCalculationService.CRg564lP.js","chunks/settings-components.Ckr4M-Fi.js","chunks/AudioProcessingQueueService.BquiCdnl.js","chunks/PatientEducationAgent.gMUdXJ8T.js","chunks/PatientEducationSystemPrompts.BAqgRc_b.js","chunks/BatchPatientReviewAgent.Dj2BLS7n.js","chunks/BatchPatientReviewSystemPrompts.Cro_9UlO.js","chunks/InvestigationSummarySystemPrompts.i3uNOkks.js","chunks/MedicationSystemPrompts.--toCo-_.js","chunks/AgentFactory.LTvMbl2o.js"])))=>i.map(i=>d[i]);
import"./chunks/modulepreload-polyfill.B5Qt9EMX.js";import{j as t,t as Vr,H as Rt,y as qr,Z as Gr,n as Kt,_ as Wr,p as Dt,a4 as Wu,e as zo,l as Qc,V as zu,D as jr,R as Jt,k as Xu,P as zs,a5 as qu,B as Xo,a6 as Yu,s as se,F as Et,g as yt,a3 as Pn,a7 as Ks,a8 as ds,a2 as Ao,d as gr,a9 as is,A as ot,aa as Ju,I as Vt,ab as Zu,ac as Ic,ad as em,T as Er,L as Uc,r as Le,h as Dn,m as Zt,X as nt,ae as er,af as $a,ag as jn,ah as tm,ai as rm,aj as qo,ak as _n,al as sm,q as os,f as Ka,J as As,N as yA,a as vA,E as nm,am as Yo,an as am,ao as im,ap as om,U as Ai,aq as Am,ar as lm,as as cm,C as _s,at as dm,au as Tc,av as um,aw as mm,ax as kc,ay as Va,az as Pc,K as Dc,aA as pm,aB as gm,aC as hm,aD as wA,aE as fm,aF as Vs,aG as Rc,aH as Rn,i as xm,w as lo,aI as bm,o as Mc,W as ym,aJ as vm,aK as Sn,aL as wm,x as Bm,v as Cm,aM as BA,aN as Nm,c as li,aO as jm,Y as Sm,O as Em,aP as Fm}from"./chunks/vendor-ui.DYQsYz3N.js";import{r as u,R as Fe,a as Qm}from"./chunks/vendor.DxVDkWSy.js";import{_ as $e,c as ci,P as He,e as Im,u as Hc,a as Lc,C as Um,b as Tm,E as km,L as Jn,d as Pm,V as Ar,R as Dm,f as Rm,g as Si,h as Mm,i as Hm,j as rn,B as Ei,k as Lm,M as Om,l as _m}from"./chunks/vendor-3d.ClRTze-x.js";import{M as En,N as Oc,Q as $m}from"./chunks/NotificationService.BHT_lCcU.js";import{l as oe,t as Zn,i as Km,O as Vm}from"./chunks/agents.w_LsrkjM.js";import{g as Gm,h as Wm,i as zm,j as Xm,k as qm,l as Ym,e as Jm,d as Zm,p as ep,q as tp,s as rp,n as sp,o as np,u as ap,t as ip}from"./chunks/RHCCalculationService.CRg564lP.js";import{L as Jo,W as op,s as Ap,i as lp,M as sn}from"./chunks/services.BERoZOqc.js";import{A as CA,b as cp}from"./chunks/settings-components.Ckr4M-Fi.js";const _c=u.createContext(void 0),dp=({children:r})=>{const[e,s]=u.useState(null),[n,a]=u.useState(null),[i,o]=u.useState("auto"),[A,l]=u.useState("auto"),c=(m,g=!1)=>{if(s(m),o(g?"manual":"auto"),g&&m)try{localStorage.setItem("xestro-preferred-microphone",m)}catch(h){console.warn("Failed to persist microphone preference:",h)}},d=(m,g=!1)=>{if(a(m),l(g?"manual":"auto"),g&&m)try{localStorage.setItem("xestro-preferred-speaker",m)}catch(h){console.warn("Failed to persist speaker preference:",h)}};return t.jsx(_c.Provider,{value:{selectedMicrophoneId:e,selectedSpeakerId:n,microphoneSelectionType:i,speakerSelectionType:A,setSelectedMicrophoneId:c,setSelectedSpeakerId:d},children:r})},$c=()=>{const r=u.useContext(_c);if(r===void 0)throw new Error("useAudioDeviceContext must be used within an AudioDeviceProvider");return r},di=({className:r,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:t.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),Pt=({className:r,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[t.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t.jsx("polyline",{points:"14,2 14,8 20,8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),t.jsx("polyline",{points:"10,9 9,9 8,9"})]}),Fn=({className:r,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:t.jsx("polyline",{points:"22,12 18,12 15,21 9,3 6,12 2,12"})}),ft=({className:r,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:t.jsx("polyline",{points:"20,6 9,17 4,12"})}),Fr=({className:r,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),Ns=({className:r,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:t.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"})}),up=({className:r,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[t.jsx("polygon",{points:"11,5 6,9 2,9 2,15 6,15 11,19"}),t.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"})]}),co=({className:r,size:e=20})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[t.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),uo=({className:r,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:t.jsx("polyline",{points:"6,9 12,15 18,9"})}),mo=({className:r,size:e=20})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:t.jsx("polyline",{points:"18,15 12,9 6,15"})});function mp(r){if(r==null||r<0)return"0s";r>864e5&&(console.warn(`formatElapsedTime: Suspiciously large value ${r}ms, clamping to 24h`),r=864e5);const e=Math.floor(r/1e3);if(e<60)return`${e}s`;const s=Math.floor(e/60),n=e%60;if(s<60)return n===0?`${s}m`:`${s}m ${n.toString().padStart(2,"0")}s`;const a=Math.floor(s/60),i=s%60;return i===0?`${a}h`:`${a}h ${i}m`}function po(r){if(r==null||r<=0)return"‚Äî";try{const e=new Date(r);return isNaN(e.getTime())?"‚Äî":e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return console.warn("formatAbsoluteTime: Invalid timestamp",r),"‚Äî"}}function Kc(r){if(!r||typeof r!="string")return 0;const e=r.trim();return e.length===0?0:e.split(/\s+/).filter(n=>n.length>0).length}function Vc(r,e=80){return r<e?null:Math.ceil(r/200)}function Gc(r){return r==null?"":`${r} min read`}const xt={immediate:.15,quick:.2,normal:.3},tr={sharp:[.4,0,.6,1],gentle:[.25,.46,.45,.94],professional:[.4,0,.2,1]},Zo={gentle:{type:"spring",damping:25,stiffness:300,mass:1},responsive:{type:"spring",damping:30,stiffness:400,mass:.8}},Qr=(r,e=tr.professional)=>({duration:r,ease:e,type:"tween"}),Wc=(r=Zo.gentle)=>r,Ga={tight:.03,normal:.05},Rr={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:Qr(xt.quick,tr.gentle)},exit:{opacity:0,y:-10,scale:.98,transition:Qr(xt.immediate,tr.sharp)}},pp={idle:{scale:1,y:0},hover:{scale:1.02,y:-1,transition:Wc(Zo.responsive)},tap:{scale:.98,y:0,transition:Qr(xt.immediate,tr.sharp)},success:{scale:[1,1.05,1],transition:{duration:.6,times:[0,.3,1],ease:tr.gentle}}},go={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:Ga.normal,delayChildren:.1,when:"beforeChildren"}},exit:{opacity:0,transition:{staggerChildren:Ga.tight,staggerDirection:-1,when:"afterChildren"}}},zc={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:Wc(Zo.gentle)},exit:{opacity:0,scale:.95,y:10,transition:Qr(xt.quick,tr.sharp)}},Xc={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(4px)",transition:Qr(xt.normal,tr.gentle)},exit:{opacity:0,backdropFilter:"blur(0px)",transition:Qr(xt.quick,tr.sharp)}},Wa={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:Qr(xt.quick,tr.gentle)}},Ra={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:Qr(xt.quick,tr.gentle)},exit:{opacity:0,x:20,transition:Qr(xt.immediate,tr.sharp)}},Ke=r=>{if(!gp())return r;const s={};return Object.keys(r).forEach(n=>{const a=r[n];typeof a=="object"&&a!==null?s[n]={...a,transition:{duration:.01}}:s[n]=a}),s},gp=()=>typeof window>"u"?!1:window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,Hr=({className:r="w-4 h-4",title:e})=>{const[s,n]=u.useState(!1),a=()=>{n(!0),setTimeout(()=>n(!1),300)};return t.jsx("span",{onMouseEnter:a,onFocus:a,className:"relative inline-flex items-center justify-center group","aria-hidden":e?void 0:!0,title:e,children:t.jsx(Vr,{className:`${r} transition-transform duration-300 ${s?"animate-bounce":"group-hover:scale-110"}`})})};class hr{static instance;metrics=[];maxMetricsHistory=100;constructor(){}static getInstance(){return hr.instance||(hr.instance=new hr),hr.instance}recordMetrics(e,s,n){try{const a={timestamp:Date.now(),processingPhase:e,duration:Math.max(0,s||0),memoryUsage:this.getMemoryInfo(),systemLoad:this.getSystemLoad(),...n};this.metrics.push(a),this.metrics.length>this.maxMetricsHistory&&(this.metrics=this.metrics.slice(-this.maxMetricsHistory)),console.log(`üìä Performance: ${e} completed in ${s}ms`,{phase:e,duration:s,agentType:n?.agentType,audioSize:n?.audioSize?Math.round(n.audioSize/1024)+"KB":void 0,memoryUsage:a.memoryUsage?.estimatedMemoryMB?a.memoryUsage.estimatedMemoryMB+"MB":"N/A"}),this.detectPerformanceIssues(a)}catch(a){console.warn("‚ö†Ô∏è Failed to record performance metrics:",a)}}getMemoryInfo(){let e={totalAgents:0,estimatedMemoryMB:0};try{if(typeof window<"u"&&window.AgentFactory){const n=window.AgentFactory.getMemoryEstimate();n&&typeof n=="object"&&(e={totalAgents:Math.max(0,n.totalAgents||0),estimatedMemoryMB:Math.max(0,n.estimatedMemoryMB||0)})}}catch{}let s={jsHeapSizeLimit:0,jsHeapTotalSize:0,jsHeapUsedSize:0};try{if(typeof window<"u"&&window.performance&&"memory"in window.performance&&window.performance.memory){const n=window.performance.memory;s={jsHeapSizeLimit:Math.max(0,n.jsHeapSizeLimit||0),jsHeapTotalSize:Math.max(0,n.totalJSHeapSize||0),jsHeapUsedSize:Math.max(0,n.usedJSHeapSize||0)}}}catch{}return{...e,...s}}getSystemLoad(){try{const e=this.metrics.slice(-5).filter(A=>A&&typeof A.duration=="number"&&A.duration>=0);if(e.length===0)return{};const n=e.reduce((A,l)=>A+(l.duration||0),0)/e.length,a={transcription:2e3,"agent-loading":500,"agent-processing":5e3,complete:0};let i=0;e.forEach(A=>{const l=a[A.processingPhase]||1e3;if(l>0){const c=(A.duration||0)/l;i+=Math.min(Math.max(c,0),3)}});const o=e.length>0?i/e.length*100:0;return{cpuUsage:Math.min(Math.max(o,0),100),isMainThreadBlocked:n>1e4,frameDrops:o>200?Math.max(0,Math.floor(o/50)):0}}catch(e){return console.warn("‚ö†Ô∏è Failed to calculate system load:",e),{}}}detectPerformanceIssues(e){try{if(!e||typeof e.duration!="number")return;const s=[],n=Math.max(0,e.duration);if(e.processingPhase==="transcription"&&n>1e4&&s.push(`Slow transcription (${n}ms) - check MLX Whisper server`),e.processingPhase==="agent-processing"&&n>3e4){const a=e.agentType||"unknown";s.push(`Slow processing (${n}ms) - agent: ${a}`)}if(e.memoryUsage&&typeof e.memoryUsage.jsHeapUsedSize=="number"&&e.memoryUsage.jsHeapUsedSize>100*1024*1024){const a=Math.round(e.memoryUsage.jsHeapUsedSize/1024/1024);s.push(`High memory usage (${a}MB)`)}e.memoryUsage&&typeof e.memoryUsage.totalAgents=="number"&&e.memoryUsage.totalAgents>8&&s.push(`Too many agents loaded (${e.memoryUsage.totalAgents}) - consider cache optimization`),s.length>0&&console.warn("‚ö†Ô∏è Performance issues detected:",s)}catch(s){console.warn("‚ö†Ô∏è Failed to detect performance issues:",s)}}getPerformanceSummary(){if(this.metrics.length===0)return{totalSessions:0,averageTranscriptionTime:0,averageProcessingTime:0,averageCompressionRatio:0,memoryTrend:"stable",recommendedOptimizations:["Start using the extension to collect performance data"]};const e=this.metrics.filter(c=>c.processingPhase==="transcription"),s=this.metrics.filter(c=>c.processingPhase==="agent-processing"),n=this.metrics.filter(c=>c.compressionRatio!==void 0),a=e.length>0?e.reduce((c,d)=>c+d.duration,0)/e.length:0,i=s.length>0?s.reduce((c,d)=>c+d.duration,0)/s.length:0,o=n.length>0?n.reduce((c,d)=>c+(d.compressionRatio||0),0)/n.length:0,A=this.analyzeMemoryTrend(),l=this.generateOptimizationRecommendations(a,i,o,A);return{totalSessions:Math.floor(this.metrics.filter(c=>c.processingPhase==="complete").length),averageTranscriptionTime:Math.round(a),averageProcessingTime:Math.round(i),averageCompressionRatio:Math.round(o*10)/10,memoryTrend:A,recommendedOptimizations:l}}analyzeMemoryTrend(){try{const e=this.metrics.slice(-20).filter(d=>d&&d.memoryUsage&&typeof d.memoryUsage.jsHeapUsedSize=="number");if(e.length<5)return"stable";const s=Math.floor(e.length/2),n=e.slice(0,s),a=e.slice(s);if(n.length===0||a.length===0)return"stable";const i=n.reduce((d,m)=>d+(m.memoryUsage?.jsHeapUsedSize||0),0),o=a.reduce((d,m)=>d+(m.memoryUsage?.jsHeapUsedSize||0),0),A=i/n.length,l=o/a.length;if(A===0)return"stable";const c=(l-A)/A*100;return c>10?"increasing":c<-10?"decreasing":"stable"}catch(e){return console.warn("‚ö†Ô∏è Failed to analyze memory trend:",e),"stable"}}generateOptimizationRecommendations(e,s,n,a){const i=[];return e>8e3&&(i.push("Transcription is slow - check MLX Whisper server performance"),i.push("Consider restarting the Whisper server: ./start-whisper-server.sh")),s>2e4&&i.push("Agent processing is slow - consider using lighter models for simple tasks"),n<20&&i.push("Low compression ratio - audio files may benefit from better compression"),a==="increasing"&&(i.push("Memory usage is increasing - enable automatic cache optimization"),i.push("Consider restarting the extension periodically for long sessions")),i.length===0&&(i.push("Performance is optimal - no specific optimizations needed"),i.push("Continue using agent preloading for best performance")),i}clearMetrics(){this.metrics=[],console.log("üßπ Performance metrics cleared")}exportMetrics(){return[...this.metrics]}getRecentIssues(e=5){const s=Date.now()-e*60*1e3,n=this.metrics.filter(i=>i.timestamp>s),a=[];return n.forEach(i=>{i.processingPhase==="transcription"&&i.duration>1e4&&a.push(`Slow transcription: ${i.duration}ms`),i.processingPhase==="agent-processing"&&i.duration>3e4&&a.push(`Slow ${i.agentType} processing: ${i.duration}ms`)}),[...new Set(a)]}}class Nr{static instance;historicalData=[];maxHistorySize=200;performanceService;agentProfiles={"investigation-summary":{baselineMs:1500,lengthScalingFactor:.8,modelComplexity:"lightweight",expectedRange:{min:1e3,max:3e3}},medication:{baselineMs:1800,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3500}},background:{baselineMs:2e3,lengthScalingFactor:1,modelComplexity:"lightweight",expectedRange:{min:1500,max:4e3}},bloods:{baselineMs:1600,lengthScalingFactor:.85,modelComplexity:"lightweight",expectedRange:{min:1100,max:3200}},imaging:{baselineMs:1700,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3400}},"ohif-viewer":{baselineMs:2400,lengthScalingFactor:.8,modelComplexity:"lightweight",expectedRange:{min:1500,max:5e3}},"quick-letter":{baselineMs:4e3,lengthScalingFactor:1.2,modelComplexity:"standard",expectedRange:{min:2500,max:8e3}},"pre-op-plan":{baselineMs:4500,lengthScalingFactor:1.1,modelComplexity:"standard",expectedRange:{min:3e3,max:9e3}},consultation:{baselineMs:5e3,lengthScalingFactor:1.4,modelComplexity:"standard",expectedRange:{min:3e3,max:12e3}},tavi:{baselineMs:6e3,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},"angiogram-pci":{baselineMs:6500,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},mteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},tteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},"pfo-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"asd-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"right-heart-cath":{baselineMs:5800,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:3800,max:13e3}},"pvl-plug":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"bypass-graft":{baselineMs:7e3,lengthScalingFactor:2,modelComplexity:"heavy",expectedRange:{min:4500,max:18e3}},"tavi-workup":{baselineMs:6500,lengthScalingFactor:1.9,modelComplexity:"heavy",expectedRange:{min:4e3,max:16e3}},"ai-medical-review":{baselineMs:8e3,lengthScalingFactor:2.2,modelComplexity:"heavy",expectedRange:{min:5e3,max:2e4}},"batch-ai-review":{baselineMs:15e3,lengthScalingFactor:3,modelComplexity:"heavy",expectedRange:{min:1e4,max:45e3}},"aus-medical-review":{baselineMs:5200,lengthScalingFactor:1.6,modelComplexity:"standard",expectedRange:{min:3200,max:12e3}},"patient-education":{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:3e3,max:1e4}},enhancement:{baselineMs:3e3,lengthScalingFactor:1.1,modelComplexity:"standard",expectedRange:{min:2e3,max:6e3}},transcription:{baselineMs:2e3,lengthScalingFactor:.5,modelComplexity:"lightweight",expectedRange:{min:1e3,max:4e3}},generation:{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:2500,max:9e3}}};constructor(){this.performanceService=hr.getInstance(),this.loadHistoricalData()}static getInstance(){return Nr.instance||(Nr.instance=new Nr),Nr.instance}predictProcessingTime(e,s,n){const a=this.agentProfiles[e];if(!a)throw new Error(`Unknown agent type: ${e}`);const i=this.historicalData.filter(j=>j.agentType===e),o=this.categorizeTranscriptionLength(s),A=a.baselineMs,l=n?.audioDuration?this.calculateAudioDurationFactor(n.audioDuration,a.lengthScalingFactor):this.calculateLengthFactor(s,a.lengthScalingFactor),c=this.calculateHistoricalAdjustment(e,s,n?.audioDuration,i),d=this.calculateSystemPerformanceFactor(n?.systemPerformance),m=A*l*c*d,g=Math.max(a.expectedRange.min,Math.min(a.expectedRange.max,m)),h=n?.includeTranscriptionTime?g+this.estimateTranscriptionTime(s):g,p=this.calculateConfidenceLevel(i.length,o),b=p==="high"?.2:p==="medium"?.4:.6,N={min:Math.round(h*(1-b)),max:Math.round(h*(1+b))},y=[{name:"Agent baseline",impact:A,description:`${a.modelComplexity} model baseline`,type:"additive"},{name:"Transcription length",impact:l,description:`${o.category} transcription (${s} chars)`,type:"multiplier"}];return c!==1&&y.push({name:"Historical performance",impact:c,description:`Based on ${i.length} similar sessions`,type:"multiplier"}),d!==1&&y.push({name:"System performance",impact:d,description:n?.systemPerformance?`Current system load: ${n.systemPerformance}%`:"System performance adjustment",type:"multiplier"}),{estimatedDurationMs:Math.round(h),confidenceLevel:p,factors:y,range:N,basedOnSessions:i.length,displayText:this.formatEstimateForDisplay(N,p,i.length)}}categorizeTranscriptionLength(e){return e<300?{category:"short",range:{min:0,max:300},description:"Short dictation (< 300 characters)"}:e<800?{category:"medium",range:{min:300,max:800},description:"Medium dictation (300-800 characters)"}:e<1500?{category:"long",range:{min:800,max:1500},description:"Long dictation (800-1500 characters)"}:{category:"very-long",range:{min:1500,max:1/0},description:"Very long dictation (> 1500 characters)"}}calculateLengthFactor(e,s){const a=e/500;return 1+Math.log(a+1)*s*.3}calculateAudioDurationFactor(e,s){const a=e/45;return 1+Math.log(a+1)*s*.5}calculateHistoricalAdjustment(e,s,n,a){if(a.length<3)return 1;let i;if(n!==void 0){const o={min:n*.5,max:n*1.5};i=a.filter(A=>A.audioDuration!==void 0&&A.audioDuration>=o.min&&A.audioDuration<=o.max)}else{const o={min:s*.5,max:s*1.5};i=a.filter(A=>A.transcriptionLength>=o.min&&A.transcriptionLength<=o.max)}return i.length<2?this.calculateAveragePerformanceRatio(a,e):this.calculateAveragePerformanceRatio(i,e)}calculateAveragePerformanceRatio(e,s){const n=this.agentProfiles[s],a=e.map(o=>{const A=n.baselineMs*this.calculateLengthFactor(o.transcriptionLength,n.lengthScalingFactor);return o.actualProcessingTime/A}),i=a.reduce((o,A)=>o+A,0)/a.length;return Math.max(.5,Math.min(2,i))}calculateSystemPerformanceFactor(e){return e?2-Math.max(0,Math.min(100,e))/100*1.2:(this.performanceService.getPerformanceSummary(),this.performanceService.getRecentIssues(2).length>0?1.3:1)}estimateTranscriptionTime(e){return 1500+Math.log(e/100+1)*200}calculateConfidenceLevel(e,s){return e>=20?"high":e>=8?"medium":"low"}formatEstimateForDisplay(e,s,n){const a=this.formatDuration(e.min),i=this.formatDuration(e.max),o=s==="high"?"High confidence":s==="medium"?"Medium confidence":"Low confidence";return n>0?`Expected: ${a}-${i} (${o}, ${n} sessions)`:`Expected: ${a}-${i} (${o})`}formatDuration(e){if(e<1e3)return`${Math.round(e)}ms`;const s=e/1e3;return s<10?`${s.toFixed(1)}s`:`${Math.round(s)}s`}recordActualProcessingTime(e,s,n,a,i){const o={agentType:e,transcriptionLength:s,audioDuration:a,actualProcessingTime:n,timestamp:Date.now(),systemPerformance:i};this.historicalData.push(o),this.historicalData.length>this.maxHistorySize&&(this.historicalData=this.historicalData.slice(-this.maxHistorySize)),this.saveHistoricalData(),oe.info(`Recorded processing time for ${e}`,{component:"processing-predictor",operation:"record-time",agentType:e,transcriptionLength:s,audioDuration:a,processingTime:n})}updatePredictionAccuracy(e,s){const n=s>=e.range.min&&s<=e.range.max,a=1-Math.abs(e.estimatedDurationMs-s)/e.estimatedDurationMs;return oe.info(`Prediction accuracy: ${Math.round(a*100)}%, within range: ${n}`,{component:"processing-predictor",operation:"accuracy-check",accuracy:Math.round(a*100),withinRange:n}),{accuracy:Math.max(0,a),wasWithinRange:n}}getAgentPerformanceStats(e){const s=this.historicalData.filter(i=>i.agentType===e);if(s.length===0)return{averageTime:this.agentProfiles[e]?.baselineMs||5e3,sessionCount:0,accuracyTrend:"stable"};const n=s.reduce((i,o)=>i+o.actualProcessingTime,0)/s.length,a=this.analyzeTrend(s);return{averageTime:Math.round(n),sessionCount:s.length,accuracyTrend:a}}analyzeTrend(e){if(e.length<6)return"stable";const s=Math.floor(e.length/2),n=e.slice(0,s),a=e.slice(s),i=n.reduce((l,c)=>l+c.actualProcessingTime,0)/n.length,A=(a.reduce((l,c)=>l+c.actualProcessingTime,0)/a.length-i)/i*100;return A<-10?"improving":A>10?"declining":"stable"}async loadHistoricalData(){try{const e=await chrome.storage.local.get("processingTimeHistory");e.processingTimeHistory&&(this.historicalData=e.processingTimeHistory.slice(-this.maxHistorySize),oe.info(`Loaded ${this.historicalData.length} historical processing time data points`,{component:"processing-predictor",operation:"load-data",dataPoints:this.historicalData.length}))}catch(e){oe.warn("Failed to load historical processing time data",{component:"processing-predictor",operation:"load-data",error:e instanceof Error?e.message:String(e)})}}async saveHistoricalData(){try{await chrome.storage.local.set({processingTimeHistory:this.historicalData})}catch(e){oe.warn("Failed to save historical processing time data",{component:"processing-predictor",operation:"save-data",error:e instanceof Error?e.message:String(e)})}}clearHistoricalData(){this.historicalData=[],chrome.storage.local.remove("processingTimeHistory"),oe.info("Cleared historical processing time data",{component:"processing-predictor",operation:"clear-data"})}exportHistoricalData(){return[...this.historicalData]}}const hp=r=>{if(!r)return"MedGemma-27B MLX";const e={"medgemma-27b-text-it-mlx":"MedGemma-27B MLX","qwen/qwen3-4b-2507":"Qwen 3-4B","qwen3-4b":"Qwen 3-4B","gemma-3n-e4b":"Gemma 3N-E4B"};if(e[r])return e[r];const s=r.toLowerCase();for(const[n,a]of Object.entries(e))if(s.includes(n.toLowerCase())||n.toLowerCase().includes(s))return a;return r},ea={"quick-letter":{min:3e4,max:6e4,complexity:"low"},consultation:{min:12e4,max:24e4,complexity:"medium"},"investigation-summary":{min:1e4,max:3e4,complexity:"low"},tavi:{min:48e4,max:72e4,complexity:"high"},mteer:{min:42e4,max:6e5,complexity:"high"},"pfo-closure":{min:3e5,max:48e4,complexity:"medium"},"right-heart-cath":{min:36e4,max:6e5,complexity:"medium"},"angiogram-pci":{min:48e4,max:9e5,complexity:"high"},"ai-medical-review":{min:18e4,max:24e4,complexity:"medium"}},fp=({appState:r,isRecording:e=!1,recordingTime:s=0,transcriptionLength:n,modelUsed:a=null})=>{const[i,o]=u.useState(0),[A,l]=u.useState(null),[c]=u.useState(()=>Nr.getInstance());u.useEffect(()=>{let h;return(r.processingStatus==="transcribing"||r.processingStatus==="processing")&&(h=window.setInterval(()=>{r.processingStartTime&&o(Date.now()-r.processingStartTime)},100)),()=>{h&&clearInterval(h)}},[r.processingStatus,r.processingStartTime]),u.useEffect(()=>{try{if(r.currentAgent&&typeof n=="number"&&n>0){const h=c.predictProcessingTime(r.currentAgent,n,{includeTranscriptionTime:!0});l(h)}else l(null)}catch(h){console.warn("Failed to predict processing time:",h),l(null)}},[r.currentAgent,n,c]);const d=h=>{if(h===null)return"0s";const p=Math.floor(h/1e3);if(p<60)return`${(h/1e3).toFixed(1)}s`;{const b=Math.floor(p/60),N=p%60;return`${b}m ${N}s`}},m=h=>{if(h===null)return"0s";const p=Math.floor(h/1e3);if(p<60)return`${p}s`;{const b=Math.floor(p/60),N=p%60;return`${b}m ${N.toString().padStart(2,"0")}s`}},g=(h,p)=>{if(A)return h<A.range.min?{icon:"üü¢",color:"text-green-600",label:"Fast"}:h<=A.range.max?{icon:"üü°",color:"text-yellow-600",label:"Normal"}:{icon:"üî¥",color:"text-red-600",label:"Slow"};if(!p||!ea[p])return{icon:"üü°",color:"text-yellow-600",label:"Normal"};const b=ea[p];return h<b.min?{icon:"üü¢",color:"text-green-600",label:"Fast"}:h<=b.max?{icon:"üü°",color:"text-yellow-600",label:"Normal"}:{icon:"üî¥",color:"text-red-600",label:"Slow"}};if(e&&s>0)return t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Rt,{className:"h-4 w-4 text-red-600 animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-red-800",children:"Recording..."}),t.jsxs("span",{className:"text-sm text-red-600 font-mono",children:["(",m(s)," elapsed)"]})]})});if(r.processingStatus==="transcribing")return t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(qr,{className:"h-4 w-4 text-blue-600 animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Transcribing..."}),t.jsxs("span",{className:"text-sm text-blue-600 font-mono",children:["(",m(i)," elapsed)"]})]})});if(r.processingStatus==="processing")return t.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gr,{className:"h-4 w-4 text-purple-600 animate-pulse"}),t.jsxs("span",{className:"text-sm font-medium text-purple-800",children:[r.currentAgentName||"Agent"," Processing..."]}),t.jsxs("span",{className:"text-sm text-purple-600 font-mono",children:["(",m(i)," elapsed)"]})]})});if(r.processingStatus==="complete"&&r.totalProcessingTime){const h=g(r.totalProcessingTime,r.currentAgent),p=r.recordingTime?Math.round(r.recordingTime/r.totalProcessingTime*100):0,b=r.transcriptionTime?Math.round(r.transcriptionTime/r.totalProcessingTime*100):0,N=r.agentProcessingTime?Math.round(r.agentProcessingTime/r.totalProcessingTime*100):0;return t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Kt,{className:"h-4 w-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-800",children:"Processing Complete"}),t.jsxs("span",{className:`text-xs ${h.color}`,children:[h.icon," ",h.label]})]}),t.jsx("span",{className:"text-sm font-semibold text-green-800",children:d(r.totalProcessingTime)})]}),t.jsxs("div",{className:"space-y-2",children:[r.recordingTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),t.jsx("span",{className:"text-gray-700",children:"Recording (Voice Input)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-red-400 h-1.5 rounded-full",style:{width:`${p}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:d(r.recordingTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[p,"%"]})]})]}),r.transcriptionTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),t.jsx("span",{className:"text-gray-700",children:"Transcription (MLX Whisper)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-blue-400 h-1.5 rounded-full",style:{width:`${b}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:d(r.transcriptionTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[b,"%"]})]})]}),r.agentProcessingTime&&t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),t.jsxs("span",{className:"text-gray-700",children:[r.currentAgentName||"Agent"," (",hp(a),")"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-purple-400 h-1.5 rounded-full",style:{width:`${N}%`}})}),t.jsx("span",{className:"w-12 text-right font-medium",children:d(r.agentProcessingTime)}),t.jsxs("span",{className:"w-8 text-right text-gray-500",children:[N,"%"]})]})]})]}),(()=>{if(A)return t.jsx("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:A.displayText});if(r.currentAgent&&ea[r.currentAgent]){const y=ea[r.currentAgent];return t.jsxs("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:["Expected: ",d(y.min)," - ",d(y.max)," (",y.complexity," complexity)"]})}return null})()]})})}return null},qc=({audioBlob:r,fileName:e="investigation-audio",className:s="",onAnalysisUpdate:n,showQualityBar:a=!0,defaultExpanded:i=!1})=>{const[o,A]=u.useState(!1),[l,c]=u.useState(0),[d,m]=u.useState(0),[g,h]=u.useState(1),[p,b]=u.useState(1),[N,y]=u.useState([]),[j,Q]=u.useState(""),[v,x]=u.useState(null),[f,S]=u.useState(!1),[F,w]=u.useState(!1),[T,C]=u.useState(i),E=u.useRef(null),U=u.useRef(null),k=u.useRef(),P=u.useRef();u.useEffect(()=>{const re=URL.createObjectURL(r);return Q(re),()=>{URL.revokeObjectURL(re)}},[r]);const M=u.useCallback(async()=>{if(r)try{const re=await r.arrayBuffer(),te=new AudioContext,he=await te.decodeAudioData(re),Ce=he.getChannelData(0),ge=he.sampleRate,Z=he.duration;let be=0,we=0;const ye=.01;for(let At=0;At<Ce.length;At++){const mt=Math.abs(Ce[At]);be+=mt,mt<ye&&we++}const Ne=be/Ce.length,Be=we/ge,J=[...Ce].map(Math.abs).sort((At,mt)=>At-mt),Y=J[Math.floor(J.length*.1)],fe=J[Math.floor(J.length*.9)],Ue=fe>0?20*Math.log10(fe/(Y+.001)):0;let Ie="good";Ne<.005||Be>Z*.8||Ue<10?Ie="poor":(Ne<.02||Be>Z*.5||Ue<20)&&(Ie="fair");const vt=200,Pe=Math.floor(Ce.length/vt),Ft=[];for(let At=0;At<vt;At++){let mt=0;const Qt=At*Pe,It=Math.min(Qt+Pe,Ce.length);for(let Ut=Qt;Ut<It;Ut++)mt+=Math.abs(Ce[Ut]);Ft.push(mt/(It-Qt))}const sr={duration:Z,fileSize:r.size,quality:Ie,avgVolume:Ne,silenceDuration:Be,estimatedSNR:Ue};y(Ft),x(sr),n?.(sr),await te.close()}catch(re){console.error("Audio analysis failed:",re)}},[r,n]);u.useEffect(()=>{j&&M()},[j,M]);const $=u.useCallback(()=>{const re=U.current;if(!re||!N.length||!d)return;const te=re.getContext("2d");if(!te)return;const{width:he,height:Ce}=re,ge=l/d;te.clearRect(0,0,he,Ce);const Z=he/N.length,be=Math.max(...N);N.forEach((ye,Ne)=>{const Be=Math.max(2,ye/be*Ce*.8),J=Ne*Z,Y=(Ce-Be)/2;Ne/N.length<=ge?te.fillStyle=f?"#1d4ed8":"#3b82f6":te.fillStyle="#d1d5db",te.fillRect(J,Y,Math.max(1,Z-1),Be)});const we=ge*he;te.strokeStyle=f?"#dc2626":"#ef4444",te.lineWidth=f?3:2,te.beginPath(),te.moveTo(we,0),te.lineTo(we,Ce),te.stroke(),f&&(te.fillStyle="rgba(239, 68, 68, 0.2)",te.fillRect(we-2,0,4,Ce))},[N,l,d,f]);u.useEffect(()=>{$()},[$]);const W=()=>{if(E.current&&!f&&!F){const re=E.current.currentTime;isFinite(re)&&re>=0&&c(re)}},V=()=>{if(E.current){const re=E.current.duration;isFinite(re)&&re>0?m(re):m(0)}},L=()=>{A(!1),X()},O=u.useCallback(()=>{P.current&&(window.clearTimeout(P.current),P.current=void 0),S(!1),E.current&&isFinite(E.current.currentTime)&&c(E.current.currentTime)},[]),z=u.useCallback(()=>{P.current&&(window.clearTimeout(P.current),P.current=void 0),S(!1),E.current&&isFinite(E.current.currentTime)&&c(E.current.currentTime)},[]),H=u.useCallback(()=>{if(!o||!E.current||f||F)return;const re=()=>{E.current&&o&&!f&&!F&&(c(E.current.currentTime),k.current=requestAnimationFrame(re))};k.current=requestAnimationFrame(re)},[o,f,F]),X=u.useCallback(()=>{k.current&&(cancelAnimationFrame(k.current),k.current=void 0)},[]),Ae=u.useCallback(()=>{!E.current||f||(o?(E.current.pause(),A(!1),X()):E.current.play().then(()=>{A(!0),!F&&!f&&H()}).catch(re=>{console.error("Audio playback failed:",re),A(!1)}))},[o,f,F,H,X]),D=u.useCallback(re=>{if(!E.current||!d||!isFinite(d)||d<=0){console.log("‚ùå seekTo validation failed:",{hasAudioRef:!!E.current,duration:d,isFiniteDuration:isFinite(d||0),durationValid:(d||0)>0});return}if(!isFinite(re)||re<0||re>100){console.error("‚ùå Invalid percentage in seekTo:",{percentage:re,isFinite:isFinite(re),inRange:re>=0&&re<=100});return}if(f)return;S(!0);const te=re/100*d,he=Math.max(0,Math.min(d,te));if(!isFinite(he)){console.error("‚ùå Calculated newTime is non-finite:",{percentage:re,duration:d,rawNewTime:te,newTime:he}),S(!1);return}console.log("üéØ Seeking to:",{percentage:re.toFixed(2),newTime:he.toFixed(2),duration:d.toFixed(2)}),P.current&&(window.clearTimeout(P.current),P.current=void 0),c(he);try{isFinite(he)&&he>=0&&he<=d?(E.current.currentTime=he,P.current=window.setTimeout(()=>{S(!1),E.current&&isFinite(E.current.currentTime)&&c(E.current.currentTime)},200)):(console.error("‚ùå Final validation failed for currentTime:",{newTime:he,duration:d}),S(!1))}catch(Ce){console.error("‚ùå Seek failed:",Ce),S(!1),P.current&&(window.clearTimeout(P.current),P.current=void 0)}},[d,f]),K=u.useCallback(re=>{re.preventDefault(),re.stopPropagation();const te=U.current;if(!te||!d||!isFinite(d)||d<=0){console.log("‚ùå Cannot seek: canvas or duration not available",{canvas:!!te,duration:d,isFiniteDuration:isFinite(d||0)});return}if(f){console.log("‚è≠Ô∏è Seek already in progress, ignoring click");return}const he=te.getBoundingClientRect(),Ce=re.clientX-he.left,ge=Ce/he.width*100,Z=Math.max(0,Math.min(100,ge));if(!isFinite(Z)){console.error("‚ùå Invalid percentage calculated:",{x:Ce,width:he.width,rawPercentage:ge,percentage:Z});return}console.log("üéØ Waveform clicked:",{x:Ce.toFixed(2),width:he.width.toFixed(2),percentage:Z.toFixed(2)});try{D(Z)}catch(be){console.error("‚ùå Waveform seek failed:",be)}},[d,f,D]),ee=u.useCallback(()=>{X(),A(!1),w(!1),E.current&&E.current.pause(),D(0)},[D,X]),pe=()=>{const re=URL.createObjectURL(r),te=document.createElement("a");te.href=re,te.download=`${e}-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.webm`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(re)},ae=re=>{if(!isFinite(re)||isNaN(re)||re<0)return"0:00";const te=Math.floor(re/60),he=Math.floor(re%60);return`${te}:${he.toString().padStart(2,"0")}`},me=re=>{switch(re){case"good":return"text-green-600";case"fair":return"text-yellow-600";case"poor":return"text-red-600";default:return"text-gray-600"}},le=re=>{switch(re){case"good":return"‚úÖ";case"fair":return"‚ö†Ô∏è";case"poor":return"‚ùå";default:return"‚ùì"}};return u.useEffect(()=>{o||X()},[o,X]),u.useEffect(()=>()=>{P.current&&window.clearTimeout(P.current)},[]),u.useEffect(()=>()=>{X(),P.current&&window.clearTimeout(P.current)},[X]),t.jsxs("div",{className:`space-y-3 ${s}`,children:[t.jsx("audio",{ref:E,src:j,onTimeUpdate:W,onLoadedMetadata:V,onEnded:L,onSeeked:O,onError:z,onRateChange:()=>h(E.current?.playbackRate||1),preload:"metadata"}),a&&v&&t.jsxs("button",{onClick:()=>C(!T),className:"w-full flex items-center justify-between px-3 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[t.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Quality:"}),t.jsx("span",{className:`font-medium ${me(v.quality)}`,children:v.quality}),t.jsx("span",{className:"text-gray-400",children:"‚Ä¢"}),t.jsx("span",{className:"text-gray-600",children:"Duration:"}),t.jsx("span",{className:"text-gray-900",children:ae(v.duration)})]}),T?t.jsx(Wr,{className:"w-4 h-4 text-gray-400"}):t.jsx(Dt,{className:"w-4 h-4 text-gray-400"})]}),T&&v&&t.jsxs("div",{className:"space-y-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Quality:"}),t.jsxs("span",{className:`font-medium ${me(v.quality)}`,children:[v.quality!=="good"&&`${le(v.quality)} `,v.quality]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Duration:"}),t.jsx("span",{className:"text-gray-900",children:ae(v.duration)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"File Size:"}),t.jsxs("span",{className:"text-gray-900",children:[(v.fileSize/1024).toFixed(1),"KB"]})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Avg Volume:"}),t.jsxs("span",{className:"text-gray-900",children:[(v.avgVolume*100).toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Silence:"}),t.jsx("span",{className:"text-gray-900",children:ae(v.silenceDuration)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Est. SNR:"}),t.jsxs("span",{className:"text-gray-900",children:[v.estimatedSNR.toFixed(1),"dB"]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("canvas",{ref:U,width:400,height:80,className:`w-full h-20 bg-white rounded border transition-all duration-200 ${f?"cursor-grabbing border-blue-400 shadow-md":"cursor-pointer hover:bg-gray-50 hover:border-gray-300"}`,onClick:K,onMouseMove:re=>{const te=U.current;if(te&&d&&isFinite(d)&&d>0&&!f){const he=te.getBoundingClientRect(),Ce=re.clientX-he.left,Z=Math.max(0,Math.min(100,Ce/he.width*100))/100*d;te.title=`Click to seek to ${ae(Z)}`}else te&&f&&(te.title="Seeking...")},style:{touchAction:"none"}}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[t.jsx("span",{children:ae(l)}),t.jsx("span",{className:f?"text-blue-600 font-medium":"",children:f?"Seeking...":"Click waveform to seek"}),t.jsx("span",{children:ae(d)})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("input",{type:"range",min:"0",max:"100",step:"0.1",value:d&&isFinite(d)&&d>0?l/d*100:0,onMouseDown:()=>{w(!0),X()},onMouseUp:()=>{w(!1),o&&!f&&H()},onTouchStart:()=>{w(!0),X()},onTouchEnd:()=>{w(!1),o&&!f&&H()},onInput:re=>{if(F){const te=parseFloat(re.target.value);isFinite(te)&&D(te)}},onChange:()=>{},className:"w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",disabled:!d||!isFinite(d)||d<=0,title:"Seek audio position"}),t.jsx("div",{className:"text-xs text-gray-400 text-center",children:"Alternative: Use slider above to seek"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:Ae,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition-colors",disabled:!j,title:o?"Pause audio":"Play audio",type:"button",children:o?t.jsx(Wu,{className:"w-5 h-5"}):t.jsx(zo,{className:"w-5 h-5 ml-1"})}),t.jsx("button",{onClick:ee,className:"flex items-center justify-center w-8 h-8 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-full transition-colors",disabled:!j,title:"Reset to beginning",type:"button",children:t.jsx(Qc,{className:"w-4 h-4"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(zu,{className:"w-4 h-4 text-gray-600"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:p,onChange:re=>{const te=parseFloat(re.target.value);b(te),E.current&&(E.current.volume=te)},className:"w-20 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",title:"Adjust volume"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("select",{value:g,onChange:re=>{const te=parseFloat(re.target.value);h(te),E.current&&(E.current.playbackRate=te)},className:"text-xs bg-white border border-gray-300 rounded px-2 py-1",title:"Playback speed",children:[t.jsx("option",{value:.5,children:"0.5x"}),t.jsx("option",{value:.75,children:"0.75x"}),t.jsx("option",{value:1,children:"1.0x"}),t.jsx("option",{value:1.25,children:"1.25x"}),t.jsx("option",{value:1.5,children:"1.5x"}),t.jsx("option",{value:2,children:"2.0x"})]}),t.jsxs("button",{onClick:pe,className:"flex items-center space-x-1 px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded border border-gray-300 transition-colors",title:"Download audio file",type:"button",children:[t.jsx(jr,{className:"w-3 h-3"}),t.jsx("span",{children:"Save"})]})]})]}),v.quality!=="good"&&t.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded",children:t.jsx("div",{className:"flex items-start",children:t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Audio Quality Issues Detected"}),t.jsxs("div",{className:"mt-1 text-xs text-yellow-600 space-y-1",children:[v.avgVolume<.005&&t.jsx("p",{children:"‚Ä¢ Recording is very quiet - check microphone levels"}),v.silenceDuration>v.duration*.5&&t.jsx("p",{children:"‚Ä¢ Recording contains significant silence"}),v.estimatedSNR<15&&t.jsx("p",{children:"‚Ä¢ High background noise detected"}),v.duration<2&&t.jsx("p",{children:"‚Ä¢ Recording is very short - may affect transcription accuracy"})]})]})})})]})]})},Lr=u.memo(({originalTranscription:r,onTranscriptionCopy:e,onTranscriptionInsert:s,onTranscriptionEdit:n,transcriptionSaveStatus:a,onAgentReprocess:i,currentAgent:o,isProcessing:A=!1,className:l="",audioBlob:c,defaultExpanded:d=!1,collapseWhen:m,approvalState:g,onTranscriptionApprove:h})=>{const[p,b]=u.useState(!!d),[N,y]=u.useState(!1),[j,Q]=u.useState(!1),[v,x]=u.useState(r||""),[f,S]=u.useState(!1);Fe.useEffect(()=>{m&&p&&b(!1)},[m]),Fe.useEffect(()=>{x(r)},[r]);const F=U=>{x(U),n&&n(U)},w=[{id:"tavi",label:"TAVI",icon:"ü´Ä"},{id:"angiogram-pci",label:"Angiogram/PCI",icon:"ü©∫"},{id:"quick-letter",label:"Quick Letter",icon:"üìù"},{id:"consultation",label:"Consultation",icon:"üë®‚Äç‚öïÔ∏è"},{id:"investigation-summary",label:"Investigation",icon:"üî¨"}],T=async()=>{if(e)try{await e(v),y(!0),setTimeout(()=>y(!1),2e3)}catch(U){console.error("Failed to copy transcription:",U)}},C=async()=>{if(s)try{await s(v),Q(!0),setTimeout(()=>Q(!1),2e3)}catch(U){console.error("Failed to insert transcription:",U)}},E=U=>{i&&!A&&i(U)};return t.jsxs("div",{className:`border-b border-gray-200/50 ${l} ${A?"bg-blue-50/30 border-b-blue-200/50":""}`,children:[t.jsxs("button",{onClick:()=>b(!p),className:`w-full p-4 text-left transition-colors flex items-center justify-between ${A?"hover:bg-blue-50/60":"hover:bg-gray-50/50"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx(Pt,{className:`w-4 h-4 flex-shrink-0 ${A?"text-blue-600":"text-gray-600"}`}),t.jsx("span",{className:`font-medium text-sm leading-none ${A?"text-blue-900":"text-gray-900"}`,children:"Original Transcription"}),t.jsxs("span",{className:"text-xs text-gray-500 leading-none",children:[(v||"").split(" ").filter(U=>U.trim()).length," words",v!==r&&t.jsx("span",{className:"text-blue-600 ml-1",children:"(edited)"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e&&t.jsxs("button",{onClick:U=>{U.stopPropagation(),T()},className:`inline-flex items-center gap-1.5 h-6 rounded transition-all duration-200 ${A?"px-2 py-1 bg-blue-50 border border-blue-200 hover:bg-blue-100 shadow-sm":"px-1.5 py-1 hover:bg-gray-100"}`,title:A?"Copy raw transcription":"Copy transcription",children:[N?t.jsx(ft,{className:"w-3.5 h-3.5 text-green-600 flex-shrink-0"}):t.jsx(Hr,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0",title:"Copy transcription"}),A&&t.jsx("span",{className:"text-xs text-blue-700 font-medium leading-none whitespace-nowrap",children:"Copy Raw"})]}),s&&t.jsx("button",{onClick:U=>{U.stopPropagation(),C()},className:"p-1.5 rounded hover:bg-gray-100 transition-colors",title:"Insert transcription to EMR",children:j?t.jsx(ft,{className:"w-3.5 h-3.5 text-green-600"}):t.jsx(Ns,{className:"w-3.5 h-3.5 text-blue-500"})}),i&&t.jsx("div",{className:"p-1.5",children:t.jsx(Jt,{className:`w-3.5 h-3.5 text-purple-500 ${A?"animate-spin":""}`})}),p?t.jsx(mo,{className:"w-4 h-4 text-gray-400"}):t.jsx(uo,{className:"w-4 h-4 text-gray-400"})]})]}),p&&t.jsxs("div",{className:"px-4 pb-4",children:[t.jsxs("div",{className:"bg-gray-50/80 rounded-lg p-2 border border-gray-200/50",children:[a&&a.status!=="idle"&&t.jsxs("div",{className:`flex items-center space-x-2 mb-2 p-2 rounded text-xs ${a.status==="saving"?"bg-yellow-50 text-yellow-700 border border-yellow-200":a.status==="saved"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[a.status==="saving"&&t.jsx("div",{className:"w-3 h-3 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{children:a.message}),a.timestamp&&t.jsxs("span",{className:"opacity-70",children:["at ",a.timestamp.toLocaleTimeString()]})]}),g&&h&&t.jsxs("div",{className:"mb-3 p-3 bg-white border rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Transcription"}),t.jsxs("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${g.status==="pending"?"bg-gray-100 text-gray-700":g.status==="approved"?"bg-green-100 text-green-700":g.status==="edited"?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-500"}`,children:[g.status==="pending"&&"‚è≥ Not Reviewed",g.status==="approved"&&"‚úÖ Approved",g.status==="edited"&&"‚úèÔ∏è Edited",g.status==="skipped"&&"‚è≠Ô∏è Skipped"]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>h("approved"),disabled:g.status==="approved",className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${g.status==="approved"?"bg-green-100 text-green-700 border border-green-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-green-400 hover:bg-green-50"}`,title:"Mark this transcription as perfect for training",children:[t.jsx(Xu,{className:"w-4 h-4"}),t.jsx("span",{children:"Perfect"})]}),t.jsxs("button",{type:"button",onClick:()=>{g.status!=="edited"&&h("edited")},className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${g.status==="edited"?"bg-orange-100 text-orange-700 border border-orange-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-orange-400 hover:bg-orange-50"}`,title:"Edit this transcription to improve accuracy",children:[t.jsx(zs,{className:"w-4 h-4"}),t.jsx("span",{children:"Edit"})]}),t.jsxs("button",{type:"button",onClick:()=>h("skipped"),disabled:g.status==="skipped",className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${g.status==="skipped"?"bg-gray-100 text-gray-700 border border-gray-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-gray-400 hover:bg-gray-50"}`,title:"Skip this transcription for training",children:[t.jsx(qu,{className:"w-4 h-4"}),t.jsx("span",{children:"Skip"})]})]}),g.status==="edited"&&t.jsx("button",{type:"button",onClick:()=>{console.log("‚úÖ Submitting edited transcription for training"),h("approved")},className:"mt-2 w-full px-3 py-2 rounded-lg text-sm font-medium transition-all bg-blue-600 hover:bg-blue-700 text-white border border-blue-700",title:"Submit your corrections to improve AI training",children:"Send for Corrections"})]}),t.jsx("div",{className:"relative",children:t.jsx("textarea",{value:v,onChange:U=>F(U.target.value),disabled:!n,className:`w-full h-32 p-2 text-sm text-gray-900 bg-white border border-gray-200 rounded resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 leading-relaxed ${n?"":"opacity-60 cursor-not-allowed"}`,placeholder:n?"Edit transcription to improve accuracy - corrections will be submitted for training only with your approval...":"Transcription editing not available",title:n?"Edit the transcription to improve accuracy. Training data is only submitted when you explicitly approve it.":"Transcription editing not available"})})]}),c&&t.jsx("div",{className:"mt-3",children:t.jsx(qc,{audioBlob:c,fileName:`transcription-${o||"recording"}`,className:"",showQualityBar:!0,defaultExpanded:!1})}),i&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[t.jsxs("button",{onClick:()=>S(!f),className:"w-full flex items-center justify-between px-2 py-1 hover:bg-gray-100 rounded transition-colors",children:[t.jsxs("p",{className:"text-xs text-gray-600",children:["Reprocess (",w.length," agents)"]}),f?t.jsx(mo,{className:"w-3 h-3 text-gray-400"}):t.jsx(uo,{className:"w-3 h-3 text-gray-400"})]}),f&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:w.map(U=>t.jsxs("button",{onClick:()=>E(U.id),disabled:A,className:`px-2 py-1 text-xs rounded-md border transition-colors flex items-center space-x-1 ${o===U.id?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"} ${A?"opacity-50 cursor-not-allowed":""}`,children:[t.jsx("span",{children:U.icon}),t.jsx("span",{children:U.label}),o===U.id&&t.jsx("span",{className:"text-xs text-blue-500",children:"‚Ä¢"})]},U.id))})]})]})]})});Lr.displayName="TranscriptionSection";const xp=Fe.lazy(()=>$e(()=>import("./chunks/AIReasoningModal.dU8SjUqO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),eA=u.memo(({results:r,agentType:e,onCopy:s,onInsertToEMR:n,className:a="",reportMetadata:i,agentName:o,customActions:A=[],onEditAndTrain:l,editAndTrainActive:c=!1,disableEditAndTrain:d=!1})=>{const[m,g]=u.useState(!1),[h,p]=u.useState(!1),[b,N]=u.useState(!1),y=i?.reasoningArtifacts?.hasReasoningContent||i?.rawAIOutput&&i.rawAIOutput.trim().length>0,j=async()=>{try{await s(r),g(!0),setTimeout(()=>g(!1),2e3)}catch(f){console.error("Failed to copy:",f)}},Q=async()=>{try{console.log("üîò ActionButtons: Insert to EMR button clicked"),console.log("üîò ActionButtons: agentType prop:",e),console.log("üîò ActionButtons: results length:",r?.length||0),typeof n=="function"&&await n(r,void 0,e),p(!0),setTimeout(()=>p(!1),2e3)}catch(f){console.error("Failed to insert to EMR:",f)}},v=2+(y?1:0)+(l?1:0)+A.length,x=v<=4?`grid-cols-${v}`:"grid-cols-4";return t.jsxs("div",{className:`p-4 border-t border-emerald-200/50 ${a}`,children:[t.jsxs("div",{className:`grid gap-2 ${x}`,children:[t.jsxs("button",{onClick:j,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${m?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,children:[m?t.jsx(ft,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Hr,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${m?"text-emerald-700":"text-gray-700"}`,children:m?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:Q,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${h?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,title:"Paste into the active EMR field",children:[h?t.jsx(ft,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Ns,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${h?"text-emerald-700":"text-gray-700"}`,children:h?"Inserted!":"Insert to EMR"})]}),l&&t.jsxs("button",{onClick:l,disabled:d,className:`
              p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
              ${c?"bg-blue-600 text-white border-blue-500 shadow-sm":"bg-white/60 border-blue-200 hover:bg-blue-50/80 text-blue-700"}
              ${d?"opacity-60 cursor-not-allowed":""}
            `,title:"Revise output and capture training example",children:[t.jsx(zs,{className:`w-4 h-4 ${c?"text-white":"text-blue-700"}`}),t.jsx("span",{className:`text-xs ${c?"text-white font-semibold":"text-blue-700"}`,children:c?"Editing‚Ä¶":"Edit & Train"})]}),y&&t.jsxs("button",{onClick:()=>N(!0),className:"bg-white border-2 border-gray-300 p-3 rounded-lg flex flex-col items-center space-y-1 hover:border-gray-400 hover:shadow-sm transition-all duration-200 ease-out btn-micro-press",title:"View AI Reasoning Process",children:[t.jsx(Xo,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Reasoning"})]}),A.map(f=>{const S=f.icon,F=f.variant==="primary";return t.jsxs("button",{onClick:f.onClick,className:`
                p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                ${F?"bg-blue-50 border-blue-300 hover:bg-blue-100 text-blue-700":"bg-white/60 border-gray-300 hover:bg-gray-50 text-gray-700"}
              `,title:f.label,children:[t.jsx(S,{className:"w-4 h-4"}),t.jsx("span",{className:"text-xs",children:f.label})]},f.id)})]}),t.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Fr,{className:"w-4 h-4 text-green-400"}),t.jsx("span",{className:"text-green-400 text-xs",children:"Report generated successfully"})]}),t.jsxs("div",{className:"text-gray-500 text-xs flex items-center gap-1 group relative cursor-help",title:"AI generation confidence based on input clarity and model output consistency. This is an estimate.",children:[t.jsx("span",{children:"Confidence: 95%"}),t.jsx(Yu,{className:"w-3 h-3 opacity-60 group-hover:opacity-100 transition-opacity"}),t.jsxs("div",{className:"absolute bottom-full right-0 mb-2 hidden group-hover:block z-10 w-56 p-2 bg-gray-900 text-white text-xs rounded shadow-lg",children:[t.jsx("p",{className:"leading-relaxed",children:"AI generation confidence based on input clarity and model output consistency. This is an estimate."}),t.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})]}),e!=="investigation-summary"&&t.jsx("div",{className:"mt-3 p-2 bg-emerald-50/50 rounded-lg border border-emerald-100",children:t.jsxs("p",{className:"text-emerald-700 text-xs",children:["üí° ",t.jsx("strong",{children:"Full Letter:"})," Complete medical correspondence ready for EMR insertion or sharing.",y&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),"üß† ",t.jsx("strong",{children:"AI Reasoning:"})," View how the AI processed your dictation for transparency."]})]})}),y&&t.jsx(u.Suspense,{fallback:null,children:t.jsx(xp,{isOpen:b,onClose:()=>N(!1),reasoningArtifacts:i?.reasoningArtifacts,rawAIOutput:i?.rawAIOutput,agentName:o})})]})});eA.displayName="ActionButtons";const Yc=u.memo(({agentType:r,title:e,subtitle:s,completedTime:n,processingTime:a,confidence:i,originalTranscription:o,onTranscriptionCopy:A,onTranscriptionInsert:l,onTranscriptionEdit:c,transcriptionSaveStatus:d,onAgentReprocess:m,isProcessing:g=!1,audioBlob:h,transcriptionApprovalState:p,onTranscriptionApprove:b,children:N,results:y,onCopy:j,onInsertToEMR:Q,reportMetadata:v,agentName:x,className:f="",hideTranscription:S=!1,hideActions:F=!1})=>{const w=Kc(y),T=Vc(w),C=e||(r?`${r.charAt(0).toUpperCase()+r.slice(1).replace("-"," ")} Results`:"Results");return t.jsxs(se.div,{className:`bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-gray-200 overflow-hidden ${f}`,variants:Ke(Rr),initial:"hidden",animate:"visible",exit:"exit",children:[t.jsxs("div",{className:"bg-gradient-to-br from-emerald-50/80 to-teal-50/60 p-4 border-b border-emerald-200/50",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Et,{className:"w-5 h-5 text-emerald-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900 leading-tight",children:C}),s&&t.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:s}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-xs text-gray-600",children:[n&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Kt,{className:"w-3 h-3"}),t.jsx("span",{children:po(n)})]}),a&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{children:[(a/1e3).toFixed(1),"s processing"]})]}),w>0&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{children:[w," words"]})]}),T&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{children:[Gc(T)," read"]})]})]})]})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx(yt,{className:"w-5 h-5 text-emerald-600"})})]}),i!==void 0&&i>0&&t.jsx("div",{className:"mt-3 pt-3 border-t border-emerald-200/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"AI Confidence"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-32 h-1.5 bg-emerald-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-emerald-500 rounded-full transition-all duration-500",style:{width:`${i}%`}})}),t.jsxs("span",{className:"text-xs font-medium text-emerald-700",children:[i,"%"]})]})]})})]}),!S&&o&&t.jsx(Lr,{originalTranscription:o,onTranscriptionCopy:A,onTranscriptionInsert:l,onTranscriptionEdit:c,transcriptionSaveStatus:d,onAgentReprocess:m,currentAgent:r,isProcessing:g,audioBlob:h,defaultExpanded:!1,collapseWhen:!g,approvalState:p,onTranscriptionApprove:b}),t.jsx("div",{className:"results-content",children:N}),!F&&t.jsx(eA,{results:y,agentType:r,onCopy:j,onInsertToEMR:Q,reportMetadata:v,agentName:x})]})});Yc.displayName="ResultsContainer";const Jc=u.memo(({results:r,agentType:e,className:s=""})=>{const[n,a]=u.useState(!0),[i,o]=u.useState(!1),[A,l]=u.useState(null),c=u.useRef(null),d=u.useMemo(()=>{if(e!=="patient-education")return null;try{const v=r.match(/\n---\n/);if(v&&v.index!==void 0){const x=r.substring(0,v.index).trim(),f=r.substring(v.index+v[0].length).trim();try{return{jsonMetadata:JSON.parse(x),letterContent:f}}catch(S){return console.warn("Failed to parse JSON metadata:",S),{jsonMetadata:null,letterContent:r}}}else return console.warn("No delimiter found in patient education output"),{jsonMetadata:null,letterContent:r}}catch(v){console.error("Error parsing patient education response:",v)}return null},[r,e]),m=u.useMemo(()=>{const v=r.split(/\s+/).filter(F=>F.length>0).length,x=Math.ceil(v/200),f=r.length,S=r.split(`
`).length;return{wordCount:v,readingTime:x,charCount:f,lineCount:S}},[r]),g=e!=="angiogram-pci"&&r.length>1e3,h=u.useMemo(()=>!g||i?r:r.substring(0,500)+"...",[r,g,i]),p=u.useCallback(v=>{const x=[],f=v.split(`
`);let S=null;const F=()=>{S&&S.content.trim().length>0&&x.push({title:S.title||"Medical Report",content:S.content.trim()})},w=e==="angiogram-pci",T=["PREAMBLE","FINDINGS","FINDINGS/PROCEDURE","PROCEDURE","CONCLUSION"];for(const C of f){const E=C.trim();if(!E)continue;const U=E.replace(/^[#>*\s]+/,"").replace(/\*+$/g,"").replace(/:$/,"").trim();(()=>{if(!U)return!1;const P=U.toUpperCase();if(w)return T.includes(P);if(["PREAMBLE","FINDINGS","FINDINGS/PROCEDURE","PROCEDURE","CONCLUSION","ADDITIONAL NOTES","LEFT VENTRICLE"].includes(P))return!0;const $=U===P&&P.length<=60&&!P.includes("."),W=/^[A-Z][A-Za-z\s()/-]{2,40}$/.test(U);return $||W})()?(F(),S={title:U,content:""}):S?S.content+=(S.content?`
`:"")+C:S={title:"Medical Report",content:C}}return F(),x.length===0?[{title:"Medical Report",content:v}]:x},[e]),b=u.useMemo(()=>p(r),[r,p]),N=u.useMemo(()=>p(h),[h,p]),y=v=>v?{tavi:"TAVI Report","angiogram-pci":"Angiogram/PCI Report","quick-letter":"Quick Letter",consultation:"Consultation Report","investigation-summary":"Investigation Summary",background:"Background Summary",medication:"Medication Review",bloods:"Blood Test Order",imaging:"Imaging Order",mteer:"mTEER Report",tteer:"TTEER Report","pfo-closure":"PFO Closure Report","asd-closure":"ASD Closure Report","pvl-plug":"PVL Plug Report","bypass-graft":"Bypass Graft Report","right-heart-cath":"Right Heart Catheterisation","tavi-workup":"TAVI Workup","ai-medical-review":"AI Medical Review","batch-ai-review":"Batch AI Review","patient-education":"Patient Education","pre-op-plan":"Pre-Op Plan Summary","ohif-viewer":"Imaging Viewer Summary","aus-medical-review":"Australian Medical Review",enhancement:"Enhanced Report",transcription:"Transcription",generation:"Generated Report"}[v]||v.toUpperCase():"Medical Report",j=async(v,x)=>{try{const S=(w=>{let T=w.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>");return T=T.replace(/\n/g,"<br>"),T})(v),F=new ClipboardItem({"text/html":new Blob([S],{type:"text/html"}),"text/plain":new Blob([v],{type:"text/plain"})});await navigator.clipboard.write([F]),l(x),setTimeout(()=>l(null),2e3)}catch(f){console.warn("HTML copy failed, falling back to plain text:",f);try{await navigator.clipboard.writeText(v),l(x),setTimeout(()=>l(null),2e3)}catch(S){console.error("Failed to copy:",S)}}},Q=()=>{if(c.current&&d?.jsonMetadata){const v=window.open("","_blank");if(v){const x=JSON.stringify(d.jsonMetadata,null,2);v.document.write(`
          <!DOCTYPE html>
          <html>
            <head>
              <title>Patient Education Plan - Structured Data</title>
              <style>
                body { font-family: monospace; padding: 20px; }
                pre { white-space: pre-wrap; word-wrap: break-word; }
                h1 { font-size: 18px; margin-bottom: 20px; }
              </style>
            </head>
            <body>
              <h1>Patient Education Plan - Structured Data</h1>
              <pre>${x}</pre>
            </body>
          </html>
        `),v.document.close(),v.print()}}};if(!r)return null;if(e==="patient-education"&&d){const{letterContent:v,jsonMetadata:x}=d;return t.jsx("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${s}`,children:t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Et,{className:"w-4 h-4 text-emerald-600"}),t.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Patient Letter"})]}),t.jsx("button",{onClick:()=>j(v,"letter"),className:"flex items-center space-x-1 px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-medium rounded-md transition-colors",children:A==="letter"?t.jsxs(t.Fragment,{children:[t.jsx(yt,{className:"w-3 h-3 text-green-600"}),t.jsx("span",{className:"text-green-600",children:"Copied!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Vr,{className:"w-3 h-3"}),t.jsx("span",{children:"Copy"})]})})]}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:t.jsx("div",{className:"text-gray-800 text-sm leading-relaxed whitespace-pre-wrap",children:v})})]}),x&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Pn,{className:"w-4 h-4 text-blue-600"}),t.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Action Plan (Structured Data)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>j(JSON.stringify(x,null,2),"json"),className:"flex items-center space-x-1 px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-medium rounded-md transition-colors",children:A==="json"?t.jsxs(t.Fragment,{children:[t.jsx(yt,{className:"w-3 h-3 text-green-600"}),t.jsx("span",{className:"text-green-600",children:"Copied!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Vr,{className:"w-3 h-3"}),t.jsx("span",{children:"Copy JSON"})]})}),t.jsxs("button",{onClick:Q,className:"flex items-center space-x-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-md transition-colors",children:[t.jsx(jr,{className:"w-3 h-3"}),t.jsx("span",{children:"Export PDF"})]})]})]}),t.jsx("div",{ref:c,className:"bg-gray-900 rounded-lg p-4 border border-gray-700 overflow-x-auto",children:t.jsx("pre",{className:"text-xs text-green-400 font-mono whitespace-pre-wrap break-words",children:JSON.stringify(x,null,2)})})]})]})})}return t.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${s}`,children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>a(!n),className:"p-1 hover:bg-gray-100 rounded transition-colors","aria-label":n?"Collapse report":"Expand report",children:n?t.jsx(Wr,{className:"w-5 h-5 text-gray-600"}):t.jsx(Dt,{className:"w-5 h-5 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-semibold text-sm",children:y(e)}),t.jsx("div",{className:"text-gray-600 text-xs mt-1",children:t.jsx("span",{children:new Date().toLocaleTimeString()})})]})]}),g&&t.jsx("button",{onClick:()=>o(!i),className:"text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:i?"Show Less":"Show More"})]})}),n&&t.jsxs("div",{className:"report-content",children:[t.jsx("div",{className:"space-y-4 p-4",children:N.map((v,x)=>{const f=b[x]?.content||v.content,S=v.title||`Section ${x+1}`,F=`section-${x}`;return t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg shadow-sm p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:S}),t.jsx("button",{onClick:()=>j(f,F),className:`
                        flex items-center space-x-1 px-2.5 py-1 text-xs font-medium rounded-md transition-colors
                        ${A===F?"bg-emerald-100 text-emerald-700 border border-emerald-300":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-100"}
                      `,children:A===F?t.jsxs(t.Fragment,{children:[t.jsx(yt,{className:"w-3 h-3"}),t.jsx("span",{children:"Copied"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Vr,{className:"w-3 h-3"}),t.jsx("span",{children:"Copy"})]})})]}),t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:v.content})]},`${S}-${x}`)})}),N.length===0&&t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:h})}),g&&!i&&t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("button",{onClick:()=>o(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1 transition-colors",children:[t.jsxs("span",{children:["Show complete report (",m.charCount," characters)"]}),t.jsx(Dt,{className:"w-4 h-4"})]})})]})]})});Jc.displayName="ReportDisplay";const bp=({finding:r,index:e,isCompleted:s,onToggleComplete:n,className:a="",useBrightDesign:i=!1})=>{const[o,A]=u.useState(!1),l=b=>{switch(b){case"Immediate":return t.jsx(ot,{className:"w-4 h-4 text-red-600"});case"Soon":return t.jsx(Kt,{className:"w-4 h-4 text-orange-500"});case"Routine":return t.jsx(yt,{className:"w-4 h-4 text-green-600"});default:return t.jsx(is,{className:"w-4 h-4 text-gray-500"})}},c=b=>{if(s)return i?"border-white bg-gradient-bright opacity-60":"border-gray-200 bg-gray-50 opacity-60";if(i)switch(b){case"Immediate":return"border-rose-300 bg-gradient-bright-rose";case"Soon":return"border-amber-300 bg-gradient-bright-amber";case"Routine":return"border-emerald-300 bg-gradient-bright-emerald";default:return"border-white bg-gradient-bright"}else switch(b){case"Immediate":return"border-red-200 bg-red-50";case"Soon":return"border-orange-200 bg-orange-50";case"Routine":return"border-green-200 bg-green-50";default:return"border-gray-200 bg-gray-50"}},d=b=>{if(s)return"bg-gray-100 text-gray-600";switch(b){case"Immediate":return"bg-red-100 text-red-800";case"Soon":return"bg-orange-100 text-orange-800";case"Routine":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},m=()=>{n(e)},g=i?"border-bright":"border-2",h=i?"rounded-bright":"rounded-lg",p=i?"shadow-bright-card hover:shadow-bright-elevated":"";return t.jsxs("div",{className:`${g} ${h} ${p} transition-all duration-200 ${c(r.urgency)} ${a} ${s?"transform scale-[0.98]":""}`,children:[t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:m,className:"flex-shrink-0 p-1 rounded-md hover:bg-white/50 transition-colors",title:s?"Mark as incomplete":"Mark as complete",children:s?t.jsx(yt,{className:"w-5 h-5 text-green-600"}):t.jsx(Ks,{className:"w-5 h-5 text-gray-400 hover:text-gray-600"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[l(r.urgency),t.jsxs("span",{className:`font-semibold text-sm ${s?"text-gray-500 line-through":"text-gray-900"}`,children:["Finding ",e+1]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d(r.urgency)}`,children:r.urgency}),t.jsx("button",{onClick:()=>A(!o),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:o?"Collapse":"Details"})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("h5",{className:`font-medium text-sm mb-1 ${s?"text-gray-500":"text-gray-900"}`,children:"Clinical Finding"}),t.jsx("p",{className:`text-sm ${s?"text-gray-400 line-through":"text-gray-700"}`,children:r.finding})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("h5",{className:`font-medium text-sm mb-1 ${s?"text-gray-500":"text-gray-900"}`,children:"Recommended Action"}),t.jsx("p",{className:`text-sm font-medium ${s?"text-gray-400 line-through":"text-indigo-700"}`,children:r.recommendedAction})]}),o&&t.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-200",children:[t.jsxs("div",{children:[t.jsx("h5",{className:`font-medium text-sm mb-1 ${s?"text-gray-500":"text-gray-900"}`,children:"Australian Guideline"}),t.jsx("p",{className:`text-sm font-medium ${s?"text-gray-400":"text-blue-700"}`,children:r.australianGuideline})]}),t.jsxs("div",{children:[t.jsx("h5",{className:`font-medium text-sm mb-1 ${s?"text-gray-500":"text-gray-900"}`,children:"Clinical Reasoning"}),t.jsx("p",{className:`text-sm ${s?"text-gray-400":"text-gray-700"}`,children:r.clinicalReasoning})]}),r.heartFoundationLink&&t.jsx("div",{children:t.jsxs("a",{href:r.heartFoundationLink,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center space-x-1 text-sm hover:underline ${s?"text-gray-400 pointer-events-none":"text-red-600 hover:text-red-700"}`,children:[t.jsx(ds,{className:"w-4 h-4"}),t.jsx("span",{children:"Heart Foundation Resource"}),t.jsx(Ao,{className:"w-3 h-3"})]})})]})]}),s&&t.jsx("div",{className:"px-4 py-2 bg-green-100 border-t border-green-200",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(gr,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-green-700 text-xs font-medium",children:"Action completed"})]})})]})},yp=({classification:r,findings:e,guidelineReferences:s,heartFoundationResources:n,cvdRiskCalculatorRecommended:a,aboriginalTorresStraitIslander:i,qtProlongationRisk:o,medicationSafetyIssues:A,missingTests:l,therapyTargets:c,clinicalNotes:d,isProcessing:m=!1,useBrightCards:g=!1})=>{const p=(x=>{switch(x){case"primary":return{label:"Primary Prevention",color:"emerald",bgGradient:"from-emerald-50 to-teal-50",borderColor:"border-emerald-200",textColor:"text-emerald-800",icon:qr};case"secondary-cad":return{label:"Secondary Prevention (CAD)",color:"red",bgGradient:"from-red-50 to-rose-50",borderColor:"border-red-200",textColor:"text-red-800",icon:em};case"secondary-hfref":return{label:"Secondary Prevention (HFrEF)",color:"purple",bgGradient:"from-purple-50 to-indigo-50",borderColor:"border-purple-200",textColor:"text-purple-800",icon:ds};case"secondary-valvular":return{label:"Secondary Prevention (Valvular)",color:"blue",bgGradient:"from-blue-50 to-cyan-50",borderColor:"border-blue-200",textColor:"text-blue-800",icon:Ic};case"mixed":return{label:"Mixed (Primary + Secondary)",color:"amber",bgGradient:"from-amber-50 to-yellow-50",borderColor:"border-amber-200",textColor:"text-amber-800",icon:is}}})(r.category),b=p.icon,[N,y]=u.useState(new Set),j=x=>{const f=new Set(N);N.has(x)?f.delete(x):f.add(x),y(f)},Q=N.size,v=e.length;return m?t.jsxs("div",{className:"glass rounded-2xl p-6",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx(is,{className:"w-6 h-6 text-purple-600 animate-pulse"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-semibold text-lg",children:"AI Medical Review"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Analyzing patient data against Australian guidelines..."})]})]}),t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"w-8 h-8 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin"})})]}):t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[t.jsx(is,{className:"w-6 h-6 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-semibold text-lg",children:"Comprehensive Cardiovascular Review"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Primary + Secondary Prevention ‚Ä¢ NHFA/CSANZ/RACGP Guidelines"})]})]}),t.jsx("div",{className:`mt-4 p-4 rounded-lg border-2 bg-gradient-to-r ${p.bgGradient} ${p.borderColor}`,children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(b,{className:`w-5 h-5 mt-0.5 ${p.textColor} flex-shrink-0`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("h4",{className:`font-semibold text-sm ${p.textColor}`,children:p.label}),t.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium bg-white/50 ${p.textColor}`,children:r.category.toUpperCase()})]}),t.jsx("p",{className:"text-gray-700 text-xs mb-2",children:r.rationale}),r.reviewFocus.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-gray-600 text-xs font-medium mb-1",children:"Review Focus:"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:r.reviewFocus.map((x,f)=>t.jsx("span",{className:"px-2 py-0.5 bg-white/70 text-gray-700 text-xs rounded",children:x},f))})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-purple-600",children:v}),t.jsx("div",{className:"text-xs text-gray-600",children:"Total Findings"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:Q}),t.jsx("div",{className:"text-xs text-gray-600",children:"Completed"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:e.filter(x=>x.urgency==="Immediate").length}),t.jsx("div",{className:"text-xs text-gray-600",children:"Immediate"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:A}),t.jsx("div",{className:"text-xs text-gray-600",children:"Medication Safety"})]})]}),v>0&&t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[Q,"/",v," completed"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${v>0?Q/v*100:0}%`}})})]}),t.jsxs("div",{className:"mt-4 space-y-2",children:[i&&t.jsx("div",{className:"p-3 bg-blue-100 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ju,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-blue-800 text-sm font-medium",children:"Aboriginal/Torres Strait Islander considerations included"})]})}),o&&t.jsx("div",{className:"p-3 bg-yellow-100 border border-yellow-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ot,{className:"w-4 h-4 text-yellow-600"}),t.jsx("span",{className:"text-yellow-800 text-sm font-medium",children:"QT prolongation risk identified - review medications and ECG monitoring"})]})})]})]}),t.jsx("div",{className:"p-6",children:e.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(yt,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),t.jsx("h4",{className:"text-gray-900 font-medium text-lg mb-2",children:"No Critical Issues Identified"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"The AI review found no major clinical oversights based on Australian guidelines."})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-base",children:"Clinical Findings"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>y(new Set),className:"text-xs text-gray-600 hover:text-gray-800",disabled:Q===0,children:"Clear all"}),t.jsx("button",{onClick:()=>y(new Set(Array.from({length:v},(x,f)=>f))),className:"text-xs text-blue-600 hover:text-blue-800",disabled:Q===v,children:"Complete all"})]})]}),t.jsx("div",{className:"space-y-4",children:e.map((x,f)=>t.jsx(bp,{finding:x,index:f,isCompleted:N.has(f),onToggleComplete:j,useBrightDesign:g},f))}),Q===v&&v>0&&t.jsx("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(yt,{className:"w-5 h-5 text-green-600"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-green-800",children:"All Findings Addressed"}),t.jsx("p",{className:"text-green-700 text-sm",children:"You have completed all clinical findings from the AI review."})]})]})})]})}),l&&l.length>0||c&&Object.keys(c).length>0?t.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-emerald-50/30 to-teal-50/30",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx(Vt,{className:"w-5 h-5 text-emerald-600"}),t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Primary Prevention Recommendations"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l&&l.length>0&&t.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-lg p-4 border border-emerald-200",children:[t.jsx("h5",{className:"font-medium text-emerald-800 text-xs mb-2",children:"Missing / Next Tests"}),t.jsx("ul",{className:"space-y-1",children:l.map((x,f)=>t.jsxs("li",{className:"text-gray-700 text-xs flex items-start",children:[t.jsx("span",{className:"text-emerald-600 mr-2",children:"‚Ä¢"}),t.jsx("span",{children:x})]},f))})]}),c&&Object.keys(c).length>0&&t.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-lg p-4 border border-teal-200",children:[t.jsx("h5",{className:"font-medium text-teal-800 text-xs mb-2",children:"Therapy Targets"}),t.jsx("dl",{className:"space-y-1",children:Object.entries(c).map(([x,f],S)=>t.jsxs("div",{className:"flex items-start text-xs",children:[t.jsxs("dt",{className:"font-medium text-gray-700 mr-2",children:[x,":"]}),t.jsx("dd",{className:"text-gray-600",children:f})]},S))})]})]}),d&&t.jsxs("div",{className:"mt-4 bg-amber-50/50 border border-amber-200 rounded-lg p-4",children:[t.jsx("h5",{className:"font-medium text-amber-800 text-xs mb-2",children:"Clinical Notes"}),t.jsx("p",{className:"text-gray-700 text-xs whitespace-pre-line",children:d})]})]}):null,t.jsxs("div",{className:"p-6 bg-gray-50 border-t border-gray-200",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm mb-4",children:"Australian Clinical Resources"}),s.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"font-medium text-gray-700 text-xs mb-2",children:"Guidelines Referenced"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((x,f)=>t.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:x},f))})]}),n.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"font-medium text-gray-700 text-xs mb-2",children:"Heart Foundation Resources"}),t.jsx("div",{className:"space-y-2",children:n.map((x,f)=>t.jsxs("a",{href:x,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center space-x-1 text-red-600 hover:text-red-700 text-xs",children:[t.jsx(ds,{className:"w-3 h-3"}),t.jsxs("span",{children:["Resource ",f+1]}),t.jsx(Ao,{className:"w-3 h-3"})]},f))})]}),a&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"font-medium text-gray-700 text-xs mb-2",children:"Recommended Calculator"}),t.jsxs("a",{href:"http://www.cvdcheck.org.au/",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs",children:[t.jsx(Zu,{className:"w-3 h-3"}),t.jsx("span",{children:"Australian CVD Risk Calculator"}),t.jsx(Ao,{className:"w-3 h-3"})]})]}),t.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(ot,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-yellow-800 text-xs font-medium mb-1",children:"Important Disclaimer"}),t.jsx("p",{className:"text-yellow-700 text-xs",children:"AI-generated clinical suggestions based on Australian guidelines (NHFA/CSANZ/RACGP) for cardiology practice. Not a substitute for clinical judgment. Verify recommendations against current guidelines and local policies."})]})]})})]})]})},Zc=u.memo(({reviewData:r,className:e="",useBrightCards:s,storageKey:n="ui_preferences_card_theme"})=>{const[a,i]=u.useState(!1),[o,A]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const p=(await chrome.storage.local.get(n))[n];i(p==="bright")}catch(h){console.error("Failed to load card theme preference:",h)}finally{A(!0)}})();const g=h=>{if(h[n]){const p=h[n].newValue;i(p==="bright")}};return chrome.storage.onChanged.addListener(g),()=>{chrome.storage.onChanged.removeListener(g)}},[n]);const l=s!==void 0?s:a;console.log("üé¥ AI REVIEW CARDS: Rendering with data:",{hasReviewData:!!r,hasClassification:!!r?.classification,findingsCount:r?.findings?.length||0,hasMissingTests:!!r?.missingTests,hasTherapyTargets:!!r?.therapyTargets,classification:r?.classification?.category});const c=Array.isArray(r?.findings)?r.findings:[],d={category:"primary",rationale:"Classification not provided",triggers:[],reviewFocus:[]};return t.jsx("div",{className:e,children:t.jsx(yp,{classification:r?.classification||d,findings:c,guidelineReferences:r?.guidelineReferences||[],heartFoundationResources:r?.heartFoundationResources||[],cvdRiskCalculatorRecommended:r?.cvdRiskCalculatorRecommended||!1,aboriginalTorresStraitIslander:r?.aboriginalTorresStraitIslander||!1,qtProlongationRisk:r?.qtProlongationRisk||!1,medicationSafetyIssues:r?.medicationSafetyIssues||0,missingTests:r?.missingTests,therapyTargets:r?.therapyTargets,clinicalNotes:r?.clinicalNotes,isProcessing:!1,useBrightCards:l})})});Zc.displayName="AIReviewCards";const ed=u.memo(({warnings:r=[],onDismissWarnings:e,className:s=""})=>{const[n,a]=u.useState(!1);return!r||r.length===0?null:t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>a(!n),className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 hover:bg-orange-200 transition-colors",title:`${r.length} warning${r.length!==1?"s":""} - click to ${n?"hide":"view"}`,children:[t.jsx(Fr,{className:"w-3 h-3"}),t.jsx("span",{children:r.length})]}),n&&t.jsx("div",{className:`p-4 border-b border-orange-200/50 bg-orange-50/30 ${s}`,children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Fr,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-orange-800 font-medium text-sm mb-2",children:"Content Warnings"}),t.jsx("ul",{className:"space-y-1",children:r.map((i,o)=>t.jsxs("li",{className:"text-orange-700 text-sm leading-relaxed",children:["‚Ä¢ ",i]},o))}),e&&t.jsx("button",{onClick:()=>{e(),a(!1)},className:"mt-3 text-orange-600 hover:text-orange-700 text-xs font-medium transition-colors",children:"Dismiss warnings"})]})]})})]})});ed.displayName="WarningsPanel";const td=u.memo(({failedAudioRecordings:r,errors:e,onClearFailedRecordings:s,className:n=""})=>{const[a,i]=u.useState(!1),[o,A]=u.useState(null);return r.length>0&&e.length>0&&e.some(c=>c.includes("could not be parsed coherently")||c.includes("Investigation dictation could not be parsed"))?t.jsxs("div",{className:`border-t border-red-200/50 bg-red-50/30 ${n}`,children:[t.jsxs("button",{onClick:()=>i(!a),className:"w-full p-4 text-left hover:bg-red-50/50 transition-colors flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(up,{className:"w-4 h-4 text-red-600"}),t.jsx("span",{className:"text-red-900 font-medium text-sm",children:"üîä Troubleshoot Audio Recording"}),t.jsxs("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-0.5 rounded-full",children:[r.length," recording",r.length!==1?"s":""]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[s&&t.jsx("button",{onClick:c=>{c.stopPropagation(),s()},className:"p-1.5 rounded hover:bg-red-100 transition-colors",title:"Clear all failed recordings",children:t.jsx(Er,{className:"w-3.5 h-3.5 text-red-500"})}),a?t.jsx(mo,{className:"w-4 h-4 text-red-400"}):t.jsx(uo,{className:"w-4 h-4 text-red-400"})]})]}),a&&t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-sm text-red-700 bg-red-100/50 p-3 rounded-lg border border-red-200",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Fr,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Investigation parsing failed"}),t.jsx("p",{className:"text-red-600 mt-1 text-xs",children:"The recording could not be processed into a structured investigation summary. Use the audio playback below to identify potential issues:"}),t.jsxs("ul",{className:"mt-2 text-xs text-red-600 space-y-1",children:[t.jsx("li",{children:"‚Ä¢ Check if audio is too quiet or contains too much silence"}),t.jsx("li",{children:"‚Ä¢ Verify medical terminology is clearly spoken"}),t.jsx("li",{children:"‚Ä¢ Ensure recording duration is adequate (‚â•2 seconds)"}),t.jsx("li",{children:"‚Ä¢ Look for background noise or audio quality issues"})]})]})]})}),r.length>1&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-red-700 mb-2",children:"Select recording to troubleshoot:"}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:r.map((c,d)=>t.jsx("button",{onClick:()=>A(c),className:`p-3 rounded-lg border text-left transition-colors ${o?.id===c.id?"bg-red-100 border-red-300 text-red-800":"bg-white border-red-200 hover:bg-red-50 text-red-700"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-sm",children:["Recording #",r.length-d]}),t.jsxs("div",{className:"text-xs opacity-75 mt-1",children:[new Date(c.timestamp).toLocaleString()," ‚Ä¢",c.metadata.recordingTime,"s ‚Ä¢",(c.metadata.fileSize/1024).toFixed(1),"KB"]})]}),o?.id===c.id&&t.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})]})},c.id))})]}),(o||r.length===1)&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-red-700 mb-1",children:"Audio Playback & Analysis"}),t.jsx("p",{className:"text-xs text-red-600",children:"Listen to the recording and check the audio quality metrics below:"})]}),t.jsx(qc,{audioBlob:(o||r[0]).audioBlob,fileName:`investigation-failed-${(o||r[0]).agentType}`,className:"border-red-200"}),(o||r[0]).transcriptionAttempt&&t.jsxs("div",{className:"mt-3",children:[t.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Transcription Result:"}),t.jsx("div",{className:"bg-white p-3 rounded-lg border border-red-200 text-sm text-gray-800",children:t.jsx("p",{className:"whitespace-pre-wrap",children:(o||r[0]).transcriptionAttempt})}),t.jsx("p",{className:"text-xs text-red-600 mt-2",children:"The transcription above was successful, but could not be parsed into a structured investigation summary."})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Error Details:"}),t.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:t.jsx("p",{className:"text-sm text-red-800 font-mono",children:(o||r[0]).errorMessage})})]})]})]})})]}):null});td.displayName="TroubleshootingSection";const ta=[{key:"patient",title:"Patient Demographics",icon:co,color:"blue",priority:"high",group:"demographics"},{key:"social_history",title:"Social History",icon:co,color:"cyan",priority:"low",group:"demographics"},{key:"clinical",title:"Clinical Assessment",icon:Fn,color:"green",priority:"high",group:"clinical"},{key:"background",title:"Background History",icon:Pt,color:"gray",priority:"medium",group:"clinical"},{key:"medications",title:"Medications",icon:Pt,color:"orange",priority:"medium",group:"clinical"},{key:"laboratory",title:"Laboratory Values",icon:Pt,color:"purple",priority:"medium",group:"investigations"},{key:"ecg",title:"ECG Assessment",icon:Fn,color:"red",priority:"medium",group:"investigations"},{key:"investigations",title:"Investigation Summary",icon:Pt,color:"indigo",priority:"medium",group:"investigations"},{key:"echocardiography",title:"Echocardiography",icon:di,color:"red",priority:"high",group:"investigations"},{key:"enhanced_ct",title:"Enhanced CT Analysis",icon:Fn,color:"emerald",priority:"high",group:"investigations"},{key:"procedure_planning",title:"Procedure Planning",icon:Pt,color:"violet",priority:"high",group:"planning"},{key:"alerts",title:"Alerts & Considerations",icon:Fr,color:"red",priority:"high",group:"planning"}],vp=[{key:"demographics",title:"Demographics",icon:co,color:"blue",description:"Patient demographics and social information"},{key:"clinical",title:"Clinical Assessment",icon:Fn,color:"green",description:"Clinical history, medications, and assessments"},{key:"investigations",title:"Investigations",icon:di,color:"purple",description:"Imaging, laboratory, and diagnostic studies"},{key:"planning",title:"Planning",icon:Pt,color:"violet",description:"Procedure planning and clinical considerations"}],wp=({structuredSections:r,results:e,missingInfo:s=[],onCopy:n,onInsertToEMR:a,onReprocessWithAnswers:i,className:o=""})=>{const[A,l]=u.useState(new Set(["patient","clinical","alerts"])),[c,d]=u.useState(new Set(["demographics","clinical","investigations","planning"])),[m,g]=u.useState(!1),[h,p]=u.useState({}),[b,N]=u.useState({copied:!1,inserted:!1}),y=u.useMemo(()=>{if(r)return r;if(e)try{let C=e.trim();C=C.replace(/```json\s*/,"").replace(/```\s*$/,"");const E=C.match(/\{[\s\S]*\}/);if(E){const U=JSON.parse(E[0]);return{patient:{content:U.patient?.content||"Not provided",missing:U.patient?.missing||[]},clinical:{content:U.clinical?.content||"Not provided",missing:U.clinical?.missing||[]},laboratory:{content:U.laboratory?.content||"Not provided",missing:U.laboratory?.missing||[]},ecg:{content:U.ecg?.content||"Not provided",missing:U.ecg?.missing||[]},background:{content:U.background?.content||"Not provided",missing:U.background?.missing||[]},medications:{content:U.medications?.content||"Not provided",missing:U.medications?.missing||[]},social_history:{content:U.social_history?.content||"Not provided",missing:U.social_history?.missing||[]},investigations:{content:U.investigations?.content||"Not provided",missing:U.investigations?.missing||[]},echocardiography:{content:U.echocardiography?.content||"Not provided",missing:U.echocardiography?.missing||[]},enhanced_ct:{content:U.enhanced_ct?.content||"Not provided",missing:U.enhanced_ct?.missing||[]},procedure_planning:{content:U.procedure_planning?.content||"Not provided",missing:U.procedure_planning?.missing||[]},alerts:{content:U.alerts?.content||"No alerts",missing:U.alerts?.missing||[],pre_anaesthetic_review_text:U.alerts?.pre_anaesthetic_review_text,pre_anaesthetic_review_json:U.alerts?.pre_anaesthetic_review_json},missing_summary:U.missing_summary||{missing_clinical:[],missing_diagnostic:[],missing_measurements:[],completeness_score:"0% (No data)"}}}}catch(C){console.warn("Failed to parse TAVI JSON from results:",C)}return{patient:{content:"No data available",missing:[]},clinical:{content:"No data available",missing:[]},laboratory:{content:"No data available",missing:[]},ecg:{content:"No data available",missing:[]},background:{content:"No data available",missing:[]},medications:{content:"No data available",missing:[]},social_history:{content:"No data available",missing:[]},investigations:{content:"No data available",missing:[]},echocardiography:{content:"No data available",missing:[]},enhanced_ct:{content:"No data available",missing:[]},procedure_planning:{content:"No data available",missing:[]},alerts:{content:"No alerts",missing:[]},missing_summary:{missing_clinical:[],missing_diagnostic:[],missing_measurements:[],completeness_score:"0% (No data available)"}}},[r,e]),j=u.useMemo(()=>{const C=ta.length,E=ta.filter(M=>{const $=y[M.key];return M.key==="missing_summary"?!0:$&&"content"in $&&$.content&&$.content!=="Not provided"&&$.content!=="No data available"&&!$.content.includes("not provided")&&!$.content.includes("not available")}).length,U=Math.round(E/C*100),k=y.missing_summary,P=[...k?.missing_clinical||[],...k?.missing_diagnostic||[],...k?.missing_measurements||[]].length;return{percentage:U,completedSections:E,totalSections:C,totalMissingItems:P,status:U>=80?"excellent":U>=60?"good":U>=40?"fair":"incomplete"}},[r]),Q=u.useMemo(()=>{const C=ta.filter(U=>U.key!=="missing_summary").map(U=>{const k=y[U.key];if(!k||!("content"in k)||!k.content||k.content==="Not provided"||k.content==="No data available"||k.content.includes("not provided")||k.content.includes("not available"))return null;let P=`**${U.title}**
${k.content}`;return U.key==="alerts"&&"pre_anaesthetic_review_text"in k&&k.pre_anaesthetic_review_text&&(P+=`

${"pre_anaesthetic_review_text"in k?k.pre_anaesthetic_review_text:""}`),P+`
`}).filter(Boolean).join(`
`);return`TAVI WORKUP SUMMARY
Completion: ${j.percentage}% (${j.status})

`+C},[r,j]),v=u.useCallback(C=>{l(E=>{const U=new Set(E);return U.has(C)?U.delete(C):U.add(C),U})},[]),x=u.useCallback(C=>{d(E=>{const U=new Set(E);return U.has(C)?U.delete(C):U.add(C),U})},[]),f=u.useMemo(()=>vp.map(C=>{const E=ta.filter(P=>P.group===C.key),U=E.filter(P=>{const M=y[P.key];return P.key==="missing_summary"?!0:M&&"content"in M&&M.content&&M.content!=="Not provided"&&M.content!=="No data available"&&!M.content.includes("not provided")&&!M.content.includes("not available")}).length,k=E.reduce((P,M)=>{const $=y[M.key];return $&&"missing"in $&&$.missing?P+$.missing.length:P},0);return{...C,sections:E,completed:U,total:E.length,completionPercentage:Math.round(U/E.length*100),missingItems:k}}),[y]),S=u.useCallback(async()=>{n&&(await n(Q),N(C=>({...C,copied:!0})),setTimeout(()=>N(C=>({...C,copied:!1})),2e3))},[n,Q]),F=u.useCallback(async()=>{a&&(await a(Q),N(C=>({...C,inserted:!0})),setTimeout(()=>N(C=>({...C,inserted:!1})),2e3))},[a,Q]),w=u.useCallback(()=>{i&&Object.keys(h).length>0&&(i(h),g(!1),p({}))},[i,h]),T=C=>{const E=y[C.key],U=A.has(C.key),k=C.key==="missing_summary",P=!k&&E&&"content"in E&&E.content!=="Not provided"&&E.content!=="No data available"&&!E.content.includes("not provided")&&!E.content.includes("not available")&&E.content.trim().length>0,M=!k&&E&&"missing"in E&&E.missing&&E.missing.length>0,$=C.icon;return t.jsxs(se.div,{className:"border border-gray-200 rounded-lg overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[t.jsxs("button",{onClick:()=>v(C.key),className:`w-full p-4 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors ${P?"border-l-4 border-l-green-500":M?"border-l-4 border-l-yellow-500":"border-l-4 border-l-gray-300"}`,children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($,{className:`w-5 h-5 text-${C.color}-600`}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"font-semibold text-gray-900",children:C.title}),t.jsx("p",{className:"text-sm text-gray-600",children:P?"Complete":M&&"missing"in E?`${E.missing.length} missing items`:"No data"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[P&&t.jsx(ft,{className:"w-4 h-4 text-green-600"}),M&&t.jsx(Fr,{className:"w-4 h-4 text-yellow-600"}),U?t.jsx(Wr,{className:"w-4 h-4 text-gray-500"}):t.jsx(Dt,{className:"w-4 h-4 text-gray-500"})]})]}),t.jsx(Le,{children:U&&t.jsx(se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:t.jsxs("div",{className:"p-4 border-t border-gray-200",children:[P?t.jsx("div",{className:"prose prose-sm max-w-none",children:t.jsx("div",{className:"text-gray-900 whitespace-pre-wrap",children:"content"in E?E.content:""})}):t.jsx("div",{className:"text-gray-500 italic",children:"No data available"}),C.key==="alerts"&&"pre_anaesthetic_review_text"in E&&E.pre_anaesthetic_review_text&&t.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsx("h4",{className:"text-sm font-semibold text-blue-800 mb-3",children:"Pre Anaesthetic Review"}),t.jsx("div",{className:"text-sm text-blue-900 whitespace-pre-wrap",children:"pre_anaesthetic_review_text"in E?E.pre_anaesthetic_review_text:""}),"pre_anaesthetic_review_json"in E&&E.pre_anaesthetic_review_json&&t.jsxs("details",{className:"mt-3",children:[t.jsx("summary",{className:"text-xs text-blue-700 cursor-pointer hover:text-blue-900",children:"View structured anaesthetic data"}),t.jsx("pre",{className:"mt-2 text-xs text-blue-800 bg-blue-100 p-2 rounded overflow-x-auto",children:"pre_anaesthetic_review_json"in E?JSON.stringify(E.pre_anaesthetic_review_json,null,2):""})]})]}),M&&t.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[t.jsx("h4",{className:"text-sm font-semibold text-yellow-800 mb-2",children:"Missing Information:"}),t.jsx("ul",{className:"text-sm text-yellow-700 space-y-2",children:"missing"in E?E.missing.map((W,V)=>t.jsxs("li",{className:"flex items-center justify-between p-2 bg-white border border-yellow-200 rounded",children:[t.jsxs("div",{className:"flex items-start space-x-2 flex-1",children:[t.jsx("span",{className:"text-yellow-500 mt-0.5",children:"‚Ä¢"}),t.jsx("span",{className:"flex-1",children:W})]}),t.jsx("button",{onClick:()=>{const L=prompt(`Please provide: ${W}`,"");L&&L.trim()&&console.log(`Adding missing info for ${C.key}:`,{field:W,value:L.trim()})},className:"ml-2 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Add"})]},V)):null}),t.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200",children:t.jsx("button",{onClick:()=>{console.log("Regenerating TAVI report with missing information...")},className:"w-full px-3 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Regenerate with Missing Information"})})]})]})})})]},C.key)};return t.jsxs("div",{className:`space-y-6 ${o}`,children:[t.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"TAVI Workup Summary"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[j.completedSections," of ",j.totalSections," sections complete",j.totalMissingItems>0&&` ‚Ä¢ ${j.totalMissingItems} items missing`]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:`text-2xl font-bold ${j.status==="excellent"?"text-green-600":j.status==="good"?"text-blue-600":j.status==="fair"?"text-yellow-600":"text-red-600"}`,children:[j.percentage,"%"]}),t.jsx("div",{className:`text-xs uppercase tracking-wide ${j.status==="excellent"?"text-green-600":j.status==="good"?"text-blue-600":j.status==="fair"?"text-yellow-600":"text-red-600"}`,children:j.status})]})]}),t.jsx("div",{className:"mt-3",children:t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${j.status==="excellent"?"bg-green-500":j.status==="good"?"bg-blue-500":j.status==="fair"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${j.percentage}%`}})})})]}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsxs("button",{onClick:S,className:`flex items-center space-x-2 px-4 py-2 rounded-lg border transition-all ${b.copied?"bg-green-50 border-green-200 text-green-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[b.copied?t.jsx(ft,{className:"w-4 h-4"}):t.jsx(Hr,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:b.copied?"Copied!":"Copy Report"})]}),t.jsxs("button",{onClick:F,className:`flex items-center space-x-2 px-4 py-2 rounded-lg border transition-all ${b.inserted?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[b.inserted?t.jsx(ft,{className:"w-4 h-4"}):t.jsx(Pt,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:b.inserted?"Inserted!":"Insert to EMR"})]}),j.totalMissingItems>0&&t.jsxs("button",{onClick:()=>g(!m),className:"flex items-center space-x-2 px-4 py-2 bg-yellow-50 border border-yellow-200 text-yellow-700 rounded-lg hover:bg-yellow-100 transition-colors",children:[t.jsx(Uc,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Complete Missing Info"})]})]}),t.jsx(Le,{children:m&&t.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsx("h3",{className:"font-semibold text-yellow-800 mb-3",children:"Complete Missing Information"}),t.jsx("div",{className:"space-y-3",children:[...y.missing_summary.missing_clinical,...y.missing_summary.missing_diagnostic,...y.missing_summary.missing_measurements].map((C,E)=>t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:C}),t.jsx("input",{type:"text",value:h[C]||"",onChange:U=>p(k=>({...k,[C]:U.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:`Enter ${C.toLowerCase()}`})]},E))}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[t.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:w,disabled:Object.keys(h).length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Reprocess with Answers"})]})]})})}),t.jsx("div",{className:"space-y-6",children:f.map(C=>t.jsxs("div",{className:"space-y-3",children:[t.jsxs("button",{onClick:()=>x(C.key),className:"w-full p-4 flex items-center justify-between bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 border border-gray-200 rounded-lg transition-all duration-200",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:`p-2 rounded-lg bg-${C.color}-100`,children:t.jsx(C.icon,{className:`w-5 h-5 text-${C.color}-600`})}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:C.title}),t.jsx("p",{className:"text-sm text-gray-600",children:C.description})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:`text-sm font-medium ${C.completionPercentage>=80?"text-green-600":C.completionPercentage>=50?"text-blue-600":"text-yellow-600"}`,children:[C.completed,"/",C.total," complete"]}),t.jsxs("div",{className:"text-xs text-gray-500",children:[C.completionPercentage,"%",C.missingItems>0&&` ‚Ä¢ ${C.missingItems} missing`]})]}),t.jsx("div",{className:`w-12 h-12 rounded-full border-4 ${C.completionPercentage>=80?"border-green-500":C.completionPercentage>=50?"border-blue-500":"border-yellow-500"} border-r-transparent animate-pulse flex items-center justify-center`,children:t.jsxs("span",{className:`text-xs font-bold ${C.completionPercentage>=80?"text-green-600":C.completionPercentage>=50?"text-blue-600":"text-yellow-600"}`,children:[C.completionPercentage,"%"]})}),c.has(C.key)?t.jsx(Wr,{className:"w-5 h-5 text-gray-500"}):t.jsx(Dt,{className:"w-5 h-5 text-gray-500"})]})]}),t.jsx(Le,{children:c.has(C.key)&&t.jsx(se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden space-y-3 pl-6",children:C.sections.map(T)})})]},C.key))}),y.missing_summary.completeness_score&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Assessment Summary"}),t.jsxs("p",{className:"text-sm text-gray-700",children:[t.jsx("strong",{children:"Completeness Score:"})," ",y.missing_summary.completeness_score]})]})]})},Re=({label:r,value:e,unit:s,normalRange:n,description:a,priority:i="medium",decimalPlaces:o=1,prerequisites:A=[],showWhenMissing:l=!1})=>{if(e===void 0)return!l||A.length===0?null:t.jsx("div",{className:"bg-gray-50 border-l-2 border-gray-300 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:r}),t.jsx("div",{className:"text-sm text-gray-500 italic",children:"Not calculated"}),t.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[t.jsx("span",{className:"font-medium",children:"Needs:"})," ",A.join(", ")]})]}),t.jsx(Zt,{className:"w-4 h-4 text-gray-400 ml-2"})]})});let c="normal";n&&(n.min!==void 0&&e<n.min||n.max!==void 0&&e>n.max?c="abnormal":(n.min!==void 0&&e<n.min*1.1||n.max!==void 0&&e>n.max*.9)&&(c="borderline"));const d={normal:"bg-emerald-50 border-emerald-200",borderline:"bg-amber-50 border-amber-200",abnormal:"bg-rose-50 border-rose-200"},m={normal:"text-emerald-700",borderline:"text-amber-700",abnormal:"text-rose-700"},g=i==="high"?"border-l-4":"border-l-2";return t.jsx("div",{className:`${d[c]} ${g} border rounded-lg p-3`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:r}),t.jsxs("div",{className:`text-xl font-bold ${m[c]}`,children:[e.toFixed(o),t.jsx("span",{className:"text-sm font-normal ml-1",children:s})]}),n&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Normal: ",n.min!==void 0?`${n.min}`:"",n.min!==void 0&&n.max!==void 0?"-":"",n.max!==void 0?`${n.max}`:n.min!==void 0?"+":""," ",s]}),a&&t.jsx("div",{className:"text-xs text-gray-600 mt-1 italic",children:a})]}),c!=="normal"&&t.jsx("div",{className:"ml-2",children:c==="abnormal"?t.jsx(Zt,{className:"w-4 h-4 text-rose-600"}):t.jsx(Zt,{className:"w-4 h-4 text-amber-600"})})]})})},Bp=({calculations:r,className:e=""})=>{const[s,n]=u.useState(new Set(["tier1","tier2"]));if(!r)return null;const a=l=>{n(c=>{const d=new Set(c);return d.has(l)?d.delete(l):d.add(l),d})},i=!!(r.bsa||r.bmi||r.cardiacIndex||r.transpulmonaryGradient||r.pulmonaryVascularResistance||r.systemicVascularResistance),o=!!(r.fickCO||r.cardiacPowerOutput||r.rvswi||r.lvswi||r.papi||r.rapPawpRatio),A=!!(r.oxygenDelivery||r.oxygenExtractionRatio||r.pulmonaryArterialCompliance||r.pulmonaryRCTime||r.effectivePulmonaryEa||r.lvEes||r.raEes);return t.jsxs("div",{className:`space-y-4 ${e}`,children:[(r.clinicalAssessment||r.riskStratification||r.phClassification?.hasPH)&&t.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-600 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(ds,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Clinical Assessment"}),r.clinicalAssessment&&t.jsx("p",{className:"text-sm text-blue-800 mb-2",children:r.clinicalAssessment}),t.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[r.riskStratification&&t.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${r.riskStratification==="High"?"bg-rose-100 text-rose-800":r.riskStratification==="Intermediate"?"bg-amber-100 text-amber-800":"bg-emerald-100 text-emerald-800"}`,children:[r.riskStratification," Risk"]}),r.phClassification?.hasPH&&t.jsxs(t.Fragment,{children:[r.phClassification.type&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800",children:r.phClassification.type}),r.phClassification.severity&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800",children:[r.phClassification.severity," PH"]})]})]})]})]})}),i&&t.jsxs("div",{className:"border border-gray-200 rounded-lg bg-white",children:[t.jsxs("button",{type:"button",onClick:()=>a("tier1"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 rounded-t-lg",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Dn,{className:"w-5 h-5 text-emerald-600"}),t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Essential Haemodynamics"}),t.jsx("span",{className:"text-xs text-gray-500",children:"(Tier 1)"})]}),s.has("tier1")?t.jsx(Wr,{className:"w-5 h-5 text-gray-400"}):t.jsx(Dt,{className:"w-5 h-5 text-gray-400"})]}),s.has("tier1")&&t.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[(r.bsa||r.bmi)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Patient Anthropometrics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"BSA",value:r.bsa,unit:"m¬≤",normalRange:{min:1.5,max:2.5}}),t.jsx(Re,{label:"BMI",value:r.bmi,unit:"kg/m¬≤",normalRange:{min:18.5,max:25}})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Core Haemodynamics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"Cardiac Index",value:r.cardiacIndex,unit:"L/min/m¬≤",normalRange:{min:2.5,max:4},priority:"high"}),t.jsx(Re,{label:"Stroke Volume",value:r.strokeVolume,unit:"mL",normalRange:{min:60,max:100}}),t.jsx(Re,{label:"MAP",value:r.map,unit:"mmHg",normalRange:{min:70,max:100}}),t.jsx(Re,{label:"Estimated VO‚ÇÇ",value:r.estimatedVO2,unit:"mL/min"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Pulmonary Haemodynamics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"PVR",value:r.pulmonaryVascularResistance,unit:"Wood units",normalRange:{max:3},priority:"high",description:"Pulmonary Vascular Resistance",prerequisites:["PA mean","PCWP","CO"],showWhenMissing:!0}),t.jsx(Re,{label:"PVRI",value:r.pulmonaryVascularResistanceIndex,unit:"Wood¬∑m¬≤",normalRange:{max:5},prerequisites:["PVR","BSA"],showWhenMissing:!0}),t.jsx(Re,{label:"TPG",value:r.transpulmonaryGradient,unit:"mmHg",normalRange:{max:12},description:"Transpulmonary Gradient",prerequisites:["PA mean","PCWP"],showWhenMissing:!0}),t.jsx(Re,{label:"DPG",value:r.diastolicPressureGradient,unit:"mmHg",normalRange:{max:7},description:"Diastolic Pressure Gradient",prerequisites:["PA diastolic","PCWP"],showWhenMissing:!0})]})]}),(r.systemicVascularResistance||r.systemicVascularResistanceIndex)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Systemic Haemodynamics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"SVR",value:r.systemicVascularResistance,unit:"Wood units",normalRange:{min:10,max:20},description:"Systemic Vascular Resistance"}),t.jsx(Re,{label:"SVRI",value:r.systemicVascularResistanceIndex,unit:"Wood¬∑m¬≤",normalRange:{min:17,max:35}})]})]})]})]}),o&&t.jsxs("div",{className:"border border-gray-200 rounded-lg bg-white",children:[t.jsxs("button",{type:"button",onClick:()=>a("tier2"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 rounded-t-lg",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(qr,{className:"w-5 h-5 text-purple-600"}),t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Advanced Metrics (AHA 2021)"}),t.jsx("span",{className:"text-xs text-gray-500",children:"(Tier 2)"})]}),s.has("tier2")?t.jsx(Wr,{className:"w-5 h-5 text-gray-400"}):t.jsx(Dt,{className:"w-5 h-5 text-gray-400"})]}),s.has("tier2")&&t.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[(r.fickCO||r.fickCI)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Fick Method (Validation)"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"Fick CO",value:r.fickCO,unit:"L/min",normalRange:{min:4,max:8},description:"Cross-validation with thermodilution"}),t.jsx(Re,{label:"Fick CI",value:r.fickCI,unit:"L/min/m¬≤",normalRange:{min:2.5,max:4}})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Cardiac Power & Ventricular Work"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"CPO",value:r.cardiacPowerOutput,unit:"Watts",normalRange:{min:.5,max:.7},description:"Cardiac Power Output"}),t.jsx(Re,{label:"CPI",value:r.cardiacPowerIndex,unit:"W/m¬≤",normalRange:{min:.3,max:.5}}),t.jsx(Re,{label:"RVSWI",value:r.rvswi,unit:"mmHg¬∑mL/m¬≤",normalRange:{min:400,max:600},description:"RV Stroke Work Index"}),t.jsx(Re,{label:"LVSWI",value:r.lvswi,unit:"mmHg¬∑mL/m¬≤",normalRange:{min:50,max:70},description:"LV Stroke Work Index"}),t.jsx(Re,{label:"RV CPO",value:r.rvCardiacPowerOutput,unit:"Watts"}),t.jsx(Re,{label:"SVI",value:r.strokeVolumeIndex,unit:"mL/m¬≤",normalRange:{min:35,max:65}})]})]}),(r.papi||r.rapPawpRatio)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"RV Function Indices"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"PAPi",value:r.papi,unit:"",normalRange:{min:1.85},description:"Pulmonary Artery Pulsatility Index",decimalPlaces:2}),t.jsx(Re,{label:"RAP:PCWP Ratio",value:r.rapPawpRatio,unit:"",normalRange:{max:.67},decimalPlaces:2})]})]})]})]}),A&&t.jsxs("div",{className:"border border-gray-200 rounded-lg bg-white",children:[t.jsxs("button",{type:"button",onClick:()=>a("tier3"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 rounded-t-lg",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ds,{className:"w-5 h-5 text-blue-600"}),t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Specialized Calculations"}),t.jsx("span",{className:"text-xs text-gray-500",children:"(Tier 3)"})]}),s.has("tier3")?t.jsx(Wr,{className:"w-5 h-5 text-gray-400"}):t.jsx(Dt,{className:"w-5 h-5 text-gray-400"})]}),s.has("tier3")&&t.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[(r.oxygenDelivery||r.oxygenExtractionRatio)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Oxygen Transport"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"DO‚ÇÇ",value:r.oxygenDelivery,unit:"mL/min",description:"Oxygen Delivery",decimalPlaces:0}),t.jsx(Re,{label:"O‚ÇÇER",value:r.oxygenExtractionRatio,unit:"%",normalRange:{min:20,max:30},description:"Oxygen Extraction Ratio"})]})]}),(r.pulmonaryArterialCompliance||r.pulmonaryRCTime||r.effectivePulmonaryEa)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Pulmonary Vascular Mechanics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"PAC",value:r.pulmonaryArterialCompliance,unit:"mL/mmHg",normalRange:{min:2},description:"Pulmonary Arterial Compliance"}),t.jsx(Re,{label:"RC Time",value:r.pulmonaryRCTime,unit:"seconds",normalRange:{min:.5,max:.7},description:"Pulmonary Resistance-Compliance Time"}),t.jsx(Re,{label:"Ea",value:r.effectivePulmonaryEa,unit:"mmHg/mL",description:"Effective Pulmonary Elastance"})]})]}),(r.lvEes||r.raEes)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Ventricular Elastance (PV Loop Data)"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsx(Re,{label:"LV Ees",value:r.lvEes,unit:"mmHg/mL",description:"LV End-Systolic Elastance",decimalPlaces:2}),t.jsx(Re,{label:"RA Ees",value:r.raEes,unit:"mmHg/mL",description:"RA End-Systolic Elastance",decimalPlaces:2})]})]})]})]}),!i&&!o&&!A&&t.jsxs("div",{className:"border border-gray-200 rounded-lg bg-gray-50 p-6 text-center",children:[t.jsx(yt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Calculated values will appear here once all necessary haemodynamic measurements are recorded."}),t.jsx("p",{className:"text-gray-500 text-xs mt-2",children:"Required: Pressures (RA, RV, PA, PCWP), Cardiac Output, Patient Data (Height, Weight, HR, BP)"})]})]})},rd=({missingInfo:r,onSubmit:e,onDismiss:s,agentType:n})=>{console.log("üîç MissingInfoPanel: Received missingInfo:",r,"for agent:",n);const a=u.useMemo(()=>{const c=[],d=n==="quick-letter",m=n==="angiogram-pci",g=n==="tavi-workup";n==="investigation-summary"&&(r?.missing_purpose||r?.missing_clinical)&&console.warn("‚ö†Ô∏è MissingInfoPanel: Investigation Summary incorrectly has QuickLetter-style missing info - filtering out"),m&&Array.isArray(r?.missing_diagnostic)&&(console.log("üìã MissingInfoPanel: Adding missing_diagnostic (angiogram-pci):",r.missing_diagnostic),c.push(...r.missing_diagnostic)),m&&Array.isArray(r?.missing_intervention)&&(console.log("üìã MissingInfoPanel: Adding missing_intervention (angiogram-pci):",r.missing_intervention),c.push(...r.missing_intervention)),d&&Array.isArray(r?.missing_purpose)&&(console.log("üìã MissingInfoPanel: Adding missing_purpose (quick-letter):",r.missing_purpose),c.push(...r.missing_purpose)),d&&Array.isArray(r?.missing_clinical)&&(console.log("üìã MissingInfoPanel: Adding missing_clinical (quick-letter):",r.missing_clinical),c.push(...r.missing_clinical)),d&&Array.isArray(r?.missing_recommendations)&&(console.log("üìã MissingInfoPanel: Adding missing_recommendations (quick-letter):",r.missing_recommendations),c.push(...r.missing_recommendations)),g&&Array.isArray(r?.missing_structured)&&(console.log("üìã MissingInfoPanel: Adding missing_structured (tavi-workup):",r.missing_structured),c.push(...r.missing_structured)),g&&Array.isArray(r?.missing_measurements)&&(console.log("üìã MissingInfoPanel: Adding missing_measurements (tavi-workup):",r.missing_measurements),c.push(...r.missing_measurements));const p=c.filter(Q=>Q&&Q.trim().length>0),b=Q=>Q.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," ").replace(/\b(the|a|an|and|or|of|in|on|at|to|for|with)\b/g,"").trim(),N=(Q,v)=>{const x=b(Q),f=b(v);if(x===f||x.length>10&&f.length>10&&(x.includes(f)||f.includes(x)))return!0;if(["gradient","measurement","diameter","area","valve","pressure"].some(w=>x.includes(w)&&f.includes(w))){const w=x.split(" ").filter(U=>U.length>2),T=f.split(" ").filter(U=>U.length>2);if(w.filter(U=>T.includes(U)).length/Math.max(w.length,T.length)>.7)return!0}return!1},y=[],j=new Set;for(const Q of p){const v=b(Q);if(j.has(v)){console.log(`üìã MissingInfoPanel: Skipping exact duplicate: "${Q}"`);continue}if(y.some(f=>N(Q,f))){console.log(`üìã MissingInfoPanel: Skipping similar question: "${Q}"`);continue}y.push(Q),j.add(v)}return console.log(`üìä MissingInfoPanel: Total questions before dedup: ${c.length}, after enhanced dedup: ${y.length}`),console.log(`üìä MissingInfoPanel: Removed ${c.length-y.length} duplicate/similar questions`),y},[r,n]),[i,o]=u.useState({}),A=(c,d)=>{o(m=>({...m,[c]:d}))},l=r?.completeness_score||"";return a.length===0?null:t.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50",children:[t.jsxs("div",{className:"p-3 border-b border-amber-200 bg-amber-100 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-amber-900 font-semibold text-sm",children:"Missing Information"}),l&&t.jsxs("p",{className:"text-amber-700 text-xs",children:["Completeness: ",l]})]}),s&&t.jsx("button",{className:"text-amber-700 text-xs underline",onClick:s,children:"Dismiss"})]}),t.jsx("div",{className:"p-3 space-y-3",children:a.map(c=>t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-medium text-amber-900 block",children:c}),t.jsx("input",{type:"text",className:"w-full text-sm p-2 border border-amber-200 rounded focus:outline-none focus:ring-2 focus:ring-amber-300 bg-white",placeholder:"Add detail...",value:i[c]||"",onChange:d=>A(c,d.target.value)})]},c))}),t.jsxs("div",{className:"p-3 border-t border-amber-200 bg-amber-50 flex items-center justify-end space-x-2",children:[s&&t.jsx("button",{className:"px-3 py-2 text-xs rounded border border-amber-200 bg-white hover:bg-amber-50",onClick:s,children:"Skip for now"}),t.jsx("button",{className:"px-3 py-2 text-xs rounded bg-amber-600 text-white hover:bg-amber-700",onClick:()=>e(i),children:"Reprocess with answers"})]})]})},Cp=({rhcReport:r,onSave:e,onCancel:s})=>{const[n,a]=u.useState(r.haemodynamicPressures),[i,o]=u.useState(r.cardiacOutput),[A,l]=u.useState(r.rhcData),[c,d]=u.useState(r.patientData||{});u.useEffect(()=>{a(r.haemodynamicPressures),o(r.cardiacOutput),l(r.rhcData),d(r.patientData||{})},[r]);const m=u.useMemo(()=>{const y=w=>{if(!w)return;const T=parseFloat(w);return isNaN(T)?void 0:T},j=y(n.ra.mean);y(n.rv.systolic),y(n.rv.diastolic);const Q=y(n.pa.systolic),v=y(n.pa.diastolic),x=y(n.pa.mean),f=y(n.pcwp.mean),S=y(i.thermodilution.co);y(i.thermodilution.ci);const F={};return F.transpulmonaryGradient=Gm(x,f),F.diastolicPressureGradient=Wm(v,f),F.pulmonaryVascularResistance=zm(x,f,S),F.pulmonaryVascularResistance&&c.bsa&&(F.pulmonaryVascularResistanceIndex=Xm(F.pulmonaryVascularResistance,c.bsa)),c.meanArterialPressure&&S&&(F.systemicVascularResistance=qm(c.meanArterialPressure,j||0,S),F.systemicVascularResistance&&c.bsa&&(F.systemicVascularResistanceIndex=Ym(F.systemicVascularResistance,c.bsa))),S&&c.bsa&&(F.cardiacIndex=Jm(S,c.bsa)),S&&c.heartRate&&(F.strokeVolume=Zm(S,c.heartRate)),F.cardiacIndex&&c.heartRate&&(F.strokeVolumeIndex=ep(F.cardiacIndex,c.heartRate)),x&&F.strokeVolumeIndex&&(F.rvswi=tp(x,j||0,F.strokeVolumeIndex)),F.papi=rp(Q,v,j),c.meanArterialPressure&&S&&(F.cardiacPowerOutput=sp(c.meanArterialPressure,S)),c.meanArterialPressure&&F.cardiacIndex&&(F.cardiacPowerIndex=np(c.meanArterialPressure,F.cardiacIndex)),x&&S&&(F.rvCardiacPowerOutput=ap(x,S)),F.rapPawpRatio=ip(j,f),F},[n,i,c]),g=(y,j,Q)=>{a(v=>({...v,[y]:{...v[y],[j]:Q||null}}))},h=(y,j,Q)=>{o(v=>({...v,[y]:{...v[y],[j]:Q||null}}))},p=(y,j)=>{o(Q=>({...Q,[y]:j||null}))},b=(y,j)=>{l(Q=>({...Q,[y]:j||void 0}))},N=()=>{const y={...r,haemodynamicPressures:n,cardiacOutput:i,rhcData:A,patientData:c,calculations:m};e(y)};return t.jsx(Le,{children:t.jsx(se.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:s,children:t.jsxs(se.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},onClick:y=>y.stopPropagation(),className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(zs,{className:"w-5 h-5 text-blue-600"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Haemodynamic Data"})]}),t.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:t.jsx(nt,{className:"w-5 h-5 text-gray-500"})})]}),t.jsxs("div",{className:"px-6 py-6 space-y-6",children:[t.jsxs("section",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-2"}),"Haemodynamic Pressures"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Right Atrial (RA)"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"A-wave:"}),t.jsx("input",{type:"number",step:"0.1",value:n.ra.aWave||"",onChange:y=>g("ra","aWave",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"V-wave:"}),t.jsx("input",{type:"number",step:"0.1",value:n.ra.vWave||"",onChange:y=>g("ra","vWave",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"Mean:"}),t.jsx("input",{type:"number",step:"0.1",value:n.ra.mean||"",onChange:y=>g("ra","mean",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]})]}),t.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Normal: 2-8 mmHg"})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Right Ventricular (RV)"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"Systolic:"}),t.jsx("input",{type:"number",step:"0.1",value:n.rv.systolic||"",onChange:y=>g("rv","systolic",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"Diastolic:"}),t.jsx("input",{type:"number",step:"0.1",value:n.rv.diastolic||"",onChange:y=>g("rv","diastolic",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"RVEDP:"}),t.jsx("input",{type:"number",step:"0.1",value:n.rv.rvedp||"",onChange:y=>g("rv","rvedp",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]})]}),t.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Normal: 15-30/2-8 mmHg"})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pulmonary Artery (PA)"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"Systolic:"}),t.jsx("input",{type:"number",step:"0.1",value:n.pa.systolic||"",onChange:y=>g("pa","systolic",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"Diastolic:"}),t.jsx("input",{type:"number",step:"0.1",value:n.pa.diastolic||"",onChange:y=>g("pa","diastolic",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"Mean:"}),t.jsx("input",{type:"number",step:"0.1",value:n.pa.mean||"",onChange:y=>g("pa","mean",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]})]}),t.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Normal: 15-30/4-12 (9-18) mmHg"})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pulmonary Capillary Wedge Pressure (PCWP)"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"A-wave:"}),t.jsx("input",{type:"number",step:"0.1",value:n.pcwp.aWave||"",onChange:y=>g("pcwp","aWave",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"V-wave:"}),t.jsx("input",{type:"number",step:"0.1",value:n.pcwp.vWave||"",onChange:y=>g("pcwp","vWave",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-16",children:"Mean:"}),t.jsx("input",{type:"number",step:"0.1",value:n.pcwp.mean||"",onChange:y=>g("pcwp","mean",y.target.value),placeholder:"mmHg",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mmHg"})]})]}),t.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Normal: 6-15 mmHg"})]})]})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("span",{className:"w-2 h-2 bg-purple-500 rounded-full mr-2"}),"Cardiac Output Assessment"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[t.jsx("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:"Thermodilution Method"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-blue-700 w-12",children:"CO:"}),t.jsx("input",{type:"number",step:"0.1",value:i.thermodilution.co||"",onChange:y=>h("thermodilution","co",y.target.value),placeholder:"L/min",className:"flex-1 px-3 py-1.5 text-sm border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-blue-600",children:"L/min"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-blue-700 w-12",children:"CI:"}),t.jsx("input",{type:"number",step:"0.01",value:i.thermodilution.ci||"",onChange:y=>h("thermodilution","ci",y.target.value),placeholder:"L/min/m¬≤",className:"flex-1 px-3 py-1.5 text-sm border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-blue-600",children:"L/min/m¬≤"})]})]}),t.jsx("div",{className:"mt-2 text-xs text-blue-700",children:"Normal: 4-8 L/min, CI 2.5-4.0"})]}),t.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[t.jsx("label",{className:"block text-sm font-medium text-green-900 mb-2",children:"Fick Method"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-green-700 w-12",children:"CO:"}),t.jsx("input",{type:"number",step:"0.1",value:i.fick.co||"",onChange:y=>h("fick","co",y.target.value),placeholder:"L/min",className:"flex-1 px-3 py-1.5 text-sm border border-green-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-green-600",children:"L/min"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-green-700 w-12",children:"CI:"}),t.jsx("input",{type:"number",step:"0.01",value:i.fick.ci||"",onChange:y=>h("fick","ci",y.target.value),placeholder:"L/min/m¬≤",className:"flex-1 px-3 py-1.5 text-sm border border-green-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-green-600",children:"L/min/m¬≤"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Oxygen Saturations"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-24",children:"Mixed Venous:"}),t.jsx("input",{type:"number",step:"1",value:i.mixedVenousO2||"",onChange:y=>p("mixedVenousO2",y.target.value),placeholder:"%",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"%"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-24",children:"Wedge Sat:"}),t.jsx("input",{type:"number",step:"1",value:i.wedgeSaturation||"",onChange:y=>p("wedgeSaturation",y.target.value),placeholder:"%",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"%"})]})]}),t.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Normal Mixed Venous: 65-75%"})]})]})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Procedure Details"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Radiation & Contrast"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-24",children:"Fluoro Time:"}),t.jsx("input",{type:"number",step:"0.01",value:A.fluoroscopyTime||"",onChange:y=>b("fluoroscopyTime",y.target.value),placeholder:"minutes",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"min"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-24",children:"Fluoro Dose:"}),t.jsx("input",{type:"number",step:"1",value:A.fluoroscopyDose||"",onChange:y=>b("fluoroscopyDose",y.target.value),placeholder:"mGy",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mGy"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-24",children:"DAP:"}),t.jsx("input",{type:"number",step:"1",value:A.doseAreaProduct||"",onChange:y=>b("doseAreaProduct",y.target.value),placeholder:"Gy¬∑cm¬≤",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"Gy¬∑cm¬≤"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500 w-24",children:"Contrast:"}),t.jsx("input",{type:"number",step:"1",value:A.contrastVolume||"",onChange:y=>b("contrastVolume",y.target.value),placeholder:"mL",className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("span",{className:"text-xs text-gray-400",children:"mL"})]})]})]})})]}),t.jsxs("section",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-5",children:[t.jsxs("h3",{className:"text-lg font-semibold text-purple-900 mb-3 flex items-center",children:[t.jsx(Jt,{className:"w-5 h-5 mr-2 text-purple-600"}),"Calculated Haemodynamics (Live)"]}),t.jsx("p",{className:"text-xs text-purple-700 mb-4",children:"Auto-calculated from your inputs. Updates in real-time as you edit fields."}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[m.pulmonaryVascularResistance&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"PVR"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.pulmonaryVascularResistance.toFixed(1)}),t.jsx("div",{className:"text-xs text-gray-500",children:"WU (Normal: <3)"})]}),m.systemicVascularResistance&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"SVR"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.systemicVascularResistance.toFixed(1)}),t.jsx("div",{className:"text-xs text-gray-500",children:"WU (Normal: 10-20)"})]}),m.transpulmonaryGradient&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"TPG"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.transpulmonaryGradient.toFixed(0)}),t.jsx("div",{className:"text-xs text-gray-500",children:"mmHg (Normal: <12)"})]}),m.diastolicPressureGradient&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"DPG"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.diastolicPressureGradient.toFixed(0)}),t.jsx("div",{className:"text-xs text-gray-500",children:"mmHg (Normal: <7)"})]}),m.cardiacIndex&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"CI"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.cardiacIndex.toFixed(1)}),t.jsx("div",{className:"text-xs text-gray-500",children:"L/min/m¬≤ (2.5-4.0)"})]}),m.rvswi&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"RVSWI"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.rvswi.toFixed(1)}),t.jsx("div",{className:"text-xs text-gray-500",children:"g¬∑m/m¬≤ (5-10)"})]}),m.papi&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"PAPi"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.papi.toFixed(2)}),t.jsx("div",{className:"text-xs text-gray-500",children:"(Normal: >1.0)"})]}),m.cardiacPowerOutput&&t.jsxs("div",{className:"bg-white rounded-md p-3 shadow-sm",children:[t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"CPO"}),t.jsx("div",{className:"text-lg font-bold text-purple-900",children:m.cardiacPowerOutput.toFixed(2)}),t.jsx("div",{className:"text-xs text-gray-500",children:"W (Normal: ‚â•0.6)"})]})]}),Object.keys(m).length===0&&t.jsx("div",{className:"text-sm text-gray-600 italic text-center py-4",children:"Fill in pressure and cardiac output values above to see calculated haemodynamics"})]})]}),t.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Changes will be applied to the card export. Original data is preserved."}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),t.jsxs("button",{onClick:N,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center space-x-2",children:[t.jsx(gr,{className:"w-4 h-4"}),t.jsx("span",{children:"Apply Changes"})]})]})]})]})})})};var ho=function(r,e){return ho=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,n){s.__proto__=n}||function(s,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(s[a]=n[a])},ho(r,e)};function rr(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ho(r,e);function s(){this.constructor=r}r.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}var fo=function(){return fo=Object.assign||function(e){for(var s,n=1,a=arguments.length;n<a;n++){s=arguments[n];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},fo.apply(this,arguments)};function Bt(r,e,s,n){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function A(d){try{c(n.next(d))}catch(m){o(m)}}function l(d){try{c(n.throw(d))}catch(m){o(m)}}function c(d){d.done?i(d.value):a(d.value).then(A,l)}c((n=n.apply(r,[])).next())})}function ht(r,e){var s={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function A(c){return function(d){return l([c,d])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,a=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){s=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(c[0]===6&&s.label<i[1]){s.label=i[1],i=c;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(c);break}i[2]&&s.ops.pop(),s.trys.pop();continue}c=e.call(r,s)}catch(d){c=[6,d],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ra(r,e,s){if(arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||e)}var Ir=function(){function r(e,s,n,a){this.left=e,this.top=s,this.width=n,this.height=a}return r.prototype.add=function(e,s,n,a){return new r(this.left+e,this.top+s,this.width+n,this.height+a)},r.fromClientRect=function(e,s){return new r(s.left+e.windowBounds.left,s.top+e.windowBounds.top,s.width,s.height)},r.fromDOMRectList=function(e,s){var n=Array.from(s).find(function(a){return a.width!==0});return n?new r(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),ui=function(r,e){return Ir.fromClientRect(r,e.getBoundingClientRect())},Np=function(r){var e=r.body,s=r.documentElement;if(!e||!s)throw new Error("Unable to get document size");var n=Math.max(Math.max(e.scrollWidth,s.scrollWidth),Math.max(e.offsetWidth,s.offsetWidth),Math.max(e.clientWidth,s.clientWidth)),a=Math.max(Math.max(e.scrollHeight,s.scrollHeight),Math.max(e.offsetHeight,s.offsetHeight),Math.max(e.clientHeight,s.clientHeight));return new Ir(0,0,n,a)},mi=function(r){for(var e=[],s=0,n=r.length;s<n;){var a=r.charCodeAt(s++);if(a>=55296&&a<=56319&&s<n){var i=r.charCodeAt(s++);(i&64512)===56320?e.push(((a&1023)<<10)+(i&1023)+65536):(e.push(a),s--)}else e.push(a)}return e},Ye=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var s=r.length;if(!s)return"";for(var n=[],a=-1,i="";++a<s;){var o=r[a];o<=65535?n.push(o):(o-=65536,n.push((o>>10)+55296,o%1024+56320)),(a+1===s||n.length>16384)&&(i+=String.fromCharCode.apply(String,n),n.length=0)}return i},NA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jp=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var sa=0;sa<NA.length;sa++)jp[NA.charCodeAt(sa)]=sa;var jA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",gn=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var na=0;na<jA.length;na++)gn[jA.charCodeAt(na)]=na;var Sp=function(r){var e=r.length*.75,s=r.length,n,a=0,i,o,A,l;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var c=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),d=Array.isArray(c)?c:new Uint8Array(c);for(n=0;n<s;n+=4)i=gn[r.charCodeAt(n)],o=gn[r.charCodeAt(n+1)],A=gn[r.charCodeAt(n+2)],l=gn[r.charCodeAt(n+3)],d[a++]=i<<2|o>>4,d[a++]=(o&15)<<4|A>>2,d[a++]=(A&3)<<6|l&63;return c},Ep=function(r){for(var e=r.length,s=[],n=0;n<e;n+=2)s.push(r[n+1]<<8|r[n]);return s},Fp=function(r){for(var e=r.length,s=[],n=0;n<e;n+=4)s.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return s},ls=5,tA=11,Fi=2,Qp=tA-ls,sd=65536>>ls,Ip=1<<ls,Qi=Ip-1,Up=1024>>ls,Tp=sd+Up,kp=Tp,Pp=32,Dp=kp+Pp,Rp=65536>>tA,Mp=1<<Qp,Hp=Mp-1,SA=function(r,e,s){return r.slice?r.slice(e,s):new Uint16Array(Array.prototype.slice.call(r,e,s))},Lp=function(r,e,s){return r.slice?r.slice(e,s):new Uint32Array(Array.prototype.slice.call(r,e,s))},Op=function(r,e){var s=Sp(r),n=Array.isArray(s)?Fp(s):new Uint32Array(s),a=Array.isArray(s)?Ep(s):new Uint16Array(s),i=24,o=SA(a,i/2,n[4]/2),A=n[5]===2?SA(a,(i+n[4])/2):Lp(n,Math.ceil((i+n[4])/4));return new _p(n[0],n[1],n[2],n[3],o,A)},_p=function(){function r(e,s,n,a,i,o){this.initialValue=e,this.errorValue=s,this.highStart=n,this.highValueIndex=a,this.index=i,this.data=o}return r.prototype.get=function(e){var s;if(e>=0){if(e<55296||e>56319&&e<=65535)return s=this.index[e>>ls],s=(s<<Fi)+(e&Qi),this.data[s];if(e<=65535)return s=this.index[sd+(e-55296>>ls)],s=(s<<Fi)+(e&Qi),this.data[s];if(e<this.highStart)return s=Dp-Rp+(e>>tA),s=this.index[s],s+=e>>ls&Hp,s=this.index[s],s=(s<<Fi)+(e&Qi),this.data[s];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),EA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$p=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var aa=0;aa<EA.length;aa++)$p[EA.charCodeAt(aa)]=aa;var Kp="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",FA=50,Vp=1,nd=2,ad=3,Gp=4,Wp=5,QA=7,id=8,IA=9,Or=10,xo=11,UA=12,bo=13,zp=14,hn=15,yo=16,ia=17,nn=18,Xp=19,TA=20,vo=21,an=22,Ii=23,gs=24,Tt=25,fn=26,xn=27,hs=28,qp=29,ss=30,Yp=31,oa=32,Aa=33,wo=34,Bo=35,Co=36,Mn=37,No=38,Ma=39,Ha=40,Ui=41,od=42,Jp=43,Zp=[9001,65288],Ad="!",Se="√ó",la="√∑",jo=Op(Kp),vr=[ss,Co],So=[Vp,nd,ad,Wp],ld=[Or,id],kA=[xn,fn],eg=So.concat(ld),PA=[No,Ma,Ha,wo,Bo],tg=[hn,bo],rg=function(r,e){e===void 0&&(e="strict");var s=[],n=[],a=[];return r.forEach(function(i,o){var A=jo.get(i);if(A>FA?(a.push(!0),A-=FA):a.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(i)!==-1)return n.push(o),s.push(yo);if(A===Gp||A===xo){if(o===0)return n.push(o),s.push(ss);var l=s[o-1];return eg.indexOf(l)===-1?(n.push(n[o-1]),s.push(l)):(n.push(o),s.push(ss))}if(n.push(o),A===Yp)return s.push(e==="strict"?vo:Mn);if(A===od||A===qp)return s.push(ss);if(A===Jp)return i>=131072&&i<=196605||i>=196608&&i<=262141?s.push(Mn):s.push(ss);s.push(A)}),[n,s,a]},Ti=function(r,e,s,n){var a=n[s];if(Array.isArray(r)?r.indexOf(a)!==-1:r===a)for(var i=s;i<=n.length;){i++;var o=n[i];if(o===e)return!0;if(o!==Or)break}if(a===Or)for(var i=s;i>0;){i--;var A=n[i];if(Array.isArray(r)?r.indexOf(A)!==-1:r===A)for(var l=s;l<=n.length;){l++;var o=n[l];if(o===e)return!0;if(o!==Or)break}if(A!==Or)break}return!1},DA=function(r,e){for(var s=r;s>=0;){var n=e[s];if(n===Or)s--;else return n}return 0},sg=function(r,e,s,n,a){if(s[n]===0)return Se;var i=n-1;if(Array.isArray(a)&&a[i]===!0)return Se;var o=i-1,A=i+1,l=e[i],c=o>=0?e[o]:0,d=e[A];if(l===nd&&d===ad)return Se;if(So.indexOf(l)!==-1)return Ad;if(So.indexOf(d)!==-1||ld.indexOf(d)!==-1)return Se;if(DA(i,e)===id)return la;if(jo.get(r[i])===xo||(l===oa||l===Aa)&&jo.get(r[A])===xo||l===QA||d===QA||l===IA||[Or,bo,hn].indexOf(l)===-1&&d===IA||[ia,nn,Xp,gs,hs].indexOf(d)!==-1||DA(i,e)===an||Ti(Ii,an,i,e)||Ti([ia,nn],vo,i,e)||Ti(UA,UA,i,e))return Se;if(l===Or)return la;if(l===Ii||d===Ii)return Se;if(d===yo||l===yo)return la;if([bo,hn,vo].indexOf(d)!==-1||l===zp||c===Co&&tg.indexOf(l)!==-1||l===hs&&d===Co||d===TA||vr.indexOf(d)!==-1&&l===Tt||vr.indexOf(l)!==-1&&d===Tt||l===xn&&[Mn,oa,Aa].indexOf(d)!==-1||[Mn,oa,Aa].indexOf(l)!==-1&&d===fn||vr.indexOf(l)!==-1&&kA.indexOf(d)!==-1||kA.indexOf(l)!==-1&&vr.indexOf(d)!==-1||[xn,fn].indexOf(l)!==-1&&(d===Tt||[an,hn].indexOf(d)!==-1&&e[A+1]===Tt)||[an,hn].indexOf(l)!==-1&&d===Tt||l===Tt&&[Tt,hs,gs].indexOf(d)!==-1)return Se;if([Tt,hs,gs,ia,nn].indexOf(d)!==-1)for(var m=i;m>=0;){var g=e[m];if(g===Tt)return Se;if([hs,gs].indexOf(g)!==-1)m--;else break}if([xn,fn].indexOf(d)!==-1)for(var m=[ia,nn].indexOf(l)!==-1?o:i;m>=0;){var g=e[m];if(g===Tt)return Se;if([hs,gs].indexOf(g)!==-1)m--;else break}if(No===l&&[No,Ma,wo,Bo].indexOf(d)!==-1||[Ma,wo].indexOf(l)!==-1&&[Ma,Ha].indexOf(d)!==-1||[Ha,Bo].indexOf(l)!==-1&&d===Ha||PA.indexOf(l)!==-1&&[TA,fn].indexOf(d)!==-1||PA.indexOf(d)!==-1&&l===xn||vr.indexOf(l)!==-1&&vr.indexOf(d)!==-1||l===gs&&vr.indexOf(d)!==-1||vr.concat(Tt).indexOf(l)!==-1&&d===an&&Zp.indexOf(r[A])===-1||vr.concat(Tt).indexOf(d)!==-1&&l===nn)return Se;if(l===Ui&&d===Ui){for(var h=s[i],p=1;h>0&&(h--,e[h]===Ui);)p++;if(p%2!==0)return Se}return l===oa&&d===Aa?Se:la},ng=function(r,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var s=rg(r,e.lineBreak),n=s[0],a=s[1],i=s[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(a=a.map(function(A){return[Tt,ss,od].indexOf(A)!==-1?Mn:A}));var o=e.wordBreak==="keep-all"?i.map(function(A,l){return A&&r[l]>=19968&&r[l]<=40959}):void 0;return[n,a,o]},ag=function(){function r(e,s,n,a){this.codePoints=e,this.required=s===Ad,this.start=n,this.end=a}return r.prototype.slice=function(){return Ye.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),ig=function(r,e){var s=mi(r),n=ng(s,e),a=n[0],i=n[1],o=n[2],A=s.length,l=0,c=0;return{next:function(){if(c>=A)return{done:!0,value:null};for(var d=Se;c<A&&(d=sg(s,i,a,++c,o))===Se;);if(d!==Se||c===A){var m=new ag(s,d,l,c);return l=c,{value:m,done:!1}}return{done:!0,value:null}}}},og=1,Ag=2,$n=4,RA=8,za=10,MA=47,Qn=92,lg=9,cg=32,ca=34,on=61,dg=35,ug=36,mg=37,da=39,ua=40,An=41,pg=95,St=45,gg=33,hg=60,fg=62,xg=64,bg=91,yg=93,vg=61,wg=123,ma=63,Bg=125,HA=124,Cg=126,Ng=128,LA=65533,ki=42,as=43,jg=44,Sg=58,Eg=59,Hn=46,Fg=0,Qg=8,Ig=11,Ug=14,Tg=31,kg=127,lr=-1,cd=48,dd=97,ud=101,Pg=102,Dg=117,Rg=122,md=65,pd=69,gd=70,Mg=85,Hg=90,bt=function(r){return r>=cd&&r<=57},Lg=function(r){return r>=55296&&r<=57343},fs=function(r){return bt(r)||r>=md&&r<=gd||r>=dd&&r<=Pg},Og=function(r){return r>=dd&&r<=Rg},_g=function(r){return r>=md&&r<=Hg},$g=function(r){return Og(r)||_g(r)},Kg=function(r){return r>=Ng},pa=function(r){return r===za||r===lg||r===cg},Xa=function(r){return $g(r)||Kg(r)||r===pg},OA=function(r){return Xa(r)||bt(r)||r===St},Vg=function(r){return r>=Fg&&r<=Qg||r===Ig||r>=Ug&&r<=Tg||r===kg},Mr=function(r,e){return r!==Qn?!1:e!==za},ga=function(r,e,s){return r===St?Xa(e)||Mr(e,s):Xa(r)?!0:!!(r===Qn&&Mr(r,e))},Pi=function(r,e,s){return r===as||r===St?bt(e)?!0:e===Hn&&bt(s):bt(r===Hn?e:r)},Gg=function(r){var e=0,s=1;(r[e]===as||r[e]===St)&&(r[e]===St&&(s=-1),e++);for(var n=[];bt(r[e]);)n.push(r[e++]);var a=n.length?parseInt(Ye.apply(void 0,n),10):0;r[e]===Hn&&e++;for(var i=[];bt(r[e]);)i.push(r[e++]);var o=i.length,A=o?parseInt(Ye.apply(void 0,i),10):0;(r[e]===pd||r[e]===ud)&&e++;var l=1;(r[e]===as||r[e]===St)&&(r[e]===St&&(l=-1),e++);for(var c=[];bt(r[e]);)c.push(r[e++]);var d=c.length?parseInt(Ye.apply(void 0,c),10):0;return s*(a+A*Math.pow(10,-o))*Math.pow(10,l*d)},Wg={type:2},zg={type:3},Xg={type:4},qg={type:13},Yg={type:8},Jg={type:21},Zg={type:9},eh={type:10},th={type:11},rh={type:12},sh={type:14},ha={type:23},nh={type:1},ah={type:25},ih={type:24},oh={type:26},Ah={type:27},lh={type:28},ch={type:29},dh={type:31},Eo={type:32},hd=function(){function r(){this._value=[]}return r.prototype.write=function(e){this._value=this._value.concat(mi(e))},r.prototype.read=function(){for(var e=[],s=this.consumeToken();s!==Eo;)e.push(s),s=this.consumeToken();return e},r.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case ca:return this.consumeStringToken(ca);case dg:var s=this.peekCodePoint(0),n=this.peekCodePoint(1),a=this.peekCodePoint(2);if(OA(s)||Mr(n,a)){var i=ga(s,n,a)?Ag:og,o=this.consumeName();return{type:5,value:o,flags:i}}break;case ug:if(this.peekCodePoint(0)===on)return this.consumeCodePoint(),qg;break;case da:return this.consumeStringToken(da);case ua:return Wg;case An:return zg;case ki:if(this.peekCodePoint(0)===on)return this.consumeCodePoint(),sh;break;case as:if(Pi(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case jg:return Xg;case St:var A=e,l=this.peekCodePoint(0),c=this.peekCodePoint(1);if(Pi(A,l,c))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(ga(A,l,c))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(l===St&&c===fg)return this.consumeCodePoint(),this.consumeCodePoint(),ih;break;case Hn:if(Pi(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case MA:if(this.peekCodePoint(0)===ki)for(this.consumeCodePoint();;){var d=this.consumeCodePoint();if(d===ki&&(d=this.consumeCodePoint(),d===MA))return this.consumeToken();if(d===lr)return this.consumeToken()}break;case Sg:return oh;case Eg:return Ah;case hg:if(this.peekCodePoint(0)===gg&&this.peekCodePoint(1)===St&&this.peekCodePoint(2)===St)return this.consumeCodePoint(),this.consumeCodePoint(),ah;break;case xg:var m=this.peekCodePoint(0),g=this.peekCodePoint(1),h=this.peekCodePoint(2);if(ga(m,g,h)){var o=this.consumeName();return{type:7,value:o}}break;case bg:return lh;case Qn:if(Mr(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case yg:return ch;case vg:if(this.peekCodePoint(0)===on)return this.consumeCodePoint(),Yg;break;case wg:return th;case Bg:return rh;case Dg:case Mg:var p=this.peekCodePoint(0),b=this.peekCodePoint(1);return p===as&&(fs(b)||b===ma)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case HA:if(this.peekCodePoint(0)===on)return this.consumeCodePoint(),Zg;if(this.peekCodePoint(0)===HA)return this.consumeCodePoint(),Jg;break;case Cg:if(this.peekCodePoint(0)===on)return this.consumeCodePoint(),eh;break;case lr:return Eo}return pa(e)?(this.consumeWhiteSpace(),dh):bt(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):Xa(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Ye(e)}},r.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},r.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},r.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},r.prototype.consumeUnicodeRangeToken=function(){for(var e=[],s=this.consumeCodePoint();fs(s)&&e.length<6;)e.push(s),s=this.consumeCodePoint();for(var n=!1;s===ma&&e.length<6;)e.push(s),s=this.consumeCodePoint(),n=!0;if(n){var a=parseInt(Ye.apply(void 0,e.map(function(l){return l===ma?cd:l})),16),i=parseInt(Ye.apply(void 0,e.map(function(l){return l===ma?gd:l})),16);return{type:30,start:a,end:i}}var o=parseInt(Ye.apply(void 0,e),16);if(this.peekCodePoint(0)===St&&fs(this.peekCodePoint(1))){this.consumeCodePoint(),s=this.consumeCodePoint();for(var A=[];fs(s)&&A.length<6;)A.push(s),s=this.consumeCodePoint();var i=parseInt(Ye.apply(void 0,A),16);return{type:30,start:o,end:i}}else return{type:30,start:o,end:o}},r.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===ua?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===ua?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},r.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===lr)return{type:22,value:""};var s=this.peekCodePoint(0);if(s===da||s===ca){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===lr||this.peekCodePoint(0)===An)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),ha)}for(;;){var a=this.consumeCodePoint();if(a===lr||a===An)return{type:22,value:Ye.apply(void 0,e)};if(pa(a))return this.consumeWhiteSpace(),this.peekCodePoint(0)===lr||this.peekCodePoint(0)===An?(this.consumeCodePoint(),{type:22,value:Ye.apply(void 0,e)}):(this.consumeBadUrlRemnants(),ha);if(a===ca||a===da||a===ua||Vg(a))return this.consumeBadUrlRemnants(),ha;if(a===Qn)if(Mr(a,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),ha;else e.push(a)}},r.prototype.consumeWhiteSpace=function(){for(;pa(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===An||e===lr)return;Mr(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(e){for(var s=5e4,n="";e>0;){var a=Math.min(s,e);n+=Ye.apply(void 0,this._value.splice(0,a)),e-=a}return this._value.shift(),n},r.prototype.consumeStringToken=function(e){var s="",n=0;do{var a=this._value[n];if(a===lr||a===void 0||a===e)return s+=this.consumeStringSlice(n),{type:0,value:s};if(a===za)return this._value.splice(0,n),nh;if(a===Qn){var i=this._value[n+1];i!==lr&&i!==void 0&&(i===za?(s+=this.consumeStringSlice(n),n=-1,this._value.shift()):Mr(a,i)&&(s+=this.consumeStringSlice(n),s+=Ye(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var e=[],s=$n,n=this.peekCodePoint(0);for((n===as||n===St)&&e.push(this.consumeCodePoint());bt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var a=this.peekCodePoint(1);if(n===Hn&&bt(a))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),s=RA;bt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),a=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((n===pd||n===ud)&&((a===as||a===St)&&bt(i)||bt(a)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),s=RA;bt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[Gg(e),s]},r.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),s=e[0],n=e[1],a=this.peekCodePoint(0),i=this.peekCodePoint(1),o=this.peekCodePoint(2);if(ga(a,i,o)){var A=this.consumeName();return{type:15,number:s,flags:n,unit:A}}return a===mg?(this.consumeCodePoint(),{type:16,number:s,flags:n}):{type:17,number:s,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(fs(e)){for(var s=Ye(e);fs(this.peekCodePoint(0))&&s.length<6;)s+=Ye(this.consumeCodePoint());pa(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(s,16);return n===0||Lg(n)||n>1114111?LA:n}return e===lr?LA:e},r.prototype.consumeName=function(){for(var e="";;){var s=this.consumeCodePoint();if(OA(s))e+=Ye(s);else if(Mr(s,this.peekCodePoint(0)))e+=Ye(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(s),e}},r}(),fd=function(){function r(e){this._tokens=e}return r.create=function(e){var s=new hd;return s.write(e),new r(s.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var s=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return s;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var s=this.consumeComponentValue();if(s.type===32)return e;e.push(s),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var s={type:e,values:[]},n=this.consumeToken();;){if(n.type===32||mh(n,e))return s;this.reconsumeToken(n),s.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var s={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return s;this.reconsumeToken(n),s.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?Eo:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r}(),Kn=function(r){return r.type===15},Xs=function(r){return r.type===17},Me=function(r){return r.type===20},uh=function(r){return r.type===0},Fo=function(r,e){return Me(r)&&r.value===e},xd=function(r){return r.type!==31},Gs=function(r){return r.type!==31&&r.type!==4},fr=function(r){var e=[],s=[];return r.forEach(function(n){if(n.type===4){if(s.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(s),s=[];return}n.type!==31&&s.push(n)}),s.length&&e.push(s),e},mh=function(r,e){return e===11&&r.type===12||e===28&&r.type===29?!0:e===2&&r.type===3},Yr=function(r){return r.type===17||r.type===15},et=function(r){return r.type===16||Yr(r)},bd=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},ut={type:17,number:0,flags:$n},rA={type:16,number:50,flags:$n},_r={type:16,number:100,flags:$n},bn=function(r,e,s){var n=r[0],a=r[1];return[Oe(n,e),Oe(typeof a<"u"?a:n,s)]},Oe=function(r,e){if(r.type===16)return r.number/100*e;if(Kn(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},yd="deg",vd="grad",wd="rad",Bd="turn",pi={name:"angle",parse:function(r,e){if(e.type===15)switch(e.unit){case yd:return Math.PI*e.number/180;case vd:return Math.PI/200*e.number;case wd:return e.number;case Bd:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},Cd=function(r){return r.type===15&&(r.unit===yd||r.unit===vd||r.unit===wd||r.unit===Bd)},Nd=function(r){var e=r.filter(Me).map(function(s){return s.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ut,ut];case"to top":case"bottom":return _t(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ut,_r];case"to right":case"left":return _t(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[_r,_r];case"to bottom":case"top":return _t(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[_r,ut];case"to left":case"right":return _t(270)}return 0},_t=function(r){return Math.PI*r/180},zr={name:"color",parse:function(r,e){if(e.type===18){var s=ph[e.name];if(typeof s>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return s(r,e.values)}if(e.type===5){if(e.value.length===3){var n=e.value.substring(0,1),a=e.value.substring(1,2),i=e.value.substring(2,3);return $r(parseInt(n+n,16),parseInt(a+a,16),parseInt(i+i,16),1)}if(e.value.length===4){var n=e.value.substring(0,1),a=e.value.substring(1,2),i=e.value.substring(2,3),o=e.value.substring(3,4);return $r(parseInt(n+n,16),parseInt(a+a,16),parseInt(i+i,16),parseInt(o+o,16)/255)}if(e.value.length===6){var n=e.value.substring(0,2),a=e.value.substring(2,4),i=e.value.substring(4,6);return $r(parseInt(n,16),parseInt(a,16),parseInt(i,16),1)}if(e.value.length===8){var n=e.value.substring(0,2),a=e.value.substring(2,4),i=e.value.substring(4,6),o=e.value.substring(6,8);return $r(parseInt(n,16),parseInt(a,16),parseInt(i,16),parseInt(o,16)/255)}}if(e.type===20){var A=Sr[e.value.toUpperCase()];if(typeof A<"u")return A}return Sr.TRANSPARENT}},Xr=function(r){return(255&r)===0},it=function(r){var e=255&r,s=255&r>>8,n=255&r>>16,a=255&r>>24;return e<255?"rgba("+a+","+n+","+s+","+e/255+")":"rgb("+a+","+n+","+s+")"},$r=function(r,e,s,n){return(r<<24|e<<16|s<<8|Math.round(n*255)<<0)>>>0},_A=function(r,e){if(r.type===17)return r.number;if(r.type===16){var s=e===3?1:255;return e===3?r.number/100*s:Math.round(r.number/100*s)}return 0},$A=function(r,e){var s=e.filter(Gs);if(s.length===3){var n=s.map(_A),a=n[0],i=n[1],o=n[2];return $r(a,i,o,1)}if(s.length===4){var A=s.map(_A),a=A[0],i=A[1],o=A[2],l=A[3];return $r(a,i,o,l)}return 0};function Di(r,e,s){return s<0&&(s+=1),s>=1&&(s-=1),s<1/6?(e-r)*s*6+r:s<1/2?e:s<2/3?(e-r)*6*(2/3-s)+r:r}var KA=function(r,e){var s=e.filter(Gs),n=s[0],a=s[1],i=s[2],o=s[3],A=(n.type===17?_t(n.number):pi.parse(r,n))/(Math.PI*2),l=et(a)?a.number/100:0,c=et(i)?i.number/100:0,d=typeof o<"u"&&et(o)?Oe(o,1):1;if(l===0)return $r(c*255,c*255,c*255,1);var m=c<=.5?c*(l+1):c+l-c*l,g=c*2-m,h=Di(g,m,A+1/3),p=Di(g,m,A),b=Di(g,m,A-1/3);return $r(h*255,p*255,b*255,d)},ph={hsl:KA,hsla:KA,rgb:$A,rgba:$A},In=function(r,e){return zr.parse(r,fd.create(e).parseComponentValue())},Sr={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},gh={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(s){if(Me(s))switch(s.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},hh={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},gi=function(r,e){var s=zr.parse(r,e[0]),n=e[1];return n&&et(n)?{color:s,stop:n}:{color:s,stop:null}},VA=function(r,e){var s=r[0],n=r[r.length-1];s.stop===null&&(s.stop=ut),n.stop===null&&(n.stop=_r);for(var a=[],i=0,o=0;o<r.length;o++){var A=r[o].stop;if(A!==null){var l=Oe(A,e);l>i?a.push(l):a.push(i),i=l}else a.push(null)}for(var c=null,o=0;o<a.length;o++){var d=a[o];if(d===null)c===null&&(c=o);else if(c!==null){for(var m=o-c,g=a[c-1],h=(d-g)/(m+1),p=1;p<=m;p++)a[c+p-1]=h*p;c=null}}return r.map(function(b,N){var y=b.color;return{color:y,stop:Math.max(Math.min(1,a[N]/e),0)}})},fh=function(r,e,s){var n=e/2,a=s/2,i=Oe(r[0],e)-n,o=a-Oe(r[1],s);return(Math.atan2(o,i)+Math.PI*2)%(Math.PI*2)},xh=function(r,e,s){var n=typeof r=="number"?r:fh(r,e,s),a=Math.abs(e*Math.sin(n))+Math.abs(s*Math.cos(n)),i=e/2,o=s/2,A=a/2,l=Math.sin(n-Math.PI/2)*A,c=Math.cos(n-Math.PI/2)*A;return[a,i-c,i+c,o-l,o+l]},Wt=function(r,e){return Math.sqrt(r*r+e*e)},GA=function(r,e,s,n,a){var i=[[0,0],[0,e],[r,0],[r,e]];return i.reduce(function(o,A){var l=A[0],c=A[1],d=Wt(s-l,n-c);return(a?d<o.optimumDistance:d>o.optimumDistance)?{optimumCorner:A,optimumDistance:d}:o},{optimumDistance:a?1/0:-1/0,optimumCorner:null}).optimumCorner},bh=function(r,e,s,n,a){var i=0,o=0;switch(r.size){case 0:r.shape===0?i=o=Math.min(Math.abs(e),Math.abs(e-n),Math.abs(s),Math.abs(s-a)):r.shape===1&&(i=Math.min(Math.abs(e),Math.abs(e-n)),o=Math.min(Math.abs(s),Math.abs(s-a)));break;case 2:if(r.shape===0)i=o=Math.min(Wt(e,s),Wt(e,s-a),Wt(e-n,s),Wt(e-n,s-a));else if(r.shape===1){var A=Math.min(Math.abs(s),Math.abs(s-a))/Math.min(Math.abs(e),Math.abs(e-n)),l=GA(n,a,e,s,!0),c=l[0],d=l[1];i=Wt(c-e,(d-s)/A),o=A*i}break;case 1:r.shape===0?i=o=Math.max(Math.abs(e),Math.abs(e-n),Math.abs(s),Math.abs(s-a)):r.shape===1&&(i=Math.max(Math.abs(e),Math.abs(e-n)),o=Math.max(Math.abs(s),Math.abs(s-a)));break;case 3:if(r.shape===0)i=o=Math.max(Wt(e,s),Wt(e,s-a),Wt(e-n,s),Wt(e-n,s-a));else if(r.shape===1){var A=Math.max(Math.abs(s),Math.abs(s-a))/Math.max(Math.abs(e),Math.abs(e-n)),m=GA(n,a,e,s,!1),c=m[0],d=m[1];i=Wt(c-e,(d-s)/A),o=A*i}break}return Array.isArray(r.size)&&(i=Oe(r.size[0],n),o=r.size.length===2?Oe(r.size[1],a):i),[i,o]},yh=function(r,e){var s=_t(180),n=[];return fr(e).forEach(function(a,i){if(i===0){var o=a[0];if(o.type===20&&o.value==="to"){s=Nd(a);return}else if(Cd(o)){s=pi.parse(r,o);return}}var A=gi(r,a);n.push(A)}),{angle:s,stops:n,type:1}},fa=function(r,e){var s=_t(180),n=[];return fr(e).forEach(function(a,i){if(i===0){var o=a[0];if(o.type===20&&["top","left","right","bottom"].indexOf(o.value)!==-1){s=Nd(a);return}else if(Cd(o)){s=(pi.parse(r,o)+_t(270))%_t(360);return}}var A=gi(r,a);n.push(A)}),{angle:s,stops:n,type:1}},vh=function(r,e){var s=_t(180),n=[],a=1,i=0,o=3,A=[];return fr(e).forEach(function(l,c){var d=l[0];if(c===0){if(Me(d)&&d.value==="linear"){a=1;return}else if(Me(d)&&d.value==="radial"){a=2;return}}if(d.type===18){if(d.name==="from"){var m=zr.parse(r,d.values[0]);n.push({stop:ut,color:m})}else if(d.name==="to"){var m=zr.parse(r,d.values[0]);n.push({stop:_r,color:m})}else if(d.name==="color-stop"){var g=d.values.filter(Gs);if(g.length===2){var m=zr.parse(r,g[1]),h=g[0];Xs(h)&&n.push({stop:{type:16,number:h.number*100,flags:h.flags},color:m})}}}}),a===1?{angle:(s+_t(180))%_t(360),stops:n,type:a}:{size:o,shape:i,stops:n,position:A,type:a}},jd="closest-side",Sd="farthest-side",Ed="closest-corner",Fd="farthest-corner",Qd="circle",Id="ellipse",Ud="cover",Td="contain",wh=function(r,e){var s=0,n=3,a=[],i=[];return fr(e).forEach(function(o,A){var l=!0;if(A===0){var c=!1;l=o.reduce(function(m,g){if(c)if(Me(g))switch(g.value){case"center":return i.push(rA),m;case"top":case"left":return i.push(ut),m;case"right":case"bottom":return i.push(_r),m}else(et(g)||Yr(g))&&i.push(g);else if(Me(g))switch(g.value){case Qd:return s=0,!1;case Id:return s=1,!1;case"at":return c=!0,!1;case jd:return n=0,!1;case Ud:case Sd:return n=1,!1;case Td:case Ed:return n=2,!1;case Fd:return n=3,!1}else if(Yr(g)||et(g))return Array.isArray(n)||(n=[]),n.push(g),!1;return m},l)}if(l){var d=gi(r,o);a.push(d)}}),{size:n,shape:s,stops:a,position:i,type:2}},xa=function(r,e){var s=0,n=3,a=[],i=[];return fr(e).forEach(function(o,A){var l=!0;if(A===0?l=o.reduce(function(d,m){if(Me(m))switch(m.value){case"center":return i.push(rA),!1;case"top":case"left":return i.push(ut),!1;case"right":case"bottom":return i.push(_r),!1}else if(et(m)||Yr(m))return i.push(m),!1;return d},l):A===1&&(l=o.reduce(function(d,m){if(Me(m))switch(m.value){case Qd:return s=0,!1;case Id:return s=1,!1;case Td:case jd:return n=0,!1;case Sd:return n=1,!1;case Ed:return n=2,!1;case Ud:case Fd:return n=3,!1}else if(Yr(m)||et(m))return Array.isArray(n)||(n=[]),n.push(m),!1;return d},l)),l){var c=gi(r,o);a.push(c)}}),{size:n,shape:s,stops:a,position:i,type:2}},Bh=function(r){return r.type===1},Ch=function(r){return r.type===2},sA={name:"image",parse:function(r,e){if(e.type===22){var s={url:e.value,type:0};return r.cache.addImage(e.value),s}if(e.type===18){var n=kd[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return n(r,e.values)}throw new Error("Unsupported image type "+e.type)}};function Nh(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!kd[r.name])}var kd={"linear-gradient":yh,"-moz-linear-gradient":fa,"-ms-linear-gradient":fa,"-o-linear-gradient":fa,"-webkit-linear-gradient":fa,"radial-gradient":wh,"-moz-radial-gradient":xa,"-ms-radial-gradient":xa,"-o-radial-gradient":xa,"-webkit-radial-gradient":xa,"-webkit-gradient":vh},jh={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var s=e[0];return s.type===20&&s.value==="none"?[]:e.filter(function(n){return Gs(n)&&Nh(n)}).map(function(n){return sA.parse(r,n)})}},Sh={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(s){if(Me(s))switch(s.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Eh={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,e){return fr(e).map(function(s){return s.filter(et)}).map(bd)}},Fh={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,e){return fr(e).map(function(s){return s.filter(Me).map(function(n){return n.value}).join(" ")}).map(Qh)}},Qh=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},$s;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})($s||($s={}));var Ih={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,e){return fr(e).map(function(s){return s.filter(Uh)})}},Uh=function(r){return Me(r)||et(r)},hi=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Th=hi("top"),kh=hi("right"),Ph=hi("bottom"),Dh=hi("left"),fi=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(e,s){return bd(s.filter(et))}}},Rh=fi("top-left"),Mh=fi("top-right"),Hh=fi("bottom-right"),Lh=fi("bottom-left"),xi=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,s){switch(s){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Oh=xi("top"),_h=xi("right"),$h=xi("bottom"),Kh=xi("left"),bi=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,s){return Kn(s)?s.number:0}}},Vh=bi("top"),Gh=bi("right"),Wh=bi("bottom"),zh=bi("left"),Xh={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},qh={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},Yh={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,e){return e.filter(Me).reduce(function(s,n){return s|Jh(n.value)},0)}},Jh=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Zh={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},ef={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},qa;(function(r){r.NORMAL="normal",r.STRICT="strict"})(qa||(qa={}));var tf={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"strict":return qa.STRICT;case"normal":default:return qa.NORMAL}}},rf={name:"line-height",initialValue:"normal",prefix:!1,type:4},WA=function(r,e){return Me(r)&&r.value==="normal"?1.2*e:r.type===17?e*r.number:et(r)?Oe(r,e):e},sf={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,e){return e.type===20&&e.value==="none"?null:sA.parse(r,e)}},nf={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},Qo={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},yi=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},af=yi("top"),of=yi("right"),Af=yi("bottom"),lf=yi("left"),cf={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,e){return e.filter(Me).map(function(s){switch(s.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},df={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},vi=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},uf=vi("top"),mf=vi("right"),pf=vi("bottom"),gf=vi("left"),hf={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},ff={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},xf={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&Fo(e[0],"none")?[]:fr(e).map(function(s){for(var n={color:Sr.TRANSPARENT,offsetX:ut,offsetY:ut,blur:ut},a=0,i=0;i<s.length;i++){var o=s[i];Yr(o)?(a===0?n.offsetX=o:a===1?n.offsetY=o:n.blur=o,a++):n.color=zr.parse(r,o)}return n})}},bf={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},yf={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var s=Bf[e.name];if(typeof s>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return s(e.values)}return null}},vf=function(r){var e=r.filter(function(s){return s.type===17}).map(function(s){return s.number});return e.length===6?e:null},wf=function(r){var e=r.filter(function(l){return l.type===17}).map(function(l){return l.number}),s=e[0],n=e[1];e[2],e[3];var a=e[4],i=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var o=e[12],A=e[13];return e[14],e[15],e.length===16?[s,n,a,i,o,A]:null},Bf={matrix:vf,matrix3d:wf},zA={type:16,number:50,flags:$n},Cf=[zA,zA],Nf={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,e){var s=e.filter(et);return s.length!==2?Cf:[s[0],s[1]]}},jf={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Un;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(Un||(Un={}));var Sf={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-all":return Un.BREAK_ALL;case"keep-all":return Un.KEEP_ALL;case"normal":default:return Un.NORMAL}}},Ef={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,e){if(e.type===20)return{auto:!0,order:0};if(Xs(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Pd={name:"time",parse:function(r,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},Ff={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,e){return Xs(e)?e.number:1}},Qf={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},If={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,e){return e.filter(Me).map(function(s){switch(s.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(s){return s!==0})}},Uf={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,e){var s=[],n=[];return e.forEach(function(a){switch(a.type){case 20:case 0:s.push(a.value);break;case 17:s.push(a.number.toString());break;case 4:n.push(s.join(" ")),s.length=0;break}}),s.length&&n.push(s.join(" ")),n.map(function(a){return a.indexOf(" ")===-1?a:"'"+a+"'"})}},Tf={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},kf={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,e){if(Xs(e))return e.number;if(Me(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},Pf={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.filter(Me).map(function(s){return s.value})}},Df={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},st=function(r,e){return(r&e)!==0},Rf={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var s=e[0];return s.type===20&&s.value==="none"?[]:e}},Mf={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var s=e[0];if(s.type===20&&s.value==="none")return null;for(var n=[],a=e.filter(xd),i=0;i<a.length;i++){var o=a[i],A=a[i+1];if(o.type===20){var l=A&&Xs(A)?A.number:1;n.push({counter:o.value,increment:l})}}return n}},Hf={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return[];for(var s=[],n=e.filter(xd),a=0;a<n.length;a++){var i=n[a],o=n[a+1];if(Me(i)&&i.value!=="none"){var A=o&&Xs(o)?o.number:0;s.push({counter:i.value,reset:A})}}return s}},Lf={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,e){return e.filter(Kn).map(function(s){return Pd.parse(r,s)})}},Of={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var s=e[0];if(s.type===20&&s.value==="none")return null;var n=[],a=e.filter(uh);if(a.length%2!==0)return null;for(var i=0;i<a.length;i+=2){var o=a[i].value,A=a[i+1].value;n.push({open:o,close:A})}return n}},XA=function(r,e,s){if(!r)return"";var n=r[Math.min(e,r.length-1)];return n?s?n.open:n.close:""},_f={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&Fo(e[0],"none")?[]:fr(e).map(function(s){for(var n={color:255,offsetX:ut,offsetY:ut,blur:ut,spread:ut,inset:!1},a=0,i=0;i<s.length;i++){var o=s[i];Fo(o,"inset")?n.inset=!0:Yr(o)?(a===0?n.offsetX=o:a===1?n.offsetY=o:a===2?n.blur=o:n.spread=o,a++):n.color=zr.parse(r,o)}return n})}},$f={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,e){var s=[0,1,2],n=[];return e.filter(Me).forEach(function(a){switch(a.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),s.forEach(function(a){n.indexOf(a)===-1&&n.push(a)}),n}},Kf={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Vf={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,e){return Kn(e)?e.number:0}},Gf=function(){function r(e,s){var n,a;this.animationDuration=ie(e,Lf,s.animationDuration),this.backgroundClip=ie(e,gh,s.backgroundClip),this.backgroundColor=ie(e,hh,s.backgroundColor),this.backgroundImage=ie(e,jh,s.backgroundImage),this.backgroundOrigin=ie(e,Sh,s.backgroundOrigin),this.backgroundPosition=ie(e,Eh,s.backgroundPosition),this.backgroundRepeat=ie(e,Fh,s.backgroundRepeat),this.backgroundSize=ie(e,Ih,s.backgroundSize),this.borderTopColor=ie(e,Th,s.borderTopColor),this.borderRightColor=ie(e,kh,s.borderRightColor),this.borderBottomColor=ie(e,Ph,s.borderBottomColor),this.borderLeftColor=ie(e,Dh,s.borderLeftColor),this.borderTopLeftRadius=ie(e,Rh,s.borderTopLeftRadius),this.borderTopRightRadius=ie(e,Mh,s.borderTopRightRadius),this.borderBottomRightRadius=ie(e,Hh,s.borderBottomRightRadius),this.borderBottomLeftRadius=ie(e,Lh,s.borderBottomLeftRadius),this.borderTopStyle=ie(e,Oh,s.borderTopStyle),this.borderRightStyle=ie(e,_h,s.borderRightStyle),this.borderBottomStyle=ie(e,$h,s.borderBottomStyle),this.borderLeftStyle=ie(e,Kh,s.borderLeftStyle),this.borderTopWidth=ie(e,Vh,s.borderTopWidth),this.borderRightWidth=ie(e,Gh,s.borderRightWidth),this.borderBottomWidth=ie(e,Wh,s.borderBottomWidth),this.borderLeftWidth=ie(e,zh,s.borderLeftWidth),this.boxShadow=ie(e,_f,s.boxShadow),this.color=ie(e,Xh,s.color),this.direction=ie(e,qh,s.direction),this.display=ie(e,Yh,s.display),this.float=ie(e,Zh,s.cssFloat),this.fontFamily=ie(e,Uf,s.fontFamily),this.fontSize=ie(e,Tf,s.fontSize),this.fontStyle=ie(e,Df,s.fontStyle),this.fontVariant=ie(e,Pf,s.fontVariant),this.fontWeight=ie(e,kf,s.fontWeight),this.letterSpacing=ie(e,ef,s.letterSpacing),this.lineBreak=ie(e,tf,s.lineBreak),this.lineHeight=ie(e,rf,s.lineHeight),this.listStyleImage=ie(e,sf,s.listStyleImage),this.listStylePosition=ie(e,nf,s.listStylePosition),this.listStyleType=ie(e,Qo,s.listStyleType),this.marginTop=ie(e,af,s.marginTop),this.marginRight=ie(e,of,s.marginRight),this.marginBottom=ie(e,Af,s.marginBottom),this.marginLeft=ie(e,lf,s.marginLeft),this.opacity=ie(e,Ff,s.opacity);var i=ie(e,cf,s.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=ie(e,df,s.overflowWrap),this.paddingTop=ie(e,uf,s.paddingTop),this.paddingRight=ie(e,mf,s.paddingRight),this.paddingBottom=ie(e,pf,s.paddingBottom),this.paddingLeft=ie(e,gf,s.paddingLeft),this.paintOrder=ie(e,$f,s.paintOrder),this.position=ie(e,ff,s.position),this.textAlign=ie(e,hf,s.textAlign),this.textDecorationColor=ie(e,Qf,(n=s.textDecorationColor)!==null&&n!==void 0?n:s.color),this.textDecorationLine=ie(e,If,(a=s.textDecorationLine)!==null&&a!==void 0?a:s.textDecoration),this.textShadow=ie(e,xf,s.textShadow),this.textTransform=ie(e,bf,s.textTransform),this.transform=ie(e,yf,s.transform),this.transformOrigin=ie(e,Nf,s.transformOrigin),this.visibility=ie(e,jf,s.visibility),this.webkitTextStrokeColor=ie(e,Kf,s.webkitTextStrokeColor),this.webkitTextStrokeWidth=ie(e,Vf,s.webkitTextStrokeWidth),this.wordBreak=ie(e,Sf,s.wordBreak),this.zIndex=ie(e,Ef,s.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return Xr(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return st(this.display,4)||st(this.display,33554432)||st(this.display,268435456)||st(this.display,536870912)||st(this.display,67108864)||st(this.display,134217728)},r}(),Wf=function(){function r(e,s){this.content=ie(e,Rf,s.content),this.quotes=ie(e,Of,s.quotes)}return r}(),qA=function(){function r(e,s){this.counterIncrement=ie(e,Mf,s.counterIncrement),this.counterReset=ie(e,Hf,s.counterReset)}return r}(),ie=function(r,e,s){var n=new hd,a=s!==null&&typeof s<"u"?s.toString():e.initialValue;n.write(a);var i=new fd(n.read());switch(e.type){case 2:var o=i.parseComponentValue();return e.parse(r,Me(o)?o.value:e.initialValue);case 0:return e.parse(r,i.parseComponentValue());case 1:return e.parse(r,i.parseComponentValues());case 4:return i.parseComponentValue();case 3:switch(e.format){case"angle":return pi.parse(r,i.parseComponentValue());case"color":return zr.parse(r,i.parseComponentValue());case"image":return sA.parse(r,i.parseComponentValue());case"length":var A=i.parseComponentValue();return Yr(A)?A:ut;case"length-percentage":var l=i.parseComponentValue();return et(l)?l:ut;case"time":return Pd.parse(r,i.parseComponentValue())}break}},zf="data-html2canvas-debug",Xf=function(r){var e=r.getAttribute(zf);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Io=function(r,e){var s=Xf(r);return s===1||e===s},xr=function(){function r(e,s){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,Io(s,3))debugger;this.styles=new Gf(e,window.getComputedStyle(s,null)),ko(s)&&(this.styles.animationDuration.some(function(n){return n>0})&&(s.style.animationDuration="0s"),this.styles.transform!==null&&(s.style.transform="none")),this.bounds=ui(this.context,s),Io(s,4)&&(this.flags|=16)}return r}(),qf="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",YA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yn=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ba=0;ba<YA.length;ba++)yn[YA.charCodeAt(ba)]=ba;var Yf=function(r){var e=r.length*.75,s=r.length,n,a=0,i,o,A,l;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var c=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),d=Array.isArray(c)?c:new Uint8Array(c);for(n=0;n<s;n+=4)i=yn[r.charCodeAt(n)],o=yn[r.charCodeAt(n+1)],A=yn[r.charCodeAt(n+2)],l=yn[r.charCodeAt(n+3)],d[a++]=i<<2|o>>4,d[a++]=(o&15)<<4|A>>2,d[a++]=(A&3)<<6|l&63;return c},Jf=function(r){for(var e=r.length,s=[],n=0;n<e;n+=2)s.push(r[n+1]<<8|r[n]);return s},Zf=function(r){for(var e=r.length,s=[],n=0;n<e;n+=4)s.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return s},cs=5,nA=11,Ri=2,e0=nA-cs,Dd=65536>>cs,t0=1<<cs,Mi=t0-1,r0=1024>>cs,s0=Dd+r0,n0=s0,a0=32,i0=n0+a0,o0=65536>>nA,A0=1<<e0,l0=A0-1,JA=function(r,e,s){return r.slice?r.slice(e,s):new Uint16Array(Array.prototype.slice.call(r,e,s))},c0=function(r,e,s){return r.slice?r.slice(e,s):new Uint32Array(Array.prototype.slice.call(r,e,s))},d0=function(r,e){var s=Yf(r),n=Array.isArray(s)?Zf(s):new Uint32Array(s),a=Array.isArray(s)?Jf(s):new Uint16Array(s),i=24,o=JA(a,i/2,n[4]/2),A=n[5]===2?JA(a,(i+n[4])/2):c0(n,Math.ceil((i+n[4])/4));return new u0(n[0],n[1],n[2],n[3],o,A)},u0=function(){function r(e,s,n,a,i,o){this.initialValue=e,this.errorValue=s,this.highStart=n,this.highValueIndex=a,this.index=i,this.data=o}return r.prototype.get=function(e){var s;if(e>=0){if(e<55296||e>56319&&e<=65535)return s=this.index[e>>cs],s=(s<<Ri)+(e&Mi),this.data[s];if(e<=65535)return s=this.index[Dd+(e-55296>>cs)],s=(s<<Ri)+(e&Mi),this.data[s];if(e<this.highStart)return s=i0-o0+(e>>nA),s=this.index[s],s+=e>>cs&l0,s=this.index[s],s=(s<<Ri)+(e&Mi),this.data[s];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),ZA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m0=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ya=0;ya<ZA.length;ya++)m0[ZA.charCodeAt(ya)]=ya;var p0=1,Hi=2,Li=3,el=4,tl=5,g0=7,rl=8,Oi=9,_i=10,sl=11,nl=12,al=13,il=14,$i=15,h0=function(r){for(var e=[],s=0,n=r.length;s<n;){var a=r.charCodeAt(s++);if(a>=55296&&a<=56319&&s<n){var i=r.charCodeAt(s++);(i&64512)===56320?e.push(((a&1023)<<10)+(i&1023)+65536):(e.push(a),s--)}else e.push(a)}return e},f0=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var s=r.length;if(!s)return"";for(var n=[],a=-1,i="";++a<s;){var o=r[a];o<=65535?n.push(o):(o-=65536,n.push((o>>10)+55296,o%1024+56320)),(a+1===s||n.length>16384)&&(i+=String.fromCharCode.apply(String,n),n.length=0)}return i},x0=d0(qf),Lt="√ó",Ki="√∑",b0=function(r){return x0.get(r)},y0=function(r,e,s){var n=s-2,a=e[n],i=e[s-1],o=e[s];if(i===Hi&&o===Li)return Lt;if(i===Hi||i===Li||i===el||o===Hi||o===Li||o===el)return Ki;if(i===rl&&[rl,Oi,sl,nl].indexOf(o)!==-1||(i===sl||i===Oi)&&(o===Oi||o===_i)||(i===nl||i===_i)&&o===_i||o===al||o===tl||o===g0||i===p0)return Lt;if(i===al&&o===il){for(;a===tl;)a=e[--n];if(a===il)return Lt}if(i===$i&&o===$i){for(var A=0;a===$i;)A++,a=e[--n];if(A%2===0)return Lt}return Ki},v0=function(r){var e=h0(r),s=e.length,n=0,a=0,i=e.map(b0);return{next:function(){if(n>=s)return{done:!0,value:null};for(var o=Lt;n<s&&(o=y0(e,i,++n))===Lt;);if(o!==Lt||n===s){var A=f0.apply(null,e.slice(a,n));return a=n,{value:A,done:!1}}return{done:!0,value:null}}}},w0=function(r){for(var e=v0(r),s=[],n;!(n=e.next()).done;)n.value&&s.push(n.value.slice());return s},B0=function(r){var e=123;if(r.createRange){var s=r.createRange();if(s.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=e+"px",n.style.display="block",r.body.appendChild(n),s.selectNode(n);var a=s.getBoundingClientRect(),i=Math.round(a.height);if(r.body.removeChild(n),i===e)return!0}}return!1},C0=function(r){var e=r.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",r.body.appendChild(e);var s=r.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=e.firstChild,a=mi(n.data).map(function(l){return Ye(l)}),i=0,o={},A=a.every(function(l,c){s.setStart(n,i),s.setEnd(n,i+l.length);var d=s.getBoundingClientRect();i+=l.length;var m=d.x>o.x||d.y>o.y;return o=d,c===0?!0:m});return r.body.removeChild(e),A},N0=function(){return typeof new Image().crossOrigin<"u"},j0=function(){return typeof new XMLHttpRequest().responseType=="string"},S0=function(r){var e=new Image,s=r.createElement("canvas"),n=s.getContext("2d");if(!n)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(e,0,0),s.toDataURL()}catch{return!1}return!0},ol=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},E0=function(r){var e=r.createElement("canvas"),s=100;e.width=s,e.height=s;var n=e.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,s,s);var a=new Image,i=e.toDataURL();a.src=i;var o=Uo(s,s,0,0,a);return n.fillStyle="red",n.fillRect(0,0,s,s),Al(o).then(function(A){n.drawImage(A,0,0);var l=n.getImageData(0,0,s,s).data;n.fillStyle="red",n.fillRect(0,0,s,s);var c=r.createElement("div");return c.style.backgroundImage="url("+i+")",c.style.height=s+"px",ol(l)?Al(Uo(s,s,0,0,c)):Promise.reject(!1)}).then(function(A){return n.drawImage(A,0,0),ol(n.getImageData(0,0,s,s).data)}).catch(function(){return!1})},Uo=function(r,e,s,n,a){var i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg"),A=document.createElementNS(i,"foreignObject");return o.setAttributeNS(null,"width",r.toString()),o.setAttributeNS(null,"height",e.toString()),A.setAttributeNS(null,"width","100%"),A.setAttributeNS(null,"height","100%"),A.setAttributeNS(null,"x",s.toString()),A.setAttributeNS(null,"y",n.toString()),A.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(A),A.appendChild(a),o},Al=function(r){return new Promise(function(e,s){var n=new Image;n.onload=function(){return e(n)},n.onerror=s,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},dt={get SUPPORT_RANGE_BOUNDS(){var r=B0(document);return Object.defineProperty(dt,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=dt.SUPPORT_RANGE_BOUNDS&&C0(document);return Object.defineProperty(dt,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=S0(document);return Object.defineProperty(dt,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?E0(document):Promise.resolve(!1);return Object.defineProperty(dt,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=N0();return Object.defineProperty(dt,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=j0();return Object.defineProperty(dt,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(dt,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(dt,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},Tn=function(){function r(e,s){this.text=e,this.bounds=s}return r}(),F0=function(r,e,s,n){var a=U0(e,s),i=[],o=0;return a.forEach(function(A){if(s.textDecorationLine.length||A.trim().length>0)if(dt.SUPPORT_RANGE_BOUNDS){var l=ll(n,o,A.length).getClientRects();if(l.length>1){var c=aA(A),d=0;c.forEach(function(g){i.push(new Tn(g,Ir.fromDOMRectList(r,ll(n,d+o,g.length).getClientRects()))),d+=g.length})}else i.push(new Tn(A,Ir.fromDOMRectList(r,l)))}else{var m=n.splitText(A.length);i.push(new Tn(A,Q0(r,n))),n=m}else dt.SUPPORT_RANGE_BOUNDS||(n=n.splitText(A.length));o+=A.length}),i},Q0=function(r,e){var s=e.ownerDocument;if(s){var n=s.createElement("html2canvaswrapper");n.appendChild(e.cloneNode(!0));var a=e.parentNode;if(a){a.replaceChild(n,e);var i=ui(r,n);return n.firstChild&&a.replaceChild(n.firstChild,n),i}}return Ir.EMPTY},ll=function(r,e,s){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var a=n.createRange();return a.setStart(r,e),a.setEnd(r,e+s),a},aA=function(r){if(dt.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(r)).map(function(s){return s.segment})}return w0(r)},I0=function(r,e){if(dt.SUPPORT_NATIVE_TEXT_SEGMENTATION){var s=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(s.segment(r)).map(function(n){return n.segment})}return k0(r,e)},U0=function(r,e){return e.letterSpacing!==0?aA(r):I0(r,e)},T0=[32,160,4961,65792,65793,4153,4241],k0=function(r,e){for(var s=ig(r,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),n=[],a,i=function(){if(a.value){var o=a.value.slice(),A=mi(o),l="";A.forEach(function(c){T0.indexOf(c)===-1?l+=Ye(c):(l.length&&n.push(l),n.push(Ye(c)),l="")}),l.length&&n.push(l)}};!(a=s.next()).done;)i();return n},P0=function(){function r(e,s,n){this.text=D0(s.data,n.textTransform),this.textBounds=F0(e,this.text,n,s)}return r}(),D0=function(r,e){switch(e){case 1:return r.toLowerCase();case 3:return r.replace(R0,M0);case 2:return r.toUpperCase();default:return r}},R0=/(^|\s|:|-|\(|\))([a-z])/g,M0=function(r,e,s){return r.length>0?e+s.toUpperCase():r},Rd=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;return a.src=n.currentSrc||n.src,a.intrinsicWidth=n.naturalWidth,a.intrinsicHeight=n.naturalHeight,a.context.cache.addImage(a.src),a}return e}(xr),Md=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;return a.canvas=n,a.intrinsicWidth=n.width,a.intrinsicHeight=n.height,a}return e}(xr),Hd=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this,i=new XMLSerializer,o=ui(s,n);return n.setAttribute("width",o.width+"px"),n.setAttribute("height",o.height+"px"),a.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(n)),a.intrinsicWidth=n.width.baseVal.value,a.intrinsicHeight=n.height.baseVal.value,a.context.cache.addImage(a.svg),a}return e}(xr),Ld=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;return a.value=n.value,a}return e}(xr),To=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;return a.start=n.start,a.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,a}return e}(xr),H0=[{type:15,flags:0,unit:"px",number:3}],L0=[{type:16,flags:0,number:50}],O0=function(r){return r.width>r.height?new Ir(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new Ir(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},_0=function(r){var e=r.type===$0?new Array(r.value.length+1).join("‚Ä¢"):r.value;return e.length===0?r.placeholder||"":e},Ya="checkbox",Ja="radio",$0="password",cl=707406591,iA=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;switch(a.type=n.type.toLowerCase(),a.checked=n.checked,a.value=_0(n),(a.type===Ya||a.type===Ja)&&(a.styles.backgroundColor=3739148031,a.styles.borderTopColor=a.styles.borderRightColor=a.styles.borderBottomColor=a.styles.borderLeftColor=2779096575,a.styles.borderTopWidth=a.styles.borderRightWidth=a.styles.borderBottomWidth=a.styles.borderLeftWidth=1,a.styles.borderTopStyle=a.styles.borderRightStyle=a.styles.borderBottomStyle=a.styles.borderLeftStyle=1,a.styles.backgroundClip=[0],a.styles.backgroundOrigin=[0],a.bounds=O0(a.bounds)),a.type){case Ya:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=H0;break;case Ja:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=L0;break}return a}return e}(xr),Od=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this,i=n.options[n.selectedIndex||0];return a.value=i&&i.text||"",a}return e}(xr),_d=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;return a.value=n.value,a}return e}(xr),$d=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;a.src=n.src,a.width=parseInt(n.width,10)||0,a.height=parseInt(n.height,10)||0,a.backgroundColor=a.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){a.tree=Vd(s,n.contentWindow.document.documentElement);var i=n.contentWindow.document.documentElement?In(s,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):Sr.TRANSPARENT,o=n.contentWindow.document.body?In(s,getComputedStyle(n.contentWindow.document.body).backgroundColor):Sr.TRANSPARENT;a.backgroundColor=Xr(i)?Xr(o)?a.styles.backgroundColor:o:i}}catch{}return a}return e}(xr),K0=["OL","UL","MENU"],La=function(r,e,s,n){for(var a=e.firstChild,i=void 0;a;a=i)if(i=a.nextSibling,Gd(a)&&a.data.trim().length>0)s.textNodes.push(new P0(r,a,s.styles));else if(js(a))if(qd(a)&&a.assignedNodes)a.assignedNodes().forEach(function(A){return La(r,A,s,n)});else{var o=Kd(r,a);o.styles.isVisible()&&(V0(a,o,n)?o.flags|=4:G0(o.styles)&&(o.flags|=2),K0.indexOf(a.tagName)!==-1&&(o.flags|=8),s.elements.push(o),a.slot,a.shadowRoot?La(r,a.shadowRoot,o,n):!Za(a)&&!Wd(a)&&!ei(a)&&La(r,a,o,n))}},Kd=function(r,e){return Po(e)?new Rd(r,e):zd(e)?new Md(r,e):Wd(e)?new Hd(r,e):W0(e)?new Ld(r,e):z0(e)?new To(r,e):X0(e)?new iA(r,e):ei(e)?new Od(r,e):Za(e)?new _d(r,e):Xd(e)?new $d(r,e):new xr(r,e)},Vd=function(r,e){var s=Kd(r,e);return s.flags|=4,La(r,e,s,s),s},V0=function(r,e,s){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||oA(r)&&s.styles.isTransparent()},G0=function(r){return r.isPositioned()||r.isFloating()},Gd=function(r){return r.nodeType===Node.TEXT_NODE},js=function(r){return r.nodeType===Node.ELEMENT_NODE},ko=function(r){return js(r)&&typeof r.style<"u"&&!Oa(r)},Oa=function(r){return typeof r.className=="object"},W0=function(r){return r.tagName==="LI"},z0=function(r){return r.tagName==="OL"},X0=function(r){return r.tagName==="INPUT"},q0=function(r){return r.tagName==="HTML"},Wd=function(r){return r.tagName==="svg"},oA=function(r){return r.tagName==="BODY"},zd=function(r){return r.tagName==="CANVAS"},dl=function(r){return r.tagName==="VIDEO"},Po=function(r){return r.tagName==="IMG"},Xd=function(r){return r.tagName==="IFRAME"},ul=function(r){return r.tagName==="STYLE"},Y0=function(r){return r.tagName==="SCRIPT"},Za=function(r){return r.tagName==="TEXTAREA"},ei=function(r){return r.tagName==="SELECT"},qd=function(r){return r.tagName==="SLOT"},ml=function(r){return r.tagName.indexOf("-")>0},J0=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(e){var s=this.counters[e];return s&&s.length?s[s.length-1]:1},r.prototype.getCounterValues=function(e){var s=this.counters[e];return s||[]},r.prototype.pop=function(e){var s=this;e.forEach(function(n){return s.counters[n].pop()})},r.prototype.parse=function(e){var s=this,n=e.counterIncrement,a=e.counterReset,i=!0;n!==null&&n.forEach(function(A){var l=s.counters[A.counter];l&&A.increment!==0&&(i=!1,l.length||l.push(1),l[Math.max(0,l.length-1)]+=A.increment)});var o=[];return i&&a.forEach(function(A){var l=s.counters[A.counter];o.push(A.counter),l||(l=s.counters[A.counter]=[]),l.push(A.reset)}),o},r}(),pl={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},gl={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["’î","’ì","’í","’ë","’ê","’è","’é","’ç","’å","’ã","’ä","’â","’à","’á","’Ü","’Ö","’Ñ","’É","’Ç","’Å","’Ä","‘ø","‘æ","‘Ω","‘º","‘ª","‘∫","‘π","‘∏","‘∑","‘∂","‘µ","‘¥","‘≥","‘≤","‘±"]},Z0={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["◊ô◊≥","◊ò◊≥","◊ó◊≥","◊ñ◊≥","◊ï◊≥","◊î◊≥","◊ì◊≥","◊í◊≥","◊ë◊≥","◊ê◊≥","◊™","◊©","◊®","◊ß","◊¶","◊§","◊¢","◊°","◊†","◊û","◊ú","◊õ","◊ô◊ò","◊ô◊ó","◊ô◊ñ","◊ò◊ñ","◊ò◊ï","◊ô","◊ò","◊ó","◊ñ","◊ï","◊î","◊ì","◊í","◊ë","◊ê"]},ex={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["·Éµ","·É∞","·ÉØ","·É¥","·ÉÆ","·É≠","·É¨","·É´","·É™","·É©","·É®","·Éß","·É¶","·É•","·É§","·É≥","·É¢","·É°","·É†","·Éü","·Éû","·Éù","·É≤","·Éú","·Éõ","·Éö","·Éô","·Éò","·Éó","·É±","·Éñ","·Éï","·Éî","·Éì","·Éí","·Éë","·Éê"]},xs=function(r,e,s,n,a,i){return r<e||r>s?Ln(r,a,i.length>0):n.integers.reduce(function(o,A,l){for(;r>=A;)r-=A,o+=n.values[l];return o},"")+i},Yd=function(r,e,s,n){var a="";do s||r--,a=n(r)+a,r/=e;while(r*e>=e);return a},qe=function(r,e,s,n,a){var i=s-e+1;return(r<0?"-":"")+(Yd(Math.abs(r),i,n,function(o){return Ye(Math.floor(o%i)+e)})+a)},ts=function(r,e,s){s===void 0&&(s=". ");var n=e.length;return Yd(Math.abs(r),n,!1,function(a){return e[Math.floor(a%n)]})+s},Bs=1,Pr=2,Dr=4,vn=8,wr=function(r,e,s,n,a,i){if(r<-9999||r>9999)return Ln(r,4,a.length>0);var o=Math.abs(r),A=a;if(o===0)return e[0]+A;for(var l=0;o>0&&l<=4;l++){var c=o%10;c===0&&st(i,Bs)&&A!==""?A=e[c]+A:c>1||c===1&&l===0||c===1&&l===1&&st(i,Pr)||c===1&&l===1&&st(i,Dr)&&r>100||c===1&&l>1&&st(i,vn)?A=e[c]+(l>0?s[l-1]:"")+A:c===1&&l>0&&(A=s[l-1]+A),o=Math.floor(o/10)}return(r<0?n:"")+A},hl="ÂçÅÁôæÂçÉËê¨",fl="Êãæ‰Ω∞‰ªüËê¨",xl="„Éû„Ç§„Éä„Çπ",Vi="ÎßàÏù¥ÎÑàÏä§",Ln=function(r,e,s){var n=s?". ":"",a=s?"„ÄÅ":"",i=s?", ":"",o=s?" ":"";switch(e){case 0:return"‚Ä¢"+o;case 1:return"‚ó¶"+o;case 2:return"‚óæ"+o;case 5:var A=qe(r,48,57,!0,n);return A.length<4?"0"+A:A;case 4:return ts(r,"„Äá‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù",a);case 6:return xs(r,1,3999,pl,3,n).toLowerCase();case 7:return xs(r,1,3999,pl,3,n);case 8:return qe(r,945,969,!1,n);case 9:return qe(r,97,122,!1,n);case 10:return qe(r,65,90,!1,n);case 11:return qe(r,1632,1641,!0,n);case 12:case 49:return xs(r,1,9999,gl,3,n);case 35:return xs(r,1,9999,gl,3,n).toLowerCase();case 13:return qe(r,2534,2543,!0,n);case 14:case 30:return qe(r,6112,6121,!0,n);case 15:return ts(r,"Â≠ê‰∏ëÂØÖÂçØËæ∞Â∑≥ÂçàÊú™Áî≥ÈÖâÊàå‰∫•",a);case 16:return ts(r,"Áî≤‰πô‰∏ô‰∏ÅÊàäÂ∑±Â∫öËæõÂ£¨Áô∏",a);case 17:case 48:return wr(r,"Èõ∂‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù",hl,"Ë≤†",a,Pr|Dr|vn);case 47:return wr(r,"Èõ∂Â£πË≤≥ÂèÉËÇÜ‰ºçÈô∏ÊüíÊçåÁéñ",fl,"Ë≤†",a,Bs|Pr|Dr|vn);case 42:return wr(r,"Èõ∂‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù",hl,"Ë¥ü",a,Pr|Dr|vn);case 41:return wr(r,"Èõ∂Â£πË¥∞ÂèÅËÇÜ‰ºçÈôÜÊüíÊçåÁéñ",fl,"Ë¥ü",a,Bs|Pr|Dr|vn);case 26:return wr(r,"„Äá‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÂçÅÁôæÂçÉ‰∏á",xl,a,0);case 25:return wr(r,"Èõ∂Â£±ÂºêÂèÇÂõõ‰ºçÂÖ≠‰∏ÉÂÖ´‰πù","ÊãæÁôæÂçÉ‰∏á",xl,a,Bs|Pr|Dr);case 31:return wr(r,"ÏòÅÏùºÏù¥ÏÇºÏÇ¨Ïò§Ïú°Ïπ†ÌåîÍµ¨","Ïã≠Î∞±Ï≤úÎßå",Vi,i,Bs|Pr|Dr);case 33:return wr(r,"Èõ∂‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÂçÅÁôæÂçÉËê¨",Vi,i,0);case 32:return wr(r,"Èõ∂Â£πË≤≥ÂèÉÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÊãæÁôæÂçÉ",Vi,i,Bs|Pr|Dr);case 18:return qe(r,2406,2415,!0,n);case 20:return xs(r,1,19999,ex,3,n);case 21:return qe(r,2790,2799,!0,n);case 22:return qe(r,2662,2671,!0,n);case 22:return xs(r,1,10999,Z0,3,n);case 23:return ts(r,"„ÅÇ„ÅÑ„ÅÜ„Åà„Åä„Åã„Åç„Åè„Åë„Åì„Åï„Åó„Åô„Åõ„Åù„Åü„Å°„Å§„Å¶„Å®„Å™„Å´„Å¨„Å≠„ÅÆ„ÅØ„Å≤„Åµ„Å∏„Åª„Åæ„Åø„ÇÄ„ÇÅ„ÇÇ„ÇÑ„ÇÜ„Çà„Çâ„Çä„Çã„Çå„Çç„Çè„Çê„Çë„Çí„Çì");case 24:return ts(r,"„ÅÑ„Çç„ÅØ„Å´„Åª„Å∏„Å®„Å°„Çä„Å¨„Çã„Çí„Çè„Åã„Çà„Åü„Çå„Åù„Å§„Å≠„Å™„Çâ„ÇÄ„ÅÜ„Çê„ÅÆ„Åä„Åè„ÇÑ„Åæ„Åë„Åµ„Åì„Åà„Å¶„ÅÇ„Åï„Åç„ÇÜ„ÇÅ„Åø„Åó„Çë„Å≤„ÇÇ„Åõ„Åô");case 27:return qe(r,3302,3311,!0,n);case 28:return ts(r,"„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É∞„É±„É≤„É≥",a);case 29:return ts(r,"„Ç§„É≠„Éè„Éã„Éõ„Éò„Éà„ÉÅ„É™„Éå„É´„É≤„ÉØ„Ç´„É®„Çø„É¨„ÇΩ„ÉÑ„Éç„Éä„É©„É†„Ç¶„É∞„Éé„Ç™„ÇØ„É§„Éû„Ç±„Éï„Ç≥„Ç®„ÉÜ„Ç¢„Çµ„Ç≠„É¶„É°„Éü„Ç∑„É±„Éí„É¢„Çª„Çπ",a);case 34:return qe(r,3792,3801,!0,n);case 37:return qe(r,6160,6169,!0,n);case 38:return qe(r,4160,4169,!0,n);case 39:return qe(r,2918,2927,!0,n);case 40:return qe(r,1776,1785,!0,n);case 43:return qe(r,3046,3055,!0,n);case 44:return qe(r,3174,3183,!0,n);case 45:return qe(r,3664,3673,!0,n);case 46:return qe(r,3872,3881,!0,n);case 3:default:return qe(r,48,57,!0,n)}},Jd="data-html2canvas-ignore",bl=function(){function r(e,s,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=s,this.counters=new J0,this.quoteDepth=0,!s.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(s.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(e,s){var n=this,a=tx(e,s);if(!a.contentWindow)return Promise.reject("Unable to find iframe window");var i=e.defaultView.pageXOffset,o=e.defaultView.pageYOffset,A=a.contentWindow,l=A.document,c=nx(a).then(function(){return Bt(n,void 0,void 0,function(){var d,m;return ht(this,function(g){switch(g.label){case 0:return this.scrolledElements.forEach(Ax),A&&(A.scrollTo(s.left,s.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(A.scrollY!==s.top||A.scrollX!==s.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(A.scrollX-s.left,A.scrollY-s.top,0,0))),d=this.options.onclone,m=this.clonedReferenceElement,typeof m>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:l.fonts&&l.fonts.ready?[4,l.fonts.ready]:[3,2];case 1:g.sent(),g.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,sx(l)]:[3,4];case 3:g.sent(),g.label=4;case 4:return typeof d=="function"?[2,Promise.resolve().then(function(){return d(l,m)}).then(function(){return a})]:[2,a]}})})});return l.open(),l.write(ix(document.doctype)+"<html></html>"),ox(this.referenceElement.ownerDocument,i,o),l.replaceChild(l.adoptNode(this.documentElement),l.documentElement),l.close(),c},r.prototype.createElementClone=function(e){if(Io(e,2))debugger;if(zd(e))return this.createCanvasClone(e);if(dl(e))return this.createVideoClone(e);if(ul(e))return this.createStyleClone(e);var s=e.cloneNode(!1);return Po(s)&&(Po(e)&&e.currentSrc&&e.currentSrc!==e.src&&(s.src=e.currentSrc,s.srcset=""),s.loading==="lazy"&&(s.loading="eager")),ml(s)?this.createCustomElementClone(s):s},r.prototype.createCustomElementClone=function(e){var s=document.createElement("html2canvascustomelement");return Gi(e.style,s),s},r.prototype.createStyleClone=function(e){try{var s=e.sheet;if(s&&s.cssRules){var n=[].slice.call(s.cssRules,0).reduce(function(i,o){return o&&typeof o.cssText=="string"?i+o.cssText:i},""),a=e.cloneNode(!1);return a.textContent=n,a}}catch(i){if(this.context.logger.error("Unable to access cssRules property",i),i.name!=="SecurityError")throw i}return e.cloneNode(!1)},r.prototype.createCanvasClone=function(e){var s;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var a=e.cloneNode(!1);try{a.width=e.width,a.height=e.height;var i=e.getContext("2d"),o=a.getContext("2d");if(o)if(!this.options.allowTaint&&i)o.putImageData(i.getImageData(0,0,e.width,e.height),0,0);else{var A=(s=e.getContext("webgl2"))!==null&&s!==void 0?s:e.getContext("webgl");if(A){var l=A.getContextAttributes();l?.preserveDrawingBuffer===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}o.drawImage(e,0,0)}return a}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return a},r.prototype.createVideoClone=function(e){var s=e.ownerDocument.createElement("canvas");s.width=e.offsetWidth,s.height=e.offsetHeight;var n=s.getContext("2d");try{return n&&(n.drawImage(e,0,0,s.width,s.height),this.options.allowTaint||n.getImageData(0,0,s.width,s.height)),s}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var a=e.ownerDocument.createElement("canvas");return a.width=e.offsetWidth,a.height=e.offsetHeight,a},r.prototype.appendChildNode=function(e,s,n){(!js(s)||!Y0(s)&&!s.hasAttribute(Jd)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(s)))&&(!this.options.copyStyles||!js(s)||!ul(s))&&e.appendChild(this.cloneNode(s,n))},r.prototype.cloneChildNodes=function(e,s,n){for(var a=this,i=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;i;i=i.nextSibling)if(js(i)&&qd(i)&&typeof i.assignedNodes=="function"){var o=i.assignedNodes();o.length&&o.forEach(function(A){return a.appendChildNode(s,A,n)})}else this.appendChildNode(s,i,n)},r.prototype.cloneNode=function(e,s){if(Gd(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&js(e)&&(ko(e)||Oa(e))){var a=this.createElementClone(e);a.style.transitionProperty="none";var i=n.getComputedStyle(e),o=n.getComputedStyle(e,":before"),A=n.getComputedStyle(e,":after");this.referenceElement===e&&ko(a)&&(this.clonedReferenceElement=a),oA(a)&&dx(a);var l=this.counters.parse(new qA(this.context,i)),c=this.resolvePseudoContent(e,a,o,kn.BEFORE);ml(e)&&(s=!0),dl(e)||this.cloneChildNodes(e,a,s),c&&a.insertBefore(c,a.firstChild);var d=this.resolvePseudoContent(e,a,A,kn.AFTER);return d&&a.appendChild(d),this.counters.pop(l),(i&&(this.options.copyStyles||Oa(e))&&!Xd(e)||s)&&Gi(i,a),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([a,e.scrollLeft,e.scrollTop]),(Za(e)||ei(e))&&(Za(a)||ei(a))&&(a.value=e.value),a}return e.cloneNode(!1)},r.prototype.resolvePseudoContent=function(e,s,n,a){var i=this;if(n){var o=n.content,A=s.ownerDocument;if(!(!A||!o||o==="none"||o==="-moz-alt-content"||n.display==="none")){this.counters.parse(new qA(this.context,n));var l=new Wf(this.context,n),c=A.createElement("html2canvaspseudoelement");Gi(n,c),l.content.forEach(function(m){if(m.type===0)c.appendChild(A.createTextNode(m.value));else if(m.type===22){var g=A.createElement("img");g.src=m.value,g.style.opacity="1",c.appendChild(g)}else if(m.type===18){if(m.name==="attr"){var h=m.values.filter(Me);h.length&&c.appendChild(A.createTextNode(e.getAttribute(h[0].value)||""))}else if(m.name==="counter"){var p=m.values.filter(Gs),b=p[0],N=p[1];if(b&&Me(b)){var y=i.counters.getCounterValue(b.value),j=N&&Me(N)?Qo.parse(i.context,N.value):3;c.appendChild(A.createTextNode(Ln(y,j,!1)))}}else if(m.name==="counters"){var Q=m.values.filter(Gs),b=Q[0],v=Q[1],N=Q[2];if(b&&Me(b)){var x=i.counters.getCounterValues(b.value),f=N&&Me(N)?Qo.parse(i.context,N.value):3,S=v&&v.type===0?v.value:"",F=x.map(function(C){return Ln(C,f,!1)}).join(S);c.appendChild(A.createTextNode(F))}}}else if(m.type===20)switch(m.value){case"open-quote":c.appendChild(A.createTextNode(XA(l.quotes,i.quoteDepth++,!0)));break;case"close-quote":c.appendChild(A.createTextNode(XA(l.quotes,--i.quoteDepth,!1)));break;default:c.appendChild(A.createTextNode(m.value))}}),c.className=Do+" "+Ro;var d=a===kn.BEFORE?" "+Do:" "+Ro;return Oa(s)?s.className.baseValue+=d:s.className+=d,c}}},r.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},r}(),kn;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(kn||(kn={}));var tx=function(r,e){var s=r.createElement("iframe");return s.className="html2canvas-container",s.style.visibility="hidden",s.style.position="fixed",s.style.left="-10000px",s.style.top="0px",s.style.border="0",s.width=e.width.toString(),s.height=e.height.toString(),s.scrolling="no",s.setAttribute(Jd,"true"),r.body.appendChild(s),s},rx=function(r){return new Promise(function(e){if(r.complete){e();return}if(!r.src){e();return}r.onload=e,r.onerror=e})},sx=function(r){return Promise.all([].slice.call(r.images,0).map(rx))},nx=function(r){return new Promise(function(e,s){var n=r.contentWindow;if(!n)return s("No window assigned for iframe");var a=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var i=setInterval(function(){a.body.childNodes.length>0&&a.readyState==="complete"&&(clearInterval(i),e(r))},50)}})},ax=["all","d","content"],Gi=function(r,e){for(var s=r.length-1;s>=0;s--){var n=r.item(s);ax.indexOf(n)===-1&&e.style.setProperty(n,r.getPropertyValue(n))}return e},ix=function(r){var e="";return r&&(e+="<!DOCTYPE ",r.name&&(e+=r.name),r.internalSubset&&(e+=r.internalSubset),r.publicId&&(e+='"'+r.publicId+'"'),r.systemId&&(e+='"'+r.systemId+'"'),e+=">"),e},ox=function(r,e,s){r&&r.defaultView&&(e!==r.defaultView.pageXOffset||s!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(e,s)},Ax=function(r){var e=r[0],s=r[1],n=r[2];e.scrollLeft=s,e.scrollTop=n},lx=":before",cx=":after",Do="___html2canvas___pseudoelement_before",Ro="___html2canvas___pseudoelement_after",yl=`{
    content: "" !important;
    display: none !important;
}`,dx=function(r){ux(r,"."+Do+lx+yl+`
         .`+Ro+cx+yl)},ux=function(r,e){var s=r.ownerDocument;if(s){var n=s.createElement("style");n.textContent=e,r.appendChild(n)}},Zd=function(){function r(){}return r.getOrigin=function(e){var s=r._link;return s?(s.href=e,s.href=s.href,s.protocol+s.hostname+s.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r._origin="about:blank",r}(),mx=function(){function r(e,s){this.context=e,this._options=s,this._cache={}}return r.prototype.addImage=function(e){var s=Promise.resolve();return this.has(e)||(zi(e)||fx(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),s},r.prototype.match=function(e){return this._cache[e]},r.prototype.loadImage=function(e){return Bt(this,void 0,void 0,function(){var s,n,a,i,o=this;return ht(this,function(A){switch(A.label){case 0:return s=Zd.isSameOrigin(e),n=!Wi(e)&&this._options.useCORS===!0&&dt.SUPPORT_CORS_IMAGES&&!s,a=!Wi(e)&&!s&&!zi(e)&&typeof this._options.proxy=="string"&&dt.SUPPORT_CORS_XHR&&!n,!s&&this._options.allowTaint===!1&&!Wi(e)&&!zi(e)&&!a&&!n?[2]:(i=e,a?[4,this.proxy(i)]:[3,2]);case 1:i=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(l,c){var d=new Image;d.onload=function(){return l(d)},d.onerror=c,(xx(i)||n)&&(d.crossOrigin="anonymous"),d.src=i,d.complete===!0&&setTimeout(function(){return l(d)},500),o._options.imageTimeout>0&&setTimeout(function(){return c("Timed out ("+o._options.imageTimeout+"ms) loading image")},o._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},r.prototype.has=function(e){return typeof this._cache[e]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(e){var s=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var a=e.substring(0,256);return new Promise(function(i,o){var A=dt.SUPPORT_RESPONSE_TYPE?"blob":"text",l=new XMLHttpRequest;l.onload=function(){if(l.status===200)if(A==="text")i(l.response);else{var m=new FileReader;m.addEventListener("load",function(){return i(m.result)},!1),m.addEventListener("error",function(g){return o(g)},!1),m.readAsDataURL(l.response)}else o("Failed to proxy resource "+a+" with status code "+l.status)},l.onerror=o;var c=n.indexOf("?")>-1?"&":"?";if(l.open("GET",""+n+c+"url="+encodeURIComponent(e)+"&responseType="+A),A!=="text"&&l instanceof XMLHttpRequest&&(l.responseType=A),s._options.imageTimeout){var d=s._options.imageTimeout;l.timeout=d,l.ontimeout=function(){return o("Timed out ("+d+"ms) proxying "+a)}}l.send()})},r}(),px=/^data:image\/svg\+xml/i,gx=/^data:image\/.*;base64,/i,hx=/^data:image\/.*/i,fx=function(r){return dt.SUPPORT_SVG_DRAWING||!bx(r)},Wi=function(r){return hx.test(r)},xx=function(r){return gx.test(r)},zi=function(r){return r.substr(0,4)==="blob"},bx=function(r){return r.substr(-3).toLowerCase()==="svg"||px.test(r)},ne=function(){function r(e,s){this.type=0,this.x=e,this.y=s}return r.prototype.add=function(e,s){return new r(this.x+e,this.y+s)},r}(),bs=function(r,e,s){return new ne(r.x+(e.x-r.x)*s,r.y+(e.y-r.y)*s)},va=function(){function r(e,s,n,a){this.type=1,this.start=e,this.startControl=s,this.endControl=n,this.end=a}return r.prototype.subdivide=function(e,s){var n=bs(this.start,this.startControl,e),a=bs(this.startControl,this.endControl,e),i=bs(this.endControl,this.end,e),o=bs(n,a,e),A=bs(a,i,e),l=bs(o,A,e);return s?new r(this.start,n,o,l):new r(l,A,i,this.end)},r.prototype.add=function(e,s){return new r(this.start.add(e,s),this.startControl.add(e,s),this.endControl.add(e,s),this.end.add(e,s))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),Ot=function(r){return r.type===1},yx=function(){function r(e){var s=e.styles,n=e.bounds,a=bn(s.borderTopLeftRadius,n.width,n.height),i=a[0],o=a[1],A=bn(s.borderTopRightRadius,n.width,n.height),l=A[0],c=A[1],d=bn(s.borderBottomRightRadius,n.width,n.height),m=d[0],g=d[1],h=bn(s.borderBottomLeftRadius,n.width,n.height),p=h[0],b=h[1],N=[];N.push((i+l)/n.width),N.push((p+m)/n.width),N.push((o+b)/n.height),N.push((c+g)/n.height);var y=Math.max.apply(Math,N);y>1&&(i/=y,o/=y,l/=y,c/=y,m/=y,g/=y,p/=y,b/=y);var j=n.width-l,Q=n.height-g,v=n.width-m,x=n.height-b,f=s.borderTopWidth,S=s.borderRightWidth,F=s.borderBottomWidth,w=s.borderLeftWidth,T=Oe(s.paddingTop,e.bounds.width),C=Oe(s.paddingRight,e.bounds.width),E=Oe(s.paddingBottom,e.bounds.width),U=Oe(s.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||o>0?_e(n.left+w/3,n.top+f/3,i-w/3,o-f/3,ke.TOP_LEFT):new ne(n.left+w/3,n.top+f/3),this.topRightBorderDoubleOuterBox=i>0||o>0?_e(n.left+j,n.top+f/3,l-S/3,c-f/3,ke.TOP_RIGHT):new ne(n.left+n.width-S/3,n.top+f/3),this.bottomRightBorderDoubleOuterBox=m>0||g>0?_e(n.left+v,n.top+Q,m-S/3,g-F/3,ke.BOTTOM_RIGHT):new ne(n.left+n.width-S/3,n.top+n.height-F/3),this.bottomLeftBorderDoubleOuterBox=p>0||b>0?_e(n.left+w/3,n.top+x,p-w/3,b-F/3,ke.BOTTOM_LEFT):new ne(n.left+w/3,n.top+n.height-F/3),this.topLeftBorderDoubleInnerBox=i>0||o>0?_e(n.left+w*2/3,n.top+f*2/3,i-w*2/3,o-f*2/3,ke.TOP_LEFT):new ne(n.left+w*2/3,n.top+f*2/3),this.topRightBorderDoubleInnerBox=i>0||o>0?_e(n.left+j,n.top+f*2/3,l-S*2/3,c-f*2/3,ke.TOP_RIGHT):new ne(n.left+n.width-S*2/3,n.top+f*2/3),this.bottomRightBorderDoubleInnerBox=m>0||g>0?_e(n.left+v,n.top+Q,m-S*2/3,g-F*2/3,ke.BOTTOM_RIGHT):new ne(n.left+n.width-S*2/3,n.top+n.height-F*2/3),this.bottomLeftBorderDoubleInnerBox=p>0||b>0?_e(n.left+w*2/3,n.top+x,p-w*2/3,b-F*2/3,ke.BOTTOM_LEFT):new ne(n.left+w*2/3,n.top+n.height-F*2/3),this.topLeftBorderStroke=i>0||o>0?_e(n.left+w/2,n.top+f/2,i-w/2,o-f/2,ke.TOP_LEFT):new ne(n.left+w/2,n.top+f/2),this.topRightBorderStroke=i>0||o>0?_e(n.left+j,n.top+f/2,l-S/2,c-f/2,ke.TOP_RIGHT):new ne(n.left+n.width-S/2,n.top+f/2),this.bottomRightBorderStroke=m>0||g>0?_e(n.left+v,n.top+Q,m-S/2,g-F/2,ke.BOTTOM_RIGHT):new ne(n.left+n.width-S/2,n.top+n.height-F/2),this.bottomLeftBorderStroke=p>0||b>0?_e(n.left+w/2,n.top+x,p-w/2,b-F/2,ke.BOTTOM_LEFT):new ne(n.left+w/2,n.top+n.height-F/2),this.topLeftBorderBox=i>0||o>0?_e(n.left,n.top,i,o,ke.TOP_LEFT):new ne(n.left,n.top),this.topRightBorderBox=l>0||c>0?_e(n.left+j,n.top,l,c,ke.TOP_RIGHT):new ne(n.left+n.width,n.top),this.bottomRightBorderBox=m>0||g>0?_e(n.left+v,n.top+Q,m,g,ke.BOTTOM_RIGHT):new ne(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=p>0||b>0?_e(n.left,n.top+x,p,b,ke.BOTTOM_LEFT):new ne(n.left,n.top+n.height),this.topLeftPaddingBox=i>0||o>0?_e(n.left+w,n.top+f,Math.max(0,i-w),Math.max(0,o-f),ke.TOP_LEFT):new ne(n.left+w,n.top+f),this.topRightPaddingBox=l>0||c>0?_e(n.left+Math.min(j,n.width-S),n.top+f,j>n.width+S?0:Math.max(0,l-S),Math.max(0,c-f),ke.TOP_RIGHT):new ne(n.left+n.width-S,n.top+f),this.bottomRightPaddingBox=m>0||g>0?_e(n.left+Math.min(v,n.width-w),n.top+Math.min(Q,n.height-F),Math.max(0,m-S),Math.max(0,g-F),ke.BOTTOM_RIGHT):new ne(n.left+n.width-S,n.top+n.height-F),this.bottomLeftPaddingBox=p>0||b>0?_e(n.left+w,n.top+Math.min(x,n.height-F),Math.max(0,p-w),Math.max(0,b-F),ke.BOTTOM_LEFT):new ne(n.left+w,n.top+n.height-F),this.topLeftContentBox=i>0||o>0?_e(n.left+w+U,n.top+f+T,Math.max(0,i-(w+U)),Math.max(0,o-(f+T)),ke.TOP_LEFT):new ne(n.left+w+U,n.top+f+T),this.topRightContentBox=l>0||c>0?_e(n.left+Math.min(j,n.width+w+U),n.top+f+T,j>n.width+w+U?0:l-w+U,c-(f+T),ke.TOP_RIGHT):new ne(n.left+n.width-(S+C),n.top+f+T),this.bottomRightContentBox=m>0||g>0?_e(n.left+Math.min(v,n.width-(w+U)),n.top+Math.min(Q,n.height+f+T),Math.max(0,m-(S+C)),g-(F+E),ke.BOTTOM_RIGHT):new ne(n.left+n.width-(S+C),n.top+n.height-(F+E)),this.bottomLeftContentBox=p>0||b>0?_e(n.left+w+U,n.top+x,Math.max(0,p-(w+U)),b-(F+E),ke.BOTTOM_LEFT):new ne(n.left+w+U,n.top+n.height-(F+E))}return r}(),ke;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(ke||(ke={}));var _e=function(r,e,s,n,a){var i=4*((Math.sqrt(2)-1)/3),o=s*i,A=n*i,l=r+s,c=e+n;switch(a){case ke.TOP_LEFT:return new va(new ne(r,c),new ne(r,c-A),new ne(l-o,e),new ne(l,e));case ke.TOP_RIGHT:return new va(new ne(r,e),new ne(r+o,e),new ne(l,c-A),new ne(l,c));case ke.BOTTOM_RIGHT:return new va(new ne(l,e),new ne(l,e+A),new ne(r+o,c),new ne(r,c));case ke.BOTTOM_LEFT:default:return new va(new ne(l,c),new ne(l-o,c),new ne(r,e+A),new ne(r,e))}},ti=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},vx=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},ri=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},wx=function(){function r(e,s,n){this.offsetX=e,this.offsetY=s,this.matrix=n,this.type=0,this.target=6}return r}(),wa=function(){function r(e,s){this.path=e,this.target=s,this.type=1}return r}(),Bx=function(){function r(e){this.opacity=e,this.type=2,this.target=6}return r}(),Cx=function(r){return r.type===0},eu=function(r){return r.type===1},Nx=function(r){return r.type===2},vl=function(r,e){return r.length===e.length?r.some(function(s,n){return s===e[n]}):!1},jx=function(r,e,s,n,a){return r.map(function(i,o){switch(o){case 0:return i.add(e,s);case 1:return i.add(e+n,s);case 2:return i.add(e+n,s+a);case 3:return i.add(e,s+a)}return i})},tu=function(){function r(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),ru=function(){function r(e,s){if(this.container=e,this.parent=s,this.effects=[],this.curves=new yx(this.container),this.container.styles.opacity<1&&this.effects.push(new Bx(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,a=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new wx(n,a,i))}if(this.container.styles.overflowX!==0){var o=ti(this.curves),A=ri(this.curves);vl(o,A)?this.effects.push(new wa(o,6)):(this.effects.push(new wa(o,2)),this.effects.push(new wa(A,4)))}}return r.prototype.getEffects=function(e){for(var s=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,a=this.effects.slice(0);n;){var i=n.effects.filter(function(l){return!eu(l)});if(s||n.container.styles.position!==0||!n.parent){if(a.unshift.apply(a,i),s=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var o=ti(n.curves),A=ri(n.curves);vl(o,A)||a.unshift(new wa(A,6))}}else a.unshift.apply(a,i);n=n.parent}return a.filter(function(l){return st(l.target,e)})},r}(),Mo=function(r,e,s,n){r.container.elements.forEach(function(a){var i=st(a.flags,4),o=st(a.flags,2),A=new ru(a,r);st(a.styles.display,2048)&&n.push(A);var l=st(a.flags,8)?[]:n;if(i||o){var c=i||a.styles.isPositioned()?s:e,d=new tu(A);if(a.styles.isPositioned()||a.styles.opacity<1||a.styles.isTransformed()){var m=a.styles.zIndex.order;if(m<0){var g=0;c.negativeZIndex.some(function(p,b){return m>p.element.container.styles.zIndex.order?(g=b,!1):g>0}),c.negativeZIndex.splice(g,0,d)}else if(m>0){var h=0;c.positiveZIndex.some(function(p,b){return m>=p.element.container.styles.zIndex.order?(h=b+1,!1):h>0}),c.positiveZIndex.splice(h,0,d)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(d)}else a.styles.isFloating()?c.nonPositionedFloats.push(d):c.nonPositionedInlineLevel.push(d);Mo(A,d,i?d:s,l)}else a.styles.isInlineLevel()?e.inlineLevel.push(A):e.nonInlineLevel.push(A),Mo(A,e,s,l);st(a.flags,8)&&su(a,l)})},su=function(r,e){for(var s=r instanceof To?r.start:1,n=r instanceof To?r.reversed:!1,a=0;a<e.length;a++){var i=e[a];i.container instanceof Ld&&typeof i.container.value=="number"&&i.container.value!==0&&(s=i.container.value),i.listValue=Ln(s,i.container.styles.listStyleType,!0),s+=n?-1:1}},Sx=function(r){var e=new ru(r,null),s=new tu(e),n=[];return Mo(e,s,s,n),su(e.container,n),s},wl=function(r,e){switch(e){case 0:return $t(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return $t(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return $t(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return $t(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},Ex=function(r,e){switch(e){case 0:return $t(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return $t(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return $t(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return $t(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},Fx=function(r,e){switch(e){case 0:return $t(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return $t(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return $t(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return $t(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},Qx=function(r,e){switch(e){case 0:return Ba(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return Ba(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return Ba(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return Ba(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},Ba=function(r,e){var s=[];return Ot(r)?s.push(r.subdivide(.5,!1)):s.push(r),Ot(e)?s.push(e.subdivide(.5,!0)):s.push(e),s},$t=function(r,e,s,n){var a=[];return Ot(r)?a.push(r.subdivide(.5,!1)):a.push(r),Ot(s)?a.push(s.subdivide(.5,!0)):a.push(s),Ot(n)?a.push(n.subdivide(.5,!0).reverse()):a.push(n),Ot(e)?a.push(e.subdivide(.5,!1).reverse()):a.push(e),a},nu=function(r){var e=r.bounds,s=r.styles;return e.add(s.borderLeftWidth,s.borderTopWidth,-(s.borderRightWidth+s.borderLeftWidth),-(s.borderTopWidth+s.borderBottomWidth))},si=function(r){var e=r.styles,s=r.bounds,n=Oe(e.paddingLeft,s.width),a=Oe(e.paddingRight,s.width),i=Oe(e.paddingTop,s.width),o=Oe(e.paddingBottom,s.width);return s.add(n+e.borderLeftWidth,i+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+n+a),-(e.borderTopWidth+e.borderBottomWidth+i+o))},Ix=function(r,e){return r===0?e.bounds:r===2?si(e):nu(e)},Ux=function(r,e){return r===0?e.bounds:r===2?si(e):nu(e)},Xi=function(r,e,s){var n=Ix(Cs(r.styles.backgroundOrigin,e),r),a=Ux(Cs(r.styles.backgroundClip,e),r),i=Tx(Cs(r.styles.backgroundSize,e),s,n),o=i[0],A=i[1],l=bn(Cs(r.styles.backgroundPosition,e),n.width-o,n.height-A),c=kx(Cs(r.styles.backgroundRepeat,e),l,i,n,a),d=Math.round(n.left+l[0]),m=Math.round(n.top+l[1]);return[c,d,m,o,A]},ys=function(r){return Me(r)&&r.value===$s.AUTO},Ca=function(r){return typeof r=="number"},Tx=function(r,e,s){var n=e[0],a=e[1],i=e[2],o=r[0],A=r[1];if(!o)return[0,0];if(et(o)&&A&&et(A))return[Oe(o,s.width),Oe(A,s.height)];var l=Ca(i);if(Me(o)&&(o.value===$s.CONTAIN||o.value===$s.COVER)){if(Ca(i)){var c=s.width/s.height;return c<i!=(o.value===$s.COVER)?[s.width,s.width/i]:[s.height*i,s.height]}return[s.width,s.height]}var d=Ca(n),m=Ca(a),g=d||m;if(ys(o)&&(!A||ys(A))){if(d&&m)return[n,a];if(!l&&!g)return[s.width,s.height];if(g&&l){var h=d?n:a*i,p=m?a:n/i;return[h,p]}var b=d?n:s.width,N=m?a:s.height;return[b,N]}if(l){var y=0,j=0;return et(o)?y=Oe(o,s.width):et(A)&&(j=Oe(A,s.height)),ys(o)?y=j*i:(!A||ys(A))&&(j=y/i),[y,j]}var Q=null,v=null;if(et(o)?Q=Oe(o,s.width):A&&et(A)&&(v=Oe(A,s.height)),Q!==null&&(!A||ys(A))&&(v=d&&m?Q/n*a:s.height),v!==null&&ys(o)&&(Q=d&&m?v/a*n:s.width),Q!==null&&v!==null)return[Q,v];throw new Error("Unable to calculate background-size for element")},Cs=function(r,e){var s=r[e];return typeof s>"u"?r[0]:s},kx=function(r,e,s,n,a){var i=e[0],o=e[1],A=s[0],l=s[1];switch(r){case 2:return[new ne(Math.round(n.left),Math.round(n.top+o)),new ne(Math.round(n.left+n.width),Math.round(n.top+o)),new ne(Math.round(n.left+n.width),Math.round(l+n.top+o)),new ne(Math.round(n.left),Math.round(l+n.top+o))];case 3:return[new ne(Math.round(n.left+i),Math.round(n.top)),new ne(Math.round(n.left+i+A),Math.round(n.top)),new ne(Math.round(n.left+i+A),Math.round(n.height+n.top)),new ne(Math.round(n.left+i),Math.round(n.height+n.top))];case 1:return[new ne(Math.round(n.left+i),Math.round(n.top+o)),new ne(Math.round(n.left+i+A),Math.round(n.top+o)),new ne(Math.round(n.left+i+A),Math.round(n.top+o+l)),new ne(Math.round(n.left+i),Math.round(n.top+o+l))];default:return[new ne(Math.round(a.left),Math.round(a.top)),new ne(Math.round(a.left+a.width),Math.round(a.top)),new ne(Math.round(a.left+a.width),Math.round(a.height+a.top)),new ne(Math.round(a.left),Math.round(a.height+a.top))]}},Px="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Bl="Hidden Text",Dx=function(){function r(e){this._data={},this._document=e}return r.prototype.parseMetrics=function(e,s){var n=this._document.createElement("div"),a=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=s,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",o.appendChild(n),a.src=Px,a.width=1,a.height=1,a.style.margin="0",a.style.padding="0",a.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=s,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(Bl)),n.appendChild(i),n.appendChild(a);var A=a.offsetTop-i.offsetTop+2;n.removeChild(i),n.appendChild(this._document.createTextNode(Bl)),n.style.lineHeight="normal",a.style.verticalAlign="super";var l=a.offsetTop-n.offsetTop+2;return o.removeChild(n),{baseline:A,middle:l}},r.prototype.getMetrics=function(e,s){var n=e+" "+s;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(e,s)),this._data[n]},r}(),au=function(){function r(e,s){this.context=e,this.options=s}return r}(),Rx=1e4,Mx=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;return a._activeEffects=[],a.canvas=n.canvas?n.canvas:document.createElement("canvas"),a.ctx=a.canvas.getContext("2d"),n.canvas||(a.canvas.width=Math.floor(n.width*n.scale),a.canvas.height=Math.floor(n.height*n.scale),a.canvas.style.width=n.width+"px",a.canvas.style.height=n.height+"px"),a.fontMetrics=new Dx(document),a.ctx.scale(a.options.scale,a.options.scale),a.ctx.translate(-n.x,-n.y),a.ctx.textBaseline="bottom",a._activeEffects=[],a.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),a}return e.prototype.applyEffects=function(s){for(var n=this;this._activeEffects.length;)this.popEffect();s.forEach(function(a){return n.applyEffect(a)})},e.prototype.applyEffect=function(s){this.ctx.save(),Nx(s)&&(this.ctx.globalAlpha=s.opacity),Cx(s)&&(this.ctx.translate(s.offsetX,s.offsetY),this.ctx.transform(s.matrix[0],s.matrix[1],s.matrix[2],s.matrix[3],s.matrix[4],s.matrix[5]),this.ctx.translate(-s.offsetX,-s.offsetY)),eu(s)&&(this.path(s.path),this.ctx.clip()),this._activeEffects.push(s)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(s){return Bt(this,void 0,void 0,function(){var n;return ht(this,function(a){switch(a.label){case 0:return n=s.element.container.styles,n.isVisible()?[4,this.renderStackContent(s)]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(s){return Bt(this,void 0,void 0,function(){return ht(this,function(n){switch(n.label){case 0:if(st(s.container.flags,16))debugger;return s.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(s)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(s)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(s,n,a){var i=this;if(n===0)this.ctx.fillText(s.text,s.bounds.left,s.bounds.top+a);else{var o=aA(s.text);o.reduce(function(A,l){return i.ctx.fillText(l,A,s.bounds.top+a),A+i.ctx.measureText(l).width},s.bounds.left)}},e.prototype.createFontStyle=function(s){var n=s.fontVariant.filter(function(o){return o==="normal"||o==="small-caps"}).join(""),a=$x(s.fontFamily).join(", "),i=Kn(s.fontSize)?""+s.fontSize.number+s.fontSize.unit:s.fontSize.number+"px";return[[s.fontStyle,n,s.fontWeight,i,a].join(" "),a,i]},e.prototype.renderTextNode=function(s,n){return Bt(this,void 0,void 0,function(){var a,i,o,A,l,c,d,m,g=this;return ht(this,function(h){return a=this.createFontStyle(n),i=a[0],o=a[1],A=a[2],this.ctx.font=i,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",l=this.fontMetrics.getMetrics(o,A),c=l.baseline,d=l.middle,m=n.paintOrder,s.textBounds.forEach(function(p){m.forEach(function(b){switch(b){case 0:g.ctx.fillStyle=it(n.color),g.renderTextWithLetterSpacing(p,n.letterSpacing,c);var N=n.textShadow;N.length&&p.text.trim().length&&(N.slice(0).reverse().forEach(function(y){g.ctx.shadowColor=it(y.color),g.ctx.shadowOffsetX=y.offsetX.number*g.options.scale,g.ctx.shadowOffsetY=y.offsetY.number*g.options.scale,g.ctx.shadowBlur=y.blur.number,g.renderTextWithLetterSpacing(p,n.letterSpacing,c)}),g.ctx.shadowColor="",g.ctx.shadowOffsetX=0,g.ctx.shadowOffsetY=0,g.ctx.shadowBlur=0),n.textDecorationLine.length&&(g.ctx.fillStyle=it(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(y){switch(y){case 1:g.ctx.fillRect(p.bounds.left,Math.round(p.bounds.top+c),p.bounds.width,1);break;case 2:g.ctx.fillRect(p.bounds.left,Math.round(p.bounds.top),p.bounds.width,1);break;case 3:g.ctx.fillRect(p.bounds.left,Math.ceil(p.bounds.top+d),p.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&p.text.trim().length&&(g.ctx.strokeStyle=it(n.webkitTextStrokeColor),g.ctx.lineWidth=n.webkitTextStrokeWidth,g.ctx.lineJoin=window.chrome?"miter":"round",g.ctx.strokeText(p.text,p.bounds.left,p.bounds.top+c)),g.ctx.strokeStyle="",g.ctx.lineWidth=0,g.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(s,n,a){if(a&&s.intrinsicWidth>0&&s.intrinsicHeight>0){var i=si(s),o=ri(n);this.path(o),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(a,0,0,s.intrinsicWidth,s.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(s){return Bt(this,void 0,void 0,function(){var n,a,i,o,A,l,j,j,c,d,m,g,v,h,p,x,b,N,y,j,Q,v,x;return ht(this,function(f){switch(f.label){case 0:this.applyEffects(s.getEffects(4)),n=s.container,a=s.curves,i=n.styles,o=0,A=n.textNodes,f.label=1;case 1:return o<A.length?(l=A[o],[4,this.renderTextNode(l,i)]):[3,4];case 2:f.sent(),f.label=3;case 3:return o++,[3,1];case 4:if(!(n instanceof Rd))return[3,8];f.label=5;case 5:return f.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return j=f.sent(),this.renderReplacedElement(n,a,j),[3,8];case 7:return f.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof Md&&this.renderReplacedElement(n,a,n.canvas),!(n instanceof Hd))return[3,12];f.label=9;case 9:return f.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return j=f.sent(),this.renderReplacedElement(n,a,j),[3,12];case 11:return f.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof $d&&n.tree?(c=new e(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,c.render(n.tree)]):[3,14];case 13:d=f.sent(),n.width&&n.height&&this.ctx.drawImage(d,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),f.label=14;case 14:if(n instanceof iA&&(m=Math.min(n.bounds.width,n.bounds.height),n.type===Ya?n.checked&&(this.ctx.save(),this.path([new ne(n.bounds.left+m*.39363,n.bounds.top+m*.79),new ne(n.bounds.left+m*.16,n.bounds.top+m*.5549),new ne(n.bounds.left+m*.27347,n.bounds.top+m*.44071),new ne(n.bounds.left+m*.39694,n.bounds.top+m*.5649),new ne(n.bounds.left+m*.72983,n.bounds.top+m*.23),new ne(n.bounds.left+m*.84,n.bounds.top+m*.34085),new ne(n.bounds.left+m*.39363,n.bounds.top+m*.79)]),this.ctx.fillStyle=it(cl),this.ctx.fill(),this.ctx.restore()):n.type===Ja&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+m/2,n.bounds.top+m/2,m/4,0,Math.PI*2,!0),this.ctx.fillStyle=it(cl),this.ctx.fill(),this.ctx.restore())),Hx(n)&&n.value.length){switch(g=this.createFontStyle(i),v=g[0],h=g[1],p=this.fontMetrics.getMetrics(v,h).baseline,this.ctx.font=v,this.ctx.fillStyle=it(i.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Ox(n.styles.textAlign),x=si(n),b=0,n.styles.textAlign){case 1:b+=x.width/2;break;case 2:b+=x.width;break}N=x.add(b,0,0,-x.height/2+1),this.ctx.save(),this.path([new ne(x.left,x.top),new ne(x.left+x.width,x.top),new ne(x.left+x.width,x.top+x.height),new ne(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Tn(n.value,N),i.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!st(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(y=n.styles.listStyleImage,y.type!==0)return[3,18];j=void 0,Q=y.url,f.label=15;case 15:return f.trys.push([15,17,,18]),[4,this.context.cache.match(Q)];case 16:return j=f.sent(),this.ctx.drawImage(j,n.bounds.left-(j.width+10),n.bounds.top),[3,18];case 17:return f.sent(),this.context.logger.error("Error loading list-style-image "+Q),[3,18];case 18:return[3,20];case 19:s.listValue&&n.styles.listStyleType!==-1&&(v=this.createFontStyle(i)[0],this.ctx.font=v,this.ctx.fillStyle=it(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new Ir(n.bounds.left,n.bounds.top+Oe(n.styles.paddingTop,n.bounds.width),n.bounds.width,WA(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Tn(s.listValue,x),i.letterSpacing,WA(i.lineHeight,i.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),f.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(s){return Bt(this,void 0,void 0,function(){var n,a,y,i,o,y,A,l,y,c,d,y,m,g,y,h,p,y,b,N,y;return ht(this,function(j){switch(j.label){case 0:if(st(s.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(s.element)];case 1:j.sent(),n=0,a=s.negativeZIndex,j.label=2;case 2:return n<a.length?(y=a[n],[4,this.renderStack(y)]):[3,5];case 3:j.sent(),j.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(s.element)];case 6:j.sent(),i=0,o=s.nonInlineLevel,j.label=7;case 7:return i<o.length?(y=o[i],[4,this.renderNode(y)]):[3,10];case 8:j.sent(),j.label=9;case 9:return i++,[3,7];case 10:A=0,l=s.nonPositionedFloats,j.label=11;case 11:return A<l.length?(y=l[A],[4,this.renderStack(y)]):[3,14];case 12:j.sent(),j.label=13;case 13:return A++,[3,11];case 14:c=0,d=s.nonPositionedInlineLevel,j.label=15;case 15:return c<d.length?(y=d[c],[4,this.renderStack(y)]):[3,18];case 16:j.sent(),j.label=17;case 17:return c++,[3,15];case 18:m=0,g=s.inlineLevel,j.label=19;case 19:return m<g.length?(y=g[m],[4,this.renderNode(y)]):[3,22];case 20:j.sent(),j.label=21;case 21:return m++,[3,19];case 22:h=0,p=s.zeroOrAutoZIndexOrTransformedOrOpacity,j.label=23;case 23:return h<p.length?(y=p[h],[4,this.renderStack(y)]):[3,26];case 24:j.sent(),j.label=25;case 25:return h++,[3,23];case 26:b=0,N=s.positiveZIndex,j.label=27;case 27:return b<N.length?(y=N[b],[4,this.renderStack(y)]):[3,30];case 28:j.sent(),j.label=29;case 29:return b++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(s){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(s.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(s){this.ctx.beginPath(),this.formatPath(s),this.ctx.closePath()},e.prototype.formatPath=function(s){var n=this;s.forEach(function(a,i){var o=Ot(a)?a.start:a;i===0?n.ctx.moveTo(o.x,o.y):n.ctx.lineTo(o.x,o.y),Ot(a)&&n.ctx.bezierCurveTo(a.startControl.x,a.startControl.y,a.endControl.x,a.endControl.y,a.end.x,a.end.y)})},e.prototype.renderRepeat=function(s,n,a,i){this.path(s),this.ctx.fillStyle=n,this.ctx.translate(a,i),this.ctx.fill(),this.ctx.translate(-a,-i)},e.prototype.resizeImage=function(s,n,a){var i;if(s.width===n&&s.height===a)return s;var o=(i=this.canvas.ownerDocument)!==null&&i!==void 0?i:document,A=o.createElement("canvas");A.width=Math.max(1,n),A.height=Math.max(1,a);var l=A.getContext("2d");return l.drawImage(s,0,0,s.width,s.height,0,0,n,a),A},e.prototype.renderBackgroundImage=function(s){return Bt(this,void 0,void 0,function(){var n,a,i,o,A,l;return ht(this,function(c){switch(c.label){case 0:n=s.styles.backgroundImage.length-1,a=function(d){var m,g,h,T,M,$,U,k,F,p,T,M,$,U,k,b,N,y,j,Q,v,x,f,S,F,w,T,C,E,U,k,P,M,$,W,V,L,O,z,H,X,Ae;return ht(this,function(D){switch(D.label){case 0:if(d.type!==0)return[3,5];m=void 0,g=d.url,D.label=1;case 1:return D.trys.push([1,3,,4]),[4,i.context.cache.match(g)];case 2:return m=D.sent(),[3,4];case 3:return D.sent(),i.context.logger.error("Error loading background-image "+g),[3,4];case 4:return m&&(h=Xi(s,n,[m.width,m.height,m.width/m.height]),T=h[0],M=h[1],$=h[2],U=h[3],k=h[4],F=i.ctx.createPattern(i.resizeImage(m,U,k),"repeat"),i.renderRepeat(T,F,M,$)),[3,6];case 5:Bh(d)?(p=Xi(s,n,[null,null,null]),T=p[0],M=p[1],$=p[2],U=p[3],k=p[4],b=xh(d.angle,U,k),N=b[0],y=b[1],j=b[2],Q=b[3],v=b[4],x=document.createElement("canvas"),x.width=U,x.height=k,f=x.getContext("2d"),S=f.createLinearGradient(y,Q,j,v),VA(d.stops,N).forEach(function(K){return S.addColorStop(K.stop,it(K.color))}),f.fillStyle=S,f.fillRect(0,0,U,k),U>0&&k>0&&(F=i.ctx.createPattern(x,"repeat"),i.renderRepeat(T,F,M,$))):Ch(d)&&(w=Xi(s,n,[null,null,null]),T=w[0],C=w[1],E=w[2],U=w[3],k=w[4],P=d.position.length===0?[rA]:d.position,M=Oe(P[0],U),$=Oe(P[P.length-1],k),W=bh(d,M,$,U,k),V=W[0],L=W[1],V>0&&L>0&&(O=i.ctx.createRadialGradient(C+M,E+$,0,C+M,E+$,V),VA(d.stops,V*2).forEach(function(K){return O.addColorStop(K.stop,it(K.color))}),i.path(T),i.ctx.fillStyle=O,V!==L?(z=s.bounds.left+.5*s.bounds.width,H=s.bounds.top+.5*s.bounds.height,X=L/V,Ae=1/X,i.ctx.save(),i.ctx.translate(z,H),i.ctx.transform(1,0,0,X,0,0),i.ctx.translate(-z,-H),i.ctx.fillRect(C,Ae*(E-H)+H,U,k*Ae),i.ctx.restore()):i.ctx.fill())),D.label=6;case 6:return n--,[2]}})},i=this,o=0,A=s.styles.backgroundImage.slice(0).reverse(),c.label=1;case 1:return o<A.length?(l=A[o],[5,a(l)]):[3,4];case 2:c.sent(),c.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(s,n,a){return Bt(this,void 0,void 0,function(){return ht(this,function(i){return this.path(wl(a,n)),this.ctx.fillStyle=it(s),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(s,n,a,i){return Bt(this,void 0,void 0,function(){var o,A;return ht(this,function(l){switch(l.label){case 0:return n<3?[4,this.renderSolidBorder(s,a,i)]:[3,2];case 1:return l.sent(),[2];case 2:return o=Ex(i,a),this.path(o),this.ctx.fillStyle=it(s),this.ctx.fill(),A=Fx(i,a),this.path(A),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(s){return Bt(this,void 0,void 0,function(){var n,a,i,o,A,l,c,d,m=this;return ht(this,function(g){switch(g.label){case 0:return this.applyEffects(s.getEffects(2)),n=s.container.styles,a=!Xr(n.backgroundColor)||n.backgroundImage.length,i=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],o=Lx(Cs(n.backgroundClip,0),s.curves),a||n.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),Xr(n.backgroundColor)||(this.ctx.fillStyle=it(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(s.container)]):[3,2];case 1:g.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(h){m.ctx.save();var p=ti(s.curves),b=h.inset?0:Rx,N=jx(p,-b+(h.inset?1:-1)*h.spread.number,(h.inset?1:-1)*h.spread.number,h.spread.number*(h.inset?-2:2),h.spread.number*(h.inset?-2:2));h.inset?(m.path(p),m.ctx.clip(),m.mask(N)):(m.mask(p),m.ctx.clip(),m.path(N)),m.ctx.shadowOffsetX=h.offsetX.number+b,m.ctx.shadowOffsetY=h.offsetY.number,m.ctx.shadowColor=it(h.color),m.ctx.shadowBlur=h.blur.number,m.ctx.fillStyle=h.inset?it(h.color):"rgba(0,0,0,1)",m.ctx.fill(),m.ctx.restore()}),g.label=2;case 2:A=0,l=0,c=i,g.label=3;case 3:return l<c.length?(d=c[l],d.style!==0&&!Xr(d.color)&&d.width>0?d.style!==2?[3,5]:[4,this.renderDashedDottedBorder(d.color,d.width,A,s.curves,2)]:[3,11]):[3,13];case 4:return g.sent(),[3,11];case 5:return d.style!==3?[3,7]:[4,this.renderDashedDottedBorder(d.color,d.width,A,s.curves,3)];case 6:return g.sent(),[3,11];case 7:return d.style!==4?[3,9]:[4,this.renderDoubleBorder(d.color,d.width,A,s.curves)];case 8:return g.sent(),[3,11];case 9:return[4,this.renderSolidBorder(d.color,A,s.curves)];case 10:g.sent(),g.label=11;case 11:A++,g.label=12;case 12:return l++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(s,n,a,i,o){return Bt(this,void 0,void 0,function(){var A,l,c,d,m,g,h,p,b,N,y,j,Q,v,x,f,x,f;return ht(this,function(S){return this.ctx.save(),A=Qx(i,a),l=wl(i,a),o===2&&(this.path(l),this.ctx.clip()),Ot(l[0])?(c=l[0].start.x,d=l[0].start.y):(c=l[0].x,d=l[0].y),Ot(l[1])?(m=l[1].end.x,g=l[1].end.y):(m=l[1].x,g=l[1].y),a===0||a===2?h=Math.abs(c-m):h=Math.abs(d-g),this.ctx.beginPath(),o===3?this.formatPath(A):this.formatPath(l.slice(0,2)),p=n<3?n*3:n*2,b=n<3?n*2:n,o===3&&(p=n,b=n),N=!0,h<=p*2?N=!1:h<=p*2+b?(y=h/(2*p+b),p*=y,b*=y):(j=Math.floor((h+b)/(p+b)),Q=(h-j*p)/(j-1),v=(h-(j+1)*p)/j,b=v<=0||Math.abs(b-Q)<Math.abs(b-v)?Q:v),N&&(o===3?this.ctx.setLineDash([0,p+b]):this.ctx.setLineDash([p,b])),o===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=it(s),this.ctx.stroke(),this.ctx.setLineDash([]),o===2&&(Ot(l[0])&&(x=l[3],f=l[0],this.ctx.beginPath(),this.formatPath([new ne(x.end.x,x.end.y),new ne(f.start.x,f.start.y)]),this.ctx.stroke()),Ot(l[1])&&(x=l[1],f=l[2],this.ctx.beginPath(),this.formatPath([new ne(x.end.x,x.end.y),new ne(f.start.x,f.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(s){return Bt(this,void 0,void 0,function(){var n;return ht(this,function(a){switch(a.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=it(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=Sx(s),[4,this.renderStack(n)];case 1:return a.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(au),Hx=function(r){return r instanceof _d||r instanceof Od?!0:r instanceof iA&&r.type!==Ja&&r.type!==Ya},Lx=function(r,e){switch(r){case 0:return ti(e);case 2:return vx(e);case 1:default:return ri(e)}},Ox=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},_x=["-apple-system","system-ui"],$x=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(e){return _x.indexOf(e)===-1}):r},Kx=function(r){rr(e,r);function e(s,n){var a=r.call(this,s,n)||this;return a.canvas=n.canvas?n.canvas:document.createElement("canvas"),a.ctx=a.canvas.getContext("2d"),a.options=n,a.canvas.width=Math.floor(n.width*n.scale),a.canvas.height=Math.floor(n.height*n.scale),a.canvas.style.width=n.width+"px",a.canvas.style.height=n.height+"px",a.ctx.scale(a.options.scale,a.options.scale),a.ctx.translate(-n.x,-n.y),a.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),a}return e.prototype.render=function(s){return Bt(this,void 0,void 0,function(){var n,a;return ht(this,function(i){switch(i.label){case 0:return n=Uo(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,s),[4,Vx(n)];case 1:return a=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=it(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(a,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(au),Vx=function(r){return new Promise(function(e,s){var n=new Image;n.onload=function(){e(n)},n.onerror=s,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Gx=function(){function r(e){var s=e.id,n=e.enabled;this.id=s,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,ra([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,ra([this.id,this.getTime()+"ms"],e))},r.prototype.warn=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,ra([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.error=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,ra([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.instances={},r}(),Wx=function(){function r(e,s){var n;this.windowBounds=s,this.instanceName="#"+r.instanceCount++,this.logger=new Gx({id:this.instanceName,enabled:e.logging}),this.cache=(n=e.cache)!==null&&n!==void 0?n:new mx(this,e)}return r.instanceCount=1,r}(),AA=function(r,e){return e===void 0&&(e={}),zx(r,e)};typeof window<"u"&&Zd.setContext(window);var zx=function(r,e){return Bt(void 0,void 0,void 0,function(){var s,n,a,i,o,A,l,c,d,m,g,h,p,b,N,y,j,Q,v,x,S,f,S,F,w,T,C,E,U,k,P,M,$,W,V,L,O,z,H,X;return ht(this,function(Ae){switch(Ae.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(s=r.ownerDocument,!s)throw new Error("Element is not attached to a Document");if(n=s.defaultView,!n)throw new Error("Document is not attached to a Window");return a={allowTaint:(F=e.allowTaint)!==null&&F!==void 0?F:!1,imageTimeout:(w=e.imageTimeout)!==null&&w!==void 0?w:15e3,proxy:e.proxy,useCORS:(T=e.useCORS)!==null&&T!==void 0?T:!1},i=fo({logging:(C=e.logging)!==null&&C!==void 0?C:!0,cache:e.cache},a),o={windowWidth:(E=e.windowWidth)!==null&&E!==void 0?E:n.innerWidth,windowHeight:(U=e.windowHeight)!==null&&U!==void 0?U:n.innerHeight,scrollX:(k=e.scrollX)!==null&&k!==void 0?k:n.pageXOffset,scrollY:(P=e.scrollY)!==null&&P!==void 0?P:n.pageYOffset},A=new Ir(o.scrollX,o.scrollY,o.windowWidth,o.windowHeight),l=new Wx(i,A),c=(M=e.foreignObjectRendering)!==null&&M!==void 0?M:!1,d={allowTaint:($=e.allowTaint)!==null&&$!==void 0?$:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:c,copyStyles:c},l.logger.debug("Starting document clone with size "+A.width+"x"+A.height+" scrolled to "+-A.left+","+-A.top),m=new bl(l,r,d),g=m.clonedReferenceElement,g?[4,m.toIFrame(s,A)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return h=Ae.sent(),p=oA(g)||q0(g)?Np(g.ownerDocument):ui(l,g),b=p.width,N=p.height,y=p.left,j=p.top,Q=Xx(l,g,e.backgroundColor),v={canvas:e.canvas,backgroundColor:Q,scale:(V=(W=e.scale)!==null&&W!==void 0?W:n.devicePixelRatio)!==null&&V!==void 0?V:1,x:((L=e.x)!==null&&L!==void 0?L:0)+y,y:((O=e.y)!==null&&O!==void 0?O:0)+j,width:(z=e.width)!==null&&z!==void 0?z:Math.ceil(b),height:(H=e.height)!==null&&H!==void 0?H:Math.ceil(N)},c?(l.logger.debug("Document cloned, using foreign object rendering"),S=new Kx(l,v),[4,S.render(g)]):[3,3];case 2:return x=Ae.sent(),[3,5];case 3:return l.logger.debug("Document cloned, element located at "+y+","+j+" with size "+b+"x"+N+" using computed rendering"),l.logger.debug("Starting DOM parsing"),f=Vd(l,g),Q===f.styles.backgroundColor&&(f.styles.backgroundColor=Sr.TRANSPARENT),l.logger.debug("Starting renderer for element at "+v.x+","+v.y+" with size "+v.width+"x"+v.height),S=new Mx(l,v),[4,S.render(f)];case 4:x=Ae.sent(),Ae.label=5;case 5:return(!((X=e.removeContainer)!==null&&X!==void 0)||X)&&(bl.destroy(h)||l.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),l.logger.debug("Finished rendering"),[2,x]}})})},Xx=function(r,e,s){var n=e.ownerDocument,a=n.documentElement?In(r,getComputedStyle(n.documentElement).backgroundColor):Sr.TRANSPARENT,i=n.body?In(r,getComputedStyle(n.body).backgroundColor):Sr.TRANSPARENT,o=typeof s=="string"?In(r,s):s===null?Sr.TRANSPARENT:4294967295;return e===n.documentElement?Xr(a)?Xr(i)?o:i:a:o};const qx=({rhcData:r,patientInfo:e,operatorInfo:s})=>{const{haemodynamicPressures:n,cardiacOutput:a,rhcData:i,calculations:o}=r,A=o?Object.keys(o).filter(g=>{const h=o[g];return h!=null}):[];console.log("üÉè RHC Card Rendering:",{ra:n.ra,rv:n.rv,pa:n.pa,pcwp:n.pcwp,cardiacOutput:{thermodilution:a.thermodilution,fick:a.fick},hasCalculations:!!o,calculationFields:A,procedureDetails:{fluoroscopyTime:i?.fluoroscopyTime,fluoroscopyDose:i?.fluoroscopyDose,doseAreaProduct:i?.doseAreaProduct}});const l=(g,h,p)=>{if(!g)return!1;const b=parseFloat(g);return b>=h&&b<=p},c=(g,h,p)=>g?l(g,h,p)?"#10B981":"#EF4444":"#9CA3AF",m=(()=>{const g=n.pa.mean,h=n.pcwp.mean,p=a.thermodilution.co||a.fick.co;return g&&h&&p?((parseFloat(g)-parseFloat(h))/parseFloat(p)*80).toFixed(1):null})();return t.jsxs("div",{style:{width:"13cm",height:"13cm",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backgroundColor:"#FFFFFF",padding:"20px",boxSizing:"border-box",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{borderBottom:"3px solid #3B82F6",paddingBottom:"10px",marginBottom:"10px"},children:[t.jsx("h1",{style:{margin:0,fontSize:"24px",fontWeight:"700",color:"#1F2937",letterSpacing:"-0.5px"},children:"Right Heart Catheterisation"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"13px",color:"#6B7280"},children:[t.jsxs("div",{children:[e?.name&&t.jsxs("div",{children:[t.jsx("strong",{children:"Name:"})," ",e.name]}),e?.mrn&&t.jsxs("div",{children:[t.jsx("strong",{children:"MRN:"})," ",e.mrn]})]}),t.jsxs("div",{style:{textAlign:"right"},children:[s?.date&&t.jsx("div",{children:s.date}),i.indication&&t.jsx("div",{style:{fontSize:"11px",fontStyle:"italic"},children:i.indication.replace(/_/g," ")})]})]})]}),t.jsxs("div",{style:{marginBottom:"10px"},children:[t.jsx("h2",{style:{margin:"0 0 8px 0",fontSize:"16px",fontWeight:"600",color:"#374151"},children:"Haemodynamic Pressures"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[t.jsxs("div",{style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"10px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6B7280",marginBottom:"6px"},children:"Right Atrial (RA)"}),(n.ra.mean||n.ra.aWave||n.ra.vWave)&&t.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:c(n.ra.mean,2,8)},children:n.ra.mean?`${n.ra.mean} mmHg`:`${n.ra.aWave||"‚Äì"}/${n.ra.vWave||"‚Äì"} mmHg`}),t.jsx("div",{style:{fontSize:"10px",color:"#9CA3AF",marginTop:"4px"},children:"Normal: 2-8 mmHg"})]}),t.jsxs("div",{style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"10px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6B7280",marginBottom:"6px"},children:"Right Ventricular (RV)"}),(n.rv.systolic||n.rv.diastolic||n.rv.rvedp)&&t.jsxs(t.Fragment,{children:[(n.rv.systolic||n.rv.diastolic)&&t.jsxs("div",{style:{fontSize:"20px",fontWeight:"700",color:c(n.rv.systolic,15,30)},children:[n.rv.systolic||"‚Äì","/",n.rv.diastolic||"‚Äì"]}),n.rv.rvedp&&t.jsxs("div",{style:{fontSize:"12px",color:"#6B7280",marginTop:"2px"},children:["RVEDP: ",n.rv.rvedp," mmHg"]})]}),t.jsx("div",{style:{fontSize:"10px",color:"#9CA3AF",marginTop:"4px"},children:"Normal: 15-30/2-8 mmHg"})]}),t.jsxs("div",{style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"10px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6B7280",marginBottom:"6px"},children:"Pulmonary Artery (PA)"}),n.pa.systolic&&n.pa.diastolic&&n.pa.mean&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"20px",fontWeight:"700",color:c(n.pa.mean,9,18)},children:[n.pa.systolic,"/",n.pa.diastolic]}),t.jsxs("div",{style:{fontSize:"14px",color:"#6B7280"},children:["(mean: ",n.pa.mean,")"]})]}),t.jsx("div",{style:{fontSize:"10px",color:"#9CA3AF",marginTop:"2px"},children:"Normal: 15-30/4-12 (9-18) mmHg"})]}),t.jsxs("div",{style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"10px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6B7280",marginBottom:"6px"},children:"PCWP"}),(n.pcwp.mean||n.pcwp.aWave||n.pcwp.vWave)&&t.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:c(n.pcwp.mean,6,15)},children:n.pcwp.mean?`${n.pcwp.mean} mmHg`:`${n.pcwp.aWave||"‚Äì"}/${n.pcwp.vWave||"‚Äì"} mmHg`}),t.jsx("div",{style:{fontSize:"10px",color:"#9CA3AF",marginTop:"4px"},children:"Normal: 6-15 mmHg"})]})]})]}),t.jsxs("div",{style:{marginBottom:"10px"},children:[t.jsx("h2",{style:{margin:"0 0 8px 0",fontSize:"16px",fontWeight:"600",color:"#374151"},children:"Cardiac Output Assessment"}),t.jsxs("div",{style:{backgroundColor:"#EFF6FF",border:"1px solid #BFDBFE",borderRadius:"8px",padding:"12px",display:"flex",justifyContent:"space-between"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#1E40AF",marginBottom:"4px"},children:"Thermodilution"}),a.thermodilution.co&&t.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#1E3A8A"},children:[a.thermodilution.co," L/min"]}),a.thermodilution.ci&&t.jsxs("div",{style:{fontSize:"13px",color:"#3B82F6"},children:["CI: ",a.thermodilution.ci," L/min/m¬≤"]})]}),(a.fick.co||a.fick.ci)&&t.jsxs("div",{style:{flex:1,borderLeft:"1px solid #BFDBFE",paddingLeft:"12px"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#1E40AF",marginBottom:"4px"},children:"Fick Method"}),a.fick.co&&t.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#1E3A8A"},children:[a.fick.co," L/min"]}),a.fick.ci&&t.jsxs("div",{style:{fontSize:"13px",color:"#3B82F6"},children:["CI: ",a.fick.ci," L/min/m¬≤"]})]})]})]}),(i.fluoroscopyTime||i.fluoroscopyDose||i.doseAreaProduct||i.contrastVolume)&&t.jsx("div",{style:{marginBottom:"10px"},children:t.jsxs("div",{style:{backgroundColor:"#F0FDF4",border:"1px solid #BBF7D0",borderRadius:"8px",padding:"8px",display:"flex",gap:"12px",flexWrap:"wrap"},children:[i.fluoroscopyTime&&t.jsxs("div",{style:{flex:"1 1 auto"},children:[t.jsx("div",{style:{fontSize:"10px",color:"#16A34A",fontWeight:"600"},children:"Fluoro Time"}),t.jsxs("div",{style:{fontSize:"14px",fontWeight:"700",color:"#15803D"},children:[i.fluoroscopyTime," min"]})]}),i.fluoroscopyDose&&t.jsxs("div",{style:{flex:"1 1 auto"},children:[t.jsx("div",{style:{fontSize:"10px",color:"#16A34A",fontWeight:"600"},children:"Dose"}),t.jsxs("div",{style:{fontSize:"14px",fontWeight:"700",color:"#15803D"},children:[i.fluoroscopyDose," mGy"]})]}),i.doseAreaProduct&&t.jsxs("div",{style:{flex:"1 1 auto"},children:[t.jsx("div",{style:{fontSize:"10px",color:"#16A34A",fontWeight:"600"},children:"DAP"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:"#15803D"},children:i.doseAreaProduct})]}),i.contrastVolume&&t.jsxs("div",{style:{flex:"1 1 auto"},children:[t.jsx("div",{style:{fontSize:"10px",color:"#16A34A",fontWeight:"600"},children:"Contrast"}),t.jsxs("div",{style:{fontSize:"14px",fontWeight:"700",color:"#15803D"},children:[i.contrastVolume," mL"]})]})]})}),(o||m)&&t.jsxs("div",{style:{marginBottom:"10px"},children:[t.jsx("h2",{style:{margin:"0 0 6px 0",fontSize:"15px",fontWeight:"600",color:"#374151"},children:"Calculated Haemodynamics"}),t.jsxs("div",{style:{backgroundColor:"#F3F4F6",borderRadius:"8px",padding:"8px",display:"flex",gap:"10px"},children:[o?.cardiacIndex&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"CI"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:o.cardiacIndex>=2.5&&o.cardiacIndex<=4?"#10B981":"#EF4444"},children:o.cardiacIndex.toFixed(1)}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"L/min/m¬≤ (2.5-4)"})]}),(o?.pulmonaryVascularResistance||m)&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"PVR"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:(o?.pulmonaryVascularResistance||parseFloat(m))<3?"#10B981":"#EF4444"},children:o?.pulmonaryVascularResistance?o.pulmonaryVascularResistance.toFixed(1):m}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"WU (<3)"})]}),o?.systemicVascularResistance&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"SVR"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:o.systemicVascularResistance>=10&&o.systemicVascularResistance<=20?"#10B981":"#EF4444"},children:o.systemicVascularResistance.toFixed(1)}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"WU (10-20)"})]}),o?.transpulmonaryGradient&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"TPG"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:o.transpulmonaryGradient<12?"#10B981":"#EF4444"},children:o.transpulmonaryGradient.toFixed(0)}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"mmHg (<12)"})]})]}),(o?.cardiacPowerOutput||o?.papi||o?.diastolicPressureGradient||o?.rvswi)&&t.jsxs("div",{style:{backgroundColor:"#F3F4F6",borderRadius:"8px",padding:"8px",marginTop:"6px",display:"flex",gap:"10px"},children:[o.diastolicPressureGradient&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"DPG"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:o.diastolicPressureGradient<7?"#10B981":"#EF4444"},children:o.diastolicPressureGradient.toFixed(0)}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"mmHg (<7)"})]}),o.rvswi&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"RVSWI"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:o.rvswi>=5&&o.rvswi<=10?"#10B981":"#EF4444"},children:o.rvswi.toFixed(1)}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"g¬∑m/m¬≤ (5-10)"})]}),o.papi&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"PAPi"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:o.papi>1?"#10B981":"#EF4444"},children:o.papi.toFixed(2)}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"(N: >1)"})]}),o.cardiacPowerOutput&&t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"10px",color:"#6B7280"},children:"CPO"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:o.cardiacPowerOutput>=.6?"#10B981":"#EF4444"},children:o.cardiacPowerOutput.toFixed(2)}),t.jsx("div",{style:{fontSize:"8px",color:"#9CA3AF"},children:"W (‚â•0.6)"})]})]})]}),i.recommendations&&t.jsxs("div",{style:{marginBottom:"12px"},children:[t.jsx("h2",{style:{margin:"0 0 6px 0",fontSize:"14px",fontWeight:"600",color:"#374151"},children:"Clinical Assessment"}),t.jsx("div",{style:{fontSize:"11px",color:"#4B5563",lineHeight:"1.5",padding:"8px",backgroundColor:"#FFFBEB",border:"1px solid #FDE68A",borderRadius:"6px"},children:i.recommendations})]}),t.jsxs("div",{style:{marginTop:"auto",paddingTop:"12px",borderTop:"1px solid #E5E7EB",fontSize:"10px",color:"#9CA3AF",display:"flex",justifyContent:"space-between"},children:[t.jsxs("div",{children:[s?.operator&&t.jsxs("div",{children:["Operator: ",s.operator]}),s?.institution&&t.jsx("div",{children:s.institution})]}),t.jsxs("div",{style:{textAlign:"right"},children:[t.jsx("div",{children:"Generated by Operator"}),t.jsx("div",{children:"High-Fidelity Medical AI"})]})]})]})};async function Yx(r,e={}){return new Promise((s,n)=>{try{const a=document.createElement("div");a.style.position="absolute",a.style.left="-9999px",a.style.top="0",a.style.zIndex="-1",document.body.appendChild(a);const i=ci(a);i.render(qx({rhcData:r,patientInfo:e.patientInfo,operatorInfo:e.operatorInfo})),setTimeout(async()=>{try{const o=a.querySelector("div");if(!o)throw new Error("Card element not found after rendering");(await AA(o,{scale:3.125,backgroundColor:"#FFFFFF",logging:!1,useCORS:!0,allowTaint:!1,width:492,height:492})).toBlob(l=>{if(!l){n(new Error("Failed to create image blob"));return}const c=URL.createObjectURL(l),d=document.createElement("a"),m=new Date().toISOString().split("T")[0],g=`RHC_Card_${e.patientInfo?.mrn||m}.png`;d.href=c,d.download=e.filename||g,d.style.display="none",document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(c)},100),i.unmount(),document.body.removeChild(a),s()},"image/png",1)}catch(o){i.unmount(),document.body.removeChild(a),n(o)}},100)}catch(a){n(a)}})}function Jx(r){const e=[];let s=!1,n=!1;return!r.haemodynamicPressures.ra.mean&&!r.haemodynamicPressures.ra.aWave&&!r.haemodynamicPressures.ra.vWave?e.push("Right Atrial Pressure"):s=!0,!r.haemodynamicPressures.rv.systolic&&!r.haemodynamicPressures.rv.diastolic?e.push("Right Ventricular Pressure"):s=!0,!r.haemodynamicPressures.pa.systolic&&!r.haemodynamicPressures.pa.diastolic&&!r.haemodynamicPressures.pa.mean?e.push("Pulmonary Artery Pressure"):s=!0,!r.haemodynamicPressures.pcwp.mean&&!r.haemodynamicPressures.pcwp.aWave&&!r.haemodynamicPressures.pcwp.vWave?e.push("PCWP"):s=!0,!r.cardiacOutput.thermodilution.co&&!r.cardiacOutput.fick.co?e.push("Cardiac Output"):n=!0,{valid:s||n,missingFields:e}}const Zx=[{key:"indication",title:"Indication & Presentation",icon:Pt,color:"blue",priority:"high"},{key:"procedure",title:"Procedure Details",icon:Fn,color:"green",priority:"high"},{key:"pressures",title:"Haemodynamic Pressures",icon:di,color:"red",priority:"high"},{key:"cardiac_output",title:"Cardiac Output Assessment",icon:Dn,color:"purple",priority:"high"},{key:"calculations",title:"Calculated Haemodynamics",icon:Dn,color:"emerald",priority:"high"},{key:"exercise",title:"Exercise Testing",icon:qr,color:"orange",priority:"medium"},{key:"complications",title:"Complications",icon:Fr,color:"red",priority:"high"},{key:"conclusions",title:"Conclusions & Follow-up",icon:Pt,color:"indigo",priority:"high"}],eb=({rhcReport:r,results:e,onCopy:s,onInsertToEMR:n,className:a="",originalTranscription:i,onTranscriptionCopy:o,onTranscriptionInsert:A,onTranscriptionEdit:l,transcriptionSaveStatus:c,onAgentReprocess:d,currentAgent:m,isProcessing:g=!1,audioBlob:h,defaultTranscriptionExpanded:p=!1,collapseTranscriptionWhen:b,approvalState:N,onTranscriptionApprove:y,onReprocessWithAnswers:j,onDismissMissingInfo:Q})=>{const[v,x]=u.useState(new Set(["indication","pressures","cardiac_output","calculations","complications"])),[f,S]=u.useState({copied:!1,inserted:!1,exporting:!1,exported:!1}),[F,w]=u.useState(!1),[T,C]=u.useState(null),E=u.useMemo(()=>{if(T)return T;if(r)return r;if(e)try{const V=e.match(/<!-- RHC_STRUCTURED_DATA_JSON -->\n(\{[\s\S]*?\})\s*$/);if(V){const O=JSON.parse(V[1]);return{id:"rhc-display",agentName:"Right Heart Cath Agent",content:e,sections:[],metadata:{confidence:.95,processingTime:0,modelUsed:"RHC Parser"},timestamp:Date.now(),warnings:[],errors:[],rhcData:O.rhcData,haemodynamicPressures:O.haemodynamicPressures,cardiacOutput:O.cardiacOutput,exerciseHaemodynamics:O.exerciseHaemodynamics,complications:O.complications}}const L=e.match(/\{[\s\S]*\}/);if(L){const O=JSON.parse(L[0]);if(O.rhcData)return O}}catch(V){console.warn("Could not parse RHC report from results:",V)}return null},[r,e]),U=u.useCallback(V=>{x(L=>{const O=new Set(L);return O.has(V)?O.delete(V):O.add(V),O})},[]),k=u.useCallback(async()=>{if(!s)return;const V=iu(E,e);await s(V),S(L=>({...L,copied:!0})),setTimeout(()=>S(L=>({...L,copied:!1})),2e3)},[E,e,s]),P=u.useCallback(async()=>{if(!n)return;const V=nb(E,e);await n(V),S(L=>({...L,inserted:!0})),setTimeout(()=>S(L=>({...L,inserted:!1})),2e3)},[E,e,n]),M=u.useCallback(async()=>{if(!E){alert("No RHC data available to export");return}const V=Jx(E);if(!V.valid){const L=V.missingFields.join(`
‚Ä¢ `);alert(`Cannot export card: Missing essential data

Missing fields:
‚Ä¢ ${L}

Please ensure all haemodynamic measurements are recorded.`);return}S(L=>({...L,exporting:!0}));try{const L={name:(E.rhcData.clinicalPresentation,void 0),mrn:E.id||void 0,dob:void 0},O={operator:void 0,institution:void 0,date:new Date().toLocaleDateString("en-AU",{year:"numeric",month:"short",day:"numeric"})};await Yx(E,{patientInfo:L,operatorInfo:O}),S(z=>({...z,exporting:!1,exported:!0})),setTimeout(()=>S(z=>({...z,exported:!1})),3e3)}catch(L){console.error("Failed to export RHC card:",L),alert("Failed to generate card image. Please try again."),S(O=>({...O,exporting:!1}))}},[E]),$=u.useCallback(V=>{C(V),w(!1)},[]),W=u.useCallback(()=>{w(!1)},[]);return t.jsxs("div",{className:`space-y-6 ${a}`,children:[i&&t.jsx(Lr,{originalTranscription:i,onTranscriptionCopy:o,onTranscriptionInsert:A,onTranscriptionEdit:l,transcriptionSaveStatus:c,onAgentReprocess:d,currentAgent:m,isProcessing:g,audioBlob:h,defaultExpanded:p,collapseWhen:b,approvalState:N,onTranscriptionApprove:y}),E?.missingCalculationFields&&E.missingCalculationFields.length>0&&t.jsx(Le,{children:t.jsx(se.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:t.jsx(rd,{missingInfo:{missing_structured:E.missingCalculationFields,completeness_score:`${Math.round((1-E.missingCalculationFields.length/10)*100)}%`},onSubmit:V=>j&&j(V),onDismiss:Q,agentType:"right-heart-cath"})})}),t.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-lg bg-white shadow-sm",children:[t.jsx("div",{className:"border-b border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(di,{className:"w-5 h-5 text-red-600"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Right Heart Catheterisation Report"})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs("button",{type:"button",onClick:k,disabled:!s,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:[t.jsx(Hr,{className:"w-3 h-3 mr-1"}),f.copied?"Copied":"Copy"]}),t.jsxs("button",{type:"button",onClick:()=>w(!0),disabled:!E,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md border border-blue-300 bg-blue-50 text-blue-700 hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",title:"Edit haemodynamic fields before export",children:[t.jsx(zs,{className:"w-3 h-3 mr-1"}),"Edit Fields"]}),t.jsx("button",{type:"button",onClick:M,disabled:f.exporting||!E,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md border border-purple-300 bg-purple-50 text-purple-700 hover:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",title:"Export 13√ó13cm PNG card (300 DPI)",children:f.exporting?t.jsxs(t.Fragment,{children:[t.jsx(er,{className:"w-3 h-3 mr-1 animate-spin"}),"Generating..."]}):f.exported?t.jsxs(t.Fragment,{children:[t.jsx($a,{className:"w-3 h-3 mr-1"}),"Downloaded!"]}):t.jsxs(t.Fragment,{children:[t.jsx($a,{className:"w-3 h-3 mr-1"}),"13√ó13 Card"]})}),n&&t.jsxs("button",{type:"button",onClick:P,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700 whitespace-nowrap",children:[t.jsx(Pt,{className:"w-3 h-3 mr-1"}),f.inserted?"Inserted":"Insert to EMR"]})]})]})}),t.jsx("div",{className:"divide-y divide-gray-200",children:Zx.map(({key:V,title:L,icon:O,color:z})=>{const H=v.has(V);return t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:()=>U(V),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-50 max-w-full overflow-hidden",children:[t.jsxs("div",{className:"flex items-center space-x-2 min-w-0 flex-1",children:[t.jsx(O,{className:`w-4 h-4 text-${z}-600 flex-shrink-0`}),t.jsx("span",{className:"font-medium text-gray-900 truncate",children:L})]}),H?t.jsx(Wr,{className:"w-4 h-4 text-gray-400 flex-shrink-0 ml-2"}):t.jsx(Dt,{className:"w-4 h-4 text-gray-400 flex-shrink-0 ml-2"})]}),t.jsx(Le,{children:H&&t.jsx(se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"px-4 pb-4",children:sb(V,E)})})]},V)})})]}),F&&E&&t.jsx(Cp,{rhcReport:r||E,onSave:$,onCancel:W})]})},tb=r=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Right Atrial Pressures"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[r.ra.aWave&&t.jsxs("div",{children:["A-wave: ",t.jsxs("span",{className:"font-mono",children:[r.ra.aWave," mmHg"]})]}),r.ra.vWave&&t.jsxs("div",{children:["V-wave: ",t.jsxs("span",{className:"font-mono",children:[r.ra.vWave," mmHg"]})]}),r.ra.mean&&t.jsxs("div",{children:["Mean: ",t.jsxs("span",{className:"font-mono",children:[r.ra.mean," mmHg"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Right Ventricular Pressures"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[r.rv.systolic&&t.jsxs("div",{children:["Systolic: ",t.jsxs("span",{className:"font-mono",children:[r.rv.systolic," mmHg"]})]}),r.rv.diastolic&&t.jsxs("div",{children:["Diastolic: ",t.jsxs("span",{className:"font-mono",children:[r.rv.diastolic," mmHg"]})]}),r.rv.rvedp&&t.jsxs("div",{children:["RVEDP: ",t.jsxs("span",{className:"font-mono",children:[r.rv.rvedp," mmHg"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Pulmonary Artery Pressures"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[r.pa.systolic&&t.jsxs("div",{children:["Systolic: ",t.jsxs("span",{className:"font-mono",children:[r.pa.systolic," mmHg"]})]}),r.pa.diastolic&&t.jsxs("div",{children:["Diastolic: ",t.jsxs("span",{className:"font-mono",children:[r.pa.diastolic," mmHg"]})]}),r.pa.mean&&t.jsxs("div",{children:["Mean: ",t.jsxs("span",{className:"font-mono",children:[r.pa.mean," mmHg"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"PCWP"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[r.pcwp.aWave&&t.jsxs("div",{children:["A-wave: ",t.jsxs("span",{className:"font-mono",children:[r.pcwp.aWave," mmHg"]})]}),r.pcwp.vWave&&t.jsxs("div",{children:["V-wave: ",t.jsxs("span",{className:"font-mono",children:[r.pcwp.vWave," mmHg"]})]}),r.pcwp.mean&&t.jsxs("div",{children:["Mean: ",t.jsxs("span",{className:"font-mono",children:[r.pcwp.mean," mmHg"]})]})]})]})]}),rb=r=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Thermodilution"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[r.thermodilution.co&&t.jsxs("div",{children:["Cardiac Output: ",t.jsxs("span",{className:"font-mono",children:[r.thermodilution.co," L/min"]})]}),r.thermodilution.ci&&t.jsxs("div",{children:["Cardiac Index: ",t.jsxs("span",{className:"font-mono",children:[r.thermodilution.ci," L/min/m¬≤"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Fick Method"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[r.fick.co&&t.jsxs("div",{children:["Cardiac Output: ",t.jsxs("span",{className:"font-mono",children:[r.fick.co," L/min"]})]}),r.fick.ci&&t.jsxs("div",{children:["Cardiac Index: ",t.jsxs("span",{className:"font-mono",children:[r.fick.ci," L/min/m¬≤"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Other Measurements"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[r.mixedVenousO2&&t.jsxs("div",{children:["Mixed Venous O‚ÇÇ: ",t.jsx("span",{className:"font-mono",children:r.mixedVenousO2})]}),r.wedgeSaturation&&t.jsxs("div",{children:["Wedge Saturation: ",t.jsx("span",{className:"font-mono",children:r.wedgeSaturation})]})]})]})]});function sb(r,e){if(!e)return t.jsx("div",{className:"text-gray-500 italic",children:"No structured data available"});const{rhcData:s,haemodynamicPressures:n,cardiacOutput:a,exerciseHaemodynamics:i,complications:o}=e;switch(r){case"indication":return t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Indication:"})," ",s.indication.replace("_"," ")]}),s.clinicalPresentation&&t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Clinical Presentation:"})," ",s.clinicalPresentation]}),s.recentInvestigations&&t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Recent Investigations:"})," ",s.recentInvestigations]})]});case"procedure":return t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Vascular Access:"})," ",s.vascularAccess.replace("_"," ")]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Catheter Details:"})," ",s.catheterDetails]}),(s.fluoroscopyTime||s.fluoroscopyDose||s.doseAreaProduct||s.contrastVolume)&&t.jsxs("div",{className:"bg-blue-50 p-3 rounded border-l-4 border-blue-400",children:[t.jsx("span",{className:"font-medium text-blue-900",children:"Radiation Safety & Contrast:"}),t.jsxs("div",{className:"mt-1 space-y-1",children:[s.fluoroscopyTime&&t.jsxs("div",{children:["Fluoroscopy Time: ",s.fluoroscopyTime," min"]}),s.fluoroscopyDose&&t.jsxs("div",{children:["Fluoroscopy Dose: ",s.fluoroscopyDose," mGy"]}),s.doseAreaProduct&&t.jsxs("div",{children:["DAP: ",s.doseAreaProduct," Gy¬∑cm¬≤"]}),s.contrastVolume&&t.jsxs("div",{children:["Contrast Volume: ",s.contrastVolume," mL"]})]})]}),(s.laboratoryValues.haemoglobin||s.laboratoryValues.lactate)&&t.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[t.jsx("span",{className:"font-medium",children:"Laboratory Values:"}),s.laboratoryValues.haemoglobin&&t.jsxs("div",{children:["Haemoglobin: ",s.laboratoryValues.haemoglobin," g/L"]}),s.laboratoryValues.lactate&&t.jsxs("div",{children:["Lactate: ",s.laboratoryValues.lactate," mmol/L"]})]})]});case"pressures":return tb(n);case"cardiac_output":return rb(a);case"calculations":return e.calculations?t.jsx(Bp,{calculations:e.calculations}):t.jsx("div",{className:"text-gray-500 italic",children:"No calculated haemodynamics available"});case"exercise":return i?t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Protocol:"})," ",i.protocol]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Duration:"})," ",i.duration]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Response:"})," ",i.response]})]}):t.jsx("div",{className:"text-gray-500 italic",children:"Exercise testing not performed"});case"complications":return o.length===0?t.jsx("div",{className:"text-green-600 text-sm",children:"No complications reported"}):t.jsx("div",{className:"space-y-3",children:o.map((A,l)=>t.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-3",children:t.jsxs("div",{className:"text-sm",children:[t.jsxs("span",{className:"font-medium text-red-800",children:[A.type.replace("_"," ")," (",A.severity,")"]}),t.jsx("div",{className:"mt-1 text-red-700",children:A.description}),A.management&&t.jsxs("div",{className:"mt-2 text-red-600",children:[t.jsx("span",{className:"font-medium",children:"Management:"})," ",A.management]})]})},l))});case"conclusions":return t.jsxs("div",{className:"space-y-3 text-sm",children:[s.immediateOutcomes&&t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Immediate Outcomes:"})," ",s.immediateOutcomes]}),s.recommendations&&t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Recommendations:"})," ",s.recommendations]}),s.followUp&&t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Follow-up:"})," ",s.followUp]})]});default:return t.jsx("div",{className:"text-gray-500",children:"Content not available"})}}function iu(r,e){if(r&&r.content){let s=r.content;const n=s.indexOf("<!-- RHC_STRUCTURED_DATA_JSON -->");return n!==-1&&(s=s.substring(0,n).trim()),s}if(e){let s=e;const n=s.indexOf("<!-- RHC_STRUCTURED_DATA_JSON -->");return n!==-1&&(s=s.substring(0,n).trim()),s}return"No report data available"}function nb(r,e){return iu(r,e)}const ab=({report:r,onCopy:e,onInsert:s,onRetry:n,isVisible:a})=>{const[i,o]=u.useState(null),[A,l]=u.useState(null),c=u.useRef(null);if(!a)return null;const d=async(x,f)=>{try{await e(x),o(f),setTimeout(()=>o(null),2e3)}catch(S){console.error("Failed to copy content:",S)}},m=async(x,f)=>{try{await s(x),l(f),setTimeout(()=>l(null),2e3)}catch(S){console.error("Failed to insert content:",S)}},g=x=>x.map(f=>f.split("_").map(S=>S.charAt(0).toUpperCase()+S.slice(1)).join(" ")).join(", "),h=x=>{switch(x){case"high":return"text-red-700 bg-red-50 border-red-200";case"medium":return"text-amber-700 bg-amber-50 border-amber-200";case"low":return"text-green-700 bg-green-50 border-green-200";default:return"text-gray-700 bg-gray-50 border-gray-200"}},p=()=>!r.warnings||r.warnings.length===0?null:t.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(ot,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Content Notice"}),r.warnings.map((x,f)=>t.jsx("p",{className:"text-xs text-amber-700 mt-1",children:x},f))]})]})}),b=()=>!r.errors||r.errors.length===0?null:t.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(ot,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-red-800",children:"Generation Issues"}),r.errors.map((x,f)=>t.jsx("p",{className:"text-xs text-red-700 mt-1",children:x},f)),n&&t.jsxs("button",{onClick:n,className:"mt-2 px-3 py-1 bg-red-100 hover:bg-red-200 text-red-800 text-xs rounded-md font-medium transition-colors",children:[t.jsx(Jt,{className:"w-3 h-3 inline mr-1"}),"Regenerate"]})]})]})}),N=()=>{const x=r.metadata?.missingInformation;return!x||x.completeness_score==="95%"?null:t.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Vt,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm font-medium text-blue-800",children:["Personalization Score: ",x.completeness_score]}),t.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"More specific patient information could help provide even more personalized advice."}),x.recommendations?.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-xs font-medium text-blue-800",children:"Suggestions:"}),t.jsx("ul",{className:"text-xs text-blue-700 mt-1 space-y-1",children:x.recommendations.map((f,S)=>t.jsxs("li",{className:"flex items-start space-x-1",children:[t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:f})]},S))})]})]})]})})},y=()=>{const{educationData:x}=r;return t.jsx("div",{className:"mb-4 bg-gray-50 rounded-lg p-3",children:t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${h(x.priority)}`,children:[t.jsx(ds,{className:"w-3 h-3 mr-1"}),x.priority.charAt(0).toUpperCase()+x.priority.slice(1)," Priority"]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Areas Covered: "}),t.jsx("span",{className:"text-xs text-gray-600",children:g(x.modules)})]}),x.australianGuidelines?.length>0&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-1",children:[t.jsx(tm,{className:"w-3 h-3 text-green-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Australian Guidelines Referenced:"})]}),t.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[x.australianGuidelines.slice(0,3).map((f,S)=>t.jsxs("li",{className:"flex items-start space-x-1",children:[t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:f})]},S)),x.australianGuidelines.length>3&&t.jsxs("li",{className:"text-xs text-gray-500 italic",children:["+",x.australianGuidelines.length-3," more guidelines"]})]})]}),x.patientResources?.length>0&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-1",children:[t.jsx(Pn,{className:"w-3 h-3 text-blue-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Support Resources Mentioned:"})]}),t.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[x.patientResources.slice(0,3).map((f,S)=>t.jsxs("li",{className:"flex items-start space-x-1",children:[t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:f})]},S)),x.patientResources.length>3&&t.jsxs("li",{className:"text-xs text-gray-500 italic",children:["+",x.patientResources.length-3," more resources"]})]})]})]})})},j=()=>{const x=window.open("","_blank");if(!x)return;const f=r.educationData.jsonMetadata;if(!f){alert("No structured data available to export");return}const S=f.priority_plan||[],F=T=>{const C=T.title?.toLowerCase()||"",E=T.id?.toLowerCase()||"";return C.includes("exercise")||C.includes("physical")||C.includes("activity")||E.includes("physical_activity")?"exercise":C.includes("diet")||C.includes("nutrition")||C.includes("food")||C.includes("fibre")||C.includes("salt")||E.includes("diet_nutrition")?"diet":C.includes("alcohol")||E.includes("alcohol")?"alcohol":C.includes("weight")||C.includes("bmi")||E.includes("weight")?"weight":C.includes("smoking")||C.includes("tobacco")||E.includes("smoking")?"smoking":C.includes("stress")||C.includes("mental")||E.includes("stress")?"mental":"other"},w=S.map((T,C)=>{const E=F(T),U=T.expected_impact||"medium",P={exercise:{bg:"#EFF6FF",border:"#3B82F6",text:"#1E40AF"},diet:{bg:"#ECFDF5",border:"#10B981",text:"#065F46"},alcohol:{bg:"#F3E8FF",border:"#A855F7",text:"#6B21A8"},weight:{bg:"#FFF7ED",border:"#F97316",text:"#9A3412"},smoking:{bg:"#FEF2F2",border:"#EF4444",text:"#991B1B"},mental:{bg:"#F0FDFA",border:"#14B8A6",text:"#115E59"},other:{bg:"#F9FAFB",border:"#6B7280",text:"#374151"}}[E];return`
        <div style="background: ${P.bg}; border-left: 4px solid ${P.border};
                    padding: 16px; margin-bottom: 16px; border-radius: 8px; page-break-inside: avoid;">
          <div style="display: flex; align-items: start; gap: 12px;">
            <div style="background: white; width: 28px; height: 28px; border-radius: 50%;
                        display: flex; align-items: center; justify-content: center;
                        font-weight: bold; font-size: 14px; color: ${P.text}; flex-shrink: 0;">
              ${C+1}
            </div>
            <div style="flex: 1;">
              <h3 style="margin: 0 0 8px 0; color: ${P.text}; font-size: 16px; font-weight: 600;">
                ${T.title}
              </h3>
              ${T.magnitude_note?`
                <p style="margin: 0 0 8px 0; color: ${P.text}; opacity: 0.9; font-size: 14px;">
                  ${T.magnitude_note}
                </p>
              `:""}
              <p style="margin: 0 0 8px 0; color: ${P.text}; opacity: 0.85; font-size: 13px;">
                <strong>Impact level:</strong> ${U}
              </p>
              ${T.reason?`
                <p style="margin: 0 0 8px 0; color: ${P.text}; opacity: 0.8; font-size: 13px; font-style: italic;">
                  <strong>Why:</strong> ${T.reason}
                </p>
              `:""}
              ${T.next_action?`
                <div style="background: rgba(255,255,255,0.6); padding: 8px; border-radius: 6px; margin-top: 8px;">
                  <p style="margin: 0; font-size: 13px; color: ${P.text};">
                    <strong>Start here:</strong> ${T.next_action}
                  </p>
                </div>
              `:""}
              ${T.habit_cue?`
                <div style="background: rgba(255,255,255,0.6); padding: 8px; border-radius: 6px; margin-top: 6px;">
                  <p style="margin: 0; font-size: 13px; color: ${P.text};">
                    <strong>Habit cue:</strong> ${T.habit_cue}
                  </p>
                </div>
              `:""}
            </div>
          </div>
        </div>
      `}).join("");x.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Patient Education Action Plan</title>
          <style>
            @media print {
              body { margin: 0; }
              @page { margin: 1cm; }
            }
            body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
              padding: 20px;
              max-width: 800px;
              margin: 0 auto;
              line-height: 1.6;
            }
            h1 {
              font-size: 24px;
              margin-bottom: 8px;
              color: #111827;
            }
            .subtitle {
              color: #6B7280;
              font-size: 14px;
              margin-bottom: 24px;
            }
            .legend {
              display: flex;
              flex-wrap: wrap;
              gap: 12px;
              margin-bottom: 24px;
              padding: 16px;
              background: #F9FAFB;
              border-radius: 8px;
            }
            .legend-item {
              display: flex;
              align-items: center;
              gap: 6px;
              font-size: 12px;
            }
            .legend-color {
              width: 16px;
              height: 16px;
              border-radius: 3px;
            }
          </style>
        </head>
        <body>
          <h1>Patient Education Action Plan</h1>
          <p class="subtitle">Personalized lifestyle and wellness recommendations</p>

          <div class="legend">
            <div class="legend-item">
              <div class="legend-color" style="background: #3B82F6;"></div>
              <span>Exercise</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #10B981;"></div>
              <span>Diet & Nutrition</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #A855F7;"></div>
              <span>Alcohol</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #F97316;"></div>
              <span>Weight Management</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #EF4444;"></div>
              <span>Smoking Cessation</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #14B8A6;"></div>
              <span>Mental Health</span>
            </div>
          </div>

          ${w}

          <div style="margin-top: 32px; padding-top: 16px; border-top: 1px solid #E5E7EB;
                      font-size: 12px; color: #6B7280; text-align: center;">
            <p style="margin: 0;">Generated by Operator - Patient Education & Lifestyle Medicine</p>
            <p style="margin: 4px 0 0 0;">This information is for general education only. Always follow your healthcare team's specific advice.</p>
          </div>
        </body>
      </html>
    `),x.document.close(),x.print()},Q=()=>{const x=r.educationData.letterContent||r.content,f=i==="letter";return t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Et,{className:"w-4 h-4 text-emerald-600"}),t.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Patient Letter"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>d(x,"letter"),className:"flex items-center space-x-1 px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-medium rounded-md transition-colors",children:f?t.jsxs(t.Fragment,{children:[t.jsx(yt,{className:"w-3 h-3 text-green-600"}),t.jsx("span",{className:"text-green-600",children:"Copied!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Vr,{className:"w-3 h-3"}),t.jsx("span",{children:"Copy"})]})}),t.jsx("button",{onClick:()=>m(x,"letter"),className:"flex items-center space-x-1 px-3 py-1 bg-emerald-100 hover:bg-emerald-200 text-emerald-700 text-xs font-medium rounded-md transition-colors",children:A==="letter"?t.jsxs(t.Fragment,{children:[t.jsx(yt,{className:"w-3 h-3 text-emerald-600"}),t.jsx("span",{className:"text-emerald-600",children:"Inserted!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(rm,{className:"w-3 h-3"}),t.jsx("span",{children:"Insert"})]})})]})]}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:t.jsx("div",{className:"prose prose-sm max-w-none",children:t.jsx("div",{className:"text-gray-800 whitespace-pre-wrap text-sm leading-relaxed font-sans",dangerouslySetInnerHTML:{__html:x.replace(/\n\n/g,'</p><p class="mt-4">').replace(/^/,"<p>").replace(/$/,"</p>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/## (.*?)(?=\n|$)/g,'<h3 class="text-base font-bold text-gray-900 mt-6 mb-3 border-b border-gray-200 pb-1">$1</h3>').replace(/‚Ä¢ (.*?)(?=\n|$)/g,'<li class="ml-4">$1</li>').replace(/(<li.*?<\/li>)/g,'<ul class="list-disc list-inside space-y-1 mb-3">$1</ul>')}})})})]})},v=()=>{const x=r.educationData.jsonMetadata;if(!x)return null;const f=i==="json",S=x.priority_plan||[];return t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Pn,{className:"w-4 h-4 text-blue-600"}),t.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Quick Action Plan"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>d(JSON.stringify(x,null,2),"json"),className:"flex items-center space-x-1 px-2 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-medium rounded-md transition-colors",title:"Copy structured data as JSON",children:f?t.jsxs(t.Fragment,{children:[t.jsx(yt,{className:"w-3 h-3 text-green-600"}),t.jsx("span",{className:"text-green-600",children:"Copied!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Vr,{className:"w-3 h-3"}),t.jsx("span",{children:"Copy JSON"})]})}),t.jsxs("button",{onClick:j,className:"flex items-center space-x-1 px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-md transition-colors",children:[t.jsx(jr,{className:"w-3 h-3"}),t.jsx("span",{children:"Export PDF"})]})]})]}),S.length>0&&t.jsx("div",{className:"space-y-3",children:S.map((F,w)=>{const T=F.expected_impact==="very_high"||F.expected_impact==="high"?"text-emerald-700 bg-emerald-50 border-emerald-200":F.expected_impact==="medium"?"text-blue-700 bg-blue-50 border-blue-200":"text-gray-700 bg-gray-50 border-gray-200";return t.jsx("div",{className:`border rounded-lg p-3 ${T}`,children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-white flex items-center justify-center text-xs font-bold mt-0.5",children:w+1}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h5",{className:"font-semibold text-sm mb-1",children:F.title}),F.magnitude_note&&t.jsx("p",{className:"text-xs mb-2 opacity-90",children:F.magnitude_note}),F.reason&&t.jsxs("p",{className:"text-xs mb-2 italic opacity-80",children:[t.jsx("strong",{children:"Why:"})," ",F.reason]}),F.next_action&&t.jsx("div",{className:"bg-white bg-opacity-50 rounded px-2 py-1 mt-2",children:t.jsxs("p",{className:"text-xs font-medium",children:[t.jsx("strong",{children:"Start here:"})," ",F.next_action]})}),F.habit_cue&&t.jsx("div",{className:"bg-white bg-opacity-50 rounded px-2 py-1 mt-1",children:t.jsxs("p",{className:"text-xs",children:[t.jsx("strong",{children:"Habit cue:"})," ",F.habit_cue]})})]})]})},w)})}),t.jsxs("details",{className:"mt-3",children:[t.jsx("summary",{className:"cursor-pointer text-xs text-gray-500 hover:text-gray-700 font-medium",children:"View structured data (JSON)"}),t.jsx("div",{ref:c,className:"mt-2 bg-gray-900 rounded-lg p-3 border border-gray-700 overflow-x-auto",children:t.jsx("pre",{className:"text-xs text-green-400 font-mono whitespace-pre-wrap break-words",children:JSON.stringify(x,null,2)})})]})]})};return t.jsx("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:t.jsxs("div",{className:"bg-white w-full overflow-hidden rounded-xl",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(jn,{className:"w-4 h-4"}),t.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),t.jsxs("div",{className:"text-emerald-100 text-xs",children:["Generated in ",Math.round(r.metadata.processingTime/1e3),"s"]})]})}),t.jsxs("div",{className:"p-4",children:[b(),p(),N(),y(),Q(),v(),t.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Vt,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-xs text-blue-800",children:[t.jsx("p",{className:"font-medium",children:"Important Disclaimer"}),t.jsx("p",{className:"mt-1",children:"This information is for educational purposes only and should not replace professional medical advice. Always consult with your healthcare team before making significant lifestyle changes."})]})]})})]})]})})},Cl={ANGIOGRAM_OR_PCI:{emoji:"ü©∫",color:"#3B82F6",label:"Angiogram/PCI"},RIGHT_HEART_CATH:{emoji:"ü©∫",color:"#8B5CF6",label:"Right Heart Catheterisation"},TAVI:{emoji:"ü´Ä",color:"#10B981",label:"TAVI"},MITRAL_TEER:{emoji:"ü´Ä",color:"#14B8A6",label:"Mitral TEER"}},ou=({procedureType:r,cardMarkdown:e,jsonData:s,completenessScore:n,patientInfo:a,operatorInfo:i})=>{const o=Cl[r]||Cl.ANGIOGRAM_OR_PCI,A=s?.fields||{},c=(d=>{const m=d.split(`
`),g=[];for(const h of m){if(!h.trim()||h.includes(o.emoji)||h.startsWith("#"))continue;const p=h.match(/^\*\*(.+?)\*\*\s*[‚Äî‚Äì-]\s*(.+)$/);p&&g.push({label:p[1].trim(),value:p[2].trim()})}return g})(e);return t.jsxs("div",{style:{width:"14.8cm",height:"21cm",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backgroundColor:"#FFFFFF",padding:"24px",boxSizing:"border-box",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{borderBottom:`3px solid ${o.color}`,paddingBottom:"14px",marginBottom:"18px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[t.jsx("span",{style:{fontSize:"32px"},children:o.emoji}),t.jsx("h1",{style:{margin:0,fontSize:"26px",fontWeight:"700",color:"#1F2937",letterSpacing:"-0.5px"},children:o.label})]}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#6B7280",marginTop:"6px"},children:"Pre-Procedure Summary Card"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",fontSize:"12px",color:"#6B7280"},children:[t.jsxs("div",{children:[a?.name&&t.jsxs("div",{children:[t.jsx("strong",{children:"Patient:"})," ",a.name]}),a?.mrn&&t.jsxs("div",{children:[t.jsx("strong",{children:"MRN:"})," ",a.mrn]})]}),t.jsxs("div",{style:{textAlign:"right"},children:[i?.date&&t.jsxs("div",{children:[t.jsx("strong",{children:"Date:"})," ",i.date]}),A.indication&&A.indication!=="Not specified"&&t.jsx("div",{style:{fontSize:"11px",fontStyle:"italic",marginTop:"2px"},children:A.indication})]})]})]}),t.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"8px"},children:c.map((d,m)=>t.jsxs("div",{style:{backgroundColor:m%2===0?"#F9FAFB":"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#374151",minWidth:"120px",flexShrink:0},children:d.label}),t.jsx("div",{style:{fontSize:"12px",color:"#1F2937",textAlign:"right",fontWeight:d.value==="Not specified"?"400":"500",fontStyle:d.value==="Not specified"?"italic":"normal",opacity:d.value==="Not specified"?.5:1,flex:1},children:d.value})]},m))}),(A.allergies||A.protamine||A.goals_of_care)&&t.jsxs("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"#FFFBEB",border:"2px solid #FDE68A",borderRadius:"8px"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"700",color:"#92400E",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"‚ö†Ô∏è Important Considerations"}),t.jsxs("div",{style:{fontSize:"11px",color:"#78350F",lineHeight:"1.5"},children:[A.allergies&&A.allergies!=="Not specified"&&t.jsxs("div",{children:[t.jsx("strong",{children:"Allergies:"})," ",A.allergies]}),A.protamine&&A.protamine!=="Not specified"&&t.jsxs("div",{children:[t.jsx("strong",{children:"Protamine:"})," ",A.protamine]}),A.goals_of_care&&A.goals_of_care!=="Not specified"&&t.jsxs("div",{children:[t.jsx("strong",{children:"Goals of Care:"})," ",A.goals_of_care]})]})]})]}),t.jsxs("div",{style:{marginTop:"auto",paddingTop:"14px",borderTop:"2px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[t.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF"},children:[i?.operator&&t.jsxs("div",{children:[t.jsx("strong",{children:"Operator:"})," ",i.operator]}),i?.institution&&t.jsx("div",{children:i.institution}),n&&t.jsxs("div",{style:{marginTop:"4px"},children:[t.jsx("strong",{children:"Completeness:"})," ",n]})]}),t.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF",textAlign:"right"},children:[t.jsx("div",{style:{fontWeight:"600"},children:"Generated by Operator"}),t.jsx("div",{children:"High-Fidelity Medical AI"}),t.jsx("div",{style:{fontSize:"9px",marginTop:"2px"},children:new Date().toLocaleDateString("en-AU",{day:"2-digit",month:"short",year:"numeric"})})]})]})]})};async function ib(r,e={}){return oe.info("PreOpCardExport: Starting clipboard copy",{procedureType:r.procedureType,component:"pre-op-card-export"}),new Promise((s,n)=>{try{const a=document.createElement("div");a.style.position="absolute",a.style.left="-9999px",a.style.top="0",a.style.zIndex="-1",document.body.appendChild(a);const i=ci(a);i.render(ou({procedureType:r.procedureType,cardMarkdown:r.cardMarkdown,jsonData:r.jsonData,completenessScore:r.completenessScore,patientInfo:e.patientInfo,operatorInfo:e.operatorInfo})),setTimeout(async()=>{try{const o=a.querySelector("div");if(!o)throw new Error("Card element not found after rendering");const A=await AA(o,{scale:3.14,backgroundColor:"#FFFFFF",logging:!1,useCORS:!0,allowTaint:!1,width:557,height:791});oe.info("PreOpCardExport: Canvas captured successfully",{width:A.width,height:A.height,component:"pre-op-card-export"}),A.toBlob(async l=>{if(!l){n(new Error("Failed to create image blob"));return}try{const c=new ClipboardItem({"image/png":l});await navigator.clipboard.write([c]),oe.info("PreOpCardExport: Image copied to clipboard",{blobSize:l.size,component:"pre-op-card-export"}),i.unmount(),document.body.removeChild(a),s()}catch(c){i.unmount(),document.body.removeChild(a),oe.error("PreOpCardExport: Clipboard write failed",{error:c instanceof Error?c.message:String(c),component:"pre-op-card-export"}),n(new Error("Failed to copy image to clipboard. Please check browser permissions."))}},"image/png",1)}catch(o){i.unmount(),document.body.removeChild(a),oe.error("PreOpCardExport: Canvas capture failed",{error:o instanceof Error?o.message:String(o),component:"pre-op-card-export"}),n(o)}},100)}catch(a){oe.error("PreOpCardExport: Setup failed",{error:a instanceof Error?a.message:String(a),component:"pre-op-card-export"}),n(a)}})}async function ob(r,e={}){return oe.info("PreOpCardExport: Starting download",{procedureType:r.procedureType,component:"pre-op-card-export"}),new Promise((s,n)=>{try{const a=document.createElement("div");a.style.position="absolute",a.style.left="-9999px",a.style.top="0",a.style.zIndex="-1",document.body.appendChild(a);const i=ci(a);i.render(ou({procedureType:r.procedureType,cardMarkdown:r.cardMarkdown,jsonData:r.jsonData,completenessScore:r.completenessScore,patientInfo:e.patientInfo,operatorInfo:e.operatorInfo})),setTimeout(async()=>{try{const o=a.querySelector("div");if(!o)throw new Error("Card element not found after rendering");(await AA(o,{scale:3.14,backgroundColor:"#FFFFFF",logging:!1,useCORS:!0,allowTaint:!1,width:557,height:791})).toBlob(l=>{if(!l){n(new Error("Failed to create image blob"));return}const c=URL.createObjectURL(l),d=document.createElement("a"),m=new Date().toISOString().split("T")[0],h=`PreOp_${r.procedureType.toLowerCase().replace(/_/g,"-")}_${e.patientInfo?.mrn||m}.png`;d.href=c,d.download=e.filename||h,d.style.display="none",document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(c)},100),i.unmount(),document.body.removeChild(a),oe.info("PreOpCardExport: Download completed",{filename:h,component:"pre-op-card-export"}),s()},"image/png",1)}catch(o){i.unmount(),document.body.removeChild(a),oe.error("PreOpCardExport: Download failed",{error:o instanceof Error?o.message:String(o),component:"pre-op-card-export"}),n(o)}},100)}catch(a){oe.error("PreOpCardExport: Setup failed",{error:a instanceof Error?a.message:String(a),component:"pre-op-card-export"}),n(a)}})}function Nl(r){const e=[],s=r.jsonData?.fields||{},a={ANGIOGRAM_OR_PCI:["procedure","indication","primary_access","nok_name"],RIGHT_HEART_CATH:["procedure","indication","access_site","nok_name"],TAVI:["procedure","indication","primary_access","valve_type_size","nok_name"],MITRAL_TEER:["procedure","indication","access_site","transeptal_catheter","nok_name"]}[r.procedureType]||[];for(const i of a){const o=s[i];(!o||o==="Not specified"||o==="")&&e.push(i.replace(/_/g," "))}return{valid:e.length===0,missingFields:e}}class ce{static instance;toasts=[];listeners=new Set;autoRemoveTimers=new Map;constructor(){}static getInstance(){return ce.instance||(ce.instance=new ce),ce.instance}subscribe(e){return this.listeners.add(e),e([...this.toasts]),()=>{this.listeners.delete(e)}}notifyListeners(){requestAnimationFrame(()=>{this.listeners.forEach(e=>{e([...this.toasts])})})}show(e){const s=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={...e,id:s,timestamp:Date.now(),duration:e.duration??(e.type==="error"?4e3:3e3)};if(this.toasts.unshift(n),this.toasts.length>5&&this.toasts.splice(5).forEach(i=>{const o=this.autoRemoveTimers.get(i.id);o&&(clearTimeout(o),this.autoRemoveTimers.delete(i.id))}),this.notifyListeners(),n.duration&&n.duration>0){const a=window.setTimeout(()=>{this.remove(s)},n.duration);this.autoRemoveTimers.set(s,a)}return s}remove(e){const s=this.toasts.findIndex(n=>n.id===e);if(s!==-1){this.toasts.splice(s,1);const n=this.autoRemoveTimers.get(e);n&&(clearTimeout(n),this.autoRemoveTimers.delete(e)),this.notifyListeners()}}clear(){this.autoRemoveTimers.forEach(e=>clearTimeout(e)),this.autoRemoveTimers.clear(),this.toasts=[],this.notifyListeners()}success(e,s,n){return this.show({type:"success",title:e,message:s,duration:n})}error(e,s,n){return this.show({type:"error",title:e,message:s,duration:n})}warning(e,s,n){return this.show({type:"warning",title:e,message:s,duration:n})}info(e,s,n){return this.show({type:"info",title:e,message:s,duration:n})}}const jl={ANGIOGRAM_OR_PCI:{label:"Angiogram/PCI",color:"blue",emoji:"ü©∫"},RIGHT_HEART_CATH:{label:"Right Heart Cath",color:"purple",emoji:"ü©∫"},TAVI:{label:"TAVI",color:"emerald",emoji:"ü´Ä"},MITRAL_TEER:{label:"Mitral TEER",color:"teal",emoji:"ü´Ä"}},Au=u.memo(({session:r,onCopy:e,onInsertToEMR:s,onTranscriptionCopy:n,onTranscriptionInsert:a,onTranscriptionEdit:i,onTranscriptionApprove:o,transcriptionApprovalState:A,onAgentReprocess:l,isProcessing:c=!1})=>{const[d,m]=u.useState(!1),[g,h]=u.useState("idle"),[p,b]=u.useState("idle"),N=r.preOpPlanData;if(!N)return t.jsx("div",{className:"p-4 text-center text-gray-500",children:"No pre-op plan data available"});const{procedureType:y,cardMarkdown:j,jsonData:Q,completenessScore:v}=N,x=N.warnings??[],f=jl[y]||jl.ANGIOGRAM_OR_PCI,S=()=>{const C=window.open("","_blank");if(!C)return;const E=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Pre-Op Plan - ${f.label}</title>
          <style>
            @page {
              size: A5;
              margin: 15mm;
            }
            body {
              font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
              font-size: 10pt;
              line-height: 1.4;
              color: #1f2937;
              margin: 0;
              padding: 0;
            }
            h1 {
              font-size: 14pt;
              margin: 0 0 10px 0;
              color: #1f2937;
            }
            .field {
              margin: 4px 0;
            }
            .field strong {
              color: #374151;
            }
            .header {
              border-bottom: 2px solid #e5e7eb;
              padding-bottom: 8px;
              margin-bottom: 12px;
            }
            .footer {
              margin-top: 20px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
              font-size: 8pt;
              color: #6b7280;
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>${f.emoji} ${f.label} Pre-Op Plan</h1>
          </div>
          <div class="content">
            ${j.split(`
`).map(U=>U.startsWith("**")?`<div class="field">${U.replace(/\*\*/g,"<strong>").replace(/<\/strong>/g,"</strong>")}</div>`:U?`<div>${U}</div>`:"").join("")}
          </div>
          <div class="footer">
            Generated: ${new Date().toLocaleString("en-AU")} | Completeness: ${v||"N/A"}
          </div>
          <script>
            window.onload = () => {
              window.print();
              window.onafterprint = () => window.close();
            };
          <\/script>
        </body>
      </html>
    `;C.document.write(E),C.document.close()},F=()=>{const C=JSON.stringify(Q,null,2),E=new Blob([C],{type:"application/json"}),U=URL.createObjectURL(E),k=document.createElement("a");k.href=U,k.download=`pre-op-plan-${y.toLowerCase()}-${Date.now()}.json`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(U)},w=async()=>{const C=Nl({procedureType:y,jsonData:Q});if(!C.valid){ce.getInstance().error(`Cannot copy card: Missing essential data

${C.missingFields.map(E=>`‚Ä¢ ${E}`).join(`
`)}`),h("error"),setTimeout(()=>h("idle"),2e3);return}h("copying");try{await ib({procedureType:y,cardMarkdown:j,jsonData:Q,completenessScore:v},{operatorInfo:{date:new Date().toLocaleDateString("en-AU",{day:"2-digit",month:"short",year:"numeric"})}}),h("success"),ce.getInstance().success("A5 card copied to clipboard! Ready to paste into documents."),setTimeout(()=>h("idle"),3e3)}catch(E){console.error("Failed to copy card to clipboard:",E),h("error"),ce.getInstance().error(E instanceof Error?E.message:"Failed to copy card to clipboard"),setTimeout(()=>h("idle"),2e3)}},T=async()=>{const C=Nl({procedureType:y,jsonData:Q});if(!C.valid){ce.getInstance().error(`Cannot download card: Missing essential data

${C.missingFields.map(E=>`‚Ä¢ ${E}`).join(`
`)}`),b("error"),setTimeout(()=>b("idle"),2e3);return}b("downloading");try{await ob({procedureType:y,cardMarkdown:j,jsonData:Q,completenessScore:v},{operatorInfo:{date:new Date().toLocaleDateString("en-AU",{day:"2-digit",month:"short",year:"numeric"})}}),b("success"),ce.getInstance().success("A5 card downloaded successfully!"),setTimeout(()=>b("idle"),3e3)}catch(E){console.error("Failed to download card:",E),b("error"),ce.getInstance().error(E instanceof Error?E.message:"Failed to download card"),setTimeout(()=>b("idle"),2e3)}};return t.jsx(Yc,{agentType:"pre-op-plan",title:"Pre-Op Plan Summary Card",subtitle:f.label,completedTime:r.completedTime,processingTime:r.processingTime,originalTranscription:r.transcription,onTranscriptionCopy:n,onTranscriptionInsert:a,onTranscriptionEdit:i,onTranscriptionApprove:o,transcriptionApprovalState:A,onAgentReprocess:l?()=>l():void 0,isProcessing:c,audioBlob:r.audioBlob||null,results:j,onCopy:e,onInsertToEMR:s,agentName:"Pre-Op Plan",hideActions:!1,children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[t.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-${f.color}-50 border border-${f.color}-200`,children:[t.jsx(qo,{className:`w-4 h-4 text-${f.color}-600`}),t.jsxs("span",{className:`text-sm font-medium text-${f.color}-700`,children:[f.emoji," ",f.label]})]}),v&&t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Completeness:"})," ",v]})]}),x.length>0&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("svg",{className:"w-5 h-5 text-amber-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-semibold text-amber-800 mb-1",children:"Warnings"}),t.jsx("ul",{className:"text-sm text-amber-700 space-y-1",children:x.map((C,E)=>t.jsxs("li",{children:["‚Ä¢ ",C]},E))})]})]})}),t.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-sm",children:t.jsx("div",{className:"prose prose-sm max-w-none",children:j.split(`
`).map((C,E)=>{if(E===0&&C.includes(f.emoji))return t.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx("span",{children:f.emoji}),t.jsx("span",{children:C.replace(f.emoji,"").trim()})]},E);if(C.includes("**")){const U=C.split("‚Äî");if(U.length===2){const k=U[0].replace(/\*\*/g,"").trim(),P=U[1].trim();return t.jsxs("div",{className:"text-sm leading-relaxed mb-1.5",children:[t.jsx("span",{className:"font-semibold text-gray-700",children:k}),t.jsx("span",{className:"text-gray-500 mx-1",children:"‚Äî"}),t.jsx("span",{className:"text-gray-900",children:P})]},E)}}return C.trim()?t.jsx("div",{className:"text-sm text-gray-900 mb-1",children:C},E):t.jsx("div",{className:"h-2"},E)})})}),t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsx("button",{onClick:w,disabled:g==="copying",className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${g==="success"?"bg-emerald-50 border-emerald-200 text-emerald-700":g==="error"?"bg-red-50 border-red-200 text-red-700":g==="copying"?"bg-gray-50 border-gray-200 text-gray-500 cursor-not-allowed":"bg-teal-50 hover:bg-teal-100 border-teal-200 text-teal-700"} border`,children:g==="copying"?t.jsxs(t.Fragment,{children:[t.jsx(er,{className:"w-4 h-4 animate-spin"}),"Copying..."]}):g==="success"?t.jsxs(t.Fragment,{children:[t.jsx(gr,{className:"w-4 h-4"}),"Copied!"]}):g==="error"?t.jsxs(t.Fragment,{children:[t.jsx(Zt,{className:"w-4 h-4"}),"Failed"]}):t.jsxs(t.Fragment,{children:[t.jsx(_n,{className:"w-4 h-4"}),"Copy A5 Card"]})}),t.jsx("button",{onClick:T,disabled:p==="downloading",className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${p==="success"?"bg-emerald-50 border-emerald-200 text-emerald-700":p==="error"?"bg-red-50 border-red-200 text-red-700":p==="downloading"?"bg-gray-50 border-gray-200 text-gray-500 cursor-not-allowed":"bg-purple-50 hover:bg-purple-100 border-purple-200 text-purple-700"} border`,children:p==="downloading"?t.jsxs(t.Fragment,{children:[t.jsx(er,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):p==="success"?t.jsxs(t.Fragment,{children:[t.jsx(gr,{className:"w-4 h-4"}),"Downloaded!"]}):p==="error"?t.jsxs(t.Fragment,{children:[t.jsx(Zt,{className:"w-4 h-4"}),"Failed"]}):t.jsxs(t.Fragment,{children:[t.jsx(jr,{className:"w-4 h-4"}),"Download A5 Card"]})}),t.jsxs("button",{onClick:S,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 text-blue-700 rounded-lg text-sm font-medium transition-all",children:[t.jsx(sm,{className:"w-4 h-4"}),"Print"]}),t.jsxs("button",{onClick:F,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-50 hover:bg-gray-100 border border-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-all",children:[t.jsx(jr,{className:"w-4 h-4"}),"Export JSON"]})]}),t.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[t.jsxs("button",{onClick:()=>m(!d),className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Structured JSON Metadata"}),d?t.jsx(Dt,{className:"w-4 h-4 text-gray-500"}):t.jsx(os,{className:"w-4 h-4 text-gray-500"})]}),t.jsx(Le,{children:d&&t.jsx(se.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:t.jsx("div",{className:"p-4 bg-gray-900 text-gray-100 font-mono text-xs overflow-x-auto",children:t.jsx("pre",{children:JSON.stringify(Q,null,2)})})})})]})]})})});Au.displayName="PreOpPlanDisplay";const Ab={recording:{gradient:{from:"red-50",to:"rose-50"},border:"red-200",text:"red-600",indicator:"red-500",bgGradient:"bg-gradient-to-br from-red-50/40 to-rose-50/30",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-red-400 to-rose-500",complete:"bg-gradient-to-r from-red-500 to-rose-600"}},transcribing:{gradient:{from:"blue-50",to:"indigo-50"},border:"blue-200",text:"blue-600",indicator:"blue-500",bgGradient:"bg-gradient-to-br from-blue-50/35 to-indigo-50/25",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-blue-400 to-indigo-500",complete:"bg-gradient-to-r from-blue-500 to-indigo-600"}},"ai-analysis":{gradient:{from:"purple-50",to:"violet-50"},border:"purple-200",text:"purple-600",indicator:"purple-500",bgGradient:"bg-gradient-to-br from-purple-50/45 to-violet-50/35",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-violet-400 to-fuchsia-500",complete:"bg-gradient-to-r from-violet-500 to-fuchsia-600"}},generation:{gradient:{from:"emerald-50",to:"teal-50"},border:"emerald-200",text:"emerald-600",indicator:"emerald-500",bgGradient:"bg-gradient-to-br from-emerald-50/40 to-teal-50/30",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-emerald-400 to-teal-500",complete:"bg-gradient-to-r from-emerald-500 to-teal-600"}},completed:{gradient:{from:"emerald-50",to:"teal-50"},border:"emerald-200",text:"emerald-600",indicator:"emerald-500",bgGradient:"bg-gradient-to-br from-emerald-50/50 to-teal-50/40",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-emerald-400 to-teal-500",complete:"bg-gradient-to-r from-emerald-500 to-teal-600"}},needs_review:{gradient:{from:"amber-50",to:"yellow-50"},border:"amber-200",text:"amber-700",indicator:"amber-500",bgGradient:"bg-gradient-to-br from-amber-50/40 to-yellow-50/30",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-amber-400 to-yellow-500",complete:"bg-gradient-to-r from-amber-500 to-yellow-600"}},error:{gradient:{from:"rose-50",to:"pink-50"},border:"rose-200",text:"rose-600",indicator:"rose-500",bgGradient:"bg-gradient-to-br from-rose-50/45 to-pink-50/35",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-rose-400 to-pink-500",complete:"bg-gradient-to-r from-rose-500 to-pink-600"}},processing:{gradient:{from:"purple-50",to:"violet-50"},border:"purple-200",text:"purple-600",indicator:"purple-500",bgGradient:"bg-gradient-to-br from-purple-50/45 to-violet-50/35",progressGradient:{inactive:"bg-gray-200",active:"bg-gradient-to-r from-purple-400 to-violet-500",complete:"bg-gradient-to-r from-purple-500 to-violet-600"}}};function Ss(r){return Ab[r]}function wn(r){return{"audio-processing":"recording",transcribing:"transcribing","ai-analysis":"ai-analysis",generation:"generation"}[r]||"processing"}const lb={"audio-processing":"Processing",transcribing:"Transcribing","ai-analysis":"AI Analysis",generation:"Generating"};function cb(r){const e=r/1e3;if(e<60)return`${e.toFixed(1)}s`;const s=Math.floor(e/60),n=Math.floor(e%60);return`${s}m ${n}s`}function db(r){const e={"from-red-500":"#ef4444","from-blue-500":"#3b82f6","from-purple-500":"#a855f7","from-emerald-500":"#10b981","from-indigo-500":"#6366f1","from-rose-500":"#f43f5e","from-teal-500":"#14b8a6"},s=r.split(" ").find(n=>n.startsWith("from-"));return s&&e[s]?e[s]:"#6366f1"}const ub=({remainingMs:r,progress:e,stage:s,size:n=200,className:a=""})=>{const i=u.useMemo(()=>{const p=wn(s);return Ss(p)},[s]),o=u.useMemo(()=>db(i.progressGradient.active),[i]),A=8,l=(n-A)/2,c=2*Math.PI*l,d=c-e/100*c,m=u.useMemo(()=>cb(r),[r]),g=lb[s],h=n/2;return t.jsx(se.div,{className:`flex items-center justify-center ${a}`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},role:"timer","aria-live":"polite","aria-label":`${m} remaining, ${g}`,children:t.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${n} ${n}`,className:"transform -rotate-90",style:{filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))"},children:[t.jsx("circle",{cx:h,cy:h,r:l,stroke:"#e5e7eb",strokeWidth:A,fill:"none",className:"opacity-30"}),t.jsx("circle",{cx:h,cy:h,r:l,stroke:o,strokeWidth:A,fill:"none",strokeDasharray:c,strokeDashoffset:d,strokeLinecap:"round",style:{transition:"stroke-dashoffset 0.5s ease, stroke 0.3s ease"}}),t.jsxs("g",{transform:`rotate(90 ${h} ${h})`,children:[t.jsx("text",{x:h,y:h-5,textAnchor:"middle",dominantBaseline:"middle",className:"font-bold",style:{fontSize:n*.18,fill:o,fontFamily:"system-ui, -apple-system, sans-serif"},children:m}),t.jsx("text",{x:h,y:h+n*.12,textAnchor:"middle",dominantBaseline:"middle",className:"text-gray-600",style:{fontSize:n*.07,fill:"#4b5563",fontFamily:"system-ui, -apple-system, sans-serif"},children:g})]})]})})};function mb(r,e,s,n){if(!r||e>=100)return null;const a=100-e;if(e<5||s===0){const d=a/100;return r.estimatedDurationMs*d}const i=a/s,o=a/100,A=r.estimatedDurationMs*o,l=Math.min(e/100,.7),c=A*(1-l)+i*l;return Math.max(0,c)}function pb(r){const e=r/1e3;if(e<60)return`${e.toFixed(1)}s left`;const s=Math.floor(e/60),n=e%60;return`${s}m ${n.toFixed(1)}s left`}const qi=[{id:"audio-processing",label:"Processing Audio",icon:Rt,range:[0,10],color:Ss(wn("audio-processing")).progressGradient},{id:"transcribing",label:"Transcribing",icon:Et,range:[10,40],color:Ss(wn("transcribing")).progressGradient},{id:"ai-analysis",label:"AI Analysis",icon:Xo,range:[40,90],color:Ss(wn("ai-analysis")).progressGradient},{id:"generation",label:"Generating",icon:Ka,range:[90,100],color:Ss(wn("generation")).progressGradient}],Ho=({progress:r,startTime:e,agentType:s,transcriptionLength:n,audioDuration:a,showTimeEstimate:i=!0,showCircularTimer:o=!0,className:A=""})=>{const[l,c]=u.useState(0),[d,m]=u.useState(null),[g,h]=u.useState(0),[p]=u.useState(()=>Nr.getInstance()),b=e||Date.now();u.useEffect(()=>{const v=window.setInterval(()=>{const x=Date.now()-b;if(x>=0&&x<864e5&&(c(x),x>0&&r.progress>0)){const f=r.progress/x;h(f)}},500);return()=>clearInterval(v)},[b,r.progress]),u.useEffect(()=>{if(s&&n&&i&&!d)try{const v=p.predictProcessingTime(s,n,{audioDuration:a,includeTranscriptionTime:!0});m(v)}catch(v){console.warn("Failed to generate time prediction:",v)}},[s,n,a,i,d,p]);const N=v=>{const[x,f]=v.range;return r.progress>=f?"complete":r.progress>=x&&r.progress<f?"active":"inactive"},y=v=>{const x=N(v);if(x==="complete")return 100;if(x==="inactive")return 0;const[f,S]=v.range,F=(r.progress-f)/(S-f)*100;return Math.max(0,Math.min(100,F))},j=u.useMemo(()=>qi.find(v=>N(v)==="active"),[r.progress]),Q=u.useMemo(()=>mb(d,r.progress,g),[d,r.progress,g,l]);return t.jsxs(se.div,{className:`bg-white rounded-lg border border-gray-200 shadow-sm ${A}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},role:"status","aria-live":"polite","aria-label":"Processing pipeline progress",children:[o&&Q!==null&&Q>500&&t.jsx("div",{className:"flex justify-center py-6 border-b border-gray-100",children:t.jsx("div",{className:"w-40 h-40 sm:w-52 sm:h-52 md:w-60 md:h-60",children:t.jsx(ub,{remainingMs:Q,progress:r.progress,stage:r.stage,size:240,className:"w-full h-full"})})}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[j&&t.jsx(j.icon,{className:"w-4 h-4 text-gray-700"}),t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:s?s.charAt(0).toUpperCase()+s.slice(1).replace("-"," "):"Processing"}),r.modelName&&t.jsxs("span",{className:"text-xs text-gray-500",children:["‚Ä¢ ",r.modelName]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"flex items-center space-x-1 text-indigo-600",children:[t.jsx(Kt,{className:"w-3 h-3"}),t.jsx("span",{className:"text-xs font-mono font-medium",children:mp(l)})]}),Q!==null&&Q>2e3&&t.jsxs("div",{className:"flex items-center space-x-1 text-purple-600",children:[t.jsx(Dn,{className:"w-3 h-3"}),t.jsx("span",{className:"text-xs font-medium",children:pb(Q)})]}),t.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:[Math.round(r.progress),"%"]})]})]}),t.jsx("div",{className:"mb-3",children:t.jsx("div",{className:"flex gap-1",children:qi.map(v=>{const x=N(v),f=y(v),S=v.range[1]-v.range[0];return t.jsxs("div",{className:"relative overflow-hidden rounded-sm",style:{flex:S},children:[t.jsx("div",{className:`h-2 ${v.color.inactive}`}),t.jsx(se.div,{className:`absolute inset-y-0 left-0 ${x==="complete"?v.color.complete:x==="active"?v.color.active:v.color.inactive}`,initial:{width:0},animate:{width:`${f}%`},transition:{duration:.3,ease:"easeOut"}}),x==="active"&&t.jsx(se.div,{className:`absolute inset-0 ${v.color.active} opacity-50`,animate:{opacity:[.3,.6,.3]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})]},v.id)})})}),t.jsx("div",{className:"flex justify-between text-[10px] mb-3",children:qi.map(v=>{const x=N(v),f=v.icon;return t.jsxs("div",{className:`flex items-center space-x-0.5 ${x==="complete"?"text-gray-600":x==="active"?"text-gray-900 font-medium":"text-gray-400"}`,children:[t.jsx(f,{className:"w-2.5 h-2.5"}),t.jsx("span",{children:v.label})]},v.id)})}),r.details&&t.jsxs("div",{className:"text-xs text-gray-600 text-center py-2 bg-gray-50 rounded border border-gray-100",children:[r.details,r.queuePosition!==void 0&&r.queuePosition>0&&t.jsxs("span",{className:"ml-2 text-gray-500",children:["‚Ä¢ Queue position: ",r.queuePosition]}),r.tokenCount!==void 0&&r.tokenCount>0&&t.jsxs("span",{className:"ml-2 text-emerald-600",children:["‚Ä¢ ",r.tokenCount," tokens"]})]}),t.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200 text-center",children:t.jsx("p",{className:"text-xs text-gray-500",children:r.progress>=100?"‚úÖ Processing complete":r.modelName?`ü§ñ ${r.modelName}`:"üîÑ Local processing - privacy-first"})})]})]})},lu=u.memo(({results:r,resultsSummary:e="",agentType:s,onCopy:n,onInsertToEMR:a,warnings:i=[],onDismissWarnings:o,selectedSessionId:A=null,selectedPatientName:l="",originalTranscription:c,audioDuration:d,onTranscriptionCopy:m,onTranscriptionInsert:g,onTranscriptionEdit:h,transcriptionSaveStatus:p,currentAgent:b,onAgentReprocess:N,missingInfo:y,onReprocessWithAnswers:j,onDismissMissingInfo:Q,isProcessing:v=!1,failedAudioRecordings:x=[],onClearFailedRecordings:f,errors:S=[],reviewData:F,audioBlob:w,transcriptionTime:T=null,agentProcessingTime:C=null,totalProcessingTime:E=null,processingStatus:U="idle",currentAgentName:k=null,modelUsed:P=null,patientVersion:M=null,isGeneratingPatientVersion:$=!1,onGeneratePatientVersion:W,streaming:V=!1,streamBuffer:L="",ttftMs:O=null,onStopStreaming:z,approvalState:H,onTranscriptionApprove:X,isStreaming:Ae=!1,streamingTokens:D="",onCancelStreaming:K,taviStructuredSections:ee,educationData:pe,preOpPlanData:ae,rhcReport:me,pipelineProgress:le,processingStartTime:re,revisionPanel:te,revisionContext:he,onRevisionToggle:Ce,onRevisionChange:ge,onRevisionSave:Z,onRevisionDiscard:be,onRevisionMarkGoldenPair:we,isSavingRevision:ye=!1,isSavingGoldenPair:Ne=!1})=>{const[Be,J]=u.useState(!0),Y=u.useMemo(()=>{const _=Kc(r),G=Vc(_);return{wordCount:_,readingTime:G}},[r]),[fe,Ue]=u.useState({copied:!1,inserted:!1}),[Ie,vt]=u.useState({copied:!1,inserted:!1}),[Pe,Ft]=u.useState({copied:!1,inserted:!1}),sr=u.useCallback(async()=>{await n(e||"No summary available"),Ue(G=>({...G,copied:!0})),setTimeout(()=>Ue(G=>({...G,copied:!1})),2e3)},[n,e]),At=u.useCallback(async()=>{await a(e||"No summary available"),Ue(G=>({...G,inserted:!0})),setTimeout(()=>Ue(G=>({...G,inserted:!1})),2e3)},[a,e]),mt=u.useCallback(async()=>{await n(r),vt(_=>({..._,copied:!0})),setTimeout(()=>vt(_=>({..._,copied:!1})),2e3)},[n,r]),Qt=u.useCallback(async()=>{await a(r),vt(_=>({..._,inserted:!0})),setTimeout(()=>vt(_=>({..._,inserted:!1})),2e3)},[a,r]),It=u.useCallback(()=>{const _=new Blob([e],{type:"text/plain"}),G=URL.createObjectURL(_),q=document.createElement("a");q.href=G,q.download=`medical-summary-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(G)},[e]);u.useCallback(()=>{const _=new Blob([r],{type:"text/plain"}),G=URL.createObjectURL(_),q=document.createElement("a");q.href=G,q.download=`medical-letter-${s||"report"}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(G)},[r,s]);const Ut=u.useCallback(async()=>{M&&(await n(M),Ft(_=>({..._,copied:!0})),setTimeout(()=>Ft(_=>({..._,copied:!1})),2e3))},[n,M]),br=u.useCallback(async()=>{M&&(await a(M),Ft(_=>({..._,inserted:!0})),setTimeout(()=>Ft(_=>({..._,inserted:!1})),2e3))},[a,M]),Jr=u.useCallback(()=>{if(M){const _=new Blob([M],{type:"text/plain"}),G=URL.createObjectURL(_),q=document.createElement("a");q.href=G,q.download=`patient-version-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(G)}},[M]),nr=!!te?.isEditing,Vn=!!Ce,Zr=u.useMemo(()=>{if(!te)return[];const _=[];s&&_.push(s),he?.workflowId&&_.push(he.workflowId),he?.agentLabel&&_.push(he.agentLabel);const G=te.tags?.filter(Boolean)??[];return Array.from(new Set([..._,...G]))},[te,s,he?.workflowId]),ar=u.useMemo(()=>{if(!te)return null;const _=te.original?.length||0,G=te.edited?.length||0,q=G-_,de=te.original?te.original.trim().split(/\s+/).filter(Boolean).length:0,Ee=te.edited?te.edited.trim().split(/\s+/).filter(Boolean).length:0,Te=Ee-de;return{originalLength:_,editedLength:G,deltaChars:q,originalWords:de,editedWords:Ee,deltaWords:Te}},[te]),Gn=u.useMemo(()=>te&&te.tags?.join(", ")||"",[te]),yr=u.useMemo(()=>{if(!te?.lastSavedAt)return null;try{return po(te.lastSavedAt)}catch(_){return console.warn("Failed to format revision saved timestamp",_),null}},[te?.lastSavedAt]),qs=!te?.hasUnsavedChanges||ye,Wn=!te?.notes?.trim()||Ne,zn=u.useCallback(_=>{ge?.({edited:_.target.value})},[ge]),Bi=u.useCallback(_=>{ge?.({notes:_.target.value})},[ge]),ir=u.useCallback(_=>{const G=_.target.value.split(",").map(q=>q.trim()).filter(Boolean);ge?.({tags:G})},[ge]),Ci=u.useCallback(_=>{ge?.({runEvaluationOnSave:_.target.checked})},[ge]),es=s==="ai-medical-review"&&F,Ni=s==="quick-letter"&&r,ms=s==="tavi-workup"&&r,Ys=s==="right-heart-cath"&&r,ji=s==="patient-education"&&r,Xn=s==="pre-op-plan"&&r;s==="tavi-workup"&&console.log("üîç TAVI Detection Debug:",{agentType:s,hasResults:!!r,resultsLength:r?.length,isTAVIWorkup:ms,resultsPreview:r?.substring(0,100),hasStructuredSections:!!ee,structuredSectionsKeys:ee?Object.keys(ee):null,patientContentExists:ee?.patient?.content?"Yes":"No"});const I=s==="quick-letter"&&!!r&&!!e||s==="tavi-workup"&&!!r||s==="right-heart-cath"&&!!r||s!=="quick-letter"&&s!=="tavi-workup"&&s!=="right-heart-cath"&&!!r,R=()=>t.jsxs(se.div,{className:"p-4 border-b border-emerald-200/50",initial:"hidden",animate:"visible",variants:Ke(Rr),children:[A&&l&&t.jsx(se.div,{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2,duration:xt.quick},children:t.jsxs(se.div,{className:"flex items-center space-x-2",variants:Ke(Wa),children:[t.jsx(vA,{className:"w-3 h-3 text-blue-600"}),t.jsxs("span",{className:"text-blue-800 text-xs font-medium",children:["Viewing session for: ",l]})]})}),t.jsxs(se.div,{className:"flex items-center justify-between",variants:Ke(Ra),children:[t.jsx("div",{className:"flex items-center space-x-2",children:es?t.jsxs(t.Fragment,{children:[t.jsx(Fr,{className:"w-4 h-4 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:F.isBatchReview?"Batch AI Medical Review":"AI Medical Review"}),t.jsx("p",{className:"text-blue-700 text-xs",children:F.isBatchReview?"Multi-patient clinical oversight recommendations":"Australian clinical oversight recommendations"})]})]}):v?t.jsxs(t.Fragment,{children:[t.jsx(Pt,{className:"w-4 h-4 text-blue-600 animate-pulse"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Processing"}),t.jsx("p",{className:"text-blue-700 text-xs",children:le?.details||"Processing medical information..."})]})]}):t.jsxs(t.Fragment,{children:[t.jsx(Pt,{className:"w-4 h-4 text-emerald-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Final Proof"}),t.jsx("p",{className:"text-emerald-700 text-xs",children:A?"Viewing previous session":"Processed output ready for review"})]})]})}),t.jsx("button",{onClick:()=>J(!Be),className:"bg-white/60 border border-emerald-200 p-2 rounded-lg hover:bg-emerald-50/60 transition-colors",title:Be?"Collapse":"Expand",children:Be?t.jsx(nm,{className:"w-4 h-4 text-emerald-600"}):t.jsx(vA,{className:"w-4 h-4 text-emerald-600"})})]}),t.jsxs(se.div,{className:"flex items-center space-x-4 mt-2 text-xs",variants:Ke(Wa),transition:{delay:.1},children:[es?t.jsxs("div",{className:"text-blue-600 flex items-center space-x-2",children:[t.jsxs("span",{children:[F.findings.length," clinical findings"]}),t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{children:[F.findings.filter(_=>_.urgency==="Immediate").length," immediate"]}),F.isBatchReview&&F.batchSummary&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{children:[F.batchSummary.totalPatients," patients"]})]}),t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:new Date().toLocaleTimeString()}),i.length>0&&t.jsx("span",{children:"‚Ä¢"})]}):t.jsxs("div",{className:"text-emerald-600 flex items-center space-x-2",children:[Y.wordCount>0&&t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:[Y.wordCount," words"]}),Y.readingTime&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:Gc(Y.readingTime)})]}),t.jsx("span",{children:"‚Ä¢"})]}),t.jsx("span",{title:`Generated at ${po(Date.now())}`,children:new Date().toLocaleTimeString()}),i.length>0&&t.jsx("span",{children:"‚Ä¢"})]}),i.length>0&&t.jsx(ed,{warnings:i,onDismissWarnings:o})]})]});return t.jsxs(se.div,{className:"letter-card rounded-lg overflow-hidden border-2 border-emerald-200",initial:"hidden",animate:"visible",variants:Ke(Rr),children:[R(),t.jsx(Le,{children:s==="tavi-workup"&&le&&t.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:xt.normal},className:"p-4 border-b border-gray-200",children:t.jsx(Ho,{progress:le,startTime:re||void 0,agentType:s,audioDuration:d,showTimeEstimate:!0})})}),t.jsx(Le,{children:le&&s!=="tavi-workup"&&t.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:xt.normal},className:"p-4 border-b border-gray-200",children:t.jsx(Ho,{progress:le,startTime:re||void 0,agentType:s||void 0,transcriptionLength:c?.length,audioDuration:d,showTimeEstimate:!0})})}),t.jsx(Le,{children:c&&!V&&!ms&&!Ys&&s!=="investigation-summary"&&t.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:xt.normal},children:t.jsx(Lr,{originalTranscription:c,onTranscriptionCopy:m,onTranscriptionInsert:g,onTranscriptionEdit:h,transcriptionSaveStatus:p,onAgentReprocess:N,currentAgent:b,isProcessing:v,audioBlob:w,defaultExpanded:!I,collapseWhen:I,approvalState:H,onTranscriptionApprove:X})})}),t.jsx(Le,{children:Be&&t.jsxs(se.div,{className:"p-4",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:xt.normal},children:[t.jsx(Le,{children:V&&t.jsxs(se.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:xt.quick},children:[c&&t.jsx(Lr,{originalTranscription:c,onTranscriptionCopy:m,onTranscriptionInsert:g,onTranscriptionEdit:h,transcriptionSaveStatus:p,onAgentReprocess:N,currentAgent:b,isProcessing:!0,audioBlob:w,defaultExpanded:!0,collapseWhen:!1,approvalState:H,onTranscriptionApprove:X}),t.jsxs("div",{className:"rounded-lg border border-emerald-300 bg-emerald-50",children:[t.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-emerald-200 bg-emerald-100",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-emerald-600 text-sm",children:"‚óè Live Output"}),O!=null&&t.jsxs("span",{className:"text-xs text-emerald-700",children:["TTFT: ",O," ms"]})]}),t.jsx("button",{onClick:z,className:"text-xs px-2 py-1 rounded border border-red-300 text-red-700 bg-red-50 hover:bg-red-100",children:"Stop"})]}),t.jsx("div",{className:"p-3 max-h-64 overflow-y-auto",children:t.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-900",children:L})})]})]})}),t.jsx(Le,{children:y&&(y.missing_diagnostic?.length>0||y.missing_intervention?.length>0||y.missing_purpose?.length>0||y.missing_clinical?.length>0||y.missing_recommendations?.length>0||y.missing_structured?.length>0)&&t.jsx(se.div,{className:"mb-4",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:xt.quick},children:t.jsx(rd,{missingInfo:y,onSubmit:_=>j&&j(_),onDismiss:Q,agentType:s})})}),Ae&&D?t.jsxs(se.div,{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",variants:Ke(Rr),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"p-3 border-b border-blue-200 bg-blue-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),t.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Generating Response..."})]}),K&&t.jsx("button",{onClick:K,className:"text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors","aria-label":"Cancel streaming",children:"Cancel"})]}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"text-gray-800 text-sm leading-relaxed whitespace-pre-wrap font-mono",children:[D,t.jsx("span",{className:"inline-block w-2 h-4 bg-blue-500 animate-pulse ml-1"})]}),t.jsx("div",{className:"mt-3 text-xs text-blue-600",children:"Real-time generation in progress..."})]})]}):es?t.jsxs(t.Fragment,{children:[console.log("üñºÔ∏è RESULTS PANEL: Rendering AIReviewCards with data:",F),t.jsx(Zc,{reviewData:F,storageKey:"ui_preferences_card_theme"})]}):s==="quick-letter"&&r&&!V?(console.log("‚úÖ RESULTS PANEL: Using QuickLetter dual-card display",{hasResults:!!r,resultsLength:r?.length||0,hasSummary:!!e,summaryLength:e?.length||0,agentType:s,streaming:V}),null,t.jsxs(se.div,{className:"space-y-4",variants:Ke(go),initial:"hidden",animate:"visible",transition:{staggerChildren:Ga.normal,delayChildren:.1},children:[t.jsxs(se.div,{className:"letter-card rounded-lg border border-emerald-200 bg-emerald-50",variants:Ke(Rr),children:[t.jsx("div",{className:"p-3 border-b border-emerald-200 bg-emerald-100",children:t.jsx("h4",{className:"text-emerald-800 font-semibold text-sm",children:"Summary"})}),t.jsx("div",{className:"p-3 max-h-48 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:e||t.jsx("div",{className:"text-gray-500 italic",children:"Summary not available - displaying full letter content below"})})}),t.jsx("div",{className:"p-3 border-t border-emerald-200 bg-emerald-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:sr,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${fe.copied?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[fe.copied?t.jsx(ft,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Hr,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${fe.copied?"text-emerald-700":"text-gray-700"}`,children:fe.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:At,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${fe.inserted?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[fe.inserted?t.jsx(ft,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):t.jsx(Ns,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${fe.inserted?"text-emerald-700":"text-gray-700"}`,children:fe.inserted?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:It,className:"bg-white/60 border border-emerald-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-emerald-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(jr,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]}),t.jsxs(se.div,{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",variants:Ke(Rr),children:[t.jsx("div",{className:"p-3 border-b border-blue-200 bg-blue-100",children:t.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Letter"})}),t.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:r})}),t.jsx("div",{className:"p-3 border-t border-blue-200 bg-blue-50",children:t.jsxs("div",{className:`grid gap-2 ${Vn?"grid-cols-4":"grid-cols-3"}`,children:[t.jsxs("button",{onClick:mt,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${Ie.copied?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[Ie.copied?t.jsx(ft,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(Hr,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${Ie.copied?"text-blue-700":"text-gray-700"}`,children:Ie.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:Qt,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${Ie.inserted?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[Ie.inserted?t.jsx(ft,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(Ns,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${Ie.inserted?"text-blue-700":"text-gray-700"}`,children:Ie.inserted?"Inserted!":"Insert"})]}),Vn&&t.jsxs("button",{onClick:()=>Ce?.(!nr),className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${nr?"bg-blue-600 border-blue-600 text-white shadow-sm":"bg-white/60 border-blue-200 hover:bg-blue-50/80 text-blue-700"}
                        `,title:"Revise output and capture training example",children:[t.jsx(Ka,{className:`w-4 h-4 ${nr?"text-white":"text-blue-700"}`}),t.jsx("span",{className:`text-xs ${nr?"text-white font-semibold":"text-blue-700"}`,children:nr?"Editing‚Ä¶":"Edit & Train"})]}),t.jsx("button",{onClick:W,disabled:$,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${$?"bg-blue-100/60 border-blue-300 text-blue-500 cursor-not-allowed":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:$?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-300 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-xs text-blue-500",children:"Generating"})]}):t.jsxs(t.Fragment,{children:[t.jsx(As,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Patient Version"})]})})]})})]}),t.jsx(Le,{children:M&&t.jsxs(se.div,{className:"letter-card rounded-lg border border-purple-200 bg-purple-50",variants:Ke(Rr),initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.2},children:[t.jsx("div",{className:"p-3 border-b border-purple-200 bg-purple-100",children:t.jsx("h4",{className:"text-purple-800 font-semibold text-sm",children:"Patient-Friendly Version"})}),t.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:M})}),t.jsx("div",{className:"p-3 border-t border-purple-200 bg-purple-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:Ut,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${Pe.copied?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[Pe.copied?t.jsx(ft,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):t.jsx(Hr,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${Pe.copied?"text-purple-700":"text-gray-700"}`,children:Pe.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:br,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${Pe.inserted?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[Pe.inserted?t.jsx(ft,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):t.jsx(Ns,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${Pe.inserted?"text-purple-700":"text-gray-700"}`,children:Pe.inserted?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:Jr,className:"bg-white/60 border border-purple-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-purple-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(jr,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]})})]})):ms?t.jsxs("div",{className:"space-y-6",children:[t.jsx(Lr,{originalTranscription:c||"",onTranscriptionCopy:m,onTranscriptionInsert:g,onTranscriptionEdit:h,transcriptionSaveStatus:p,onAgentReprocess:N,currentAgent:b,isProcessing:v,audioBlob:w,defaultExpanded:!I,collapseWhen:I,approvalState:H,onTranscriptionApprove:X}),t.jsx(wp,{structuredSections:ee,results:r,missingInfo:y?.missing_structured||[],onCopy:n,onInsertToEMR:a,onReprocessWithAnswers:j})]}):Ys?t.jsx(eb,{rhcReport:me,results:r,onCopy:n,onInsertToEMR:a,originalTranscription:c,onTranscriptionCopy:m,onTranscriptionInsert:g,onTranscriptionEdit:h,transcriptionSaveStatus:p,onAgentReprocess:N,currentAgent:b,isProcessing:v,audioBlob:w,defaultTranscriptionExpanded:!I,collapseTranscriptionWhen:I,approvalState:H,onTranscriptionApprove:X,onReprocessWithAnswers:j,onDismissMissingInfo:Q}):ji?t.jsx(ab,{report:{id:`report-${Date.now()}`,timestamp:Date.now(),content:r,agentName:k||"Patient Education & Lifestyle Medicine",metadata:{processingTime:E||0,confidence:.9,modelUsed:"medgemma-27b"},sections:[],warnings:i||[],errors:S||[],educationData:pe||{priority:"medium",modules:[],australianGuidelines:[],patientResources:[],jsonMetadata:null,letterContent:r}},onCopy:async _=>{await Promise.resolve(n(_))},onInsert:async _=>{await Promise.resolve(a(_))},isVisible:!0}):Xn?t.jsx(Au,{session:{id:A||`session-${Date.now()}`,patient:{name:l||"Unknown",id:"",dob:"",age:"",extractedAt:Date.now()},transcription:c||"",results:r,agentType:"pre-op-plan",agentName:k||"Pre-Op Plan",timestamp:Date.now(),status:"completed",completed:!0,processingTime:E||void 0,modelUsed:P||void 0,warnings:i||void 0,errors:S||void 0,completedTime:Date.now(),preOpPlanData:ae||{procedureType:"ANGIOGRAM_OR_PCI",cardMarkdown:r,jsonData:{procedure_type:"ANGIOGRAM_OR_PCI",fields:{}}},audioBlob:w||void 0},onCopy:n,onInsertToEMR:a,onTranscriptionCopy:m,onTranscriptionInsert:g,onTranscriptionEdit:h,onTranscriptionApprove:X,transcriptionApprovalState:H,onAgentReprocess:b?()=>N?.(b):void 0,isProcessing:v}):(s==="quick-letter"&&console.warn("‚ö†Ô∏è RESULTS PANEL: Quick Letter falling through to generic ReportDisplay",{hasResults:!!r,resultsLength:r?.length||0,hasSummary:!!e,summaryLength:e?.length||0,streaming:V,reason:r?V?"Still streaming":"Unknown":"No results"}),null,t.jsxs("div",{className:"space-y-0",children:[t.jsx(Jc,{results:r,agentType:s}),s==="investigation-summary"&&c&&!V&&t.jsx(Lr,{originalTranscription:c,onTranscriptionCopy:m,onTranscriptionInsert:g,onTranscriptionEdit:h,transcriptionSaveStatus:p,onAgentReprocess:N,currentAgent:b,isProcessing:v,audioBlob:w,defaultExpanded:!I,collapseWhen:I,approvalState:H,onTranscriptionApprove:X})]}))]})}),t.jsx(Le,{children:s==="angiogram-pci"&&M&&!v&&t.jsx(se.div,{className:"space-y-4 px-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.2},children:t.jsxs("div",{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",children:[t.jsx("div",{className:"p-3 border-b border-blue-200 bg-blue-100",children:t.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Patient-Friendly Explanation"})}),t.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:M})}),t.jsx("div",{className:"p-3 border-t border-blue-200 bg-blue-50",children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:Ut,className:`
                      p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                      ${Pe.copied?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                    `,children:[Pe.copied?t.jsx(ft,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(Hr,{className:"w-4 h-4",title:"Copy"}),t.jsx("span",{className:`text-xs ${Pe.copied?"text-blue-700":"text-gray-700"}`,children:Pe.copied?"Copied!":"Copy"})]}),t.jsxs("button",{onClick:br,className:`
                      p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                      ${Pe.inserted?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                    `,children:[Pe.inserted?t.jsx(ft,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):t.jsx(Ns,{className:"w-4 h-4"}),t.jsx("span",{className:`text-xs ${Pe.inserted?"text-blue-700":"text-gray-700"}`,children:Pe.inserted?"Inserted!":"Insert"})]}),t.jsxs("button",{onClick:Jr,className:"bg-white/60 border border-blue-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-blue-50/60 transition-colors btn-micro-press btn-micro-hover",children:[t.jsx(jr,{className:"w-4 h-4 text-gray-700"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]})})}),t.jsx(Le,{children:!v&&!es&&!Ni&&!ms&&!Ys&&t.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.3},children:t.jsx(eA,{results:r,agentType:s,onCopy:n,onInsertToEMR:a,onEditAndTrain:Ce?()=>Ce(!nr):void 0,editAndTrainActive:nr,disableEditAndTrain:v||!r,customActions:s==="angiogram-pci"?[{id:"generate-patient-version",label:$?"Generating...":"Patient Version",icon:({className:_})=>$?t.jsx("div",{className:`border-2 border-blue-300 border-t-transparent rounded-full animate-spin ${_}`}):t.jsx("svg",{className:_,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),onClick:W||(()=>{}),variant:"secondary"}]:[]})})}),t.jsx(Le,{children:nr&&te&&t.jsx(se.div,{className:"px-4 pb-2",initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-16},transition:{duration:.2},children:t.jsxs("div",{"data-testid":"result-revision-panel",className:"border border-blue-200 bg-blue-50/70 rounded-xl shadow-sm p-4 sm:p-5 space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:Zr.length===0?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:[t.jsx(yA,{className:"w-3 h-3"}),"Training Capture"]}):Zr.map(_=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:[t.jsx(yA,{className:"w-3 h-3"}),_]},_))}),t.jsxs("button",{type:"button",onClick:()=>Ce?.(!1),className:"inline-flex items-center gap-1 text-xs text-blue-700 hover:text-blue-900",children:[t.jsx(nt,{className:"w-3 h-3"}),"Close"]})]}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-semibold text-blue-900 uppercase tracking-wide",children:"Original Output"}),t.jsx("div",{className:"p-3 bg-white border border-blue-100 rounded-lg max-h-64 overflow-auto text-sm whitespace-pre-wrap text-slate-700",children:te.original||"No original output available."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-xs font-semibold text-blue-900 uppercase tracking-wide",children:"Edited Revision"}),te.hasUnsavedChanges?t.jsxs("span",{className:"text-[11px] text-amber-600 font-medium flex items-center gap-1",children:[t.jsx(Fr,{className:"w-3 h-3"}),"Unsaved changes"]}):yr?t.jsxs("span",{className:"text-[11px] text-emerald-600 flex items-center gap-1",children:[t.jsx(ft,{className:"w-3 h-3"}),"Saved ",yr]}):null]}),t.jsx("textarea",{"data-testid":"revision-editor",value:te.edited,onChange:zn,className:"w-full min-h-[200px] max-h-[320px] resize-y border border-blue-200 rounded-lg px-3 py-2 text-sm font-mono bg-white focus:outline-none focus:ring-2 focus:ring-blue-300",placeholder:"Make clinician revisions here..."})]})]}),ar&&t.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-blue-900",children:[t.jsxs("span",{children:["Characters: ",ar.editedLength," ","(",ar.deltaChars>=0?"+":"",ar.deltaChars,")"]}),t.jsxs("span",{children:["Words: ",ar.editedWords," ","(",ar.deltaWords>=0?"+":"",ar.deltaWords,")"]})]}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"text-xs font-semibold text-blue-900 uppercase tracking-wide",children:["Scenario Summary ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("textarea",{"data-testid":"revision-notes",value:te.notes,onChange:Bi,placeholder:"Example: Normalize measurement spacing, abbreviations, ensure parentheses",className:"w-full h-24 resize-y border border-blue-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-300"}),t.jsx("p",{className:"text-[11px] text-blue-700",children:"Describe why this revision is a gold standard example for future optimization."})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-semibold text-blue-900 uppercase tracking-wide",children:"Tags"}),t.jsx("input",{type:"text",value:Gn,onChange:ir,placeholder:"heart-failure, formatting, urgent",className:"w-full border border-blue-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-300"}),t.jsx("p",{className:"text-[11px] text-blue-700",children:"Comma-separated tags help cluster similar training examples."})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm text-blue-900",children:[t.jsx("input",{type:"checkbox",className:"rounded border-blue-300 text-blue-600 focus:ring-blue-400",checked:te.runEvaluationOnSave,onChange:Ci}),"Run GEPA preview after saving golden pair"]})]})]}),t.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:be,disabled:!te.hasUnsavedChanges||ye,className:`inline-flex items-center gap-1 px-3 py-2 rounded-lg border text-sm font-medium transition-colors
                    ${te.hasUnsavedChanges&&!ye?"border-blue-300 text-blue-700 hover:bg-blue-100":"border-blue-100 text-blue-400 cursor-not-allowed"}`,children:"Reset"}),t.jsxs("button",{"data-testid":"save-revision-btn",type:"button",onClick:Z,disabled:qs,className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium transition-colors
                    ${qs?"bg-blue-200 border-blue-200 text-white cursor-not-allowed":"bg-blue-600 border-blue-600 text-white hover:bg-blue-700"}`,children:[ye&&t.jsx(er,{className:"w-4 h-4 animate-spin"}),"Save Revision"]}),t.jsxs("button",{"data-testid":"mark-golden-pair-btn",type:"button",onClick:we,disabled:Wn,className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-semibold transition-colors
                    ${Wn?"bg-emerald-200 border-emerald-200 text-white cursor-not-allowed":"bg-emerald-600 border-emerald-600 text-white hover:bg-emerald-700"}`,children:[Ne?t.jsx(er,{className:"w-4 h-4 animate-spin"}):t.jsx(Ka,{className:"w-4 h-4"}),"Mark as Golden Pair"]})]})]})})}),t.jsx(Le,{children:U==="complete"&&E&&t.jsx(se.div,{className:"px-4 pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.4},children:t.jsx(fp,{appState:{processingStatus:U,totalProcessingTime:E,transcriptionTime:T,agentProcessingTime:C,currentAgent:s,currentAgentName:k,processingStartTime:null},isRecording:!1,recordingTime:0,transcriptionLength:c?c.length:0,modelUsed:P})})}),t.jsx(td,{failedAudioRecordings:x,errors:S,onClearFailedRecordings:f})]})});lu.displayName="OptimizedResultsPanel";function Sl(r,e){return e?r.length>12:!1}const Yi=({id:r,label:e,alias:s,icon:n,category:a,onClick:i,isProcessing:o=!1,disabled:A=!1,className:l="",isExpandable:c=!1,workflowId:d,onDictate:m,onType:g})=>{const[h,p]=u.useState(!1),b=Sl(e,s)&&s?s:e,N=s&&Sl(e,s)||e.length>15,y=u.useCallback(()=>{!o&&c&&p(!0)},[o,c]),j=u.useCallback(()=>{p(!1)},[]),Q=u.useCallback(async()=>{m&&d&&m(d,r),p(!1)},[m,d,r]),v=u.useCallback(async()=>{g&&g(r),p(!1)},[g,r]);return c?t.jsxs("div",{className:`relative overflow-hidden ${l}`,onMouseEnter:y,onMouseLeave:j,style:{minHeight:"64px"},children:[t.jsx("div",{className:`
        absolute inset-0 transition-all duration-200 ease-out
        ${h&&!o?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100"}
      `,children:t.jsxs("button",{disabled:o,className:`
            group w-full h-full flex flex-col items-center justify-center
            p-2 rounded-lg transition-all duration-150
            hover:bg-gray-50
            ${o?"opacity-50 cursor-not-allowed":""}
          `,"aria-label":e,title:N?e:void 0,children:[t.jsx("div",{className:"w-6 h-6 mb-1.5 flex items-center justify-center",children:t.jsx(n,{className:`w-5 h-5 ${a==="core"?"text-blue-600":"text-gray-600"}`,strokeWidth:2})}),t.jsx("div",{className:"text-xs font-medium text-gray-700 text-center leading-tight line-clamp-2",children:b}),o&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 rounded-lg",children:t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})})]})}),t.jsx("div",{className:`
        absolute inset-0 transition-all duration-200 ease-out
        ${h&&!o?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}
      `,children:t.jsxs("div",{className:"grid grid-cols-2 gap-0.5 h-full",children:[t.jsxs("button",{onClick:Q,disabled:o,className:`
              flex flex-col items-center justify-center
              rounded-l-lg border-r border-gray-200
              transition-all duration-150
              hover:bg-blue-50
              ${o?"opacity-50 cursor-not-allowed":""}
            `,title:`Dictate ${e}`,"aria-label":`Dictate ${e} with voice`,children:[t.jsx(Rt,{className:"w-4 h-4 text-blue-600 mb-1",strokeWidth:2}),t.jsx("div",{className:"text-[10px] font-medium text-blue-700 leading-none",children:"Dict"})]}),t.jsxs("button",{onClick:v,disabled:o,className:`
              flex flex-col items-center justify-center
              rounded-r-lg
              transition-all duration-150
              hover:bg-blue-50
              ${o?"opacity-50 cursor-not-allowed":""}
            `,title:`Type ${e}`,"aria-label":`Type ${e} manually`,children:[t.jsx(Yo,{className:"w-4 h-4 text-blue-600 mb-1",strokeWidth:2}),t.jsx("div",{className:"text-[10px] font-medium text-blue-700 leading-none",children:"Type"})]})]})})]}):t.jsxs(se.button,{onClick:i,disabled:A||o,className:`
          group relative flex flex-col items-center justify-center
          p-2 rounded-lg
          transition-all duration-150
          ${A||o?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 active:bg-gray-100 cursor-pointer"}
          ${l}
        `,variants:Ke(pp),whileHover:!A&&!o?"hover":void 0,whileTap:!A&&!o?"tap":void 0,"aria-label":e,title:N?e:void 0,"data-action-id":r,children:[t.jsx("div",{className:`
          w-6 h-6 mb-1.5 flex items-center justify-center
          transition-transform duration-150
          group-hover:scale-110
        `,children:t.jsx(n,{className:`
              w-5 h-5
              ${a==="core"?"text-blue-600":"text-gray-600"}
              ${o?"animate-pulse":""}
            `,strokeWidth:2})}),t.jsx("div",{className:`
          text-xs font-medium text-gray-700 text-center leading-tight
          max-w-full
          line-clamp-2
        `,children:b}),o&&t.jsx(se.div,{className:"absolute inset-0 flex items-center justify-center bg-white/80 rounded-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}),t.jsx("div",{className:`
          absolute inset-0 rounded-lg
          ring-2 ring-transparent ring-offset-0
          group-focus-visible:ring-blue-500
          transition-all duration-150
        `})]})},Ji=[{id:"quick-letter",label:"Quick Letter",description:"Medical correspondence and consultation letters",agent:"QuickLetterAgent",icon:"FileText",color:"green",category:"documentation",estimatedTime:"1-3 min",complexity:"low",isExpandable:!0},{id:"tavi-workup",label:"TAVI Workup",description:"Pre-procedural TAVI anatomical and clinical workup summary",agent:"TAVIWorkupAgent",icon:"ClipboardList",color:"red",category:"documentation",estimatedTime:"3-5 min",complexity:"medium"},{id:"consultation",label:"Consultation",description:"Comprehensive patient assessments",agent:"ConsultationAgent",icon:"Stethoscope",color:"blue",category:"documentation",estimatedTime:"2-4 min",complexity:"medium"},{id:"angiogram-pci",label:"Angiogram/PCI",description:"Cardiac catheterization and coronary interventions",agent:"AngiogramPCIAgent",icon:"Heart",color:"red",category:"procedure",estimatedTime:"8-15 min",complexity:"high"},{id:"tavi",label:"TAVI Report",description:"Transcatheter aortic valve implantation",agent:"TAVIAgent",icon:"CircleDot",color:"red",category:"procedure",estimatedTime:"8-12 min",complexity:"high"},{id:"mteer",label:"mTEER Report",description:"Mitral transcatheter edge-to-edge repair",agent:"MTEERAgent",icon:"Zap",color:"purple",category:"procedure",estimatedTime:"7-10 min",complexity:"high"},{id:"pfo-closure",label:"PFO Closure",description:"Patent foramen ovale closure",agent:"PFOClosureAgent",icon:"Shield",color:"green",category:"procedure",estimatedTime:"5-8 min",complexity:"medium"},{id:"right-heart-cath",label:"Right Heart Cath",description:"Right heart catheterisation with haemodynamic assessment",agent:"RightHeartCathAgent",icon:"Activity",color:"orange",category:"procedure",estimatedTime:"6-10 min",complexity:"medium"},{id:"ohif-viewer",label:"OHIF Viewer",description:"Medical imaging viewer (coming soon)",agent:"OHIFViewerAgent",icon:"Monitor",color:"cyan",category:"investigation",estimatedTime:"N/A",complexity:"low"}],gb=(r="portal-root")=>{const e=u.useRef(null),[,s]=u.useState(0),n=u.useRef(null);return u.useEffect(()=>{const a=()=>{let o=document.getElementById(r);return o&&!document.body.contains(o)&&(console.warn(`üö® Portal container "${r}" exists but not in DOM - recreating`),o=null),o||(console.log(`üèóÔ∏è Creating portal container: ${r}`),o=document.createElement("div"),o.id=r,o.style.position="relative",o.style.zIndex="999999",o.style.pointerEvents="none",document.body.appendChild(o)),e.current=o,o};a(),n.current=new MutationObserver(o=>{for(const A of o)A.type==="childList"&&A.removedNodes.length>0&&Array.from(A.removedNodes).some(c=>c===e.current)&&(console.warn(`üö® Portal container "${r}" was removed from DOM - recreating`),a(),s(c=>c+1))}),n.current.observe(document.body,{childList:!0,subtree:!1});const i=window.setInterval(()=>{e.current&&!document.body.contains(e.current)&&(console.warn(`üö® Portal container "${r}" missing during validation - recreating`),a(),s(o=>o+1))},3e3);return()=>{console.log(`üßπ usePortal cleanup for "${r}" - keeping container in DOM`),n.current&&(n.current.disconnect(),n.current=null),window.clearInterval(i)}},[r]),e.current},lA=({isOpen:r,children:e,onClickOutside:s})=>{const n=gb("dropdown-portal");return u.useEffect(()=>{if(!r||!s)return;const a=o=>{const A=o.target;!A.closest("[data-dropdown-menu]")&&!A.closest("[data-dropdown-trigger]")&&s()},i=setTimeout(()=>{document.addEventListener("mousedown",a)},0);return()=>{clearTimeout(i),document.removeEventListener("mousedown",a)}},[r,s]),!r||!n?null:Qm.createPortal(t.jsx(t.Fragment,{children:e}),n)},hb=r=>{const{isOpen:e,offset:s={x:0,y:8},alignment:n="right",maxHeight:a=320,dropdownWidth:i=280,preferredDirection:o="auto"}=r,A=u.useRef(null),l=u.useRef(null),[c,d]=u.useState({top:0,left:0}),m=u.useCallback(()=>{if(!e)return;if(!A.current){console.warn("üö® useDropdownPosition: triggerRef.current is null - cannot calculate position");return}if(!A.current.isConnected){console.warn("üö® useDropdownPosition: triggerRef element is not connected to DOM - stale ref detected");return}if(!document.body.contains(A.current)){console.warn("üö® useDropdownPosition: triggerRef element not in document body - stale ref detected");return}const g=A.current.getBoundingClientRect();if(g.width===0&&g.height===0){console.warn("üö® useDropdownPosition: trigger element has zero dimensions - possibly detached");return}const h={width:window.innerWidth,height:window.innerHeight};let p=g.bottom+s.y,b=g.left+s.x,N;n==="right"?(b=g.right-i,N=h.width-g.right+s.x):n==="center"&&(b=g.left+g.width/2-i/2),b<8?(b=8,N=void 0):b+i>h.width-8&&(b=h.width-i-8,N=8);const y=h.height-g.bottom-8,j=g.top-8;let Q=a,v=!1;o==="up"?v=!0:o==="down"?v=!1:v=y<a&&j>y,v?(Q=Math.min(a,j),p=g.top-Q-s.y):Q=Math.min(a,y),d({top:p,left:N!==void 0?void 0:b,right:N,maxHeight:Q})},[e,s,n,a,i,o]);return u.useEffect(()=>{if(e){m();const g=()=>m(),h=()=>m();return window.addEventListener("resize",g),window.addEventListener("scroll",h,!0),()=>{window.removeEventListener("resize",g),window.removeEventListener("scroll",h,!0)}}},[e,m]),{triggerRef:A,dropdownRef:l,position:c,calculatePosition:m}},fb={Heart:ds,FileText:Et,Activity:qr,Stethoscope:Ic,CircleDot:om,Mic:Rt,Square:Ks,Monitor:im,Zap:Gr,Shield:is,ClipboardList:Et},Lo=u.memo(({onWorkflowSelect:r,activeWorkflow:e,isRecording:s,disabled:n=!1,voiceActivityLevel:a=0,recordingTime:i=0,whisperServerRunning:o=!0,onTypeClick:A})=>{const[l,c]=u.useState(!1),[d,m]=u.useState(!1),[g,h]=u.useState(null),p=u.useRef(null),b=u.useRef(!1),N=u.useRef(null),y=u.useRef(`record-menu-${Math.random().toString(36).slice(2)}`);u.useEffect(()=>(console.log("üé¨ RecordPanel mounted",{disabled:n,whisperServerRunning:o,isRecording:s,activeWorkflow:e}),c(!1),m(!1),b.current=!1,h(null),p.current&&(console.log("üßπ Clearing stale timeout on mount"),window.clearTimeout(p.current),p.current=null),console.log("‚úÖ RecordPanel state reset on mount"),()=>console.log("üé¨ RecordPanel unmounted")),[]),u.useEffect(()=>{console.log("üîÑ RecordPanel isExpanded changed:",l,{isHovering:d,disabled:n,whisperServerRunning:o})},[l,d,n,o]);const{triggerRef:j,position:Q}=hb({isOpen:l,alignment:"center",offset:{x:0,y:-2},maxHeight:480,dropdownWidth:340,preferredDirection:"up"}),v=k=>{const P=Math.floor(k/60),M=k%60;return`${P}:${M.toString().padStart(2,"0")}`},x=()=>{if(n){console.log("üö´ Mouse enter ignored - button disabled");return}if(j.current&&!j.current.isConnected){console.warn("üö® handleMouseEnter: triggerRef is stale, resetting state"),c(!1),m(!1),b.current=!1;return}console.log("üñ±Ô∏è Mouse entered record button",{isExpanded:l,hasTimeout:!!p.current,isHoveringRefCurrent:b.current,whisperServerRunning:o,disabled:n,isRecording:s,activeWorkflow:e,triggerConnected:j.current?.isConnected}),b.current=!0,m(!0),p.current&&(console.log("üßπ Clearing existing hover timeout"),window.clearTimeout(p.current),p.current=null),l||(console.log("‚è∞ Setting expand timeout"),p.current=window.setTimeout(()=>{b.current?(console.log("üéØ Expanding card after hover delay"),c(!0)):console.log("üö´ Not expanding - mouse already left"),p.current=null},50))},f=()=>{console.log("üñ±Ô∏è Mouse left record button",{isExpanded:l,isHoveringRefCurrent:b.current}),b.current=!1,m(!1),p.current&&(console.log("üßπ Clearing existing timeout on mouse leave"),window.clearTimeout(p.current),p.current=null),console.log("‚è∞ Setting collapse timeout"),p.current=window.setTimeout(()=>{b.current?console.log("üö´ Not collapsing - mouse returned"):(console.log("üîΩ Collapsing card - mouse completely away"),c(!1)),p.current=null},150)},S=()=>{console.log("üñ±Ô∏è Mouse entered card",{isExpanded:l,hasTimeout:!!p.current}),b.current=!0,m(!0),p.current&&(console.log("üßπ Clearing timeout on card enter"),window.clearTimeout(p.current),p.current=null)},F=()=>{console.log("üñ±Ô∏è Mouse left card",{isExpanded:l,isHoveringRefCurrent:b.current}),b.current=!1,m(!1),p.current&&(console.log("üßπ Clearing timeout on card leave"),window.clearTimeout(p.current),p.current=null),console.log("‚è∞ Setting collapse timeout from card"),p.current=window.setTimeout(()=>{b.current?console.log("üö´ Not collapsing - mouse returned to hover area"):(console.log("üîΩ Collapsing card - mouse left card area"),c(!1)),p.current=null},150)};u.useEffect(()=>{if(!s&&e){console.log("üîÑ Recording stopped - resetting dropdown state after delay",{activeWorkflow:e,isExpanded:l,isHovering:d,hasTimeout:!!p.current});const k=window.setTimeout(()=>{console.log("üîß Performing full dropdown state reset",{wasExpanded:l,wasHovering:d}),c(!1),m(!1),b.current=!1,p.current&&(console.log("üßπ Clearing hover timeout during recording stop reset"),window.clearTimeout(p.current),p.current=null),console.log("‚úÖ Dropdown state reset complete - ready for next recording")},1e3);return()=>{console.log("üßπ Cleaning up recording stop timeout"),window.clearTimeout(k)}}},[s,e]),u.useEffect(()=>()=>{console.log("üßπ RecordPanel unmounting - cleaning up timeouts and refs"),p.current&&(window.clearTimeout(p.current),p.current=null),b.current=!1},[]),u.useEffect(()=>{console.log("üîß RecordPanel state check:",{isExpanded:l,isHovering:d,isHoveringRefCurrent:b.current,disabled:n,whisperServerRunning:o,isRecording:s,activeWorkflow:e,hasTimeout:!!p.current,timestamp:Date.now()});const k=l&&!b.current&&!s,P=!n&&o;k&&(console.warn("üö® DETECTED STALE EXPANDED STATE - auto-fixing to restore hover functionality",{isExpanded:l,isHoveringRefCurrent:b.current,isRecording:s,isButtonAccessible:P}),c(!1),m(!1),b.current=!1,p.current&&(console.log("üßπ Clearing stale timeout during auto-fix"),window.clearTimeout(p.current),p.current=null),console.log("‚úÖ Stale state auto-fix complete - hover should work now")),P||console.log("‚ö†Ô∏è Button not accessible:",{disabled:n,whisperServerRunning:o,reason:n?"disabled=true":"whisper server not running"})},[n,o,s,l,e]),u.useEffect(()=>{const k=window.setTimeout(()=>{!s&&!n&&o&&console.log("üîç HOVER FUNCTIONALITY CHECK - button should be responsive",{componentReady:!0,buttonAccessible:!n&&o,isExpanded:l,isHovering:d,currentState:"ready-for-hover"})},2e3);return()=>{window.clearTimeout(k)}},[s,n,o,e]),u.useEffect(()=>{const k=window.setInterval(()=>{!s&&!n&&o&&(l&&!b.current&&(console.warn("üîß PERIODIC RECOVERY: Detected stuck expanded state, resetting",{isExpanded:l,isHoveringRefCurrent:b.current,triggerConnected:j.current?.isConnected,timestamp:Date.now()}),c(!1),m(!1),b.current=!1,p.current&&(window.clearTimeout(p.current),p.current=null)),j.current&&!j.current.isConnected&&(console.warn("üîß PERIODIC RECOVERY: Detected stale triggerRef, resetting state",{triggerConnected:!1,timestamp:Date.now()}),c(!1),m(!1),b.current=!1,p.current&&(window.clearTimeout(p.current),p.current=null)))},2e3);return()=>{window.clearInterval(k)}},[s,n,o,l]);const w=()=>{const k="relative flex items-center justify-center transition-all duration-300 cursor-pointer w-11 h-11 rounded-full border-2";return n?`${k} bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed`:s?`${k} bg-red-500 border-red-600 record-button-recording text-white shadow-lg`:`${k} bg-emerald-100 border-emerald-300 record-button-idle text-emerald-600 hover:bg-emerald-200 hover:border-emerald-400`},T=(k,P)=>{const M="relative w-full aspect-square min-h-[96px] min-w-[96px] flex flex-col items-center justify-center p-3 rounded-lg border-2 transition-all duration-200 hover:shadow-md";return n||!o?`${M} bg-gray-50 border-gray-200 opacity-50 cursor-not-allowed`:P&&s?`${M} bg-red-50 border-red-300 shadow-lg ring-2 ring-red-200`:`${M} bg-white ${{procedure:"border-red-200 hover:border-red-300 hover:bg-red-50",documentation:"border-blue-200 hover:border-blue-300 hover:bg-blue-50",investigation:"border-purple-200 hover:border-purple-300 hover:bg-purple-50",batch:"border-green-200 hover:border-green-300 hover:bg-green-50",advanced:"border-orange-200 hover:border-orange-300 hover:bg-orange-50"}[k.category]}`},C=k=>{const P=fb[k.icon]||Et,M=e===k.id,$=g===k.id,W=k.isExpandable&&!s&&!n&&o&&A,V=()=>o?`${k.description} ‚Ä¢ ${k.estimatedTime} ‚Ä¢ ${k.complexity} complexity`:"Whisper server not running. Please start server: ./start-whisper-server.sh",L=()=>{W&&h(k.id)},O=()=>{W&&h(null)},z=H=>{H.stopPropagation(),A&&(A(k.id),c(!1),h(null))};return t.jsxs("div",{className:"relative w-full h-full",onMouseEnter:L,onMouseLeave:O,children:[(!W||!$)&&t.jsxs("button",{onClick:()=>r(k.id),disabled:n||s&&!M||!o,className:T(k,M),title:V(),tabIndex:0,children:[t.jsx("div",{className:"relative mb-2.5",children:M&&s?t.jsxs(t.Fragment,{children:[t.jsx(Ks,{className:"w-7 h-7 text-red-600"}),t.jsx("div",{className:"absolute inset-0 rounded-full bg-red-500/20 motion-safe:animate-ping"})]}):t.jsx(P,{className:`w-7 h-7 ${k.category==="procedure"?"text-red-500":k.category==="documentation"?"text-blue-500":k.category==="investigation"?"text-purple-500":k.category==="batch"?"text-green-500":"text-orange-500"}`})}),t.jsx("div",{className:`text-[10px] font-semibold text-center leading-snug min-h-[2.5rem] flex items-center justify-center w-full px-1 ${M&&s?"text-red-700":"text-gray-700"}`,children:M&&s?"Stop":k.label}),M&&s&&t.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:v(i)})]}),W&&$&&t.jsxs("div",{className:"absolute inset-0 grid grid-cols-2 gap-0.5 overflow-hidden rounded-lg",children:[t.jsxs("button",{onClick:()=>r(k.id),className:"relative bg-white border-2 border-blue-200 rounded-l-lg flex flex-col items-center justify-center p-2 hover:bg-blue-50 hover:border-blue-300 transition-all",children:[t.jsx(Rt,{className:"w-5 h-5 text-blue-600 mb-1",strokeWidth:2}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-700",children:"Dictate"})]}),t.jsxs("button",{onClick:z,className:"relative bg-white border-2 border-purple-200 rounded-r-lg flex flex-col items-center justify-center p-2 hover:bg-purple-50 hover:border-purple-300 transition-all",children:[t.jsx(Yo,{className:"w-5 h-5 text-purple-600 mb-1",strokeWidth:2}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-700",children:"Type"})]})]})]},k.id)},E=k=>{n||(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),c(P=>!P))};u.useEffect(()=>{if(l){const k=N.current;k&&setTimeout(()=>{const P=k.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');P.length>0&&P[0].focus()},0)}},[l]);const U=k=>{if(l){if(k.key==="Escape"){k.stopPropagation(),c(!1),m(!1),j.current?.focus?.();return}if(k.key==="Tab"){const P=N.current;if(!P)return;const M=Array.from(P.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(V=>!V.hasAttribute("disabled"));if(M.length===0)return;const $=M[0],W=M[M.length-1];k.shiftKey?document.activeElement===$&&(k.preventDefault(),W.focus()):document.activeElement===W&&(k.preventDefault(),$.focus())}}};return t.jsxs("div",{className:"relative",children:[t.jsxs("button",{ref:j,type:"button","data-dropdown-trigger":!0,onMouseEnter:x,onMouseLeave:f,onClick:k=>{console.log("üñ±Ô∏è Record button clicked",{disabled:n,isExpanded:l,whisperServerRunning:o,currentTarget:k.currentTarget,timestamp:Date.now()}),console.log("‚ÑπÔ∏è Click on record button - menu is hover-controlled, no action taken")},onKeyDown:E,"aria-haspopup":"dialog","aria-expanded":l,"aria-controls":y.current,"aria-label":s?"Recording menu, recording in progress":"Open recording menu",className:w(),disabled:n,children:[t.jsx(am,{className:`w-5 h-5 ${s?"fill-current":""}`}),s&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-red-300 motion-safe:animate-ping opacity-40"}),t.jsx("div",{className:"absolute inset-0 rounded-full border-1 border-white opacity-60"})]})]}),t.jsx(lA,{isOpen:l,onClickOutside:()=>{console.log("üñ±Ô∏è Click outside detected - closing card"),c(!1),m(!1),b.current=!1},children:t.jsxs("div",{"data-dropdown-menu":!0,id:y.current,role:"dialog","aria-labelledby":`${y.current}-label`,ref:N,onKeyDown:U,onMouseEnter:S,onMouseLeave:F,className:"record-card glass rounded-xl p-3 w-[340px] bg-white border border-gray-200 shadow-xl pointer-events-auto",style:{position:"fixed",top:Q.top,left:Q.left,zIndex:9990},children:[t.jsx("div",{className:"mb-3 text-center",children:t.jsx("h2",{id:`${y.current}-label`,className:"text-gray-900 text-sm font-semibold",children:s?`Recording ${Ji.find(k=>k.id===e)?.label}...`:"Choose Workflow"})}),t.jsx("div",{className:"grid grid-cols-3 auto-rows-fr gap-3 mb-3",children:Ji.map(C)}),!s&&!o&&t.jsxs("div",{className:"text-center text-red-600 text-xs font-medium flex items-center justify-center gap-2",children:[t.jsx("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-red-500"}),"Whisper server not running"]}),s&&e&&t.jsxs("div",{className:"glass rounded-lg p-2 text-center bg-red-50 border border-red-200",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full motion-safe:animate-pulse"}),t.jsxs("span",{className:"text-red-800 text-xs font-bold",children:["Recording ",Ji.find(k=>k.id===e)?.label]})]}),t.jsxs("p",{className:"text-red-700 text-sm font-medium flex items-center justify-center gap-2",children:[a>.1?t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx(Rt,{className:"w-3.5 h-3.5"})," Listening..."]}):t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx(Ks,{className:"w-3.5 h-3.5"})," Speak now"]})," ‚Ä¢ Tap ",t.jsx("strong",{children:"Complete"})," when done"]})]})]})})]})});Lo.displayName="RecordPanel";const cu=r=>{const{complexity:e,modality:s,type:n}=r;return s==="f2f"?e==="simple"?n==="new"?"110":"116":n==="new"?"132":"133":s==="telehealth"?e==="simple"?n==="new"?"91824":"91825":n==="new"?"92422":"92423":s==="phone"?e==="simple"?"92440":"92443":"116"},du=r=>{const{modality:e,followUp:s}=r;return s==="none"?"no follow up required":`${e==="f2f"?"F2F":e==="telehealth"?"TH":"Phone"} follow up in ${s==="6wk"?"6 weeks":s==="3mth"?"3 months":"12 months"} please`},xb=r=>{const e=cu(r),s=du(r),n=r.complexity==="complex"?"complex ":"",a=r.type,i=r.modality==="f2f"?"F2F":r.modality==="telehealth"?"TH":"Phone",o=r.followUp==="none"?"no FUP":r.followUp==="6wk"?"FUP 6wk":r.followUp==="3mth"?"FUP 3mth":"FUP 12mth",A=`${n}${a} ${i} + ${o}`;return{id:`matrix-${e}-${o.replace(/\s+/g,"-")}`,displayName:A,itemCode:e,notes:s}},bb=[{value:"simple",label:"Simple",sublabel:"Standard consult",icon:Kt},{value:"complex",label:"Complex",sublabel:"Extended time",icon:Gr}],yb=[{value:"f2f",label:"Face to Face",sublabel:"In-person",icon:Ai},{value:"telehealth",label:"Telehealth",sublabel:"Video call",icon:Am},{value:"phone",label:"Phone Call",sublabel:"Voice only",icon:lm}],vb=[{value:"new",label:"New",sublabel:"First visit",icon:cm},{value:"review",label:"Review",sublabel:"Follow-up visit",icon:Qc}],wb=[{value:"6wk",label:"6 Weeks",sublabel:"Early review",icon:_s},{value:"3mth",label:"3 Months",sublabel:"Standard",icon:_s},{value:"12mth",label:"12 Months",sublabel:"Extended",icon:_s},{value:"none",label:"No Follow-up",sublabel:"Discharged",icon:dm}],Bb=({onGenerate:r})=>{const[e,s]=u.useState({complexity:"simple",modality:"f2f",type:"review",followUp:"3mth"}),n=(A,l)=>{s(c=>({...c,[A]:l}))};u.useEffect(()=>{const A=l=>{if(["1","2","3","4"].includes(l.key))switch(l.preventDefault(),l.key){case"1":{const c=e.complexity==="simple"?"complex":"simple";n("complexity",c);break}case"2":{const c=["f2f","telehealth","phone"],m=(c.indexOf(e.modality)+1)%c.length;n("modality",c[m]);break}case"3":{const c=e.type==="new"?"review":"new";n("type",c);break}case"4":{const c=["6wk","3mth","12mth","none"],m=(c.indexOf(e.followUp)+1)%c.length;n("followUp",c[m]);break}}};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[e]);const a=()=>{const A=xb(e);r({itemCode:A.itemCode,notes:A.notes,displayName:A.displayName})},i=cu(e),o=du(e);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["1. Complexity ",t.jsx("span",{className:"text-gray-500 font-normal",children:"(Press 1)"})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:bb.map(A=>t.jsxs("button",{onClick:()=>n("complexity",A.value),className:`
                relative p-3 rounded-lg border-2 text-center transition-all
                ${e.complexity===A.value?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}
              `,children:[t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx(A.icon,{className:`w-5 h-5 flex-shrink-0 ${e.complexity===A.value?"text-blue-600":"text-gray-400"}`}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.label}),t.jsx("div",{className:"text-xs text-gray-500",children:A.sublabel})]}),e.complexity===A.value&&t.jsx(gr,{className:"w-4 h-4 text-blue-600 absolute top-2 right-2"})]},A.value))})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["2. Modality ",t.jsx("span",{className:"text-gray-500 font-normal",children:"(Press 2)"})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:yb.map(A=>t.jsxs("button",{onClick:()=>n("modality",A.value),className:`
                relative p-3 rounded-lg border-2 text-center transition-all
                ${e.modality===A.value?"border-emerald-500 bg-emerald-50":"border-gray-200 bg-white hover:border-gray-300"}
              `,children:[t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx(A.icon,{className:`w-5 h-5 flex-shrink-0 ${e.modality===A.value?"text-emerald-600":"text-gray-400"}`}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.label}),t.jsx("div",{className:"text-xs text-gray-500",children:A.sublabel})]}),e.modality===A.value&&t.jsx(gr,{className:"w-4 h-4 text-emerald-600 absolute top-2 right-2"})]},A.value))})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["3. Appointment Type ",t.jsx("span",{className:"text-gray-500 font-normal",children:"(Press 3)"})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:vb.map(A=>t.jsxs("button",{onClick:()=>n("type",A.value),className:`
                relative p-3 rounded-lg border-2 text-center transition-all
                ${e.type===A.value?"border-purple-500 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"}
              `,children:[t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx(A.icon,{className:`w-5 h-5 flex-shrink-0 ${e.type===A.value?"text-purple-600":"text-gray-400"}`}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.label}),t.jsx("div",{className:"text-xs text-gray-500",children:A.sublabel})]}),e.type===A.value&&t.jsx(gr,{className:"w-4 h-4 text-purple-600 absolute top-2 right-2"})]},A.value))})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:["4. Follow-up Period ",t.jsx("span",{className:"text-gray-500 font-normal",children:"(Press 4)"})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:wb.map(A=>t.jsxs("button",{onClick:()=>n("followUp",A.value),className:`
                relative p-3 rounded-lg border-2 text-center transition-all
                ${e.followUp===A.value?"border-orange-500 bg-orange-50":"border-gray-200 bg-white hover:border-gray-300"}
              `,children:[t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx(A.icon,{className:`w-5 h-5 flex-shrink-0 ${e.followUp===A.value?"text-orange-600":"text-gray-400"}`}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.label}),t.jsx("div",{className:"text-xs text-gray-500",children:A.sublabel})]}),e.followUp===A.value&&t.jsx(gr,{className:"w-4 h-4 text-orange-600 absolute top-2 right-2"})]},A.value))})]}),t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-200",children:[t.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[t.jsx(Ka,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Preview"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["Item Code: ",t.jsx("span",{className:"text-blue-600",children:i})]}),t.jsxs("div",{className:"text-xs text-gray-700",children:["Notes: ",t.jsxs("span",{className:"italic",children:['"',o,'"']})]})]})]})]}),t.jsx(se.button,{onClick:a,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2.5 px-4 rounded-lg font-medium text-sm shadow-md",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Apply This Appointment"})]})]})},El=[{id:"background",label:"Background",icon:Ai,description:"Access patient background notes",group:"core",category:"emr",isExpandable:!0,workflowId:"background"},{id:"investigation-summary",label:"Investigations",alias:"Invests",icon:Dc,description:"Open investigation summary field",group:"core",category:"emr",isExpandable:!0,workflowId:"investigation-summary"},{id:"medications",label:"Medications",alias:"Meds",icon:pm,description:"View/edit medication list",group:"core",category:"emr",isExpandable:!0,workflowId:"medication"},{id:"social-history",label:"Social History",alias:"Social",icon:gm,description:"Access social & family history section",group:"core",category:"emr",isExpandable:!0,workflowId:"background"},{id:"bloods",label:"Bloods",icon:hm,description:"Blood test results and analysis",group:"core",category:"emr",isExpandable:!0,workflowId:"bloods"},{id:"imaging",label:"Imaging",icon:kc,description:"Medical imaging reports and analysis",group:"core",category:"emr",isExpandable:!0,workflowId:"imaging"},{id:"quick-letter",label:"Quick Letter",alias:"Letter",icon:Et,description:"Generate quick medical letter (dictation)",group:"core",category:"documentation"},{id:"paste-letter",label:"Paste Letter",alias:"Paste",icon:Et,description:"Generate letter from pasted notes",group:"core",category:"documentation"},{id:"appointment-wrap-up",label:"Wrap Up",icon:_s,description:"Complete appointment workflow",group:"core",category:"workflow"}],Na=[{id:"patient-education",label:"Patient Education",alias:"Pt Ed",icon:jn,description:"Generate lifestyle advice and education",group:"secondary",category:"documentation"},{id:"pre-op-plan",label:"Pre-Op Plan",alias:"Pre-Op",icon:qo,description:"Generate A5 pre-procedure summary card for cath lab",group:"secondary",category:"documentation"},{id:"annotate-screenshots",label:"Canvas",icon:Tc,description:"Capture, annotate, and combine multiple screenshots",group:"secondary",category:"emr"},{id:"profile-photo",label:"Photo",icon:um,description:"Capture screenshot for patient profile",group:"secondary",category:"emr"},{id:"bp-diary-importer",label:"BP Diary",icon:qr,description:"Import and analyze blood pressure diary images",group:"secondary",category:"analysis"},{id:"lipid-profile-importer",label:"Lipid Profile",alias:"Lipids",icon:mm,description:"Import lipid profiles from Investigation Summary and generate insights",group:"secondary",category:"analysis"},{id:"tte-trend-importer",label:"Echo (TTE) Trends",alias:"TTE",icon:kc,description:"Import echo reports, trend LVEF/RVSP/LVEDD, and generate clinical insights",group:"secondary",category:"analysis"},{id:"create-task",label:"Create Task",alias:"Task",icon:Va,description:"Add new task to workflow",group:"secondary",category:"workflow"},{id:"ai-medical-review",label:"AI Medical Review",alias:"AI Review",icon:Pc,description:"Australian clinical oversight and guidelines review",group:"secondary",category:"analysis"},{id:"batch-ai-review",label:"Batch AI Review",alias:"Batch AI",icon:As,description:"AI review for multiple patients from appointment book",group:"secondary",category:"analysis"}],uu=u.memo(({onQuickAction:r,onStartWorkflow:e,isFooter:s=!1,isRecording:n=!1,activeWorkflow:a=null,voiceActivityLevel:i=0,recordingTime:o=0,whisperServerRunning:A=!0,onTypeClick:l})=>{const[c,d]=u.useState(null),[m,g]=u.useState(!1),[h,p]=u.useState(!1),[b,N]=u.useState(()=>{const w=localStorage.getItem("quickActionsCollapsed");return w===null?!0:w==="true"});u.useEffect(()=>{localStorage.setItem("quickActionsCollapsed",b.toString())},[b]);const y=Na.find(w=>w.id==="ai-medical-review"),j=Na.find(w=>w.id==="batch-ai-review"),Q=y?.icon,v=j?.icon,x=async(w,T)=>{if(w==="appointment-wrap-up"&&!T){g(!0);return}if(w==="investigation-summary"&&!T){p(!0);return}if(w==="patient-education"){try{d(w),await r(w,{type:"show-config"})}catch(C){console.error("Patient Education failed:",C)}finally{d(null)}return}if(w==="batch-ai-review"){try{d(w),await r(w,{type:"show-modal"})}catch(C){console.error("Batch AI Review failed:",C)}finally{d(null)}return}try{d(w),await r(w,T)}catch(C){console.error(`Action ${w} failed:`,C)}finally{d(null)}},f=(w,T)=>{T==="bloods"&&r(T,{type:"prepare-modal"}),e&&e(w,T)},S=async w=>{await x(w,{type:"manual"})},F=()=>{g(!1),p(!1)};return s?h?t.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden",style:{zIndex:20},children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:F,className:"flex items-center text-blue-600 hover:text-blue-700","aria-label":"Back to actions",children:t.jsx(wA,{className:"w-4 h-4 mr-1"})}),t.jsx(Dc,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Investigation Summary"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Choose how to add your summary"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsx("button",{onClick:()=>{e&&e("investigation-summary","investigation-summary"),p(!1)},disabled:c==="investigation-summary",className:"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition-all rounded-lg p-4 text-left",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Rt,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:"Dictate"}),t.jsx("div",{className:"text-gray-600 text-xs",children:"Voice-to-text with AI formatting"})]}),t.jsx(os,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]})}),t.jsx("button",{onClick:()=>S("investigation-summary"),disabled:c==="investigation-summary",className:"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition-all rounded-lg p-4 text-left",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(Yo,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:"Type"}),t.jsx("div",{className:"text-gray-600 text-xs",children:"Open field for manual entry"})]}),t.jsx(os,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]})})]})}),t.jsx("div",{className:"p-4 bg-gray-50",children:t.jsxs("p",{className:"text-gray-600 text-xs",children:["üí° ",t.jsx("strong",{children:"Tip:"})," Dictate uses AI to format your speech, Type opens the field for manual entry"]})})]}):m?t.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden",style:{zIndex:20},children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:F,className:"flex items-center text-blue-600 hover:text-blue-700","aria-label":"Back to actions",children:t.jsx(wA,{className:"w-4 h-4 mr-1"})}),t.jsx(_s,{className:"w-5 h-5 text-blue-600"}),t.jsxs("div",{className:"text-left flex-1",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Appointment Wrap-up"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Build your appointment"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx(Bb,{onGenerate:async w=>{await x("appointment-wrap-up",{preset:{id:"matrix-generated",displayName:w.displayName,itemCode:w.itemCode,notes:w.notes}})}})}),t.jsx("div",{className:"p-4 bg-gray-50",children:t.jsxs("p",{className:"text-gray-600 text-xs",children:["üí° ",t.jsx("strong",{children:"Tip:"})," Use keyboard shortcuts (1-4) to quickly navigate and cycle through options"]})})]}):t.jsxs(se.div,{className:"bg-white pb-3",variants:Ke(go),initial:"hidden",animate:"visible",style:{position:"relative",zIndex:10},children:[t.jsxs(se.div,{className:"px-2 mb-3",variants:Ke(Ra),children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Va,{className:"w-3.5 h-3.5 text-blue-600"}),t.jsx("h3",{className:"text-gray-900 font-semibold text-[13px]",children:"Quick Actions"})]}),t.jsx("button",{onClick:()=>N(!b),className:"text-gray-600 hover:text-gray-900 transition-colors p-1","aria-label":b?"Expand quick actions":"Collapse quick actions",children:b?t.jsx(os,{className:"w-3.5 h-3.5"}):t.jsx(Dt,{className:"w-3.5 h-3.5"})})]}),t.jsx("div",{className:"h-px bg-gray-200"})]}),b&&t.jsx(se.div,{className:"px-2",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:t.jsxs("div",{className:"grid grid-cols-5 gap-x-1.5",children:[e&&t.jsx("div",{className:"flex items-center justify-center scale-90",style:{position:"relative",zIndex:100},children:t.jsx(Lo,{onWorkflowSelect:e,activeWorkflow:a,isRecording:n,disabled:!1,voiceActivityLevel:i,recordingTime:o,whisperServerRunning:A,onTypeClick:l})}),El.filter(w=>["background","investigation-summary","medications","appointment-wrap-up"].includes(w.id)).map(w=>t.jsx("div",{className:"scale-90",children:t.jsx(Yi,{id:w.id,label:w.label,alias:w.alias,icon:w.icon,category:"core",onClick:()=>x(w.id),isProcessing:c===w.id,isExpandable:w.isExpandable,workflowId:w.workflowId,onDictate:f,onType:S})},w.id))]})}),!b&&t.jsxs(t.Fragment,{children:[t.jsx(se.div,{className:"px-2 mb-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:t.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-2.5",children:[e&&t.jsx("div",{className:"flex items-center justify-center",style:{position:"relative",zIndex:100},children:t.jsx(Lo,{onWorkflowSelect:e,activeWorkflow:a,isRecording:n,disabled:!1,voiceActivityLevel:i,recordingTime:o,whisperServerRunning:A,onTypeClick:l})}),El.map(w=>t.jsx(Yi,{id:w.id,label:w.label,alias:w.alias,icon:w.icon,category:"core",onClick:()=>x(w.id),isProcessing:c===w.id,isExpandable:w.isExpandable,workflowId:w.workflowId,onDictate:f,onType:S},w.id))]})}),t.jsx("div",{className:"px-2 mb-4",children:t.jsx("div",{className:"h-px bg-gray-100"})}),t.jsx(se.div,{className:"px-2",variants:Ke(go),transition:{staggerChildren:Ga.tight,delayChildren:.1},children:t.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-2.5",children:[Na.filter(w=>!["ai-medical-review","batch-ai-review"].includes(w.id)).map((w,T)=>t.jsx(se.div,{variants:Ke(Ra),custom:T,children:t.jsx(Yi,{id:w.id,label:w.label,alias:w.alias,icon:w.icon,category:"secondary",onClick:()=>x(w.id),isProcessing:c===w.id})},w.id)),t.jsxs(se.div,{variants:Ke(Ra),custom:Na.filter(w=>!["ai-medical-review","batch-ai-review"].includes(w.id)).length,className:"relative overflow-hidden rounded-lg transition-all",style:{minHeight:"64px"},children:[t.jsxs("div",{className:"grid grid-cols-2 gap-0 h-full",children:[t.jsx("button",{onClick:()=>x("ai-medical-review"),disabled:c==="ai-medical-review",className:"flex flex-col items-center justify-center p-1 border-r border-gray-200 hover:bg-purple-50 transition-all",title:"AI Medical Review",children:Q&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{className:"w-4 h-4 text-purple-600 mb-1",strokeWidth:2}),t.jsx("div",{className:"text-[9px] font-medium text-gray-700 text-center leading-tight",children:"AI Review"})]})}),t.jsx("button",{onClick:()=>x("batch-ai-review"),disabled:c==="batch-ai-review",className:"flex flex-col items-center justify-center p-1 hover:bg-purple-50 transition-all",title:"Batch AI Review",children:v&&t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"w-4 h-4 text-purple-600 mb-1",strokeWidth:2}),t.jsx("div",{className:"text-[9px] font-medium text-gray-700 text-center leading-tight",children:"Batch AI"})]})})]}),(c==="ai-medical-review"||c==="batch-ai-review")&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80",children:t.jsx("div",{className:"w-4 h-4 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"})})]})]})})]})]}):null});uu.displayName="QuickActionsGrouped";function at(r,e){e===void 0&&(e={});var s=e.insertAt;if(r&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",s==="top"&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=r:a.appendChild(document.createTextNode(r))}}at(`.react-loading-indicator-normalize,
[class$=rli-bounding-box] {
  font-size: 1rem;
  display: inline-block;
  box-sizing: border-box;
  text-align: unset;
  isolation: isolate;
}

.rli-d-i-b {
  display: inline-block;
}

.rli-text-format {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 600;
  width: 90%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.7em;
  letter-spacing: 0.5px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Avenir Next", "Avenir", "Segoe UI", "Lucida Grande", "Helvetica Neue", "Helvetica", "Fira Sans", "Roboto", "Noto", "Droid Sans", "Cantarell", "Oxygen", "Ubuntu", "Franklin Gothic Medium", "Century Gothic", "Liberation Sans", sans-serif;
}`);var pr=function(){return pr=Object.assign||function(r){for(var e,s=1,n=arguments.length;s<n;s++)for(var a in e=arguments[s])Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r},pr.apply(this,arguments)};function ni(r){return ni=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ni(r)}var Cb=/^\s+/,Nb=/\s+$/;function ue(r,e){if(e=e||{},(r=r||"")instanceof ue)return r;if(!(this instanceof ue))return new ue(r,e);var s=function(n){var a={r:0,g:0,b:0},i=1,o=null,A=null,l=null,c=!1,d=!1;typeof n=="string"&&(n=function(p){p=p.replace(Cb,"").replace(Nb,"").toLowerCase();var b,N=!1;if(Oo[p])p=Oo[p],N=!0;else if(p=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(b=zt.rgb.exec(p))?{r:b[1],g:b[2],b:b[3]}:(b=zt.rgba.exec(p))?{r:b[1],g:b[2],b:b[3],a:b[4]}:(b=zt.hsl.exec(p))?{h:b[1],s:b[2],l:b[3]}:(b=zt.hsla.exec(p))?{h:b[1],s:b[2],l:b[3],a:b[4]}:(b=zt.hsv.exec(p))?{h:b[1],s:b[2],v:b[3]}:(b=zt.hsva.exec(p))?{h:b[1],s:b[2],v:b[3],a:b[4]}:(b=zt.hex8.exec(p))?{r:kt(b[1]),g:kt(b[2]),b:kt(b[3]),a:kl(b[4]),format:N?"name":"hex8"}:(b=zt.hex6.exec(p))?{r:kt(b[1]),g:kt(b[2]),b:kt(b[3]),format:N?"name":"hex"}:(b=zt.hex4.exec(p))?{r:kt(b[1]+""+b[1]),g:kt(b[2]+""+b[2]),b:kt(b[3]+""+b[3]),a:kl(b[4]+""+b[4]),format:N?"name":"hex8"}:(b=zt.hex3.exec(p))?{r:kt(b[1]+""+b[1]),g:kt(b[2]+""+b[2]),b:kt(b[3]+""+b[3]),format:N?"name":"hex"}:!1}(n)),ni(n)=="object"&&(Br(n.r)&&Br(n.g)&&Br(n.b)?(m=n.r,g=n.g,h=n.b,a={r:255*Ve(m,255),g:255*Ve(g,255),b:255*Ve(h,255)},c=!0,d=String(n.r).substr(-1)==="%"?"prgb":"rgb"):Br(n.h)&&Br(n.s)&&Br(n.v)?(o=Bn(n.s),A=Bn(n.v),a=function(p,b,N){p=6*Ve(p,360),b=Ve(b,100),N=Ve(N,100);var y=Math.floor(p),j=p-y,Q=N*(1-b),v=N*(1-j*b),x=N*(1-(1-j)*b),f=y%6,S=[N,v,Q,Q,x,N][f],F=[x,N,N,v,Q,Q][f],w=[Q,Q,x,N,N,v][f];return{r:255*S,g:255*F,b:255*w}}(n.h,o,A),c=!0,d="hsv"):Br(n.h)&&Br(n.s)&&Br(n.l)&&(o=Bn(n.s),l=Bn(n.l),a=function(p,b,N){var y,j,Q;function v(S,F,w){return w<0&&(w+=1),w>1&&(w-=1),w<1/6?S+6*(F-S)*w:w<.5?F:w<2/3?S+(F-S)*(2/3-w)*6:S}if(p=Ve(p,360),b=Ve(b,100),N=Ve(N,100),b===0)y=j=Q=N;else{var x=N<.5?N*(1+b):N+b-N*b,f=2*N-x;y=v(f,x,p+1/3),j=v(f,x,p),Q=v(f,x,p-1/3)}return{r:255*y,g:255*j,b:255*Q}}(n.h,o,l),c=!0,d="hsl"),n.hasOwnProperty("a")&&(i=n.a));var m,g,h;return i=mu(i),{ok:c,format:n.format||d,r:Math.min(255,Math.max(a.r,0)),g:Math.min(255,Math.max(a.g,0)),b:Math.min(255,Math.max(a.b,0)),a:i}}(r);this._originalInput=r,this._r=s.r,this._g=s.g,this._b=s.b,this._a=s.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||s.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=s.ok}function Fl(r,e,s){r=Ve(r,255),e=Ve(e,255),s=Ve(s,255);var n,a,i=Math.max(r,e,s),o=Math.min(r,e,s),A=(i+o)/2;if(i==o)n=a=0;else{var l=i-o;switch(a=A>.5?l/(2-i-o):l/(i+o),i){case r:n=(e-s)/l+(e<s?6:0);break;case e:n=(s-r)/l+2;break;case s:n=(r-e)/l+4}n/=6}return{h:n,s:a,l:A}}function Ql(r,e,s){r=Ve(r,255),e=Ve(e,255),s=Ve(s,255);var n,a,i=Math.max(r,e,s),o=Math.min(r,e,s),A=i,l=i-o;if(a=i===0?0:l/i,i==o)n=0;else{switch(i){case r:n=(e-s)/l+(e<s?6:0);break;case e:n=(s-r)/l+2;break;case s:n=(r-e)/l+4}n/=6}return{h:n,s:a,v:A}}function Il(r,e,s,n){var a=[Yt(Math.round(r).toString(16)),Yt(Math.round(e).toString(16)),Yt(Math.round(s).toString(16))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function Ul(r,e,s,n){return[Yt(pu(n)),Yt(Math.round(r).toString(16)),Yt(Math.round(e).toString(16)),Yt(Math.round(s).toString(16))].join("")}function jb(r,e){e=e===0?0:e||10;var s=ue(r).toHsl();return s.s-=e/100,s.s=wi(s.s),ue(s)}function Sb(r,e){e=e===0?0:e||10;var s=ue(r).toHsl();return s.s+=e/100,s.s=wi(s.s),ue(s)}function Eb(r){return ue(r).desaturate(100)}function Fb(r,e){e=e===0?0:e||10;var s=ue(r).toHsl();return s.l+=e/100,s.l=wi(s.l),ue(s)}function Qb(r,e){e=e===0?0:e||10;var s=ue(r).toRgb();return s.r=Math.max(0,Math.min(255,s.r-Math.round(-e/100*255))),s.g=Math.max(0,Math.min(255,s.g-Math.round(-e/100*255))),s.b=Math.max(0,Math.min(255,s.b-Math.round(-e/100*255))),ue(s)}function Ib(r,e){e=e===0?0:e||10;var s=ue(r).toHsl();return s.l-=e/100,s.l=wi(s.l),ue(s)}function Ub(r,e){var s=ue(r).toHsl(),n=(s.h+e)%360;return s.h=n<0?360+n:n,ue(s)}function Tb(r){var e=ue(r).toHsl();return e.h=(e.h+180)%360,ue(e)}function Tl(r,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var s=ue(r).toHsl(),n=[ue(r)],a=360/e,i=1;i<e;i++)n.push(ue({h:(s.h+i*a)%360,s:s.s,l:s.l}));return n}function kb(r){var e=ue(r).toHsl(),s=e.h;return[ue(r),ue({h:(s+72)%360,s:e.s,l:e.l}),ue({h:(s+216)%360,s:e.s,l:e.l})]}function Pb(r,e,s){e=e||6,s=s||30;var n=ue(r).toHsl(),a=360/s,i=[ue(r)];for(n.h=(n.h-(a*e>>1)+720)%360;--e;)n.h=(n.h+a)%360,i.push(ue(n));return i}function Db(r,e){e=e||6;for(var s=ue(r).toHsv(),n=s.h,a=s.s,i=s.v,o=[],A=1/e;e--;)o.push(ue({h:n,s:a,v:i})),i=(i+A)%1;return o}ue.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var r=this.toRgb();return(299*r.r+587*r.g+114*r.b)/1e3},getLuminance:function(){var r,e,s,n=this.toRgb();return r=n.r/255,e=n.g/255,s=n.b/255,.2126*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))},setAlpha:function(r){return this._a=mu(r),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var r=Ql(this._r,this._g,this._b);return{h:360*r.h,s:r.s,v:r.v,a:this._a}},toHsvString:function(){var r=Ql(this._r,this._g,this._b),e=Math.round(360*r.h),s=Math.round(100*r.s),n=Math.round(100*r.v);return this._a==1?"hsv("+e+", "+s+"%, "+n+"%)":"hsva("+e+", "+s+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var r=Fl(this._r,this._g,this._b);return{h:360*r.h,s:r.s,l:r.l,a:this._a}},toHslString:function(){var r=Fl(this._r,this._g,this._b),e=Math.round(360*r.h),s=Math.round(100*r.s),n=Math.round(100*r.l);return this._a==1?"hsl("+e+", "+s+"%, "+n+"%)":"hsla("+e+", "+s+"%, "+n+"%, "+this._roundA+")"},toHex:function(r){return Il(this._r,this._g,this._b,r)},toHexString:function(r){return"#"+this.toHex(r)},toHex8:function(r){return function(e,s,n,a,i){var o=[Yt(Math.round(e).toString(16)),Yt(Math.round(s).toString(16)),Yt(Math.round(n).toString(16)),Yt(pu(a))];return i&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this._r,this._g,this._b,this._a,r)},toHex8String:function(r){return"#"+this.toHex8(r)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*Ve(this._r,255))+"%",g:Math.round(100*Ve(this._g,255))+"%",b:Math.round(100*Ve(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*Ve(this._r,255))+"%, "+Math.round(100*Ve(this._g,255))+"%, "+Math.round(100*Ve(this._b,255))+"%)":"rgba("+Math.round(100*Ve(this._r,255))+"%, "+Math.round(100*Ve(this._g,255))+"%, "+Math.round(100*Ve(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(Rb[Il(this._r,this._g,this._b,!0)]||!1)},toFilter:function(r){var e="#"+Ul(this._r,this._g,this._b,this._a),s=e,n=this._gradientType?"GradientType = 1, ":"";if(r){var a=ue(r);s="#"+Ul(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+s+")"},toString:function(r){var e=!!r;r=r||this._format;var s=!1,n=this._a<1&&this._a>=0;return e||!n||r!=="hex"&&r!=="hex6"&&r!=="hex3"&&r!=="hex4"&&r!=="hex8"&&r!=="name"?(r==="rgb"&&(s=this.toRgbString()),r==="prgb"&&(s=this.toPercentageRgbString()),r!=="hex"&&r!=="hex6"||(s=this.toHexString()),r==="hex3"&&(s=this.toHexString(!0)),r==="hex4"&&(s=this.toHex8String(!0)),r==="hex8"&&(s=this.toHex8String()),r==="name"&&(s=this.toName()),r==="hsl"&&(s=this.toHslString()),r==="hsv"&&(s=this.toHsvString()),s||this.toHexString()):r==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return ue(this.toString())},_applyModification:function(r,e){var s=r.apply(null,[this].concat([].slice.call(e)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function(){return this._applyModification(Fb,arguments)},brighten:function(){return this._applyModification(Qb,arguments)},darken:function(){return this._applyModification(Ib,arguments)},desaturate:function(){return this._applyModification(jb,arguments)},saturate:function(){return this._applyModification(Sb,arguments)},greyscale:function(){return this._applyModification(Eb,arguments)},spin:function(){return this._applyModification(Ub,arguments)},_applyCombination:function(r,e){return r.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(Pb,arguments)},complement:function(){return this._applyCombination(Tb,arguments)},monochromatic:function(){return this._applyCombination(Db,arguments)},splitcomplement:function(){return this._applyCombination(kb,arguments)},triad:function(){return this._applyCombination(Tl,[3])},tetrad:function(){return this._applyCombination(Tl,[4])}},ue.fromRatio=function(r,e){if(ni(r)=="object"){var s={};for(var n in r)r.hasOwnProperty(n)&&(s[n]=n==="a"?r[n]:Bn(r[n]));r=s}return ue(r,e)},ue.equals=function(r,e){return!(!r||!e)&&ue(r).toRgbString()==ue(e).toRgbString()},ue.random=function(){return ue.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},ue.mix=function(r,e,s){s=s===0?0:s||50;var n=ue(r).toRgb(),a=ue(e).toRgb(),i=s/100;return ue({r:(a.r-n.r)*i+n.r,g:(a.g-n.g)*i+n.g,b:(a.b-n.b)*i+n.b,a:(a.a-n.a)*i+n.a})},ue.readability=function(r,e){var s=ue(r),n=ue(e);return(Math.max(s.getLuminance(),n.getLuminance())+.05)/(Math.min(s.getLuminance(),n.getLuminance())+.05)},ue.isReadable=function(r,e,s){var n,a,i=ue.readability(r,e);switch(a=!1,(n=function(o){var A,l;return A=((o=o||{level:"AA",size:"small"}).level||"AA").toUpperCase(),l=(o.size||"small").toLowerCase(),A!=="AA"&&A!=="AAA"&&(A="AA"),l!=="small"&&l!=="large"&&(l="small"),{level:A,size:l}}(s)).level+n.size){case"AAsmall":case"AAAlarge":a=i>=4.5;break;case"AAlarge":a=i>=3;break;case"AAAsmall":a=i>=7}return a},ue.mostReadable=function(r,e,s){var n,a,i,o,A=null,l=0;a=(s=s||{}).includeFallbackColors,i=s.level,o=s.size;for(var c=0;c<e.length;c++)(n=ue.readability(r,e[c]))>l&&(l=n,A=ue(e[c]));return ue.isReadable(r,A,{level:i,size:o})||!a?A:(s.includeFallbackColors=!1,ue.mostReadable(r,["#fff","#000"],s))};var Oo=ue.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Rb=ue.hexNames=function(r){var e={};for(var s in r)r.hasOwnProperty(s)&&(e[r[s]]=s);return e}(Oo);function mu(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function Ve(r,e){(function(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1})(r)&&(r="100%");var s=function(n){return typeof n=="string"&&n.indexOf("%")!=-1}(r);return r=Math.min(e,Math.max(0,parseFloat(r))),s&&(r=parseInt(r*e,10)/100),Math.abs(r-e)<1e-6?1:r%e/parseFloat(e)}function wi(r){return Math.min(1,Math.max(0,r))}function kt(r){return parseInt(r,16)}function Yt(r){return r.length==1?"0"+r:""+r}function Bn(r){return r<=1&&(r=100*r+"%"),r}function pu(r){return Math.round(255*parseFloat(r)).toString(16)}function kl(r){return kt(r)/255}var Tr,ja,Sa,zt=(ja="[\\s|\\(]+("+(Tr="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Tr+")[,|\\s]+("+Tr+")\\s*\\)?",Sa="[\\s|\\(]+("+Tr+")[,|\\s]+("+Tr+")[,|\\s]+("+Tr+")[,|\\s]+("+Tr+")\\s*\\)?",{CSS_UNIT:new RegExp(Tr),rgb:new RegExp("rgb"+ja),rgba:new RegExp("rgba"+Sa),hsl:new RegExp("hsl"+ja),hsla:new RegExp("hsla"+Sa),hsv:new RegExp("hsv"+ja),hsva:new RegExp("hsva"+Sa),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function Br(r){return!!zt.CSS_UNIT.exec(r)}var Mb=function(r,e){var s=(typeof r=="string"?parseInt(r):r)||0;if(s>=-5&&s<=5){var n=s,a=parseFloat(e),i=a+n*(a/5)*-1;return(i==0||i<=Number.EPSILON)&&(i=.1),{animationPeriod:i+"s"}}return{animationPeriod:e}},Hb=function(r,e){var s=r||{},n="";switch(e){case"small":n="12px";break;case"medium":n="16px";break;case"large":n="20px";break;default:n=void 0}var a={};if(s.fontSize){var i=s.fontSize;a=function(o,A){var l={};for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&A.indexOf(c)<0&&(l[c]=o[c]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var d=0;for(c=Object.getOwnPropertySymbols(o);d<c.length;d++)A.indexOf(c[d])<0&&Object.prototype.propertyIsEnumerable.call(o,c[d])&&(l[c[d]]=o[c[d]])}return l}(s,["fontSize"]),n=i}return{fontSize:n,styles:a}},Lb={color:"currentColor",mixBlendMode:"difference",width:"unset",display:"block",paddingTop:"2px"},Ob=function(r){var e=r.className,s=r.text,n=r.textColor,a=r.staticText,i=r.style;return s?Fe.createElement("span",{className:"rli-d-i-b rli-text-format ".concat(e||"").trim(),style:pr(pr(pr({},a&&Lb),n&&{color:n,mixBlendMode:"unset"}),i&&i)},typeof s=="string"&&s.length?s:"loading"):null},gu="rgb(50, 205, 50)";function _b(r,e){if(e===void 0&&(e=0),r.length===0)throw new Error("Input array cannot be empty!");var s=[];return function n(a,i){return i===void 0&&(i=0),s.push.apply(s,a),s.length<i&&n(s,i),s.slice(0,i)}(r,e)}at(`.atom-rli-bounding-box {
  --atom-phase1-rgb: 50, 205, 50;
  color: rgba(var(--atom-phase1-rgb), 1);
  font-size: 16px;
  position: relative;
  text-align: unset;
  isolation: isolate;
}
.atom-rli-bounding-box .atom-indicator {
  width: 6em;
  height: 6em;
  position: relative;
  perspective: 6em;
  overflow: hidden;
  color: rgba(var(--atom-phase1-rgb), 1);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator::after, .atom-rli-bounding-box .atom-indicator::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 0.48em;
  height: 0.48em;
  margin: auto;
  border-radius: 50%;
  background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7eg;
}
.atom-rli-bounding-box .atom-indicator::before {
  filter: drop-shadow(0px 0px 0.0625em currentColor);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit {
  color: rgba(var(--atom-phase1-rgb), 0.85);
  border: 0;
  border-left: 0.4em solid currentColor;
  box-sizing: border-box;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  width: 4.8em;
  height: 4.8em;
  background-color: transparent;
  border-radius: 50%;
  transform-style: preserve-3d;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7fj, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gy;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  color: rgba(var(--atom-phase1-rgb), 0.18);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7hv;
  border: 0.125em solid currentColor;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::before {
  content: "";
  width: 0.192em;
  height: 0.192em;
  position: absolute;
  border-radius: 50%;
  top: -0.096em;
  right: 0;
  bottom: 0;
  left: 0;
  margin: 0 auto;
  color: rgba(var(--atom-phase1-rgb), 1);
  box-shadow: 0px 0px 0.0625em 0.0625em currentColor, 0px 0px 0.0625em 0.125em currentColor;
  background-color: currentColor;
  transform: rotateY(-70deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7ew, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(1) {
  --orbit-vector-factor: -1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(2) {
  --orbit-vector-factor: 1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3) {
  --orbit-vector-factor: 0;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3)::before {
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --atom-phase1-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase2-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase3-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase4-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7fj {
  from {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(0deg);
  }
  to {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(360deg);
  }
}
@keyframes uxlv7ew {
  from {
    transform: rotateY(-70deg) rotateX(0deg);
  }
  to {
    transform: rotateY(-70deg) rotateX(-360deg);
  }
}
@keyframes uxlv7eg {
  100%, 0% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  20% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  25% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  45% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  50% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  70% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  75% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  95% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
}
@keyframes uxlv7gg {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
}
@keyframes uxlv7gy {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
}
@keyframes uxlv7hv {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
}`);ue(gu).toRgb();Array.from({length:4},function(r,e){return"--atom-phase".concat(e+1,"-rgb")});at(`.commet-rli-bounding-box {
  --commet-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  width: 6.85em;
  height: 6.85em;
  overflow: hidden;
  display: inline-block;
  box-sizing: border-box;
  position: relative;
  isolation: isolate;
}
.commet-rli-bounding-box .commet-indicator {
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  box-sizing: border-box;
  width: 6em;
  height: 6em;
  color: var(--commet-phase1-color);
  display: inline-block;
  isolation: isolate;
  position: absolute;
  z-index: 0;
  animation: calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite uxlv7cp;
}
.commet-rli-bounding-box .commet-indicator .commet-box {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  animation: uxlv7bx var(--rli-animation-duration, 1.2s) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(1) {
  width: 100%;
  height: 100%;
  animation-direction: normal;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(2) {
  width: 70%;
  height: 70%;
  animation-direction: reverse;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  display: inline-block;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box::before {
  content: "";
  width: 0.5em;
  height: 0.5em;
  border-radius: 50%;
  background-color: currentColor;
  position: absolute;
  top: -0.125em;
  left: 50%;
  transform: translateX(-50%);
  box-shadow: 0 0 0.2em 0em currentColor, 0 0 0.6em 0em currentColor;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  box-sizing: border-box;
  border-style: solid;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail1 {
  border-color: currentColor transparent transparent currentColor;
  border-width: 0.25em 0.25em 0 0;
  transform: rotateZ(-45deg);
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail2 {
  border-color: currentColor currentColor transparent transparent;
  border-width: 0.25em 0 0 0.25em;
  transform: rotateZ(45deg);
}
.commet-rli-bounding-box .commet-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--commet-phase1-color);
}

@property --commet-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7bx {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7cp {
  100%, 0% {
    color: var(--commet-phase1-color);
  }
  20% {
    color: var(--commet-phase1-color);
  }
  25% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  45% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  50% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  70% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  75% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
  95% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--commet-phase".concat(e+1,"-color")});at(`.OP-annulus-rli-bounding-box {
  --OP-annulus-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .whirl {
  animation: uxlv7n7 calc(var(--rli-animation-duration, 1.5s) * 1.33) linear infinite;
  height: 100%;
  transform-origin: center center;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .path {
  stroke-dasharray: 1, 125;
  stroke-dashoffset: 0;
  animation: var(--rli-animation-duration, 1.5s) var(--rli-animation-function, ease-in-out) infinite uxlv7oa, calc(var(--rli-animation-duration, 1.5s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7p5;
  stroke-linecap: round;
}
.OP-annulus-rli-bounding-box .OP-annulus-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7n7 {
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7oa {
  0% {
    stroke-dasharray: 1, 125;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -35px;
  }
  100% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -124px;
  }
}
@keyframes uxlv7p5 {
  100%, 0% {
    stroke: var(--OP-annulus-phase1-color);
  }
  22% {
    stroke: var(--OP-annulus-phase1-color);
  }
  25% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  42% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  50% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  72% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  75% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
  97% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--OP-annulus-phase".concat(e+1,"-color")});function Zi(r){return r&&r.Math===Math&&r}at(`.OP-dotted-rli-bounding-box {
  --OP-dotted-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-dotted-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .OP-dotted-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder .dot {
  display: block;
  margin: 0 auto;
  width: 15%;
  height: 15%;
  background-color: currentColor;
  border-radius: 50%;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) infinite uxlv7nu, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7ol;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) {
  transform: rotate(0deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 12 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) {
  transform: rotate(30deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 11 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) {
  transform: rotate(60deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 10 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) {
  transform: rotate(90deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 9 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) {
  transform: rotate(120deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 8 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) {
  transform: rotate(150deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 7 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) {
  transform: rotate(180deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 6 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) {
  transform: rotate(210deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 5 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) {
  transform: rotate(240deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 4 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) {
  transform: rotate(270deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 3 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) {
  transform: rotate(300deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 2 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) {
  transform: rotate(330deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 1 * -1);
}

@property --OP-dotted-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7nu {
  0%, 39%, 100% {
    opacity: 0;
  }
  40% {
    opacity: 1;
  }
}
@keyframes uxlv7ol {
  100%, 0% {
    background-color: var(--OP-dotted-phase1-color);
  }
  22% {
    background-color: var(--OP-dotted-phase1-color);
  }
  25% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  47% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  50% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  72% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  75% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
  97% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
}`);Zi(typeof window=="object"&&window)||Zi(typeof self=="object"&&self)||Zi(typeof global=="object"&&global)||function(){return this}()||Function("return this")();Array.from({length:4},function(r,e){return"--OP-dotted-phase".concat(e+1,"-color")});at(`.OP-spokes-rli-bounding-box {
  --OP-spokes-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  position: relative;
  color: var(--OP-spokes-phase1-color);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator {
  width: 4.8em;
  height: 4.8em;
  display: block;
  position: relative;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke {
  position: absolute;
  height: 1.2em;
  width: 0.4em;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: auto auto auto 50%;
  background-color: var(--OP-spokes-phase1-color);
  border-radius: 0.24em;
  opacity: 0;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) backwards infinite uxlv7pw, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7qn;
  transform-origin: left center;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(1) {
  transform: rotate(calc(0 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(11 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(2) {
  transform: rotate(calc(1 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(10 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(3) {
  transform: rotate(calc(2 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(9 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(4) {
  transform: rotate(calc(3 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(8 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(5) {
  transform: rotate(calc(4 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(7 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(6) {
  transform: rotate(calc(5 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(6 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(7) {
  transform: rotate(calc(6 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(5 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(8) {
  transform: rotate(calc(7 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(4 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(9) {
  transform: rotate(calc(8 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(3 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(10) {
  transform: rotate(calc(9 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(2 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(11) {
  transform: rotate(calc(10 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(1 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(12) {
  transform: rotate(calc(11 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(0 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--OP-spokes-phase1-color);
  z-index: -2;
}

@property --OP-spokes-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7pw {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@keyframes uxlv7qn {
  100%, 0% {
    background-color: var(--OP-spokes-phase1-color);
  }
  22% {
    background-color: var(--OP-spokes-phase1-color);
  }
  25% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  42% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  50% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  72% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  75% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
  97% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--OP-spokes-phase".concat(e+1,"-color")});at(`.OP-annulus-dual-sectors-rli-bounding-box {
  --OP-annulus-dual-sectors-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator {
  width: 5em;
  height: 5em;
  display: inline-block;
  position: relative;
  z-index: 0;
  color: var(--OP-annulus-dual-sectors-phase1-color);
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .annulus-sectors {
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border-width: 0.34em;
  border-style: solid;
  border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent var(--OP-annulus-dual-sectors-phase1-color) transparent;
  background-color: transparent;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) infinite uxlv7ra, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) infinite uxlv7sv;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .OP-annulus-dual-sectors-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-dual-sectors-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7ra {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7sv {
  100%, 0% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  20% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  25% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  45% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  50% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  70% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  75% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  95% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
}`);Array.from({length:4},function(r,e){return"--OP-annulus-dual-sectors-phase".concat(e+1,"-color")});at(`.OP-annulus-sector-track-rli-bounding-box {
  --OP-annulus-track-phase1-color: rgba(50, 205, 50, 0.22);
  --OP-annulus-sector-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-sector-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .annulus-track-ring {
  width: 100%;
  height: 100%;
  border-width: 0.34em;
  border-style: solid;
  border-radius: 50%;
  box-sizing: border-box;
  border-color: var(--OP-annulus-track-phase1-color);
  border-top-color: var(--OP-annulus-sector-phase1-color);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7rl, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7tf;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .OP-annulus-sector-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-track-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-sector-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7rl {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7tf {
  100%, 0% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  18% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  25% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  43% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  50% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  68% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  75% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
  93% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return["--OP-annulus-track-phase".concat(e+1,"-color"),"--OP-annulus-sector-phase".concat(e+1,"-color")]});at(`.foursquare-rli-bounding-box {
  --four-square-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  color: var(--four-square-phase1-color);
  display: inline-block;
  overflow: hidden;
}
.foursquare-rli-bounding-box .foursquare-indicator {
  height: 5.3033008589em;
  width: 5.3033008589em;
  position: relative;
  display: block;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container {
  position: absolute;
  z-index: 0;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  height: 2.5em;
  width: 2.5em;
  color: inherit;
  will-change: color, width, height;
  transform: rotate(45deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7dk, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7es;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square {
  position: absolute;
  width: 1.25em;
  height: 1.25em;
  border-radius: 0.1875em;
  background-color: currentColor;
  animation: uxlv7dd var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) both infinite;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square1 {
  top: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square2 {
  top: 0;
  right: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square3 {
  bottom: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square4 {
  bottom: 0;
  right: 0;
}

@property --four-square-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7dk {
  0% {
    width: 2.5em;
    height: 2.5em;
  }
  10% {
    width: 2.5em;
    height: 2.5em;
  }
  50% {
    width: 3.75em;
    height: 3.75em;
  }
  90% {
    width: 2.5em;
    height: 2.5em;
  }
  100% {
    width: 2.5em;
    height: 2.5em;
  }
}
@keyframes uxlv7dd {
  0% {
    transform: rotateZ(0deg);
  }
  10% {
    transform: rotateZ(0deg);
  }
  50% {
    transform: rotateZ(90deg);
  }
  90% {
    transform: rotateZ(90deg);
  }
  100% {
    transform: rotateZ(90deg);
  }
}
@keyframes uxlv7es {
  100%, 0% {
    color: var(--four-square-phase1-color);
  }
  20% {
    color: var(--four-square-phase1-color);
  }
  25% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  45% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  50% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  70% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  75% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
  95% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--four-square-phase".concat(e+1,"-color")});at(`.mosaic-rli-bounding-box {
  --mosaic-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  color: var(--mosaic-phase1-color);
}
.mosaic-rli-bounding-box .mosaic-indicator {
  width: 5em;
  height: 5em;
  color: currentColor;
  display: grid;
  gap: 0.125em;
  grid-template-columns: repeat(3, 1fr);
  grid-template-areas: "a b c" "d e f" "g h i";
  position: relative;
  z-index: 0;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  z-index: -2;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube {
  background-color: var(--mosaic-phase1-color);
  animation-name: uxlv7i4, uxlv7is;
  animation-duration: var(--rli-animation-duration, 1.5s), calc(var(--rli-animation-duration, 1.5s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in-out);
  animation-iteration-count: infinite;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube1 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
  grid-area: a;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube2 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
  grid-area: b;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube3 {
  grid-area: c;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 4);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube4 {
  grid-area: d;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube5 {
  grid-area: e;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube6 {
  grid-area: f;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube7 {
  grid-area: g;
  animation-delay: 0s;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube8 {
  grid-area: h;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube9 {
  grid-area: i;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}

@property --mosaic-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7i4 {
  0%, 60%, 100% {
    transform: scale3D(1, 1, 1);
  }
  30% {
    transform: scale3D(0, 0, 1);
  }
}
@keyframes uxlv7is {
  100%, 0% {
    background-color: var(--mosaic-phase1-color);
  }
  25% {
    background-color: var(--mosaic-phase2-color, var(--mosaic-phase1-color));
  }
  50% {
    background-color: var(--mosaic-phase3-color, var(--mosaic-phase1-color));
  }
  75% {
    background-color: var(--mosaic-phase4-color, var(--mosaic-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--mosaic-phase".concat(e+1,"-color")});at(`.riple-rli-bounding-box {
  --riple-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--riple-phase1-color);
}
.riple-rli-bounding-box .riple-indicator {
  display: inline-block;
  width: 5em;
  height: 5em;
  position: relative;
  z-index: 0;
}
.riple-rli-bounding-box .riple-indicator .riple-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.riple-rli-bounding-box .riple-indicator .riple {
  --border-width: 0.25em;
  position: absolute;
  border: var(--border-width) solid var(--riple-phase1-color);
  opacity: 1;
  border-radius: 50%;
  will-change: top, right, left, bottom, border-color;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7i1, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7io;
}
.riple-rli-bounding-box .riple-indicator .riple:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 1s) / 2 * -1);
}

@property --riple-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7i1 {
  0% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  4.9% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  5% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 1;
  }
  100% {
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
  }
}
@keyframes uxlv7io {
  100%, 0% {
    border-color: var(--riple-phase1-color);
  }
  24.9% {
    border-color: var(--riple-phase1-color);
  }
  25% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  49.9% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  50% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  74.9% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  75% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
  99.9% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--riple-phase".concat(e+1,"-color")});at(`.pulsate-rli-bounding-box {
  --TD-pulsate-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
  box-sizing: border-box;
  color: var(--TD-pulsate-phase1-color);
}
.pulsate-rli-bounding-box .pulsate-indicator {
  width: 4.4em;
  height: 1.1em;
  text-align: center;
  position: relative;
  z-index: 0;
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  align-items: center;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot {
  width: 1.1em;
  height: 1.1em;
  border-radius: 50%;
  background-color: var(--TD-pulsate-phase1-color);
  transform: scale(0);
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7s0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7to;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(1) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15 * -1);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(2) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(3) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15);
}
.pulsate-rli-bounding-box .pulsate-text {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 80%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.6em;
  letter-spacing: 0.5px;
  font-family: sans-serif;
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --TD-pulsate-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7s0 {
  0%, 90%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}
@keyframes uxlv7to {
  0%, 100% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  24.9% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  25% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  49.9% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  50% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  74.9% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  75% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
  99.9% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--TD-pulsate-phase".concat(e+1,"-color")});at(`.brick-stack-rli-bounding-box {
  --TD-brick-stack-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-brick-stack-phase1-color);
}
.brick-stack-rli-bounding-box .brick-stack-indicator {
  width: 2.8em;
  height: 2.8em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.brick-stack-rli-bounding-box .brick-stack {
  width: 100%;
  height: 100%;
  background: radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 0/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 100%/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 100% 100%/40% 40% no-repeat;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, ease-out) infinite uxlv7tu, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, ease-out) infinite uxlv7us;
}

@property --TD-brick-stack-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7tu {
  0% {
    background-position: 0 0, 0 100%, 100% 100%;
  }
  25% {
    background-position: 100% 0, 0 100%, 100% 100%;
  }
  50% {
    background-position: 100% 0, 0 0, 100% 100%;
  }
  75% {
    background-position: 100% 0, 0 0, 0 100%;
  }
  100% {
    background-position: 100% 100%, 0 0, 0 100%;
  }
}
@keyframes uxlv7us {
  100%, 0% {
    color: var(--TD-brick-stack-phase1-color);
  }
  20% {
    color: var(--TD-brick-stack-phase1-color);
  }
  25% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  45% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  50% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  70% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  75% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
  95% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--TD-brick-stack-phase".concat(e+1,"-color")});at(`.bob-rli-bounding-box {
  --TD-bob-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-bob-phase1-color);
}
.bob-rli-bounding-box .bob-indicator {
  width: 4.4em;
  height: 2.2em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bob-rli-bounding-box .bob-indicator .bobbing,
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  width: 1.1em;
  height: 100%;
  display: grid;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) var(--delay) infinite uxlv7u0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) var(--delay) infinite uxlv7vq;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  content: "";
  grid-area: 1/1;
}
.bob-rli-bounding-box .bob-indicator .bobbing {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12 * -1);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
  transform: translateX(150%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12);
  transform: translateX(300%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}

@property --TD-bob-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7u0 {
  100%, 0% {
    background-position: 50% 50%;
  }
  15% {
    background-position: 50% 10%;
  }
  30% {
    background-position: 50% 100%;
  }
  40% {
    background-position: 50% 0%;
  }
  50% {
    background-position: 50% 90%;
  }
  70% {
    background-position: 50% 10%;
  }
  98% {
    background-position: 50% 50%;
  }
}
@keyframes uxlv7vq {
  100%, 0% {
    color: var(--TD-bob-phase1-color);
  }
  22% {
    color: var(--TD-bob-phase1-color);
  }
  25% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  47% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  50% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  72% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  75% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
  97% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--TD-bob-phase".concat(e+1,"-color")});at(`.bounce-rli-bounding-box {
  --TD-bounce-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--TD-bounce-phase1-color);
  display: inline-block;
  padding-bottom: 0.25125em;
}
.bounce-rli-bounding-box .wrapper {
  --dot1-delay: 0s;
  --dot1-x-offset: 0.55em;
  --dot2-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.75) * -1);
  --dot2-x-offset: 2.2em;
  --dot3-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.5) * -1);
  --dot3-x-offset: 3.85em;
  width: 5.5em;
  height: 3.125em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bounce-rli-bounding-box .wrapper .group {
  display: block;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.bounce-rli-bounding-box .wrapper .group .dot {
  width: 1.1em;
  height: 1.1em;
  position: absolute;
  border-radius: 50%;
  background-color: var(--TD-bounce-phase1-color);
  transform-origin: 50%;
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7wc, calc(var(--rli-animation-duration, 0.5s) * 4) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) infinite uxlv7x6;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .shadow {
  width: 1.1em;
  height: 0.22em;
  border-radius: 50%;
  background-color: rgba(0, 0, 0, 0.5);
  position: absolute;
  top: 101%;
  transform-origin: 50%;
  z-index: -1;
  filter: blur(1px);
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7ww;
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay);
}

@property --TD-bounce-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 0.5s;
}
@keyframes uxlv7wc {
  0% {
    top: 0%;
  }
  60% {
    height: 1.25em;
    border-radius: 50%;
    transform: scaleX(1);
  }
  100% {
    top: 100%;
    height: 0.22em;
    transform: scaleX(1.5);
    filter: blur(0.4px);
  }
}
@keyframes uxlv7ww {
  0% {
    transform: scaleX(0.2);
    opacity: 0.2;
  }
  60% {
    opacity: 0.4;
  }
  100% {
    transform: scaleX(1.5);
    opacity: 0.6;
  }
}
@keyframes uxlv7x6 {
  0%, 100% {
    background-color: var(--TD-bounce-phase1-color);
  }
  20% {
    background-color: var(--TD-bounce-phase1-color);
  }
  25% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  45% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  50% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  70% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  75% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
  95% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--TD-bounce-phase".concat(e+1,"-color")});at(`.blink-blur-rli-bounding-box {
  --shape-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--shape-phase1-color);
}
.blink-blur-rli-bounding-box .blink-blur-indicator {
  isolation: isolate;
  display: flex;
  flex-direction: row;
  -moz-column-gap: 0.4em;
       column-gap: 0.4em;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape {
  --x-deg: -20deg;
  width: 1.8em;
  height: 2.25em;
  border-radius: 0.25em;
  color: inherit;
  transform: skewX(var(--x-deg));
  background-color: var(--shape-phase1-color);
  animation-name: uxlv7id, uxlv7jl;
  animation-duration: var(--rli-animation-duration, 1.2s), calc(var(--rli-animation-duration, 1.2s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in);
  animation-iteration-count: infinite;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape1 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.5 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape2 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.4 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape3 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.3 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape4 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.2 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape5 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.1 * -1);
}

@property --shape-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7id {
  100%, 0% {
    opacity: 0.3;
    filter: blur(0.0675em) drop-shadow(0 0 0.0625em);
    transform: skewX(var(--x-deg)) scale(1.2, 1.45);
  }
  39% {
    opacity: 0.8;
  }
  40%, 41%, 42% {
    opacity: 0;
  }
  43% {
    opacity: 0.8;
  }
  50% {
    opacity: 1;
    filter: blur(0em) drop-shadow(0 0 0em);
    transform: skewX(var(--x-deg)) scale(1, 1);
  }
}
@keyframes uxlv7jl {
  100%, 0% {
    color: var(--shape-phase1-color);
    background-color: var(--shape-phase1-color);
  }
  25% {
    color: var(--shape-phase2-color, var(--shape-phase1-color));
    background-color: var(--shape-phase2-color, var(--shape-phase1-color));
  }
  50% {
    color: var(--shape-phase3-color, var(--shape-phase1-color));
    background-color: var(--shape-phase3-color, var(--shape-phase1-color));
  }
  75% {
    color: var(--shape-phase4-color, var(--shape-phase1-color));
    background-color: var(--shape-phase4-color, var(--shape-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--shape-phase".concat(e+1,"-color")});at(`.trophy-spin-rli-bounding-box {
  --trophySpin-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  position: relative;
  isolation: isolate;
  color: var(--trophySpin-phase1-color);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator {
  width: 4em;
  perspective: 1000px;
  transform-style: preserve-3d;
  display: block;
  margin: 0 auto;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade {
  display: block;
  width: 4em;
  height: 0.5em;
  background: var(--trophySpin-phase1-color);
  animation: uxlv7ki var(--rli-animation-duration, 2.5s) var(--rli-animation-function, linear) infinite, uxlv7l2 calc(var(--rli-animation-duration, 2.5s) * 0.5) var(--rli-animation-function, linear) infinite, uxlv7ly calc(var(--rli-animation-duration, 2.5s) * 4) var(--rli-animation-function, linear) infinite;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(8) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 0 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(7) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 1 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(6) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 2 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(5) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 3 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(4) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 4 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(3) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 5 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 6 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(1) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 7 * -1);
}

@property --trophySpin-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2.5s;
}
@keyframes uxlv7ki {
  to {
    transform: rotateY(1turn) rotateX(-25deg);
  }
}
@keyframes uxlv7l2 {
  100%, 0% {
    filter: brightness(1);
    opacity: 1;
  }
  15% {
    filter: brightness(1);
  }
  25% {
    opacity: 0.96;
  }
  30% {
    filter: brightness(0.92);
  }
  50% {
    filter: brightness(0.7);
    opacity: 1;
  }
  75% {
    filter: brightness(0.92);
    opacity: 0.96;
  }
  90% {
    filter: brightness(1);
  }
}
@keyframes uxlv7ly {
  100%, 0% {
    background-color: var(--trophySpin-phase1-color);
  }
  18% {
    background-color: var(--trophySpin-phase1-color);
  }
  25% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  43% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  50% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  68% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  75% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
  93% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
}`);var Ea=Array.from({length:4},function(r,e){return"--trophySpin-phase".concat(e+1,"-color")}),$b=function(r){var e,s=Hb(r?.style,r?.size),n=s.styles,a=s.fontSize,i=r?.easing,o=Mb(r?.speedPlus,"2.5s").animationPeriod,A=function(l){var c={},d=Ea.length;if(l instanceof Array){for(var m=_b(l,d),g=0;g<m.length&&!(g>=4);g++)c[Ea[g]]=m[g];return c}try{if(typeof l!="string")throw new Error("Color String expected");for(var h=0;h<d;h++)c[Ea[h]]=l}catch(p){for(p instanceof Error?console.warn("[".concat(p.message,']: Received "').concat(typeof l,'" instead with value, ').concat(JSON.stringify(l))):console.warn("".concat(JSON.stringify(l)," received in <TrophySpin /> indicator cannot be processed. Using default instead!")),h=0;h<d;h++)c[Ea[h]]=gu}return c}((e=r?.color)!==null&&e!==void 0?e:"");return Fe.createElement("span",{className:"rli-d-i-b trophy-spin-rli-bounding-box",style:pr(pr(pr(pr(pr({},a&&{fontSize:a}),o&&{"--rli-animation-duration":o}),i&&{"--rli-animation-function":i}),A),n),role:"status","aria-live":"polite","aria-label":"Loading"},Fe.createElement("span",{className:"rli-d-i-b trophy-spin-indicator"},Fe.createElement("span",{className:"blade"}),Fe.createElement("span",{className:"blade"}),Fe.createElement("span",{className:"blade"}),Fe.createElement("span",{className:"blade"}),Fe.createElement("span",{className:"blade"}),Fe.createElement("span",{className:"blade"}),Fe.createElement("span",{className:"blade"}),Fe.createElement("span",{className:"blade"})),Fe.createElement(Ob,{staticText:!0,text:r?.text,textColor:r?.textColor}))};at(`.slab-rli-bounding-box {
  --slab-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--slab-phase1-color);
  position: relative;
}
.slab-rli-bounding-box .slab-indicator {
  position: relative;
  display: block;
  width: 7em;
  height: 4em;
  margin: 0 auto;
  overflow: hidden;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper {
  width: 4em;
  height: 4em;
  transform: perspective(15em) rotateX(66deg) rotateZ(-25deg);
  transform-style: preserve-3d;
  transform-origin: 50% 100%;
  display: block;
  position: absolute;
  bottom: 0;
  right: 0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--slab-phase1-color);
  opacity: 0;
  box-shadow: -0.08em 0.15em 0 rgba(0, 0, 0, 0.45);
  transform-origin: 0% 0%;
  animation: calc(var(--rli-animation-duration-unitless, 3) * 1s) var(--rli-animation-function, linear) infinite uxlv7md, calc(var(--rli-animation-duration-unitless, 3) * 4s) var(--rli-animation-function, linear) infinite uxlv7n0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(1) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 3 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(2) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 2 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(3) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(4) {
  animation-delay: 0s;
}

@property --slab-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration-unitless {
  syntax: "<number>";
  inherits: true;
  initial-value: 3;
}
@keyframes uxlv7md {
  0% {
    transform: translateY(0) rotateX(30deg);
    opacity: 0;
  }
  10% {
    transform: translateY(-40%) rotateX(0deg);
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  100% {
    transform: translateY(-400%) rotateX(0deg);
    opacity: 0;
  }
}
@keyframes uxlv7n0 {
  100%, 0% {
    background-color: var(--slab-phase1-color);
  }
  24.9% {
    background-color: var(--slab-phase1-color);
  }
  25% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  49.9% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  50% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  74.9% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  75% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
  99.9% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--slab-phase".concat(e+1,"-color")});at(`.lifeline-rli-bounding-box {
  --life-line-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  isolation: isolate;
  color: var(--life-line-phase1-color);
}
.lifeline-rli-bounding-box .lifeline-indicator {
  position: relative;
  text-align: center;
}
.lifeline-rli-bounding-box .lifeline-indicator path.rli-lifeline {
  stroke-dasharray: 474.7616760254 30.3039367676;
  animation: var(--rli-animation-duration, 2s) var(--rli-animation-function, linear) infinite uxlv7k3, calc(var(--rli-animation-duration, 2s) * 4) var(--rli-animation-function, linear) infinite uxlv7kg;
}
.lifeline-rli-bounding-box .lifeline-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --life-line-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2s;
}
@keyframes uxlv7k3 {
  to {
    stroke-dashoffset: -1010.1312255859;
  }
}
@keyframes uxlv7kg {
  100%, 0% {
    color: var(--life-line-phase1-color);
  }
  20% {
    color: var(--life-line-phase1-color);
  }
  25% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  45% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  50% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  70% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  75% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
  95% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
}`);Array.from({length:4},function(r,e){return"--life-line-phase".concat(e+1,"-color")});const Kb={sm:14,md:20,lg:32,xl:48},Vb=({size:r="md",color:e="#3b82f6",speedPlus:s=1,className:n=""})=>{const a=Kb[r];return t.jsx("div",{className:`flex items-center justify-center ${n}`,children:t.jsx($b,{color:e,size:a,speedPlus:s,style:{width:`${a}px`,height:`${a}px`}})})},Pl=({className:r})=>t.jsx(Vb,{size:"sm",className:r}),Dl=[{id:"ai-medical-review",label:"AI Medical Review",icon:Pc,description:"Australian clinical oversight and guidelines review (analyzes existing EMR data)"},{id:"batch-ai-review",label:"Batch AI Review",icon:As,description:"AI review for multiple patients from appointment book"}],Gb=({onQuickAction:r,processingAction:e,isFooter:s=!1})=>{const[n,a]=u.useState(null),i=async(A,l)=>{if(A==="ai-medical-review"){a(A),console.log("ü§ñ AI Medical Review action triggered...");try{console.log("üìã EMR EXTRACTION: Starting EMR data extraction via service worker...");const c=await new Promise(d=>{console.log("üìã EMR EXTRACTION: Sending EXTRACT_EMR_DATA_AI_REVIEW message to service worker"),chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA_AI_REVIEW",fields:["background","investigations","medications-problemlist"]},m=>{if(console.log("üìã EMR EXTRACTION: Response from service worker:",m),chrome.runtime.lastError){console.error("üìã EMR EXTRACTION: Chrome runtime error:",chrome.runtime.lastError),d({success:!1,error:`Chrome runtime error: ${chrome.runtime.lastError.message}`});return}if(!m){console.error("üìã EMR EXTRACTION: No response received from service worker"),d({success:!1,error:"No response from service worker"});return}d(m)})});if(c.success&&c.data){const d=c.data;if(console.log("üìã EMR EXTRACTION: Successfully received data:",d),Object.entries(d).filter(([h,p])=>p&&typeof p=="string"&&p.trim().length>0).length===0)throw new Error("No EMR data found. Please ensure you're on a patient page with clinical data.");const g=`
Background: ${d.background||"No background data available"}

Investigations: ${d.investigations||"No investigations data available"}

Medications: ${d["medications-problemlist"]||"No medications data available"}
          `.trim();console.log("üìã EMR EXTRACTION: Processing EMR data for AI review"),await r(A,{emrData:d,formattedInput:g,type:"australian-medical-review"}),console.log("‚úÖ AI Medical Review completed successfully")}else{const d=c.error||"Unknown extraction error";throw new Error(`Failed to extract EMR data: ${d}`)}}catch(c){console.error("‚ùå AI Medical Review failed:",c);const d=c instanceof Error?c.message:"Unknown error";console.error("AI Review Error:",d),typeof window<"u"&&alert(`AI Medical Review Error

${d}`)}finally{a(null)}return}try{a(A),console.log("‚ö° Calling onQuickAction for AI Review..."),await r(A,A==="batch-ai-review"?{type:"show-modal"}:l),console.log("‚ö° AI Review onQuickAction completed successfully")}catch(c){console.error(`‚ùå AI Review action ${A} failed:`,c)}finally{a(null)}},o=A=>e===A||n===A;return s?t.jsxs("div",{className:"bg-white",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(is,{className:"w-3 h-3 text-indigo-600"}),t.jsx("h3",{className:"text-gray-900 font-medium text-xs",children:"AI Medical Review"})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Dl.map(A=>t.jsxs("button",{onClick:()=>i(A.id),disabled:o(A.id),className:`
                bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 relative p-2 rounded-lg transition-all text-center btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(A.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[t.jsx(A.icon,{className:"w-3 h-3 text-indigo-600 flex-shrink-0"}),t.jsx("div",{className:"text-gray-900 text-xs font-medium leading-tight",children:A.label})]}),o(A.id)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:t.jsx(Pl,{})})]},A.id))})]}):t.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(is,{className:"w-5 h-5 text-indigo-600"}),t.jsxs("div",{className:"text-left",children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"AI Medical Review"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Clinical analysis and guidelines review"})]})]})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 gap-3",children:Dl.map(A=>t.jsxs("button",{onClick:()=>i(A.id),disabled:o(A.id),className:`
                bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 p-3 rounded-lg text-left transition-all btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(A.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(A.icon,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-indigo-600"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-gray-900 text-xs font-medium truncate",children:A.label}),t.jsx("div",{className:"text-gray-600 text-xs mt-1 leading-tight",children:A.description})]})]}),o(A.id)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:t.jsx(Pl,{})})]},A.id))})}),t.jsx("div",{className:"p-4 bg-indigo-50",children:t.jsxs("p",{className:"text-indigo-700 text-xs",children:["üí° ",t.jsx("strong",{children:"Note:"})," AI Review uses MedGemma-27b for comprehensive clinical analysis"]})})]})},Rl={idle:{label:"Ready",bgColor:"bg-emerald-50",textColor:"text-emerald-700",showDot:!1},"extracting-patient":{label:"Preparing",bgColor:"bg-blue-50",textColor:"text-blue-700",showDot:!0,animated:!0},recording:{label:"Recording‚Ä¶",bgColor:"bg-red-50",textColor:"text-red-700",showDot:!0,animated:!0},transcribing:{label:"Transcribing",bgColor:"bg-blue-50",textColor:"text-blue-700",showDot:!0,animated:!0},classifying:{label:"Analyzing",bgColor:"bg-purple-50",textColor:"text-purple-700",showDot:!0,animated:!0},processing:{label:"Processing",bgColor:"bg-purple-50",textColor:"text-purple-700",showDot:!0,animated:!0},enhancing:{label:"Enhancing",bgColor:"bg-purple-50",textColor:"text-purple-700",showDot:!0,animated:!0},complete:{label:"Complete",bgColor:"bg-teal-50",textColor:"text-teal-700",showDot:!1},error:{label:"Error",bgColor:"bg-rose-50",textColor:"text-rose-700",showIcon:!0},cancelled:{label:"Cancelled",bgColor:"bg-gray-100",textColor:"text-gray-600",showDot:!1},cancelling:{label:"Cancelling",bgColor:"bg-amber-50",textColor:"text-amber-700",showDot:!0,animated:!0}},hu=Fe.memo(({status:r,isRecording:e=!1,micAvailable:s=!0,className:n=""})=>{let a;return!s&&r==="idle"?a={label:"Mic unavailable",bgColor:"bg-gray-100",textColor:"text-gray-600",showIcon:!0}:a=Rl[r]||Rl.idle,t.jsxs("div",{className:`
        inline-flex items-center gap-1 px-2 py-0.5 rounded-full
        ${a.bgColor} ${a.textColor}
        ${n}
      `,role:"status","aria-live":"polite","aria-label":`Status: ${a.label}`,children:[a.showDot&&t.jsx("span",{className:`
            w-1.5 h-1.5 rounded-full bg-current
            ${a.animated?"motion-safe:animate-pulse":""}
          `,"aria-hidden":"true"}),a.showIcon&&t.jsx(ot,{className:"w-3 h-3","aria-hidden":"true"}),t.jsx("span",{className:"text-xs font-medium leading-none",children:a.label})]})});hu.displayName="StateChip";const Wb=r=>{const e=r.find(i=>i.deviceId==="default");if(e)return e;const s=r.find(i=>i.label.toLowerCase().includes("built-in")||i.label.toLowerCase().includes("internal")||i.label.toLowerCase().includes("macbook"));if(s)return s;const n=r.find(i=>i.deviceId!=="default"&&i.label&&!i.label.includes("Microphone ")&&!cA(i.label));if(n)return n;const a=r.find(i=>i.deviceId!=="default");return a||r[0]},zb=r=>{const e=r.find(i=>i.deviceId==="default");if(e)return e;const s=r.find(i=>i.label.toLowerCase().includes("built-in")||i.label.toLowerCase().includes("internal")||i.label.toLowerCase().includes("macbook"));if(s)return s;const n=r.find(i=>i.deviceId!=="default"&&i.label&&!i.label.includes("Speaker ")&&!cA(i.label));if(n)return n;const a=r.find(i=>i.deviceId!=="default");return a||r[0]},cA=r=>{const e=r.toLowerCase();return["iphone","ipad","airpods","bluetooth","wireless","headphones","headset","earbuds","watch"].some(n=>e.includes(n))},Ml=(r,e,s)=>{if(r.deviceId==="default")return"system default device";const n=r.label.toLowerCase();return n.includes("built-in")||n.includes("internal")||n.includes("macbook")?"built-in device":cA(r.label)?r.deviceId!=="default"?"non-default device fallback":"first available device":"preferred non-mobile device"},fu=()=>{const[r,e]=u.useState([]),[s,n]=u.useState([]),[a,i]=u.useState(!0),[o,A]=u.useState(!1),{selectedMicrophoneId:l,selectedSpeakerId:c,microphoneSelectionType:d,speakerSelectionType:m,setSelectedMicrophoneId:g,setSelectedSpeakerId:h}=$c(),p=u.useCallback(async()=>{try{i(!0);const f=(await navigator.permissions.query({name:"microphone"})).state==="granted";A(f);const S=await navigator.mediaDevices.enumerateDevices(),F=S.filter(T=>T.kind==="audioinput").map(T=>({deviceId:T.deviceId,label:T.label||`Microphone ${T.deviceId.slice(0,8)}`,groupId:T.groupId,kind:"audioinput"})),w=S.filter(T=>T.kind==="audiooutput").map(T=>({deviceId:T.deviceId,label:T.label||`Speaker ${T.deviceId.slice(0,8)}`,groupId:T.groupId,kind:"audiooutput"}));if(e(F),n(w),F.length>0&&(!l||d==="auto")){let T=null;if(d==="auto")try{const C=localStorage.getItem("xestro-preferred-microphone");C&&(T=F.find(E=>E.deviceId===C)||null,T&&console.log("üé§ Using saved microphone preference:",T.label))}catch(C){console.warn("Failed to read microphone preference:",C)}T||(T=Wb(F),console.log("üé§ Auto-selected microphone:",{deviceId:T.deviceId,label:T.label,selectionReason:Ml(T,F,"microphone")})),g(T.deviceId,!1)}if(w.length>0&&(!c||m==="auto")){let T=null;if(m==="auto")try{const C=localStorage.getItem("xestro-preferred-speaker");C&&(T=w.find(E=>E.deviceId===C)||null,T&&console.log("üîä Using saved speaker preference:",T.label))}catch(C){console.warn("Failed to read speaker preference:",C)}T||(T=zb(w),console.log("üîä Auto-selected speaker:",{deviceId:T.deviceId,label:T.label,selectionReason:Ml(T,w,"speaker")})),h(T.deviceId,!1)}console.log("üé§ Audio devices enumerated:",{microphones:F.length,speakers:w.length})}catch(x){console.error("üé§ Failed to enumerate audio devices:",x)}finally{i(!1)}},[l,c,d,m,g,h]),b=u.useCallback(async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(f=>f.stop()),A(!0),await p()}catch(x){console.error("üé§ Failed to get microphone permission:",x),A(!1)}},[p]),N=u.useCallback(x=>{console.log("üé§ Manually selecting microphone:",x),g(x,!0)},[g]),y=u.useCallback(x=>{console.log("üîä Manually selecting speaker:",x),h(x,!0)},[h]),j=u.useCallback(()=>{if(!l)return"No microphone";const x=r.find(f=>f.deviceId===l);return x?x.label:l==="default"?"Default microphone":"Unknown microphone"},[l,r]),Q=u.useCallback(()=>{if(!c)return"No speaker";const x=s.find(f=>f.deviceId===c);return x?x.label:c==="default"?"Default speaker":"Unknown speaker"},[c,s]),v=u.useCallback(async()=>{await p()},[p]);return u.useEffect(()=>{p();const x=()=>{console.log("üé§ Audio devices changed, re-enumerating..."),p()};return navigator.mediaDevices.addEventListener("devicechange",x),()=>{navigator.mediaDevices.removeEventListener("devicechange",x)}},[p]),{microphones:r,speakers:s,selectedMicrophoneId:l,selectedSpeakerId:c,isLoading:a,hasPermission:o,setSelectedMicrophone:N,setSelectedSpeaker:y,requestPermission:b,refreshDevices:v,getCurrentMicrophoneLabel:j,getCurrentSpeakerLabel:Q}},Xb=({isOpen:r,onClose:e,triggerRef:s})=>{const n=u.useRef(null),{microphones:a,speakers:i,selectedMicrophoneId:o,selectedSpeakerId:A,setSelectedMicrophone:l,setSelectedSpeaker:c,isLoading:d,hasPermission:m,requestPermission:g}=fu();u.useEffect(()=>{if(!r)return;const y=j=>{j.key==="Escape"&&(j.preventDefault(),e(),s.current?.focus())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[r,e,s]),u.useEffect(()=>{r&&n.current&&n.current.querySelector("button")?.focus()},[r]);const h=y=>{y.kind==="audioinput"?l(y.deviceId):c(y.deviceId),console.log("[DevicePopover] Device changed",{kind:y.kind,hasLabel:!!y.label,timestamp:Date.now()})};if(!r)return null;const p=s.current?.getBoundingClientRect(),b=p?p.bottom+8:0,N=p?p.left:0;return t.jsx(lA,{isOpen:r,onClickOutside:e,children:t.jsxs("div",{ref:n,role:"dialog","aria-label":"Audio device settings","aria-modal":"true",className:`
          bg-white border border-gray-200 rounded-lg shadow-xl
          w-80 max-h-96 overflow-hidden
        `,style:{position:"fixed",top:`${b}px`,left:`${N}px`,zIndex:9999},children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[t.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:"Audio Devices"}),t.jsx("button",{onClick:e,className:`
              p-1 rounded hover:bg-gray-100 transition-colors
              focus:outline-none focus:ring-2 focus:ring-blue-500
            `,"aria-label":"Close device settings",children:t.jsx(nt,{className:"w-4 h-4 text-gray-500"})})]}),t.jsx("div",{className:"overflow-y-auto max-h-80",children:m?d?t.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"Loading devices..."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-4 border-b border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Rt,{className:"w-4 h-4 text-gray-600"}),t.jsx("h3",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Microphone"})]}),a.length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"No microphones found"}):t.jsx("div",{className:"space-y-1",children:a.map(y=>t.jsx("button",{onClick:()=>h(y),className:`
                          w-full px-3 py-2 text-left text-sm rounded-md
                          transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500
                          ${o===y.deviceId?"bg-blue-50 text-blue-900 font-medium":"text-gray-700 hover:bg-gray-50"}
                        `,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"truncate",children:y.label}),o===y.deviceId&&t.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full flex-shrink-0","aria-label":"Selected"})]})},y.deviceId))})]}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(fm,{className:"w-4 h-4 text-gray-600"}),t.jsx("h3",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Output"})]}),i.length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"No speakers found"}):t.jsx("div",{className:"space-y-1",children:i.map(y=>t.jsx("button",{onClick:()=>h(y),className:`
                          w-full px-3 py-2 text-left text-sm rounded-md
                          transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500
                          ${A===y.deviceId?"bg-blue-50 text-blue-900 font-medium":"text-gray-700 hover:bg-gray-50"}
                        `,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"truncate",children:y.label}),A===y.deviceId&&t.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full flex-shrink-0","aria-label":"Selected"})]})},y.deviceId))})]})]}):t.jsxs("div",{className:"p-4 text-center",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Audio access required to select devices"}),t.jsx("button",{onClick:g,className:`
                  px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md
                  hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500
                  transition-colors
                `,children:"Enable Access"})]})}),t.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:t.jsx("button",{onClick:e,className:`
              w-full px-4 py-2 bg-gray-900 text-white text-sm font-medium rounded-md
              hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500
              transition-colors
            `,children:"Done"})})]})})},qb=({phase:r,progress:e,compact:s=!1})=>{const n=Math.max(0,Math.min(100,e)),a=s?`${n}%`:`${r} ¬∑ ${n}%`;return t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"session-progress-bar",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Processing progress: ${n}%`,children:t.jsx("div",{className:"session-progress-fill",style:{width:`${n}%`}})}),t.jsx("span",{className:"text-[10px] font-medium text-slate-600 tabular-nums","aria-live":"polite","aria-atomic":"true",children:a})]})},Hl={letters:{id:"letters",label:"Letters & Correspondence",icon:"‚úâÔ∏è",agents:["quick-letter","consultation","patient-education"],colors:{bg:"bg-blue-50",bgHover:"bg-blue-100",bgGradient:"bg-gradient-to-br from-blue-50 to-blue-100",border:"border-blue-200",borderHover:"border-blue-300",text:"text-blue-700",textMuted:"text-blue-600",indicator:"bg-blue-500",badgeBg:"bg-blue-100",badgeText:"text-blue-700"},description:"Clinical letters, consultations, and patient communications"},clinical_data:{id:"clinical_data",label:"Clinical Data",icon:"üìã",agents:["background","investigation-summary","medication","bloods","imaging"],colors:{bg:"bg-emerald-50",bgHover:"bg-emerald-100",bgGradient:"bg-gradient-to-br from-emerald-50 to-emerald-100",border:"border-emerald-200",borderHover:"border-emerald-300",text:"text-emerald-700",textMuted:"text-emerald-600",indicator:"bg-emerald-500",badgeBg:"bg-emerald-100",badgeText:"text-emerald-700"},description:"Patient background, investigations, and clinical summaries"},procedures:{id:"procedures",label:"Procedures",icon:"üî¨",agents:["tavi","tavi-workup","angiogram-pci","mteer","tteer","pfo-closure","asd-closure","pvl-plug","bypass-graft","right-heart-cath","pre-op-plan"],colors:{bg:"bg-purple-50",bgHover:"bg-purple-100",bgGradient:"bg-gradient-to-br from-purple-50 to-purple-100",border:"border-purple-200",borderHover:"border-purple-300",text:"text-purple-700",textMuted:"text-purple-600",indicator:"bg-purple-500",badgeBg:"bg-purple-100",badgeText:"text-purple-700"},description:"Interventional cardiac procedures and reports"},ai_review:{id:"ai_review",label:"AI Review",icon:"üß†",agents:["ai-medical-review","batch-ai-review","aus-medical-review"],colors:{bg:"bg-amber-50",bgHover:"bg-amber-100",bgGradient:"bg-gradient-to-br from-amber-50 to-amber-100",border:"border-amber-200",borderHover:"border-amber-300",text:"text-amber-700",textMuted:"text-amber-600",indicator:"bg-amber-500",badgeBg:"bg-amber-100",badgeText:"text-amber-700"},description:"AI-powered clinical reviews and recommendations"}};function xu(r){for(const e of Object.values(Hl))if(e.agents.includes(r))return e;return Hl.clinical_data}function bu(r){return xu(r).colors}function yu(r){return xu(r).icon}const eo=3,vs=r=>{const s={recording:"recording",transcribing:"transcribing",processing:"ai-analysis",needs_review:"needs_review",completed:"completed",error:"error"}[r],n=Ss(s),a={recording:t.jsx(Rt,{className:`w-3 h-3 text-${n.indicator}`}),transcribing:t.jsx(er,{className:`w-3 h-3 animate-spin text-${n.indicator}`}),processing:t.jsx(Rc,{className:`w-3 h-3 text-${n.indicator}`}),needs_review:t.jsx(qo,{className:`w-3 h-3 text-${n.text}`}),completed:t.jsx(Vs,{className:`w-3 h-3 text-${n.text}`}),error:t.jsx(ot,{className:`w-3 h-3 text-${n.text}`})},i={recording:"Audio capture in progress",transcribing:"Converting speech to clinical text",processing:"AI drafting the note",needs_review:"Ready for clinician polish",completed:"Finalized and ready to send",error:"Resolve to keep queue moving"};return{label:{recording:"Recording",transcribing:"Transcribing",processing:"Processing",needs_review:"Needs Review",completed:"Completed",error:"Attention Needed"}[r],badgeClass:`bg-gradient-to-br from-${n.gradient.from} to-${n.gradient.to} text-${n.text} border border-${n.border}/70`,dotClass:`bg-${n.indicator} border-${n.border}/60`,icon:a[r],description:i[r],cardClass:n.bgGradient+` border-${n.border}/60`,chipClass:`text-${n.text}`,accentEdgeClass:`before:bg-gradient-to-br before:from-${n.gradient.from.replace("-50","-300")}/40 before:via-${n.gradient.to.replace("-50","-200")}/30 before:to-transparent`}},Yb={recording:vs("recording"),transcribing:vs("transcribing"),processing:vs("processing"),needs_review:vs("needs_review"),completed:vs("completed"),error:vs("error")},Ll=r=>{if(!r||r<0)return"‚Äî";const e=Math.floor(r/1e3);if(e<60)return`${e}s`;const s=Math.floor(e/60),n=e%60;return n===0?`${s}m`:`${s}m ${n}s`},Ol=r=>r?new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"‚Äî",Jb=r=>{const e=r.status;return e==="recording"?"recording":e==="transcribing"?"transcribing":e==="processing"?"processing":e==="error"||e==="cancelled"?"error":e==="completed"&&r.completed&&(r.reviewedAt||r.finalizedAt)?"completed":"needs_review"},Zb=r=>r.processingTime?r.processingTime:r.processingStartTime&&r.completedTime?r.completedTime-r.processingStartTime:null,ey=r=>r.recordingStartTime&&r.transcriptionStartTime?r.transcriptionStartTime-r.recordingStartTime:null,ty=r=>({"bg-blue-500":"59, 130, 246","bg-emerald-500":"16, 185, 129","bg-purple-500":"168, 85, 247","bg-amber-500":"245, 158, 11"})[r]||"168, 85, 247",to=({session:r,state:e,isSelected:s,isNextReview:n,isActiveRecording:a,copiedSessionId:i,isChecked:o,isCompact:A,isPersisted:l,onToggleCheck:c,onSessionSelect:d,onResumeRecording:m,onStopRecording:g,onRemoveSession:h,onCopyResults:p,onClose:b})=>{const N=Yb[e],y=!!(r.results&&r.results.trim().length>0),j=i===r.id,Q=ey(r),v=Zb(r),[x,f]=u.useState(!1),S=bu(r.agentType),F=yu(r.agentType),w=u.useCallback(()=>{d&&d(r)},[d,r]),T=u.useCallback(()=>{e!=="recording"&&d&&(f(!0),setTimeout(()=>f(!1),200),w(),b&&setTimeout(b,250))},[e,d,w,b]),C=u.useCallback(U=>{U.stopPropagation(),c(r.id)},[c,r.id]),E=ty(S.indicator);return A?t.jsx("div",{className:`relative rounded-lg border-l-4 transition-all duration-300 px-2 py-1.5 ${S.bg} ${S.border} opacity-60 hover:opacity-80 ${s?"ring-2":""} ${e!=="recording"&&d?"cursor-pointer":""}`,style:{borderLeftColor:`var(--${S.indicator.replace("bg-","")})`,...s?{"--tw-ring-color":`rgba(${E}, 0.5)`}:{},...x?{animation:"clickFeedback 0.2s cubic-bezier(0.4, 0, 0.2, 1)","--click-shadow-color":`rgba(${E}, 0.3)`}:{}},onClick:T,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-shrink-0 cursor-pointer group",onClick:C,role:"button","aria-label":"Unmark session as complete",children:t.jsx("div",{className:"w-5 h-5 rounded border-2 bg-emerald-500 border-emerald-600 flex items-center justify-center",children:t.jsx(Vs,{className:"w-3.5 h-3.5 text-white"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-xs",children:F}),t.jsx("p",{className:"truncate font-medium text-xs text-slate-700",children:r.patient?.name||"Unnamed patient"})]}),t.jsx("span",{className:"text-[9px] text-slate-500 whitespace-nowrap",children:Ol(r.timestamp)})]}),t.jsxs("div",{className:"flex items-center gap-1 text-[9px] text-slate-500 truncate",children:[l&&t.jsx("span",{title:"Stored locally",children:t.jsx(Rn,{className:"w-2.5 h-2.5 flex-shrink-0"})}),t.jsx("span",{className:"truncate",children:r.agentName||r.agentType})]})]}),t.jsx("button",{onClick:U=>{U.stopPropagation(),h(r.id)},className:"flex-shrink-0 p-1 text-slate-400 hover:text-rose-600 rounded transition-colors",title:"Remove",children:t.jsx(Er,{className:"w-3 h-3"})})]})}):t.jsx("div",{className:`relative rounded-xl border-l-4 transition-all duration-300 px-3 py-2 ${S.bg} ${S.border} ${s?"ring-2":""} ${e!=="recording"&&d?"cursor-pointer":""}`,style:{borderLeftColor:`var(--${S.indicator.replace("bg-","")})`,...s?{"--tw-ring-color":`rgba(${E}, 0.5)`}:{},...x?{animation:"clickFeedback 0.2s cubic-bezier(0.4, 0, 0.2, 1)","--click-shadow-color":`rgba(${E}, 0.3)`}:{}},onClick:T,children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:"flex-shrink-0 pt-0.5 cursor-pointer group",onClick:C,role:"button","aria-label":o?"Unmark session as complete":"Mark session as complete",children:t.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${o?"bg-emerald-500 border-emerald-600":"bg-white border-slate-300 group-hover:border-emerald-400 group-hover:bg-emerald-50"}`,children:o&&t.jsx(Vs,{className:"w-3.5 h-3.5 text-white"})})}),t.jsxs("div",{className:"flex items-start justify-between gap-2 flex-1 min-w-0",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mb-1",children:[t.jsx("span",{className:"text-base opacity-40 flex-shrink-0",children:F}),t.jsx("p",{className:"truncate font-semibold text-sm text-slate-900",children:r.patient?.name||"Unnamed patient"}),t.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide ${N.badgeClass} ${N.chipClass}`,children:[N.icon,t.jsx("span",{children:N.label})]}),e==="processing"&&r.pipelineProgress&&t.jsx(qb,{phase:r.pipelineProgress.details||r.pipelineProgress.stage||"Processing",progress:r.pipelineProgress.stageProgress||r.pipelineProgress.progress,compact:!0}),n&&t.jsx("span",{className:"rounded-full bg-amber-100 px-1.5 py-0.5 text-[9px] font-semibold uppercase tracking-wide text-amber-700",children:"Next"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-0.5 text-[10px] font-medium uppercase tracking-wide text-slate-500",children:[t.jsxs("span",{className:"flex items-center gap-0.5",children:[t.jsx(Kt,{className:"w-2.5 h-2.5 text-slate-400"}),Ol(r.timestamp)]}),t.jsxs("span",{className:"flex items-center gap-0.5",children:[l&&t.jsx("span",{title:"Stored locally",children:t.jsx(Rn,{className:"w-2.5 h-2.5 flex-shrink-0"})}),t.jsx("span",{children:r.agentName||r.agentType})]}),Q!==null&&t.jsxs("span",{className:"flex items-center gap-0.5",children:[t.jsx(Rt,{className:"w-2.5 h-2.5 text-slate-400"}),Ll(Q)]}),v!==null&&t.jsxs("span",{className:"flex items-center gap-0.5",children:[t.jsx(Rc,{className:"w-2.5 h-2.5 text-slate-400"}),Ll(v)]})]}),e==="error"&&r.errors?.length?t.jsxs("div",{className:"mt-1 text-[10px] text-rose-600 flex items-center gap-1",children:[t.jsx(ot,{className:"w-2.5 h-2.5"}),r.errors[0]]}):null,(e==="needs_review"||e==="completed")&&y&&t.jsx("div",{className:"mt-2 rounded border border-slate-200/70 bg-slate-50/80 px-2 py-1 text-[10px] text-slate-600",children:t.jsxs("p",{className:"line-clamp-2 leading-relaxed",children:[r.results.slice(0,120),"‚Ä¶"]})})]}),t.jsxs("div",{className:"flex flex-col gap-1.5",children:[e==="recording"&&a&&g&&t.jsx("button",{onClick:U=>{U.stopPropagation(),g()},className:"inline-flex items-center gap-1 rounded border border-red-200/80 bg-white px-2 py-1 text-[11px] font-semibold uppercase text-red-600 hover:bg-red-50",title:"Stop recording",children:t.jsx(xm,{className:"w-3.5 h-3.5"})}),e==="recording"&&!a&&m&&t.jsx("button",{onClick:U=>{U.stopPropagation(),m(r)},className:"inline-flex items-center gap-1 rounded border border-red-200/80 bg-red-50/80 px-2 py-1 text-[11px] font-semibold uppercase text-red-600 hover:bg-red-100",title:"Resume recording",children:t.jsx(zo,{className:"w-3.5 h-3.5"})}),(e==="needs_review"||e==="completed")&&t.jsx("button",{onClick:U=>{U.stopPropagation(),p(r)},disabled:!y,className:`inline-flex items-center gap-1 rounded border px-2 py-1 text-[11px] font-semibold uppercase ${y?"border-emerald-200/80 bg-white text-emerald-600 hover:bg-emerald-50":"border-slate-200/80 bg-white text-slate-400 cursor-not-allowed"}`,title:"Copy letter",children:j?t.jsx(gr,{className:"w-3.5 h-3.5"}):t.jsx(Vr,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:U=>{U.stopPropagation(),h(r.id)},className:"inline-flex items-center gap-1 rounded border border-slate-200/80 bg-white px-2 py-1 text-[11px] font-semibold uppercase text-slate-500 hover:bg-rose-50 hover:text-rose-600",title:"Remove",children:t.jsx(Er,{className:"w-3.5 h-3.5"})})]})]})]})})},vu=u.memo(({sessions:r,onRemoveSession:e,onClearAllSessions:s,onSessionSelect:n,onResumeRecording:a,onStopRecording:i,selectedSessionId:o,activeRecordingSessionId:A=null,isOpen:l,onClose:c,triggerRef:d,position:m,checkedSessionIds:g=new Set,onToggleSessionCheck:h,persistedSessionIds:p=new Set})=>{const[b,N]=u.useState(null),[y,j]=u.useState(!1),[Q,v]=u.useState(!1),[x,f]=u.useState(!1);u.useEffect(()=>{if(!b)return;const O=setTimeout(()=>N(null),2e3);return()=>clearTimeout(O)},[b]);const S=u.useCallback(O=>{h&&h(O)},[h]),F=u.useCallback(async O=>{if(!(!O.results||O.results.trim().length===0))try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(O.results);else{const z=document.createElement("textarea");z.value=O.results,z.setAttribute("readonly",""),z.style.position="absolute",z.style.left="-9999px",document.body.appendChild(z),z.select(),document.execCommand("copy"),document.body.removeChild(z)}N(O.id)}catch(z){console.error("Failed to copy letter content:",z)}},[]),w=u.useMemo(()=>r.map(O=>({session:O,state:Jb(O),isChecked:g.has(O.id)})),[r,g]),T=u.useMemo(()=>w.find(O=>O.state==="needs_review"&&!O.isChecked)||w.find(O=>O.state==="completed"&&!O.isChecked),[w]),C=u.useMemo(()=>{const O=[],z=[],H=[];w.forEach(({session:Ae,state:D,isChecked:K})=>{const ee={session:Ae,isChecked:K};D==="recording"||D==="transcribing"||D==="processing"?z.push(ee):D==="error"?H.push(ee):(D==="needs_review"||D==="completed")&&O.push(ee)});const X=(Ae,D)=>Ae.isChecked===D.isChecked?0:Ae.isChecked?1:-1;return O.sort(X),z.sort(X),H.sort(X),{completed:O,inProgress:z,errored:H}},[w]),E=u.useMemo(()=>{const O=y?C.completed.length:eo,z=Q?C.inProgress.length:eo,H=x?C.errored.length:eo;return{completed:C.completed.slice(0,O),inProgress:C.inProgress.slice(0,z),errored:C.errored.slice(0,H),hasMoreCompleted:C.completed.length>O,hasMoreInProgress:C.inProgress.length>z,hasMoreErrored:C.errored.length>H}},[C,y,Q,x]),U=()=>{s(),c()},[k,P]=u.useState(null),M=Fe.useRef(),$=u.useCallback(()=>{if(m){P(m);return}if(d?.current){requestAnimationFrame(()=>{if(d?.current){const O=d.current.getBoundingClientRect(),z=320,H=16,X=O.right-z,Ae=X<H;P(Ae?{top:Math.round(O.bottom+8),left:H}:{top:Math.round(O.bottom+8),left:Math.round(X)})}});return}P(null)},[m,d]),W=({onClick:O,hiddenCount:z,category:H})=>t.jsxs("button",{onClick:O,className:"w-full px-3 py-2 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors flex items-center justify-center space-x-1",children:[t.jsx(Dt,{className:"w-3 h-3"}),t.jsxs("span",{children:["Show ",z," more ",H]})]});u.useEffect(()=>{if(!l)return;$();const O=()=>$();return window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O),M.current&&clearTimeout(M.current)}},[l,$]);const V=u.useCallback(()=>k?{position:"absolute",top:k.top,left:k.left,right:k.right,width:"320px",maxHeight:"calc(100vh - 80px)",zIndex:9990}:{position:"fixed",top:"60px",right:"16px",width:"320px",maxHeight:"calc(100vh - 80px)",zIndex:9990},[k]);if(!l||r.length===0)return null;const L=t.jsxs("div",{style:V(),className:"bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden","data-dropdown-menu":!0,children:[t.jsx("div",{className:"p-3 border-b border-gray-100 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(As,{className:"w-4 h-4 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Recent Sessions"}),t.jsxs("p",{className:"text-gray-600 text-xs",children:[r.length," total ‚Ä¢ ",C.inProgress.length," processing ‚Ä¢ ",C.completed.length," completed",C.errored.length>0&&` ‚Ä¢ ${C.errored.length} error${C.errored.length!==1?"s":""}`]})]})]}),r.length>0&&t.jsx("button",{onClick:U,className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear all sessions",children:t.jsx(Er,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"max-h-[calc(100vh-160px)] overflow-y-auto",children:[C.inProgress.length>0&&t.jsxs("div",{className:"p-2",children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx(Kt,{className:"w-3 h-3 text-amber-600"}),t.jsx("span",{className:"text-xs font-medium text-amber-700",children:"In Progress"})]}),t.jsxs("div",{className:"space-y-2",children:[E.inProgress.map(({session:O,isChecked:z})=>{const H=w.find(X=>X.session.id===O.id);return t.jsx(to,{session:O,state:H?.state||"processing",isSelected:o===O.id,isNextReview:T?.session.id===O.id,isActiveRecording:O.id===A,copiedSessionId:b,isChecked:z,isCompact:z,isPersisted:p.has(O.id),onToggleCheck:S,onSessionSelect:n,onResumeRecording:a,onStopRecording:i,onRemoveSession:e,onCopyResults:F,onClose:c},O.id)}),E.hasMoreInProgress&&t.jsx(W,{onClick:()=>v(!0),hiddenCount:C.inProgress.length-E.inProgress.length,category:"in progress"})]})]}),C.errored.length>0&&t.jsxs("div",{className:`p-2 ${C.inProgress.length>0?"border-t border-gray-100":""}`,children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full flex-shrink-0"}),t.jsx("span",{className:"text-xs font-medium text-red-700",children:"Issues"})]}),t.jsxs("div",{className:"space-y-2",children:[E.errored.map(({session:O,isChecked:z})=>{const H=w.find(X=>X.session.id===O.id);return t.jsx(to,{session:O,state:H?.state||"error",isSelected:o===O.id,isNextReview:T?.session.id===O.id,isActiveRecording:O.id===A,copiedSessionId:b,isChecked:z,isCompact:z,isPersisted:p.has(O.id),onToggleCheck:S,onSessionSelect:n,onResumeRecording:a,onStopRecording:i,onRemoveSession:e,onCopyResults:F,onClose:c},O.id)}),E.hasMoreErrored&&t.jsx(W,{onClick:()=>f(!0),hiddenCount:C.errored.length-E.errored.length,category:"issues"})]})]}),C.completed.length>0&&t.jsxs("div",{className:`p-2 ${C.inProgress.length>0||C.errored.length>0?"border-t border-gray-100":""}`,children:[(C.inProgress.length>0||C.errored.length>0)&&t.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[t.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full flex-shrink-0"}),t.jsx("span",{className:"text-xs font-medium text-emerald-700",children:"Completed"})]}),t.jsxs("div",{className:"space-y-2",children:[E.completed.map(({session:O,isChecked:z})=>{const H=w.find(X=>X.session.id===O.id);return t.jsx(to,{session:O,state:H?.state||"needs_review",isSelected:o===O.id,isNextReview:T?.session.id===O.id,isActiveRecording:O.id===A,copiedSessionId:b,isChecked:z,isCompact:z,isPersisted:p.has(O.id),onToggleCheck:S,onSessionSelect:n,onResumeRecording:a,onStopRecording:i,onRemoveSession:e,onCopyResults:F,onClose:c},O.id)}),E.hasMoreCompleted&&t.jsx(W,{onClick:()=>j(!0),hiddenCount:C.completed.length-E.completed.length,category:"completed"})]})]})]}),r.length===0&&t.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No recent sessions"})]});return t.jsx(lA,{isOpen:l,onClickOutside:c,children:L})},(r,e)=>{if(r.isOpen!==e.isOpen||r.sessions.length!==e.sessions.length||r.onRemoveSession!==e.onRemoveSession||r.onClearAllSessions!==e.onClearAllSessions||r.onSessionSelect!==e.onSessionSelect)return!1;const s=r.position,n=e.position;return!(s?.top!==n?.top||s?.left!==n?.left||s?.right!==n?.right)});vu.displayName="SessionDropdown";const ry=({isCompact:r=!1,className:e=""})=>{const[s,n]=u.useState(null),[a,i]=u.useState(!1);if(u.useEffect(()=>{let A;return(async()=>{const{AudioProcessingQueueService:c}=await $e(async()=>{const{AudioProcessingQueueService:g}=await import("./chunks/AudioProcessingQueueService.BquiCdnl.js");return{AudioProcessingQueueService:g}},__vite__mapDeps([11,4,2,1,7,8])),d=c.getInstance(),m=()=>{const g=d.getQueueStats();n(g);const h=g.queuedJobs>0||g.processingJobs>0;i(h)};m(),A=setInterval(m,2e3)})(),()=>{A&&clearInterval(A)}},[]),!a||!s)return null;const o=A=>A<1e3?`${Math.round(A)}ms`:A<6e4?`${Math.round(A/1e3)}s`:`${Math.round(A/6e4)}m`;return r?t.jsxs("div",{className:`inline-flex items-center space-x-2 text-xs text-gray-600 ${e}`,children:[s.processingJobs>0&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Gr,{className:"w-3 h-3 text-blue-500"}),t.jsxs("span",{children:[s.processingJobs," processing"]})]}),s.queuedJobs>0&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Kt,{className:"w-3 h-3 text-amber-500"}),t.jsxs("span",{children:[s.queuedJobs," queued"]})]})]}):t.jsxs("div",{className:`bg-gradient-to-br from-white to-slate-50/50 border border-gray-200 rounded-xl p-3 shadow-sm ${e}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(lo,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Audio Queue"})]}),s.currentConcurrency>0&&t.jsxs("div",{className:"flex items-center space-x-1 text-xs text-green-600",children:[t.jsx(Gr,{className:"w-3 h-3"}),t.jsxs("span",{children:[s.currentConcurrency,"/",s.maxConcurrency]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{className:"space-y-1",children:[s.processingJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Processing"}),t.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[t.jsx(Gr,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:s.processingJobs})]})]}),s.queuedJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Queued"}),t.jsxs("div",{className:"flex items-center space-x-1 text-amber-600",children:[t.jsx(Kt,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:s.queuedJobs})]})]})]}),t.jsxs("div",{className:"space-y-1",children:[s.completedJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Completed"}),t.jsx("span",{className:"font-medium text-green-600",children:s.completedJobs})]}),s.failedJobs>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Failed"}),t.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[t.jsx(Zt,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:s.failedJobs})]})]}),s.averageProcessingTime>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Avg Time"}),t.jsx("span",{className:"font-medium text-gray-900",children:o(s.averageProcessingTime)})]})]})]}),s.processingJobs>0&&t.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-1",children:t.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${s.processingJobs/s.maxConcurrency*100}%`}})}),t.jsxs("span",{className:"text-xs text-gray-500",children:[s.processingJobs,"/",s.maxConcurrency]})]})})]})},wu=u.memo(({stats:r,onClick:e})=>{if(!r)return null;const{usedPercentage:s}=r,n=s>=80,i=s>=90?{icon:"text-red-600",badge:"bg-red-600"}:s>=80?{icon:"text-amber-600",badge:"bg-amber-600"}:{icon:"text-gray-600",badge:"bg-gray-600"};return t.jsxs("button",{onClick:e,className:`
        relative p-1.5 rounded hover:bg-gray-100 transition-colors
        focus:outline-none focus:ring-2 focus:ring-blue-500
      `,"aria-label":`Storage ${s.toFixed(0)}% used. Click to manage storage.`,title:`Storage: ${s.toFixed(0)}% used`,children:[s>=90?t.jsx(ot,{className:`w-4 h-4 ${i.icon}`}):t.jsx(Rn,{className:`w-4 h-4 ${i.icon}`}),n&&t.jsx("span",{className:`
            absolute -top-1 -right-1
            min-w-[18px] h-[18px] px-1
            ${i.badge} text-white
            text-[9px] font-bold
            rounded-full
            flex items-center justify-center
          `,children:s.toFixed(0)})]})});wu.displayName="StorageIconButton";function _l(r,e=2){if(!r)return"Unknown";let s=r.replace(/^Default\s*-\s*/i,"");s=s.replace(/\s+(Microphone|Speaker|Camera|Input|Output)$/i,"");const n=s.trim().split(/\s+/);return n.length<=e?s.trim():n.slice(0,e).join(" ")}function sy(r,e){const s=_l(r),n=_l(e);return`Mic: ${s} ‚Ä¢ Out: ${n}`}const ny=({status:r,isRecording:e=!1,currentAgent:s,modelStatus:n,onRefreshServices:a,patientSessions:i=[],onRemoveSession:o,onClearAllSessions:A,onSessionSelect:l,onResumeRecording:c,selectedSessionId:d,currentSessionId:m,checkedSessionIds:g,onToggleSessionCheck:h,persistedSessionIds:p,storageStats:b,onStorageClick:N})=>{const[y,j]=u.useState(!1),[Q,v]=u.useState(!1),x=u.useRef(null),f=u.useRef(null),{getCurrentMicrophoneLabel:S,getCurrentSpeakerLabel:F,hasPermission:w}=fu(),T=n.whisperServer?.running&&w,C=w?sy(S(),F()):"Audio access required",E=()=>{j(!y),console.log("[SidebarHeader] Device popover toggled",{isOpen:!y,timestamp:Date.now()})},U=()=>{v(!Q)},k=()=>{chrome.runtime.openOptionsPage()},P=i.filter(M=>!g?.has(M.id)).length;return t.jsxs("header",{className:"flex-shrink-0 bg-white border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between h-10 px-2.5",children:[t.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[t.jsx("h1",{className:"text-sm font-semibold text-gray-900 flex-shrink-0",children:"operator"}),t.jsx(hu,{status:r,isRecording:e,micAvailable:T,className:"flex-shrink-0"})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.jsx(ry,{isCompact:!0}),P>0&&t.jsxs("button",{ref:f,onClick:U,className:`
                relative p-1.5 rounded hover:bg-gray-100 transition-colors
                focus:outline-none focus:ring-2 focus:ring-blue-500
              `,"aria-label":`${P} active session${P!==1?"s":""}`,title:"View active sessions",children:[t.jsx(bm,{className:"w-4 h-4 text-gray-600"}),P>0&&t.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white text-[10px] font-bold rounded-full flex items-center justify-center",children:P>9?"9+":P})]}),b&&b.sessionCount>0&&t.jsx(wu,{stats:b,onClick:N}),t.jsx("button",{onClick:k,className:`
              p-1.5 rounded hover:bg-gray-100 transition-colors
              focus:outline-none focus:ring-2 focus:ring-blue-500
            `,"aria-label":"Open settings",title:"Settings",children:t.jsx(Mc,{className:"w-4 h-4 text-gray-600"})})]})]}),w&&t.jsx("div",{className:"px-2.5 pb-2",children:t.jsxs("button",{ref:x,onClick:E,className:`
              w-full flex items-center justify-between gap-2
              px-2 py-1.5 rounded-md text-xs
              text-gray-600 hover:bg-gray-50 hover:text-gray-900
              transition-colors
              focus:outline-none focus:ring-2 focus:ring-blue-500
            `,"aria-label":"Change audio devices","aria-expanded":y,children:[t.jsx("span",{className:"truncate",children:C}),t.jsx(os,{className:`w-3 h-3 flex-shrink-0 transition-transform ${y?"rotate-90":""}`,"aria-hidden":"true"})]})}),t.jsx(Xb,{isOpen:y,onClose:()=>j(!1),triggerRef:x}),Q&&o&&A&&t.jsx(vu,{isOpen:Q,onClose:()=>v(!1),triggerRef:f,sessions:i,onRemoveSession:o,onClearAllSessions:A,onSessionSelect:l,onResumeRecording:c,selectedSessionId:d,activeRecordingSessionId:m,checkedSessionIds:g,onToggleSessionCheck:h,persistedSessionIds:p})]})},ay=({type:r})=>{const e={className:"w-4 h-4 flex-shrink-0"};switch(r){case"success":return t.jsx(yt,{...e,className:"w-4 h-4 text-emerald-600 flex-shrink-0"});case"error":return t.jsx(Zt,{...e,className:"w-4 h-4 text-red-600 flex-shrink-0"});case"warning":return t.jsx(ot,{...e,className:"w-4 h-4 text-amber-600 flex-shrink-0"});case"info":return t.jsx(Vt,{...e,className:"w-4 h-4 text-blue-600 flex-shrink-0"});default:return t.jsx(Vt,{...e})}},iy=({toast:r,onRemove:e})=>{const s=()=>{const n="bg-white border rounded-fluent-sm p-3 shadow-fluent-flyout";switch(r.type){case"success":return`${n} border-emerald-200 bg-emerald-50/95`;case"error":return`${n} border-red-200 bg-red-50/95`;case"warning":return`${n} border-amber-200 bg-amber-50/95`;case"info":return`${n} border-blue-200 bg-blue-50/95`;default:return`${n} border-gray-200 bg-gray-50/95`}};return t.jsx("div",{className:`${s()} animate-in slide-in-from-right-full duration-300`,children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(ay,{type:r.type}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-gray-900 font-semibold text-sm leading-tight",children:r.title}),r.message&&t.jsx("p",{className:"text-gray-700 text-xs mt-1.5 leading-relaxed",children:r.message})]}),t.jsx("button",{onClick:()=>e(r.id),className:"flex-shrink-0 bg-transparent text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 ease-out rounded-md p-1",title:"Dismiss notification","aria-label":"Dismiss notification",children:t.jsx(nt,{className:"w-3.5 h-3.5"})})]})})},oy=()=>{const[r,e]=u.useState([]);u.useEffect(()=>ce.getInstance().subscribe(e),[]);const s=n=>{ce.getInstance().remove(n)};return r.length===0?null:t.jsx("div",{className:"fixed top-4 right-4 z-[99999] space-y-2 w-80 max-w-[calc(100vw-2rem)] pointer-events-none","aria-live":"polite",role:"status",style:{maxWidth:"min(20rem, calc(100vw - 2rem))",position:"fixed",top:"1rem",right:"1rem"},children:r.map(n=>t.jsx("div",{className:"pointer-events-auto",children:t.jsx(iy,{toast:n,onRemove:s})},n.id))})},Ay=({isOpen:r,onClose:e,onStartReview:s,calendarData:n,isExtracting:a=!1,extractError:i})=>{const[o,A]=u.useState(new Set),[l,c]=u.useState("all"),[d,m]=u.useState(!1);if(u.useEffect(()=>{r&&n&&(A(new Set),c("all"))},[r,n]),!r)return null;const g=v=>{const x=new Set(o);x.has(v)?x.delete(v):x.add(v),A(x)},h=()=>{if(!n)return;const v=p(),x=v.every(S=>o.has(S.fileNumber)),f=new Set(o);v.forEach(S=>{x?f.delete(S.fileNumber):f.add(S.fileNumber)}),A(f)},p=()=>n?n.patients.filter(v=>{switch(l){case"confirmed":return v.confirmed;case"new":return v.isFirstAppointment;case"routine":return!v.isFirstAppointment;default:return!0}}):[],b=async()=>{if(!n||o.size===0)return;m(!0);const v=n.patients.filter(x=>o.has(x.fileNumber));try{await s(v)}catch(x){console.error("Failed to start batch review:",x)}finally{m(!1)}},N=v=>{switch(v.toLowerCase()){case"canew":return"bg-blue-100 text-blue-800";case"car20":case"carvi":return"bg-green-100 text-green-800";case"canvi":return"bg-purple-100 text-purple-800";case"phone":return"bg-gray-100 text-gray-800";case"unav":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},y=p(),j=o.size,Q=Math.ceil(j*2.5);return t.jsx(Le,{children:t.jsx(se.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",variants:Ke(Xc),initial:"hidden",animate:"visible",exit:"exit",onClick:e,children:t.jsxs(se.div,{className:"bg-gradient-to-br from-white to-slate-50/50 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden mx-4",variants:Ke(zc),initial:"hidden",animate:"visible",exit:"exit",onClick:v=>v.stopPropagation(),children:[t.jsxs(se.div,{className:"p-6 border-b border-gray-200 bg-gradient-to-br from-purple-50 to-violet-50",variants:Ke(Wa),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(As,{className:"w-6 h-6 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Batch AI Medical Review"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Select patients for sequential AI review and analysis"})]})]}),t.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:d,children:t.jsx(nt,{className:"w-5 h-5 text-gray-500"})})]}),n&&t.jsxs("div",{className:"mt-4 flex items-center space-x-6 text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(_s,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"font-medium",children:n.appointmentDate})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(As,{className:"w-4 h-4 text-purple-600"}),t.jsxs("span",{children:[n.totalCount," total appointments"]})]})]})]}),t.jsx(se.div,{className:"flex-1 overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:a?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(er,{className:"w-8 h-8 text-purple-600 animate-spin mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extracting Patient Data"}),t.jsx("p",{className:"text-gray-600",children:"Reading appointment information from calendar..."})]})}):i?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(ot,{className:"w-8 h-8 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extraction Failed"}),t.jsx("p",{className:"text-red-600 mb-4",children:i}),t.jsx("p",{className:"text-sm text-gray-600",children:"Please ensure you're on the appointment book page and try again."})]})}):!n||n.patients.length===0?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"text-center",children:[t.jsx(As,{className:"w-8 h-8 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Patients Found"}),t.jsx("p",{className:"text-gray-600",children:"No appointments with patient data were found on this calendar page."})]})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(ym,{className:"w-4 h-4 text-gray-500"}),t.jsxs("select",{value:l,onChange:v=>c(v.target.value),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm",disabled:d,children:[t.jsxs("option",{value:"all",children:["All Appointments (",n.patients.length,")"]}),t.jsxs("option",{value:"confirmed",children:["Confirmed Only (",n.patients.filter(v=>v.confirmed).length,")"]}),t.jsxs("option",{value:"new",children:["New Patients (",n.patients.filter(v=>v.isFirstAppointment).length,")"]}),t.jsxs("option",{value:"routine",children:["Return Visits (",n.patients.filter(v=>!v.isFirstAppointment).length,")"]})]})]}),t.jsx("button",{onClick:h,className:"text-sm text-purple-600 hover:text-purple-700 font-medium",disabled:d,children:y.every(v=>o.has(v.fileNumber))?"Deselect All":"Select All"})]})}),t.jsx("div",{className:"overflow-y-auto max-h-96 p-6",children:t.jsx("div",{className:"space-y-3",children:y.map(v=>t.jsx("div",{className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${o.has(v.fileNumber)?"border-purple-300 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>g(v.fileNumber),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("input",{type:"checkbox",checked:o.has(v.fileNumber),onChange:()=>g(v.fileNumber),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500",disabled:d}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:v.name}),v.isFirstAppointment&&t.jsx(vm,{className:"w-4 h-4 text-yellow-500"})]}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mt-1",children:[t.jsxs("span",{children:["DOB: ",v.dob]}),t.jsxs("span",{children:["File: ",v.fileNumber]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Kt,{className:"w-3 h-3"}),t.jsx("span",{children:v.appointmentTime})]})]}),v.notes&&t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:v.notes})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${N(v.appointmentType)}`,children:v.appointmentType}),v.confirmed&&t.jsx(yt,{className:"w-4 h-4 text-green-500"})]})]})},v.fileNumber))})})]})}),n&&n.patients.length>0&&!a&&!i&&t.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:j})," patient",j!==1?"s":""," selected",j>0&&t.jsxs("span",{className:"ml-2",children:["‚Ä¢ Estimated time: ",t.jsxs("span",{className:"font-medium",children:[Q," minutes"]})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:d,children:"Cancel"}),t.jsx("button",{onClick:b,disabled:j===0||d,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:d?t.jsxs(t.Fragment,{children:[t.jsx(er,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:"Starting..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(zo,{className:"w-4 h-4"}),t.jsx("span",{children:"Start AI Review"})]})})]})]})})]})})})},ly=({onGenerate:r,isGenerating:e,isVisible:s,onClose:n,emrExtractionError:a,onRetryExtraction:i,pipelineProgress:o,processingStartTime:A})=>{const[l,c]=u.useState("medium"),[d,m]=u.useState(["diet_nutrition","physical_activity"]),[g,h]=u.useState({}),[p,b]=u.useState(""),[N,y]=u.useState(!1),[j,Q]=u.useState(null),[v,x]=u.useState(null),[f,S]=u.useState(!1);u.useEffect(()=>{s&&(async()=>{if(!(v||f)){S(!0);try{const{PatientEducationAgent:M}=await $e(async()=>{const{PatientEducationAgent:$}=await import("./chunks/PatientEducationAgent.gMUdXJ8T.js");return{PatientEducationAgent:$}},__vite__mapDeps([12,7,8,4,2,1,13]));x({getPriorityOptions:M.getPriorityOptions.bind(M),getAvailableModules:M.getAvailableModules.bind(M)})}catch(M){console.error("Failed to load PatientEducationAgent:",M)}finally{S(!1)}}})()},[s,v,f]);const F=v?.getPriorityOptions()||[],w=v?.getAvailableModules()||[],T=u.useCallback(P=>{m(M=>M.includes(P)?(h($=>{const W={...$};return delete W[P],W}),M.filter($=>$!==P)):[...M,P])},[]),C=u.useCallback((P,M)=>{h($=>{const W=$[P]||[];if(W.includes(M)){const V=W.filter(L=>L!==M);if(V.length===0){const L={...$};return delete L[P],L}return{...$,[P]:V}}else return{...$,[P]:[...W,M]}})},[]),E=u.useCallback(async()=>{if(d.length!==0){y(!0);try{const P=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),M=await chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA",fields:["background","medications","investigations"]}),$={demographics:"",background:M?.background||"",medications:M?.medications||"",investigations:M?.investigations||""},W=P?.success&&P?.data?P.data:null;console.log("üéì Extracted patient data:",W),console.log("üéì Extracted EMR data for Patient Education:",$),Q($);const V={patientPriority:l,selectedModules:d,selectedSubFocus:Object.keys(g).length>0?g:void 0,emrData:$,patientData:W,patientContext:p.trim()||void 0};await r(V)}catch(P){console.warn("‚ö†Ô∏è EMR extraction failed, proceeding with user context only:",P);const M={demographics:"",background:"",medications:"",investigations:""},$={patientPriority:l,selectedModules:d,selectedSubFocus:Object.keys(g).length>0?g:void 0,emrData:M,patientData:null,patientContext:p.trim()||void 0};await r($)}finally{y(!1)}}},[l,d,g,p,r]),U=u.useCallback(async()=>{if(i){y(!0);try{await i()}finally{y(!1)}}},[i]);if(!s)return null;if(f||!v)return t.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(jn,{className:"w-4 h-4"}),t.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),t.jsx("button",{onClick:n,className:"text-emerald-100 hover:text-white transition-colors",children:t.jsx(nt,{className:"w-4 h-4"})})]})}),t.jsx("div",{className:"p-8 flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Sn,{className:"w-5 h-5 animate-spin text-emerald-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading education modules..."})]})})]});const k=P=>{const M=d.includes(P.id),$=g[P.id]||[];return t.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-start space-x-3 p-3 hover:border-blue-300 transition-colors",children:[t.jsx("button",{onClick:()=>T(P.id),className:"flex-shrink-0 mt-0.5",disabled:e||N,children:M?t.jsx(Va,{className:"w-5 h-5 text-blue-600"}):t.jsx(Ks,{className:"w-5 h-5 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`font-medium text-sm ${M?"text-blue-900":"text-gray-700"}`,children:P.label}),t.jsxs("div",{className:"group relative inline-block",title:P.tooltip,children:[t.jsx(Vt,{className:"w-4 h-4 text-gray-400 hover:text-blue-600 cursor-help"}),t.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:P.tooltip})]})]}),t.jsx("p",{className:"text-xs text-gray-600 mt-1",children:P.description})]})]}),M&&P.subFocusPoints&&P.subFocusPoints.length>0&&t.jsxs("div",{className:"border-t border-gray-100 bg-gray-50 p-3 space-y-2",children:[t.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Focus on specific areas (optional):"}),P.subFocusPoints.map(W=>{const V=$.includes(W.id);return t.jsxs("div",{className:"flex items-start space-x-2 ml-2",children:[t.jsx("button",{onClick:()=>C(P.id,W.id),className:"flex-shrink-0 mt-0.5",disabled:e||N,children:V?t.jsx(Va,{className:"w-4 h-4 text-emerald-600"}):t.jsx(Ks,{className:"w-4 h-4 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("span",{className:`text-xs ${V?"text-emerald-800 font-medium":"text-gray-600"}`,children:W.label}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:W.description})]})]},W.id)})]})]},P.id)};return t.jsx("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:t.jsxs("div",{className:"bg-white w-full overflow-hidden rounded-xl",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(jn,{className:"w-4 h-4"}),t.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),t.jsx("button",{onClick:n,className:"text-emerald-100 hover:text-white transition-colors",disabled:e||N,children:t.jsx(nt,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"p-4 overflow-y-auto max-h-full",children:[a&&t.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Zt,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"EMR Extraction Issue"}),t.jsx("p",{className:"text-xs text-amber-700 mt-1",children:a}),i&&t.jsx("button",{onClick:U,disabled:N,className:"mt-2 px-3 py-1 bg-amber-100 hover:bg-amber-200 text-amber-800 text-xs rounded-md font-medium transition-colors disabled:opacity-50",children:N?t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(Sn,{className:"w-3 h-3 animate-spin"}),t.jsx("span",{children:"Retrying..."})]}):t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(Jt,{className:"w-3 h-3"}),t.jsx("span",{children:"Retry Extraction"})]})})]})]})}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Priority Level"}),t.jsx("div",{className:"space-y-2",children:F.map(P=>t.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"priority",value:P.value,checked:l===P.value,onChange:M=>c(M.target.value),className:"mt-1 text-emerald-600 focus:ring-emerald-500",disabled:e||N}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:P.label}),t.jsx("p",{className:"text-xs text-gray-600",children:P.description})]})]},P.value))})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Specific Priorities & Goals"}),t.jsx("textarea",{value:p,onChange:P=>b(P.target.value),placeholder:"Enter specific patient priorities and goals (e.g., lose weight, stop smoking, improve fitness, reduce blood pressure, manage diabetes)...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none text-sm",rows:3,disabled:e||N}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Optional: Describe what's most important for this patient to help personalize the lifestyle advice."})]}),j&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Extracted Patient Information"}),t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-2",children:[j.background&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Background:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:j.background})]}),j.medications&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Medications:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:j.medications})]}),j.investigations&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Recent Investigations:"}),t.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:j.investigations})]}),!j.background&&!j.medications&&!j.investigations&&t.jsx("p",{className:"text-xs text-gray-500 italic",children:"No patient data found in EMR fields"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This information will be used to personalize the lifestyle advice."})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Select Lifestyle Areas (Choose at least 1)"}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:w.map(k)}),d.length===0&&t.jsx("p",{className:"text-xs text-red-600 mt-2",children:"Please select at least one lifestyle area"})]}),t.jsx("div",{className:"mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Vt,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-xs text-blue-800",children:[t.jsx("p",{className:"font-medium",children:"Education Only"}),t.jsx("p",{className:"mt-1",children:"This tool provides lifestyle education and general wellness advice only. It does not diagnose conditions or recommend medication changes."})]})]})}),t.jsx("div",{className:"flex justify-end border-t border-gray-200 pt-4 mt-6",children:t.jsx("button",{onClick:E,disabled:e||N||d.length===0,className:"px-8 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 shadow-lg",children:e||N?t.jsxs(t.Fragment,{children:[t.jsx(Sn,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:"Generating Advice..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(jn,{className:"w-4 h-4"}),t.jsx("span",{children:"Generate Lifestyle Advice"})]})})}),(e||N)&&o&&t.jsx("div",{className:"mt-4",children:t.jsx(Ho,{progress:o,startTime:A||void 0,agentType:"patient-education",showTimeEstimate:!0})}),(e||N)&&!o&&t.jsxs("div",{className:"mt-4 text-center",children:[t.jsx("div",{className:"text-xs text-gray-600",children:"Generating personalized lifestyle advice..."}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:t.jsx("div",{className:"bg-emerald-600 h-2 rounded-full animate-pulse",style:{width:"60%"}})})]})]})]})})},cy={tavi:"TAVI Workup","tavi-workup":"TAVI Workup","angiogram-pci":"Angiogram/PCI Report","quick-letter":"Quick Letter",consultation:"Consultation Report","investigation-summary":"Investigation Summary",background:"Background Summary",medication:"Medication Review",bloods:"Blood Results",imaging:"Imaging Review","patient-education":"Patient Education","batch-ai-review":"Batch AI Review","ai-medical-review":"AI Medical Review","aus-medical-review":"Australian Medical Review",mteer:"MitraClip/TEER",tteer:"TEER","pfo-closure":"PFO Closure","asd-closure":"ASD Closure","pvl-plug":"PVL Plug","bypass-graft":"Bypass Graft","right-heart-cath":"Right Heart Catheterization","pre-op-plan":"Pre-Op Plan","ohif-viewer":"OHIF Viewer",enhancement:"Enhancement",transcription:"Transcription",generation:"Generation"},dy=(r,e)=>{if(e)return{icon:t.jsx(Rt,{className:"w-4 h-4"}),label:"Recording",bgColor:"bg-gradient-to-r from-red-500 to-rose-600",textColor:"text-white",dotColor:"bg-red-400"};switch(r){case"transcribing":return{icon:t.jsx(er,{className:"w-4 h-4 animate-spin"}),label:"Transcribing",bgColor:"bg-gradient-to-r from-blue-500 to-cyan-600",textColor:"text-white",dotColor:"bg-blue-400"};case"processing":return{icon:t.jsx(Gr,{className:"w-4 h-4"}),label:"AI Processing",bgColor:"bg-gradient-to-r from-purple-500 to-violet-600",textColor:"text-white",dotColor:"bg-purple-400"};case"complete":return{icon:t.jsx(yt,{className:"w-4 h-4"}),label:"Complete",bgColor:"bg-gradient-to-r from-emerald-500 to-teal-600",textColor:"text-white",dotColor:"bg-emerald-400"};default:return{icon:t.jsx(Et,{className:"w-4 h-4"}),label:"Ready",bgColor:"bg-gradient-to-r from-blue-500 to-cyan-600",textColor:"text-white",dotColor:"bg-blue-400"}}},Bu=u.memo(({patientInfo:r,agentType:e,processingStatus:s,isRecording:n=!1})=>{const a=dy(s,n),i=cy[e]||e,o=l=>{if(!l)return"";try{const c=new Date(l),d=new Date;let m=d.getFullYear()-c.getFullYear();const g=d.getMonth()-c.getMonth();return(g<0||g===0&&d.getDate()<c.getDate())&&m--,`${m}y`}catch{return""}},A=r.age||o(r.dob);return t.jsx("div",{className:`${a.bgColor} ${a.textColor} px-4 py-3 shadow-sm`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx(Ai,{className:"w-5 h-5 flex-shrink-0 opacity-90"}),t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("div",{className:"font-semibold text-base truncate",children:r.name}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm opacity-90",children:[t.jsxs("span",{className:"truncate",children:["ID: ",r.id]}),r.dob&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{className:"truncate",children:["DOB: ",r.dob]})]}),A&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:A})]})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[t.jsxs("div",{className:"hidden sm:flex items-center space-x-2 bg-white/20 backdrop-blur-sm px-3 py-1.5 rounded-full",children:[t.jsx(Et,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:i})]}),t.jsxs("div",{className:"flex items-center space-x-2 bg-white/30 backdrop-blur-sm px-3 py-1.5 rounded-full",children:[(n||s==="transcribing"||s==="processing")&&t.jsx("div",{className:"relative",children:t.jsx("div",{className:`w-2 h-2 rounded-full ${a.dotColor} animate-pulse`})}),a.icon,t.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:a.label})]})]})]})})});Bu.displayName="PatientContextHeader";const Cu=[{id:"tavi",title:"TAVI Procedure Recording",description:"Transcatheter Aortic Valve Implantation - Comprehensive procedural documentation",estimatedTime:"8-12 minutes",sections:[{title:"Preamble Information",icon:"üìã",items:["Patient demographics and clinical indication",'Preoperative CT findings: "suitable anatomy for valve implant"',"Valve morphology: tricuspid/bicuspid, calcification burden","Calcium score and LVOT assessment","Transthoracic echo: mean gradient, systolic function","Valve selection rationale with sizing logic"]},{title:"Procedural Details",icon:"‚öïÔ∏è",items:["Anaesthesia approach: local anaesthesia and deep sedation","Vascular access: radial planning, femoral with ultrasound guidance","Pre-closure technique: ProStyle sutures or equivalent","Sheath sizes: specific French sizes (e.g., 16F Cook sheath)","Valve crossing: AL1, straight wire, invasive gradient, LVEDP","Lunderquist wire placement at left ventricular apex","Pre-dilation: balloon size and technique","Valve deployment: positioning at annular plane","Immediate assessment: aortic regurgitation, coronary patency"]},{title:"Outcomes & Assessment",icon:"‚úÖ",items:["Valve deployment success and positioning","Final aortic regurgitation grade","Post-procedural echo findings","Arteriotomy closure method and success","Overall procedural success statement","Immediate post-procedural valve performance"]}],tips:["Use Australian spelling: anaesthesia, recognised, utilised","Include precise measurements with units (mmHg, cm¬≤, French sizes)","Preserve original stenosis terminology (mild/moderate/severe)","Document valve manufacturer and model specifically"],terminology:["Edwards Sapien 3 Ultra/Medtronic Evolut series","Annular perimeter and area, LVOT calcium burden","Well-seated valve, patent coronaries","Partial recaptures for optimal positioning"]},{id:"angiogram-pci",title:"Angiogram/PCI Recording",description:"Cardiac catheterization and coronary interventions - Diagnostic and interventional procedures",estimatedTime:"8-15 minutes",sections:[{title:"Vessel Assessment",icon:"ü´Ä",items:["Left Main coronary artery findings","LAD: proximal, mid, distal segments and diagonal branches","Circumflex: segments and obtuse marginal branches","RCA: segments including dominance pattern","Coronary dominance (right/left/co-dominant)","Collateral circulation if present"]},{title:"Procedural Information",icon:"üîß",items:["Vascular access site and approach","Catheter selection and sizes","Target lesion characteristics and location","Intervention strategy and rationale","Device specifications: stent type, manufacturer, size","Balloon pre-dilation details","Deployment technique and positioning"]},{title:"Results & Outcomes",icon:"üìä",items:["TIMI flow assessment (pre and post)","Final angiographic result","Residual stenosis percentage","Procedural complications if any","Hemodynamic measurements","Antiplatelet therapy plan"]}],tips:["Preserve stenosis grading as stated by clinician","Use descriptive TIMI flow language","Include specific device details when mentioned","Document both diagnostic and intervention aspects"],terminology:["Drug-eluting stent (DES), bare metal stent (BMS)","TIMI III flow, complete perfusion","Proximal/mid/distal vessel segments","Optimal angiographic result"]},{id:"quick-letter",title:"Quick Letter Recording",description:"Medical correspondence and consultation letters - Professional communication",estimatedTime:"1-3 minutes",sections:[{title:"Patient Presentation",icon:"üë§",items:["Clinical presentation and chief complaint","Relevant history and context","Current symptoms and functional status","Reason for referral or consultation","Timeline of events"]},{title:"Clinical Assessment",icon:"üîç",items:["Investigation findings and interpretation","Clinical examination relevant findings","Diagnostic considerations","Risk stratification if applicable"]},{title:"Management Plan",icon:"üìù",items:["Treatment recommendations","Medication changes or additions","Follow-up arrangements","Specialist referrals if needed","Patient education provided"]}],tips:['Use first-person voice: "I reviewed", "I examined"',"Keep paragraphs flowing and professional","Include specific timeframes and measurements","Use Australian spelling and medical terminology"],terminology:["Clinical assessment, management plan","Follow-up arrangements, specialist review","Patient education, shared decision-making","Routine/semi-urgent/urgent referral"]},{id:"tavi-workup",title:"TAVI Workup Dictation",description:"Single-pass dictation covering the clinical, echocardiographic, and CT sizing inputs for TAVI planning",estimatedTime:"3-5 minutes",sections:[{title:"Patient Basics",icon:"üßç",items:["State the patient name and date of birth clearly","Latest height in centimetres and weight in kilograms","Note any symptomatic change prompting assessment"]},{title:"Risk Profile",icon:"‚öïÔ∏è",items:["Indication for TAVI workup","NYHA functional class (I-IV only)","STS and EuroSCORE II percentages"]},{title:"Echocardiography Highlights",icon:"ü©ª",items:["Echo study date and ejection fraction","Septal thickness and mean pressure gradient","Aortic valve area, dimensionless index, MR grade, RVSP","Key qualitative comments"]},{title:"CT Sizing",icon:"üß†",items:["Annulus area, perimeter, minimum and maximum diameters","Left main and right coronary heights","Sinus of Valsalva diameters for each cusp",'Coplanar acquisition angles (e.g., "LAO 12 cranial 6")',"Access vessel minimal diameters (CIA, EIA, CFA) with laterality"]},{title:"Device Planning",icon:"üõ†Ô∏è",items:["Intended valve platform (Sapien, Evolut, Navitor)","Planned valve size and rationale","Any anatomical cautions (coronary height, annular calcification, access limitations)"]}],tips:['Say "percent" after risk scores to avoid misinterpretation',"Use centimetres when dictating distances so the system can convert to millimetres","Work systematically: patient basics -> risk -> echo -> CT -> access/device"],terminology:["Annulus area/perimeter","Dimensionless index (DVI)","Sinus of Valsalva","Common/external iliac, common femoral","Coplanar LAO/RAO cranial/caudal angles"]},{id:"consultation",title:"Consultation Recording",description:"Comprehensive patient assessments - Detailed clinical evaluation",estimatedTime:"2-4 minutes",sections:[{title:"Clinical History",icon:"üìö",items:["Presenting complaint and history","Past medical history and comorbidities","Current medications and allergies","Family history if relevant","Social history and functional status"]},{title:"Examination & Investigations",icon:"üî¨",items:["Physical examination findings","Vital signs and measurements","Investigation results and interpretation","Imaging findings if applicable","Laboratory results correlation"]},{title:"Assessment & Plan",icon:"üéØ",items:["Clinical impression and differential diagnosis","Risk assessment and stratification","Management strategy and rationale","Investigation plan if needed","Follow-up and monitoring plan"]}],tips:["Capture comprehensive clinical reasoning","Include functional assessment (NYHA class, etc.)","Document shared decision-making process","Note patient understanding and concerns"],terminology:["Clinical impression, differential diagnosis","Risk stratification, management strategy","Functional class, symptom assessment","Patient-centred care, shared decisions"]},{id:"mteer",title:"mTEER Procedure Recording",description:"Mitral transcatheter edge-to-edge repair - Structural heart intervention",estimatedTime:"7-10 minutes",sections:[{title:"Pre-procedural Assessment",icon:"üîç",items:["Mitral regurgitation severity and mechanism","Valve anatomy and morphology","TOE assessment and measurements","Procedural planning and approach","Patient selection criteria"]},{title:"Procedural Technique",icon:"‚öôÔ∏è",items:["Transseptal puncture technique","Device delivery and positioning","Clip deployment and assessment","TOE guidance throughout procedure","Immediate haemodynamic changes"]},{title:"Results & Follow-up",icon:"üìà",items:["Final mitral regurgitation grade","Mitral valve gradient assessment","Procedural success metrics","Complications if any","Post-procedural monitoring plan including TTE next day"]}],tips:["Document TOE guidance detail","Include specific device information","Note immediate haemodynamic improvement","Record precise regurgitation grading"],terminology:["Edge-to-edge repair, MitraClip device","Functional vs degenerative MR","TOE guidance, transseptal puncture","Immediate haemodynamic improvement"]},{id:"pfo-closure",title:"PFO Closure Recording",description:"Patent foramen ovale closure - Structural heart intervention",estimatedTime:"5-8 minutes",sections:[{title:"Pre-procedural Assessment",icon:"üîé",items:["PFO anatomy and tunnel length","Shunt assessment and grading","Device selection rationale","Imaging findings (TOE/ICE)","Clinical indication for closure"]},{title:"Deployment Technique",icon:"üéØ",items:["Device delivery and positioning","Deployment sequence and technique","Position confirmation","Immediate closure assessment","Device stability evaluation"]},{title:"Procedural Outcome",icon:"‚ú®",items:["Successful device deployment","Residual shunt assessment","Device position and stability","Procedural complications if any","Post-procedural monitoring requirements"]}],tips:["Document device sizing rationale","Include immediate closure success","Note any residual shunt","Record device stability assessment"],terminology:["Patent foramen ovale, atrial septal anatomy","Device deployment, positioning confirmation","Residual shunt, complete closure","TOE/ICE guidance, device stability"]},{id:"right-heart-cath",title:"Right Heart Catheterisation",description:"Right heart catheterisation with haemodynamic assessment",estimatedTime:"6-10 minutes",sections:[{title:"Patient Data (REQUIRED for calculations)",icon:"üë§",items:["Height (cm) and Weight (kg)","Heart rate (bpm) and rhythm","Systemic blood pressure (mmHg)","Haemoglobin (g/L) and Lactate (mmol/L)","Arterial oxygen saturation (%)"]},{title:"Haemodynamic Pressures",icon:"üìä",items:["Right atrial pressure (a/v/mean mmHg)","Right ventricular pressures (systolic/diastolic mmHg)","RVEDP (mmHg)","Pulmonary artery (systolic/diastolic/mean mmHg)","PCWP (a/v/mean mmHg)","Cardiac output (L/min) & index (L/min/m¬≤)","Mixed venous O‚ÇÇ saturation (%)"]},{title:"Technical Details",icon:"üîß",items:["Vascular access approach (basilic/jugular/femoral)","Catheter type and size (e.g., 7F Swan-Ganz)","Fluoroscopy time (minutes)","Fluoroscopy dose (mGy)","DAP (dose area product, Gy¬∑cm¬≤)","Contrast volume (mL) if used","Thermodilution or Fick method","Complications if any"]},{title:"Clinical Interpretation",icon:"üìã",items:["Haemodynamic interpretation","Pulmonary hypertension assessment","Heart failure classification","Treatment implications","Follow-up recommendations"]}],tips:["MUST dictate: Height, Weight, HR, BP for auto-calculations","TPG, DPG, PVR are AUTO-CALCULATED - no need to dictate","Include precise pressure measurements with units","Dictate fluoroscopy dose/time/DAP for radiation safety","Note contrast volume for nephrotoxicity assessment","Correlate with clinical presentation"],terminology:["Pulmonary vascular resistance, cardiac index","Thermodilution, Fick equation","Pulmonary hypertension, right heart failure","Haemodynamic profile, pressure gradients","BSA, TPG, DPG, PVR (auto-calculated from raw values)"]},{id:"investigation-summary",title:"Investigation Summary Recording",description:"Formatting voice-dictated investigation results into structured summaries",estimatedTime:"30-60 seconds",sections:[{title:"Test Information",icon:"üî¨",items:["Investigation type (TTE, CTCA, Bloods, etc.)","Date of investigation (DD MMM YYYY format)","Location/institution if relevant","Test methodology or approach if specified"]},{title:"Key Findings",icon:"üìã",items:["Primary findings and measurements","Normal and abnormal values with units","Qualitative descriptions (mild/moderate/severe)","Relevant anatomical observations","Clinical significance if stated"]},{title:"Measurements & Values",icon:"üìè",items:["Exact numerical values with units","Reference ranges when mentioned","Percentage values (e.g., EF 55%)","Pressure measurements (mmHg)","Laboratory values with proper abbreviations"]}],tips:["Use standard medical abbreviations (TChol, LDL, HDL, etc.)","Include units with all measurements","Preserve qualitative terms exactly as stated","Format as: TEST (date): comma-separated findings"],terminology:["TTE, TOE, CTCA, CMRI, RHC, Bloods","TChol, TG, HDL, LDL, HbA1c, Cr, eGFR","EF%, MPG, PPG, RVSP, TIMI flow","Normal, mild, moderate, severe"]},{id:"background",title:"Background & History Recording",description:"Patient medical background, history, and contextual information",estimatedTime:"1-2 minutes",sections:[{title:"Medical History",icon:"üè•",items:["Past medical conditions and diagnoses","Previous cardiovascular events or procedures","Chronic conditions and comorbidities","Surgical history relevant to current care","Hospital admissions and major events"]},{title:"Family & Social History",icon:"üë•",items:["Family history of cardiovascular disease","Hereditary conditions or risk factors","Social circumstances affecting care","Functional status and mobility","Support systems and care arrangements"]},{title:"Risk Factors",icon:"‚ö†Ô∏è",items:["Smoking history (current/former/never)","Alcohol consumption patterns","Exercise tolerance and activity levels","Occupational or environmental exposures","Lifestyle factors affecting health"]}],tips:["Use chronological order for medical events","Include dates and timeframes when mentioned","Note functional impact of conditions","Use arrow notation (‚Üí) for progression or outcomes"],terminology:["CAD, MI, CABG, PCI, valve disease","DM, HTN, dyslipidaemia, CKD","NYHA class, functional capacity","Family Hx, social circumstances"]},{id:"medication",title:"Medication Recording",description:"Current medications, changes, and pharmaceutical management",estimatedTime:"1-2 minutes",sections:[{title:"Current Medications",icon:"üíä",items:["Drug name (generic preferred)","Dosage and strength","Frequency and timing","Route of administration","Duration of therapy if specified"]},{title:"Recent Changes",icon:"üîÑ",items:["New medications started","Dose adjustments made","Medications discontinued","Reason for changes","Timing of modifications"]},{title:"Compliance & Effects",icon:"‚úÖ",items:["Adherence to current regimen","Side effects experienced","Therapeutic response noted","Patient understanding and concerns","Monitoring requirements"]}],tips:["Use generic drug names when possible","Include exact dosages with units (mg, mcg)","Note timing (morning, evening, with meals)","Document reasons for any changes"],terminology:["ACE inhibitor, ARB, beta-blocker, statin","BD, TDS, QID, PRN, with meals","mg, mcg, g, units, mL","Commenced, ceased, increased, decreased"]},{id:"pre-op-plan",title:"Pre-Op Plan Recording",description:"Pre-procedure planning card for cath lab staff - Select procedure type first",estimatedTime:"1-3 minutes",sections:[{title:"ANGIOGRAM/PCI Checklist",icon:"ü©∫",items:['‚úÖ Procedure type & indication (e.g., "Angiogram for NSTEMI")',"‚úÖ Primary access site (radial/femoral)","‚úÖ Sheath size (Fr)","‚úÖ Catheters planned (e.g., JL3.5, JR4)","‚úÖ Allergies/precautions (iodine, latex)","‚úÖ Antiplatelet plan (continue/hold)","‚≠ï Sedation level (light/moderate)","‚≠ï Site prep (which sites + antiseptic)","‚≠ï Recent labs (Hb, creatinine)","‚≠ï Planned follow-up (timing, location)","‚úÖ Next-of-kin (name, relationship, phone)"]},{title:"RIGHT HEART CATH Checklist",icon:"ü©∫",items:["‚úÖ Procedure type & indication","‚úÖ Access site (basilic/jugular/femoral)","‚úÖ Sheath size (Fr)","‚úÖ Catheters planned (Swan-Ganz, etc.)","‚úÖ CO measurement (Yes/No, method)","‚úÖ Blood gas samples (count)","‚≠ï Sedation plan","‚≠ï Anticoagulation plan","‚≠ï Site prep details","‚≠ï Recent labs","‚≠ï Planned follow-up (timing, location)","‚úÖ Next-of-kin (name, relationship, phone)"]},{title:"TAVI Checklist",icon:"ü´Ä",items:["‚úÖ Indication (e.g., severe AS)","‚úÖ Primary access (femoral/other)","‚úÖ Secondary access","‚úÖ Valve type & size (Sapien/Evolut, mm)","‚úÖ Wire (Safari/Confida/Lunderquist)","‚úÖ Balloon size (mm, if planned)","‚úÖ Pacing wire access","‚úÖ Closure device plan (ProStyle/Angio-Seal)","‚úÖ Protamine plan (yes/no, contraindications)","‚úÖ Goals of care (theatre status, gradient)","‚≠ï Sedation plan","‚≠ï Site prep (both femorals + antiseptic)","‚≠ï Allergies","‚≠ï Recent labs","‚≠ï Planned follow-up (timing, location)","‚úÖ Next-of-kin"]},{title:"MITRAL TEER Checklist",icon:"ü´Ä",items:["‚úÖ Indication (MR severity)","‚úÖ Access site (femoral venous)","‚úÖ Transeptal catheter(s)","‚úÖ Wire (super-stiff for guide)","‚úÖ Closure device plan (usually 2√ó ProStyle)","‚úÖ Echo findings (key summary)","‚≠ï Device type (NTW/XT)","‚≠ï Sedation plan","‚≠ï Anticoagulation plan","‚≠ï Site prep","‚≠ï Allergies","‚≠ï Recent labs","‚≠ï Planned follow-up (timing, location)","‚úÖ Next-of-kin"]}],tips:["Start by stating the procedure type clearly","‚úÖ = REQUIRED field (must include)","‚≠ï = OPTIONAL field (include if mentioned)",'Keep Next-of-Kin format: "Name (relationship) phone"',"For TAVI: Always include Protamine plan and goals","For Angio/RHC: DO NOT mention Protamine or pacing wires"],terminology:["Access: radial, femoral, basilic, jugular","Antiseptics: chlorhexidine, betadine","TAVI valves: Sapien 3 Ultra, Evolut R/Pro","Wires: Safari, Confida, Lunderquist","Closure: ProStyle, Angio-Seal, Perclose","Sedation: light, moderate, GA","Labs: Hb g/L, Creatinine ¬µmol/L"]}];function uy(r){return Cu.find(e=>e.id===r)}function my(r){return Cu.some(e=>e.id===r)}const py=Fe.memo(({agentType:r,isVisible:e,onClose:s,onStartRecording:n,compactMode:a=!1})=>{const[i,o]=u.useState({}),A=uy(r);Math.random()<.001&&console.log("üìã Recording prompt shown for:",r);const l=u.useCallback(d=>{o(m=>({...m,[d]:!m[d]}))},[]);if(u.useCallback(()=>{n?.(),s?.()},[n,s]),!e||!A)return null;const c=(d,m)=>{const g=i[d.title]??(a?!1:m===0);return t.jsxs("div",{className:`border border-gray-200 rounded-xl overflow-hidden ${a?"mb-2":"mb-3"}`,children:[t.jsxs("button",{onClick:()=>l(d.title),className:`w-full bg-gray-50 hover:bg-gray-100 flex items-center justify-between text-left transition-colors ${a?"px-3 py-2":"px-4 py-3"}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:a?"text-sm":"text-lg",children:d.icon}),t.jsx("span",{className:`font-semibold text-gray-800 ${a?"text-xs":"text-sm"}`,children:d.title})]}),g?t.jsx(Dt,{className:`text-gray-500 ${a?"w-3 h-3":"w-4 h-4"}`}):t.jsx(os,{className:`text-gray-500 ${a?"w-3 h-3":"w-4 h-4"}`})]}),g&&t.jsx("div",{className:`bg-white ${a?"px-3 py-2":"px-4 py-3"}`,children:t.jsx("ul",{className:a?"space-y-1":"space-y-2",children:d.items.map((h,p)=>t.jsxs("li",{className:`flex items-start space-x-2 text-gray-700 ${a?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-blue-500 rounded-full mt-2 flex-shrink-0 ${a?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{children:h})]},p))})})]},d.title)};return t.jsx("div",{className:`w-full bg-gradient-to-br from-white to-slate-50/50 border border-gray-200 ${a?"rounded-xl shadow-md":"max-w-none mx-2 rounded-xl shadow-lg mb-4"}`,children:t.jsxs("div",{className:`bg-gradient-to-br from-white to-slate-50/50 w-full overflow-hidden ${a?"rounded-xl max-h-[40vh]":"rounded-xl max-h-[70vh]"}`,children:[t.jsx("div",{className:`bg-gradient-to-r from-red-500 to-rose-600 text-white ${a?"px-3 py-2":"px-4 py-3"}`,children:t.jsxs("div",{className:"flex items-center space-x-2",children:[!a&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-300 rounded-full animate-pulse"}),t.jsx("span",{className:"text-sm font-semibold",children:"RECORDING"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Pn,{className:a?"w-3 h-3":"w-4 h-4"}),t.jsx("span",{className:`font-medium ${a?"text-xs":"text-sm"}`,children:a?A.title.replace(" Recording",""):`Recording Guide: ${A.title.replace(" Recording","")}`})]})]})}),t.jsxs("div",{className:`overflow-y-auto ${a?"p-3 max-h-[35vh]":"p-4 max-h-[60vh]"}`,children:[!a&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 rounded-lg border border-red-200",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(wm,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),t.jsx("div",{children:t.jsx("p",{className:"text-red-700 text-sm font-medium",children:"Include these key elements while recording to ensure a comprehensive medical report:"})})]})}),t.jsxs("div",{className:a?"mb-3":"mb-6",children:[!a&&t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center space-x-2",children:[t.jsx(Pn,{className:"w-4 h-4"}),t.jsx("span",{children:"What to Include"})]}),A.sections.map(c)]}),A.tips.length>0&&t.jsxs("div",{className:a?"mb-3":"mb-6",children:[t.jsxs("h3",{className:`font-semibold text-gray-800 ${a?"mb-2 text-sm":"mb-3"}`,children:["üí° ",a?"Tips":"Recording Tips"]}),t.jsx("div",{className:`bg-yellow-50 border border-yellow-200 rounded-lg ${a?"p-2":"p-4"}`,children:t.jsx("ul",{className:a?"space-y-1":"space-y-2",children:A.tips.map((d,m)=>t.jsxs("li",{className:`flex items-start space-x-2 text-yellow-800 ${a?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-yellow-500 rounded-full mt-2 flex-shrink-0 ${a?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{children:d})]},m))})})]}),A.terminology.length>0&&t.jsxs("div",{className:a?"mb-2":"mb-6",children:[t.jsxs("h3",{className:`font-semibold text-gray-800 ${a?"mb-2 text-sm":"mb-3"}`,children:["üìö ",a?"Terms":"Key Terminology"]}),t.jsx("div",{className:`bg-green-50 border border-green-200 rounded-lg ${a?"p-2":"p-4"}`,children:t.jsx("div",{className:`grid gap-2 ${a?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:A.terminology.map((d,m)=>t.jsxs("div",{className:`flex items-center space-x-2 text-green-800 ${a?"text-xs":"text-sm"}`,children:[t.jsx("div",{className:`bg-green-500 rounded-full flex-shrink-0 ${a?"w-1 h-1":"w-1.5 h-1.5"}`}),t.jsx("span",{className:"font-medium",children:d})]},m))})})]})]})]})})}),gy=({isOpen:r,onClose:e})=>{const[s,n]=u.useState(null),[a,i]=u.useState([]),[o,A]=u.useState(!0);u.useEffect(()=>{r&&l()},[r]);const l=async()=>{A(!0);try{const p=En.getInstance(),[b,N]=await Promise.all([p.getAnalytics(),p.getAllMetrics()]);n(b),i(N.slice(0,10))}catch(p){console.error("Failed to load metrics:",p)}finally{A(!1)}},c=async()=>{confirm("Are you sure you want to clear all performance metrics? This cannot be undone.")&&(await En.getInstance().clearAllMetrics(),await l())},d=async()=>{try{const b=await En.getInstance().exportMetrics(),N=new Blob([b],{type:"application/json"}),y=URL.createObjectURL(N),j=document.createElement("a");j.href=y,j.download=`xestro-metrics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(y)}catch(p){console.error("Failed to export metrics:",p)}},m=p=>{if(p<1e3)return`${p}ms`;if(p<6e4)return`${(p/1e3).toFixed(1)}s`;const b=Math.floor(p/6e4),N=Math.floor(p%6e4/1e3);return`${b}m ${N}s`},g=p=>({tavi:"‚ù§Ô∏è","angiogram-pci":"ü´Ä",mteer:"üîß",tteer:"ü´Ä","pfo-closure":"üè•","asd-closure":"üè•","pvl-plug":"üîå","bypass-graft":"üõ§Ô∏è","right-heart-cath":"üìä","tavi-workup":"üîç","quick-letter":"üìù",consultation:"üë®‚Äç‚öïÔ∏è","investigation-summary":"üîç","ai-medical-review":"üõ°Ô∏è","batch-ai-review":"üìã","patient-education":"üéì","pre-op-plan":"üìã",background:"üìã",medication:"üíä",bloods:"ü©∏",imaging:"üì∑","ohif-viewer":"ü©ª","aus-medical-review":"üá¶üá∫",enhancement:"‚ú®",transcription:"üé§",generation:"ü§ñ"})[p]||"ü§ñ",h=p=>p>0?"text-green-600":p<0?"text-red-600":"text-gray-600";return r?t.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl max-h-[90vh] overflow-hidden w-full",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(lo,{className:"w-6 h-6 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Performance Analytics"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Historical recording metrics and trends"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:d,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Export Metrics",children:t.jsx(jr,{className:"w-4 h-4"})}),t.jsx("button",{onClick:l,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:t.jsx(Jt,{className:"w-4 h-4"})}),t.jsx("button",{onClick:c,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear All Metrics",children:t.jsx(Er,{className:"w-4 h-4"})}),t.jsx("button",{onClick:e,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Close",children:t.jsx(nt,{className:"w-4 h-4"})})]})]})}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:o?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})}):s&&s.totalRecordings>0?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Bm,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Total Recordings"})]}),t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:s.totalRecordings})]}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(qr,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-800",children:"Avg Transcription"})]}),t.jsx("div",{className:"text-2xl font-bold text-green-900",children:m(s.averageTranscriptionTime)})]}),t.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Xo,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-purple-800",children:"Avg Processing"})]}),t.jsx("div",{className:"text-2xl font-bold text-purple-900",children:m(s.averageProcessingTime)})]}),t.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(Kt,{className:"w-4 h-4 text-orange-600"}),t.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Avg Total"})]}),t.jsx("div",{className:"text-2xl font-bold text-orange-900",children:m(s.averageTotalDuration)})]})]}),s.recentTrend.last25Avg>0&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.recentTrend.improvementPercent>0?t.jsx(Dn,{className:"w-4 h-4 text-green-600"}):s.recentTrend.improvementPercent<0?t.jsx(Cm,{className:"w-4 h-4 text-red-600"}):t.jsx(qr,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-800",children:"Performance Trend"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Last 10 Average"}),t.jsx("div",{className:"font-semibold",children:m(s.recentTrend.last10Avg)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Last 25 Average"}),t.jsx("div",{className:"font-semibold",children:m(s.recentTrend.last25Avg)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Improvement"}),t.jsxs("div",{className:`font-semibold ${h(s.recentTrend.improvementPercent)}`,children:[s.recentTrend.improvementPercent>0?"+":"",s.recentTrend.improvementPercent,"%"]})]})]})]}),Object.keys(s.agentTypeBreakdown).length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Agent Performance Breakdown"}),t.jsx("div",{className:"space-y-3",children:Object.entries(s.agentTypeBreakdown).map(([p,b])=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"text-xl",children:g(p)}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 capitalize",children:p.replace("-"," ")}),t.jsxs("div",{className:"text-sm text-gray-600",children:[b.count," recordings"]})]})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:m(b.avgTotal)}),t.jsxs("div",{className:"text-gray-600",children:[m(b.avgTranscription)," + ",m(b.avgProcessing)]})]})]},p))})]}),a.length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Recordings"}),t.jsx("div",{className:"space-y-2",children:a.map((p,b)=>t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"text-sm",children:g(p.agentType)}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 capitalize",children:p.agentType.replace("-"," ")}),t.jsx("div",{className:"text-xs text-gray-500",children:new Date(p.timestamp).toLocaleString()})]})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:m(p.totalDuration)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[m(p.transcriptionTime)," + ",m(p.processingTime)]})]})]},p.sessionId))})]}),Object.keys(s.modelPerformance).length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Model Performance"}),t.jsx("div",{className:"space-y-2",children:Object.entries(s.modelPerformance).map(([p,b])=>t.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gr,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:p})]}),t.jsxs("div",{className:"text-right text-sm",children:[t.jsx("div",{className:"font-medium",children:m(b.avgTime)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[b.count," recordings"]})]})]},p))})]})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(lo,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Metrics Available"}),t.jsx("p",{className:"text-gray-600",children:"Start recording to see performance analytics appear here."})]})})]})}):null},kr={accentPrimary:"#22d3ee",accentSecondary:"#a855f7",accentGlow:"rgba(34, 211, 238, 0.45)"},ro={idle:{dot:"bg-slate-300",text:"text-slate-600"},initializing:{dot:"bg-sky-400",text:"text-sky-600"},active:{dot:"bg-cyan-500",text:"text-cyan-600"},low:{dot:"bg-amber-400",text:"text-amber-600"},silent:{dot:"bg-rose-500",text:"text-rose-600"}},hy=r=>r in ro?ro[r]:ro.idle,fy=["Check mute switch","Confirm connection","Raise your voice slightly","Try another microphone"],$l=r=>{const e=r.replace("#","");if(e.length!==6)return null;const s=parseInt(e,16);return{r:s>>16&255,g:s>>8&255,b:s&255}},xy=(r,e,s)=>{const n=$l(r),a=$l(e);if(!n||!a)return r;const i=Math.min(Math.max(s,0),1),o=Math.round(n.r+(a.r-n.r)*i),A=Math.round(n.g+(a.g-n.g)*i),l=Math.round(n.b+(a.b-n.b)*i);return`rgb(${o}, ${A}, ${l})`},by=({isRecording:r,voiceActivityLevel:e,frequencyData:s,audioLevelHistory:n,recordingTime:a,activeDeviceInfo:i,onStop:o,className:A=""})=>{const l=Fe.useId(),[c,d]=Fe.useState({status:"idle",color:"gray",message:"Not recording"}),[m,g]=Fe.useState(!1),h=Fe.useRef(),p=Fe.useRef([]),b=Fe.useRef([]);Fe.useEffect(()=>{r&&!i?.isWorking&&Math.random()<.01&&console.warn("‚ö†Ô∏è Audio device may not be working properly")},[r,i]);const N=n.slice(-10).some(w=>w>.05),y=Fe.useCallback(()=>r?n.length<5?{status:"initializing",color:"blue",message:"Initializing..."}:N?{status:"active",color:"green",message:"Audio detected"}:e>.01?{status:"low",color:"yellow",message:"Low audio"}:{status:"silent",color:"red",message:"No audio detected"}:{status:"idle",color:"gray",message:"Not recording"},[n.length,N,r,e]);Fe.useEffect(()=>{const w=y();if(h.current&&clearTimeout(h.current),w.status==="active"||w.status==="initializing"){d(w),g(!1);return}return w.status==="silent"||w.status==="low"?h.current=setTimeout(()=>{d(w),w.status==="silent"&&n.length>50&&g(!0)},2500):(d(w),g(!1)),()=>{h.current&&clearTimeout(h.current)}},[y,n.length]);const j=c,Q=Fe.useMemo(()=>hy(j.status),[j.status]),v=w=>{const T=Math.floor(w/60),C=w%60;return`${T}:${C.toString().padStart(2,"0")}`},x=w=>{p.current.length!==w.length&&(p.current=new Array(w.length).fill(0),b.current=new Array(w.length).fill(0));const T=w.map((k,P)=>k*.75+p.current[P]*.25),C=[.06,.09,.12,.15,.12,.09,.06],E=Math.floor(C.length/2),U=[];for(let k=0;k<T.length;k++){let P=0,M=0;for(let $=-E;$<=E;$++){const W=k+$;if(W>=0&&W<T.length){const V=C[$+E];P+=T[W]*V,M+=V}}U.push(P/M)}return p.current=U,{smoothed:U,peaks:[]}},f=(w,T)=>{if(w.length===0)return[];if(w.length>=T)return w;const C=[],E=(w.length-1)/(T-1);for(let U=0;U<T;U++){const k=U*E,P=Math.floor(k),M=k-P;if(P>=w.length-1)C.push(w[w.length-1]);else{const $=w[Math.max(0,P-1)],W=w[P],V=w[P+1],L=w[Math.min(w.length-1,P+2)],O=M,z=O*O,H=z*O,X=.5*(2*W+(-$+V)*O+(2*$-5*W+4*V-L)*z+(-$+3*W-3*V+L)*H);C.push(Math.max(0,Math.min(1,X)))}}return C},F=(w=>{if(w.length===0)return[];const{smoothed:T}=x(w),C=f(T,150);return[...[...C].reverse(),...C]})(s);return t.jsxs(se.div,{className:`relative flex-1 w-full max-w-xl overflow-hidden rounded-[28px] border border-slate-200 bg-white p-8 shadow-[0_25px_80px_-50px_rgba(15,23,42,0.45)] ${A}`,variants:Ke(Rr),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-200/25 via-transparent to-purple-200/20"}),t.jsx("div",{className:"absolute -top-24 right-[-120px] h-72 w-72 rounded-full bg-cyan-300/35 blur-3xl"}),t.jsx("div",{className:"absolute bottom-[-120px] left-[-100px] h-72 w-72 rounded-full bg-purple-300/30 blur-3xl"})]}),t.jsxs(se.div,{className:"relative flex flex-col items-center gap-6 text-center",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.2,type:"spring",damping:20,stiffness:300},children:[t.jsx(se.h3,{className:"text-lg font-semibold tracking-tight text-slate-900",animate:{color:r?kr.accentPrimary:"#0f172a"},transition:{duration:.4},children:r?"Recording in progress":"Ready to record"}),t.jsxs(se.div,{layout:!0,className:"flex flex-wrap items-center justify-center gap-2",children:[t.jsxs(se.div,{layout:!0,className:"flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-4 py-2 text-xs font-medium text-slate-600 shadow-[0_18px_35px_-24px_rgba(15,23,42,0.4)]",animate:{borderColor:j.status==="active"?"rgba(14,165,233,0.45)":"rgba(226,232,240,1)",backgroundColor:j.status==="active"?"rgba(224,242,254,0.95)":"rgba(248,250,252,0.95)"},transition:{duration:.45,ease:[.25,.1,.25,1]},children:[t.jsx(se.span,{className:`h-2.5 w-2.5 rounded-full shadow-[0_0_0px_rgba(148,163,184,0.35)] ${Q.dot}`,animate:{scale:j.status==="active"?[1,1.35,1]:1,boxShadow:j.status==="active"?`0 0 14px ${kr.accentGlow}`:"0 0 6px rgba(148,163,184,0.25)"},transition:{duration:1.8,repeat:j.status==="active"?1/0:0,ease:"easeInOut"}}),t.jsx(se.span,{className:`text-sm font-medium ${Q.text}`,animate:{opacity:1},children:j.message})]}),t.jsx(Le,{initial:!1,children:i&&t.jsxs(se.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.85},transition:{type:"spring",damping:20,stiffness:320},className:"flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-600 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]",children:[t.jsx("div",{className:"icon-compact",children:i.isWorking?t.jsx(Rt,{className:"h-3.5 w-3.5 text-slate-500"}):t.jsx(BA,{className:"h-3.5 w-3.5 text-rose-500"})}),t.jsx("span",{className:"max-w-[200px] truncate",children:i.label})]},"device-chip")}),t.jsx(Le,{initial:!1,children:r&&t.jsxs(se.div,{layout:!0,className:"flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-4 py-2 font-mono text-sm font-semibold text-slate-800 shadow-[0_22px_45px_-28px_rgba(14,165,233,0.45)]",initial:{opacity:0,scale:.82,y:12},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.85,y:-12},transition:{type:"spring",damping:20,stiffness:300},children:[t.jsx("span",{className:"h-1.5 w-1.5 animate-pulse rounded-full bg-rose-400"}),v(a)]},"recording-timer")})]})]}),t.jsx(Le,{children:r&&t.jsxs(se.div,{className:"relative mt-8 w-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{type:"spring",damping:22,stiffness:320,delay:.12},children:[t.jsx(se.div,{className:"mb-5 text-center text-xs uppercase tracking-[0.35em] text-slate-400",initial:{opacity:0},animate:{opacity:1},transition:{delay:.35,duration:.4},children:"Live Spectrum"}),t.jsxs("div",{className:"relative flex h-44 items-center justify-center overflow-hidden rounded-[24px] border border-slate-200 bg-gradient-to-br from-slate-50 via-white to-slate-100 px-6 shadow-[inset_0_1px_0_rgba(255,255,255,0.4),0_35px_90px_-70px_rgba(14,165,233,0.45)]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(34,211,238,0.18),_transparent_65%)]"}),F.length>0?t.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 600 160",preserveAspectRatio:"none",className:"relative z-[1] h-full w-full",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:`${l}-stroke`,x1:"0%",x2:"100%",y1:"0%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:kr.accentSecondary}),t.jsx("stop",{offset:"100%",stopColor:kr.accentPrimary})]}),t.jsxs("linearGradient",{id:`${l}-fill`,x1:"0",x2:"0",y1:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:kr.accentPrimary,stopOpacity:"0.45"}),t.jsx("stop",{offset:"100%",stopColor:kr.accentSecondary,stopOpacity:"0"})]})]}),(()=>{const T=F.reduce((V,L)=>V+L,0)/F.length>.05,C=F.map((V,L)=>{if(!T)return 0;const O=L/(F.length-1),z=Math.sin(O*Math.PI),H=V*120*z;return Math.max(3,Math.min(100,H))}),E=C.reduce((V,L)=>V+L,0)/C.length,U=xy(kr.accentSecondary,kr.accentPrimary,Math.min(1,E/70)),k=Math.min(1,E/80),P=.18+k*.22,M=(V,L)=>{if(!V||V.length===0)return"M 0,80 L 600,80";const z=600/Math.max(1,V.length-1),H=V.map((K,ee)=>({x:ee*z,y:L?80+K/2*.8:80-K/2*.8}));if(H.length<2)return"M 0,80 L 600,80";const X=isFinite(H[0].x)?H[0].x:0,Ae=isFinite(H[0].y)?H[0].y:80;let D=`M ${X},${Ae}`;for(let K=0;K<H.length-1;K++){const ee=H[Math.max(0,K-1)],pe=H[K],ae=H[K+1],me=H[Math.min(H.length-1,K+2)],le=isFinite(pe.x+(ae.x-ee.x)/6)?pe.x+(ae.x-ee.x)/6:pe.x,re=isFinite(pe.y+(ae.y-ee.y)/6)?pe.y+(ae.y-ee.y)/6:pe.y,te=isFinite(ae.x-(me.x-pe.x)/6)?ae.x-(me.x-pe.x)/6:ae.x,he=isFinite(ae.y-(me.y-pe.y)/6)?ae.y-(me.y-pe.y)/6:ae.y;D+=` C ${le},${re} ${te},${he} ${ae.x},${ae.y}`}return D},$=M(C,!1),W=M(C,!0);return t.jsxs(t.Fragment,{children:[t.jsx(se.path,{d:$,fill:"none",stroke:U,strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round",animate:{d:$},transition:{duration:.35,ease:"easeOut"},style:{filter:`drop-shadow(0 0 ${20*k+6}px rgba(34, 211, 238, ${.45+k*.25}))`}}),t.jsx(se.path,{d:W,fill:"none",stroke:U,strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round",animate:{d:W},transition:{duration:.35,ease:"easeOut"},style:{filter:`drop-shadow(0 0 ${16*k+4}px rgba(168, 85, 247, ${.4+k*.2}))`}}),t.jsx(se.path,{d:`${$} L 600,80 L 0,80 Z`,fill:`url(#${l}-fill)`,fillOpacity:P,animate:{d:`${$} L 600,80 L 0,80 Z`},transition:{duration:.35,ease:"easeOut"}}),t.jsx(se.path,{d:`${W} L 600,80 L 0,80 Z`,fill:`url(#${l}-fill)`,fillOpacity:P,animate:{d:`${W} L 600,80 L 0,80 Z`},transition:{duration:.35,ease:"easeOut"}})]})})()]}):t.jsxs("div",{className:"relative z-[1] flex flex-col items-center gap-4 text-slate-500",children:[t.jsxs("div",{className:"relative flex h-16 w-16 items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 rounded-full bg-cyan-400/15 blur-xl"}),t.jsx(se.div,{className:"absolute inset-0 rounded-full border border-cyan-300/30",animate:{scale:[1,1.18,1],opacity:[.55,.1,.55]},transition:{duration:2.4,repeat:1/0,ease:"easeInOut"}}),t.jsx(se.div,{className:"absolute inset-0 rounded-full border border-cyan-200/25",animate:{scale:[1,1.35,1],opacity:[.35,0,.35]},transition:{duration:3,repeat:1/0,ease:"easeInOut",delay:.4}}),t.jsx("div",{className:"icon-compact relative z-[1] flex items-center justify-center rounded-full border border-white/10 bg-white/10 p-3 text-slate-100",children:t.jsx(Rt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-sm font-medium text-slate-700",children:"Waiting for audio"}),t.jsx("div",{className:"mt-1 text-xs text-slate-500/80",children:"Speak into your microphone to wake the spectrum"})]})]})]})]})}),t.jsx(Le,{children:r&&t.jsxs(se.button,{onClick:o,className:"relative mx-auto mt-9 flex items-center gap-3 rounded-full bg-gradient-to-r from-cyan-500 via-sky-500 to-emerald-400 px-7 py-3 text-sm font-semibold text-white shadow-[0_35px_80px_-35px_rgba(14,165,233,0.85)]",initial:{opacity:0,scale:.88,y:18},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.88,y:-18},whileHover:{scale:1.04,translateY:-4,boxShadow:"0 28px 60px -32px rgba(14,165,233,0.85)"},whileTap:{scale:.96},transition:{type:"spring",damping:20,stiffness:320,delay:.4},children:[t.jsx("div",{className:"flex items-center justify-center rounded-full bg-white/15 p-2 text-white",children:t.jsx(Nm,{className:"h-5 w-5"})}),t.jsx("span",{children:"Stop recording"})]})}),t.jsx("div",{className:"relative mt-8 w-full",children:t.jsx(Le,{mode:"wait",children:r&&m&&t.jsxs(se.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:12},transition:{duration:.35,ease:"easeOut"},className:"relative w-full overflow-hidden rounded-[20px] border border-rose-200 bg-rose-50 p-4 shadow-[0_30px_80px_-70px_rgba(244,63,94,0.6)]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top_left,_rgba(244,63,94,0.12),_transparent_65%)]"}),t.jsxs("div",{className:"relative z-[1] flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 text-rose-700",children:[t.jsx("div",{className:"icon-compact mt-1 flex items-center justify-center rounded-full border border-rose-200 bg-rose-100 p-2 text-rose-600",children:t.jsx(BA,{className:"h-4 w-4"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold tracking-tight",children:j.message}),t.jsx("div",{className:"mt-1 text-xs text-rose-600/80",children:"We‚Äôre not hearing anything from this mic right now."})]})]}),t.jsx("div",{className:"flex flex-wrap gap-2 text-[11px] uppercase tracking-[0.14em] text-rose-600/80",children:fy.map(w=>t.jsx("span",{className:"rounded-full border border-rose-200 bg-white/80 px-3 py-1",children:w},w))})]})]},"warning")})})]})};function us(r,e,s,n){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function A(d){try{c(n.next(d))}catch(m){o(m)}}function l(d){try{c(n.throw(d))}catch(m){o(m)}}function c(d){d.done?i(d.value):a(d.value).then(A,l)}c((n=n.apply(r,e||[])).next())})}const yy=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Ws(r,e,s){const n=vy(r),{webkitRelativePath:a}=r,i=typeof e=="string"?e:typeof a=="string"&&a.length>0?a:`./${r.name}`;return typeof n.path!="string"&&Kl(n,"path",i),Kl(n,"relativePath",i),n}function vy(r){const{name:e}=r;if(e&&e.lastIndexOf(".")!==-1&&!r.type){const n=e.split(".").pop().toLowerCase(),a=yy.get(n);a&&Object.defineProperty(r,"type",{value:a,writable:!1,configurable:!1,enumerable:!0})}return r}function Kl(r,e,s){Object.defineProperty(r,e,{value:s,writable:!1,configurable:!1,enumerable:!0})}const wy=[".DS_Store","Thumbs.db"];function By(r){return us(this,void 0,void 0,function*(){return ai(r)&&Cy(r.dataTransfer)?Ey(r.dataTransfer,r.type):Ny(r)?jy(r):Array.isArray(r)&&r.every(e=>"getFile"in e&&typeof e.getFile=="function")?Sy(r):[]})}function Cy(r){return ai(r)}function Ny(r){return ai(r)&&ai(r.target)}function ai(r){return typeof r=="object"&&r!==null}function jy(r){return _o(r.target.files).map(e=>Ws(e))}function Sy(r){return us(this,void 0,void 0,function*(){return(yield Promise.all(r.map(s=>s.getFile()))).map(s=>Ws(s))})}function Ey(r,e){return us(this,void 0,void 0,function*(){if(r.items){const s=_o(r.items).filter(a=>a.kind==="file");if(e!=="drop")return s;const n=yield Promise.all(s.map(Fy));return Vl(Nu(n))}return Vl(_o(r.files).map(s=>Ws(s)))})}function Vl(r){return r.filter(e=>wy.indexOf(e.name)===-1)}function _o(r){if(r===null)return[];const e=[];for(let s=0;s<r.length;s++){const n=r[s];e.push(n)}return e}function Fy(r){if(typeof r.webkitGetAsEntry!="function")return Gl(r);const e=r.webkitGetAsEntry();return e&&e.isDirectory?ju(e):Gl(r,e)}function Nu(r){return r.reduce((e,s)=>[...e,...Array.isArray(s)?Nu(s):[s]],[])}function Gl(r,e){return us(this,void 0,void 0,function*(){var s;if(globalThis.isSecureContext&&typeof r.getAsFileSystemHandle=="function"){const i=yield r.getAsFileSystemHandle();if(i===null)throw new Error(`${r} is not a File`);if(i!==void 0){const o=yield i.getFile();return o.handle=i,Ws(o)}}const n=r.getAsFile();if(!n)throw new Error(`${r} is not a File`);return Ws(n,(s=e?.fullPath)!==null&&s!==void 0?s:void 0)})}function Qy(r){return us(this,void 0,void 0,function*(){return r.isDirectory?ju(r):Iy(r)})}function ju(r){const e=r.createReader();return new Promise((s,n)=>{const a=[];function i(){e.readEntries(o=>us(this,void 0,void 0,function*(){if(o.length){const A=Promise.all(o.map(Qy));a.push(A),i()}else try{const A=yield Promise.all(a);s(A)}catch(A){n(A)}}),o=>{n(o)})}i()})}function Iy(r){return us(this,void 0,void 0,function*(){return new Promise((e,s)=>{r.file(n=>{const a=Ws(n,r.fullPath);e(a)},n=>{s(n)})})})}var so=function(r,e){if(r&&e){var s=Array.isArray(e)?e:e.split(",");if(s.length===0)return!0;var n=r.name||"",a=(r.type||"").toLowerCase(),i=a.replace(/\/.*$/,"");return s.some(function(o){var A=o.trim().toLowerCase();return A.charAt(0)==="."?n.toLowerCase().endsWith(A):A.endsWith("/*")?i===A.replace(/\/.*$/,""):a===A})}return!0};function Wl(r){return ky(r)||Ty(r)||Eu(r)||Uy()}function Uy(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ty(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function ky(r){if(Array.isArray(r))return $o(r)}function zl(r,e){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),s.push.apply(s,n)}return s}function Xl(r){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?zl(Object(s),!0).forEach(function(n){Su(r,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):zl(Object(s)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(s,n))})}return r}function Su(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}function On(r,e){return Ry(r)||Dy(r,e)||Eu(r,e)||Py()}function Py(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eu(r,e){if(r){if(typeof r=="string")return $o(r,e);var s=Object.prototype.toString.call(r).slice(8,-1);if(s==="Object"&&r.constructor&&(s=r.constructor.name),s==="Map"||s==="Set")return Array.from(r);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return $o(r,e)}}function $o(r,e){(e==null||e>r.length)&&(e=r.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=r[s];return n}function Dy(r,e){var s=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(s!=null){var n=[],a=!0,i=!1,o,A;try{for(s=s.call(r);!(a=(o=s.next()).done)&&(n.push(o.value),!(e&&n.length===e));a=!0);}catch(l){i=!0,A=l}finally{try{!a&&s.return!=null&&s.return()}finally{if(i)throw A}}return n}}function Ry(r){if(Array.isArray(r))return r}var My=typeof so=="function"?so:so.default,Hy="file-invalid-type",Ly="file-too-large",Oy="file-too-small",_y="too-many-files",$y=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=e.split(","),n=s.length>1?"one of ".concat(s.join(", ")):s[0];return{code:Hy,message:"File type must be ".concat(n)}},ql=function(e){return{code:Ly,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},Yl=function(e){return{code:Oy,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Ky={code:_y,message:"Too many files"};function Fu(r,e){var s=r.type==="application/x-moz-file"||My(r,e);return[s,s?null:$y(e)]}function Qu(r,e,s){if(ns(r.size))if(ns(e)&&ns(s)){if(r.size>s)return[!1,ql(s)];if(r.size<e)return[!1,Yl(e)]}else{if(ns(e)&&r.size<e)return[!1,Yl(e)];if(ns(s)&&r.size>s)return[!1,ql(s)]}return[!0,null]}function ns(r){return r!=null}function Vy(r){var e=r.files,s=r.accept,n=r.minSize,a=r.maxSize,i=r.multiple,o=r.maxFiles,A=r.validator;return!i&&e.length>1||i&&o>=1&&e.length>o?!1:e.every(function(l){var c=Fu(l,s),d=On(c,1),m=d[0],g=Qu(l,n,a),h=On(g,1),p=h[0],b=A?A(l):null;return m&&p&&!b})}function ii(r){return typeof r.isPropagationStopped=="function"?r.isPropagationStopped():typeof r.cancelBubble<"u"?r.cancelBubble:!1}function Fa(r){return r.dataTransfer?Array.prototype.some.call(r.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!r.target&&!!r.target.files}function Jl(r){r.preventDefault()}function Gy(r){return r.indexOf("MSIE")!==-1||r.indexOf("Trident/")!==-1}function Wy(r){return r.indexOf("Edge/")!==-1}function zy(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Gy(r)||Wy(r)}function cr(){for(var r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return function(n){for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return e.some(function(A){return!ii(n)&&A&&A.apply(void 0,[n].concat(i)),ii(n)})}}function Xy(){return"showOpenFilePicker"in window}function qy(r){if(ns(r)){var e=Object.entries(r).filter(function(s){var n=On(s,2),a=n[0],i=n[1],o=!0;return Iu(a)||(console.warn('Skipped "'.concat(a,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(i)||!i.every(Uu))&&(console.warn('Skipped "'.concat(a,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(s,n){var a=On(n,2),i=a[0],o=a[1];return Xl(Xl({},s),{},Su({},i,o))},{});return[{description:"Files",accept:e}]}return r}function Yy(r){if(ns(r))return Object.entries(r).reduce(function(e,s){var n=On(s,2),a=n[0],i=n[1];return[].concat(Wl(e),[a],Wl(i))},[]).filter(function(e){return Iu(e)||Uu(e)}).join(",")}function Jy(r){return r instanceof DOMException&&(r.name==="AbortError"||r.code===r.ABORT_ERR)}function Zy(r){return r instanceof DOMException&&(r.name==="SecurityError"||r.code===r.SECURITY_ERR)}function Iu(r){return r==="audio/*"||r==="video/*"||r==="image/*"||r==="text/*"||r==="application/*"||/\w+\/[-+.\w]+/g.test(r)}function Uu(r){return/^.*\.[\w]+$/.test(r)}var ev=["children"],tv=["open"],rv=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],sv=["refKey","onChange","onClick"];function nv(r){return ov(r)||iv(r)||Tu(r)||av()}function av(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iv(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function ov(r){if(Array.isArray(r))return Ko(r)}function no(r,e){return cv(r)||lv(r,e)||Tu(r,e)||Av()}function Av(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tu(r,e){if(r){if(typeof r=="string")return Ko(r,e);var s=Object.prototype.toString.call(r).slice(8,-1);if(s==="Object"&&r.constructor&&(s=r.constructor.name),s==="Map"||s==="Set")return Array.from(r);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Ko(r,e)}}function Ko(r,e){(e==null||e>r.length)&&(e=r.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=r[s];return n}function lv(r,e){var s=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(s!=null){var n=[],a=!0,i=!1,o,A;try{for(s=s.call(r);!(a=(o=s.next()).done)&&(n.push(o.value),!(e&&n.length===e));a=!0);}catch(l){i=!0,A=l}finally{try{!a&&s.return!=null&&s.return()}finally{if(i)throw A}}return n}}function cv(r){if(Array.isArray(r))return r}function Zl(r,e){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),s.push.apply(s,n)}return s}function We(r){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?Zl(Object(s),!0).forEach(function(n){Vo(r,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):Zl(Object(s)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(s,n))})}return r}function Vo(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}function oi(r,e){if(r==null)return{};var s=dv(r,e),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);for(a=0;a<i.length;a++)n=i[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(s[n]=r[n])}return s}function dv(r,e){if(r==null)return{};var s={},n=Object.keys(r),a,i;for(i=0;i<n.length;i++)a=n[i],!(e.indexOf(a)>=0)&&(s[a]=r[a]);return s}var dA=u.forwardRef(function(r,e){var s=r.children,n=oi(r,ev),a=uA(n),i=a.open,o=oi(a,tv);return u.useImperativeHandle(e,function(){return{open:i}},[i]),Fe.createElement(u.Fragment,null,s(We(We({},o),{},{open:i})))});dA.displayName="Dropzone";var ku={disabled:!1,getFilesFromEvent:By,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};dA.defaultProps=ku;dA.propTypes={children:He.func,accept:He.objectOf(He.arrayOf(He.string)),multiple:He.bool,preventDropOnDocument:He.bool,noClick:He.bool,noKeyboard:He.bool,noDrag:He.bool,noDragEventsBubbling:He.bool,minSize:He.number,maxSize:He.number,maxFiles:He.number,disabled:He.bool,getFilesFromEvent:He.func,onFileDialogCancel:He.func,onFileDialogOpen:He.func,useFsAccessApi:He.bool,autoFocus:He.bool,onDragEnter:He.func,onDragLeave:He.func,onDragOver:He.func,onDrop:He.func,onDropAccepted:He.func,onDropRejected:He.func,onError:He.func,validator:He.func};var Go={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function uA(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=We(We({},ku),r),s=e.accept,n=e.disabled,a=e.getFilesFromEvent,i=e.maxSize,o=e.minSize,A=e.multiple,l=e.maxFiles,c=e.onDragEnter,d=e.onDragLeave,m=e.onDragOver,g=e.onDrop,h=e.onDropAccepted,p=e.onDropRejected,b=e.onFileDialogCancel,N=e.onFileDialogOpen,y=e.useFsAccessApi,j=e.autoFocus,Q=e.preventDropOnDocument,v=e.noClick,x=e.noKeyboard,f=e.noDrag,S=e.noDragEventsBubbling,F=e.onError,w=e.validator,T=u.useMemo(function(){return Yy(s)},[s]),C=u.useMemo(function(){return qy(s)},[s]),E=u.useMemo(function(){return typeof N=="function"?N:ec},[N]),U=u.useMemo(function(){return typeof b=="function"?b:ec},[b]),k=u.useRef(null),P=u.useRef(null),M=u.useReducer(uv,Go),$=no(M,2),W=$[0],V=$[1],L=W.isFocused,O=W.isFileDialogActive,z=u.useRef(typeof window<"u"&&window.isSecureContext&&y&&Xy()),H=function(){!z.current&&O&&setTimeout(function(){if(P.current){var Y=P.current.files;Y.length||(V({type:"closeDialog"}),U())}},300)};u.useEffect(function(){return window.addEventListener("focus",H,!1),function(){window.removeEventListener("focus",H,!1)}},[P,O,U,z]);var X=u.useRef([]),Ae=function(Y){k.current&&k.current.contains(Y.target)||(Y.preventDefault(),X.current=[])};u.useEffect(function(){return Q&&(document.addEventListener("dragover",Jl,!1),document.addEventListener("drop",Ae,!1)),function(){Q&&(document.removeEventListener("dragover",Jl),document.removeEventListener("drop",Ae))}},[k,Q]),u.useEffect(function(){return!n&&j&&k.current&&k.current.focus(),function(){}},[k,j,n]);var D=u.useCallback(function(J){F?F(J):console.error(J)},[F]),K=u.useCallback(function(J){J.preventDefault(),J.persist(),we(J),X.current=[].concat(nv(X.current),[J.target]),Fa(J)&&Promise.resolve(a(J)).then(function(Y){if(!(ii(J)&&!S)){var fe=Y.length,Ue=fe>0&&Vy({files:Y,accept:T,minSize:o,maxSize:i,multiple:A,maxFiles:l,validator:w}),Ie=fe>0&&!Ue;V({isDragAccept:Ue,isDragReject:Ie,isDragActive:!0,type:"setDraggedFiles"}),c&&c(J)}}).catch(function(Y){return D(Y)})},[a,c,D,S,T,o,i,A,l,w]),ee=u.useCallback(function(J){J.preventDefault(),J.persist(),we(J);var Y=Fa(J);if(Y&&J.dataTransfer)try{J.dataTransfer.dropEffect="copy"}catch{}return Y&&m&&m(J),!1},[m,S]),pe=u.useCallback(function(J){J.preventDefault(),J.persist(),we(J);var Y=X.current.filter(function(Ue){return k.current&&k.current.contains(Ue)}),fe=Y.indexOf(J.target);fe!==-1&&Y.splice(fe,1),X.current=Y,!(Y.length>0)&&(V({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Fa(J)&&d&&d(J))},[k,d,S]),ae=u.useCallback(function(J,Y){var fe=[],Ue=[];J.forEach(function(Ie){var vt=Fu(Ie,T),Pe=no(vt,2),Ft=Pe[0],sr=Pe[1],At=Qu(Ie,o,i),mt=no(At,2),Qt=mt[0],It=mt[1],Ut=w?w(Ie):null;if(Ft&&Qt&&!Ut)fe.push(Ie);else{var br=[sr,It];Ut&&(br=br.concat(Ut)),Ue.push({file:Ie,errors:br.filter(function(Jr){return Jr})})}}),(!A&&fe.length>1||A&&l>=1&&fe.length>l)&&(fe.forEach(function(Ie){Ue.push({file:Ie,errors:[Ky]})}),fe.splice(0)),V({acceptedFiles:fe,fileRejections:Ue,isDragReject:Ue.length>0,type:"setFiles"}),g&&g(fe,Ue,Y),Ue.length>0&&p&&p(Ue,Y),fe.length>0&&h&&h(fe,Y)},[V,A,T,o,i,l,g,h,p,w]),me=u.useCallback(function(J){J.preventDefault(),J.persist(),we(J),X.current=[],Fa(J)&&Promise.resolve(a(J)).then(function(Y){ii(J)&&!S||ae(Y,J)}).catch(function(Y){return D(Y)}),V({type:"reset"})},[a,ae,D,S]),le=u.useCallback(function(){if(z.current){V({type:"openDialog"}),E();var J={multiple:A,types:C};window.showOpenFilePicker(J).then(function(Y){return a(Y)}).then(function(Y){ae(Y,null),V({type:"closeDialog"})}).catch(function(Y){Jy(Y)?(U(Y),V({type:"closeDialog"})):Zy(Y)?(z.current=!1,P.current?(P.current.value=null,P.current.click()):D(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):D(Y)});return}P.current&&(V({type:"openDialog"}),E(),P.current.value=null,P.current.click())},[V,E,U,y,ae,D,C,A]),re=u.useCallback(function(J){!k.current||!k.current.isEqualNode(J.target)||(J.key===" "||J.key==="Enter"||J.keyCode===32||J.keyCode===13)&&(J.preventDefault(),le())},[k,le]),te=u.useCallback(function(){V({type:"focus"})},[]),he=u.useCallback(function(){V({type:"blur"})},[]),Ce=u.useCallback(function(){v||(zy()?setTimeout(le,0):le())},[v,le]),ge=function(Y){return n?null:Y},Z=function(Y){return x?null:ge(Y)},be=function(Y){return f?null:ge(Y)},we=function(Y){S&&Y.stopPropagation()},ye=u.useMemo(function(){return function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Y=J.refKey,fe=Y===void 0?"ref":Y,Ue=J.role,Ie=J.onKeyDown,vt=J.onFocus,Pe=J.onBlur,Ft=J.onClick,sr=J.onDragEnter,At=J.onDragOver,mt=J.onDragLeave,Qt=J.onDrop,It=oi(J,rv);return We(We(Vo({onKeyDown:Z(cr(Ie,re)),onFocus:Z(cr(vt,te)),onBlur:Z(cr(Pe,he)),onClick:ge(cr(Ft,Ce)),onDragEnter:be(cr(sr,K)),onDragOver:be(cr(At,ee)),onDragLeave:be(cr(mt,pe)),onDrop:be(cr(Qt,me)),role:typeof Ue=="string"&&Ue!==""?Ue:"presentation"},fe,k),!n&&!x?{tabIndex:0}:{}),It)}},[k,re,te,he,Ce,K,ee,pe,me,x,f,n]),Ne=u.useCallback(function(J){J.stopPropagation()},[]),Be=u.useMemo(function(){return function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Y=J.refKey,fe=Y===void 0?"ref":Y,Ue=J.onChange,Ie=J.onClick,vt=oi(J,sv),Pe=Vo({accept:T,multiple:A,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:ge(cr(Ue,me)),onClick:ge(cr(Ie,Ne)),tabIndex:-1},fe,P);return We(We({},Pe),vt)}},[P,s,A,me,n]);return We(We({},W),{},{isFocused:L&&!n,getRootProps:ye,getInputProps:Be,rootRef:k,inputRef:P,open:ge(le)})}function uv(r,e){switch(e.type){case"focus":return We(We({},r),{},{isFocused:!0});case"blur":return We(We({},r),{},{isFocused:!1});case"openDialog":return We(We({},Go),{},{isFileDialogActive:!0});case"closeDialog":return We(We({},r),{},{isFileDialogActive:!1});case"setDraggedFiles":return We(We({},r),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return We(We({},r),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return We({},Go);default:return r}}function ec(){}class mv{screenshots=[];gridSlots=[null,null,null,null];maxScreenshots=4;constructor(e=4){this.maxScreenshots=e}addScreenshot(e){this.screenshots.length>=this.maxScreenshots&&(oe.warn(`Maximum ${this.maxScreenshots} screenshots reached. Replacing oldest.`,{component:"screenshot-combiner",operation:"add-screenshot",maxScreenshots:this.maxScreenshots}),this.screenshots.shift()),this.screenshots.push(e),oe.info(`Screenshot added. Total: ${this.screenshots.length}/${this.maxScreenshots}`,{component:"screenshot-combiner",operation:"add-screenshot",current:this.screenshots.length,max:this.maxScreenshots})}setGrid(e){const s=[null,null,null,null];for(let n=0;n<4;n++)s[n]=e[n]||null;this.gridSlots=s,this.screenshots=this.gridSlots.filter(n=>n!==null)}removeScreenshot(e){const s=this.screenshots.findIndex(n=>n.id===e);return s!==-1?(this.screenshots.splice(s,1),oe.info(`Screenshot removed. Remaining: ${this.screenshots.length}`,{component:"screenshot-combiner",operation:"remove-screenshot",remaining:this.screenshots.length}),!0):!1}getScreenshots(){return[...this.screenshots]}getScreenshotCount(){return this.screenshots.length}canAddMore(){return this.screenshots.length<this.maxScreenshots}clear(){this.screenshots=[],this.gridSlots=[null,null,null,null],oe.info("All screenshots cleared",{component:"screenshot-combiner",operation:"clear"})}async combineScreenshots(){if(this.screenshots.length===0)throw new Error("No screenshots to combine");oe.info(`Combining ${this.screenshots.length} screenshots into 2x2 grid (10x10 cm)`,{component:"screenshot-combiner",operation:"combine-start",count:this.screenshots.length});try{const s={dataUrl:await this.createCombinedCanvas(),width:0,height:0,screenshotCount:this.screenshots.length,timestamp:Date.now()};return oe.info(`Successfully combined ${this.screenshots.length} screenshots`,{component:"screenshot-combiner",operation:"combine-success",count:this.screenshots.length}),s}catch(e){const s=Zn(e);throw oe.error("Failed to combine screenshots",s,{component:"screenshot-combiner",operation:"combine-error"}),new Error(`Screenshot combination failed: ${e instanceof Error?e.message:"Unknown error"}`)}}drawCombinedCanvas(){return new Promise((e,s)=>{try{const n=document.createElement("canvas"),a=n.getContext("2d");if(!a){s(new Error("Could not get canvas context"));return}const i=96/2.54,o=Math.round(10*i),A=Math.round(5*i),l=Math.max(1,Math.floor(window.devicePixelRatio||1));n.width=o*l,n.height=o*l,a.scale(l,l),oe.debug(`Canvas dimensions: ${o}x${o} (CSS px), DPR=${l}`,{component:"screenshot-combiner",operation:"canvas-setup",width:o,height:o,dpr:l}),a.fillStyle="#ffffff",a.fillRect(0,0,o,o);const c=(p,b,N,y)=>{a.save(),a.beginPath(),a.rect(b,N,y,y),a.clip();const j=Math.max(y/p.width,y/p.height),Q=p.width*j,v=p.height*j,x=b+(y-Q)/2,f=N+(y-v)/2;a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(p,x,f,Q,v),a.restore()},d=this.gridSlots,m=[null,null,null,null];let g=d.filter(Boolean).length;if(g===0){e(n);return}const h=()=>{if(g--,g===0){const p=[{x:0,y:0},{x:A,y:0},{x:0,y:A},{x:A,y:A}];for(let b=0;b<4;b++){const N=m[b];if(!N)continue;const y=p[b];c(N,y.x,y.y,A),oe.debug(`Drew slot ${b+1} at (${y.x}, ${y.y}), cell ${A}x${A}`,{component:"screenshot-combiner",operation:"draw-slot",slot:b+1,x:y.x,y:y.y,cellSize:A})}oe.info("Canvas combination completed",{component:"screenshot-combiner",operation:"canvas-complete"}),e(n)}};d.forEach((p,b)=>{if(!p)return;const N=new Image;N.onload=()=>{m[b]=N,oe.debug(`Loaded slot ${b+1} image - ${N.width}x${N.height}`,{component:"screenshot-combiner",operation:"load-image",slot:b+1,width:N.width,height:N.height}),h()},N.onerror=y=>{const j=Zn(y);oe.error(`Failed to load slot ${b+1} image`,j,{component:"screenshot-combiner",operation:"load-image",slot:b+1,error:y instanceof Error?y.message:String(y)}),m[b]=null,h()},N.src=p.dataUrl})}catch(n){const a=Zn(n);oe.error("Error setting up canvas combination",a,{component:"screenshot-combiner",operation:"canvas-setup"}),s(n)}})}createCombinedCanvas(){return this.drawCombinedCanvas().then(e=>e.toDataURL("image/png"))}async copyToClipboard(){if(this.screenshots.length===0)throw new Error("No screenshots to copy");try{const e=await this.drawCombinedCanvas(),s=await new Promise((a,i)=>{e.toBlob(o=>o?a(o):i(new Error("toBlob failed")),"image/png")}),n=new ClipboardItem({"image/png":s});await navigator.clipboard.write([n]),oe.info("Combined screenshot copied to clipboard",{component:"screenshot-combiner",operation:"copy-clipboard"})}catch(e){const s=Zn(e);throw oe.error("Failed to copy to clipboard",s,{component:"screenshot-combiner",operation:"copy-clipboard"}),new Error(`Clipboard copy failed: ${e instanceof Error?e.message:"Unknown error"}`)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}}const Nt=ce.getInstance(),jt={success:3e3,error:4e3,brief:2e3,extended:6e3},Qa={recordingStarted:r=>Nt.success("Recording Started",`${r} recording in progress`,jt.brief),recordingSent:(r,e)=>Nt.success("Recording Sent for Processing",`${r}'s ${e} recording is being processed. Ready for next recording.`,jt.success),sessionReady:(r,e)=>Nt.success("Session Ready for Review",`${r}'s ${e} results are ready. Click the notification bell to view.`,jt.extended),processingFailed:r=>Nt.error("Processing Failed",`${r}'s recording failed`,jt.error),transcriptionFailed:r=>{const e={"no-audio":"No audio detected","too-short":"Recording too short","service-unavailable":"Transcription service unavailable",error:"Transcription service error"};return Nt.error("Audio Transcription Failed",e[r],jt.error)}},ct={imageAdded:r=>Nt.success("Image Added",`Screenshot ${r+1} loaded successfully`,jt.brief),imageRemoved:r=>Nt.success("Screenshot Removed",`Slot ${r+1} cleared`,jt.brief),imagesCombined:r=>Nt.success("Screenshots Combined!",`${r} screenshots combined and copied to clipboard`,jt.success),allCleared:()=>Nt.success("Cleared","All screenshots removed",jt.brief),invalidFile:(r="PNG, JPG, GIF")=>Nt.error("Invalid File",`Please select an image file (${r})`,jt.error),noFiles:()=>Nt.error("No Files","No files were detected in the drag operation",jt.error),combineFailed:r=>Nt.error("Combine Failed",r||"Failed to combine screenshots",jt.error),importFailed:()=>Nt.error("Import Failed","Could not load dropped image",jt.error),noScreenshots:()=>Nt.error("No Screenshots","Please add at least one screenshot to combine",jt.error)},pv=({isOpen:r,onClose:e})=>{const[s,n]=u.useState([null,null,null,null]),[a,i]=u.useState(!1),[o,A]=u.useState(null),[l,c]=u.useState(0),d=u.useRef(new mv(4)),m=u.useRef(null),g=()=>{n([null,null,null,null]),i(!1),d.current.clear(),c(0);try{chrome.tabs.query({active:!0,currentWindow:!0},x=>{const f=x?.[0]?.id;f&&chrome.tabs.sendMessage(f,{type:"SET_FILE_DROP_GUARD",enabled:!1})})}catch(x){console.debug("Failed to disable file drop guard on modal close:",x instanceof Error?x.message:x)}e()};u.useEffect(()=>{const x=async f=>{try{const F=(await chrome.tabs.query({active:!0,currentWindow:!0}))?.[0]?.id;F&&await chrome.tabs.sendMessage(F,{type:"SET_FILE_DROP_GUARD",enabled:f})}catch(S){console.warn("SET_FILE_DROP_GUARD send failed (likely non-EMR tab):",S)}try{await chrome.runtime.sendMessage({type:"SET_FILE_DROP_GUARD",enabled:f})}catch(S){console.warn("SET_FILE_DROP_GUARD to background failed:",S)}};return r&&x(!0),()=>{x(!1)}},[r]);const h=u.useCallback((x,f)=>{if(!x.type.startsWith("image/")){ct.invalidFile();return}const S=new FileReader;S.onload=F=>{const w=F.target?.result,T=new Image;T.onload=()=>{const C={id:`slot-${f}-${Date.now()}`,dataUrl:w,timestamp:Date.now(),width:T.width,height:T.height};n(E=>{const U=[...E];return U[f]=C,U}),ct.imageAdded(f)},T.src=w},S.readAsDataURL(x)},[]);u.useEffect(()=>{c(x=>{if(x!=null&&s[x]===null)return x;const f=s.findIndex(S=>S===null);return f>=0?f:x??0})},[s]),u.useEffect(()=>{try{const x=(l??0)+1;chrome.runtime.sendMessage({type:"SET_DROP_HINT",data:{slot:x}})}catch(x){console.debug("Failed to send drop hint message for slot",(l??0)+1,":",x instanceof Error?x.message:x)}},[l]),u.useCallback((x,f)=>{x.preventDefault(),console.log("üéØ Drag enter on drop zone",f),A(f)},[]),u.useCallback((x,f)=>{if(x.preventDefault(),x.dataTransfer)try{x.dataTransfer.dropEffect="copy"}catch(S){console.debug("Cannot set dropEffect on dataTransfer (browser security):",S instanceof Error?S.message:S)}A(f)},[]),u.useCallback(x=>{x.preventDefault(),console.log("üö´ Drag leave drop zone"),A(null)},[]),u.useCallback((x,f)=>{if(x.preventDefault(),x.dataTransfer)try{x.dataTransfer.dropEffect="copy"}catch(w){console.debug("Cannot set dropEffect on dataTransfer (browser security):",w instanceof Error?w.message:w)}if(console.log("üéØ Drop event triggered on zone",f,"with files:",x.dataTransfer?.files?.length??0),A(null),!x.dataTransfer)return console.log("‚ùå No dataTransfer on drag event"),ct.noFiles(),!1;let S=[];if(x.dataTransfer.files&&x.dataTransfer.files.length>0)S=Array.from(x.dataTransfer.files);else if(x.dataTransfer.items&&x.dataTransfer.items.length>0){const w=[];for(const T of Array.from(x.dataTransfer.items))if(T.kind==="file"){const C=T.getAsFile();C&&w.push(C)}S=w}if(!S.length)return console.log("‚ùå No file items present in drag operation"),ct.noFiles(),!1;console.log("üìÅ Files detected:",S.map(w=>`${w.name} (${w.type})`));const F=S.find(w=>w.type.startsWith("image/"));return F?(console.log("‚úÖ Processing image file:",F.name,F.type),h(F,f)):(console.log("‚ùå No valid image files found"),ct.invalidFile()),!1},[h]),u.useCallback((x,f)=>{const S=x.target.files;S&&S.length>0&&h(S[0],f),x.target.value=""},[h]);const p=u.useCallback(x=>{n(f=>{const S=[...f];return S[x]=null,S}),ct.imageRemoved(x)},[]),b=u.useCallback((x,f)=>{try{const S=new Image;S.onload=()=>{const F={id:`slot-${f}-${Date.now()}`,dataUrl:x,timestamp:Date.now(),width:S.width,height:S.height};n(w=>{const T=[...w];return T[f]=F,T}),ct.imageAdded(f)},S.src=x}catch(S){console.error("Failed to import data URL image",S),ct.importFailed()}},[]);u.useEffect(()=>{const x=f=>{if(f?.type==="PAGE_FILE_DROPPED"&&f.payload?.dataUrl){let S=l;if(S==null||s[S]!==null){const F=s.findIndex(w=>w===null);S=F>=0?F:0}b(f.payload.dataUrl,S)}};return chrome.runtime.onMessage.addListener(x),()=>chrome.runtime.onMessage.removeListener(x)},[s,l,b]);const N=({index:x,screenshot:f})=>{const S=u.useCallback(U=>{console.log("üì• react-dropzone onDrop accepted:",U.map(k=>`${k.name} (${k.type||"unknown"})`)),U&&U.length>0?h(U[0],x):ct.invalidFile()},[h,x]),{getRootProps:F,getInputProps:w,isDragActive:T,open:C}=uA({onDrop:S,onDragEnter:()=>{console.log("üü¶ dropzone dragenter",x),A(x)},onDragOver:()=>{A(x)},onDragLeave:()=>{console.log("‚¨ú dropzone dragleave",x),A(U=>U===x?null:U)},accept:{"image/*":[]},multiple:!1,noKeyboard:!0,useFsAccessApi:!1}),E=T||o===x;return t.jsxs("div",{...F({className:`
          relative aspect-video rounded-lg border-2 border-dashed cursor-pointer transition-all duration-200
          ${E?"border-blue-500 bg-blue-50 scale-105":f?"border-gray-300 bg-gray-50":"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-25"} ${l===x?"ring-2 ring-blue-500":""}
        `,onClick:U=>{U.preventDefault(),c(x),C()},"data-drop-zone":"true"}),children:[t.jsx("input",{...w({accept:"image/*"})}),f?t.jsxs("div",{className:"relative w-full h-full group",children:[t.jsx("img",{src:f.dataUrl,alt:`Screenshot ${x+1}`,className:"w-full h-full object-cover rounded-lg",draggable:!1,onDragStart:U=>U.preventDefault()}),t.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:x+1}),t.jsx("button",{onClick:U=>{U.preventDefault(),U.stopPropagation(),p(x)},className:"absolute top-2 left-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx(nt,{className:"w-3 h-3"})}),t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 rounded-lg transition-all"})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center",children:[t.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-3 ${E?"bg-blue-200":"bg-gray-200"}`,children:E?t.jsx(li,{className:"w-6 h-6 text-blue-600"}):t.jsx($a,{className:"w-6 h-6 text-gray-500"})}),t.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-1 flex items-center justify-center gap-2",children:[t.jsxs("span",{children:["Slot ",x+1]}),l===x&&t.jsx("span",{className:"text-xs text-blue-600 font-semibold",children:"Next"})]}),t.jsx("div",{className:"text-xs text-gray-500",children:E?"Drop image here":"Drag image or click"})]})]})},y=u.useCallback(async()=>{if(!s.some(f=>f!==null)){ct.noScreenshots();return}i(!0);try{d.current.clear(),d.current.setGrid(s),await d.current.copyToClipboard();const f=s.filter(Boolean).length;ct.imagesCombined(f)}catch(f){console.error("Failed to combine and copy screenshots:",f),ct.combineFailed(f instanceof Error?f.message:void 0)}finally{i(!1)}},[s]),j=u.useCallback(()=>{n([null,null,null,null]),c(0),d.current.clear(),ct.allCleared()},[]),Q=s.filter(x=>x!==null).length,v=Q>0&&!a;return u.useEffect(()=>{const x=S=>{S.preventDefault()},f=S=>{S.target?.closest('[data-drop-zone="true"]')||S.preventDefault()};return window.addEventListener("dragover",x,!0),window.addEventListener("drop",x,!0),window.addEventListener("dragenter",f,!0),()=>{window.removeEventListener("dragover",x,!0),window.removeEventListener("drop",x,!0),window.removeEventListener("dragenter",f,!0)}},[]),r?t.jsx(Le,{children:t.jsx(se.div,{ref:m,className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center",variants:Ke(Xc),initial:"hidden",animate:"visible",exit:"exit",onClick:x=>{x.target===x.currentTarget&&g()},children:t.jsxs(se.div,{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",variants:Ke(zc),initial:"hidden",animate:"visible",exit:"exit",onClick:x=>x.stopPropagation(),children:[t.jsxs(se.div,{className:"flex items-center justify-between p-6 border-b border-gray-200",variants:Ke(Wa),initial:"hidden",animate:"visible",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx(Tc,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Screenshot Combiner"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Drag and drop up to 4 screenshots to combine them"})]})]}),t.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(nt,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"px-6 py-4 border-b border-gray-100 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-600",children:Q===0?"No screenshots added yet":`${Q}/4 screenshots ready`}),a&&t.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-sm",children:"Combining..."})]})]})}),t.jsxs("div",{className:"flex-1 p-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.jsx(N,{index:0,screenshot:s[0]}),t.jsx(N,{index:1,screenshot:s[1]}),t.jsx(N,{index:2,screenshot:s[2]}),t.jsx(N,{index:3,screenshot:s[3]})]}),t.jsxs("div",{className:"text-center text-sm text-gray-600 space-y-2",children:[t.jsx("p",{children:"Drag screenshots from your desktop or click to browse files."}),t.jsx("p",{children:"Supports PNG, JPG, and GIF formats. Screenshots will be combined vertically."})]})]}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[t.jsx("div",{className:"flex items-center space-x-2",children:Q>0&&t.jsxs("button",{onClick:j,className:"flex items-center space-x-2 px-3 py-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:[t.jsx(Er,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Clear All"})]})}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:g,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Close"}),t.jsxs("button",{onClick:y,disabled:!v||a,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[a?t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):t.jsx(Vr,{className:"w-4 h-4"}),t.jsx("span",{children:a?"Combining...":"Combine & Copy"})]})]})]})]})})}):null},gv=({isOpen:r,comparison:e,textToInsert:s,onConfirm:n,onCancel:a,onRefreshEMR:i})=>{if(!r||!e)return null;const o=c=>{switch(c){case"high":return"text-green-600";case"medium":return"text-yellow-600";case"low":return"text-red-600";default:return"text-gray-600"}},l=e.isMatch?{border:"border-green-200",bg:"bg-green-50",iconColor:"text-green-600",title:"Patient Names Match"}:e.similarityScore>.5?{border:"border-yellow-200",bg:"bg-yellow-50",iconColor:"text-yellow-600",title:"Patient Name Similarity Warning"}:{border:"border-red-200",bg:"bg-red-50",iconColor:"text-red-600",title:"Patient Name Mismatch Warning"};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:`bg-white rounded-2xl shadow-xl max-w-md w-full ${l.border} border-2`,children:[t.jsx("div",{className:`${l.bg} px-6 py-4 rounded-t-2xl border-b border-gray-200`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(ot,{className:`w-6 h-6 ${l.iconColor}`}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l.title})]}),t.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 transition-colors",children:t.jsx(nt,{className:"w-5 h-5"})})]})}),t.jsxs("div",{className:"px-6 py-4 space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ai,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Session Patient Name:"})]}),t.jsxs("div",{className:"ml-6 p-3 bg-blue-50 rounded-lg border",children:[t.jsx("div",{className:"text-sm font-medium text-blue-900",children:e.sessionPatientName}),t.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"From dictation session"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Et,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current EMR Patient:"})]}),t.jsxs("div",{className:"ml-6 p-3 bg-green-50 rounded-lg border",children:[t.jsx("div",{className:"text-sm font-medium text-green-900",children:e.emrPatientName}),t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Currently open EMR file"})]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Similarity Score:"}),t.jsxs("span",{className:`text-sm font-bold ${o(e.confidence)}`,children:[Math.round(e.similarityScore*100),"%"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Confidence Level:"}),t.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${e.confidence==="high"?"bg-green-100 text-green-800":e.confidence==="medium"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:e.confidence.toUpperCase()})]})]}),e.warnings.length>0&&t.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:[t.jsx("div",{className:"text-sm font-medium text-orange-800 mb-2",children:"Warnings:"}),t.jsx("ul",{className:"text-xs text-orange-700 space-y-1",children:e.warnings.map((c,d)=>t.jsxs("li",{className:"flex items-start space-x-1",children:[t.jsx("span",{className:"w-1 h-1 bg-orange-600 rounded-full mt-1.5 flex-shrink-0"}),t.jsx("span",{children:c})]},d))})]}),s&&t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Text to Insert:"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 max-h-32 overflow-y-auto",children:[t.jsx("div",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:s.length>200?`${s.substring(0,200)}...`:s}),s.length>200&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Showing first 200 characters (",s.length," total)"]})]})]}),t.jsx("div",{className:`p-3 rounded-lg ${e.isMatch?"bg-green-100 border-green-200":"bg-red-100 border-red-200"} border`,children:t.jsx("div",{className:`text-sm ${e.isMatch?"text-green-800":"text-red-800"}`,children:e.isMatch?"The patient names appear to match. You can proceed with inserting the text.":"You are about to insert session results into a potentially different patient's EMR file. Please verify this is intentional."})})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Cancel"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[i&&t.jsx("button",{onClick:i,className:"px-4 py-2 text-blue-700 bg-blue-100 border border-blue-300 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium",children:"Refresh EMR"}),t.jsx("button",{onClick:n,className:`px-4 py-2 text-white rounded-lg font-medium text-sm transition-colors ${e.isMatch?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:e.isMatch?"Insert Text":"Insert Anyway"})]})]})})]})})},hv=({onImageSelect:r,currentImage:e,onClearImage:s,disabled:n=!1})=>{const a=u.useCallback(d=>{if(!d.type.startsWith("image/")){ct.invalidFile();return}const m=new FileReader;m.onload=g=>{const h=g.target?.result;h&&(r(h),ct.imageAdded(0))},m.readAsDataURL(d)},[r]),i=u.useCallback(d=>{d&&d.length>0?a(d[0]):ct.invalidFile()},[a]),{getRootProps:o,getInputProps:A,isDragActive:l}=uA({onDrop:i,accept:{"image/*":[]},multiple:!1,disabled:n,noKeyboard:!0,useFsAccessApi:!1}),c=u.useCallback(d=>{d.stopPropagation(),s&&(s(),ct.imageRemoved(0))},[s]);return e?t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"relative rounded-lg border-2 border-gray-300 bg-gray-50 overflow-hidden",children:[t.jsx("img",{src:e,alt:"BP Diary Sheet",className:"w-full h-auto max-h-96 object-contain"}),s&&!n&&t.jsx("button",{onClick:c,className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Remove image",children:t.jsx(nt,{className:"w-4 h-4"})})]})}):t.jsxs("div",{...o({className:`
          relative rounded-lg border-2 border-dashed cursor-pointer transition-all duration-200
          ${n?"opacity-50 cursor-not-allowed":""}
          ${l?"border-blue-500 bg-blue-50 scale-105":"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-25"}
          min-h-64 flex items-center justify-center p-8
        `}),children:[t.jsx("input",{...A({accept:"image/*"})}),t.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[t.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mb-4 ${l?"bg-blue-200":"bg-gray-200"}`,children:l?t.jsx(li,{className:"w-8 h-8 text-blue-600"}):t.jsx($a,{className:"w-8 h-8 text-gray-500"})}),t.jsx("div",{className:"text-base font-medium text-gray-700 mb-2",children:l?"Drop BP diary image here":"Drop BP diary image or click to browse"}),t.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[t.jsx("p",{children:"Supports PNG, JPG, or PDF screenshots"}),t.jsx("p",{className:"text-xs",children:"Photos of handwritten BP diaries work best"})]})]})]})},fv=({readings:r,onReadingsChange:e,editable:s=!0})=>{const[n,a]=u.useState(null),[i,o]=u.useState(!1),[A,l]=u.useState({date:new Date().toISOString().split("T")[0],time:"07:00",sbp:"",dbp:"",hr:""}),c=u.useCallback((Q,v)=>{s&&a({readingId:Q,field:v})},[s]),d=u.useCallback((Q,v,x)=>{const f=parseInt(x,10);if(isNaN(f))return;const S=r.map(F=>F.id===Q?{...F,[v]:f}:F);e(S)},[r,e]),m=u.useCallback(()=>{a(null)},[]),g=u.useCallback(()=>{const Q=parseInt(A.sbp,10),v=parseInt(A.dbp,10),x=parseInt(A.hr,10);if(isNaN(Q)||isNaN(v)||isNaN(x)){alert("Please enter valid numbers for SBP, DBP, and HR");return}if((Q<60||Q>250||v<40||v>150||x<30||x>200)&&!confirm("Values seem unusual. Are you sure you want to add this reading?"))return;const S=parseInt(A.time.split(":")[0],10)<12?"morning":"evening",F={id:`bp-${Date.now()}-${Math.random().toString(36).substring(7)}`,date:A.date,time:A.time,timeOfDay:S,sbp:Q,dbp:v,hr:x,confidence:1,warnings:[]},w=[...r,F].sort((T,C)=>{const E=T.date.localeCompare(C.date);return E!==0?E:T.time.localeCompare(C.time)});e(w),l({date:new Date().toISOString().split("T")[0],time:"07:00",sbp:"",dbp:"",hr:""}),o(!1)},[A,r,e]),h=u.useCallback(Q=>{if(!confirm("Delete this reading? This action cannot be undone."))return;const v=r.filter(x=>x.id!==Q);e(v)},[r,e]),p=u.useCallback(()=>{o(!1),l({date:new Date().toISOString().split("T")[0],time:"07:00",sbp:"",dbp:"",hr:""})},[]),b=(Q=[])=>{const v=Q.some(f=>f.severity==="error"),x=Q.some(f=>f.severity==="warning");return v?t.jsx(Zt,{className:"w-4 h-4 text-red-600"}):x?t.jsx(ot,{className:"w-4 h-4 text-yellow-600"}):Q.length>0?t.jsx(Vt,{className:"w-4 h-4 text-blue-600"}):null},N=(Q,v)=>{const x=n?.readingId===Q.id&&n?.field===v,f=Q[v],S=Q.warnings?.filter(w=>w.field===v)||[],F=S.length>0;return x?t.jsx("input",{type:"number",defaultValue:f,autoFocus:!0,onBlur:w=>{d(Q.id,v,w.target.value),m()},onKeyDown:w=>{w.key==="Enter"?(d(Q.id,v,w.currentTarget.value),m()):w.key==="Escape"&&m()},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none",style:{minWidth:"60px"}}):t.jsxs("div",{className:`flex items-center justify-between gap-2 px-2 py-1 rounded ${s?"cursor-pointer hover:bg-gray-100":""} ${F?"bg-yellow-50":""}`,onClick:()=>c(Q.id,v),title:S.map(w=>w.message).join(`
`),children:[t.jsx("span",{className:"font-medium",children:f}),F&&b(S)]})},y=Q=>new Date(Q).toLocaleDateString("en-AU",{day:"numeric",month:"short"}),j=()=>r.reduce((Q,v)=>Q+(v.warnings?.length||0),0);return r.length===0?t.jsx("div",{className:"flex items-center justify-center h-32 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:t.jsx("p",{className:"text-gray-500 text-sm",children:"No readings to review"})}):t.jsxs("div",{className:"space-y-3",children:[s&&!i&&t.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition-colors border border-blue-200",children:[t.jsx(Uc,{className:"w-4 h-4"}),"Add New Reading"]}),s&&i&&t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"text-sm font-semibold text-blue-900",children:"Add New Reading"}),t.jsx("button",{onClick:p,className:"text-blue-600 hover:text-blue-800 transition-colors",children:t.jsx(nt,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Date"}),t.jsx("input",{type:"date",value:A.date,onChange:Q=>l({...A,date:Q.target.value}),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Time"}),t.jsx("input",{type:"time",value:A.time,onChange:Q=>l({...A,time:Q.target.value}),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"SBP (mmHg)"}),t.jsx("input",{type:"number",value:A.sbp,onChange:Q=>l({...A,sbp:Q.target.value}),placeholder:"120",min:"60",max:"250",className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"DBP (mmHg)"}),t.jsx("input",{type:"number",value:A.dbp,onChange:Q=>l({...A,dbp:Q.target.value}),placeholder:"80",min:"40",max:"150",className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"HR (bpm)"}),t.jsx("input",{type:"number",value:A.hr,onChange:Q=>l({...A,hr:Q.target.value}),placeholder:"70",min:"30",max:"200",className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(gr,{className:"w-4 h-4"}),"Add Reading"]}),t.jsx("button",{onClick:p,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"})]})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 bg-gray-50 px-4 py-2 rounded-lg",children:[t.jsxs("span",{children:[r.length," reading",r.length!==1?"s":""]}),j()>0&&t.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[t.jsx(ot,{className:"w-4 h-4"}),j()," warning",j()!==1?"s":""]})]}),t.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:t.jsxs("table",{className:"w-full text-xs table-fixed",children:[t.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700 w-[12%]",children:"Date"}),t.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700 w-[14%]",children:"Time"}),t.jsxs("th",{className:"px-2 py-2 text-center font-semibold text-gray-700 w-[19%]",children:[t.jsx("div",{children:"SBP"}),t.jsx("div",{className:"font-normal text-[10px] text-gray-500",children:"(mmHg)"})]}),t.jsxs("th",{className:"px-2 py-2 text-center font-semibold text-gray-700 w-[19%]",children:[t.jsx("div",{children:"DBP"}),t.jsx("div",{className:"font-normal text-[10px] text-gray-500",children:"(mmHg)"})]}),t.jsxs("th",{className:"px-2 py-2 text-center font-semibold text-gray-700 w-[20%]",children:[t.jsx("div",{children:"HR"}),t.jsx("div",{className:"font-normal text-[10px] text-gray-500",children:"(bpm)"})]}),s&&t.jsx("th",{className:"px-2 py-2 text-center font-semibold text-gray-700 w-[16%]",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:r.map(Q=>{const v=Q.confidence||1,x=v<.8,f=v<.65;let S="hover:bg-gray-50 transition-colors";return f?S="bg-red-50 hover:bg-red-100 transition-colors border-l-4 border-red-400":x&&(S="bg-yellow-50 hover:bg-yellow-100 transition-colors border-l-4 border-yellow-400"),t.jsxs("tr",{className:S,children:[t.jsx("td",{className:"px-2 py-2 text-gray-900",children:t.jsxs("div",{className:"flex items-center gap-2",children:[y(Q.date),x&&t.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-semibold ${f?"bg-red-200 text-red-800":"bg-yellow-200 text-yellow-800"}`,title:`Confidence: ${Math.round(v*100)}%`,children:[Math.round(v*100),"%"]})]})}),t.jsx("td",{className:"px-2 py-2 text-gray-700 font-mono text-xs",children:Q.time}),t.jsx("td",{className:"px-2 py-2 text-center",children:N(Q,"sbp")}),t.jsx("td",{className:"px-2 py-2 text-center",children:N(Q,"dbp")}),t.jsx("td",{className:"px-2 py-2 text-center",children:N(Q,"hr")}),s&&t.jsx("td",{className:"px-2 py-2 text-center",children:t.jsx("button",{onClick:()=>h(Q.id),className:"text-red-600 hover:text-red-800 hover:bg-red-50 p-1 rounded transition-colors",title:"Delete this reading",children:t.jsx(Er,{className:"w-4 h-4"})})})]},Q.id)})})]})}),s&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-yellow-50 border-l-2 border-yellow-400 rounded"}),t.jsx("span",{className:"text-gray-600",children:"Low confidence (<80%) - verify these first"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-50 border-l-2 border-red-400 rounded"}),t.jsx("span",{className:"text-gray-600",children:"Very low confidence (<65%) - likely incorrect"})]})]}),t.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Click any value to edit ‚Ä¢ Press Enter to save, Esc to cancel ‚Ä¢ Use trash icon to delete readings"})]}),j()>0&&t.jsx("div",{className:"mt-4 space-y-2",children:r.filter(Q=>Q.warnings&&Q.warnings.length>0).map(Q=>t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[t.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-1",children:[y(Q.date)," ",Q.time,":"]}),t.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:Q.warnings?.map((v,x)=>t.jsxs("li",{className:"flex items-start gap-2",children:[b([v]),t.jsx("span",{children:v.message})]},x))})]},Q.id))})]})},Pu=u.forwardRef(({readings:r,showReferenceLines:e=!0,referenceSBP:s=130,referenceDBP:n=80,width:a,height:i},o)=>{const A=u.useRef(null),l=u.useRef(null),[c,d]=u.useState(null),[m,g]=u.useState({width:a||600,height:i||350});u.useImperativeHandle(o,()=>({copyToClipboard:async()=>{await x()}})),u.useEffect(()=>{const f=()=>{if(l.current){const S=l.current.offsetWidth;g({width:a||Math.max(400,S-20),height:i||350})}};return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[a,i]),u.useEffect(()=>{h()},[r,e,s,n,m]);const h=u.useCallback(()=>{const f=A.current;if(!f||r.length===0)return;const S=f.getContext("2d");if(!S)return;const{width:F,height:w}=m,T=window.devicePixelRatio||1;f.width=F*T,f.height=w*T,f.style.width=`${F}px`,f.style.height=`${w}px`,S.scale(T,T),S.clearRect(0,0,F,w);const C={top:30,right:60,bottom:60,left:70},E=F-C.left-C.right,U=w-C.top-C.bottom,k=r.map(O=>O.sbp),P=r.map(O=>O.dbp),M=[...k,...P];e&&M.push(s,n);const $=Math.floor(Math.min(...M)/10)*10-10,W=Math.ceil(Math.max(...M)/10)*10+10,V=O=>C.left+O/(r.length-1)*E,L=O=>C.top+U-(O-$)/(W-$)*U;e&&(y(S,L(s),`SBP ${s}`,"#94a3b8",C,E),y(S,L(n),`DBP ${n}`,"#94a3b8",C,E)),j(S,C,E,U,$,W,r,w),b(S,r,k,V,L,"#1e293b"),b(S,r,P,V,L,"#475569"),r.forEach((O,z)=>{const H=V(z);N(S,H,L(O.sbp),"#1e293b"),N(S,H,L(O.dbp),"#475569")})},[r,e,s,n,m]),p=u.useCallback(f=>{if(h(),f===null||!A.current)return;const S=A.current.getContext("2d");if(!S)return;const{width:F,height:w}=m,T={top:30,right:60,bottom:60,left:70},C=F-T.left-T.right,E=w-T.top-T.bottom,U=r.map(z=>z.sbp),k=r.map(z=>z.dbp),P=[...U,...k];e&&P.push(s,n);const M=Math.floor(Math.min(...P)/10)*10-10,$=Math.ceil(Math.max(...P)/10)*10+10,W=z=>T.left+z/(r.length-1)*C,V=z=>T.top+E-(z-M)/($-M)*E,L=r[f],O=W(f);S.beginPath(),S.fillStyle="rgba(30, 41, 59, 0.2)",S.arc(O,V(L.sbp),8,0,Math.PI*2),S.fill(),S.beginPath(),S.fillStyle="rgba(71, 85, 105, 0.2)",S.arc(O,V(L.dbp),8,0,Math.PI*2),S.fill()},[r,e,s,n,m]),b=(f,S,F,w,T,C,E)=>{f.beginPath(),f.strokeStyle=C,f.lineWidth=2,S.forEach((U,k)=>{const P=w(k),M=T(F[k]);k===0?f.moveTo(P,M):f.lineTo(P,M)}),f.stroke()},N=(f,S,F,w)=>{f.beginPath(),f.fillStyle=w,f.arc(S,F,4,0,Math.PI*2),f.fill(),f.strokeStyle="#ffffff",f.lineWidth=2,f.stroke()},y=(f,S,F,w,T,C)=>{f.save(),f.setLineDash([5,5]),f.strokeStyle=w,f.lineWidth=1,f.beginPath(),f.moveTo(T.left,S),f.lineTo(T.left+C,S),f.stroke(),f.setLineDash([]),f.fillStyle=w,f.font="10px sans-serif",f.textAlign="left",f.fillText(F,T.left+5,S-5),f.restore()},j=(f,S,F,w,T,C,E,U)=>{f.strokeStyle="#cbd5e1",f.lineWidth=1,f.beginPath(),f.moveTo(S.left,S.top),f.lineTo(S.left,S.top+w),f.stroke(),f.beginPath(),f.moveTo(S.left,S.top+w),f.lineTo(S.left+F,S.top+w),f.stroke(),f.fillStyle="#64748b",f.font="12px sans-serif",f.textAlign="right";const k=5;for(let M=0;M<=k;M++){const $=T+(C-T)*(M/k),W=S.top+w-M/k*w;f.fillText(Math.round($).toString(),S.left-10,W+4)}f.textAlign="center",f.font="9px sans-serif";const P=Math.max(1,Math.ceil(E.length/6));E.forEach((M,$)=>{if($%P===0||$===E.length-1){const W=S.left+$/(E.length-1)*F,V=new Date(M.date),L=`${V.getDate()}/${V.getMonth()+1}`;f.fillText(L,W,S.top+w+15),f.font="8px monospace",f.fillText(M.time,W,S.top+w+27),f.font="9px sans-serif"}}),f.save(),f.translate(12,S.top+w/2),f.rotate(-Math.PI/2),f.textAlign="center",f.fillStyle="#475569",f.font="11px sans-serif",f.fillText("Blood Pressure (mmHg)",0,0),f.restore(),f.fillStyle="#475569",f.font="bold 13px sans-serif",f.textAlign="center",f.fillText("Date & Time",S.left+F/2,U-10)},Q=u.useCallback(f=>{if(r.length===0)return;const S=A.current,F=l.current;if(!S||!F)return;const w=S.getBoundingClientRect(),T=F.getBoundingClientRect(),C=f.clientX-w.left,{width:E}=m,U={right:60,left:70},k=E-U.left-U.right;if(C<U.left||C>U.left+k){d(null);return}const P=C-U.left,M=Math.round(P/k*(r.length-1)),$=Math.max(0,Math.min(M,r.length-1)),W=r[$];p($);const V=U.left+$/(r.length-1)*k,L=140,O=80;let z=V+10,H=f.clientY-T.top-O;z+L>T.width&&(z=V-L-10),H<0&&(H=f.clientY-T.top+10),d({visible:!0,x:z,y:H,reading:W,index:$})},[r,m,p]),v=u.useCallback(()=>{d(null),p(null)},[p]),x=async()=>{const f=A.current;if(!f){ce.getInstance().error("Copy failed","Chart not available");return}try{const S=await new Promise((F,w)=>{f.toBlob(T=>{T?F(T):w(new Error("Failed to create image"))},"image/png",1)});await navigator.clipboard.write([new ClipboardItem({"image/png":S})]),ce.getInstance().success("Chart copied","Paste into your document with Cmd+V (Mac) or Ctrl+V (Windows)")}catch(S){console.error("Failed to copy chart:",S),ce.getInstance().error("Copy failed","Your browser may not support clipboard images")}};return r.length===0?t.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:t.jsx("p",{className:"text-gray-500 text-sm",children:"No readings to display"})}):t.jsxs("div",{ref:l,className:"relative",children:[t.jsx("canvas",{ref:A,onMouseMove:Q,onMouseLeave:v,className:"cursor-crosshair",style:{maxWidth:"100%",height:"auto"}}),c&&c.visible&&t.jsxs("div",{className:"absolute z-50 bg-white border-2 border-gray-800 rounded shadow-lg p-2 pointer-events-none",style:{left:`${c.x}px`,top:`${c.y}px`,minWidth:"140px"},children:[t.jsxs("div",{className:"text-[10px] font-semibold text-gray-900 mb-1",children:[new Date(c.reading.date).toLocaleDateString("en-AU",{day:"numeric",month:"short"})," ",t.jsx("span",{className:"font-mono",children:c.reading.time})]}),t.jsxs("div",{className:"space-y-0.5 text-[10px]",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"SBP:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:c.reading.sbp})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"DBP:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:c.reading.dbp})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"HR:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:c.reading.hr})]})]})]})]})});Pu.displayName="BPChart";class Kr{static instance;lmStudioService;constructor(){this.lmStudioService=Jo.getInstance()}static getInstance(){return Kr.instance||(Kr.instance=new Kr),Kr.instance}getDefaultOCRModel(){return this.lmStudioService.getDefaultOCRModel()}getDefaultClinicalModel(){return this.lmStudioService.getDefaultClinicalReasoningModel()}async extractFromImage(e,s,n){const a=Date.now();try{const i=this.getDefaultOCRModel(),o=n||i,A=this.validateImage(e);if(A)return{success:!1,readings:[],error:A,processingTime:Date.now()-a};oe.info("Starting BP diary extraction",{component:"bp-extractor",imageSize:e.length,imageSizeMB:(e.length/(1024*1024)).toFixed(2),model:o,modelOverrideProvided:!!n});const l=this.buildExtractionPrompt(),c=await this.lmStudioService.processWithVisionAgent(this.getSystemPrompt(),l,e,"bp-diary-extraction",s,o);oe.info("Received LM Studio response",{component:"bp-extractor",responseLength:c.length,responsePreview:c.substring(0,100)});const d=c.trim();if(d==="[]"||d===""||d.length<3)return oe.warn("Vision model returned empty response",{component:"bp-extractor",response:d,modelUsed:o}),{success:!1,readings:[],error:`Vision model could not extract any readings from the image. This may indicate:

1. The model (${o}) may not be properly loaded with vision support in LM Studio
2. The image quality may be too poor for the model to read
3. The model may not support vision tasks (ensure you're using a vision-capable model such as Qwen3-VL, DeepSeek-OCR, LLaVA, or Gemma vision variants)

Troubleshooting:
- Verify your vision model is loaded in LM Studio with the correct GGUF files (including -mmproj files for vision support where required)
- Try a different vision-capable model from the dropdown
- Use the "Load Sample Data" button to test the chart and editing features`,processingTime:Date.now()-a};const m=this.parseResponse(c);if(m.length===0)return oe.warn("Parsing returned no readings",{component:"bp-extractor",responseLength:c.length}),{success:!1,readings:[],error:`Could not extract BP readings from the vision model response. The model may have misunderstood the task or the image may not contain recognizable BP diary data.

Try:
- Ensuring the image shows a clear BP diary table
- Using a different vision model
- Using the "Load Sample Data" button to test the features`,rawResponse:c,processingTime:Date.now()-a};const g=Date.now()-a;return oe.info("BP extraction complete",{component:"bp-extractor",readingsCount:m.length,processingTime:g,modelUsed:o}),{success:!0,readings:m,rawResponse:c,processingTime:g}}catch(i){const o=Date.now()-a,A=i instanceof Error?i.message:"Unknown error";return oe.error("BP extraction failed",{component:"bp-extractor",error:A,processingTime:o}),{success:!1,readings:[],error:A,processingTime:o}}}buildExtractionPrompt(){return`VISION TASK: You are analyzing a blood pressure diary photograph/screenshot. You must LOOK AT THE IMAGE and extract tabular data.

STEP 1: EXAMINE THE IMAGE COMPLETELY
- Look for a table with columns: Date, Time, Systolic BP (SBP), Diastolic BP (DBP), Heart Rate (HR)
- The table may be handwritten or printed
- Numbers are whole integers in mmHg (no decimals)
- SCAN THE ENTIRE IMAGE FROM TOP TO BOTTOM - do not stop early
- Count the number of rows visible in the table
- Dates may appear in various formats: DD/MM (e.g., "5/9", "16/10"), DD/MM/YYYY, or written out

STEP 2: EXTRACTION RULES (CRITICAL)
1. BOTTOM-NUMBER RULE: When a cell contains two stacked values (e.g., "160\\n156" or "160/156"), you MUST select the BOTTOM value only. This is non-negotiable.

2. READ EACH CELL INDEPENDENTLY: This is CRITICAL to avoid duplication errors.
   - Do NOT copy dates/times from previous rows
   - Look at EACH cell individually and read what you see
   - If two rows look similar, double-check - they should have different dates or times
   - Common mistake: copying "16 Oct" and "23:49" to multiple rows - AVOID THIS!

3. EXTRACT EVERY ROW: Extract ALL readings visible in the image, even if some values are slightly unclear. Make your BEST GUESS rather than skipping a row.

4. HANDWRITING TOLERANCE: For handwritten diaries:
   - If a number could be 5 or 6, pick the most likely
   - If a date format is abbreviated (e.g., "5/9"), assume current or previous year
   - If time is partially unclear, use context (am/pm notation)
   - Confidence should reflect uncertainty (0.6-0.8 for unclear values)
   - IMPORTANT: Each row should have DIFFERENT date or time values

5. DATE FORMATS: Accept and convert all these formats to YYYY-MM-DD:
   - "16/10" ‚Üí "2025-10-16" (assume current year if not specified)
   - "5/9" ‚Üí "2025-09-05" (DD/MM format, assume September 5th)
   - "14/9/2025" ‚Üí "2025-09-14"
   - Written dates ‚Üí convert to YYYY-MM-DD
   - WATCH OUT: Dates often change between rows - don't duplicate!

6. TIME FORMATS: Extract EXACT time in HH:MM (24-hour clock)
   - "4:22 am" ‚Üí "04:22"
   - "10.16 am" ‚Üí "10:16"
   - "3:21 pm" ‚Üí "15:21"
   - "9:55" ‚Üí assume context (am/pm)
   - WARNING: Times should vary between readings - check each cell carefully!

7. COMPLETE SCAN: Do not stop until you have checked every visible row in the table, even if you've already found 10+ readings

STEP 3: OUTPUT FORMAT
Return ONLY a JSON array with this exact structure (no markdown, no code blocks, no explanations):

EXAMPLE OUTPUT (if image shows these readings):
[
  {
    "date": "2025-10-16",
    "time": "04:22",
    "sbp": 150,
    "dbp": 94,
    "hr": 95,
    "confidence": 0.95
  },
  {
    "date": "2025-10-16",
    "time": "10:16",
    "sbp": 146,
    "dbp": 91,
    "hr": 89,
    "confidence": 0.90
  },
  {
    "date": "2025-10-16",
    "time": "13:40",
    "sbp": 130,
    "dbp": 82,
    "hr": 91,
    "confidence": 0.85
  }
]

CRITICAL REMINDERS:
- Extract EVERY row you can see - aim for 100% coverage
- READ EACH CELL INDEPENDENTLY - do not copy values from nearby rows
- Dates and times should be DIFFERENT for each row (unless truly identical in the image)
- Make your best guess for unclear values rather than skipping them
- Lower confidence (0.6-0.8) for uncertain readings is better than no reading
- Scan the ENTIRE image before returning results
- If you see duplicate dates/times in your output, GO BACK and re-read those cells carefully
- If the image is completely unreadable or contains no BP table, ONLY THEN return an empty array: []

Now, examine the provided image and extract ALL visible blood pressure readings following the rules above.`}getSystemPrompt(){return`You are a medical data extraction specialist with vision capabilities, specialized in analyzing blood pressure diary images.

Your task is to:
1. LOOK AT the provided image carefully and SCAN THE ENTIRE IMAGE from top to bottom
2. Identify tabular data containing BP readings (Date, Time, SBP, DBP, HR)
3. Extract EVERY SINGLE visible reading - do not skip rows even if handwriting is unclear
4. Make your best guess for unclear values rather than omitting them (use lower confidence scores for uncertainty)
5. Apply the BOTTOM-NUMBER RULE when cells contain stacked values
6. Preserve EXACT timestamps (HH:MM format) - never simplify to morning/evening
7. Handle various date formats: DD/MM, DD/MM/YYYY, written dates
8. Maintain chronological order

CRITICAL: Aim for 100% extraction coverage. Extract every row you can identify, even if values are partially unclear.

Return ONLY structured JSON array data without any markdown formatting, code blocks, or explanatory text.
If you cannot see or process the image at all, return an empty array [].`}async generateClinicalInsights(e,s){if(e.length===0)return{controlSummary:"No readings supplied for analysis",diurnalPattern:"Insufficient data for diurnal assessment",variabilityConcern:"Insufficient data for variability assessment",keyRecommendations:["Provide home BP readings before attempting analysis"]};const{signal:n,modelOverride:a,medicationsText:i,backgroundText:o}=s||{},A="You are a hypertension and cardiovascular risk clinician in Australia. You receive home blood pressure monitoring data and the current medication list. You must: (1) assess overall BP control using home thresholds (135/85), (2) comment on morning vs evening readings, (3) detect high variability, (4) relate control to the medications supplied (e.g. ACEi, ARB, CCB, thiazide, beta-blocker), (5) suggest next clinical steps such as ABPM, adherence check, timing adjustment or intensification, and (6) generate a short paragraph for the patient in Australian English. Use Australian spelling in every response.",l=this.calculateBasicStats(e),c=this.buildInsightsPrompt(e,l,{medicationsText:i,backgroundText:o}),d=this.getDefaultClinicalModel();if(a)try{const g=await this.lmStudioService.processWithAgent(A,c,"bp-diary-insights",n,a);return this.parseInsightsResponse(g)}catch(g){oe.warn("Failed to generate BP insights with override model, falling back to default clinical reasoning model",{component:"bp-extractor",model:a,error:g instanceof Error?g.message:"Unknown error"})}const m=await this.lmStudioService.processWithAgent(A,c,"bp-diary-insights",n,d);return this.parseInsightsResponse(m)}buildInsightsPrompt(e,s,n){const a=e.map(A=>`${A.date} ${A.time}: ${A.sbp}/${A.dbp} mmHg, HR ${A.hr}`).join(`
`),i=n?.medicationsText?.trim()?n.medicationsText.trim():"No medications supplied.",o=n?.backgroundText?.trim()?n.backgroundText.trim():"No additional background supplied.";return`You will receive structured home blood pressure readings and limited clinical context. Analyse the data and respond with JSON only.

READINGS:
${a}

SUMMARY STATISTICS:
- Count: ${s.count}
- Average: ${s.avgSBP}/${s.avgDBP} mmHg (HR ${s.avgHR})
- SBP Range: ${s.minSBP}-${s.maxSBP} mmHg
- DBP Range: ${s.minDBP}-${s.maxDBP} mmHg
- Readings ‚â•135/85: ${s.aboveTarget}/${s.count} (${s.percentAboveTarget}%)

CLINICAL CONTEXT:
- Medications: ${i}
- Background: ${o}

Return ONLY JSON using this schema:
{
  "controlSummary": "Overall BP control referencing home threshold (135/85)",
  "diurnalPattern": "Morning vs evening commentary or "Insufficient data"",
  "variabilityConcern": "Variability assessment referencing observed range",
  "keyRecommendations": ["Clinician-facing next steps in plain text"],
  "medicationRationale": "How current regimen explains control or gaps; say "No medications supplied" if none provided",
  "abpmSuggestion": "Specific statement on ABPM / adherence / follow-up timing",
  "patientParagraph": "Short patient-friendly paragraph (Australian English, plain text)",
  "peakTimes": "Times with highest readings if pattern evident",
  "lowestTimes": "Times with best control if pattern evident"
}

Constraints:
- Use Australian spelling.
- Tie recommendations to supplied medications where possible.
- Mention explicitly if medications or background were not provided.
- Do not include markdown, explanations, or additional text outside the JSON object.`}parseInsightsResponse(e){try{let s=e.trim();s.startsWith("```")&&(s=s.replace(/```json\n?/g,"").replace(/```\n?/g,""));const n=JSON.parse(s),a=n&&typeof n=="object"&&"insights"in n?n.insights:n;if(!a||typeof a!="object")throw new Error("Insights payload was not an object");const i=(d,m)=>typeof d=="string"&&d.trim().length>0?d.trim():m,o=d=>{if(typeof d=="string"&&d.trim().length>0)return d.trim()};let A=[];const l=a.keyRecommendations;Array.isArray(l)?A=l.map(d=>{if(typeof d=="string")return d.trim();if(d&&typeof d=="object")try{return JSON.stringify(d)}catch{return""}return String(d??"")}).filter(d=>d.length>0):typeof l=="string"&&l.trim().length>0&&(A=l.split(/\n|;/).map(d=>d.trim()).filter(Boolean)),A.length===0&&(A=["Review readings with healthcare provider"]);const c=a;return{controlSummary:i(c.controlSummary,"Unable to assess"),diurnalPattern:i(c.diurnalPattern,"Insufficient data for pattern analysis"),variabilityConcern:i(c.variabilityConcern,"Unable to assess"),keyRecommendations:A,peakTimes:o(c.peakTimes),lowestTimes:o(c.lowestTimes),patientParagraph:o(c.patientParagraph),medicationRationale:o(c.medicationRationale),abpmSuggestion:o(c.abpmSuggestion)}}catch(s){return oe.error("Failed to parse insights response",{component:"bp-extractor",error:s instanceof Error?s.message:"Parse error",response:e.substring(0,200)}),{controlSummary:"Analysis unavailable",diurnalPattern:"Analysis unavailable",variabilityConcern:"Analysis unavailable",keyRecommendations:["Review readings with healthcare provider"]}}}calculateBasicStats(e){const s=e.map(p=>p.sbp),n=e.map(p=>p.dbp),a=e.map(p=>p.hr),i=Math.round(s.reduce((p,b)=>p+b,0)/s.length),o=Math.round(n.reduce((p,b)=>p+b,0)/n.length),A=a.length>0?Math.round(a.reduce((p,b)=>p+b,0)/a.length):0,l=Math.min(...s),c=Math.max(...s),d=Math.min(...n),m=Math.max(...n),g=e.filter(p=>p.sbp>=135||p.dbp>=85).length,h=Math.round(g/e.length*100);return{count:e.length,avgSBP:i,avgDBP:o,avgHR:A,minSBP:l,maxSBP:c,minDBP:d,maxDBP:m,aboveTarget:g,percentAboveTarget:h}}parseResponse(e){try{let s=e.trim();s.startsWith("```")&&(s=s.replace(/```json\n?/g,"").replace(/```\n?/g,""));const n=JSON.parse(s);return Array.isArray(n)?n.map((i,o)=>{const A=String(i.time||"00:00");return{id:`bp-${Date.now()}-${o}`,date:this.normalizeDate(String(i.date||"")),time:this.normalizeTime(A),timeOfDay:this.deriveTimeOfDay(A),sbp:this.parseNumber(i.sbp),dbp:this.parseNumber(i.dbp),hr:this.parseNumber(i.hr),confidence:typeof i.confidence=="number"?i.confidence:.8,warnings:[]}}):(oe.warn("Response is not an array",{component:"bp-extractor"}),[])}catch(s){return oe.error("Failed to parse extraction response",{component:"bp-extractor",error:s instanceof Error?s.message:"Parse error",response:e.substring(0,200)}),[]}}normalizeDate(e){if(!e)return new Date().toISOString().split("T")[0];if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const s=e.match(/(\d{1,2})[/-](\d{1,2})(?:[/-](\d{2,4}))?/);if(s){const n=s[1].padStart(2,"0"),a=s[2].padStart(2,"0");return`${s[3]?s[3].length===2?`20${s[3]}`:s[3]:new Date().getFullYear().toString()}-${a}-${n}`}return new Date().toISOString().split("T")[0]}normalizeTime(e){if(!e)return"00:00";if(/^\d{2}:\d{2}$/.test(e))return e;const s=e.match(/(\d{1,2}):(\d{2})/);if(s){const n=s[1].padStart(2,"0"),a=s[2];return`${n}:${a}`}return"00:00"}deriveTimeOfDay(e){return parseInt(e.split(":")[0],10)<12?"morning":"evening"}parseNumber(e){if(typeof e=="number")return e;if(!e)return 0;const s=String(e).trim(),n=s.match(/(\d+)[\n/\\,](\d+)/);if(n)return parseInt(n[2],10);const a=s.match(/\d+/);return a?parseInt(a[0],10):0}validateImage(e){if(!e||e.length===0)return"No image data provided";if(!e.startsWith("data:image/"))return'Invalid image format. Expected data URL starting with "data:image/"';const s=e.substring(5,e.indexOf(";"));if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s))return`Unsupported image type: ${s}. Supported types: JPEG, PNG, WebP`;const i=e.length/(1024*1024);return i>10?`Image too large (${i.toFixed(1)}MB). Maximum size is 10MB. Please compress or resize the image.`:(i>5&&oe.warn("Large image detected",{component:"bp-extractor",sizeMB:i.toFixed(2),message:"Image is large and may take longer to process or fail with some models"}),null)}}const Wo={showReferenceLines:!0,referenceSBP:135,referenceDBP:85,dateFormat:"dd/MM",assumeCurrentYear:!0,sbpControlTarget:130,sbpControlGoal:90},gt={sbp:{min:70,max:260},dbp:{min:40,max:160},hr:{min:30,max:200}};class Es{static instance;constructor(){}static getInstance(){return Es.instance||(Es.instance=new Es),Es.instance}validateReading(e){const s=[];let n=!1,a={...e};if((a.sbp<gt.sbp.min||a.sbp>gt.sbp.max)&&s.push({type:"range",field:"sbp",message:`SBP ${a.sbp} is outside typical range (${gt.sbp.min}-${gt.sbp.max} mmHg)`,severity:"warning"}),(a.dbp<gt.dbp.min||a.dbp>gt.dbp.max)&&s.push({type:"range",field:"dbp",message:`DBP ${a.dbp} is outside typical range (${gt.dbp.min}-${gt.dbp.max} mmHg)`,severity:"warning"}),(a.hr<gt.hr.min||a.hr>gt.hr.max)&&s.push({type:"range",field:"hr",message:`HR ${a.hr} is outside typical range (${gt.hr.min}-${gt.hr.max} bpm)`,severity:"warning"}),a.dbp>a.sbp)if(this.shouldSwapValues(a.sbp,a.dbp)){const i=a.sbp;a.sbp=a.dbp,a.dbp=i,n=!0,s.push({type:"swapped",field:"sbp",message:"Swapped SBP/DBP (DBP was greater than SBP)",severity:"info"})}else s.push({type:"relational",field:"dbp",message:`DBP ${a.dbp} is greater than SBP ${a.sbp} (unusual)`,severity:"error"});return a.sbp===0&&s.push({type:"missing",field:"sbp",message:"SBP value is missing or zero",severity:"error"}),a.dbp===0&&s.push({type:"missing",field:"dbp",message:"DBP value is missing or zero",severity:"error"}),a.warnings=s,{valid:s.filter(i=>i.severity==="error").length===0,reading:a,warnings:s,modified:n}}validateAndSort(e){return e.map(n=>this.validateReading(n).reading).sort((n,a)=>{const i=n.date.localeCompare(a.date);if(i!==0)return i;const o=parseInt(n.time.replace(":",""),10),A=parseInt(a.time.replace(":",""),10);return o-A})}shouldSwapValues(e,s){if(s<=e)return!1;const n=s>=gt.sbp.min&&s<=gt.sbp.max,a=e>=gt.dbp.min&&e<=gt.dbp.max,i=s-e,o=i>=20&&i<=100;return n&&a&&o}getStatistics(e,s=130){if(e.length===0)return{count:0,avgSBP:0,avgDBP:0,avgHR:0,minSBP:0,maxSBP:0,minDBP:0,maxDBP:0,aboveTarget:0,percentAboveTarget:0,sbpBelowTarget:0,percentSBPBelowTarget:0};const n=e.map(m=>m.sbp),a=e.map(m=>m.dbp),i=e.map(m=>m.hr),o=this.average(n),A=this.average(a),l=this.average(i),c=e.filter(m=>m.sbp>=135||m.dbp>=85).length,d=e.filter(m=>m.sbp<s).length;return{count:e.length,avgSBP:Math.round(o),avgDBP:Math.round(A),avgHR:Math.round(l),minSBP:Math.min(...n),maxSBP:Math.max(...n),minDBP:Math.min(...a),maxDBP:Math.max(...a),aboveTarget:c,percentAboveTarget:Math.round(c/e.length*100),sbpBelowTarget:d,percentSBPBelowTarget:Math.round(d/e.length*100)}}normalizeDate(e,s=!0){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const n=e.match(/(\d{1,2})[/-](\d{1,2})(?:[/-](\d{2,4}))?/);if(n){const a=n[1].padStart(2,"0"),i=n[2].padStart(2,"0");let o=n[3];return!o&&s?o=new Date().getFullYear().toString():o&&o.length===2&&(o=`20${o}`),`${o}-${i}-${a}`}return new Date().toISOString().split("T")[0]}average(e){return e.length===0?0:e.reduce((s,n)=>s+n,0)/e.length}applyBottomNumberRule(e){const s=e.match(/(\d+)[\n/\\,\s](\d+)/);if(s)return parseInt(s[2],10);const n=e.match(/\d+/);return n?parseInt(n[0],10):0}}const wt={LATEST_SESSION:"bp-diary-latest",SETTINGS:"bp-diary-settings",HISTORY:"bp-diary-history"},tc=10;class Fs{static instance;constructor(){}static getInstance(){return Fs.instance||(Fs.instance=new Fs),Fs.instance}async saveSession(e){try{await chrome.storage.local.set({[wt.LATEST_SESSION]:e}),oe.info("BP diary session saved",{component:"bp-storage",sessionId:e.id,readingsCount:e.readings.length}),await this.addToHistory(e)}catch(s){throw oe.error("Failed to save BP diary session",{component:"bp-storage",error:s instanceof Error?s.message:"Unknown error"}),s}}async loadLatestSession(){try{const s=(await chrome.storage.local.get(wt.LATEST_SESSION))[wt.LATEST_SESSION];return s&&oe.info("BP diary session loaded",{component:"bp-storage",sessionId:s.id,readingsCount:s.readings.length}),s||null}catch(e){return oe.error("Failed to load BP diary session",{component:"bp-storage",error:e instanceof Error?e.message:"Unknown error"}),null}}async clearLatestSession(){try{await chrome.storage.local.remove(wt.LATEST_SESSION),oe.info("BP diary latest session cleared",{component:"bp-storage"})}catch(e){oe.error("Failed to clear BP diary session",{component:"bp-storage",error:e instanceof Error?e.message:"Unknown error"})}}async saveSettings(e){try{await chrome.storage.local.set({[wt.SETTINGS]:e}),oe.info("BP diary settings saved",{component:"bp-storage"})}catch(s){throw oe.error("Failed to save BP diary settings",{component:"bp-storage",error:s instanceof Error?s.message:"Unknown error"}),s}}async loadSettings(){try{return(await chrome.storage.local.get(wt.SETTINGS))[wt.SETTINGS]||Wo}catch(e){return oe.error("Failed to load BP diary settings",{component:"bp-storage",error:e instanceof Error?e.message:"Unknown error"}),Wo}}async addToHistory(e){try{let n=(await chrome.storage.local.get(wt.HISTORY))[wt.HISTORY]||[];n.unshift(e),n.length>tc&&(n=n.slice(0,tc)),await chrome.storage.local.set({[wt.HISTORY]:n})}catch(s){oe.warn("Failed to add session to history",{component:"bp-storage",error:s instanceof Error?s.message:"Unknown error"})}}async loadHistory(){try{return(await chrome.storage.local.get(wt.HISTORY))[wt.HISTORY]||[]}catch(e){return oe.error("Failed to load BP diary history",{component:"bp-storage",error:e instanceof Error?e.message:"Unknown error"}),[]}}async clearAll(){try{await chrome.storage.local.remove([wt.LATEST_SESSION,wt.SETTINGS,wt.HISTORY]),oe.info("All BP diary data cleared",{component:"bp-storage"})}catch(e){throw oe.error("Failed to clear BP diary data",{component:"bp-storage",error:e instanceof Error?e.message:"Unknown error"}),e}}}const xv=({isOpen:r,onClose:e})=>{const[s,n]=u.useState(null),[a,i]=u.useState([]),[o,A]=u.useState("idle"),[l,c]=u.useState(""),[d,m]=u.useState(Wo),[g,h]=u.useState(!1),[p,b]=u.useState(()=>Kr.getInstance().getDefaultOCRModel()),[N,y]=u.useState([]),[j,Q]=u.useState(!1),[v,x]=u.useState(null),[f,S]=u.useState(!1),[F,w]=u.useState(null),[T,C]=u.useState(null),[E,U]=u.useState(()=>{const Z=Kr.getInstance();return{extraction:Z.getDefaultOCRModel(),reasoning:Z.getDefaultClinicalModel()}}),k=u.useRef(null),P=u.useRef(Kr.getInstance()),M=u.useRef(Es.getInstance()),$=u.useRef(Fs.getInstance()),W=u.useRef(Jo.getInstance()),V=u.useRef(0);u.useEffect(()=>{L(),O()},[]);const L=async()=>{const Z=await $.current.loadSettings();m(Z)},O=async()=>{const Z=P.current.getDefaultOCRModel(),we=(await W.current.getAvailableModels()).filter(J=>{const Y=J.toLowerCase();return Y.includes("llava")||Y.includes("gemma")||Y.includes("vision")||Y.includes("qwen")&&Y.includes("vl")||Y.includes("minicpm")||Y.includes("pixtral")||Y.includes("phi-3-vision")||Y.includes("molmo")||Y.includes("deepseek")||Y.includes("ocr")}),ye=Array.from(new Set([Z,...we]));y(ye);const Ne=[Z,"qwen/qwen3-vl-8b","google/gemma-3n-e4b","medgemma-4b-it-mlx","llava-v1.6","llava-v1.5"];let Be=Z;for(const J of Ne){const Y=ye.find(fe=>fe.includes(J));if(Y){Be=Y;break}}!ye.includes(Be)&&ye.length>0&&(Be=ye[0]),b(Be)},z=u.useCallback(async()=>{const Z={};if(typeof chrome>"u"||!chrome.runtime?.sendMessage)return Z;try{const be=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}});if(!be?.success||!be?.data)return Z;const we=be.data,ye=[we.medications,we.medications_emr,we.currentMedications,we.meds_snapshot].filter(Boolean),Ne=Y=>{if(!Y)return"";if(typeof Y=="string")return Y.trim();if(Array.isArray(Y))return Y.map(Ne).filter(Boolean).join(`
`);if(typeof Y=="object"){const fe=Y;return["name","dose","frequency","route","indication"].map(Ie=>typeof fe[Ie]=="string"?fe[Ie].trim():"").filter(Boolean).join(" ").trim()}return String(Y)};for(const Y of ye){const fe=Ne(Y);if(fe.trim().length>0){Z.medicationsText=fe.trim();break}}const Be=[we.background,we.problemList,we.problems,we.history,we.medicalHistory].filter(Boolean),J=Y=>{if(!Y)return"";if(typeof Y=="string")return Y.trim();if(Array.isArray(Y))return Y.map(J).filter(Boolean).join(`
`);if(typeof Y=="object")try{return JSON.stringify(Y)}catch{return""}return String(Y)};for(const Y of Be){const fe=J(Y);if(fe.trim().length>0){Z.backgroundText=fe.trim();break}}}catch(be){console.warn("Failed to fetch clinical context for BP diary insights",be)}return Z},[]),H=u.useCallback(async(Z,be)=>{if(Z.length===0){x(null),w(null),S(!1);return}const we=++V.current;S(!0),w(null);try{const ye=be??await z();if(V.current!==we)return;C(ye);const Ne=P.current,Be=Ne.getDefaultClinicalModel(),J=await Ne.generateClinicalInsights(Z,{medicationsText:ye.medicationsText,backgroundText:ye.backgroundText});if(V.current!==we)return;x(J),U(Y=>({extraction:Y.extraction,reasoning:Be}))}catch(ye){if(V.current!==we)return;const Ne=ye instanceof Error?ye.message:"Unable to generate clinical insights";x(null),w(Ne),ce.getInstance().warning("Clinical insights unavailable",Ne)}finally{V.current===we&&S(!1)}},[z]),X=u.useCallback(async Z=>{n(Z),A("extracting"),c(""),x(null),w(null),C(null);try{const be=P.current,we=be.getDefaultClinicalModel(),ye=p||be.getDefaultOCRModel(),Ne=await be.extractFromImage(Z,void 0,p);if(!Ne.success||Ne.readings.length===0){A("error"),c(Ne.error||"No readings could be extracted from the image"),ce.getInstance().error("Extraction failed","Could not extract BP readings from the image");return}A("validating");const Be=M.current.validateAndSort(Ne.readings);i(Be),U({extraction:ye,reasoning:we}),A("ready"),ce.getInstance().success("Extraction complete",`Found ${Be.length} BP reading${Be.length!==1?"s":""}`),H(Be)}catch(be){A("error");const we=be instanceof Error?be.message:"Unknown error";c(we),ce.getInstance().error("Processing failed",we)}},[H,p]),Ae=u.useCallback(Z=>{const be=M.current.validateAndSort(Z);i(be)},[]),D=u.useCallback(()=>{a.length!==0&&H(a)},[H,a]),K=u.useCallback(()=>{const Z=P.current;n(null),i([]),x(null),w(null),S(!1),C(null),U({extraction:Z.getDefaultOCRModel(),reasoning:Z.getDefaultClinicalModel()}),b(Z.getDefaultOCRModel()),A("idle"),c("")},[]),ee=u.useCallback(async()=>{if(a.length!==0)try{const Z=P.current,be={id:`bp-session-${Date.now()}`,timestamp:Date.now(),imageDataUrl:s||"",readings:a,settings:d,insights:v??null,modelsUsed:{extraction:E.extraction||Z.getDefaultOCRModel(),reasoning:E.reasoning||Z.getDefaultClinicalModel()}};T&&(T.medicationsText||T.backgroundText)&&(be.clinicalContext=T),await $.current.saveSession(be),await $.current.saveSettings(d),ce.getInstance().success("Saved","BP diary session saved successfully")}catch(Z){ce.getInstance().error("Save failed",Z instanceof Error?Z.message:"Unknown error")}},[T,s,v,E,a,d]),pe=u.useCallback(async()=>{const Z=await $.current.loadLatestSession();if(!Z){ce.getInstance().info("No saved session","No previous BP diary found");return}n(Z.imageDataUrl),i(Z.readings),m(Z.settings),x(Z.insights??null),C(Z.clinicalContext??null),S(!1),w(null),U({extraction:Z.modelsUsed?.extraction||P.current.getDefaultOCRModel(),reasoning:Z.modelsUsed?.reasoning||P.current.getDefaultClinicalModel()}),Z.modelsUsed?.extraction&&b(Z.modelsUsed.extraction),A("ready"),h(!1),ce.getInstance().success("Loaded","Previous BP diary loaded")},[]),ae=u.useCallback(()=>{const Z=M.current.getStatistics(a,d.sbpControlTarget),be={exportDate:new Date().toISOString(),readingsCount:a.length,statistics:Z,settings:{sbpControlTarget:d.sbpControlTarget,sbpControlGoal:d.sbpControlGoal,referenceSBP:d.referenceSBP,referenceDBP:d.referenceDBP},readings:a.map(J=>({date:J.date,time:J.time,sbp:J.sbp,dbp:J.dbp,hr:J.hr})),insights:v,modelsUsed:E};T&&(T.medicationsText||T.backgroundText)&&(be.clinicalContext=T);const we=JSON.stringify(be,null,2),ye=new Blob([we],{type:"application/json"}),Ne=URL.createObjectURL(ye),Be=document.createElement("a");Be.href=Ne,Be.download=`bp-diary-${new Date().toISOString().split("T")[0]}.json`,Be.click(),URL.revokeObjectURL(Ne),ce.getInstance().success("Exported","BP diary exported as JSON")},[T,v,E,a,d]),me=u.useCallback(()=>{const Z=[];Z.push("Date,Time,SBP (mmHg),DBP (mmHg),HR (bpm)"),a.forEach(Be=>{Z.push(`${Be.date},${Be.time},${Be.sbp},${Be.dbp},${Be.hr}`)});const be=Z.join(`
`),we=new Blob([be],{type:"text/csv"}),ye=URL.createObjectURL(we),Ne=document.createElement("a");Ne.href=ye,Ne.download=`bp-diary-${new Date().toISOString().split("T")[0]}.csv`,Ne.click(),URL.revokeObjectURL(ye),ce.getInstance().success("Exported","BP diary exported as CSV")},[a]),le=u.useCallback(async()=>{k.current&&await k.current.copyToClipboard()},[]),re=u.useCallback(()=>{m(Z=>({...Z,showReferenceLines:!Z.showReferenceLines}))},[]);if(!r)return null;const te=P.current.getDefaultOCRModel(),he=P.current.getDefaultClinicalModel(),Ce=E.reasoning||he,ge=a.length>0?M.current.getStatistics(a,d.sbpControlTarget):null;return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-7xl w-full max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"BP Diary Importer"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upload a photo of your BP diary for automatic extraction, then review, edit, add, or delete readings"})]}),t.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(nt,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[o==="idle"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Mc,{className:"w-4 h-4 text-blue-700"}),t.jsx("h3",{className:"text-sm font-semibold text-blue-900",children:"Vision Model"})]}),!j&&t.jsx("button",{onClick:()=>Q(!0),className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"Change"})]}),j?t.jsxs("div",{className:"space-y-2",children:[N.length>0?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:p,onChange:Z=>b(Z.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:N.map(Z=>t.jsx("option",{value:Z,children:Z},Z))}),t.jsx("p",{className:"text-xs text-gray-600",children:"‚úì Showing only vision-capable models (LLaVA, Gemma, Qwen2-VL, etc.)"})]}):t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:[t.jsx("p",{className:"text-xs text-yellow-800 font-semibold mb-1",children:"‚ö†Ô∏è No vision models detected"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Load a vision model in LM Studio (e.g., LLaVA, Gemma-3n, Qwen2-VL)"})]}),t.jsx("button",{onClick:()=>Q(!1),className:"text-xs text-blue-600 hover:text-blue-800",children:"Done"})]}):t.jsxs("div",{className:"text-sm text-gray-700",children:["Using: ",t.jsx("span",{className:"font-mono font-semibold text-blue-700",children:p})]})]}),t.jsx(hv,{onImageSelect:X,currentImage:s,onClearImage:K}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[t.jsx(Jt,{className:"w-4 h-4"}),"Load Last Session"]})})]}),(o==="extracting"||o==="validating")&&t.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[t.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),t.jsx("p",{className:"text-gray-700 font-medium",children:o==="extracting"?"Extracting readings from image...":"Validating data..."}),t.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This typically takes 10-30 seconds"})]}),o==="error"&&t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[t.jsx("div",{className:"text-yellow-800 font-semibold mb-2 text-center",children:"‚ö†Ô∏è Vision/OCR Not Yet Supported"}),t.jsx("p",{className:"text-sm text-gray-700 mb-4 text-center",children:l}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-4 text-sm",children:[t.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:"Workaround Options:"}),t.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-gray-600",children:[t.jsx("li",{children:"Use the sample data button below to test the chart and editing features"}),t.jsx("li",{children:"Manually enter your BP readings by editing the sample data"}),t.jsxs("li",{children:["To enable OCR: install Tesseract.js (",t.jsx("code",{className:"bg-gray-100 px-1 rounded text-xs",children:"npm install tesseract.js"}),")"]})]})]}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{onClick:K,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Clear & Start Over"}),t.jsx("button",{onClick:()=>{i([{id:"1",date:"2025-09-09",time:"07:15",timeOfDay:"morning",sbp:144,dbp:85,hr:58,warnings:[]},{id:"2",date:"2025-09-10",time:"06:44",timeOfDay:"morning",sbp:137,dbp:85,hr:60,warnings:[]},{id:"3",date:"2025-09-11",time:"08:24",timeOfDay:"morning",sbp:146,dbp:81,hr:64,warnings:[]},{id:"4",date:"2025-09-12",time:"07:02",timeOfDay:"morning",sbp:123,dbp:87,hr:80,warnings:[]},{id:"5",date:"2025-09-15",time:"06:55",timeOfDay:"morning",sbp:140,dbp:87,hr:62,warnings:[]},{id:"6",date:"2025-09-16",time:"19:21",timeOfDay:"evening",sbp:136,dbp:88,hr:61,warnings:[]},{id:"7",date:"2025-09-17",time:"07:33",timeOfDay:"morning",sbp:140,dbp:85,hr:59,warnings:[]},{id:"8",date:"2025-09-24",time:"18:45",timeOfDay:"evening",sbp:144,dbp:87,hr:61,warnings:[]},{id:"9",date:"2025-09-25",time:"06:12",timeOfDay:"morning",sbp:140,dbp:84,hr:65,warnings:[]},{id:"10",date:"2025-09-26",time:"20:18",timeOfDay:"evening",sbp:140,dbp:81,hr:59,warnings:[]},{id:"11",date:"2025-09-28",time:"07:41",timeOfDay:"morning",sbp:143,dbp:87,hr:60,warnings:[]},{id:"12",date:"2025-09-29",time:"19:05",timeOfDay:"evening",sbp:145,dbp:88,hr:55,warnings:[]}]),A("ready"),ce.getInstance().info("Sample data loaded","12 readings - test UI layout")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Load Sample Data (12 readings)"})]})]}),o==="ready"&&a.length>0&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Vt,{className:"w-5 h-5 text-blue-700"}),t.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Clinical Insights"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-blue-800",children:[t.jsxs("span",{children:["Models:¬†",t.jsxs("span",{className:"font-mono",children:[E.extraction||te," ‚Üí ",Ce]})]}),f&&t.jsx("span",{className:"text-blue-600",children:"MedGemma-27B running‚Ä¶"}),!f&&v&&t.jsx("span",{className:"text-blue-600",children:"MedGemma insights ready"})]}),T&&(T.medicationsText||T.backgroundText)&&t.jsxs("div",{className:"bg-white/70 border border-blue-100 rounded-lg p-3 space-y-2",children:[T.medicationsText&&t.jsxs("div",{children:[t.jsx("div",{className:"text-[11px] font-semibold text-blue-900 uppercase tracking-wide",children:"Medications"}),t.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-line",children:T.medicationsText})]}),T.backgroundText&&t.jsxs("div",{children:[t.jsx("div",{className:"text-[11px] font-semibold text-blue-900 uppercase tracking-wide",children:"Background"}),t.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-line",children:T.backgroundText})]})]}),f&&t.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center gap-3 border border-blue-100",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsx("div",{className:"text-sm text-gray-700",children:"Generating clinician and patient insights‚Ä¶"})]}),!f&&F&&t.jsxs("div",{className:"bg-white border border-yellow-200 rounded-lg p-4 space-y-3",children:[t.jsx("div",{className:"text-sm text-yellow-800",children:F}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:D,className:"px-3 py-1.5 text-xs font-medium text-blue-700 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:"Retry insights"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Readings remain available for review."})]})]}),!f&&!F&&v&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Control Summary"}),t.jsx("div",{className:"text-sm text-gray-900",children:v.controlSummary})]}),t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Diurnal Pattern"}),t.jsx("div",{className:"text-sm text-gray-900",children:v.diurnalPattern})]})]}),t.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Variability"}),t.jsx("div",{className:"text-sm text-gray-900",children:v.variabilityConcern})]}),v.medicationRationale&&t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Medication Rationale"}),t.jsx("div",{className:"text-sm text-gray-900",children:v.medicationRationale})]})]}),(v.peakTimes||v.lowestTimes||v.abpmSuggestion)&&t.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[v.peakTimes&&t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Peak Times"}),t.jsx("div",{className:"text-sm text-gray-900",children:v.peakTimes})]}),v.lowestTimes&&t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Best Control"}),t.jsx("div",{className:"text-sm text-gray-900",children:v.lowestTimes})]}),v.abpmSuggestion&&t.jsxs("div",{className:"bg-white rounded-lg p-3 md:col-span-1",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Next Clinical Step"}),t.jsx("div",{className:"text-sm text-gray-900",children:v.abpmSuggestion})]})]}),t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Key Recommendations"}),t.jsx("ul",{className:"space-y-1.5",children:v.keyRecommendations.map((Z,be)=>t.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-900",children:[t.jsxs("span",{className:"text-blue-600 font-semibold mt-0.5",children:[be+1,"."]}),t.jsx("span",{children:Z})]},be))})]}),v.patientParagraph&&t.jsxs("div",{className:"bg-white border border-blue-100 rounded-lg p-4",children:[t.jsx("div",{className:"text-xs font-semibold text-blue-900 mb-1",children:"Patient-Facing Summary"}),t.jsx("div",{className:"text-sm text-gray-900 whitespace-pre-line",children:v.patientParagraph})]})]}),!f&&!F&&!v&&t.jsx("div",{className:"bg-white rounded-lg p-4 border border-dashed border-blue-200 text-sm text-gray-600",children:"Clinical insights will appear here once MedGemma finishes processing."})]}),ge&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 flex flex-col justify-between h-16",children:[t.jsx("div",{className:"text-[10px] text-gray-600 leading-tight",children:"Average SBP"}),t.jsx("div",{className:"text-xl font-bold text-gray-900 leading-none",children:ge.avgSBP}),t.jsx("div",{className:"text-[9px] text-gray-500 leading-tight",children:"mmHg"})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 flex flex-col justify-between h-16",children:[t.jsx("div",{className:"text-[10px] text-gray-600 leading-tight",children:"Average DBP"}),t.jsx("div",{className:"text-xl font-bold text-gray-900 leading-none",children:ge.avgDBP}),t.jsx("div",{className:"text-[9px] text-gray-500 leading-tight",children:"mmHg"})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 flex flex-col justify-between h-16",children:[t.jsx("div",{className:"text-[10px] text-gray-600 leading-tight",children:"Average HR"}),t.jsx("div",{className:"text-xl font-bold text-gray-900 leading-none",children:ge.avgHR}),t.jsx("div",{className:"text-[9px] text-gray-500 leading-tight",children:"bpm"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 flex flex-col justify-between h-16",children:[t.jsx("div",{className:"text-[10px] text-gray-600 leading-tight",children:"Above Target"}),t.jsxs("div",{className:"text-xl font-bold text-gray-900 leading-none",children:[ge.percentAboveTarget,"%"]}),t.jsx("div",{className:"text-[9px] text-gray-500 leading-tight",children:">135/85 mmHg"})]}),t.jsxs("div",{className:`rounded-lg p-2 flex flex-col justify-between h-16 ${ge.percentSBPBelowTarget>=d.sbpControlGoal?"bg-green-50 border border-green-200":ge.percentSBPBelowTarget>=d.sbpControlGoal-10?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200"}`,children:[t.jsx("div",{className:"text-[10px] text-gray-600 leading-tight",children:"SBP Control"}),t.jsxs("div",{className:`text-xl font-bold leading-none ${ge.percentSBPBelowTarget>=d.sbpControlGoal?"text-green-700":ge.percentSBPBelowTarget>=d.sbpControlGoal-10?"text-yellow-700":"text-gray-900"}`,children:[ge.percentSBPBelowTarget,"%"]}),t.jsxs("div",{className:"text-[9px] text-gray-500 leading-tight",children:["<",d.sbpControlTarget," mmHg (goal ",d.sbpControlGoal,"%)"]})]})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Review & Edit Readings"}),a.length<15&&t.jsx("p",{className:"text-xs text-gray-500",children:'Tip: Use "Add New Reading" button below to manually add any missed readings'})]}),t.jsx(fv,{readings:a,onReadingsChange:Ae,editable:!0})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Trend Chart"}),t.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-2",children:t.jsx(Pu,{ref:k,readings:a,showReferenceLines:d.showReferenceLines,referenceSBP:d.referenceSBP,referenceDBP:d.referenceDBP})}),t.jsx("div",{className:"flex justify-center mt-2",children:t.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-gray-500 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d.showReferenceLines,onChange:re,className:"rounded border-gray-300 w-3 h-3"}),"Show guidelines (130/80)"]})})]})]}),g&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-60 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Load Last Session?"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"This will replace your current work with the last saved BP diary session."}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:pe,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Load"})]})]})})]}),t.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50 rounded-b-xl gap-4 flex-wrap",children:[t.jsx("div",{className:"flex items-center gap-2",children:o==="ready"&&t.jsxs("button",{onClick:K,className:"flex items-center gap-1.5 px-3 py-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:[t.jsx(Er,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-xs",children:"Clear"})]})}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[o==="ready"&&a.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:ae,className:"flex items-center gap-1.5 px-3 py-1.5 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[t.jsx(jm,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-xs",children:"Export JSON"})]}),t.jsxs("button",{onClick:me,className:"flex items-center gap-1.5 px-3 py-1.5 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[t.jsx(Et,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-xs",children:"Export CSV"})]}),t.jsxs("button",{onClick:le,className:"flex items-center gap-1.5 px-3 py-1.5 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[t.jsx(_n,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-xs",children:"Copy Chart"})]}),t.jsxs("button",{onClick:ee,className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(yt,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-xs font-medium",children:"Accept & Save"})]})]}),t.jsx("button",{onClick:e,className:"px-3 py-1.5 text-xs text-gray-600 hover:text-gray-800 transition-colors",children:"Close"})]})]})]})})},bv=({isVisible:r,isGenerating:e,onClose:s,onGenerate:n,extractionError:a,onRetryExtraction:i})=>{const[o,A]=u.useState(""),[l,c]=u.useState(!1),[d,m]=u.useState(a),g=u.useRef(null);u.useEffect(()=>{r&&g.current&&g.current.focus()},[r]),u.useEffect(()=>{m(a)},[a]);const h=u.useCallback(y=>{(y.metaKey||y.ctrlKey)&&y.key==="Enter"&&(y.preventDefault(),o.trim()&&!e&&p()),y.key==="Escape"&&!e&&(y.preventDefault(),s())},[o,e,s]),p=u.useCallback(async()=>{if(!o.trim()){m("Please enter some clinical notes to generate a letter");return}m(void 0);try{await n(o,l),A(""),c(!1)}catch(y){m(y instanceof Error?y.message:"Failed to generate letter")}},[o,l,n]),b=u.useCallback(()=>{e||(A(""),c(!1),m(void 0),s())},[e,s]),N=u.useCallback(async()=>{if(i){m(void 0);try{await i()}catch(y){m(y instanceof Error?y.message:"Failed to extract EMR data")}}},[i]);return r?t.jsx(Le,{children:t.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:b,children:t.jsxs(se.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.15},className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full border-2 border-gray-200",onClick:y=>y.stopPropagation(),role:"dialog","aria-labelledby":"paste-notes-title","aria-describedby":"paste-notes-description",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-green-50 to-emerald-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center",children:t.jsx(Et,{className:"w-5 h-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{id:"paste-notes-title",className:"text-lg font-semibold text-gray-900",children:"Paste Clinical Notes"}),t.jsx("p",{id:"paste-notes-description",className:"text-xs text-gray-600",children:"Type or paste your clinic notes to generate a letter"})]})]}),t.jsx("button",{onClick:b,disabled:e,className:"text-gray-500 hover:text-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Close paste notes panel",children:t.jsx(nt,{className:"w-5 h-5"})})]})}),t.jsxs("div",{className:"px-6 py-4 space-y-4",children:[d&&t.jsxs(se.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-start space-x-2",children:[t.jsx(Zt,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-red-800",children:d}),i&&t.jsx("button",{onClick:N,className:"mt-2 text-xs text-red-600 hover:text-red-800 underline",children:"Retry EMR extraction"})]})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("div",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Quick tips:"}),t.jsxs("ul",{className:"mt-1 space-y-1 text-xs",children:[t.jsx("li",{children:'‚Ä¢ Use shorthand: "FU HTN", "‚Üë perindopril to 5 mg od", "stop amlo"'}),t.jsx("li",{children:"‚Ä¢ Include key info: purpose, diagnosis, plan, medication changes"}),t.jsxs("li",{children:["‚Ä¢ Press ",t.jsx("kbd",{className:"px-1 py-0.5 bg-blue-100 rounded text-blue-900",children:"‚åò/Ctrl+Enter"})," to generate"]})]})]})}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"paste-notes-textarea",className:"block text-sm font-medium text-gray-700 mb-2",children:"Clinical Notes"}),t.jsx("textarea",{ref:g,id:"paste-notes-textarea",value:o,onChange:y=>A(y.target.value),onKeyDown:h,disabled:e,placeholder:"e.g., FU HTN. BP 145/90. ‚Üë perindopril to 5 mg od. Stop amlodipine due to ankle oedema. Review in 4 weeks with home BP diary.",className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-y disabled:opacity-50 disabled:cursor-not-allowed font-mono text-sm",style:{minHeight:"120px"},"aria-describedby":"notes-hint"}),t.jsxs("div",{id:"notes-hint",className:"mt-1 text-xs text-gray-500",children:[o.length," characters ‚Ä¢ ",o.split(`
`).length," lines"]})]}),t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx("input",{type:"checkbox",id:"include-patient-friendly",checked:l,onChange:y=>c(y.target.checked),disabled:e,className:"mt-1 h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded disabled:opacity-50"}),t.jsxs("label",{htmlFor:"include-patient-friendly",className:"text-sm text-gray-700",children:[t.jsx("div",{className:"font-medium",children:"Include patient-friendly version"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Generate an additional letter in plain language for the patient"})]})]})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-gray-500",children:e?t.jsxs("span",{className:"flex items-center space-x-2",children:[t.jsx(Sn,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:"Generating letter (max 30s)..."})]}):t.jsx("span",{children:"Keyboard shortcuts: ‚åò/Ctrl+Enter to generate, Esc to close"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:b,disabled:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),t.jsx("button",{onClick:p,disabled:!o.trim()||e,className:"px-4 py-2 text-white bg-green-600 hover:bg-green-700 rounded-lg font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:e?t.jsxs(t.Fragment,{children:[t.jsx(Sn,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{children:"Generating..."})]}):t.jsx("span",{children:"Generate Letter"})})]})]})})]})})}):null},ln=[{id:"purpose",title:"Letter Purpose",question:"What is the purpose of this letter?",type:"select",options:[{value:"referral",label:"Referral to specialist"},{value:"follow-up",label:"Follow-up consultation"},{value:"results",label:"Investigation results"},{value:"discharge",label:"Discharge summary"}]},{id:"diagnosis",title:"Primary Problem",question:"What is the primary problem or diagnosis?",type:"text",placeholder:"e.g., Hypertension, Atrial fibrillation, Chest pain"},{id:"plan",title:"Plan",question:"What are the recommendations or plan?",type:"textarea",placeholder:"e.g., Continue current medications, arrange echo, review in 4 weeks"},{id:"medications",title:"Medication Changes",question:"Are there any medication changes?",type:"textarea",placeholder:'e.g., Increase perindopril to 5 mg od, stop amlodipine, or "no medication changes"'}],yv=({isVisible:r,missingFields:e,onComplete:s,onCancel:n,prefillData:a})=>{const[i,o]=u.useState(0),[A,l]=u.useState({purpose:"",diagnosis:a?.diagnosis||"",plan:a?.plan||"",medications:""}),[c,d]=u.useState({}),m=ln[i],g=u.useCallback(()=>{const y=A[m.id];return!y||y.trim().length===0?(d({[m.id]:"This field is required"}),!1):(d({}),!0)},[A,m.id]),h=u.useCallback(()=>{if(g())if(i<ln.length-1)o(i+1);else{const y={purpose:A.purpose,diagnosis:A.diagnosis,plan:A.plan,medications:A.medications};s(y)}},[i,A,g,s]),p=u.useCallback(()=>{i>0&&(o(i-1),d({}))},[i]),b=u.useCallback(y=>{l(j=>({...j,[m.id]:y})),d({})},[m.id]),N=u.useCallback(y=>{y.key==="Escape"&&(y.preventDefault(),n()),y.key==="Enter"&&m.type==="select"&&(y.preventDefault(),h())},[m.type,h,n]);return r?t.jsx(Le,{children:t.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:n,children:t.jsxs(se.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.15},className:"bg-white rounded-2xl shadow-xl max-w-xl w-full border-2 border-amber-200",onClick:y=>y.stopPropagation(),role:"dialog","aria-labelledby":"stepper-title","aria-describedby":"stepper-description",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-amber-50 to-yellow-50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center",children:t.jsx(ot,{className:"w-5 h-5 text-amber-600"})}),t.jsxs("div",{children:[t.jsx("h3",{id:"stepper-title",className:"text-lg font-semibold text-gray-900",children:"Additional Information Needed"}),t.jsxs("p",{id:"stepper-description",className:"text-xs text-gray-600",children:["Step ",i+1," of ",ln.length]})]})]}),t.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 transition-colors","aria-label":"Close stepper",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"mt-4",children:t.jsx("div",{className:"flex items-center space-x-1",children:ln.map((y,j)=>t.jsx("div",{className:`flex-1 h-2 rounded-full transition-colors ${j<i?"bg-green-500":j===i?"bg-amber-500":"bg-gray-200"}`},y.id))})})]}),t.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.length>0&&i===0&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:t.jsxs("div",{className:"text-sm text-amber-800",children:[t.jsx("strong",{children:"Missing information:"}),t.jsx("ul",{className:"mt-1 space-y-1 text-xs",children:e.map((y,j)=>t.jsxs("li",{children:["‚Ä¢ ",y]},j))})]})}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:`step-${m.id}`,className:"block text-lg font-medium text-gray-900 mb-2",children:m.question}),m.type==="select"&&t.jsxs("select",{id:`step-${m.id}`,value:A[m.id],onChange:y=>b(y.target.value),onKeyDown:N,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent text-base",autoFocus:!0,children:[t.jsx("option",{value:"",children:"Select an option..."}),m.options?.map(y=>t.jsx("option",{value:y.value,children:y.label},y.value))]}),m.type==="text"&&t.jsx("input",{type:"text",id:`step-${m.id}`,value:A[m.id],onChange:y=>b(y.target.value),onKeyDown:N,placeholder:m.placeholder,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent text-base",autoFocus:!0}),m.type==="textarea"&&t.jsx("textarea",{id:`step-${m.id}`,value:A[m.id],onChange:y=>b(y.target.value),onKeyDown:N,placeholder:m.placeholder,className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-y text-base",autoFocus:!0}),c[m.id]&&t.jsx(se.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"mt-2 text-sm text-red-600",children:c[m.id]})]})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{onClick:p,disabled:i===0,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(Sm,{className:"w-4 h-4"}),t.jsx("span",{children:"Back"})]}),t.jsx("div",{className:"text-xs text-gray-500",children:"Press Enter to continue ‚Ä¢ Esc to cancel"}),t.jsxs("button",{onClick:h,className:"px-4 py-2 text-white bg-amber-600 hover:bg-amber-700 rounded-lg font-medium text-sm transition-colors flex items-center space-x-2",children:[t.jsx("span",{children:i===ln.length-1?"Complete":"Next"}),t.jsx(os,{className:"w-4 h-4"})]})]})})]})})}):null},vv=/bloods?\s*\(([^)]+)\)\s*:\s*(.+)$/i,wv=/(ldl-?c?|total\s+chol(?:esterol)?|tchol|tc|hdl|tg|trig(?:lycerides)?|apob|apo\s*b|non[-\s]*hdl)/i,Bv=/([-+]?\d+(?:\.\d+)?)/,rc=/\(([^)]+)\)\s*$/,Cv=/(off\s+statin|pre[-\s]?therapy|baseline|statin\s*naive|no\s+statin|untreated)/i;function Nv(r){const s=r.trim().replace(/\./g,"").replace(/st|nd|rd|th/gi,"").split(/\s+/);if(s.length<3)return null;const[n,a,i]=s,o=parseInt(n,10);if(Number.isNaN(o))return null;const A=a.toLowerCase(),l=parseInt(i,10);if(Number.isNaN(l))return null;const d={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,sept:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11}[A];if(d===void 0)return null;const m=l<100?2e3+l:l,g=new Date(Date.UTC(m,d,o));return Number.isNaN(g.valueOf())?null:g.toISOString().slice(0,10)}function jv(r){const e=r.toLowerCase();return/^ldl/.test(e)?"ldl":/(total\s+chol|tchol|^tc$)/.test(e)?"tchol":/^hdl/.test(e)?"hdl":/^(tg|trig)/.test(e)?"tg":/apo\s*b|apob/.test(e)?"apob":/non[-\s]*hdl/.test(e)?"nonHDL":null}function Sv(r,e){const s=r.split(/[,;¬∑]/).map(n=>n.trim()).filter(Boolean);for(const n of s){const a=n.match(wv),i=n.match(Bv);if(!a||!i)continue;const o=jv(a[0]);if(!o)continue;const A=parseFloat(i[0]);Number.isNaN(A)||(e[o]=A)}}function Ev(r){if(r.nonHDL==null&&r.tchol!=null&&r.hdl!=null){const e=parseFloat((r.tchol-r.hdl).toFixed(2));r.nonHDL=Number.isFinite(e)?e:void 0}}function Fv(r){return r?Cv.test(r):!1}function Qv(r){const e=[];let s=null;for(const n of r){if(!n.therapyNote){s&&(s.endDate=n.date,e.push(s),s=null);continue}s&&s.note===n.therapyNote?s.endDate=n.date:(s&&e.push(s),s={label:n.therapyNote,startDate:n.date,note:n.therapyNote})}return s&&e.push(s),e}function Iv(r){const e=r.filter(A=>typeof A.ldl=="number");if(e.length===0)return{};const s=e.filter(A=>A.isPreTherapy),n=s.length>0?s.slice(0,3):e.slice(0,1),a=n.map(A=>A.ldl).sort((A,l)=>A-l),i=Math.floor(a.length/2),o=a.length%2===0?(a[i-1]+a[i])/2:a[i];return{value:Number.isFinite(o)?parseFloat(o.toFixed(2)):void 0,date:n[0]?.date}}function sc(r){const e=[],s=[];if(!r||!r.trim())return{readings:[],warnings:["No Investigation Summary content detected."],metadata:{therapyPhases:[]}};const n=r.split(/\r?\n/).map(i=>i.trim()).filter(Boolean);for(const i of n){const o=i.match(vv);if(!o)continue;const[,A,l]=o,c=Nv(A);if(!c){e.push(`Could not parse date "${A}"`);continue}let d=l.trim(),m=null;const g=d.match(rc);g&&(m=g[1].trim(),d=d.replace(rc,"").trim());const h={id:typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`lipid-${Date.now()}-${Math.random().toString(16).slice(2)}`,date:c,source:i,therapyNote:m,isPreTherapy:Fv(m)};if(Sv(d,h),Ev(h),h.ldl==null&&h.tchol==null&&h.hdl==null&&h.tg==null&&h.apob==null&&h.nonHDL==null){e.push(`No lipid values recognised for "${i}"`);continue}s.push(h)}s.sort((i,o)=>i.date<o.date?-1:i.date>o.date?1:0);const a=Du(s);return{readings:s,warnings:e,metadata:a}}function Du(r){const e=[...r].sort((o,A)=>o.date<A.date?-1:o.date>A.date?1:0),s=Qv(e),{value:n,date:a}=Iv(e),i=e.at(-1);return{baselineLDL:n,baselineSourceDate:a,latestDate:i?.date,latestLDL:i?.ldl,latestTotalChol:i?.tchol,therapyPhases:s}}const Uv=864e5,Tv=Uv*30.4375;function Ia(r){if(!r)return;const e=new Date(r);if(Number.isNaN(e.valueOf()))return;const s=String(e.getUTCDate()).padStart(2,"0"),n=String(e.getUTCMonth()+1).padStart(2,"0"),a=e.getUTCFullYear();return`${s}-${n}-${a}`}function Cn(r){if(!r)return null;const e=new Date(r);return Number.isNaN(e.valueOf())?null:e}function kv(r,e){return(e.getTime()-r.getTime())/Tv}function Ru(r,e){const s=new Date(r);return s.setMonth(s.getMonth()-e),s}function Pv(r){return`${Math.round(r*100)}%`}function Dv(r){if(r.length<2)return null;const e=r.length,s=r.reduce((l,c)=>l+c.x,0),n=r.reduce((l,c)=>l+c.y,0),a=r.reduce((l,c)=>l+c.x*c.y,0),i=r.reduce((l,c)=>l+c.x*c.x,0),o=e*i-s*s;return o===0?null:(e*a-s*n)/o}function Rv(r){return r==null?"insufficient-data":r>.05?"rising":r<-.05?"falling":"stable"}function Mv(r){switch(r){case"3m":return 3;case"6m":return 6;case"12m":return 12;default:return 1/0}}function Hv(r,e,s,n,a,i){if(!e)return{percentage:0,lastAtGoalDate:void 0};const o=Mv(s),A=o===1/0?null:Ru(e,o),l=r.filter(m=>{if(m.ldl==null)return!1;if(A){const g=Cn(m.date);if(!g||g<A)return!1}return!0});if(l.length===0)return{percentage:0,lastAtGoalDate:void 0};const c=l.filter(m=>{if(m.ldl==null)return!1;let g=m.ldl<n+1e-6;return g&&a&&i&&(g=(i-m.ldl)/i*100>=a-.5),g}),d=c.length>0?c.at(-1)?.date:void 0;return{percentage:c.length/l.length,lastAtGoalDate:d}}function Lv(r){let e;for(let s=1;s<r.length;s+=1){const n=r[s-1],a=r[s];if(n.ldl==null||a.ldl==null)continue;const i=a.ldl-n.ldl;i<=0||(!e||i>e.delta)&&(e={startDate:n.date,endDate:a.date,delta:parseFloat(i.toFixed(2))})}return e}function Ov(r){const e=r.filter(n=>typeof n.ldl=="number");if(e.length===0)return;e.sort((n,a)=>n.ldl-a.ldl);const s=e[0];return{date:s.date,value:parseFloat(s.ldl.toFixed(2)),therapyNote:s.therapyNote??null}}function _v(r,e){if(r.length<2||e==null)return;const s=r.filter(g=>g.therapyNote&&!g.isPreTherapy);if(s.length===0)return;const n=s[0],a=r.findIndex(g=>g.id===n.id),i=r.slice(0,a).filter(g=>typeof g.ldl=="number"),o=r.slice(a).filter(g=>typeof g.ldl=="number");if(i.length===0||o.length===0)return;const A=i.reduce((g,h)=>g+h.ldl,0)/i.length,l=Math.min(...o.map(g=>g.ldl)),c=A-l,d=c/A*100;if(!Number.isFinite(d))return;let m="expected";return d<30?m="sub-expected":d>=50&&(m="excellent"),`Therapy response ${m}: ‚Üì${c.toFixed(1)} mmol/L (${Math.round(d)}%) from pre-therapy median.`}function $v(r){if(!r)return{strictOverlayRecommended:!1};const e=/ctca|coronary\s+angio/i.test(r),s=/(plaque|stenosis|calcium|calcified)/i.test(r);return e&&s?{strictOverlayRecommended:!0,note:"CTCA evidence of plaque ‚Äì consider secondary prevention targets."}:{strictOverlayRecommended:!1}}function Kv(r,e,s,n,a,i){if(r.length===0)return{slopeClassification:"insufficient-data",timeInTarget:{timeframe:a,percentage:0}};const o=r.at(-1),A=r.length>1?r[r.length-2]:void 0,l=Cn(o.date),c=e.baselineLDL,d=c!=null&&o.ldl!=null?parseFloat((o.ldl-c).toFixed(2)):void 0,m=c!=null&&o.ldl!=null?(c-o.ldl)/c*100:void 0,g=A?.ldl!=null&&o.ldl!=null?parseFloat((o.ldl-A.ldl).toFixed(2)):void 0,h=A?.ldl!=null&&o.ldl!=null?(o.ldl-A.ldl)/A.ldl*100:void 0,p=l?Ru(l,12):null,b=r.filter(F=>{if(!p||!l)return!0;const w=Cn(F.date);return w!=null&&w>=p}).filter(F=>typeof F.ldl=="number").map(F=>{const w=Cn(F.date),T=p??Cn(r[0].date)??w;return{x:kv(T,w),y:F.ldl}}),N=Dv(b),y=Rv(N),j=s.bands.find(F=>F.id===n)??s.bands[0],Q=Hv(r,l,a,j.threshold,j.percentReduction,c),v=Ov(r),x=Lv(r),f=_v(r,c),S=$v(i);return{baselineLDL:c,baselineDate:e.baselineSourceDate,latestLDL:o.ldl,latestTotal:o.tchol,deltaSinceBaseline:d,percentReduction:m,deltaSincePrevious:g,percentDeltaSincePrevious:h,monthlySlope:N==null?void 0:parseFloat(N.toFixed(2)),slopeClassification:y,timeInTarget:{timeframe:a,percentage:Q.percentage,lastAtGoalDate:Q.lastAtGoalDate},bestNadir:v,largestRise:x,therapyResponseNote:f,strictOverlayRecommended:S.strictOverlayRecommended,riskContext:S.note,latestDate:o.date,previousDate:A?.date}}function Vv(r){const e=(y,j)=>y==null||j==null?"Œî n/a":`${y>0?"‚Üë":y<0?"‚Üì":"‚Üí"}${Math.abs(y).toFixed(1)} mmol/L (${j>0?"+":""}${Math.round(j)}%)`,s=Ia(r.latestDate),n=Ia(r.previousDate),a=Ia(r.baselineDate),i=r.latestLDL!=null?`Latest LDL ${r.latestLDL.toFixed(1)} mmol/L${r.latestTotal!=null?`, Total Chol ${r.latestTotal.toFixed(1)} mmol/L`:""}${s?` (${s})`:""}.`:"Latest LDL not available.",o=r.deltaSincePrevious!=null?`Change since prior result${n?` (${n})`:""}: ${e(r.deltaSincePrevious,r.percentDeltaSincePrevious)}.`:"No prior comparison available.",A=r.deltaSinceBaseline!=null?`Baseline${a?` (${a})`:""}: ${e(r.deltaSinceBaseline,r.percentReduction)}.`:"Baseline not established.";let l="Trend assessment unavailable.";switch(r.slopeClassification){case"rising":l=`LDL is rising ‚âà${r.monthlySlope?.toFixed(2)} mmol/L per month over recent data.`;break;case"falling":l=`LDL is falling ‚âà${Math.abs(r.monthlySlope??0).toFixed(2)} mmol/L per month.`;break;case"stable":l="LDL has remained broadly stable over the recent window.";break}const c={"3m":"3 months","6m":"6 months","12m":"12 months",all:"all results"},d=r.timeInTarget.lastAtGoalDate?Ia(r.timeInTarget.lastAtGoalDate):void 0,m=`Time-in-target (${c[r.timeInTarget.timeframe]}): ${Pv(r.timeInTarget.percentage)}${d?`; last at goal ${d}`:""}.`,g=r.bestNadir?`Best on-therapy nadir ${r.bestNadir.value.toFixed(1)} mmol/L (${r.bestNadir.date}${r.bestNadir.therapyNote?` ‚Äì ${r.bestNadir.therapyNote}`:""}).`:void 0,h=r.largestRise?`Largest month-to-month rise: +${r.largestRise.delta.toFixed(1)} mmol/L (${r.largestRise.startDate} ‚Üí ${r.largestRise.endDate}).`:void 0,p=r.therapyResponseNote,b=r.riskContext;return{latestSummary:i,priorComparison:o,baselineComparison:A,trajectory:l,timeInTarget:m,therapyResponse:p,nadirAndRise:[g,h].filter(Boolean).join(" ")||void 0,riskContext:b,whyItMatters:"Every ~1 mmol/L LDL-C reduction yields ‚âà21‚Äì25% relative ASCVD risk reduction; align therapy with chosen overlay to capture this benefit."}}const Qs={"au-practice":{id:"au-practice",name:"AU Practice",description:"Australian clinical practice (secondary prevention default, optional primary target).",allowCustomPrimaryTarget:!0,bands:[{id:"secondary-prevention",label:"Secondary prevention (LDL <1.8 mmol/L)",threshold:1.8,description:"Australian practice common target for established ASCVD."},{id:"primary-custom",label:"Primary prevention (clinician-set target)",threshold:2,description:"Default <2.0 mmol/L for high-risk primary prevention (editable)."}]},"esc-eas":{id:"esc-eas",name:"ESC/EAS 2019",description:"European Society of Cardiology / Atherosclerosis Society targets.",bands:[{id:"very-high",label:"Very-high risk (LDL <1.4 mmol/L + ‚â•50% reduction)",threshold:1.4,percentReduction:50,description:"Use for clinical ASCVD, diabetes with organ damage, severe CKD."},{id:"high-risk",label:"High risk (LDL <1.8 mmol/L)",threshold:1.8,percentReduction:50,description:"Marked risk factors or familial hypercholesterolaemia."},{id:"moderate-risk",label:"Moderate risk (LDL <2.6 mmol/L)",threshold:2.6,description:"Primary prevention moderate risk cohorts."}]}},mA="au-practice",Gv="secondary-prevention",dr={LATEST:"lipid-profile-latest",HISTORY:"lipid-profile-history",SETTINGS:"lipid-profile-settings"},Wv=5,Mu={framework:mA,selectedBandId:Gv,selectedAnalytes:["ldl","tchol"],timeFilter:"6m",ldlOnlyView:!1,showTherapyBands:!0};class Is{static instance;constructor(){}static getInstance(){return Is.instance||(Is.instance=new Is),Is.instance}async saveSession(e){await chrome.storage.local.set({[dr.LATEST]:e}),oe.info("Lipid profile session saved",{component:"lipid-storage",id:e.id,readings:e.readings.length}),await this.addToHistory(e)}async loadLatestSession(){return(await chrome.storage.local.get(dr.LATEST))[dr.LATEST]??null}async clearLatest(){await chrome.storage.local.remove(dr.LATEST)}async saveSettings(e){await chrome.storage.local.set({[dr.SETTINGS]:e})}async loadSettings(){return(await chrome.storage.local.get(dr.SETTINGS))[dr.SETTINGS]??Mu}async addToHistory(e){try{const n=(await chrome.storage.local.get(dr.HISTORY))[dr.HISTORY]??[];n.unshift(e);const a=n.slice(0,Wv);await chrome.storage.local.set({[dr.HISTORY]:a})}catch(s){oe.warn("Failed to append lipid profile session to history",{component:"lipid-storage",error:s instanceof Error?s.message:"unknown"})}}}const nc={tchol:"#111827",ldl:"#dc2626",tg:"#ea580c",hdl:"#0284c7",apob:"#7c3aed",nonHDL:"#2563eb"};function Ua(r,e){switch(e){case"ldl":return r.ldl??void 0;case"tchol":return r.tchol??void 0;case"hdl":return r.hdl??void 0;case"tg":return r.tg??void 0;case"apob":return r.apob??void 0;case"nonHDL":return r.nonHDL??void 0;default:return}}function rs(r){return new Date(r)}function Ta(r){return new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),1))}function ka(r){const e=new Date(r);return e.setUTCMonth(e.getUTCMonth()+1),e}function zv(r){if(!r)return"";const s=new Date(r.date).toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"}),n=[];return r.ldl!=null&&n.push(`LDL ${r.ldl.toFixed(1)}`),r.tchol!=null&&n.push(`TChol ${r.tchol.toFixed(1)}`),r.hdl!=null&&n.push(`HDL ${r.hdl.toFixed(1)}`),r.nonHDL!=null&&n.push(`Non-HDL ${r.nonHDL.toFixed(1)}`),`${s}
${n.join(" ¬∑ ")}`}const Xv=({readings:r,settings:e,overlay:s,therapyPhases:n,onPointClick:a})=>{const i=u.useRef(null),o=u.useRef(null),[A,l]=u.useState(null),[c,d]=u.useState({width:600,height:340});u.useEffect(()=>{const b=()=>{if(!o.current)return;const N=o.current.clientWidth;d({width:Math.max(420,N-12),height:340})};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const m=u.useMemo(()=>e.ldlOnlyView?["ldl"]:e.selectedAnalytes,[e.ldlOnlyView,e.selectedAnalytes]);u.useEffect(()=>{const b=i.current;if(!b||r.length===0)return;const N=b.getContext("2d");if(!N)return;const{width:y,height:j}=c,Q=window.devicePixelRatio||1;b.width=y*Q,b.height=j*Q,b.style.width=`${y}px`,b.style.height=`${j}px`,N.scale(Q,Q),N.clearRect(0,0,y,j);const v={top:40,right:70,bottom:60,left:70},x=y-v.left-v.right,f=j-v.top-v.bottom,S=r.filter(H=>m.some(X=>Ua(H,X)!=null));if(S.length===0)return;const F=S.flatMap(H=>m.map(X=>Ua(H,X)??null).filter(X=>X!=null)),w=0,T=Math.max(...F,s.bands.reduce((H,X)=>Math.max(H,X.threshold),0)+.5),C=r.map(H=>rs(H.date));C.sort((H,X)=>H.getTime()-X.getTime());const E=Ta(C[0]),U=Ta(C[C.length-1]),k=[];let P=new Date(E);for(;P<=U;)k.push(new Date(P)),P=ka(P);k.length===1&&k.push(ka(k[0]));const M=k.length-1||1,$=H=>{const X=k.findIndex(D=>D.getUTCFullYear()===H.getUTCFullYear()&&D.getUTCMonth()===H.getUTCMonth());if(X>=0){const D=(H.getUTCDate()-1)/new Date(H.getUTCFullYear(),H.getUTCMonth()+1,0).getUTCDate();return v.left+(X+D)/M*x}const Ae=(H.getUTCFullYear()-k[0].getUTCFullYear())*12+(H.getUTCMonth()-k[0].getUTCMonth());return v.left+Ae/M*x},W=H=>v.top+f-(H-w)/(T-w)*f,V=()=>{N.strokeStyle="#cbd5f5",N.lineWidth=1,N.beginPath(),N.moveTo(v.left,v.top),N.lineTo(v.left,v.top+f),N.lineTo(v.left+x,v.top+f),N.stroke(),N.fillStyle="#6b7280",N.font="10px Inter",N.textAlign="center",N.textBaseline="top",k.forEach((X,Ae)=>{const D=v.left+Ae/M*x;N.fillText(X.toLocaleDateString(void 0,{month:"short",year:"2-digit"}),D,v.top+f+10),N.beginPath(),N.strokeStyle="#e5e7eb",N.moveTo(D,v.top),N.lineTo(D,v.top+f),N.stroke()}),N.textAlign="right",N.textBaseline="middle";const H=6;for(let X=0;X<=H;X+=1){const Ae=w+X/H*(T-w),D=W(Ae);N.fillText(Ae.toFixed(1),v.left-6,D),N.beginPath(),N.strokeStyle="#eef2ff",N.moveTo(v.left,D),N.lineTo(v.left+x,D),N.stroke()}},L=()=>{N.save(),s.bands.forEach(H=>{const X=W(H.threshold),Ae=v.top+f-X;Ae>0&&(N.fillStyle="rgba(37, 99, 235, 0.08)",N.fillRect(v.left,X,x,Ae)),N.strokeStyle="rgba(37, 99, 235, 0.5)",N.lineWidth=1,N.beginPath(),N.moveTo(v.left,X),N.lineTo(v.left+x,X),N.stroke(),N.fillStyle="#1d4ed8",N.font="10px Inter",N.textAlign="right",N.fillText(`${H.label}`,v.left+x,X-4)}),N.restore()},O=()=>{!e.showTherapyBands||n.length===0||(N.save(),n.forEach(H=>{const X=rs(H.startDate),Ae=H.endDate?rs(H.endDate):U,D=$(X),K=$(Ae),ee=Math.max(6,K-D);N.fillStyle="rgba(34, 197, 94, 0.14)",N.fillRect(D,v.top,ee,f),N.strokeStyle="rgba(22, 163, 74, 0.4)",N.strokeRect(D,v.top,ee,f),N.fillStyle="rgba(22, 163, 74, 0.85)",N.font="10px Inter",N.textAlign="left",N.fillText(H.label,D+6,v.top+12)}),N.restore())},z=()=>{m.forEach(H=>{N.beginPath(),N.lineWidth=H==="ldl"?2.4:1.8,N.strokeStyle=nc[H],N.fillStyle=nc[H];let X=!1;r.forEach(Ae=>{const D=Ua(Ae,H);if(D==null)return;const K=$(rs(Ae.date)),ee=W(D);X?N.lineTo(K,ee):(N.moveTo(K,ee),X=!0)}),N.stroke(),r.forEach(Ae=>{const D=Ua(Ae,H);if(D==null)return;const K=$(rs(Ae.date)),ee=W(D);N.beginPath(),N.arc(K,ee,H==="ldl"?4:3,0,Math.PI*2),N.fill()})})};L(),O(),V(),z()},[r,c,s,n,m,e.showTherapyBands]);const g=b=>{const N=i.current;if(!N)return;const y=N.getBoundingClientRect(),j=b.clientX-y.left,Q=b.clientY-y.top,{width:v,height:x}=c,f={top:40,right:70,bottom:60,left:70},S=v-f.left-f.right,F=x-f.top-f.bottom,w=r.map(L=>rs(L.date));w.sort((L,O)=>L.getTime()-O.getTime());const T=Ta(w[0]),C=Ta(w[w.length-1]),E=[];let U=new Date(T);for(;U<=C;)E.push(new Date(U)),U=ka(U);E.length===1&&E.push(ka(E[0]));const k=E.length-1||1,P=8;let M=null;const $=r.filter(L=>L.ldl!=null).map(L=>L.ldl);if($.length===0)return;const W=Math.max(0,Math.min(...$)-.5),V=Math.max(...$,s.bands.reduce((L,O)=>Math.max(L,O.threshold),0)+.5);if(r.forEach(L=>{if(L.ldl==null)return;const O=rs(L.date),z=(O.getUTCFullYear()-E[0].getUTCFullYear())*12+(O.getUTCMonth()-E[0].getUTCMonth())+(O.getUTCDate()-1)/30,H=f.left+z/k*S,X=f.top+F-(L.ldl-W)/(V-W)*F,Ae=Math.hypot(H-j,X-Q);Ae<P&&(!M||Ae<M.distance)&&(M={reading:L,distance:Ae})}),M!==null){const{reading:L}=M;l({visible:!0,x:j,y:Q,reading:L})}else l(null)},h=()=>{l(null)},p=()=>{A&&A.visible&&A.reading&&a&&a(A.reading)};return t.jsxs("div",{ref:o,className:"relative",children:[t.jsx("canvas",{ref:i,width:c.width,height:c.height,onMouseMove:g,onMouseLeave:h,onClick:p,className:"w-full h-[340px] cursor-crosshair select-none border border-gray-200 rounded-xl bg-white shadow-sm"}),A&&A.visible&&A.reading&&t.jsxs("div",{className:"absolute pointer-events-none bg-white border border-gray-200 rounded-lg shadow-lg p-2 text-xs text-gray-700 whitespace-pre-line",style:{left:A.x+12,top:A.y+12},children:[zv(A.reading),A.reading.therapyNote?`
(${A.reading.therapyNote})`:"",A.reading.source?`
${A.reading.source}`:""]})]})},ac={"3m":"Last 3 months","6m":"Last 6 months","12m":"Last 12 months",all:"All data"},qv=({settings:r,onChange:e,availableAnalytes:s})=>{const n=Qs[r.framework]??Qs[mA],a=l=>{const c=Qs[l]??n;e({...r,framework:c.id,selectedBandId:c.bands[0]?.id??r.selectedBandId})},i=l=>{e({...r,selectedBandId:l})},o=l=>{e({...r,timeFilter:l})},A=l=>{const c=r.selectedAnalytes.includes(l)?r.selectedAnalytes.filter(d=>d!==l):[...r.selectedAnalytes,l];e({...r,selectedAnalytes:c})};return t.jsxs("div",{className:"grid gap-4 bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Guideline overlay"}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("select",{value:r.framework,onChange:l=>a(l.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-blue-500 focus:border-blue-500",children:Object.values(Qs).map(l=>t.jsx("option",{value:l.id,children:l.name},l.id))}),t.jsx("select",{value:r.selectedBandId,onChange:l=>i(l.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-blue-500 focus:border-blue-500",children:n.bands.map(l=>t.jsx("option",{value:l.id,children:l.label},l.id))}),n.allowCustomPrimaryTarget&&r.selectedBandId==="primary-custom"&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{htmlFor:"customTarget",className:"text-xs text-gray-600",children:"Target <"}),t.jsx("input",{id:"customTarget",type:"number",step:.1,min:1,value:r.customPrimaryTarget??n.bands.find(l=>l.id==="primary-custom")?.threshold??2,onChange:l=>{const c=parseFloat(l.target.value||"0");e({...r,customPrimaryTarget:Number.isFinite(c)?c:void 0})},className:"w-24 border border-gray-200 rounded-lg px-2 py-1 text-sm focus:ring-blue-500 focus:border-blue-500"}),t.jsx("span",{className:"text-xs text-gray-500",children:"mmol/L"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Time filter"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(ac).map(l=>t.jsx("button",{onClick:()=>o(l),className:`px-3 py-1.5 rounded-lg border text-xs ${r.timeFilter===l?"border-blue-500 text-blue-600 bg-blue-50":"border-gray-200 text-gray-600 hover:border-gray-300"}`,type:"button",children:ac[l]},l))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Series"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(l=>{const c=r.selectedAnalytes.includes(l);return t.jsx("button",{type:"button",onClick:()=>A(l),className:`px-3 py-1.5 rounded-lg border text-xs ${c?"border-gray-900 text-gray-900 bg-gray-100":"border-gray-200 text-gray-600 hover:border-gray-300"}`,children:l.toUpperCase()},l)})}),t.jsxs("label",{className:"mt-3 flex items-center gap-2 text-xs text-gray-600",children:[t.jsx("input",{type:"checkbox",checked:r.ldlOnlyView,onChange:l=>e({...r,ldlOnlyView:l.target.checked}),className:"rounded border-gray-300"}),"LDL-only focus"]}),t.jsxs("label",{className:"mt-2 flex items-center gap-2 text-xs text-gray-600",children:[t.jsx("input",{type:"checkbox",checked:r.showTherapyBands,onChange:l=>e({...r,showTherapyBands:l.target.checked}),className:"rounded border-gray-300"}),"Show therapy phase bands"]})]})]})},Yv={ldl:"LDL-C",tchol:"Total Chol",hdl:"HDL",tg:"Triglycerides",apob:"ApoB",nonHDL:"Non-HDL"},Jv={inputMode:"decimal",step:.1,min:0},ic=typeof Intl<"u"?new Intl.DateTimeFormat(void 0,{day:"2-digit",month:"short",year:"numeric"}):null;function Zv(r){try{return ic?ic.format(new Date(r)):r}catch{return r}}const ew=({readings:r,onChange:e,analyteOrder:s})=>{const n=u.useCallback((a,i,o)=>{e(r.map(A=>{if(A.id!==a)return A;if(i==="date")return{...A,date:o,isEdited:!0};if(i==="therapyNote")return{...A,therapyNote:o||null,isEdited:!0,isPreTherapy:o?/\boff\s+statin|pre-therapy|baseline/i.test(o):!1};const l=o===""?void 0:Number(o),c=l!==void 0&&Number.isFinite(l)?parseFloat(l.toFixed(2)):void 0,d={...A,[i]:c,isEdited:!0};return(i==="tchol"||i==="hdl")&&(d.tchol!=null&&d.hdl!=null?d.nonHDL=parseFloat((d.tchol-d.hdl).toFixed(2)):(i==="tchol"&&d.hdl==null||i==="hdl"&&d.tchol==null)&&(d.nonHDL=void 0)),d}))},[r,e]);return r.length===0?t.jsx("div",{className:"border border-dashed border-gray-300 rounded-lg p-6 text-center text-sm text-gray-500",children:"No lipid results parsed yet."}):t.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-xl shadow-sm",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[t.jsx("thead",{className:"bg-gray-50 text-xs uppercase",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-600",children:"Date"}),s.map(a=>t.jsxs("th",{className:"px-3 py-2 text-left font-semibold text-gray-600 whitespace-nowrap",children:[Yv[a]," (mmol/L)"]},a)),t.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-600",children:"Therapy note"}),t.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-600",children:"Provenance"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:r.map(a=>t.jsxs("tr",{className:a.isEdited?"bg-amber-50":void 0,children:[t.jsx("td",{className:"px-3 py-2 align-top",children:t.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded-lg px-2 py-1 text-sm focus:ring-blue-500 focus:border-blue-500",value:a.date,onChange:i=>n(a.id,"date",i.target.value)})}),s.map(i=>t.jsx("td",{className:"px-3 py-2 align-top",children:t.jsx("input",{type:"number",...Jv,className:"w-24 border border-gray-200 rounded-lg px-2 py-1 text-sm focus:ring-blue-500 focus:border-blue-500",value:a[i]??"",onChange:o=>n(a.id,i,o.target.value),placeholder:"‚Äì"})},`${a.id}-${i}`)),t.jsx("td",{className:"px-3 py-2 align-top",children:t.jsx("input",{type:"text",className:"w-full border border-gray-200 rounded-lg px-2 py-1 text-sm focus:ring-blue-500 focus:border-blue-500",value:a.therapyNote??"",onChange:i=>n(a.id,"therapyNote",i.target.value),placeholder:"Optional note"})}),t.jsx("td",{className:"px-3 py-2 text-right text-xs text-gray-500 align-top",children:t.jsx("span",{title:a.source,children:Zv(a.date)})})]},a.id))})]})})},tw=({summary:r})=>r?t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Vt,{className:"w-5 h-5 text-blue-600"}),t.jsx("h3",{className:"text-sm font-semibold text-blue-900",children:"Clinical Insights"})]}),t.jsxs("ul",{className:"space-y-2 text-sm text-gray-900",children:[t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Latest status:"})," ",r.latestSummary]}),t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Change vs prior:"})," ",r.priorComparison]}),t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Baseline context:"})," ",r.baselineComparison]}),t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Trajectory:"})," ",r.trajectory]}),t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Time in target:"})," ",r.timeInTarget]}),r.therapyResponse&&t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Therapy response:"})," ",r.therapyResponse]}),r.nadirAndRise&&t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Notable points:"})," ",r.nadirAndRise]}),r.riskContext&&t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Risk context:"})," ",r.riskContext]}),t.jsxs("li",{children:[t.jsx("strong",{className:"text-gray-700",children:"Why LDL matters:"})," ",r.whyItMatters]})]})]}):null,oc=hr.getInstance(),rw=({phases:r})=>r.length===0?null:t.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-3 space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-emerald-700 uppercase tracking-wide",children:"Therapy phases"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-white border border-emerald-200 px-3 py-2 text-xs text-emerald-800 shadow-sm",children:[t.jsx("span",{className:"font-semibold",children:e.label}),t.jsxs("span",{className:"text-emerald-600",children:[e.startDate," ‚Üí ",e.endDate??"current"]})]},`${e.startDate}-${s}`))})]});function Ac(r,e){if(e==="all"||r.length===0)return r;const s=e==="3m"?3:e==="6m"?6:12,n=new Date(r.at(-1).date),a=new Date(n);return a.setMonth(a.getMonth()-s),r.filter(i=>new Date(i.date)>=a)}function lc(r){const e=Qs[r.framework]??Qs[mA],s=r.customPrimaryTarget;return!e.allowCustomPrimaryTarget||s==null?{...e,bands:e.bands.map(n=>({...n}))}:{...e,bands:e.bands.map(n=>n.id==="primary-custom"?{...n,threshold:s}:{...n})}}const sw=({isOpen:r,onClose:e})=>{const[s,n]=u.useState("idle"),[a,i]=u.useState(""),[o,A]=u.useState([]),[l,c]=u.useState({therapyPhases:[]}),[d,m]=u.useState(Mu),[g,h]=u.useState(null),[p,b]=u.useState(null),[N,y]=u.useState("emr"),[j,Q]=u.useState(!1),[v,x]=u.useState(!1),[f,S]=u.useState([]),F=u.useRef(Is.getInstance());u.useEffect(()=>{(async()=>{const L=await F.current.loadSettings();m(O=>({...O,...L}))})()},[]),u.useEffect(()=>{F.current.saveSettings(d).catch(()=>{})},[d]),u.useEffect(()=>{if(o.length===0){h(null),S([]);return}const L=lc(d),O=L.bands.some(Ae=>Ae.id===d.selectedBandId)?d.selectedBandId:L.bands[0].id,z=Ac(o,d.timeFilter),H=Kv(z,l,L,O,d.timeFilter,a),X=Vv(H);h(X)},[o,l,d,a]);const w=u.useMemo(()=>{const L=new Set;return o.forEach(z=>{["ldl","tchol","hdl","tg","apob","nonHDL"].forEach(H=>{z[H]!=null&&L.add(H)})}),["ldl","tchol","hdl","nonHDL","tg","apob"].filter(z=>L.has(z))},[o]),T=["ldl","tchol","hdl","nonHDL"],C=w.length>0?w:T,E=u.useMemo(()=>lc(d),[d]),U=u.useMemo(()=>Ac(o,d.timeFilter),[o,d.timeFilter]),k=u.useCallback(async()=>{n("capturing"),oc.recordMetrics("agent-processing",0,{agentType:"lipid-profile-import"});try{const L=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"investigation-summary",data:{extractOnly:!0}});if(!L?.success)throw new Error(L?.error||"Capture failed");if(!L.data||L.data.trim().length===0){n("error"),x(!0),ce.getInstance().warning("No Investigation Summary content","Click ‚ÄúPaste text‚Äù to provide the lipid results manually.");return}const O=performance.now(),z=sc(L.data),H=performance.now()-O;if(oc.recordMetrics("agent-processing",H,{agentType:"lipid-profile-import"}),z.readings.length===0){n("error"),S(z.warnings),ce.getInstance().warning("No lipid results found","Review the capture or paste text manually.");return}i(L.data),A(z.readings),c(z.metadata),S(z.warnings),b(Date.now()),n("ready"),y("emr"),x(!1),Q(!1);const X={id:`lipid-${Date.now()}`,capturedAt:Date.now(),source:"emr",sourceRawText:L.data,readings:z.readings,settings:d,metadata:z.metadata};F.current.saveSession(X).catch(()=>{}),ce.getInstance().success("Captured Investigation Summary",`Parsed ${z.readings.length} lipid results.`)}catch(L){console.error("Lipid capture failed:",L),n("error"),S([L instanceof Error?L.message:"Unknown capture error"]),ce.getInstance().error("EMR capture failed","Use ‚ÄúPaste text‚Äù to continue manually."),x(!0)}},[d]),P=u.useCallback((L,O)=>{const z=sc(L);if(z.readings.length===0){S(z.warnings.length>0?z.warnings:["No lipid results recognised."]),ce.getInstance().warning("Unable to parse lipid results","Check the formatting or include Bloods (DATE) lines."),A([]),c({therapyPhases:[]}),n("error");return}i(L),A(z.readings),c(z.metadata),S(z.warnings),b(Date.now()),n("ready"),y(O),Q(!1);const H={id:`lipid-${Date.now()}`,capturedAt:Date.now(),source:O,sourceRawText:L,readings:z.readings,settings:d,metadata:z.metadata};F.current.saveSession(H).catch(()=>{}),ce.getInstance().success("Lipid results parsed",`Found ${z.readings.length} records.`)},[d]),M=u.useCallback(L=>{L.preventDefault();const O=L.currentTarget,z=new FormData(O),H=String(z.get("lipidPaste")??"").trim();if(!H){ce.getInstance().warning("No text provided","Paste the Investigation Summary content first.");return}P(H,"paste")},[P]),$=L=>{const O=[...L].sort((z,H)=>z.date<H.date?-1:1);A(O),c(Du(O)),n("ready")},W=async()=>{const L=await F.current.loadLatestSession();if(!L){ce.getInstance().info("No saved capture","Import from EMR or paste text to begin.");return}A(L.readings),c(L.metadata),i(L.sourceRawText),m(L.settings),b(L.capturedAt),y(L.source),n("ready"),ce.getInstance().success("Loaded last capture",`Restored ${L.readings.length} lipid readings.`)},V=L=>{ce.getInstance().info(`Reading ${new Date(L.date).toLocaleDateString()}`,L.source)};return r?t.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-2",children:t.jsxs("div",{className:"bg-white rounded-2xl w-full max-h-[92vh] overflow-hidden shadow-xl flex flex-col",children:[t.jsxs("header",{className:"flex items-start justify-between px-3 py-2.5 border-b border-gray-200",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Lipid Profile Importer"}),t.jsx("p",{className:"text-[11px] text-gray-600",children:"Capture & visualize lipid trends"})]}),t.jsxs("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close importer",children:[t.jsx("span",{className:"sr-only",children:"Close"}),"√ó"]})]}),t.jsxs("main",{className:"flex-1 overflow-y-auto p-2 space-y-2 bg-surface-secondary",children:[t.jsxs("section",{className:"bg-white border border-gray-200 rounded-xl p-2.5 shadow-sm",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsxs("button",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-gray-900 text-white text-xs font-medium hover:bg-gray-800",onClick:k,disabled:s==="capturing",children:[t.jsx(li,{className:"w-3.5 h-3.5"}),"Import"]}),t.jsxs("button",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-200 text-xs text-gray-700 hover:border-gray-300",onClick:W,children:[t.jsx(Jt,{className:"w-3.5 h-3.5"}),"Load last"]})]}),s==="capturing"&&t.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[t.jsx("span",{className:"w-3 h-3 border-2 border-gray-900 border-t-transparent rounded-full animate-spin"}),"Capturing Investigation Summary‚Ä¶"]})]}),(p||v)&&t.jsxs("div",{className:"mt-2 bg-gray-50 border border-gray-200 rounded-lg p-2 text-[10px] text-gray-600 flex flex-wrap items-center gap-2",children:[t.jsxs("span",{className:"font-medium text-gray-700",children:["Source: Inv. summary ¬∑ ",p?new Date(p).toLocaleDateString():"manual"]}),t.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:k,children:"Refetch"}),t.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>Q(L=>!L),children:j?"Hide raw":"Edit raw"}),t.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>x(!0),children:"Change source ‚Üí Paste text"})]}),v&&t.jsxs("form",{className:"mt-2 space-y-1.5",onSubmit:M,children:[t.jsx("label",{htmlFor:"lipidPaste",className:"text-[10px] uppercase tracking-wide text-gray-500",children:"Paste Investigation Summary text"}),t.jsx("textarea",{id:"lipidPaste",name:"lipidPaste",className:"w-full min-h-[100px] border border-gray-200 rounded-lg px-2 py-1.5 text-xs focus:ring-blue-500 focus:border-blue-500",placeholder:"Bloods (20 Mar 2025): TChol 7.5, LDL 5.2...",defaultValue:a}),t.jsxs("div",{className:"flex items-center justify-end gap-1.5",children:[t.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-2 py-1 text-[10px] text-gray-600 hover:text-gray-800",children:"Cancel"}),t.jsxs("button",{type:"submit",className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg bg-blue-600 text-white text-[10px] font-medium hover:bg-blue-700",children:[t.jsx(_n,{className:"w-3 h-3"}),"Parse"]})]})]}),j&&!v&&t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("label",{htmlFor:"rawSourceEditor",className:"text-xs uppercase tracking-wide text-gray-500",children:"Raw Investigation Summary"}),t.jsx("textarea",{id:"rawSourceEditor",className:"w-full min-h-[160px] border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-blue-500 focus:border-blue-500",value:a,onChange:L=>i(L.target.value)}),t.jsxs("button",{onClick:()=>P(a,N),className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border border-gray-200 text-xs text-gray-700 hover:border-gray-300",children:[t.jsx(zs,{className:"w-3.5 h-3.5"}),"Re-parse raw text"]})]}),f.length>0&&t.jsx("div",{className:"mt-4 bg-amber-50 border border-amber-200 text-amber-900 rounded-lg p-3 text-xs space-y-1",children:f.map((L,O)=>t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(Vt,{className:"w-3.5 h-3.5 mt-0.5"}),t.jsx("span",{children:L})]},O))}),s==="ready"&&o.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsx("h3",{className:"text-xs font-semibold text-gray-800",children:"Parsed results"}),t.jsxs("span",{className:"text-[10px] text-gray-500",children:[o.length," readings"]})]}),t.jsx(ew,{readings:o,analyteOrder:C,onChange:$})]})]}),s==="ready"&&o.length>0&&t.jsx(t.Fragment,{children:t.jsxs("section",{className:"grid lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[t.jsx(Xv,{readings:U,settings:d,overlay:E,therapyPhases:l.therapyPhases,onPointClick:V}),t.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[t.jsx(Em,{className:"w-4 h-4"}),"Click any point to view the original source snippet."]}),t.jsx(rw,{phases:l.therapyPhases})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(qv,{settings:d,onChange:m,availableAnalytes:C}),t.jsx(tw,{summary:g})]})]})}),s!=="ready"&&o.length===0&&!v&&t.jsx("section",{className:"border border-dashed border-gray-300 rounded-xl p-8 text-center text-sm text-gray-500",children:"Import from the EMR or paste text to begin visualising lipid trends."})]}),t.jsx("footer",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-200 bg-white",children:t.jsx("button",{onClick:e,className:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900",children:"Close"})})]})}):null},cc={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,sept:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},dc=["trace","trivial","mild","mildly","moderate","moderately","mod","severe","severely"],mr=()=>{const r=typeof globalThis<"u"?globalThis.crypto:void 0;return r&&typeof r.randomUUID=="function"?r.randomUUID():`tte-${Math.random().toString(36).slice(2,11)}`};function nw(r){return r.replace(/(\d+)(st|nd|rd|th)/gi,"$1")}function Pa(r,e,s){return new Date(Date.UTC(r,e,s)).toISOString().slice(0,10)}function uc(r){const e=[];if(!r)return{precision:"unknown",warnings:[]};const s=nw(r.replace(/[.,]/g," ")).replace(/\s+/g," ").trim(),n=s.match(/^(\d{1,2})\s+([A-Za-z]+)\s+(\d{4})$/);if(n){const[,A,l,c]=n,d=Number(A),m=cc[l.toLowerCase()],g=Number(c);if(Number.isInteger(d)&&m!=null&&Number.isInteger(g))return{iso:Pa(g,m,d),precision:"day",warnings:[],label:`${A.padStart(2,"0")} ${l.slice(0,3)} ${g}`}}const a=s.match(/^([A-Za-z]+)\s+(\d{4})$/);if(a){const[,A,l]=a,c=cc[A.toLowerCase()],d=Number(l);if(c!=null&&Number.isInteger(d))return{iso:Pa(d,c,1),precision:"month",warnings:[],label:`${A.slice(0,3)} ${d}`}}const i=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);if(i){const[,A,l,c]=i,d=Number(A),m=Number(l)-1;let g=Number(c);if(c.length===2&&(g+=g>=70?1900:2e3),d>=1&&d<=31&&m>=0&&m<=11)return{iso:Pa(g,m,d),precision:"day",warnings:[],label:`${A.padStart(2,"0")}/${l.padStart(2,"0")}/${g}`}}const o=s.match(/^(\d{4})$/);if(o){const A=Number(o[1]);return{iso:Pa(A,0,1),precision:"month",warnings:[`Only year provided (${A}); assuming January baseline.`],label:String(A)}}return s.length>0&&e.push(`Unable to parse date token "${r}"`),{precision:"unknown",warnings:e,label:s||void 0}}function aw(r){return/^(?:stress\s+)?echo\b/i.test(r)||/^tte\b/i.test(r)}function iw(r){return/^tte[s]?:?$/i.test(r.replace(/\s+/g,""))}function ow(r){return/^stress\s+echo/i.test(r)?"stress-echo":/^echo/i.test(r)?"echo":"tte"}function Aw(r){const e=r.match(/\(([^)]+)\)/);return e?{inner:e[1],remainder:r.replace(e[0],"").trim()}:{inner:null,remainder:r.trim()}}function Ht(r,e){return{id:mr(),type:"numeric",value:e.value,unit:e.unit,display:e.display??(e.unit?`${e.value}${e.unit.startsWith("%")?"%":` ${e.unit}`}`:String(e.value)),sourceText:r[0].trim(),rawText:r.input?.trim(),flags:e.flags,qualitativeLabel:e.qualitativeLabel,precision:e.precision??"measured",highlight:e.highlight}}function mc(r,e,s){return{id:mr(),type:"text",text:e,sourceText:r[0].trim(),rawText:r.input?.trim(),flags:s}}function lw(r,e){r.includes(e)||r.push(e)}function cw(r,e,s,n){return{id:mr(),valve:r,severity:s,qualifiers:n,sourceText:e[0].trim(),rawText:e.input?.trim()}}function dw(r){return r.map(e=>e.trim()).filter(Boolean).join(" ")}function uw(r){const e=[],s=r.split(/\r?\n/);let n=null,a=!1;for(const i of s){const o=i.trim();if(!o){n&&n.body.push("");continue}const A=o.replace(/^[‚Ä¢¬∑‚ñ™‚ó¶‚Ä¢-]\s*/,"");if(iw(A)){a=!0;continue}if(a&&/^[‚Ä¢¬∑‚ñ™‚ó¶-]/.test(i.trim())){n&&e.push(n),n={modality:"tte",header:A,body:[],sourceLines:[i]};continue}if(aw(A)){n&&e.push(n),n={modality:ow(A),header:A,body:[],sourceLines:[i]},a=!1;continue}n&&(n.body.push(A),n.sourceLines.push(i))}return n&&e.push(n),e}function mw(r){const{inner:e,remainder:s}=Aw(r);let n,a={precision:"unknown",warnings:[]};if(e){const i=e.split(/,\s*/).filter(Boolean);for(const o of i){const A=uc(o);A.iso?a=A:n||(n=o.trim())}}if(!a.iso){const i=s.split(":")[0].split(",");for(const o of i){const A=o.trim();if(!A)continue;const l=uc(A);l.iso?a=l:!n&&A.length>0&&A.split(" ").length<=3&&(/^(?:TTE|Echo|Stress Echo)/i.test(A)||(n=A))}}return{date:a.iso,datePrecision:a.precision,site:n,warnings:a.warnings,label:a.label}}function pw(r){const e=r.toLowerCase();return/normal\s+lv\s+(function|size\s+and\s+function|systolic\s+function)/.test(e)?"normal LV function":/(mildly?\s+reduced|mild\s+lv\s+dysfunction|mild\s+systolic\s+dysfunction)/.test(e)?"mild LV dysfunction":/(moderately?\s+reduced|mod(erate)?\s+lv\s+dysfunction|mod\s+dysfunction)/.test(e)?"moderate LV dysfunction":/(severely?\s+reduced|severe\s+lv\s+dysfunction|severe\s+systolic\s+dysfunction)/.test(e)?"severe LV dysfunction":/hyperdynamic/.test(e)?"hyperdynamic LV function":/low\s+normal/.test(e)?"low-normal LV function":null}function gw(r){const e=r.match(/\b(?:at|performed\s+at)\s+([A-Za-z\s]+(?:Hospital|Heart|Centre|Center|Clinic))\b/i);if(e)return e[1].trim()}function hw(r){const e=dw([r.header,...r.body]),s=mw(r.header),n=[...s.warnings];let a=s.site;a||(a=gw(e));const i={id:mr(),modality:r.modality,label:r.header.split(":")[0].trim(),dateIso:s.date,datePrecision:s.datePrecision,site:a,capturedAt:Date.now(),valveGrades:{},structuralFindings:[],notes:[],rawSource:r.sourceLines.join(`
`)},o=e.toLowerCase(),A=r.modality==="stress-echo"?{id:mr(),modality:"stress-echo",label:i.label,description:e,dateIso:i.dateIso,datePrecision:i.datePrecision}:void 0,l=new Set,c=/\b(?:lvef|ef)\s*(?:[:=]?\s*)?(\d{1,3}(?:\.\d+)?)\s*(%|percent)?/gi,d=e.matchAll(c);for(const C of d){const E=Number(C[1]);Number.isFinite(E)&&(!i.lvef||E!==i.lvef?.value)&&(i.lvef=Ht(C,{value:E,unit:"%",display:`${E}%`}),l.add("lvef"))}if(!i.lvef||i.lvef&&i.lvef.value==null){const C=pw(o);if(C){const E=e.match(new RegExp(C,"i"));E&&(i.lvefCategory=mc(E,C),l.add("lvefCategory"))}}const m=/\bgls\s*(?:[:=]\s*)?(-?\d{1,2}(?:\.\d+)?)\b/gi;for(const C of e.matchAll(m)){const E=Number(C[1]);Number.isFinite(E)&&(i.gls=Ht(C,{value:E,unit:"%",display:`${E}%`}))}const g=/\blvedd\s*[:=]?\s*(\d{2,3}(?:\.\d+)?)\s*(mm)?/gi;for(const C of e.matchAll(g)){const E=Number(C[1]);Number.isFinite(E)&&(i.lvedd=Ht(C,{value:E,unit:"mm"}))}const h=/\blavi\s*[:=]?\s*(\d{2,3}(?:\.\d+)?)\s*(?:ml\/m2|ml\/m¬≤|mlm2|ml)?/gi;for(const C of e.matchAll(h)){const E=Number(C[1]);Number.isFinite(E)&&(i.lavi=Ht(C,{value:E,unit:"mL/m¬≤"}))}const p=/\btapse\s*[:=]?\s*(\d{1,2}(?:\.\d+)?)\s*(?:mm)?/gi;for(const C of e.matchAll(p)){const E=Number(C[1]);Number.isFinite(E)&&(i.tapse=Ht(C,{value:E,unit:"mm"}))}const b=/\b(?:av\s*)?(?:mean\s*gradient|mpg)\s*[:=]?\s*(\d{1,2}(?:\.\d+)?)\s*(?:mm\s*hg|mmhg|mm)?/gi;for(const C of e.matchAll(b)){const E=Number(C[1]);Number.isFinite(E)&&(i.avMpg=Ht(C,{value:E,unit:"mmHg",display:`${E} mmHg`}))}const N=/\bdi\s*[:=]?\s*(0\.\d{1,2}|\d(?:\.\d{1,2})?)\b/gi;for(const C of e.matchAll(N)){const E=Number(C[1]);Number.isFinite(E)&&(i.di=Ht(C,{value:E,display:E.toFixed(2)}))}const y=/\bava\s*[:=]?\s*(\d(?:\.\d+)?)\s*(?:cm2|cm¬≤|cm\^2|cm\*cm)?/gi;for(const C of e.matchAll(y)){const E=Number(C[1]);Number.isFinite(E)&&(i.ava=Ht(C,{value:E,unit:"cm¬≤",display:`${E.toFixed(2)} cm¬≤`}))}const j=/\bsvi\s*[:=]?\s*(\d{2,3}(?:\.\d+)?)\s*(?:ml\/m2|ml\/m¬≤|ml)?/gi;for(const C of e.matchAll(j)){const E=Number(C[1]);Number.isFinite(E)&&(i.svi=Ht(C,{value:E,unit:"mL/m¬≤"}))}const Q=/\b(RVSP|PASP|TR\s*(?:gradient|‚àÜ|delta|grad))\s*[:=]?\s*(\d{1,3}(?:\.\d+)?)\s*(?:mm\s*hg|mmhg|mm)?(\s*\+\s*RA)?/gi;for(const C of e.matchAll(Q)){const E=C[1].toUpperCase(),U=Number(C[2]),k=!!C[3];Number.isFinite(U)&&(k||/TR/.test(E)?(i.trGradient=Ht(C,{value:U,unit:"mmHg",flags:["requires-rap"],highlight:"+RA",display:`${U} mmHg`}),i.pasp=mc(C,`${E} ${U}+RA`,["rap-unknown"]),lw(n,`Detected ${E} ${U}+RA ‚Äì RAP not provided.`)):E==="PASP"?i.pasp=Ht(C,{value:U,unit:"mmHg",display:`${U} mmHg`}):i.rvsp=Ht(C,{value:U,unit:"mmHg",display:`${U} mmHg`}))}const v=new RegExp(`\\b((?:${dc.join("|")})(?:[-/\\s](?:${dc.join("|")}))?)\\s+(AR|MR|TR|aortic regurg(?:itation)?|mitral regurg(?:itation)?|tricuspid regurg(?:itation)?)`,"gi");for(const C of e.matchAll(v)){const E=C[1].replace(/\s+/g," ").toLowerCase(),U=C[2].toLowerCase();let k=null;if((U.startsWith("aortic")||U==="ar")&&(k="ar"),(U.startsWith("mitral")||U==="mr")&&(k="mr"),(U.startsWith("tricuspid")||U==="tr")&&(k="tr"),!k)continue;const P=E.replace(/moderately/g,"mod").replace(/mildly/g,"mild"),M=[];P.includes("mod")&&P.includes("severe")&&M.push("mixed-severity"),P.includes("mild")&&P.includes("mod")&&M.push("mild-mod"),i.valveGrades[k]=cw(k,C,P,M.length?M:void 0)}const x=[],f=/\bholodiastolic\s+flow\s+reversal\b[^.]*?(ascending|descending|upper\s+desc(?:ending)?)?\s*aorta?/gi;for(const C of e.matchAll(f))x.push({id:mr(),label:"Holodiastolic flow reversal",description:C[0].trim(),sourceText:C[0].trim(),category:"ar"});const S=/\bPHT\s*[:=]?\s*(\d{2,4})\b/gi;for(const C of e.matchAll(S))x.push({id:mr(),label:"AR pressure half-time",description:`PHT ${C[1]} ms`,sourceText:C[0].trim(),category:"ar"});const F=/\b(rv|right ventricle)\s+(?:mildly\s+|moderately\s+|severely\s+)?(?:dilated|enlarged)\b/gi;for(const C of e.matchAll(F))x.push({id:mr(),label:"RV dilation",description:C[0].trim(),sourceText:C[0].trim(),category:"rv"});const w=/\b(right atrium|RA)\s+(?:mildly\s+|moderately\s+|severely\s+)?(?:enlarged|dilated)\b/gi;for(const C of e.matchAll(w))x.push({id:mr(),label:"RA enlargement",description:C[0].trim(),sourceText:C[0].trim(),category:"rv"});const T=/\bRV\s+(?:function|systolic\s+function)\s+(?:normal|reduced|depressed|impaired)\b/gi;for(const C of e.matchAll(T))x.push({id:mr(),label:"RV function",description:C[0].trim(),sourceText:C[0].trim(),category:"rv"});return r.modality==="stress-echo"&&(i.stressEchoDetails=e),i.structuralFindings=x,i.notes=[...x],i.dateIso||n.push(`No reliable date identified for "${i.label}".`),!l.has("lvef")&&!i.lvefCategory&&n.push(`No EF value detected for "${i.label}".`),{row:i,event:A,rowWarnings:n}}function fw(r,e){const s=r.trim();if(!s)return{rows:[],events:[],warnings:["No input text provided."],notes:[]};const n=uw(s),a=[],i=[],o=[],A=[];return n.forEach(l=>{const{row:c,event:d,rowWarnings:m}=hw(l);a.push(c),d&&i.push(d),m.length>0&&o.push(...m),A.push(...c.structuralFindings)}),a.sort((l,c)=>l.dateIso&&c.dateIso?l.dateIso.localeCompare(c.dateIso):l.dateIso?-1:c.dateIso?1:l.label.localeCompare(c.label)),oe.info("Parsed TTE trend entries",{agent:"tte-trend",rows:a.length,events:i.length,warnings:o.length}),{rows:a,events:i,warnings:o,notes:A}}const xw=864e5,bw=xw*30.4375;function ws(r){if(!r.dateIso)return null;const e=new Date(r.dateIso);return Number.isNaN(e.valueOf())?null:e}function qt(r){return!r||r.type!=="numeric"?null:typeof r.value=="number"?r.value:null}function Nn(r){if(r){if(r.type==="text")return r.text;if(r.type==="numeric")return r.display??`${r.value}${r.unit?` ${r.unit}`:""}`}}function yw(r,e){return(e.getTime()-r.getTime())/bw}function cn(r){if(r.length<2)return null;const e=r.map(c=>yw(r[0].date,c.date)),s=r.map(c=>c.value),n=r.length,a=e.reduce((c,d)=>c+d,0),i=s.reduce((c,d)=>c+d,0),o=e.reduce((c,d,m)=>c+d*s[m],0),A=e.reduce((c,d)=>c+d*d,0),l=n*A-a*a;return l===0?null:(n*o-a*i)/l}function dn(r){return r==null?"insufficient-data":r>.25?"rising":r<-.25?"falling":"stable"}function Cr(r,e,s="",n=1){if(r==null||e==null)return;const a=r-e;return Math.abs(a)<.01?void 0:`${a>0?`+${a.toFixed(n)}`:a.toFixed(n)}${s?` ${s}`:""}`}function vw(r,e){if(r==null||e==null||e===0)return;const s=(r-e)/e*100;if(!(!Number.isFinite(s)||Math.abs(s)<1))return`${s>0?"+":""}${s.toFixed(0)}% vs baseline`}function ww(r,e){const s=[...r].sort((n,a)=>n.dateIso&&a.dateIso?n.dateIso.localeCompare(a.dateIso):n.dateIso?1:a.dateIso?-1:0);for(let n=s.length-1;n>=0;n-=1){const a=e(s[n]);if(a)return{row:s[n],value:a}}return{}}function Bw(r){const e=[...r].filter(l=>ws(l)!==null).sort((l,c)=>l.dateIso&&c.dateIso?l.dateIso.localeCompare(c.dateIso):0),s=e.map(l=>{const c=qt(l.lvef);return c!=null?{row:l,date:ws(l),value:c}:null}).filter(l=>l!=null),n=e.map(l=>{const c=qt(l.rvsp);return c!=null?{row:l,date:ws(l),value:c}:null}).filter(l=>l!=null),a=e.map(l=>{const c=qt(l.avMpg);return c!=null?{row:l,date:ws(l),value:c}:null}).filter(l=>l!=null),i=e.map(l=>{const c=qt(l.lvedd);return c!=null?{row:l,date:ws(l),value:c}:null}).filter(l=>l!=null),o=e.map(l=>{const c=qt(l.lavi);return c!=null?{row:l,date:ws(l),value:c}:null}).filter(l=>l!=null),A=[];if(s.length>0){const l=s.at(-1),c=s.length>1?s.at(-2):void 0,d=s[0],m=cn(s.map(p=>({date:p.date,value:p.value}))),g=c?c.value:null,h=d?d.value:null;A.push({field:"lvef",label:"LVEF / EF",current:l.row.lvef,previous:c?.row.lvef,baseline:d?.row.lvef,deltaFromPrevious:Cr(l.value,g,"%",0),deltaFromBaseline:vw(l.value,h),slopeValue:m,trajectory:dn(m),thresholdCrossings:[]})}else{const l=ww(r,c=>c.lvefCategory);l.value&&A.push({field:"lvef",label:"LVEF",current:l.value,previous:void 0,baseline:void 0,deltaFromBaseline:void 0,deltaFromPrevious:void 0,slopeValue:null,trajectory:"insufficient-data",thresholdCrossings:[]})}if(n.length>0){const l=n.at(-1),c=n.length>1?n.at(-2):void 0,d=n[0],m=cn(n.map(p=>({date:p.date,value:p.value}))),g=c?c.value:null,h=d?d.value:null;A.push({field:"rvsp",label:"RVSP",current:l.row.rvsp,previous:c?.row.rvsp,baseline:d?.row.rvsp,deltaFromPrevious:Cr(l.value,g,"mmHg",0),deltaFromBaseline:Cr(l.value,h,"mmHg",0),slopeValue:m,trajectory:dn(m),thresholdCrossings:[]})}if(i.length>0){const l=i.at(-1),c=i.length>1?i.at(-2):void 0,d=i[0],m=cn(i.map(p=>({date:p.date,value:p.value}))),g=c?c.value:null,h=d?d.value:null;A.push({field:"lvedd",label:"LVEDD",current:l.row.lvedd,previous:c?.row.lvedd,baseline:d?.row.lvedd,deltaFromPrevious:Cr(l.value,g,"mm",0),deltaFromBaseline:Cr(l.value,h,"mm",0),slopeValue:m,trajectory:dn(m),thresholdCrossings:[]})}if(a.length>0){const l=a.at(-1),c=a.length>1?a.at(-2):void 0,d=a[0],m=cn(a.map(p=>({date:p.date,value:p.value}))),g=c?c.value:null,h=d?d.value:null;A.push({field:"avMpg",label:"AV mean gradient",current:l.row.avMpg,previous:c?.row.avMpg,baseline:d?.row.avMpg,deltaFromPrevious:Cr(l.value,g,"mmHg",0),deltaFromBaseline:Cr(l.value,h,"mmHg",0),slopeValue:m,trajectory:dn(m),thresholdCrossings:[]})}if(o.length>0){const l=o.at(-1),c=o.length>1?o.at(-2):void 0,d=o[0],m=cn(o.map(p=>({date:p.date,value:p.value}))),g=c?c.value:null,h=d?d.value:null;A.push({field:"lavi",label:"LAVI",current:l.row.lavi,previous:c?.row.lavi,baseline:d?.row.lavi,deltaFromPrevious:Cr(l.value,g,"mL/m¬≤",0),deltaFromBaseline:Cr(l.value,h,"mL/m¬≤",0),slopeValue:m,trajectory:dn(m),thresholdCrossings:[]})}return A}function Cw(r,e){const s=[],n=r.find(A=>A.field==="lvef");if(n){const A=qt(n.current),l=qt(n.previous),c=qt(n.baseline),d=(m,g)=>{if(A==null)return;const h=[l,c].filter(b=>b!=null);if(h.length===0)return;h.some(b=>b>=m&&A<m||b<m&&A>=m)&&s.push(`LVEF crossed ${m}% (${g})`)};d(50,"HFpEF boundary"),d(40,"HFrEF boundary")}const a=r.find(A=>A.field==="rvsp");if(a){const A=qt(a.current);A!=null&&(A>=50?s.push("RVSP ‚â•50 mmHg ‚Äì high probability of pulmonary hypertension"):A>=40&&s.push("RVSP ‚â•40 mmHg ‚Äì intermediate probability of pulmonary hypertension"))}const i=r.find(A=>A.field==="avMpg");if(i){const A=qt(i.current);A!=null&&A>=40&&s.push("AV mean gradient ‚â•40 mmHg ‚Äì severe AS range");const l=[...e].filter(c=>c.di&&c.di.type==="numeric").sort((c,d)=>c.dateIso&&d.dateIso?c.dateIso.localeCompare(d.dateIso):0).at(-1);l&&l.di&&l.di.type==="numeric"&&l.di.value<=.25&&s.push("DI ‚â§0.25 ‚Äì supportive of severe AS")}const o=[...e].filter(A=>A.tapse&&A.tapse.type==="numeric").sort((A,l)=>A.dateIso&&l.dateIso?A.dateIso.localeCompare(l.dateIso):0).at(-1);return o&&o.tapse&&o.tapse.type==="numeric"&&o.tapse.value<17&&s.push("TAPSE <17 mm ‚Äì reduced RV longitudinal function"),s}function ao(r,e){return r.filter(e).map(n=>n.description||n.label)}function Nw(r){const e=[],s=[];r.some(i=>i.lvef&&i.lvef.type==="numeric")||e.push("Numeric EF absent"),r.some(i=>i.avMpg&&i.avMpg.type==="numeric")||e.push("AV mean gradient absent"),r.some(i=>i.rvsp)||e.push("RVSP missing"),r.some(i=>i.lvedd)||e.push("LVEDD missing"),r.some(i=>i.lavi)||e.push("LAVI missing"),r.forEach(i=>{i.pasp?.type==="text"&&i.pasp.flags?.includes("rap-unknown")&&s.push(`PASP ${i.pasp.text} ‚Äì RA pressure not specified`)});const a=Array.from(new Set(r.map(i=>i.site).filter(i=>!!i))).length>1?["Site variability noted"]:[];return{missingMetrics:e,ambiguousFindings:s,interLabChanges:a}}function jw(r,e){if(r.length===0)return"No numeric TTE metrics available";const s=r.find(a=>a.field==="lvef");if(!s)return"Qualitative EF only ‚Äì numeric metrics not captured";const n=qt(s.current);if(n!=null){const a=e.filter(o=>o.lvef&&o.lvef===s.current).sort((o,A)=>o.dateIso&&A.dateIso?o.dateIso.localeCompare(A.dateIso):0).at(-1),i=a?.dateIso?new Date(a.dateIso).toLocaleDateString(void 0,{month:"short",year:"numeric"}):"";return`Latest EF ${n.toFixed(0)}%${i?` (${i})`:""}`}return`Latest EF: ${Nn(s.current)??"qualitative only"}`}function Sw(r,e,s,n,a){const i=[],o=r.find(m=>m.field==="lvef");if(o&&o.current){const m=Nn(o.current),g=o.deltaFromBaseline??o.deltaFromPrevious,h=o.trajectory&&o.trajectory!=="insufficient-data"?o.trajectory:void 0;i.push(`EF ${m??"unavailable"}${g?` (${g})`:""}${h?`, ${h}`:""}`)}const A=r.find(m=>m.field==="rvsp");if(A&&A.current){const m=Nn(A.current),g=A.deltaFromPrevious;i.push(`RVSP ${m??"n/a"}${g?` (${g})`:""}`)}const l=r.find(m=>m.field==="avMpg");if(l&&l.current){const m=Nn(l.current);i.push(`AV MPG ${m??"n/a"}`)}const c=r.find(m=>m.field==="lavi");if(c&&c.current){const m=Nn(c.current);i.push(`LAVI ${m??"n/a"}`)}const d=[];return i.length>0&&d.push(i.join(" ¬∑ ")),e.length>0&&d.push(e.join("; ")),s.length>0&&d.push(`Right heart: ${s.join("; ")}`),n.length>0&&d.push(`Valves: ${n.join("; ")}`),a.ambiguousFindings.length>0&&d.push(`Ambiguities: ${a.ambiguousFindings.join("; ")}`),a.missingMetrics.length>0&&d.push(`Missing: ${a.missingMetrics.join(", ")}`),d.join(". ")}function Ew(r){const e=r.filter(c=>c.modality!=="stress-echo"),s=Bw(e),n=Cw(s,e),a=ao(r.flatMap(c=>c.structuralFindings),c=>c.category==="rv"||c.category==="tr"),i=ao(r.flatMap(c=>c.structuralFindings),c=>c.category==="ar"||c.category==="mr"),o=ao(r.flatMap(c=>c.structuralFindings),c=>c.category==="other"||c.category==="context"),A=Nw(e),l=Sw(s,n,a,i,A);return{headline:jw(s,e),narrative:l,metrics:s,thresholds:n,rightHeartContext:a,valveContext:i,structuralHighlights:o,dataQuality:A,patientFriendly:s.length>0?"Your heart ultrasound trend has been summarised for your clinician.":void 0}}const Xt={lvef:{key:"lvef",label:"LVEF / EF (%)",color:"#1f2937",unit:"%",precision:0},rvsp:{key:"rvsp",label:"RVSP (mmHg)",color:"#dc2626",unit:"mmHg",precision:0},lvedd:{key:"lvedd",label:"LVEDD (mm)",color:"#0369a1",unit:"mm",precision:0},avMpg:{key:"avMpg",label:"AV MPG (mmHg)",color:"#9a3412",unit:"mmHg",precision:0},lavi:{key:"lavi",label:"LAVI (mL/m¬≤)",color:"#2563eb",unit:"mL/m¬≤",precision:0}},pc=[{id:"hfreF",label:"HFrEF ‚â§40%",max:40,color:"rgba(220, 38, 38, 0.10)",description:"Reduced EF range"},{id:"hfmrEF",label:"HFmrEF 41‚Äì49%",min:40,max:50,color:"rgba(234, 179, 8, 0.12)",description:"Mid-range EF"},{id:"hfpEF",label:"HFpEF ‚â•50%",min:50,color:"rgba(34, 197, 94, 0.10)",description:"Preserved EF"}],gc=[{id:"normal",label:"<40 mmHg",max:40,color:"rgba(59, 130, 246, 0.08)",description:"Low probability PH"},{id:"intermediate",label:"40‚Äì49 mmHg",min:40,max:50,color:"rgba(234, 179, 8, 0.12)",description:"Intermediate probability PH"},{id:"high",label:"‚â•50 mmHg",min:50,color:"rgba(220, 38, 38, 0.12)",description:"High probability PH"}],hc=[{id:"reference",label:"Reference 35‚Äì60 mm (general)",min:35,max:60,color:"rgba(148, 163, 184, 0.10)",description:"ASE reference range (sex/BSA dependent)"}],fc=[{id:"mild",label:"<20 mmHg",max:20,color:"rgba(34, 197, 94, 0.10)",description:"Mild AS"},{id:"moderate",label:"20‚Äì39 mmHg",min:20,max:40,color:"rgba(234, 179, 8, 0.12)",description:"Moderate AS"},{id:"severe",label:"‚â•40 mmHg",min:40,color:"rgba(220, 38, 38, 0.12)",description:"Severe AS"}],un={label:"TAPSE 17 mm",value:17,color:"#dc2626",dash:[6,6]},Us={timeFilter:"12m",showLVEFOnly:!1,enabledSeries:{lvef:!0,rvsp:!1,lvedd:!1,avMpg:!1,lavi:!1},contextBands:{lvef:!0,rvsp:!0,lvedd:!0,avMpg:!0,tapse:!0,lavi:!1}},Fw=[{value:"6m",label:"Last 6 months"},{value:"12m",label:"Last 12 months"},{value:"24m",label:"Last 24 months"},{value:"all",label:"All time"}],ur={LATEST:"tte-trend-latest",SETTINGS:"tte-trend-settings",HISTORY:"tte-trend-history"},Qw=5;class Ts{static instance;static getInstance(){return Ts.instance||(Ts.instance=new Ts),Ts.instance}async saveSession(e){await chrome.storage.local.set({[ur.LATEST]:e}),await this.appendHistory(e),oe.info("TTE trend session saved",{component:"tte-trend-storage",rows:e.rows.length})}async loadLatestSession(){return(await chrome.storage.local.get(ur.LATEST))[ur.LATEST]??null}async clearLatest(){await chrome.storage.local.remove(ur.LATEST)}async saveSettings(e){await chrome.storage.local.set({[ur.SETTINGS]:e})}async loadSettings(){const s=(await chrome.storage.local.get(ur.SETTINGS))[ur.SETTINGS];return s?{...Us,...s,enabledSeries:{...Us.enabledSeries,...s.enabledSeries},contextBands:{...Us.contextBands,...s.contextBands}}:Us}async appendHistory(e){try{const n=(await chrome.storage.local.get(ur.HISTORY))[ur.HISTORY]??[];n.unshift(e);const a=n.slice(0,Qw);await chrome.storage.local.set({[ur.HISTORY]:a})}catch(s){oe.warn("Failed to append TTE trend history",{component:"tte-trend-storage",error:s instanceof Error?s.message:"unknown"})}}}function Iw(r){if(!r.dateIso)return null;const e=new Date(r.dateIso);return Number.isNaN(e.valueOf())?null:e}function Uw(r,e){switch(e){case"lvef":return r.lvef&&r.lvef.type==="numeric"?r.lvef.value:null;case"rvsp":return r.rvsp&&r.rvsp.type==="numeric"?r.rvsp.value:null;case"lvedd":return r.lvedd&&r.lvedd.type==="numeric"?r.lvedd.value:null;case"avMpg":return r.avMpg&&r.avMpg.type==="numeric"?r.avMpg.value:null;case"lavi":return r.lavi&&r.lavi.type==="numeric"?r.lavi.value:null;default:return null}}function xc(r,e){return r.map(s=>{const n=Iw(s);if(!n)return null;const a=Uw(s,e);return a==null?null:{row:s,date:n,value:a,field:e}}).filter(s=>s!=null).sort((s,n)=>s.date.getTime()-n.date.getTime())}function bc(r){return new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),1))}function mn(r){const e=new Date(r);return e.setUTCMonth(e.getUTCMonth()+1),e}function yc(r){if(r.length===0)return[];const e=r.map(o=>o.date).sort((o,A)=>o.getTime()-A.getTime()),s=bc(e[0]),n=bc(e.at(-1)),a=[];let i=new Date(s);for(;i<=n;)a.push({date:new Date(i),label:i.toLocaleDateString(void 0,{month:"short",year:"2-digit"})}),i=mn(i);return a.length===0&&(a.push({date:new Date(s),label:s.toLocaleDateString(void 0,{month:"short",year:"2-digit"})}),a.push({date:mn(s),label:mn(s).toLocaleDateString(void 0,{month:"short",year:"2-digit"})})),a.length===1&&a.push({date:mn(a[0].date),label:mn(a[0].date).toLocaleDateString(void 0,{month:"short",year:"2-digit"})}),a}function vc(r,e){if(r===e)return{min:r-5,max:e+5};const s=(e-r)*.15;return{min:Math.floor(r-s),max:Math.ceil(e+s)}}const Tw=2,kw=({rows:r,settings:e,onPointClick:s})=>{const n=u.useRef(null),a=u.useRef(null),[i,o]=u.useState({visible:!1,x:0,y:0,text:""}),[A,l]=u.useState({width:640,height:360}),c=u.useMemo(()=>xc(r,"lvef"),[r]),d=u.useMemo(()=>e.showLVEFOnly?null:["rvsp","lvedd","avMpg","lavi"].find(b=>e.enabledSeries[b])??null,[e]),m=u.useMemo(()=>d?xc(r,d):[],[r,d]),g=u.useMemo(()=>{const h=[...c,...m];return h.length===0?[]:yc(h)},[c,m]);return u.useEffect(()=>{const h=()=>{if(!a.current)return;const p=a.current.clientWidth;l({width:Math.max(320,p-12),height:360})};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),u.useEffect(()=>{const h=n.current;if(!h)return;const p=h.getContext("2d");if(!p)return;const{width:b,height:N}=A,y=window.devicePixelRatio||1;h.width=b*y,h.height=N*y,h.style.width=`${b}px`,h.style.height=`${N}px`,p.scale(y,y),p.clearRect(0,0,b,N);const j={top:48,right:d?70:40,bottom:64,left:60},Q=b-j.left-j.right,v=N-j.top-j.bottom;if(c.length===0&&m.length===0){p.fillStyle="#94a3b8",p.font="13px Inter, sans-serif",p.textAlign="center",p.fillText("No chartable metrics detected",b/2,N/2);return}const x=c.map(D=>D.value),S=(e.contextBands.lvef?pc:[]).reduce((D,K)=>(typeof K.min=="number"&&(D.min=Math.min(D.min,K.min)),typeof K.max=="number"&&(D.max=Math.max(D.max,K.max)),D),{min:Math.min(...x,20),max:Math.max(...x,80)});let F=Math.min(...x,S.min),w=Math.max(...x,S.max);(!Number.isFinite(F)||Number.isNaN(F))&&(F=20),(!Number.isFinite(w)||Number.isNaN(w))&&(w=80),{min:F,max:w}=vc(F,w),F=Math.min(F,0),w=Math.max(w,90);const T=m.map(D=>D.value);let C=T.length>0?Math.min(...T):0,E=T.length>0?Math.max(...T):0;d&&T.length>=Tw?((d==="rvsp"?gc:d==="lvedd"?hc:d==="avMpg"?fc:[]).forEach(K=>{typeof K.min=="number"&&(C=Math.min(C,K.min)),typeof K.max=="number"&&(E=Math.max(E,K.max))}),{min:C,max:E}=vc(C,E),d==="rvsp"&&(C=Math.max(C,0))):d&&(C=0,E=d==="rvsp"?80:d==="lvedd"?70:d==="avMpg"?60:120);const U=g.length>0?g:yc(c),k=U[0]?.date??c[0]?.date??m[0]?.date??new Date,P=U.at(-1)?.date??c.at(-1)?.date??m.at(-1)?.date??new Date(k),M=D=>{const K=P.getTime()-k.getTime()||1,ee=D.getTime()-k.getTime();return j.left+ee/K*Q},$=D=>j.top+v-(D-F)/(w-F||1)*v,W=D=>j.top+v-(D-C)/(E-C||1)*v;if(p.strokeStyle="#e2e8f0",p.lineWidth=1,p.beginPath(),p.moveTo(j.left,j.top),p.lineTo(j.left,j.top+v),p.lineTo(j.left+Q,j.top+v),p.stroke(),p.fillStyle="#64748b",p.font="11px Inter, sans-serif",p.textAlign="center",p.textBaseline="top",U.forEach((D,K)=>{const ee=U.length===1?j.left+Q/2:j.left+K/(U.length-1)*Q;p.fillText(D.label,ee,j.top+v+12),p.beginPath(),p.strokeStyle="rgba(226, 232, 240, 0.6)",p.moveTo(ee,j.top),p.lineTo(ee,j.top+v),p.stroke()}),p.save(),e.contextBands.lvef&&pc.forEach(D=>{const K=D.max!=null?$(D.max):j.top,ee=D.min!=null?$(D.min):j.top+v;p.fillStyle=D.color,p.fillRect(j.left,Math.min(K,ee),Q,Math.abs(ee-K)),p.fillStyle="#475569",p.font="10px Inter, sans-serif",p.fillText(D.label,j.left+6,Math.min(K,ee)+10)}),d&&e.contextBands[d]&&(d==="rvsp"?gc:d==="lvedd"?hc:d==="avMpg"?fc:[]).forEach(K=>{const ee=K.max!=null?W(K.max):j.top,pe=K.min!=null?W(K.min):j.top+v;p.fillStyle=K.color,p.fillRect(j.left,Math.min(ee,pe),Q,Math.abs(pe-ee)),p.fillStyle="#475569",p.font="10px Inter, sans-serif",p.textAlign="right",p.fillText(K.label,j.left+Q-6,Math.min(ee,pe)+10),p.textAlign="left"}),p.restore(),p.fillStyle="#0f172a",p.font="12px Inter, sans-serif",p.textAlign="center",p.fillText("Month",j.left+Q/2,j.top+v+42),p.save(),p.translate(20,j.top+v/2),p.rotate(-Math.PI/2),p.fillText("LVEF / EF (%)",0,0),p.restore(),d&&(p.save(),p.translate(b-18,j.top+v/2),p.rotate(Math.PI/2),p.fillText(Xt[d].label,0,0),p.restore()),e.contextBands.tapse){const D=[...r].filter(K=>K.tapse&&K.tapse.type==="numeric").sort((K,ee)=>K.dateIso&&ee.dateIso?K.dateIso.localeCompare(ee.dateIso):0).at(-1);if(D&&D.tapse&&D.tapse.type==="numeric"){const K=un.value,ee=d?W(K):$(K);p.save(),p.setLineDash(un.dash??[5,5]),p.strokeStyle=un.color,p.lineWidth=1,p.beginPath(),p.moveTo(j.left,ee),p.lineTo(j.left+Q,ee),p.stroke(),p.restore(),p.fillStyle=un.color,p.font="10px Inter, sans-serif",p.fillText(un.label,j.left+Q-6,ee-6)}}const V=(D,K,ee)=>{if(D.length===0)return;const pe=Xt[K];p.strokeStyle=pe.color,p.lineWidth=2,p.lineJoin="round",p.beginPath(),D.forEach((ae,me)=>{const le=M(ae.date),re=ee(ae.value);me===0?p.moveTo(le,re):p.lineTo(le,re)}),p.stroke(),D.forEach(ae=>{const me=M(ae.date),le=ee(ae.value);p.beginPath(),p.fillStyle="#fff",p.strokeStyle=pe.color,p.lineWidth=2,p.arc(me,le,4,0,Math.PI*2),p.fill(),p.stroke()})};V(c,"lvef",$),d&&V(m,d,d==="lvef"?$:W),p.fillStyle="#475569",p.font="10px Inter, sans-serif",p.textAlign="right";const L=6;for(let D=0;D<=L;D+=1){const K=F+D/L*(w-F),ee=$(K);p.fillText(`${K.toFixed(0)}`,j.left-6,ee+3),p.beginPath(),p.strokeStyle="rgba(226, 232, 240, 0.45)",p.moveTo(j.left,ee),p.lineTo(j.left+Q,ee),p.stroke()}if(d){p.textAlign="left";for(let D=0;D<=L;D+=1){const K=C+D/L*(E-C),ee=W(K);p.fillText(`${K.toFixed(0)}`,j.left+Q+6,ee+3)}}const O=[{label:Xt.lvef.label,color:Xt.lvef.color}];d&&d!=="lvef"&&O.push({label:Xt[d].label,color:Xt[d].color});const z=j.left,H=j.top-32;p.font="11px Inter, sans-serif",p.textAlign="left",O.forEach((D,K)=>{const ee=z,pe=H+K*16;p.fillStyle=D.color,p.fillRect(ee,pe,28,2),p.fillStyle="#0f172a",p.fillText(D.label,ee+36,pe+4)});const X=D=>{const K=h.getBoundingClientRect(),ee=h.width/K.width,pe=h.height/K.height,ae=(D.clientX-K.left)*ee,me=(D.clientY-K.top)*pe,le=[...c,...m].find(re=>{const te=M(re.date),he=re.field==="lvef"?$(re.value):W(re.value);return Math.sqrt((te*y-ae)**2+(he*y-me)**2)<12});if(le){const re=le.date.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"}),te=le.value.toFixed(Xt[le.field].precision),he=le.row.site?` ¬∑ ${le.row.site}`:"";o({visible:!0,x:M(le.date),y:le.field==="lvef"?$(le.value):W(le.value),text:`${re}${he}
${Xt[le.field].label.split(" ")[0]} ${te}`}),h.style.cursor="pointer"}else o(re=>re.visible?{...re,visible:!1}:re),h.style.cursor="default"},Ae=D=>{if(!s)return;const K=h.getBoundingClientRect(),ee=h.width/K.width,pe=h.height/K.height,ae=(D.clientX-K.left)*ee,me=(D.clientY-K.top)*pe,le=[...c,...m].find(re=>{const te=M(re.date),he=re.field==="lvef"?$(re.value):W(re.value);return Math.sqrt((te*y-ae)**2+(he*y-me)**2)<14});le&&s(le.row.id,le.field)};return h.addEventListener("pointermove",X),h.addEventListener("click",Ae),()=>{h.removeEventListener("pointermove",X),h.removeEventListener("click",Ae)}},[A,c,m,d,g,s,r,e]),t.jsxs("div",{ref:a,className:"relative w-full",children:[t.jsx("canvas",{ref:n,className:"w-full rounded-xl border border-slate-200 bg-white shadow-sm"}),i.visible&&t.jsx("div",{className:"absolute z-10 rounded-md border border-slate-300 bg-white px-3 py-2 text-xs text-slate-700 shadow-lg",style:{left:i.x+12,top:i.y+12},children:i.text.split(`
`).map(h=>t.jsx("div",{children:h},h))})]})},Pw=({settings:r,onToggleSeries:e,onTimeFilterChange:s,onShowLVEFOnlyChange:n,onToggleContext:a})=>{const i=["rvsp","lvedd","avMpg","lavi"],o=["lvef","rvsp","lvedd","avMpg","tapse"];return t.jsx("div",{className:"rounded-xl border border-slate-200 bg-surface-secondary px-3 py-3 text-sm text-slate-700",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Series"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-800 shadow-sm",disabled:!0,children:[t.jsx("span",{children:Xt.lvef.label}),t.jsx("span",{className:"rounded bg-slate-200 px-2 py-0.5 text-[10px] font-semibold uppercase text-slate-600",children:"Default"})]}),t.jsx("div",{className:"flex flex-col gap-2",children:i.map(A=>{const l=r.enabledSeries[A];return t.jsxs("button",{type:"button",className:`inline-flex w-full items-center gap-2 rounded-lg border px-3 py-1.5 text-xs transition ${l?"border-slate-900 bg-slate-900 text-white":"border-slate-300 bg-white text-slate-700 hover:border-slate-400"}`,onClick:()=>e(A),children:[t.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:Xt[A].color}}),Xt[A].label]},A)})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Time window"}),t.jsx("div",{className:"flex flex-col gap-2",children:Fw.map(A=>t.jsx("button",{type:"button",onClick:()=>s(A.value),className:`rounded-lg border px-3 py-1.5 text-left text-xs font-medium ${r.timeFilter===A.value?"border-slate-900 bg-slate-900 text-white":"border-slate-300 bg-white text-slate-700 hover:border-slate-400"}`,children:A.label},A.value))})]}),t.jsxs("label",{className:"inline-flex w-full cursor-pointer items-center gap-2 rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs text-slate-700",children:[t.jsx("input",{type:"checkbox",className:"h-3 w-3 rounded border-slate-300",checked:r.showLVEFOnly,onChange:A=>n(A.target.checked)}),"Show LVEF only"]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Context overlays"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.map(A=>{const l=r.contextBands[A];return t.jsx("button",{type:"button",className:`rounded-lg border px-3 py-1 text-xs transition ${l?"border-slate-900 bg-slate-900/90 text-white":"border-slate-300 bg-white text-slate-600 hover:border-slate-400"}`,onClick:()=>a(A),children:A.toUpperCase()},A)})})]})]})})};function Dw(r){if(!r.dateIso)return r.label;const e=new Date(r.dateIso),s=r.datePrecision==="month"?{month:"short",year:"numeric"}:{day:"numeric",month:"short",year:"numeric"};return e.toLocaleDateString(void 0,s)}function Rw(r){switch(r){case"lvef":return"%";case"rvsp":return"mmHg";case"lvedd":return"mm";case"avMpg":return"mmHg";case"tapse":return"mm";case"gls":return"%";case"lavi":return"mL/m¬≤";case"di":return"ratio";case"ava":return"cm¬≤";case"svi":return"mL/m¬≤";default:return""}}const Mw=({rows:r,onMetricUpdate:e})=>{const s=u.useMemo(()=>[...r].sort((a,i)=>a.dateIso&&i.dateIso?a.dateIso.localeCompare(i.dateIso):a.dateIso?-1:i.dateIso?1:a.label.localeCompare(i.label)),[r]),n=(a,i,o)=>{const A=o&&o.type==="numeric"?o.value.toString():o&&o.type==="text"?o.text:"",l=Rw(i),c=o?.sourceText?`Source: ${o.sourceText}`:void 0,d=o?.type==="numeric";return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",className:"w-full rounded-md border border-slate-300 px-2 py-1 text-xs text-slate-800",value:A,placeholder:l,title:c,onChange:m=>e(a.id,i,m.target.value)}),o?.sourceText&&t.jsx("span",{className:"inline-flex",title:o.sourceText,children:t.jsx(Vt,{className:"h-3.5 w-3.5 text-slate-400","aria-hidden":"true"})}),!A&&!d&&l&&t.jsx("span",{className:"text-[10px] text-slate-400",children:l})]})};return t.jsxs("div",{className:"overflow-x-auto rounded-xl border border-slate-200 bg-white shadow-sm",children:[t.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-xs",children:[t.jsx("thead",{className:"bg-slate-50 text-left uppercase tracking-wide text-slate-500",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 font-semibold",children:"Date"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"Site"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"LVEF / EF"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"RVSP / PASP"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"LVEDD"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"AV MPG"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"TAPSE"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"GLS"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"LAVI"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"DI"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"AVA"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"Valves"}),t.jsx("th",{className:"px-3 py-2 font-semibold",children:"Notes"})]})}),t.jsx("tbody",{className:"divide-y divide-slate-100",children:s.map(a=>t.jsxs("tr",{className:"hover:bg-slate-50/60",children:[t.jsx("td",{className:"px-3 py-2 font-medium text-slate-800",children:Dw(a)}),t.jsx("td",{className:"px-3 py-2 text-slate-600",children:a.site??"‚Äî"}),t.jsx("td",{className:"px-3 py-2",children:n(a,"lvef",a.lvef??a.lvefCategory)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"rvsp",a.rvsp??a.pasp??a.trGradient)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"lvedd",a.lvedd)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"avMpg",a.avMpg)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"tapse",a.tapse)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"gls",a.gls)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"lavi",a.lavi)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"di",a.di)}),t.jsx("td",{className:"px-3 py-2",children:n(a,"ava",a.ava)}),t.jsxs("td",{className:"px-3 py-2 text-slate-600",children:[["ar","mr","tr"].map(i=>a.valveGrades[i]).filter(i=>!!i).map(i=>t.jsxs("span",{className:"mr-2 inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-700",title:i.sourceText,children:[i.valve.toUpperCase()," ",i.severity]},i.id)),!a.valveGrades.ar&&!a.valveGrades.mr&&!a.valveGrades.tr&&t.jsx("span",{children:"‚Äî"})]}),t.jsx("td",{className:"px-3 py-2 text-slate-600",children:a.notes.length>0?t.jsx("div",{className:"flex flex-col gap-1",children:a.notes.map(i=>t.jsxs("span",{className:"rounded bg-slate-100 px-2 py-0.5 text-[10px] text-slate-700",title:i.sourceText,children:[i.label,": ",i.description]},i.id))}):"‚Äî"})]},a.id))})]}),s.length===0&&t.jsx("div",{className:"p-6 text-center text-sm text-slate-500",children:"Import TTE entries from the EMR to populate this table."})]})},Hw=({insights:r})=>{const e=u.useCallback(()=>{if(!r)return;const s=`${r.headline}
${r.narrative}`;navigator.clipboard.writeText(s).then(()=>{ce.getInstance().success("Copied","Insights copied to clipboard.")}).catch(()=>{ce.getInstance().error("Copy failed","Unable to access clipboard.")})},[r]);return r?t.jsxs("div",{className:"space-y-4 rounded-xl border border-slate-200 bg-white p-5 shadow-sm",children:[t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-slate-900",children:r.headline}),t.jsx("p",{className:"mt-1 text-sm text-slate-700",children:r.narrative})]}),t.jsxs("button",{type:"button",onClick:e,className:"inline-flex items-center gap-2 rounded-lg border border-slate-300 bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-slate-800",children:[t.jsx(_n,{className:"h-3.5 w-3.5"}),"Copy summary"]})]}),t.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Metric trajectory"}),t.jsx("div",{className:"space-y-2 text-sm text-slate-700",children:r.metrics.map(s=>t.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 px-3 py-2",children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:s.label}),t.jsxs("div",{className:"mt-1 text-sm text-slate-700",children:[s.current?t.jsxs(t.Fragment,{children:["Latest:"," ",t.jsx("span",{className:"font-semibold",children:(s.current.type==="numeric"?s.current.display??`${s.current.value}${s.current.unit?` ${s.current.unit}`:""}`:s.current.text)||"n/a"})]}):"No recent value",s.deltaFromPrevious&&t.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["vs prior ",s.deltaFromPrevious]}),s.deltaFromBaseline&&t.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["(",s.deltaFromBaseline,")"]}),s.trajectory&&s.trajectory!=="insufficient-data"&&t.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-0.5 text-[11px] text-slate-700",children:[t.jsx(Vs,{className:"h-3 w-3 text-emerald-500"}),s.trajectory]})]})]},s.field))})]}),t.jsxs("div",{className:"space-y-3",children:[r.thresholds.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Thresholds crossed"}),t.jsx("ul",{className:"mt-1 space-y-1 text-sm text-slate-700",children:r.thresholds.map(s=>t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(ot,{className:"h-3.5 w-3.5 text-amber-500"}),s]},s))})]}),r.rightHeartContext.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Right heart"}),t.jsx("ul",{className:"mt-1 space-y-1 text-sm text-slate-700",children:r.rightHeartContext.map(s=>t.jsx("li",{children:s},s))})]}),r.valveContext.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Valve trajectory"}),t.jsx("ul",{className:"mt-1 space-y-1 text-sm text-slate-700",children:r.valveContext.map(s=>t.jsx("li",{children:s},s))})]}),(r.dataQuality.missingMetrics.length>0||r.dataQuality.ambiguousFindings.length>0)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Data quality"}),t.jsxs("ul",{className:"mt-1 space-y-1 text-sm text-slate-700",children:[r.dataQuality.missingMetrics.map(s=>t.jsxs("li",{children:["Missing: ",s]},s)),r.dataQuality.ambiguousFindings.map(s=>t.jsxs("li",{children:["Ambiguity: ",s]},s))]})]})]})]})]}):t.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-sm text-slate-600 shadow-sm",children:"Clinical insights will appear once TTE data is parsed."})},Lw=hr.getInstance(),Ow=(r,e)=>({id:`manual-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,type:"numeric",value:r,unit:e,display:e?e==="%"?`${r}${e}`:`${r} ${e}`:r.toString(),sourceText:"Manual edit",rawText:"Manual edit",flags:["manual"]}),_w=r=>({id:`manual-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,type:"text",text:r,sourceText:"Manual edit",rawText:r,flags:["manual"]});function $w(r,e){if(e==="all")return r;const s=e==="6m"?6:e==="12m"?12:24,n=r.filter(o=>o.dateIso);if(n.length===0)return r;const a=new Date(n.at(-1).dateIso),i=new Date(a);return i.setMonth(i.getMonth()-s),r.filter(o=>o.dateIso?new Date(o.dateIso)>=i:!0)}const Kw=({isOpen:r,onClose:e})=>{const[s,n]=u.useState("idle"),[a,i]=u.useState([]),[o,A]=u.useState(""),[l,c]=u.useState([]),[d,m]=u.useState(null),[g,h]=u.useState("emr"),[p,b]=u.useState(!1),[N,y]=u.useState(!1),[j,Q]=u.useState(Us),[v,x]=u.useState(null),[f,S]=u.useState(null),[F,w]=u.useState(!1),[T,C]=u.useState([]),E=u.useRef(Ts.getInstance());u.useEffect(()=>{(async()=>{const D=await E.current.loadSettings().catch(()=>Us);Q(K=>({...K,...D,enabledSeries:{...K.enabledSeries,...D.enabledSeries},contextBands:{...K.contextBands,...D.contextBands}}))})()},[]),u.useEffect(()=>{if(a.length===0){x(null);return}x(Ew(a))},[a]),u.useEffect(()=>{E.current.saveSettings(j).catch(()=>{})},[j]);const U=u.useMemo(()=>$w(a,j.timeFilter),[a,j.timeFilter]),k=u.useCallback(D=>{if(D==="lvef"){Q(K=>({...K,showLVEFOnly:!K.showLVEFOnly}));return}Q(K=>{const ee={...K.enabledSeries,lvef:!0};return Object.keys(ee).forEach(pe=>{pe!=="lvef"&&(ee[pe]=!1)}),ee[D]=!K.enabledSeries[D],{...K,enabledSeries:ee,showLVEFOnly:!1}})},[]),P=u.useCallback(D=>{Q(K=>({...K,timeFilter:D}))},[]),M=u.useCallback(D=>{Q(K=>({...K,contextBands:{...K.contextBands,[D]:!K.contextBands[D]}}))},[]),$=u.useCallback(async D=>{try{await E.current.saveSession(D)}catch(K){console.warn("Failed to persist TTE trend session",K)}},[]);u.useEffect(()=>{if(s!=="ready"||a.length===0)return;const D={id:`tte-session-${d??Date.now()}`,timestamp:d??Date.now(),sourceType:g,rawText:o,rows:a,notes:a.flatMap(K=>K.notes),settings:j};$(D)},[a,j,o,g,s,d,$]);const W=u.useCallback(async(D,K)=>{n("capturing");try{const ee=performance.now(),pe=fw(D),ae=performance.now()-ee;if(Lw.recordMetrics("agent-processing",ae,{agentType:"tte-trend-import"}),pe.rows.length===0){n("error"),c(pe.warnings),ce.getInstance().warning("No TTE entries detected","Review the capture or paste text manually.");return}i(pe.rows),A(D),c(pe.warnings),m(Date.now()),h(K),C(pe.events.map(le=>`${le.label} ‚Ä¢ ${le.description}`)),n("ready");const me={id:`tte-session-${Date.now()}`,timestamp:Date.now(),sourceType:K,rawText:D,rows:pe.rows,notes:pe.notes,settings:j};$(me),ce.getInstance().success("TTE data captured",`Parsed ${pe.rows.length} echo${pe.rows.length===1?"":"es"} from Investigation summary.`)}catch(ee){console.error("Failed to parse TTE trends",ee),n("error"),ce.getInstance().error("Parsing failed",ee instanceof Error?ee.message:"Unknown error")}},[$,j]),V=u.useCallback(async()=>{n("capturing");try{const D=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"investigation-summary",data:{extractOnly:!0}});if(!D?.success)throw new Error(D?.error||"Capture failed");if(!D.data||D.data.trim().length===0){y(!0),n("error"),ce.getInstance().warning("No Investigation Summary content","Click ‚ÄúPaste text‚Äù to provide the investigation entries manually.");return}await W(D.data,"emr")}catch(D){console.error("EMR capture failed",D),n("error"),y(!0),ce.getInstance().error("Capture failed",D instanceof Error?D.message:"Unknown error")}},[W]),L=u.useCallback(async D=>{D.preventDefault();const ee=new FormData(D.currentTarget).get("ttePaste")??"";if(!ee.trim()){ce.getInstance().warning("Paste text missing","Provide Investigation summary text to parse.");return}await W(ee,"paste"),y(!1)},[W]),O=u.useCallback(async()=>{w(!0);try{const D=await E.current.loadLatestSession();if(!D){ce.getInstance().info("No stored session","Import from EMR to create a session.");return}D.settings&&Q(K=>({...K,...D.settings,enabledSeries:{...K.enabledSeries,...D.settings.enabledSeries},contextBands:{...K.contextBands,...D.settings.contextBands}})),i(D.rows),A(D.rawText),m(D.timestamp),h(D.sourceType),c([]),n("ready"),ce.getInstance().success("Loaded previous capture","Restored the most recent TTE trend session.")}finally{w(!1)}},[]),z=u.useCallback((D,K,ee)=>{i(pe=>pe.map(ae=>{if(ae.id!==D)return ae;const me=ee.trim(),le={...ae},re=Z=>{switch(K){case"rvsp":Z.rvsp=void 0;break;case"lvef":Z.lvef=void 0,Z.lvefCategory=void 0;break;case"lvedd":Z.lvedd=void 0;break;case"avMpg":Z.avMpg=void 0;break;case"tapse":Z.tapse=void 0;break;case"gls":Z.gls=void 0;break;case"lavi":Z.lavi=void 0;break;case"di":Z.di=void 0;break;case"ava":Z.ava=void 0;break;case"svi":Z.svi=void 0;break}};if(!me)return re(le),le;const te=Number(me.replace(/[^\d.-]/g,"")),ge=Number.isFinite(te)?Ow(te,K==="lvef"?"%":K==="rvsp"?"mmHg":K==="lvedd"?"mm":K==="avMpg"?"mmHg":K==="tapse"?"mm":K==="gls"?"%":K==="lavi"?"mL/m¬≤":K==="di"?void 0:K==="ava"?"cm¬≤":K==="svi"?"mL/m¬≤":void 0):_w(me);if(K==="rvsp")le.rvsp=ge;else if(K==="lvef")ge.type==="numeric"?(le.lvef=ge,le.lvefCategory=void 0):(le.lvef=void 0,le.lvefCategory=ge);else switch(K){case"lvedd":le.lvedd=ge;break;case"avMpg":le.avMpg=ge;break;case"tapse":le.tapse=ge;break;case"gls":le.gls=ge;break;case"lavi":le.lavi=ge;break;case"di":le.di=ge;break;case"ava":le.ava=ge;break;case"svi":le.svi=ge;break}return le}))},[]),H=u.useCallback(D=>{Q(K=>({...K,showLVEFOnly:D,enabledSeries:{...K.enabledSeries,rvsp:!1,lvedd:!1,avMpg:!1}}))},[]),X=u.useCallback((D,K)=>{S({rowId:D,field:K})},[]),Ae=u.useMemo(()=>{if(!f)return null;const D=a.find(ee=>ee.id===f.rowId);if(!D)return null;let K;return f.field==="rvsp"?K=D.rvsp??D.pasp??D.trGradient:f.field==="lvef"?K=D.lvef??D.lvefCategory:f.field==="lvedd"?K=D.lvedd:f.field==="avMpg"?K=D.avMpg:f.field==="lavi"&&(K=D.lavi),{row:D,value:K}},[a,f]);return r?t.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 p-2",children:t.jsxs("div",{className:"flex h-[90vh] w-full flex-col overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-xl",children:[t.jsxs("header",{className:"flex items-start justify-between border-b border-slate-200 px-3 py-2.5",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Echo (TTE) Trends"}),t.jsx("p",{className:"mt-0.5 text-[11px] text-slate-600",children:"Import & visualize TTE metrics"})]}),t.jsx("button",{type:"button",onClick:e,className:"rounded-full border border-transparent p-1 text-slate-400 transition hover:border-slate-200 hover:text-slate-600","aria-label":"Close",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("main",{className:"flex-1 overflow-y-auto bg-surface-secondary p-2",children:[t.jsxs("section",{className:"rounded-xl border border-slate-200 bg-white p-2.5 shadow-sm",children:[t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[t.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-lg bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-slate-800",onClick:V,disabled:s==="capturing",children:[s==="capturing"?t.jsx(er,{className:"h-3.5 w-3.5 animate-spin"}):t.jsx(li,{className:"h-3.5 w-3.5"}),"Import"]}),t.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-lg border border-slate-300 px-3 py-1.5 text-xs text-slate-700 hover:border-slate-400",onClick:O,disabled:F,children:[F?t.jsx(er,{className:"h-3.5 w-3.5 animate-spin"}):t.jsx(Jt,{className:"h-3.5 w-3.5"}),"Load last"]})]}),s==="capturing"&&t.jsxs("div",{className:"inline-flex items-center gap-2 text-xs text-slate-500",children:[t.jsx("span",{className:"h-2 w-2 animate-ping rounded-full bg-slate-900"}),"Capturing Investigation summary‚Ä¶"]})]}),(d||N||o)&&t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 px-2 py-1.5 text-[10px] text-slate-600",children:[t.jsxs("span",{className:"font-semibold text-slate-700",children:["Source: Inv. summary ¬∑"," ",d?new Date(d).toLocaleDateString():g==="paste"?"manual":"unknown"]}),t.jsx("button",{type:"button",className:"text-slate-700 underline underline-offset-2",onClick:V,children:"Refetch"}),t.jsx("button",{type:"button",className:"text-slate-700 underline underline-offset-2",onClick:()=>b(D=>!D),children:p?"Hide raw":"Edit raw"}),t.jsx("button",{type:"button",className:"text-slate-700 underline underline-offset-2",onClick:()=>y(!0),children:"Change source ‚Üí Paste text"})]}),N&&t.jsxs("form",{className:"mt-4 space-y-2",onSubmit:L,children:[t.jsx("label",{htmlFor:"ttePaste",className:"text-xs uppercase tracking-wide text-slate-500",children:"Paste Investigation summary text"}),t.jsx("textarea",{id:"ttePaste",name:"ttePaste",className:"min-h-[140px] w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-800 focus:border-slate-400 focus:outline-none focus:ring-1 focus:ring-slate-400",defaultValue:o,placeholder:"TTE (15 Jan 2023): LVEDD 66, EF 45%..."}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>y(!1),className:"rounded-lg px-3 py-1.5 text-xs text-slate-600 hover:text-slate-800",children:"Cancel"}),t.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-lg bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800",children:[t.jsx(_n,{className:"h-3.5 w-3.5"}),"Parse pasted text"]})]})]}),p&&!N&&t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("label",{htmlFor:"rawSourceEditor",className:"text-xs uppercase tracking-wide text-slate-500",children:"Raw Investigation summary"}),t.jsx("textarea",{id:"rawSourceEditor",className:"min-h-[160px] w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-800 focus:border-slate-400 focus:outline-none focus:ring-1 focus:ring-slate-400",value:o,onChange:D=>A(D.target.value)}),t.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-lg border border-slate-300 px-3 py-1.5 text-xs text-slate-700 hover:border-slate-400",onClick:()=>W(o,g),children:[t.jsx(zs,{className:"h-3.5 w-3.5"}),"Re-parse raw text"]})]}),l.length>0&&t.jsxs("div",{className:"mt-4 space-y-1 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700",children:[t.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[t.jsx(ot,{className:"h-3.5 w-3.5"}),"Parsing warnings"]}),l.map(D=>t.jsxs("div",{children:["‚Ä¢ ",D]},D))]})]}),t.jsxs("section",{className:"mt-2 space-y-2",children:[t.jsx(Pw,{settings:j,onToggleSeries:k,onTimeFilterChange:P,onShowLVEFOnlyChange:H,onToggleContext:M}),t.jsx(kw,{rows:U,settings:j,onPointClick:X}),Ae&&Ae.value&&t.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-sm text-slate-700",children:t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Source snippet"}),t.jsxs("div",{className:"mt-1 font-semibold text-slate-900",children:[Ae.row.site?`${Ae.row.site} ¬∑ `:"",Ae.row.dateIso?new Date(Ae.row.dateIso).toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"}):Ae.row.label]}),t.jsx("p",{className:"mt-1 text-sm text-slate-700",children:Ae.value.sourceText})]}),t.jsx("button",{type:"button",className:"text-xs text-slate-500 hover:text-slate-700",onClick:()=>S(null),children:"Clear"})]})}),T.length>0&&t.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-sm text-slate-700",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Timeline events"}),t.jsx("ul",{className:"mt-2 space-y-1 text-sm text-slate-700",children:T.map(D=>t.jsxs("li",{children:["‚Ä¢ ",D]},D))})]}),t.jsx(Mw,{rows:U,onMetricUpdate:z}),t.jsx(Hw,{insights:v})]})]})]})}):null},Hu=u.memo(({isOpen:r,onClose:e,sessions:s,persistedSessionIds:n,storageStats:a,onDeleteSession:i,onDeleteAllChecked:o,onDeleteOldSessions:A})=>{const[l,c]=u.useState(!1),d=u.useMemo(()=>s.filter(x=>n.has(x.id)),[s,n]),m=u.useMemo(()=>[...d].sort((x,f)=>f.timestamp-x.timestamp),[d]),g=x=>x<1024?`${x} B`:x<1024*1024?`${(x/1024).toFixed(1)} KB`:`${(x/(1024*1024)).toFixed(2)} MB`,h=x=>{const f=Date.now()-x,S=Math.floor(f/(24*60*60*1e3)),F=Math.floor(f/(60*60*1e3));return S>0?`${S}d ago`:F>0?`${F}h ago`:`${Math.floor(f/6e4)}m ago`},p=x=>{const f=JSON.stringify({transcription:x.transcription,results:x.results,summary:x.summary,metadata:x});return new Blob([f]).size},b=async x=>{c(!0);try{await i(x)}finally{c(!1)}},N=async()=>{if(confirm("Delete all checked sessions? This cannot be undone.")){c(!0);try{await o()}finally{c(!1)}}},y=async x=>{if(confirm(`Delete all sessions older than ${x} days? This cannot be undone.`)){c(!0);try{await A(x)}finally{c(!1)}}};if(!r)return null;const j=a?a.usedPercentage:0,Q=j>=80,v=j>=90;return t.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Rn,{className:"w-5 h-5 text-blue-600"}),t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Storage Management"})]}),t.jsx("button",{onClick:e,className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors","aria-label":"Close",children:t.jsx(nt,{className:"w-5 h-5"})})]}),a&&t.jsxs("div",{className:"p-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Storage Usage"}),t.jsxs("span",{className:`text-sm font-bold ${v?"text-red-600":Q?"text-amber-600":"text-emerald-600"}`,children:[g(a.usedBytes)," / ",g(a.totalBytes)]})]}),t.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden mb-2",children:t.jsx("div",{className:`h-full transition-all duration-300 ${v?"bg-red-500":Q?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Math.min(100,j)}%`}})}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[t.jsxs("span",{children:[a.sessionCount," sessions stored"]}),t.jsxs("span",{children:[j.toFixed(1),"% used"]})]}),Q&&t.jsxs("div",{className:`mt-3 flex items-start gap-2 p-2 rounded-lg ${v?"bg-red-50 border border-red-200":"bg-amber-50 border border-amber-200"}`,children:[t.jsx(Zt,{className:`w-4 h-4 flex-shrink-0 mt-0.5 ${v?"text-red-600":"text-amber-600"}`}),t.jsx("p",{className:`text-xs ${v?"text-red-700":"text-amber-700"}`,children:v?"Storage critically full! Delete old sessions to free space.":"Storage filling up. Consider deleting old sessions."})]})]}),t.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[t.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Bulk Actions"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:N,disabled:l,className:"px-3 py-1.5 text-xs font-medium text-red-700 bg-red-100 hover:bg-red-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete All Checked"}),t.jsx("button",{onClick:()=>y(7),disabled:l,className:"px-3 py-1.5 text-xs font-medium text-amber-700 bg-amber-100 hover:bg-amber-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete >7 Days Old"}),t.jsx("button",{onClick:()=>y(3),disabled:l,className:"px-3 py-1.5 text-xs font-medium text-amber-700 bg-amber-100 hover:bg-amber-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete >3 Days Old"})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:m.length===0?t.jsxs("div",{className:"text-center py-12 text-gray-500",children:[t.jsx(Rn,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),t.jsx("p",{className:"text-sm",children:"No sessions stored locally"})]}):t.jsx("div",{className:"space-y-2",children:m.map(x=>{const f=bu(x.agentType),S=yu(x.agentType),F=p(x),w=h(x.timestamp);return t.jsx("div",{className:`p-3 rounded-lg border-l-4 ${f.bg} ${f.border} hover:shadow-md transition-all`,style:{borderLeftColor:`var(--${f.indicator.replace("bg-","")})`},children:t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"text-sm",children:S}),t.jsx("p",{className:"font-medium text-sm text-gray-900 truncate",children:x.patient?.name||"Unnamed patient"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[t.jsx("span",{className:`px-1.5 py-0.5 rounded ${f.badgeBg} ${f.badgeText} font-medium`,children:x.agentName||x.agentType}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Kt,{className:"w-3 h-3"}),w]}),t.jsx("span",{className:"font-mono",children:g(F)})]})]}),t.jsx("button",{onClick:()=>b(x.id),disabled:l,className:"flex-shrink-0 p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete session",children:t.jsx(Er,{className:"w-4 h-4"})})]})},x.id)})})}),t.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:t.jsx("button",{onClick:e,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Close"})})]})})});Hu.displayName="StorageManagementModal";const wc={"medgemma-27b-text-it-mlx":{displayName:"MedGemma 27B (Best Quality)",memoryGB:10,speed:"slow",quality:"excellent",useCases:["Complex procedural reports (TAVI, PCI, RHC)","Comprehensive AI medical review","Detailed consultation notes"],family:"medgemma"},"medgemma-4b-it-mlx":{displayName:"MedGemma 4B (Fast & Medical)",memoryGB:3,speed:"fast",quality:"very-good",useCases:["Quick medical letters","Investigation summaries","Medication lists","Medical backgrounds"],family:"medgemma"},"qwen/qwen3-4b-2507":{displayName:"Qwen 4B (Fastest)",memoryGB:3,speed:"very-fast",quality:"good",useCases:["Simple formatting tasks","Blood test ordering","Quick clinical notes","Investigation formatting"],family:"qwen"},"qwen/qwen3-vl-8b":{displayName:"Qwen Vision 8B (Multimodal)",memoryGB:5,speed:"moderate",quality:"very-good",useCases:["BP diary image extraction","ECG interpretation","Radiology image analysis"],family:"qwen",supportsVision:!0},"google/gemma-3n-e4b":{displayName:"Gemma 3N (Vision-capable)",memoryGB:3,speed:"fast",quality:"good",useCases:["BP diary extraction (vision)","Document OCR","Image-based data extraction"],family:"gemma",supportsVision:!0}};function _a(r){if(wc[r])return wc[r];const e=r.toLowerCase();let s=4;const n=e.match(/(\d+)b/);if(n){const o=parseInt(n[1]);s=Math.max(2,Math.ceil(o*.4))}let a="other";e.includes("medgemma")?a="medgemma":e.includes("qwen")?a="qwen":e.includes("gemma")&&(a="gemma");const i=e.includes("vision")||e.includes("-vl-")||e.includes("multimodal");return{displayName:r,memoryGB:s,speed:"moderate",quality:"good",useCases:["General text generation"],family:a,supportsVision:i}}function Vw(r,e){const n=["medgemma-4b-it-mlx","qwen/qwen3-4b-2507","google/gemma-3n-e4b"];for(const a of n)if(e.includes(a))return a;return e.find(a=>!_a(a).supportsVision)||null}function io(r){return r<1?`${Math.round(r*1024)} MB`:`${r.toFixed(1)} GB`}const Gw=({error:r,onRetry:e,onSwitchModel:s,onClose:n})=>{const[a,i]=u.useState(null),[o,A]=u.useState(!1),[l,c]=u.useState(!1),d=_a(r.requestedModel),m=u.useMemo(()=>r.availableModels.filter(b=>b!==r.requestedModel),[r.availableModels,r.requestedModel]),g=u.useMemo(()=>Vw("",m),[m]);Fe.useEffect(()=>{g&&!a&&i(g)},[g,a]);const h=async()=>{A(!0);try{await e()}finally{A(!1)}},p=async()=>{if(a){c(!0);try{await s(a),n()}finally{c(!1)}}};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:t.jsxs("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white rounded-xl shadow-2xl m-4",children:[t.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-rose-50 to-orange-50 border-b-2 border-rose-200 px-6 py-4",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-rose-100 rounded-lg",children:t.jsx(ot,{className:"w-6 h-6 text-rose-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Model Loading Failed"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Insufficient System Memory"})]})]}),t.jsx("button",{onClick:n,className:"p-1 hover:bg-rose-100 rounded-lg transition-colors","aria-label":"Close dialog",children:t.jsx(nt,{className:"w-5 h-5 text-gray-500"})})]})}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(Fm,{className:"w-5 h-5 text-gray-600"}),"What Happened?"]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Requested Model:"})," ",t.jsx("code",{className:"px-2 py-0.5 bg-white rounded border border-gray-300 text-xs font-mono",children:r.requestedModel})]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Memory Required:"})," ",t.jsxs("span",{className:"font-semibold text-rose-600",children:["~",io(d.memoryGB)]})]}),t.jsxs("p",{className:"bg-rose-50 border border-rose-200 rounded p-3 mt-3",children:[t.jsx("strong",{className:"text-rose-800",children:"LM Studio blocked model loading"})," to prevent system freeze. Your system doesn't have enough free memory to load this model safely."]})]})]}),t.jsxs("div",{className:"border-2 border-blue-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 px-4 py-3 border-b border-blue-200",children:t.jsxs("h3",{className:"font-bold text-blue-900 flex items-center gap-2",children:[t.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-blue-500 text-white rounded-full text-sm font-bold",children:"1"}),"Option 1: Free Up Memory & Retry"]})}),t.jsxs("div",{className:"p-4 space-y-3",children:[t.jsxs("p",{className:"text-sm text-gray-700",children:["Close memory-intensive applications to free up ~",io(d.memoryGB),":"]}),t.jsxs("ul",{className:"text-sm text-gray-700 space-y-1 ml-4",children:[t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-blue-600 mt-0.5",children:"‚Ä¢"}),t.jsxs("span",{children:["Close ",t.jsx("strong",{children:"Google Chrome"})," (may free 500+ MB)"]})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-blue-600 mt-0.5",children:"‚Ä¢"}),t.jsxs("span",{children:["Close ",t.jsx("strong",{children:"Mail"})," and ",t.jsx("strong",{children:"Messages"})," apps"]})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-blue-600 mt-0.5",children:"‚Ä¢"}),t.jsxs("span",{children:["Close unused ",t.jsx("strong",{children:"VSCode windows"})]})]})]}),t.jsx("button",{onClick:h,disabled:o,className:"w-full mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2",children:o?t.jsxs(t.Fragment,{children:[t.jsx(Jt,{className:"w-4 h-4 animate-spin"}),"Retrying..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Jt,{className:"w-4 h-4"}),"Retry with ",r.requestedModel]})})]})]}),t.jsxs("div",{className:"border-2 border-emerald-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-emerald-50 to-teal-50 px-4 py-3 border-b border-emerald-200",children:t.jsxs("h3",{className:"font-bold text-emerald-900 flex items-center gap-2",children:[t.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-emerald-500 text-white rounded-full text-sm font-bold",children:"2"}),"Option 2: Use a Different Model"]})}),t.jsxs("div",{className:"p-4 space-y-3",children:[t.jsx("p",{className:"text-sm text-gray-700",children:"Select a lighter model that fits in available memory:"}),m.length===0?t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 text-sm text-amber-800",children:[t.jsx("strong",{children:"No alternative models available."})," Please free up memory to continue."]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-2",children:m.map(b=>{const N=_a(b),y=b===g,j=b===a;return t.jsx("button",{onClick:()=>i(b),className:`w-full text-left px-4 py-3 rounded-lg border-2 transition-all ${j?"border-emerald-500 bg-emerald-50":"border-gray-200 bg-white hover:border-emerald-300 hover:bg-emerald-50/50"}`,children:t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"font-semibold text-gray-900 truncate",children:N.displayName}),y&&t.jsx("span",{className:"flex-shrink-0 px-2 py-0.5 bg-emerald-100 text-emerald-700 text-xs font-semibold rounded-full",children:"RECOMMENDED"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[t.jsxs("span",{children:["Memory: ",t.jsx("strong",{className:"text-emerald-600",children:io(N.memoryGB)})]}),t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{children:["Speed: ",t.jsx("strong",{children:N.speed})]}),t.jsx("span",{children:"‚Ä¢"}),t.jsxs("span",{children:["Quality: ",t.jsx("strong",{children:N.quality})]})]}),t.jsx("div",{className:"mt-1 text-xs text-gray-500",children:N.useCases[0]})]}),j&&t.jsx(Vs,{className:"w-5 h-5 text-emerald-600 flex-shrink-0"})]})},b)})}),t.jsx("button",{onClick:p,disabled:!a||l,className:"w-full mt-4 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2",children:l?t.jsxs(t.Fragment,{children:[t.jsx(Jt,{className:"w-4 h-4 animate-spin"}),"Switching Models..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Vs,{className:"w-4 h-4"}),"Switch to ",a&&_a(a).displayName]})})]})]})]}),t.jsxs("details",{className:"text-xs text-gray-500",children:[t.jsx("summary",{className:"cursor-pointer hover:text-gray-700 font-medium",children:"Technical Details"}),t.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded border border-gray-200 font-mono text-xs whitespace-pre-wrap break-all",children:r.rawErrorMessage})]})]})]})})};Im({MeshLineGeometry:_m,MeshLineMaterial:Om});function Ww({position:r=[0,0,20],gravity:e=[0,-40,0],fov:s=20,transparent:n=!0,cardText:a="Ready to Record"}){const[i,o]=u.useState(null);return u.useEffect(()=>{console.log("üé® Lanyard component mounted")},[]),i?(console.error("üé® Lanyard error:",i),t.jsx(Bc,{text:a})):t.jsx("div",{className:"lanyard-wrapper",children:t.jsx(u.Suspense,{fallback:t.jsx(Bc,{text:a}),children:t.jsxs(Um,{camera:{position:r,fov:s},gl:{alpha:n},onCreated:({gl:A})=>{console.log("üé® Canvas created successfully"),A.setClearColor(new Pm(0),n?0:1)},onError:A=>{console.error("üé® Canvas error:",A),o(A instanceof Error?A:new Error(String(A)))},children:[t.jsx("ambientLight",{intensity:Math.PI}),t.jsx(Tm,{gravity:e,timeStep:1/60,children:t.jsx(zw,{cardText:a})}),t.jsxs(km,{blur:.75,children:[t.jsx(Jn,{intensity:2,color:"white",position:[0,-1,5],rotation:[0,0,Math.PI/3],scale:[100,.1,1]}),t.jsx(Jn,{intensity:3,color:"white",position:[-1,-1,1],rotation:[0,0,Math.PI/3],scale:[100,.1,1]}),t.jsx(Jn,{intensity:3,color:"white",position:[1,1,1],rotation:[0,0,Math.PI/3],scale:[100,.1,1]}),t.jsx(Jn,{intensity:10,color:"white",position:[-10,0,14],rotation:[0,Math.PI/2,Math.PI/3],scale:[100,10,1]})]})]})})})}function Bc({text:r}){return t.jsx("div",{className:"lanyard-loading",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-blue-50 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),t.jsx("p",{className:"text-sm text-gray-600",children:r})]})})}function zw({maxSpeed:r=50,minSpeed:e=0,cardText:s="Ready to Record"}){const n=u.useRef(null),a=u.useRef(null),i=u.useRef(null),o=u.useRef(null),A=u.useRef(null),l=u.useRef(null),c=new Ar,d=new Ar,m=new Ar,g=new Ar,h={type:"dynamic",canSleep:!0,colliders:!1,angularDamping:4,linearDamping:4},p=Hc("/assets/lanyard/card.glb",!0),b=p?.nodes||{},N=p?.materials||{},y=Lc("/assets/lanyard/lanyard.png");y&&(y.wrapS=y.wrapT=Dm);const j=u.useState(()=>{const w=new Rm([new Ar,new Ar,new Ar,new Ar]);return w.curveType="chordal",w})[0],[Q,v]=u.useState(!1),[x,f]=u.useState(!1),[S,F]=u.useState(()=>typeof window<"u"?window.innerWidth<1024:!1);return u.useEffect(()=>{const w=()=>{F(window.innerWidth<1024)};return window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]),Si(a,i,[[0,0,0],[0,0,0],1]),Si(i,o,[[0,0,0],[0,0,0],1]),Si(o,A,[[0,0,0],[0,0,0],1]),Mm(A,l,[[0,0,0],[0,1.45,0]]),u.useEffect(()=>{if(x)return document.body.style.cursor=Q?"grabbing":"grab",()=>{document.body.style.cursor="auto"}},[x,Q]),Hm((w,T)=>{Q&&typeof Q!="boolean"&&(c.set(w.pointer.x,w.pointer.y,.5).unproject(w.camera),g.copy(c).sub(w.camera.position).normalize(),c.add(g.multiplyScalar(w.camera.position.length())),[l,i,o,A,a].forEach(C=>C.current?.wakeUp()),l.current?.setNextKinematicTranslation({x:c.x-Q.x,y:c.y-Q.y,z:c.z-Q.z})),a.current&&([i,o].forEach(C=>{C.current.lerped||(C.current.lerped=new Ar().copy(C.current.translation()));const E=Math.max(.1,Math.min(1,C.current.lerped.distanceTo(C.current.translation())));C.current.lerped.lerp(C.current.translation(),T*(e+E*(r-e)))}),j.points[0].copy(A.current.translation()),j.points[1].copy(o.current.lerped),j.points[2].copy(i.current.lerped),j.points[3].copy(a.current.translation()),n.current&&n.current.geometry.setPoints(j.getPoints(32)),d.copy(l.current.angvel()),m.copy(l.current.rotation()),l.current.setAngvel({x:d.x,y:d.y-m.y*.25,z:d.z}))}),t.jsxs(t.Fragment,{children:[t.jsxs("group",{position:[0,10,0],children:[t.jsx(rn,{ref:a,...h,type:"fixed"}),t.jsx(rn,{position:[.5,0,0],ref:i,...h,type:"dynamic",children:t.jsx(Ei,{args:[.1]})}),t.jsx(rn,{position:[1,0,0],ref:o,...h,type:"dynamic",children:t.jsx(Ei,{args:[.1]})}),t.jsx(rn,{position:[1.5,0,0],ref:A,...h,type:"dynamic",children:t.jsx(Ei,{args:[.1]})}),t.jsxs(rn,{position:[2,0,0],ref:l,...h,type:Q?"kinematicPosition":"dynamic",children:[t.jsx(Lm,{args:[.8,1.125,.01]}),t.jsxs("group",{scale:2.25,position:[0,-1.2,-.05],onPointerOver:()=>f(!0),onPointerOut:()=>f(!1),onPointerUp:w=>{w.target.releasePointerCapture(w.pointerId),v(!1)},onPointerDown:w=>{w.target.setPointerCapture(w.pointerId),v(new Ar().copy(w.point).sub(c.copy(l.current.translation())))},children:[b.card&&b.card.geometry?t.jsx("mesh",{geometry:b.card.geometry,children:t.jsx("meshPhysicalMaterial",{map:N.base?.map,"map-anisotropy":16,clearcoat:1,clearcoatRoughness:.15,roughness:.9,metalness:.8})}):t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[1.6,2.25,.02]}),t.jsx("meshPhysicalMaterial",{color:"#f8f9fa",clearcoat:1,clearcoatRoughness:.15,roughness:.3,metalness:.1})]}),b.clip&&b.clip.geometry&&N.metal?t.jsxs(t.Fragment,{children:[t.jsx("mesh",{geometry:b.clip.geometry,material:N.metal,"material-roughness":.3}),t.jsx("mesh",{geometry:b.clamp?.geometry,material:N.metal})]}):t.jsxs("mesh",{position:[0,1.125,0],children:[t.jsx("cylinderGeometry",{args:[.1,.1,.1,16]}),t.jsx("meshStandardMaterial",{color:"#888888",metalness:.8,roughness:.2})]})]})]})]}),t.jsxs("mesh",{ref:n,children:[t.jsx("meshLineGeometry",{}),t.jsx("meshLineMaterial",{color:y?"white":"#3b82f6",depthTest:!1,resolution:S?[1e3,2e3]:[1e3,1e3],useMap:y?1:0,map:y,repeat:[-3,1],lineWidth:1})]})]})}Hc.preload("/assets/lanyard/card.glb");Lc.preload("/assets/lanyard/lanyard.png");const Lu={isRecording:!1,isProcessing:!1,currentAgent:null,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,missingInfo:null,missingInfoAnswers:{},processingStatus:"idle",voiceActivityLevel:0,frequencyData:[],modelStatus:{isConnected:!1,classifierModel:"",processorModel:"",lastPing:0,latency:0},recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,currentAgentName:null,processingStartTime:null,failedAudioRecordings:[],reviewData:null,taviStructuredSections:void 0,educationData:void 0,preOpPlanData:void 0,rhcReport:void 0,patientVersion:null,isGeneratingPatientVersion:!1,streamBuffer:"",ttftMs:null,streaming:!1,processingPhase:void 0,processingStepProgress:{},processingGlobalProgress:0,pipelineProgress:null,transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},patientMismatchData:{comparison:null,textToInsert:null,onConfirm:null,onCancel:null},patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayTaviStructuredSections:void 0,displayEducationData:void 0,displayPreOpPlanData:void 0,displayReviewData:void 0,displayRhcReport:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null,displayProcessingTime:void 0,displayModelUsed:null,displayPipelineProgress:null},resultRevisions:{},persistedSessionIds:new Set,storageMetadata:null,ui:{mode:"idle",modeContext:{sessionId:null,origin:"auto"},overlay:"none",sidePanel:"none",activeWorkflow:null,isCancelling:!1,showAlerts:!0,isExtractingPatients:!1,isBatchProcessing:!1,processingProgress:0,processingStartTime:0,warnings:[],errors:[],resultSummary:"",calendarData:null,extractError:null,batchProcessingProgress:null}};function Xw(r,e){switch(e.type){case"SET_RECORDING":return r.isRecording===e.payload?r:{...r,isRecording:e.payload};case"SET_PROCESSING":return r.isProcessing===e.payload?r:{...r,isProcessing:e.payload};case"SET_CURRENT_AGENT":return r.currentAgent===e.payload?r:{...r,currentAgent:e.payload};case"SET_TRANSCRIPTION":return r.transcription===e.payload?r:{...r,transcription:e.payload};case"SET_RESULTS":return r.results===e.payload?r:{...r,results:e.payload};case"SET_RESULTS_SUMMARY":return r.resultsSummary===e.payload?r:{...r,resultsSummary:e.payload};case"SET_AI_GENERATED_SUMMARY":return r.aiGeneratedSummary===e.payload?r:{...r,aiGeneratedSummary:e.payload};case"SET_MISSING_INFO":return{...r,missingInfo:e.payload};case"SET_MISSING_INFO_ANSWERS":return{...r,missingInfoAnswers:e.payload};case"CLEAR_MISSING_INFO":return{...r,missingInfo:null,missingInfoAnswers:{}};case"SET_PROCESSING_PHASE":return{...r,processingPhase:e.payload.phase,processingStepProgress:e.payload.stepProgress,processingGlobalProgress:e.payload.globalProgress};case"SET_PROCESSING_STATUS":return r.processingStatus===e.payload?r:{...r,processingStatus:e.payload};case"SET_VOICE_ACTIVITY":return Date.now()-(r.modelStatus.lastPing||0)<200?r:{...r,voiceActivityLevel:e.payload.level,frequencyData:e.payload.frequencyData,modelStatus:{...r.modelStatus,lastPing:Date.now()}};case"SET_MODEL_STATUS":return{...r,modelStatus:e.payload};case"SET_TIMING_DATA":return{...r,...e.payload};case"SET_CURRENT_AGENT_NAME":return r.currentAgentName===e.payload?r:{...r,currentAgentName:e.payload};case"SET_FAILED_RECORDINGS":return{...r,failedAudioRecordings:e.payload};case"SET_REVIEW_DATA":return{...r,reviewData:e.payload};case"SET_TAVI_STRUCTURED_SECTIONS":return r.taviStructuredSections===e.payload?r:{...r,taviStructuredSections:e.payload};case"SET_EDUCATION_DATA":return r.educationData===e.payload?r:{...r,educationData:e.payload};case"SET_PREOP_PLAN_DATA":return r.preOpPlanData===e.payload?r:{...r,preOpPlanData:e.payload};case"SET_RHC_REPORT":return r.rhcReport===e.payload?r:{...r,rhcReport:e.payload};case"SET_ACTIVE_WORKFLOW":return r.ui.activeWorkflow===e.payload?r:{...r,ui:{...r.ui,activeWorkflow:e.payload}};case"SET_CANCELLING":return r.ui.isCancelling===e.payload?r:{...r,ui:{...r.ui,isCancelling:e.payload}};case"SET_WARNINGS":return{...r,ui:{...r.ui,warnings:e.payload}};case"SET_ERRORS":return{...r,ui:{...r.ui,errors:e.payload}};case"SET_ALERTS_VISIBLE":return r.ui.showAlerts===e.payload?r:{...r,ui:{...r.ui,showAlerts:e.payload}};case"SET_RESULT_SUMMARY":return r.ui.resultSummary===e.payload?r:{...r,ui:{...r.ui,resultSummary:e.payload}};case"SET_UI_MODE":{if(r.ui.mode===e.payload.mode&&(e.payload.context?.sessionId===void 0||r.ui.modeContext.sessionId===e.payload.context?.sessionId))return r;const s={sessionId:e.payload.context?.sessionId??null,origin:e.payload.context?.origin??"auto"};let n=r.ui.overlay,a=r.ui.sidePanel;return e.payload.mode!=="processing"&&n==="processing-phase"&&(n="none"),e.payload.mode!=="processing"&&n==="field-ingestion"&&(n="none"),e.payload.mode==="processing"&&n==="none"&&(n="processing-phase"),e.payload.mode==="recording"&&(a=a==="metrics-dashboard"?"none":a),e.payload.mode!=="configuring"&&a==="metrics-dashboard"&&(a="none"),e.payload.mode!=="recording"&&a==="recording-prompts"&&(a="none"),{...r,ui:{...r.ui,mode:e.payload.mode,modeContext:s,overlay:n,sidePanel:a}}}case"SET_UI_OVERLAY":return r.ui.overlay===e.payload?r:{...r,ui:{...r.ui,overlay:e.payload}};case"CLEAR_UI_OVERLAY":return e.payload&&r.ui.overlay!==e.payload||r.ui.overlay==="none"?r:{...r,ui:{...r.ui,overlay:"none"}};case"SET_UI_SIDE_PANEL":return r.ui.sidePanel===e.payload?r:{...r,ui:{...r.ui,sidePanel:e.payload}};case"SET_PATIENT_MISMATCH_DATA":return{...r,patientMismatchData:e.payload};case"SET_CALENDAR_DATA":return{...r,ui:{...r.ui,calendarData:e.payload}};case"SET_EXTRACTING_PATIENTS":return r.ui.isExtractingPatients===e.payload?r:{...r,ui:{...r.ui,isExtractingPatients:e.payload}};case"SET_EXTRACT_ERROR":return r.ui.extractError===e.payload?r:{...r,ui:{...r.ui,extractError:e.payload}};case"SET_BATCH_PROCESSING":return r.ui.isBatchProcessing===e.payload?r:{...r,ui:{...r.ui,isBatchProcessing:e.payload}};case"SET_BATCH_PROGRESS":return{...r,ui:{...r.ui,batchProcessingProgress:e.payload}};case"SET_PROCESSING_START_TIME":return{...r,processingStartTime:e.payload};case"RESET_STATE":return Lu;case"CLEAR_RECORDING":return console.log("üîÑ CLEAR_RECORDING: Clearing state for new recording",{hadResults:!!r.results,hadReviewData:!!r.reviewData,currentAgent:r.currentAgent,processingStatus:r.processingStatus,wasDisplayingSession:r.displaySession.isDisplayingSession,wasStreaming:r.streaming,hadStreamBuffer:!!r.streamBuffer,currentSessionId:r.currentSessionId}),console.trace("üîç CLEAR_RECORDING called from:"),{...r,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,patientVersion:null,processingStatus:"idle",currentAgent:null,currentAgentName:null,recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,processingStartTime:null,reviewData:null,taviStructuredSections:void 0,educationData:void 0,preOpPlanData:void 0,rhcReport:void 0,streaming:!1,streamBuffer:"",ttftMs:null,processingPhase:void 0,processingStepProgress:{},processingGlobalProgress:0,pipelineProgress:null,currentSessionId:null,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayTaviStructuredSections:void 0,displayEducationData:void 0,displayPreOpPlanData:void 0,displayReviewData:void 0,displayRhcReport:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null,displayProcessingTime:void 0,displayModelUsed:null,displayPipelineProgress:null},resultRevisions:{},transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},ui:{...r.ui,activeWorkflow:null,warnings:[],errors:[],resultSummary:"",isCancelling:!1,mode:"idle",modeContext:{sessionId:null,origin:"auto"},overlay:"none",sidePanel:"none"}};case"SET_CURRENT_PATIENT_INFO":return{...r,currentPatientInfo:e.payload};case"ADD_PATIENT_SESSION":return{...r,patientSessions:[e.payload,...r.patientSessions]};case"UPDATE_PATIENT_SESSION":return{...r,patientSessions:r.patientSessions.map(s=>s.id===e.payload.id?{...s,...e.payload.updates}:s)};case"REMOVE_PATIENT_SESSION":return{...r,patientSessions:r.patientSessions.filter(s=>s.id!==e.payload)};case"CLEAR_PATIENT_SESSIONS":return{...r,patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null};case"SET_CURRENT_SESSION_ID":return{...r,currentSessionId:e.payload};case"SET_SELECTED_SESSION_ID":return{...r,selectedSessionId:e.payload};case"SET_PROCESSING_PROGRESS":return{...r,ui:{...r.ui,processingProgress:e.payload}};case"SET_AI_REVIEW_START_TIME":return{...r,ui:{...r.ui,processingStartTime:e.payload}};case"SET_PATIENT_VERSION":return r.patientVersion===e.payload?r:{...r,patientVersion:e.payload};case"SET_GENERATING_PATIENT_VERSION":return r.isGeneratingPatientVersion===e.payload?r:{...r,isGeneratingPatientVersion:e.payload};case"RESULTS_STREAMING":return{...r,streaming:e.payload};case"RESULTS_CLEAR_STREAM":return{...r,streamBuffer:"",ttftMs:null};case"RESULTS_APPEND_STREAM_CHUNK":return{...r,streamBuffer:(r.streamBuffer||"")+e.payload};case"RESULTS_TTFT":return{...r,ttftMs:e.payload};case"RESULTS_STREAM_DONE":return{...r,results:e.payload.final,streamBuffer:"",streaming:!1,ttftMs:e.payload.ttftMs??r.ttftMs??null,processingStatus:"complete"};case"RESULTS_STREAM_ERROR":return{...r,ui:{...r.ui,errors:[...r.ui.errors,e.payload]},streaming:!1};case"RESULTS_STREAM_CANCELLED":return{...r,streaming:!1};case"SET_RESULT_REVISION":{const{key:s,revision:n}=e.payload;return r.resultRevisions[s]===n?r:{...r,resultRevisions:{...r.resultRevisions,[s]:n}}}case"UPDATE_RESULT_REVISION":{const{key:s,updates:n}=e.payload,a=r.resultRevisions[s];if(!a)return r;const i={...a,...n};return{...r,resultRevisions:{...r.resultRevisions,[s]:i}}}case"CLEAR_RESULT_REVISION":{const{key:s}=e.payload;if(!r.resultRevisions[s])return r;const{[s]:n,...a}=r.resultRevisions;return{...r,resultRevisions:a}}case"RESET_RESULT_REVISIONS":return Object.keys(r.resultRevisions).length===0?r:{...r,resultRevisions:{}};case"SET_TRANSCRIPTION_APPROVAL":return{...r,transcriptionApproval:e.payload};case"SET_PIPELINE_PROGRESS":return{...r,pipelineProgress:e.payload};case"UPDATE_PIPELINE_PROGRESS":return r.pipelineProgress?{...r,pipelineProgress:{...r.pipelineProgress,...e.payload}}:r;case"CLEAR_PIPELINE_PROGRESS":return{...r,pipelineProgress:null};case"COMPLETE_PROCESSING_ATOMIC":{console.log("üèÅ ATOMIC COMPLETION: Processing complete for session:",e.payload.sessionId);const s=e.payload.results||"Processing completed",n=e.payload.summary||e.payload.results||"Processing completed";console.log("üîí ATOMIC COMPLETION: Safety checks applied - Results length:",s.length,"Summary length:",n.length);const a=["processing-phase","field-ingestion"].includes(r.ui.overlay),i=r.ui.mode==="processing"&&r.ui.modeContext.sessionId===e.payload.sessionId;return{...r,isProcessing:!1,processingStatus:"complete",streaming:!1,currentSessionId:null,results:s,aiGeneratedSummary:n,resultsSummary:n,streamBuffer:"",ttftMs:null,processingStartTime:null,pipelineProgress:null,ui:{...r.ui,activeWorkflow:null,isCancelling:!1,processingProgress:0,processingStartTime:0,overlay:a?"none":r.ui.overlay,mode:i?"reviewing":r.ui.mode,modeContext:i?{sessionId:e.payload.sessionId,origin:"auto"}:r.ui.modeContext}}}case"VALIDATE_STATE":{const s=[];return r.processingStatus==="complete"&&r.isProcessing&&s.push("processingStatus is complete but isProcessing is true"),r.processingStatus==="complete"&&r.streaming&&s.push("processingStatus is complete but streaming is true"),r.currentSessionId&&r.processingStatus==="complete"&&!r.isProcessing&&s.push("currentSessionId set but processing is complete - may block record button"),s.length>0&&console.warn("‚ö†Ô∏è STATE VALIDATION WARNINGS:",s),r}case"RECOVER_STUCK_STATE":{console.log("üîÑ RECOVERING FROM STUCK STATE");const s=["processing-phase","field-ingestion"].includes(r.ui.overlay),n=r.ui.mode==="processing";return{...r,isProcessing:!1,processingStatus:"idle",streaming:!1,currentSessionId:null,streamBuffer:"",ttftMs:null,processingStartTime:null,transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},ui:{...r.ui,isCancelling:!1,processingProgress:0,processingStartTime:0,activeWorkflow:null,warnings:[],errors:[],overlay:s?"none":r.ui.overlay,mode:n?"idle":r.ui.mode,modeContext:n?{sessionId:null,origin:"auto"}:r.ui.modeContext}}}case"SET_DISPLAY_SESSION":{const s=e.payload.session;return console.log("üîÑ SET_DISPLAY_SESSION - Loading session data:",{sessionId:s.id,agentType:s.agentType,patientName:s.patient?.name,hasTranscription:!!s.transcription,transcriptionLength:s.transcription?.length||0,hasResults:!!s.results,resultsLength:s.results?.length||0,hasSummary:!!s.summary,summaryLength:s.summary?.length||0,hasEducationData:!!s.educationData,hasPreOpPlanData:!!s.preOpPlanData,hasReviewData:!!s.reviewData,hasTaviSections:!!s.taviStructuredSections,hasPipelineProgress:!!s.pipelineProgress,pipelineStage:s.pipelineProgress?.stage,pipelineProgress:s.pipelineProgress?.progress}),{...r,selectedSessionId:s.id,displaySession:{isDisplayingSession:!0,displaySessionId:s.id,displayTranscription:s.transcription||"",displayResults:s.results||"",displaySummary:s.summary,displayTaviStructuredSections:s.taviStructuredSections,displayEducationData:s.educationData,displayPreOpPlanData:s.preOpPlanData,displayReviewData:s.reviewData,displayRhcReport:s.rhcReport,displayAgent:s.agentType||null,displayAgentName:s.agentName||null,displayPatientInfo:s.patient||null,displayProcessingTime:s.processingTime,displayModelUsed:s.modelUsed||null,displayAudioDuration:s.audioDuration||null,displayPipelineProgress:s.pipelineProgress||null}}}case"CLEAR_DISPLAY_SESSION":return{...r,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayTaviStructuredSections:void 0,displayEducationData:void 0,displayPreOpPlanData:void 0,displayReviewData:void 0,displayRhcReport:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null,displayProcessingTime:void 0,displayAudioDuration:null,displayModelUsed:null,displayPipelineProgress:null}};case"FORCE_UI_READY_STATE":return console.log("üîß FORCING UI READY STATE - clearing all processing indicators"),{...r,isRecording:!1,isProcessing:!1,streaming:!1,currentSessionId:null,ui:{...r.ui,activeWorkflow:null,isCancelling:!1,processingProgress:0,processingStartTime:0,overlay:["processing-phase","field-ingestion"].includes(r.ui.overlay)?"none":r.ui.overlay,mode:r.ui.mode==="processing"?"idle":r.ui.mode,modeContext:r.ui.mode==="processing"?{sessionId:null,origin:"auto"}:r.ui.modeContext}};case"SET_PERSISTED_SESSION_IDS":return{...r,persistedSessionIds:e.payload};case"ADD_PERSISTED_SESSION_ID":{const s=new Set(r.persistedSessionIds);return s.add(e.payload),{...r,persistedSessionIds:s}}case"REMOVE_PERSISTED_SESSION_ID":{const s=new Set(r.persistedSessionIds);return s.delete(e.payload),{...r,persistedSessionIds:s}}case"SET_STORAGE_METADATA":return{...r,storageMetadata:e.payload};default:return r}}function qw(){const[r,e]=u.useReducer(Xw,Lu),s=u.useRef(0),n={setRecording:u.useCallback(i=>{e({type:"SET_RECORDING",payload:i})},[]),setProcessing:u.useCallback(i=>{e({type:"SET_PROCESSING",payload:i})},[]),setCurrentAgent:u.useCallback(i=>{e({type:"SET_CURRENT_AGENT",payload:i})},[]),setTranscription:u.useCallback(i=>{e({type:"SET_TRANSCRIPTION",payload:i})},[]),setResults:u.useCallback(i=>{e({type:"SET_RESULTS",payload:i})},[]),setResultsSummary:u.useCallback(i=>{e({type:"SET_RESULTS_SUMMARY",payload:i})},[]),setAiGeneratedSummary:u.useCallback(i=>{e({type:"SET_AI_GENERATED_SUMMARY",payload:i})},[]),setMissingInfo:u.useCallback(i=>{e({type:"SET_MISSING_INFO",payload:i})},[]),setMissingInfoAnswers:u.useCallback(i=>{e({type:"SET_MISSING_INFO_ANSWERS",payload:i})},[]),clearMissingInfo:u.useCallback(()=>{e({type:"CLEAR_MISSING_INFO"})},[]),setProcessingStatus:u.useCallback(i=>{e({type:"SET_PROCESSING_STATUS",payload:i})},[]),setProcessingPhase:u.useCallback((i,o,A)=>{e({type:"SET_PROCESSING_PHASE",payload:{phase:i,stepProgress:o,globalProgress:A}})},[]),setVoiceActivity:u.useCallback((i,o)=>{const A=Date.now();A-s.current>=200&&(s.current=A,e({type:"SET_VOICE_ACTIVITY",payload:{level:i,frequencyData:o}}))},[]),setModelStatus:u.useCallback(i=>{e({type:"SET_MODEL_STATUS",payload:i})},[]),setTimingData:u.useCallback(i=>{e({type:"SET_TIMING_DATA",payload:i})},[]),setCurrentAgentName:u.useCallback(i=>{e({type:"SET_CURRENT_AGENT_NAME",payload:i})},[]),setFailedRecordings:u.useCallback(i=>{e({type:"SET_FAILED_RECORDINGS",payload:i})},[]),setReviewData:u.useCallback(i=>{e({type:"SET_REVIEW_DATA",payload:i})},[]),setTaviStructuredSections:u.useCallback(i=>{e({type:"SET_TAVI_STRUCTURED_SECTIONS",payload:i})},[]),setEducationData:u.useCallback(i=>{e({type:"SET_EDUCATION_DATA",payload:i})},[]),setPreOpPlanData:u.useCallback(i=>{e({type:"SET_PREOP_PLAN_DATA",payload:i})},[]),setRhcReport:u.useCallback(i=>{console.log("üö® ACTION: setRhcReport called with:",{hasRhcData:!!i?.rhcData,hasCalculations:!!i?.calculations,reportKeys:i?Object.keys(i):[]}),e({type:"SET_RHC_REPORT",payload:i})},[]),setActiveWorkflow:u.useCallback(i=>{e({type:"SET_ACTIVE_WORKFLOW",payload:i})},[]),setCancelling:u.useCallback(i=>{e({type:"SET_CANCELLING",payload:i})},[]),setWarnings:u.useCallback(i=>{e({type:"SET_WARNINGS",payload:i})},[]),setErrors:u.useCallback(i=>{e({type:"SET_ERRORS",payload:i})},[]),setAlertsVisible:u.useCallback(i=>{e({type:"SET_ALERTS_VISIBLE",payload:i})},[]),setResultSummary:u.useCallback(i=>{e({type:"SET_RESULT_SUMMARY",payload:i})},[]),setUIMode:u.useCallback((i,o)=>{e({type:"SET_UI_MODE",payload:{mode:i,context:o}})},[]),openOverlay:u.useCallback(i=>{e({type:"SET_UI_OVERLAY",payload:i})},[]),closeOverlay:u.useCallback(i=>{e({type:"CLEAR_UI_OVERLAY",payload:i})},[]),setSidePanel:u.useCallback(i=>{e({type:"SET_UI_SIDE_PANEL",payload:i})},[]),clearSidePanel:u.useCallback(()=>{e({type:"SET_UI_SIDE_PANEL",payload:"none"})},[]),setPatientMismatchData:u.useCallback(i=>{e({type:"SET_PATIENT_MISMATCH_DATA",payload:i})},[]),setCalendarData:u.useCallback(i=>{e({type:"SET_CALENDAR_DATA",payload:i})},[]),setExtractingPatients:u.useCallback(i=>{e({type:"SET_EXTRACTING_PATIENTS",payload:i})},[]),setExtractError:u.useCallback(i=>{e({type:"SET_EXTRACT_ERROR",payload:i})},[]),setBatchProcessing:u.useCallback(i=>{e({type:"SET_BATCH_PROCESSING",payload:i})},[]),setBatchProgress:u.useCallback(i=>{e({type:"SET_BATCH_PROGRESS",payload:i})},[]),setProcessingStartTime:u.useCallback(i=>{e({type:"SET_PROCESSING_START_TIME",payload:i})},[]),resetState:u.useCallback(()=>{e({type:"RESET_STATE"})},[]),clearRecording:u.useCallback(()=>{e({type:"CLEAR_RECORDING"})},[]),setCurrentPatientInfo:u.useCallback(i=>{e({type:"SET_CURRENT_PATIENT_INFO",payload:i})},[]),addPatientSession:u.useCallback(i=>{e({type:"ADD_PATIENT_SESSION",payload:i})},[]),updatePatientSession:u.useCallback((i,o)=>{e({type:"UPDATE_PATIENT_SESSION",payload:{id:i,updates:o}})},[]),removePatientSession:u.useCallback(i=>{e({type:"REMOVE_PATIENT_SESSION",payload:i})},[]),clearPatientSessions:u.useCallback(()=>{e({type:"CLEAR_PATIENT_SESSIONS"})},[]),setCurrentSessionId:u.useCallback(i=>{e({type:"SET_CURRENT_SESSION_ID",payload:i})},[]),setSelectedSessionId:u.useCallback(i=>{e({type:"SET_SELECTED_SESSION_ID",payload:i})},[]),setProcessingProgress:u.useCallback(i=>{e({type:"SET_PROCESSING_PROGRESS",payload:i})},[]),setAIReviewStartTime:u.useCallback(i=>{e({type:"SET_AI_REVIEW_START_TIME",payload:i})},[]),setPatientVersion:u.useCallback(i=>{e({type:"SET_PATIENT_VERSION",payload:i})},[]),setGeneratingPatientVersion:u.useCallback(i=>{e({type:"SET_GENERATING_PATIENT_VERSION",payload:i})},[]),setStreaming:u.useCallback(i=>{e({type:"RESULTS_STREAMING",payload:i})},[]),clearStream:u.useCallback(()=>{e({type:"RESULTS_CLEAR_STREAM"})},[]),appendStreamChunk:u.useCallback(i=>{e({type:"RESULTS_APPEND_STREAM_CHUNK",payload:i})},[]),setTTFT:u.useCallback(i=>{e({type:"RESULTS_TTFT",payload:i})},[]),streamDone:u.useCallback((i,o,A)=>{e({type:"RESULTS_STREAM_DONE",payload:{final:i,usage:o,ttftMs:A}})},[]),streamError:u.useCallback(i=>{e({type:"RESULTS_STREAM_ERROR",payload:i})},[]),streamCancelled:u.useCallback(()=>{e({type:"RESULTS_STREAM_CANCELLED"})},[]),setResultRevision:u.useCallback((i,o)=>{e({type:"SET_RESULT_REVISION",payload:{key:i,revision:o}})},[]),updateResultRevision:u.useCallback((i,o)=>{e({type:"UPDATE_RESULT_REVISION",payload:{key:i,updates:o}})},[]),clearResultRevision:u.useCallback(i=>{e({type:"CLEAR_RESULT_REVISION",payload:{key:i}})},[]),resetResultRevisions:u.useCallback(()=>{e({type:"RESET_RESULT_REVISIONS"})},[]),setTranscriptionApproval:u.useCallback(i=>{e({type:"SET_TRANSCRIPTION_APPROVAL",payload:i})},[]),setPipelineProgress:u.useCallback(i=>{e({type:"SET_PIPELINE_PROGRESS",payload:i})},[]),updatePipelineProgress:u.useCallback(i=>{e({type:"UPDATE_PIPELINE_PROGRESS",payload:i})},[]),clearPipelineProgress:u.useCallback(()=>{e({type:"CLEAR_PIPELINE_PROGRESS"})},[]),completeProcessingAtomic:u.useCallback((i,o,A)=>{e({type:"COMPLETE_PROCESSING_ATOMIC",payload:{sessionId:i,results:o,summary:A}})},[]),validateState:u.useCallback(()=>{e({type:"VALIDATE_STATE"})},[]),recoverStuckState:u.useCallback(()=>{e({type:"RECOVER_STUCK_STATE"})},[]),setDisplaySession:u.useCallback(i=>{e({type:"SET_DISPLAY_SESSION",payload:{session:i}})},[]),clearDisplaySession:u.useCallback(()=>{e({type:"CLEAR_DISPLAY_SESSION"})},[]),forceUIReadyState:u.useCallback(()=>{e({type:"FORCE_UI_READY_STATE"})},[]),setPersistedSessionIds:u.useCallback(i=>{e({type:"SET_PERSISTED_SESSION_IDS",payload:i})},[]),addPersistedSessionId:u.useCallback(i=>{e({type:"ADD_PERSISTED_SESSION_ID",payload:i})},[]),removePersistedSessionId:u.useCallback(i=>{e({type:"REMOVE_PERSISTED_SESSION_ID",payload:i})},[]),setStorageMetadata:u.useCallback(i=>{e({type:"SET_STORAGE_METADATA",payload:i})},[])},a=u.useMemo(()=>({isMode:i=>r.ui.mode===i,isOverlayActive:i=>r.ui.overlay===i,isSidePanelOpen:i=>r.ui.sidePanel===i,activeModeContext:r.ui.modeContext}),[r.ui.mode,r.ui.overlay,r.ui.sidePanel,r.ui.modeContext]);return{state:r,actions:n,selectors:a}}class ks{static instance;defaultTimeout=15e3;defaultInterval=500;debugMode=!1;constructor(){}static getInstance(){return ks.instance||(ks.instance=new ks),ks.instance}setDebugMode(e){this.debugMode=e}async waitForPatientDataLoad(e,s,n=this.defaultTimeout){const a=[{name:"content_script_responsive",checker:()=>this.checkContentScriptResponsive(e),description:"Content script is responsive",timeout:5e3,interval:200},{name:"xestro_boxes_present",checker:()=>this.checkXestroBoxesPresent(e),description:"XestroBox elements are present",timeout:n,interval:this.defaultInterval},{name:"patient_data_populated",checker:()=>this.checkPatientDataPopulated(e,s),description:"Patient data fields are populated",timeout:n,interval:this.defaultInterval},{name:"clinical_sections_ready",checker:()=>this.checkClinicalSectionsReady(e),description:"Clinical sections have content",timeout:n,interval:this.defaultInterval}];return this.waitForMultipleConditions(a,{requireAll:!1,minConditions:2,earlyReturnOnCritical:!0})}async waitForClinicalSection(e,s,n=this.defaultTimeout){const a=[{name:`${s}_section_present`,checker:()=>this.checkSectionPresent(e,s),description:`${s} section is present in DOM`,timeout:n/2,interval:this.defaultInterval},{name:`${s}_content_loaded`,checker:()=>this.checkSectionContentLoaded(e,s),description:`${s} section has content`,timeout:n,interval:this.defaultInterval}];return this.waitForMultipleConditions(a,{requireAll:!0,minConditions:2,earlyReturnOnCritical:!1})}async waitForPatientActivation(e,s,n=1e4){const a=[{name:"patient_row_highlighted",checker:()=>this.checkPatientRowHighlighted(e,s),description:"Patient row is highlighted/selected",timeout:n/3,interval:200},{name:"patient_record_loading",checker:()=>this.checkPatientRecordLoading(e),description:"Patient record is loading",timeout:n/2,interval:this.defaultInterval},{name:"patient_record_loaded",checker:()=>this.checkPatientRecordLoaded(e),description:"Patient record is fully loaded",timeout:n,interval:this.defaultInterval}];return this.waitForMultipleConditions(a,{requireAll:!1,minConditions:1,earlyReturnOnCritical:!0,sequentialChecking:!0})}async waitForDOMStability(e,s=1e3,n=this.defaultTimeout){const a=Date.now(),i=[];let o=Date.now(),A="";for(;Date.now()-a<n;)try{const l=await this.getDOMHash(e),c=Date.now();if(l!==A)o=c,A=l,i.push({timestamp:c,conditionName:"dom_changed",passed:!1,details:"DOM structure changed"});else if(c-o>=s)return i.push({timestamp:c,conditionName:"dom_stable",passed:!0,details:`DOM stable for ${s}ms`}),{success:!0,timeElapsed:c-a,conditionMet:"dom_stable",intermediateChecks:i};await this.sleep(200)}catch(l){this.log("Error checking DOM stability:",l),await this.sleep(this.defaultInterval)}return{success:!1,timeElapsed:Date.now()-a,conditionMet:null,error:`DOM did not stabilize within ${n}ms`,intermediateChecks:i}}async waitForCondition(e,s={}){const n=Date.now(),a=[],{earlyReturn:i=!0,logProgress:o=this.debugMode}=s;for(this.log(`Starting wait for condition: ${e.name} - ${e.description}`);Date.now()-n<e.timeout;)try{const l=await e.checker(),c=Date.now();if(a.push({timestamp:c,conditionName:e.name,passed:l,details:l?"Condition met":"Condition not met"}),l){const d=c-n;return this.log(`‚úÖ Condition '${e.name}' met in ${d}ms`),{success:!0,timeElapsed:d,conditionMet:e.name,intermediateChecks:a}}o&&a.length%10===0&&this.log(`‚è≥ Still waiting for '${e.name}' (${Date.now()-n}ms elapsed)`),await this.sleep(e.interval)}catch(l){a.push({timestamp:Date.now(),conditionName:e.name,passed:!1,details:`Error: ${l instanceof Error?l.message:String(l)}`}),this.log(`‚ùå Error checking condition '${e.name}':`,l),await this.sleep(e.interval)}const A=Date.now()-n;return this.log(`‚è∞ Timeout waiting for condition '${e.name}' after ${A}ms`),{success:!1,timeElapsed:A,conditionMet:null,error:`Timeout waiting for condition '${e.name}'`,intermediateChecks:a}}async waitForMultipleConditions(e,s){const n=Date.now(),a=[],i=new Set,o=Math.max(...e.map(d=>d.timeout));if(this.log(`Starting multi-condition wait: ${e.length} conditions`),s.sequentialChecking)for(const d of e){const m=await this.waitForCondition(d);if(a.push(...m.intermediateChecks),m.success)i.add(d.name);else if(s.requireAll)return{success:!1,timeElapsed:Date.now()-n,conditionMet:null,error:`Sequential condition failed: ${d.name}`,intermediateChecks:a}}else for(;Date.now()-n<o;){for(const m of e)if(!i.has(m.name))try{const g=await m.checker(),h=Date.now();a.push({timestamp:h,conditionName:m.name,passed:g,details:g?"Condition met":"Condition not met"}),g&&(i.add(m.name),this.log(`‚úÖ Condition met: ${m.name}`))}catch(g){a.push({timestamp:Date.now(),conditionName:m.name,passed:!1,details:`Error: ${g instanceof Error?g.message:String(g)}`})}const d=i.size;if(s.requireAll&&d===e.length)break;if(!s.requireAll&&d>=s.minConditions)break;await this.sleep(Math.min(...e.map(m=>m.interval)))}const A=i.size,l=s.requireAll?A===e.length:A>=s.minConditions,c=Date.now()-n;return l?this.log(`‚úÖ Multi-condition wait successful: ${A}/${e.length} conditions met`):this.log(`‚ùå Multi-condition wait failed: ${A}/${e.length} conditions met`),{success:l,timeElapsed:c,conditionMet:l?Array.from(i).join(", "):null,error:l?void 0:`Insufficient conditions met: ${A}/${s.minConditions}`,intermediateChecks:a}}async checkContentScriptResponsive(e){try{return!!await this.sendMessage(e,{type:"PING"},2e3)}catch{return!1}}async checkXestroBoxesPresent(e){try{return(await this.sendMessage(e,{type:"CHECK_XESTRO_BOXES"},3e3))?.found===!0}catch{return!1}}async checkPatientDataPopulated(e,s){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_DATA",data:{expectedPatientName:s}},3e3))?.populated===!0}catch{return!1}}async checkClinicalSectionsReady(e){try{return(await this.sendMessage(e,{type:"CHECK_CLINICAL_SECTIONS"},3e3))?.sectionsReady===!0}catch{return!1}}async checkSectionPresent(e,s){try{return(await this.sendMessage(e,{type:"CHECK_SECTION_PRESENT",data:{sectionType:s}},3e3))?.present===!0}catch{return!1}}async checkSectionContentLoaded(e,s){try{const n=await this.sendMessage(e,{type:"CHECK_SECTION_CONTENT",data:{sectionType:s}},3e3);return n?.hasContent===!0&&n?.wordCount>0}catch{return!1}}async checkPatientRowHighlighted(e,s){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_ROW_HIGHLIGHTED",data:{patientIndex:s}},2e3))?.highlighted===!0}catch{return!1}}async checkPatientRecordLoading(e){try{const s=await this.sendMessage(e,{type:"CHECK_PATIENT_RECORD_STATE"},2e3);return s?.state==="loading"||s?.state==="loaded"}catch{return!1}}async checkPatientRecordLoaded(e){try{return(await this.sendMessage(e,{type:"CHECK_PATIENT_RECORD_STATE"},2e3))?.state==="loaded"}catch{return!1}}async getDOMHash(e){try{return(await this.sendMessage(e,{type:"GET_DOM_HASH"},2e3))?.hash||""}catch{return""}}async sendMessage(e,s,n=5e3){return new Promise((a,i)=>{const o=setTimeout(()=>{i(new Error(`Message timeout after ${n}ms`))},n);try{chrome.tabs.sendMessage(e,s,A=>{if(clearTimeout(o),chrome.runtime.lastError){i(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}a(A)})}catch(A){clearTimeout(o),i(A)}})}async sleep(e){return new Promise(s=>setTimeout(s,e))}log(...e){this.debugMode&&console.log("[DynamicWaitUtils]",...e)}setDefaultTimeout(e){this.defaultTimeout=e}setDefaultInterval(e){this.defaultInterval=e}getDefaultTimeout(){return this.defaultTimeout}getDefaultInterval(){return this.defaultInterval}}class Ps{static instance;debugMode=!1;medicalTermPatterns=[];commonErrorPatterns=[];defaultConfig={fields:["background","investigations","medications"],fallbackSelectors:{background:['textarea[data-field="background"]',"#background",".background textarea",'.XestroBox:contains("Background") textarea','textarea[placeholder*="background" i]'],investigations:['textarea[data-field="investigations"]',"#investigations",".investigations textarea",'.XestroBox:contains("Investigation") textarea','textarea[placeholder*="investigation" i]'],medications:['textarea[data-field="medications"]',"#medications",".medications textarea",'.XestroBox:contains("Medication") textarea','textarea[placeholder*="medication" i]']},qualityThresholds:{minWordCount:5,minMedicalTerms:1,minCompletenessScore:.3,acceptableConfidenceLevel:"medium"},retryAttempts:3,timeout:1e4,screenshotOnFailure:!0};constructor(){this.initializeMedicalPatterns(),this.initializeErrorPatterns()}static getInstance(){return Ps.instance||(Ps.instance=new Ps),Ps.instance}async extractPatientClinicalData(e,s,n={}){const a={...this.defaultConfig,...n},i=Date.now();this.log(`üîç Starting data extraction for patient: ${s.name}`);const o=await this.preExtractionValidation(e,s);if(!o.isValid)throw new Error(`Pre-extraction validation failed: ${o.errors.join(", ")}`);const A=new Map;for(const m of a.fields)try{const g=await this.extractField(e,m,a);A.set(m,g),g.success?this.log(`‚úÖ Successfully extracted ${m}: ${g.content.length} chars`):this.log(`‚ùå Failed to extract ${m}: ${g.errorMessage}`)}catch(g){this.log(`‚ùå Exception extracting ${m}:`,g),A.set(m,{fieldName:m,content:"",extractionTime:0,success:!1,errorMessage:g instanceof Error?g.message:String(g),quality:this.createEmptyQualityReport(),fallbackUsed:!1,selectorUsed:"none"})}const l={background:A.get("background")?.content||"",investigations:A.get("investigations")?.content||"",medications:A.get("medications")?.content||"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:this.calculateOverallQualityScore(A)},c=this.assessDataQuality(l);if(this.log("üìä Data quality assessment:",{completeness:c.completenessScore,richness:c.contentRichness,confidence:c.confidenceLevel,medicalTerms:c.medicalTermsFound}),c.completenessScore<a.qualityThresholds.minCompletenessScore){this.log("‚ö†Ô∏è Low quality data detected, attempting fallback extraction");const m=await this.attemptFallbackExtraction(e,l,A,a);if(m)return m}const d=Date.now()-i;return this.log(`‚úÖ Data extraction completed in ${d}ms`),l}assessDataQuality(e){const s=["background","investigations","medications"],n=s.length;let a=0,i=0,o=0;const A=[],l=[];for(const h of s){const p=e[h];if(this.isContentMeaningful(p)){a++;const b=this.countWords(p),N=this.countMedicalTerms(p);i+=b,o+=N,this.containsErrorPatterns(p)&&l.push(`${h} contains potential error text`),b<5&&l.push(`${h} has very little content (${b} words)`)}else A.push(h)}const c=a/n,d=a>0?i/a:0,m=Math.min(1,d/50*.7+o/10*.3);let g="low";return c>=.8&&m>=.6&&o>=3?g="high":c>=.5&&m>=.3&&o>=1&&(g="medium"),{completenessScore:c,contentRichness:m,confidenceLevel:g,missingFields:A,extractionWarnings:l,medicalTermsFound:o,estimatedWordCount:i}}async verifyPatientIdentity(e,s){try{const n=await this.sendMessage(e,{type:"VERIFY_PATIENT_IDENTITY",data:{expectedName:s.name,expectedFileNumber:s.fileNumber,expectedDOB:s.dob}});if(n?.verified===!0)return{isValid:!0,errors:[],warnings:[],score:1};{const a=[`Patient identity mismatch. Expected: ${s.name} (${s.fileNumber})`];return n?.currentPatient&&a.push(`Current patient: ${n.currentPatient.name} (${n.currentPatient.fileNumber})`),{isValid:!1,errors:a,warnings:n?.warnings||[],score:0}}}catch(n){return{isValid:!1,errors:[`Failed to verify patient identity: ${n}`],warnings:[],score:0}}}async extractField(e,s,n){const a=Date.now(),i=n.fallbackSelectors[s]||[];for(let o=0;o<i.length;o++){const A=i[o],l=o===0;try{this.log(`üîç Extracting ${s} with selector: ${A} (attempt ${o+1})`);const c=await this.sendMessage(e,{type:"EXTRACT_FIELD_DATA",data:{fieldName:s,selector:A,timeout:n.timeout/i.length}});if(c?.success&&c?.content){const d=this.sanitizeContent(c.content),m=this.assessFieldQuality(s,d);return{fieldName:s,content:d,extractionTime:Date.now()-a,success:!0,quality:m,fallbackUsed:!l,selectorUsed:A}}}catch(c){if(this.log(`‚ùå Extraction attempt ${o+1} failed for ${s}:`,c),o<i.length-1)continue;return{fieldName:s,content:"",extractionTime:Date.now()-a,success:!1,errorMessage:c instanceof Error?c.message:String(c),quality:this.createEmptyQualityReport(),fallbackUsed:!l,selectorUsed:A}}}return{fieldName:s,content:"",extractionTime:Date.now()-a,success:!1,errorMessage:"All selectors failed",quality:this.createEmptyQualityReport(),fallbackUsed:!0,selectorUsed:"none"}}async preExtractionValidation(e,s){const n=[],a=[];try{const i=await this.verifyPatientIdentity(e,s);i.isValid||n.push(...i.errors),a.push(...i.warnings);const o=await this.sendMessage(e,{type:"CHECK_PAGE_READY_FOR_EXTRACTION"});o?.ready||(n.push("Page not ready for data extraction"),o?.reason&&n.push(`Reason: ${o.reason}`));const A=await this.sendMessage(e,{type:"CHECK_CLINICAL_SECTIONS_EXIST"});A?.allSectionsFound||(a.push("Some clinical sections may not be available"),A?.missingSections&&a.push(`Missing: ${A.missingSections.join(", ")}`))}catch(i){n.push(`Pre-extraction validation failed: ${i}`)}return{isValid:n.length===0,errors:n,warnings:a,score:n.length===0?1:0}}async attemptFallbackExtraction(e,s,n,a){this.log("üîÑ Attempting fallback extraction strategies");const i=[];for(const[l,c]of n)(!c.success||c.quality.completenessScore<.5)&&i.push(l);if(i.length===0)return null;const o={...s};let A=!1;for(const l of i)try{const c=await this.tryOCRExtraction(e,l);if(c&&this.isContentMeaningful(c)&&(l==="background"||l==="investigations"||l==="medications")){o[l]=c,A=!0,this.log(`‚úÖ OCR extraction successful for ${l}`);continue}const d=await this.trySemanticExtraction(e,l);if(d&&this.isContentMeaningful(d)&&(l==="background"||l==="investigations"||l==="medications")){o[l]=d,A=!0,this.log(`‚úÖ Semantic extraction successful for ${l}`);continue}}catch(c){this.log(`‚ùå Fallback extraction failed for ${l}:`,c)}return A?(o.extractionAttempts++,o.qualityScore=this.calculateOverallQualityScore(new Map([["improved",{fieldName:"improved",content:JSON.stringify(o),extractionTime:0,success:!0,quality:this.assessDataQuality(o),fallbackUsed:!0,selectorUsed:"fallback"}]])),o):null}async tryOCRExtraction(e,s){try{return(await this.sendMessage(e,{type:"EXTRACT_FIELD_OCR",data:{fieldName:s}}))?.content||null}catch{return null}}async trySemanticExtraction(e,s){try{return(await this.sendMessage(e,{type:"EXTRACT_FIELD_SEMANTIC",data:{fieldName:s}}))?.content||null}catch{return null}}isContentMeaningful(e){if(!e||typeof e!="string")return!1;const s=e.trim();return s.length<3?!1:![/^(\s*|-|n\/a|none|nil|not?\s*applicable?)$/i,/^\s*\[.*extraction.*failed.*\]\s*$/i,/^\s*loading\.+\s*$/i,/^\s*please\s+wait\.+\s*$/i].some(a=>a.test(s))}countWords(e){return e?e.trim().split(/\s+/).filter(s=>s.length>0).length:0}countMedicalTerms(e){if(!e)return 0;let s=0;for(const n of this.medicalTermPatterns){const a=e.match(n);a&&(s+=a.length)}return s}containsErrorPatterns(e){return this.commonErrorPatterns.some(s=>s.test(e))}sanitizeContent(e){return e?e.trim().replace(/\s+/g," ").replace(/[\\u0000-\\u001F\\u007F]/g,""):""}assessFieldQuality(e,s){const n=this.countWords(s),a=this.countMedicalTerms(s),i=this.isContentMeaningful(s),o=i?1:0,A=Math.min(1,n/20);let l="low";return o===1&&n>=10&&a>=1?l="high":o===1&&n>=5&&(l="medium"),{completenessScore:o,contentRichness:A,confidenceLevel:l,missingFields:i?[]:[e],extractionWarnings:this.containsErrorPatterns(s)?["Contains error patterns"]:[],medicalTermsFound:a,estimatedWordCount:n}}createEmptyQualityReport(){return{completenessScore:0,contentRichness:0,confidenceLevel:"low",missingFields:[],extractionWarnings:[],medicalTermsFound:0,estimatedWordCount:0}}calculateOverallQualityScore(e){const s=Array.from(e.values());if(s.length===0)return 0;const n=s.reduce((o,A)=>o+A.quality.completenessScore,0)/s.length,a=s.reduce((o,A)=>o+A.quality.contentRichness,0)/s.length,i=s.filter(o=>o.success).length/s.length;return n*.4+a*.3+i*.3}initializeMedicalPatterns(){this.medicalTermPatterns=[/\b(?:diagnosis|treatment|medication|prescription|symptom|condition|disease|disorder|syndrome)\b/gi,/\b\d+\s*(?:mg|mcg|g|ml|cc|units?|mmHg|bpm|kg|lbs?)\b/gi,/\b(?:angiogram|angioplasty|stent|bypass|catheter|biopsy|surgery|procedure)\b/gi,/\b(?:abnormal|normal|elevated|decreased|hypertension|diabetes|coronary|cardiac|pulmonary)\b/gi,/\b(?:paracetamol|lignocaine|adrenaline|salbutamol|glyceryl trinitrate)\b/gi]}initializeErrorPatterns(){this.commonErrorPatterns=[/error|failed|timeout|exception|null|undefined/gi,/loading\.+|please\s+wait\.+/gi,/access\s+denied|permission\s+denied/gi,/not\s+found|404|500|503/gi]}async sendMessage(e,s,n=5e3){return new Promise((a,i)=>{const o=setTimeout(()=>{i(new Error(`Message timeout after ${n}ms`))},n);try{chrome.tabs.sendMessage(e,s,A=>{if(clearTimeout(o),chrome.runtime.lastError){i(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}a(A)})}catch(A){clearTimeout(o),i(A)}})}log(...e){this.debugMode&&console.log("[DataValidation]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.defaultConfig,e)}getConfig(){return{...this.defaultConfig}}}class Ds{static instance;strategies;circuitBreakers;failureHistory;config;debugMode=!1;constructor(){this.strategies=new Map,this.circuitBreakers=new Map,this.failureHistory=[],this.config=this.getDefaultConfig(),this.initializeStrategies()}static getInstance(){return Ds.instance||(Ds.instance=new Ds),Ds.instance}async executeWithRecovery(e,s,n){const a=`${s.operation}_${s.patientIndex}`;if(this.isCircuitBreakerOpen(a))throw new Error(`Circuit breaker is open for operation: ${s.operation}`);let i=null,o=0;const A=this.getMaxAttempts(s.operation);for(;o<A;)try{this.log(`üîÑ Executing ${s.operation} (attempt ${o+1}/${A})`);const l=await e();return this.resetCircuitBreaker(a),this.log(`‚úÖ Operation ${s.operation} succeeded on attempt ${o+1}`),l}catch(l){o++,i=l instanceof Error?l:new Error(String(l)),this.log(`‚ùå Attempt ${o} failed for ${s.operation}:`,i.message);const c=this.classifyError(i),d={patientIndex:s.patientIndex,patient:s.patient,operation:s.operation,error:i.message,timestamp:Date.now(),context:s,recoveryAttempted:!1},m=this.getStrategy(c,n);if(!m.shouldRetry(i,o,s)||o>=A){this.recordCircuitBreakerFailure(a),this.recordFailure(d);break}d.recoveryAttempted=!0,await this.applyRecoveryStrategy(m,i,o,s),this.recordFailure(d)}if(this.recordCircuitBreakerFailure(a),this.config.enableGracefulDegradation){const l=await this.attemptGracefulDegradation(s,i);if(l!==null)return this.log(`üîÑ Graceful degradation successful for ${s.operation}`),l}throw new Error(`Operation ${s.operation} failed after ${o} attempts. Last error: ${i?.message}`)}shouldRetryOperation(e,s,n){const a=this.classifyError(s),i=this.strategies.get(a);if(!i)return!1;const o={operation:e,patientIndex:0,patient:{name:"",dob:"",fileNumber:"",appointmentTime:"",appointmentType:"",confirmed:!1,isFirstAppointment:!1},timestamp:Date.now(),environmentState:{tabId:0,currentUrl:"",contentScriptVersion:"",lastHealthCheck:0},previousAttempts:n-1};return i.shouldRetry(s,n,o)}getRetryDelay(e,s){const n=this.strategies.get(e);return n?this.calculateBackoffDelay(n.backoffStrategy,s,1e3):1e3}resetCircuitBreaker(e){const s=this.circuitBreakers.get(e);s&&(s.failures=0,s.state="closed",s.resetAttempts=0)}getFailureStats(){const e=new Map,s=new Map;for(const i of this.failureHistory){const o=this.classifyError(new Error(i.error));e.set(o,(e.get(o)||0)+1),s.set(i.operation,(s.get(i.operation)||0)+1)}const n=this.failureHistory.filter(i=>Date.now()-i.timestamp<3e5).slice(-10),a=Array.from(this.circuitBreakers.entries()).filter(([i,o])=>o.state==="open").map(([i,o])=>i);return{totalFailures:this.failureHistory.length,failuresByType:e,failuresByOperation:s,recentFailures:n,circuitBreakersOpen:a}}initializeStrategies(){this.strategies.set("network_timeout",{errorType:"network_timeout",maxRetries:3,backoffStrategy:"exponential",recoveryTimeout:3e4,shouldRetry:(e,s,n)=>s<=3&&!e.message.includes("permanent")}),this.strategies.set("dom_not_found",{errorType:"dom_not_found",maxRetries:5,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(e,s,n)=>s<=5,fallbackAction:async()=>null}),this.strategies.set("content_script_unresponsive",{errorType:"content_script_unresponsive",maxRetries:2,backoffStrategy:"fixed",recoveryTimeout:15e3,shouldRetry:(e,s,n)=>s<=2,fallbackAction:async()=>null}),this.strategies.set("extraction_failed",{errorType:"extraction_failed",maxRetries:4,backoffStrategy:"fibonacci",recoveryTimeout:25e3,shouldRetry:(e,s,n)=>s<=4&&!e.message.includes("no data available")}),this.strategies.set("ai_processing_failed",{errorType:"ai_processing_failed",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:6e4,shouldRetry:(e,s,n)=>s<=2&&!e.message.includes("model unavailable")}),this.strategies.set("navigation_failed",{errorType:"navigation_failed",maxRetries:3,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(e,s,n)=>s<=3}),this.strategies.set("permission_denied",{errorType:"permission_denied",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:5e3,shouldRetry:(e,s,n)=>!1}),this.strategies.set("memory_limit",{errorType:"memory_limit",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:1e4,shouldRetry:(e,s,n)=>s===1,fallbackAction:async()=>{try{window.gc&&window.gc()}catch{}return null}}),this.strategies.set("unknown",{errorType:"unknown",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:15e3,shouldRetry:(e,s,n)=>s<=2})}classifyError(e){const s=e.message.toLowerCase();return s.includes("timeout")||s.includes("timed out")?"network_timeout":s.includes("not found")||s.includes("element")||s.includes("selector")?"dom_not_found":s.includes("content script")||s.includes("script not responsive")?"content_script_unresponsive":s.includes("extraction")||s.includes("data")||s.includes("field")?"extraction_failed":s.includes("ai")||s.includes("model")||s.includes("processing")?"ai_processing_failed":s.includes("navigation")||s.includes("navigate")||s.includes("tab")?"navigation_failed":s.includes("permission")||s.includes("access denied")?"permission_denied":s.includes("memory")||s.includes("heap")||s.includes("out of memory")?"memory_limit":"unknown"}getStrategy(e,s){const n=this.strategies.get(e)||this.strategies.get("unknown");return s?{...n,...s}:n}async applyRecoveryStrategy(e,s,n,a){const i=this.calculateBackoffDelay(e.backoffStrategy,n);if(this.log(`üîÑ Applying recovery strategy for ${e.errorType}, waiting ${i}ms`),e.fallbackAction)try{await e.fallbackAction(),this.log(`‚úÖ Fallback action executed for ${e.errorType}`)}catch(o){this.log(`‚ùå Fallback action failed for ${e.errorType}:`,o)}await this.sleep(i),await this.performContextSpecificRecovery(a,e.errorType)}async performContextSpecificRecovery(e,s){switch(s){case"content_script_unresponsive":await this.recoverContentScript(e.environmentState.tabId);break;case"dom_not_found":await this.recoverDOMElements(e.environmentState.tabId);break;case"navigation_failed":await this.recoverNavigation(e.environmentState.tabId);break;case"memory_limit":await this.recoverMemory();break}}async recoverContentScript(e){try{this.log(`üîß Attempting to recover content script on tab ${e}`),await chrome.scripting.executeScript({target:{tabId:e},files:["content-script.js"]}),await this.sleep(2e3)}catch(s){this.log("‚ùå Content script recovery failed:",s)}}async recoverDOMElements(e){try{this.log(`üîß Attempting to recover DOM elements on tab ${e}`),await this.sleep(1e3),await chrome.tabs.sendMessage(e,{type:"REFRESH_PAGE_SECTION"})}catch(s){this.log("‚ùå DOM recovery failed:",s)}}async recoverNavigation(e){try{if(this.log(`üîß Attempting to recover navigation on tab ${e}`),!await chrome.tabs.get(e))throw new Error("Tab no longer exists");await this.sleep(3e3)}catch(s){this.log("‚ùå Navigation recovery failed:",s)}}async recoverMemory(){this.log("üîß Attempting memory recovery"),this.failureHistory.length>100&&(this.failureHistory=this.failureHistory.slice(-50));const e=Date.now();for(const[s,n]of this.circuitBreakers)e-n.lastFailureTime>3e5&&this.circuitBreakers.delete(s);try{window.gc&&window.gc()}catch{}}calculateBackoffDelay(e,s,n=1e3){switch(e){case"exponential":return Math.min(n*Math.pow(2,s-1),3e4);case"linear":return Math.min(n*s,2e4);case"fibonacci":return Math.min(this.fibonacci(s)*n,25e3);case"fixed":default:return n}}fibonacci(e){if(e<=1)return 1;if(e===2)return 2;let s=1,n=2;for(let a=3;a<=e;a++){const i=s+n;s=n,n=i}return n}isCircuitBreakerOpen(e){const s=this.circuitBreakers.get(e);return s&&s.state==="open"?Date.now()-s.lastFailureTime>this.config.circuitBreakerResetTime?(s.state="half-open",s.resetAttempts++,!1):!0:!1}recordCircuitBreakerFailure(e){let s=this.circuitBreakers.get(e);s||(s={failures:0,lastFailureTime:0,state:"closed",resetAttempts:0},this.circuitBreakers.set(e,s)),s.failures++,s.lastFailureTime=Date.now(),s.failures>=this.config.circuitBreakerThreshold&&(s.state="open",this.log(`üö® Circuit breaker opened for operation: ${e}`))}recordFailure(e){this.failureHistory.push(e),this.failureHistory.length>500&&(this.failureHistory=this.failureHistory.slice(-250))}getMaxAttempts(e){const s=["extract-data","ai-review"],n=["navigate","activate-patient"];return s.some(a=>e.includes(a))?5:n.some(a=>e.includes(a))?3:2}async attemptGracefulDegradation(e,s){switch(this.log(`üîÑ Attempting graceful degradation for ${e.operation}`),e.operation){case"extract-data":return{background:"[Data extraction failed - manual review required]",investigations:"[Data extraction failed]",medications:"[Data extraction failed]"};case"ai-review":return{summary:"[AI review failed - manual review required]",findings:[],recommendations:[]};default:return null}}getDefaultConfig(){return{strategy:"conservative",maxTotalRetries:10,circuitBreakerThreshold:5,circuitBreakerResetTime:3e5,enableGracefulDegradation:!0,userNotificationEnabled:!0}}async sleep(e){return new Promise(s=>setTimeout(s,e))}log(...e){this.debugMode&&console.log("[ErrorRecoveryManager]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}clearHistory(){this.failureHistory=[],this.circuitBreakers.clear()}addCustomStrategy(e,s){this.strategies.set(e,s)}}class Rs{static instance;config;storagePrefix="batch_checkpoint_";backupPrefix="backup_checkpoint_";debugMode=!1;constructor(){this.config=this.getDefaultConfig()}static getInstance(){return Rs.instance||(Rs.instance=new Rs),Rs.instance}async saveCheckpoint(e,s,n,a,i,o,A,l){const c=this.generateCheckpointId(e),d=Date.now();this.log(`üíæ Saving checkpoint: ${c}`);const m={lastSuccessfulOperation:this.getLastSuccessfulOperation(n),skippedPatients:this.getSkippedPatients(n),retryQueue:this.buildRetryQueue(i),environmentState:l},g={id:c,batchId:e,timestamp:d,version:"1.0.0",totalPatients:s.selectedPatients.length,completedPatients:n,currentPatientIndex:a,failedAttempts:i,configuration:o,performanceMetrics:A,resumeData:m,integrityHash:""};g.integrityHash=await this.calculateIntegrityHash(g);try{const h=this.config.compressionEnabled?await this.compressData(g):JSON.stringify(g),p=this.config.encryptionEnabled?await this.encryptData(h):h,b=this.storagePrefix+c;if(await this.saveToStorage(b,p),this.config.backupEnabled){const N=this.backupPrefix+c;await this.saveToStorage(N,p)}return this.log(`‚úÖ Checkpoint saved successfully: ${c}`),await this.cleanupOldCheckpoints(e),c}catch(h){throw this.log("‚ùå Failed to save checkpoint:",h),new Error(`Checkpoint save failed: ${h instanceof Error?h.message:String(h)}`)}}async loadCheckpoint(e){this.log(`üìÇ Loading checkpoint: ${e}`);try{let s=await this.loadFromStorage(this.storagePrefix+e);if(!s&&this.config.backupEnabled&&(this.log("‚ö†Ô∏è Primary checkpoint not found, trying backup"),s=await this.loadFromStorage(this.backupPrefix+e)),!s)throw new Error(`Checkpoint not found: ${e}`);const n=this.config.encryptionEnabled?await this.decryptData(s):s,a=this.config.compressionEnabled?await this.decompressData(n):JSON.parse(n);if(this.config.integrityChecking&&!await this.validateIntegrity(a))throw new Error("Checkpoint integrity validation failed");const i=this.validateCheckpointStructure(a);if(!i.isValid)throw new Error(`Invalid checkpoint structure: ${i.errors.join(", ")}`);return this.log(`‚úÖ Checkpoint loaded successfully: ${e}`),a}catch(s){throw this.log("‚ùå Failed to load checkpoint:",s),new Error(`Checkpoint load failed: ${s instanceof Error?s.message:String(s)}`)}}async resumeFromCheckpoint(e,s,n={}){this.log(`üîÑ Resuming from checkpoint: ${e}`);const a=await this.loadCheckpoint(e),i={skipFailedPatients:!1,retryFailedPatients:!0,validateEnvironment:!0,allowConfigChanges:!0,resumeFromLastSuccessful:!0,...n},o=[];if(i.validateEnvironment){const l=await this.validateEnvironment(a.resumeData.environmentState);if(!l.isValid&&(o.push(`Environment validation warnings: ${l.warnings.join(", ")}`),l.errors.length>0))throw new Error(`Environment validation failed: ${l.errors.join(", ")}`)}if(s){if(!i.allowConfigChanges)throw new Error("Configuration changes not allowed during resume");const l=this.compareConfigurations(a.configuration,s);l.hasSignificantChanges&&o.push(`Significant configuration changes detected: ${l.changes.join(", ")}`),a.configuration={...a.configuration,...s}}const A=this.determineResumeStrategy(a,i);return a.resumeData.lastSuccessfulOperation=`resumed_from_checkpoint_${Date.now()}`,this.log("‚úÖ Resume strategy determined:",A),{checkpoint:a,resumeStrategy:A,warnings:o}}async listCheckpoints(e){try{const n=await chrome.storage.local.get(null),a=[];for(const[i,o]of Object.entries(n))if(i.startsWith(this.storagePrefix))try{const A=await this.extractCheckpointInfo(i,o);(!e||A.batchId===e)&&a.push(A)}catch(A){this.log(`‚ö†Ô∏è Error reading checkpoint ${i}:`,A)}return a.sort((i,o)=>o.timestamp-i.timestamp),a}catch(s){return this.log("‚ùå Failed to list checkpoints:",s),[]}}async deleteCheckpoint(e){try{const s=chrome.storage.local,n=[this.storagePrefix+e,this.backupPrefix+e];await s.remove(n),this.log(`üóëÔ∏è Checkpoint deleted: ${e}`)}catch(s){throw this.log("‚ùå Failed to delete checkpoint:",s),new Error(`Checkpoint deletion failed: ${s instanceof Error?s.message:String(s)}`)}}async cleanupOldCheckpoints(e){try{const s=await this.listCheckpoints(e);if(s.length<=this.config.maxCheckpoints)return 0;const n=s.slice(this.config.maxCheckpoints);let a=0;for(const i of n)try{await this.deleteCheckpoint(i.id),a++}catch(o){this.log(`‚ö†Ô∏è Failed to delete old checkpoint ${i.id}:`,o)}return this.log(`üßπ Cleaned up ${a} old checkpoints`),a}catch(s){return this.log("‚ùå Cleanup failed:",s),0}}generateCheckpointId(e){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async calculateIntegrityHash(e){const s={...e};delete s.integrityHash;const n=JSON.stringify(s),i=new TextEncoder().encode(n),o=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(o)).map(l=>l.toString(16).padStart(2,"0")).join("")}async validateIntegrity(e){const s=e.integrityHash,n=await this.calculateIntegrityHash(e);return s===n}validateCheckpointStructure(e){const s=[],n=[],a=["id","batchId","timestamp","version","totalPatients","completedPatients","currentPatientIndex"];for(const i of a)(e[i]===void 0||e[i]===null)&&s.push(`Missing required field: ${i}`);return typeof e.currentPatientIndex!="number"&&s.push("currentPatientIndex must be a number"),Array.isArray(e.completedPatients)||s.push("completedPatients must be an array"),(e.currentPatientIndex<0||e.currentPatientIndex>e.totalPatients)&&n.push("currentPatientIndex seems out of bounds"),e.version!=="1.0.0"&&n.push(`Checkpoint version ${e.version} may not be fully compatible`),{isValid:s.length===0,errors:s,warnings:n,score:s.length===0?1:0}}async validateEnvironment(e){const s=[],n=[];try{if(e.tabId)try{await chrome.tabs.get(e.tabId)}catch{n.push("Original tab no longer exists")}if(e.currentUrl)try{new URL(e.currentUrl)}catch{n.push("Current URL appears invalid")}e.contentScriptVersion&&n.push("Content script version compatibility not verified"),Date.now()-e.lastHealthCheck>36e5&&n.push("Environment state is quite old (>1 hour)")}catch(a){s.push(`Environment validation error: ${a}`)}return{isValid:s.length===0,errors:s,warnings:n,score:s.length===0?1:0}}compareConfigurations(e,s){const n=[],a=["maxRetries","timeoutMs","errorRecoveryStrategy"];for(const[o,A]of Object.entries(s)){const l=e[o];l!==A&&n.push(`${o}: ${l} ‚Üí ${A}`)}return{hasSignificantChanges:n.some(o=>a.some(A=>o.startsWith(A))),changes:n}}determineResumeStrategy(e,s){const n={startIndex:e.currentPatientIndex,skipPatients:[],retryPatients:[],forceReprocessPatients:[],resumeMode:"continue"};if(s.resumeFromLastSuccessful){const a=this.findLastSuccessfulPatientIndex(e.completedPatients);n.startIndex=Math.max(a+1,e.currentPatientIndex)}return s.skipFailedPatients?n.skipPatients=e.failedAttempts.map(a=>a.patientIndex):s.retryFailedPatients&&(n.retryPatients=e.failedAttempts.map(a=>a.patientIndex)),n.retryPatients.length>0?n.resumeMode="retry_failed":n.skipPatients.length>0?n.resumeMode="skip_failed":n.resumeMode="continue",n}getLastSuccessfulOperation(e){const s=e.filter(a=>a.success);return s.length===0?"batch_start":`patient_completed_${s[s.length-1].patient.fileNumber}`}getSkippedPatients(e){const s=new Set(e.map((a,i)=>i)),n=[];for(let a=0;a<e.length;a++)s.has(a)||n.push(a);return n}buildRetryQueue(e){const s=[],n=new Map;for(const a of e){const i=n.get(a.patientIndex)||[];i.push(a),n.set(a.patientIndex,i)}for(const[a,i]of n){const o=i[i.length-1];s.push({patientIndex:a,patient:o.patient,lastError:o.error,retryCount:i.length,nextRetryTime:Date.now()+i.length*6e4})}return s}findLastSuccessfulPatientIndex(e){for(let s=e.length-1;s>=0;s--)if(e[s].success)return s;return-1}async extractCheckpointInfo(e,s){try{const n=e.replace(this.storagePrefix,"");let a;return this.config.encryptionEnabled?a={id:n,timestamp:0,batchId:"encrypted"}:this.config.compressionEnabled?a=await this.decompressData(s):a=JSON.parse(s),{id:a.id||n,batchId:a.batchId||"unknown",timestamp:a.timestamp||0,totalPatients:a.totalPatients||0,completedPatients:a.completedPatients?.length||0,currentIndex:a.currentPatientIndex||0,hasFailures:(a.failedAttempts?.length||0)>0}}catch(n){throw new Error(`Failed to extract checkpoint info: ${n}`)}}async saveToStorage(e,s){await chrome.storage.local.set({[e]:s})}async loadFromStorage(e){return(await chrome.storage.local.get(e))[e]||null}async compressData(e){return JSON.stringify(e).replace(/\s+/g,"").replace(/"completedPatients"/g,'"cp"').replace(/"currentPatientIndex"/g,'"ci"').replace(/"failedAttempts"/g,'"fa"').replace(/"timestamp"/g,'"ts"')}async decompressData(e){const s=e.replace(/"cp"/g,'"completedPatients"').replace(/"ci"/g,'"currentPatientIndex"').replace(/"fa"/g,'"failedAttempts"').replace(/"ts"/g,'"timestamp"');return JSON.parse(s)}async encryptData(e){return btoa(e)}async decryptData(e){return atob(e)}getDefaultConfig(){return{autoSaveInterval:5,maxCheckpoints:10,compressionEnabled:!0,encryptionEnabled:!1,integrityChecking:!0,backupEnabled:!0}}log(...e){this.debugMode&&console.log("[CheckpointManager]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}}class Ms{static instance;metrics;config;memorySnapshots=[];activeOperations=new Map;memoryMonitorInterval;debugMode=!1;constructor(){this.config=this.getDefaultConfig(),this.metrics=this.initializeMetrics(),this.startMemoryMonitoring()}static getInstance(){return Ms.instance||(Ms.instance=new Ms),Ms.instance}startSession(e){this.log(`üìä Starting metrics session: ${e}`),this.metrics=this.initializeMetrics(),this.metrics.sessionId=e,this.metrics.batchStartTime=Date.now(),this.config.enablePerformanceMarks&&performance.mark(`batch-start-${e}`)}endSession(){const e=Date.now();this.metrics.totalProcessingTime=e-this.metrics.batchStartTime,this.log(`üìä Ending metrics session: ${this.metrics.sessionId}`),this.config.enablePerformanceMarks&&(performance.mark(`batch-end-${this.metrics.sessionId}`),performance.measure(`batch-duration-${this.metrics.sessionId}`,`batch-start-${this.metrics.sessionId}`,`batch-end-${this.metrics.sessionId}`));const s=this.generateReport();return this.config.autoExport&&this.exportMetrics(s),s}startOperation(e,s,n){const a=Date.now();this.activeOperations.set(e,a),this.log(`‚è±Ô∏è Started operation: ${s} (${e})`),this.config.enablePerformanceMarks&&performance.mark(`op-start-${e}`)}endOperation(e,s,n,a,i){const o=Date.now(),A=this.activeOperations.get(e);if(!A)return this.log(`‚ö†Ô∏è No start time found for operation: ${e}`),this.createEmptyTiming(s,e);const l=o-A;this.activeOperations.delete(e);const c={operation:s,startTime:A,endTime:o,duration:l,success:n,patientIndex:a,metadata:i};switch(this.metrics.operationTimings.push(c),s){case"patient-activation":this.metrics.patientActivationTimes.push(l);break;case"data-extraction":this.metrics.dataExtractionTimes.push(l);break;case"ai-review":this.metrics.aiReviewTimes.push(l);break;case"content-script-response":this.metrics.contentScriptResponseTimes.push(l);break}if(!n){const d=this.metrics.retryCount.get(s)||0;this.metrics.retryCount.set(s,d+1)}return this.log(`‚úÖ Completed operation: ${s} in ${l}ms (success: ${n})`),this.config.enablePerformanceMarks&&(performance.mark(`op-end-${e}`),performance.measure(`op-duration-${e}`,`op-start-${e}`,`op-end-${e}`)),c}recordError(e,s,n){const a=this.classifyError(s),i=this.metrics.errorFrequency.get(a)||0;this.metrics.errorFrequency.set(a,i+1);const o=this.metrics.errorFrequency.get(e)||0;this.metrics.errorFrequency.set(e,o+1),this.log(`‚ùå Recorded error: ${a} in ${e} (patient ${n})`)}takeMemorySnapshot(){const e={timestamp:Date.now(),heapUsed:0,heapTotal:0,external:0};if(performance.memory){const s=performance.memory;e.heapUsed=s.usedJSHeapSize,e.heapTotal=s.totalJSHeapSize,e.external=s.usedJSHeapSize}return this.memorySnapshots.push(e),this.metrics.memoryUsageHistory.push(e),this.memorySnapshots.length>1e3&&(this.memorySnapshots=this.memorySnapshots.slice(-500)),e}getPerformanceIndicators(){const e=this.getRecentTimings(3e5),s=this.metrics.operationTimings.length,n=this.metrics.operationTimings.filter(g=>g.success).length,a=e.filter(g=>g.patientIndex!==void 0),i=a.length>0?a.reduce((g,h)=>g+h.duration,0)/a.length:0,o=s>0?n/s:1;let A="normal";i>0&&(i<3e4?A="fast":i<6e4?A="normal":i<12e4?A="slow":A="degraded");const l=Array.from(this.metrics.errorFrequency.values()).reduce((g,h)=>g+h,0),c=s>0?l/s:0,d=this.memorySnapshots[this.memorySnapshots.length-1],m=d?d.heapUsed/(1024*1024):0;return{averageTimePerPatient:i,successRate:o,currentSpeed:A,errorRate:c,memoryUsage:m}}generateReport(){const e=this.generateSummary(),s=this.analyzeTimings(),n=this.analyzeMemory(),a=this.analyzeErrors(),i=this.generateInsights(),o=this.generateRecommendations(i);return{summary:e,timingAnalysis:s,memoryAnalysis:n,errorAnalysis:a,performanceInsights:i,recommendations:o}}async exportMetrics(e){const s=new Date().toISOString().replace(/[:.]/g,"-"),n=`batch-metrics-${e.summary.sessionId}-${s}`;return this.config.exportFormat==="csv"?this.exportAsCSV(e,n):this.exportAsJSON(e,n)}generateSummary(){const e=new Set(this.metrics.operationTimings.filter(c=>c.patientIndex!==void 0).map(c=>c.patientIndex)).size,s=new Set(this.metrics.operationTimings.filter(c=>c.patientIndex!==void 0&&c.success).map(c=>c.patientIndex)).size,n=e-s,a=this.metrics.operationTimings.filter(c=>c.patientIndex!==void 0),i=a.length>0?a.reduce((c,d)=>c+d.duration,0)/a.length:0,o=e>0?s/e:0,A=this.metrics.totalProcessingTime/(1e3*60*60),l=A>0?e/A:0;return{sessionId:this.metrics.sessionId,totalDuration:this.metrics.totalProcessingTime,totalPatients:e,successfulPatients:s,failedPatients:n,averageTimePerPatient:i,successRate:o,throughputPatientsPerHour:l}}analyzeTimings(){const e=new Map,s=[];for(const o of this.metrics.operationTimings){s.push(o.duration);let A=e.get(o.operation);A||(A={operation:o.operation,count:0,totalTime:0,averageTime:0,minTime:1/0,maxTime:0,standardDeviation:0,successRate:0},e.set(o.operation,A)),A.count++,A.totalTime+=o.duration,A.minTime=Math.min(A.minTime,o.duration),A.maxTime=Math.max(A.maxTime,o.duration),o.success&&A.successRate++}for(const o of e.values()){o.averageTime=o.totalTime/o.count,o.successRate=o.successRate/o.count;const A=this.metrics.operationTimings.filter(c=>c.operation===o.operation).map(c=>c.duration),l=A.reduce((c,d)=>c+Math.pow(d-o.averageTime,2),0)/A.length;o.standardDeviation=Math.sqrt(l)}s.sort((o,A)=>o-A);const n={p50:this.getPercentile(s,50),p90:this.getPercentile(s,90),p95:this.getPercentile(s,95),p99:this.getPercentile(s,99)},a=this.identifyBottlenecks(e),i=this.determineCriticalPath(e);return{operationBreakdown:e,criticalPath:i,bottlenecks:a,percentiles:n}}analyzeMemory(){if(this.memorySnapshots.length<2)return{peakUsage:0,averageUsage:0,growthRate:0,leakDetection:[],gcImpact:0};const e=this.memorySnapshots.map(d=>d.heapUsed),s=Math.max(...e),n=e.reduce((d,m)=>d+m,0)/e.length,a=this.memorySnapshots[0],i=this.memorySnapshots[this.memorySnapshots.length-1],o=(i.timestamp-a.timestamp)/(1e3*60),A=(i.heapUsed-a.heapUsed)/(1024*1024),l=o>0?A/o:0,c=this.detectMemoryLeaks();return{peakUsage:s/(1024*1024),averageUsage:n/(1024*1024),growthRate:l,leakDetection:c,gcImpact:0}}analyzeErrors(){const e=Array.from(this.metrics.errorFrequency.values()).reduce((h,p)=>h+p,0),s=this.metrics.operationTimings.length,n=this.metrics.operationTimings.filter(h=>h.success).length,a=s>0?e/s:0,i=s>e?(n-(s-e))/e:0,o=new Map,A=new Map;for(const[h,p]of this.metrics.errorFrequency)this.isErrorType(h)?o.set(h,p):A.set(h,p);const l=this.metrics.operationTimings.filter(h=>!h.success),c=l.length>0?l.reduce((h,p)=>h+p.duration,0)/l.length:0,d=this.metrics.operationTimings.filter(h=>h.success),m=d.length>0?d.reduce((h,p)=>h+p.duration,0)/d.length:0,g=m>0?(c-m)/m:0;return{totalErrors:e,errorsByType:o,errorsByOperation:A,errorRate:a,recoveryRate:i,impactOnPerformance:g}}generateInsights(){const e=[],s=this.getPerformanceIndicators();return s.currentSpeed==="degraded"&&e.push({type:"warning",title:"Severely Degraded Performance",description:`Average processing time per patient is ${Math.round(s.averageTimePerPatient/1e3)}s, indicating severe performance issues.`,impact:"high",actionRequired:!0}),s.errorRate>.1&&e.push({type:"warning",title:"High Error Rate",description:`Error rate of ${Math.round(s.errorRate*100)}% is concerning and may indicate system issues.`,impact:"high",actionRequired:!0}),s.memoryUsage>500&&e.push({type:"warning",title:"High Memory Usage",description:`Memory usage of ${Math.round(s.memoryUsage)}MB is high and may cause performance issues.`,impact:"medium",actionRequired:!1}),s.successRate<.9&&e.push({type:"optimization",title:"Low Success Rate",description:`Success rate of ${Math.round(s.successRate*100)}% suggests opportunities for improvement.`,impact:"medium",actionRequired:!1}),e}generateRecommendations(e){const s=[];for(const n of e)switch(n.title){case"Severely Degraded Performance":s.push("Consider reducing batch size or increasing timeout values"),s.push("Check for network connectivity issues");break;case"High Error Rate":s.push("Review error logs to identify common failure patterns"),s.push("Consider implementing additional retry strategies");break;case"High Memory Usage":s.push("Implement more frequent garbage collection"),s.push("Reduce the number of concurrent operations");break;case"Low Success Rate":s.push("Improve error handling and recovery mechanisms"),s.push("Add more robust validation checks");break}return s}identifyBottlenecks(e){const s=[];for(const n of e.values()){let a="low",i="";n.averageTime>6e4?(a="critical",i="This operation is extremely slow and should be optimized immediately"):n.averageTime>3e4?(a="high",i="Consider optimizing this operation or implementing caching"):n.averageTime>15e3&&(a="medium",i="Monitor this operation for potential optimization opportunities"),a!=="low"&&s.push({operation:n.operation,averageTime:n.averageTime,impact:a,description:`${n.operation} takes an average of ${Math.round(n.averageTime/1e3)}s`,suggestion:i})}return s.sort((n,a)=>a.averageTime-n.averageTime)}determineCriticalPath(e){return Array.from(e.values()).sort((n,a)=>a.averageTime*a.count-n.averageTime*n.count).slice(0,5).map(n=>n.operation)}detectMemoryLeaks(){const e=[];if(this.memorySnapshots.length<10)return e;const s=this.memorySnapshots.slice(-10),n=[];for(let i=1;i<s.length;i++){const o=s[i].heapUsed-s[i-1].heapUsed;n.push(o)}const a=n.reduce((i,o)=>i+o,0)/n.length;return s[s.length-1].heapUsed-s[0].heapUsed,a>1024*1024&&e.push({suspected:!0,confidence:Math.min(a/(5*1024*1024),1),description:"Consistent memory growth detected",growthPattern:"linear"}),e}getPercentile(e,s){const n=Math.ceil(s/100*e.length)-1;return e[Math.max(0,Math.min(n,e.length-1))]||0}getRecentTimings(e){const s=Date.now()-e;return this.metrics.operationTimings.filter(n=>n.startTime>=s)}classifyError(e){const s=e.toLowerCase();return s.includes("timeout")?"timeout":s.includes("network")?"network":s.includes("permission")?"permission":s.includes("not found")?"not_found":s.includes("memory")?"memory":"unknown"}isErrorType(e){return["timeout","network","permission","not_found","memory","unknown"].includes(e)}createEmptyTiming(e,s){return{operation:e,startTime:Date.now(),endTime:Date.now(),duration:0,success:!1,metadata:{error:"No start time found",operationId:s}}}async exportAsJSON(e,s){const n=JSON.stringify(e,null,2);if(typeof window<"u"){const a=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=`${s}.json`,o.click(),URL.revokeObjectURL(i)}return n}async exportAsCSV(e,s){const n=[];n.push("Category,Metric,Value,Unit"),n.push(`Summary,Session ID,${e.summary.sessionId},`),n.push(`Summary,Total Duration,${e.summary.totalDuration},ms`),n.push(`Summary,Total Patients,${e.summary.totalPatients},count`),n.push(`Summary,Success Rate,${e.summary.successRate},percentage`),n.push(`Summary,Avg Time Per Patient,${e.summary.averageTimePerPatient},ms`);for(const[i,o]of e.timingAnalysis.operationBreakdown)n.push(`Timing,${i} Count,${o.count},count`),n.push(`Timing,${i} Avg Time,${o.averageTime},ms`),n.push(`Timing,${i} Success Rate,${o.successRate},percentage`);n.push(`Memory,Peak Usage,${e.memoryAnalysis.peakUsage},MB`),n.push(`Memory,Average Usage,${e.memoryAnalysis.averageUsage},MB`),n.push(`Memory,Growth Rate,${e.memoryAnalysis.growthRate},MB/min`);const a=n.join(`
`);if(typeof window<"u"){const i=new Blob([a],{type:"text/csv"}),o=URL.createObjectURL(i),A=document.createElement("a");A.href=o,A.download=`${s}.csv`,A.click(),URL.revokeObjectURL(o)}return a}startMemoryMonitoring(){this.config.enableMemoryTracking&&(this.memoryMonitorInterval=setInterval(()=>{this.takeMemorySnapshot()},this.config.sampleInterval))}stopMemoryMonitoring(){this.memoryMonitorInterval&&(clearInterval(this.memoryMonitorInterval),this.memoryMonitorInterval=void 0)}initializeMetrics(){return{sessionId:"",batchStartTime:0,patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}getDefaultConfig(){return{enableDetailedTiming:!0,enableMemoryTracking:!0,enablePerformanceMarks:!0,sampleInterval:5e3,retentionPeriod:36e5,exportFormat:"json",autoExport:!1}}log(...e){this.debugMode&&console.log("[MetricsCollector]",...e)}setDebugMode(e){this.debugMode=e}updateConfig(e){Object.assign(this.config,e),(e.sampleInterval!==void 0||e.enableMemoryTracking!==void 0)&&(this.stopMemoryMonitoring(),this.startMemoryMonitoring())}getConfig(){return{...this.config}}getMetrics(){return{...this.metrics}}clearMetrics(){this.metrics=this.initializeMetrics(),this.memorySnapshots=[],this.activeOperations.clear()}cleanup(){this.stopMemoryMonitoring(),this.clearMetrics()}}class Ou{batchPatientReviewAgent;dynamicWait;dataValidation;errorRecovery;cacheManager;checkpointManager;metricsCollector;isProcessing=!1;abortController=null;currentBatchId=null;config;currentProcessingContext=null;constructor(e={}){this.batchPatientReviewAgent=null,this.dynamicWait=ks.getInstance(),this.dataValidation=Ps.getInstance(),this.errorRecovery=Ds.getInstance(),this.cacheManager=Km.getInstance(),this.checkpointManager=Rs.getInstance(),this.metricsCollector=Ms.getInstance(),this.config=this.getDefaultConfig(),this.updateConfig(e),this.log("üöÄ Enhanced Batch AI Review Orchestrator initialized")}async loadAgent(){if(!this.batchPatientReviewAgent){const{BatchPatientReviewAgent:e}=await $e(async()=>{const{BatchPatientReviewAgent:s}=await import("./chunks/BatchPatientReviewAgent.Dj2BLS7n.js");return{BatchPatientReviewAgent:s}},__vite__mapDeps([14,7,8,4,2,1,15]));this.batchPatientReviewAgent=new e}}async processBatch(e,s){if(this.isProcessing)throw new Error("Batch processing already in progress");this.isProcessing=!0,this.abortController=new AbortController,this.currentBatchId=this.generateBatchId(e);const n=Date.now(),a=[],i=[];this.log(`üîÑ Starting enhanced batch AI review for ${e.selectedPatients.length} patients`);try{const o=await this.getCurrentTabId();this.log("üìÖ Ensuring we're on the appointment book page...");const A=await this.sendMessageWithTimeout(o,{type:"EXECUTE_ACTION",action:"navigate-to-appointment-book",data:{}},1e4);A?.success?this.log("‚úÖ Confirmed on appointment book page"):this.log(`‚ö†Ô∏è Warning: Could not ensure appointment book state: ${A?.error||"Unknown error"}`),await new Promise(l=>setTimeout(l,1e3))}catch(o){this.log("‚ö†Ô∏è Warning: Failed to navigate to appointment book:",o)}this.config.enableMetrics&&this.metricsCollector.startSession(this.currentBatchId),this.config.enableCaching&&await this.cacheManager.warmup(e.selectedPatients);try{const o=await this.checkForResumableCheckpoint(this.currentBatchId);let A=0;o&&await this.handleResumeOption(o,s)&&(a.push(...o.completedPatients),A=o.currentPatientIndex,this.log(`üìÇ Resuming from checkpoint at patient ${A}`));const l=e.selectedPatients.slice(A);if(this.config.parallelProcessing&&l.length>1){this.log(`üöÄ Using PARALLEL processing for ${l.length} patients (max ${this.config.maxConcurrentOperations} concurrent)`);const m=await this.processPatientsBatchParallel(l,A,s,n);a.push(...m.results),i.push(...m.errors)}else{this.log(`üîÑ Using SEQUENTIAL processing for ${l.length} patients`);for(let m=0;m<l.length;m++){const g=l[m],h=A+m;if(this.abortController?.signal.aborted)throw this.log("üõë Batch processing was cancelled by user"),new Error("Batch processing was cancelled");await this.validateAppointmentBookState(g,h);const p=this.createEnhancedProgress(h,e.selectedPatients.length,g,a,i,n);s?.(p);try{this.log(`üß≠ Processing patient ${h+1}/${e.selectedPatients.length}: ${g.name}`);const b=await this.processIndividualPatientEnhanced(g,h,(N,y)=>{p.phase=N,p.subPhase=y,s?.(p)});a.push(b),this.log(`‚úÖ Completed patient ${h+1}: ${g.name}`),this.config.enableCheckpoints&&(h+1)%this.config.checkpointInterval===0&&await this.saveProgressCheckpoint(e,a,h+1,i,n)}catch(b){const N=b instanceof Error?b.message:"Unknown error";this.log(`‚ùå Failed to process patient ${g.name}:`,N),this.config.enableMetrics&&this.metricsCollector.recordError("patient-processing",N,h),a.push({patient:g,reviewReport:null,extractedData:{background:"",investigations:"",medications:""},processingTime:0,success:!1,error:N}),i.push(`${g.name}: ${N}`);const y=i.length/(h+1);if(y>.5&&i.length>3)throw this.log(`üö® High error rate detected (${Math.round(y*100)}%), stopping batch`),new Error(`Batch stopped due to high error rate: ${Math.round(y*100)}%`)}}}const c=this.createEnhancedProgress(e.selectedPatients.length,e.selectedPatients.length,null,a,i,n);c.phase="completed",s?.(c);const d=await this.generateEnhancedBatchReport(e,a,n,Date.now());this.log(`üéâ Batch processing completed: ${a.filter(m=>m.success).length}/${e.selectedPatients.length} successful`);try{const m=Date.now()-n,g=a.filter(b=>b.success).length,h=e.selectedPatients.length,p=`${g}/${h} patients processed successfully`;await Oc.showCompletionNotification("batch-ai-review",m,p),console.log(`üîî Batch completion notification sent: ${g}/${h} patients (${m}ms)`)}catch(m){console.warn("Failed to send batch completion notification:",m)}return d}catch(o){this.log("‚ùå Batch processing failed:",o);const A=this.createEnhancedProgress(0,e.selectedPatients.length,null,a,[...i,o instanceof Error?o.message:"Unknown error"],n);throw A.phase="error",s?.(A),o}finally{await this.finalizeProcessing()}}async resumeFromCheckpoint(e,s){this.log(`üîÑ Resuming batch processing from checkpoint: ${e}`);const{checkpoint:n,resumeStrategy:a,warnings:i}=await this.checkpointManager.resumeFromCheckpoint(e);for(const A of i)this.log(`‚ö†Ô∏è Resume warning: ${A}`);const o={selectedPatients:[],appointmentDate:new Date().toISOString(),calendarUrl:n.resumeData.environmentState?.currentUrl||""};return this.processBatch(o,s)}cancelProcessing(){this.abortController&&(this.abortController.abort(),this.log("üõë Batch processing cancelled by user"))}isCurrentlyProcessing(){return this.isProcessing}getProcessingStats(){return{isProcessing:this.isProcessing,currentBatchId:this.currentBatchId,performanceIndicators:this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():null,cacheStats:this.config.enableCaching?this.cacheManager.getStats():null,errorStats:this.errorRecovery.getFailureStats()}}async processPatientsBatchParallel(e,s,n,a){const i=[],o=[];this.log(`üöÄ Starting parallel batch processing for ${e.length} patients`),this.log(`üìä PHASE 1: Collecting data from all ${e.length} patients...`);const A=[];for(let d=0;d<e.length;d++){const m=e[d],g=s+d;if(this.abortController?.signal.aborted)throw new Error("Batch processing was cancelled");n?.({currentPatientIndex:g,totalPatients:e.length,currentPatient:m,phase:"extracting",subPhase:`collecting-data-${d+1}/${e.length}`,completedPatients:[],errors:[],percentComplete:d/e.length*50,estimatedTimeRemaining:0,currentOperationDetails:`Collecting data from ${m.name}`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}});try{await this.validateAppointmentBookState(m,g);const h=await this.getCurrentTabId(),p=await this.extractPatientDataEnhanced(h,m);A.push({patient:m,extractedData:p,patientIndex:g,success:!0}),this.log(`‚úÖ Phase 1: Collected data for ${m.name} (${d+1}/${e.length})`)}catch(h){const p=h instanceof Error?h.message:"Unknown error";this.log(`‚ùå Phase 1: Failed to collect data for ${m.name}: ${p}`),A.push({patient:m,extractedData:{background:"",investigations:"",medications:"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:0},patientIndex:g,success:!1,error:p}),o.push(`${m.name}: ${p}`)}}this.log(`üìä PHASE 1 COMPLETE: Collected data from ${A.length} patients`),this.log(`ü§ñ PHASE 2: Processing AI reviews in parallel (max ${this.config.maxConcurrentOperations} concurrent)...`);const l=A.filter(d=>d.success),c=this.chunkArray(l,this.config.maxConcurrentOperations);for(const d of c){const m=d.map(async(h,p)=>{try{const b=50+i.length/e.length*50;n?.({currentPatientIndex:h.patientIndex,totalPatients:e.length,currentPatient:h.patient,phase:"reviewing",subPhase:"ai-processing-parallel",completedPatients:i,errors:[],percentComplete:b,estimatedTimeRemaining:0,currentOperationDetails:`AI review: ${h.patient.name} (parallel)`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}}),this.log(`ü§ñ Processing AI review for ${h.patient.name} (parallel batch)`);const N=await this.performAIReviewWithCaching(h.extractedData,h.patient),y={patient:h.patient,reviewReport:N,extractedData:h.extractedData,processingTime:0,success:!0};return this.log(`‚úÖ Completed AI review for ${h.patient.name}`),y}catch(b){const N=b instanceof Error?b.message:"Unknown error";this.log(`‚ùå AI review failed for ${h.patient.name}: ${N}`);const y={patient:h.patient,reviewReport:null,extractedData:h.extractedData,processingTime:0,success:!1,error:N};return o.push(`${h.patient.name}: ${N}`),y}}),g=await Promise.allSettled(m);for(const h of g)h.status==="fulfilled"&&i.push(h.value);this.log(`‚úÖ Completed AI processing chunk: ${i.filter(h=>h.success).length}/${i.length} successful`)}for(const d of A.filter(m=>!m.success))i.push({patient:d.patient,reviewReport:null,extractedData:d.extractedData,processingTime:0,success:!1,error:d.error});return this.log(`üéâ PARALLEL PROCESSING COMPLETE: ${i.filter(d=>d.success).length}/${i.length} patients successful`),{results:i,errors:o}}chunkArray(e,s){const n=[];for(let a=0;a<e.length;a+=s)n.push(e.slice(a,a+s));return n}async processIndividualPatientEnhanced(e,s,n){const a=Date.now();this.currentProcessingContext={patient:e};const i={operation:"process-patient",patientIndex:s,patient:e,timestamp:a,environmentState:await this.getCurrentEnvironmentState(),previousAttempts:0};try{const o=`patient-${s}`;this.config.enableMetrics&&this.metricsCollector.startOperation(o,"patient-processing",s),n?.("navigating","activating-patient"),this.log(`üñ±Ô∏è Activating patient ${s}: ${e.name} (${e.fileNumber})`),await this.errorRecovery.executeWithRecovery(()=>this.activatePatientWithIntelligentWaiting(s),{...i,operation:"patient-activation"}),n?.("waiting-for-load","patient-data-loading");const A=await this.getCurrentTabId(),l=await this.dynamicWait.waitForPatientDataLoad(A,e.name);if(!l.success)throw new Error(`Patient data failed to load: ${l.error}`);n?.("extracting","clinical-data-extraction"),this.log(`üìã Extracting clinical data for: ${e.name}`);const c=await this.errorRecovery.executeWithRecovery(()=>this.extractPatientDataEnhanced(A,e),{...i,operation:"data-extraction"});n?.("reviewing","ai-medical-review"),c.dataCompleteness&&!c.dataCompleteness.hasRealData?this.log(`ü§ñ Running AI review for ${e.name} (incomplete data - ${c.dataCompleteness.emptyFieldCount}/${c.dataCompleteness.totalFields} fields empty)`):this.log(`ü§ñ Running AI review for: ${e.name}`);const d=await this.errorRecovery.executeWithRecovery(()=>this.performAIReviewWithCaching(c,e),{...i,operation:"ai-review"}),m=Date.now()-a;return this.config.enableMetrics&&this.metricsCollector.endOperation(o,"patient-processing",!0,s,{processingTime:m,dataQuality:c.qualityScore}),{patient:e,reviewReport:d,extractedData:c,processingTime:m,success:!0}}catch(o){const A=Date.now()-a;throw this.log(`‚ùå Failed to process patient ${e.name}:`,o),this.config.enableMetrics&&this.metricsCollector.endOperation(`patient-${s}`,"patient-processing",!1,s,{processingTime:A,error:o instanceof Error?o.message:String(o)}),o}finally{this.currentProcessingContext=null}}async activatePatientWithIntelligentWaiting(e){const s=await this.getCurrentTabId(),n=this.getCurrentProcessingContext();if(!n?.patient)throw new Error("No patient context available for activation");const a=n.patient;try{this.log(`üëÜ SPA Workflow: Starting patient processing for ${a.name} (${a.fileNumber})`),this.log(`üëÜ Step 1: Double-clicking patient ${a.name}`);const i=await this.sendMessageWithTimeout(s,{type:"EXECUTE_ACTION",action:"double-click-patient",data:{patientName:a.name,patientId:a.fileNumber}},1e4);if(!i?.success)throw new Error(`Double-click patient failed: ${i?.error||"Unknown error"}`);this.log("üè• Step 2: Navigating to Patient Record view");const o=await this.sendMessageWithTimeout(s,{type:"EXECUTE_ACTION",action:"navigate-to-patient-record",data:{}},15e3);if(!o?.success)throw new Error(`Navigate to patient record failed: ${o?.error||"Unknown error"}`);await this.waitForPatientDataReady(s,a.name),this.log(`‚úÖ SPA Workflow: Patient ${a.name} activated and Patient Record view ready`)}catch(i){throw this.log("‚ùå SPA Workflow activation failed:",i),new Error(`SPA patient activation failed: ${i instanceof Error?i.message:"Unknown error"}`)}}getCurrentProcessingContext(){return this.currentProcessingContext||null}async waitForPatientDataReady(e,s){this.log(`‚è≥ Waiting for patient data to load for: ${s}`);for(let i=0;i<30;i++)try{const o=await this.sendMessageWithTimeout(e,{type:"CHECK_XESTRO_BOXES"},3e3);if(o?.found&&o.count>0){this.log(`‚úÖ Patient data ready after ${(i+1)*500}ms (${o.count} XestroBoxes found)`),await this.sleep(1e3);return}i%5===0&&this.log(`‚è≥ Still waiting for patient data... (attempt ${i+1}/30, ${o?.count||0} XestroBoxes)`),await this.sleep(500)}catch(o){if(this.log(`‚ùå Error checking patient data readiness (attempt ${i+1}):`,o),o instanceof Error&&o.message.includes("message channel")?(this.log("üîß Message channel error detected, waiting longer before retry..."),await this.sleep(500*2)):await this.sleep(500),i===29)throw new Error(`Patient data failed to load after ${30*500}ms: ${o instanceof Error?o.message:"Unknown error"}`)}throw new Error(`Patient data did not load within ${30*500}ms for patient: ${s}`)}async sleep(e){return new Promise(s=>setTimeout(s,e))}async sendMessageWithTimeout(e,s,n=5e3){return new Promise((a,i)=>{const o=setTimeout(()=>{i(new Error(`Message timeout after ${n}ms`))},n);try{chrome.tabs.sendMessage(e,s,A=>{if(clearTimeout(o),chrome.runtime.lastError){i(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}a(A)})}catch(A){clearTimeout(o),i(A)}})}async extractPatientDataEnhanced(e,s){if(this.config.enableCaching){const n={patientId:s.fileNumber,dataType:"extracted_data"},a=await this.cacheManager.get(n);if(a.hit&&a.data)return this.log(`üíæ Using cached data for patient: ${s.name}`),await this.navigateBackToAppointmentBook(e),a.data}try{this.log(`üìã Step 3: Extracting patient fields for ${s.name}`);const n=await this.sendMessageWithTimeout(e,{type:"EXECUTE_ACTION",action:"extract-patient-fields",data:{}},3e4);if(!n?.success||!n?.data)throw new Error(`Patient fields extraction failed: ${n?.error||"No data returned"}`);const a=n.data,i=a.hasAnyData;this.log(`üìä Data completeness check for ${s.name}:`,{hasAnyData:i,backgroundLength:a.background?.length||0,investigationsLength:a.investigations?.length||0,medicationsLength:a.medications?.length||0});const o=a.background?.trim()?a.background:"No data available in Background section",A=a.investigations?.trim()?a.investigations:"No data available in Investigations section",l=a.medications?.trim()?a.medications:"No data available in Medications section";this.log(`üìù Processed field data for ${s.name}:`,{backgroundMarked:!a.background?.trim(),investigationsMarked:!a.investigations?.trim(),medicationsMarked:!a.medications?.trim(),hasAnyRealData:i});const c={background:o,investigations:A,medications:l,extractionTimestamp:a.extractionTimestamp||Date.now(),extractionAttempts:1,qualityScore:this.calculateDataQuality(a),dataCompleteness:{hasRealData:i,emptyFieldCount:[!a.background?.trim(),!a.investigations?.trim(),!a.medications?.trim()].filter(Boolean).length,totalFields:3}};if(await this.navigateBackToAppointmentBook(e),this.config.enableCaching){const d={patientId:s.fileNumber,dataType:"extracted_data"},m=this.dataValidation.assessDataQuality(c);await this.cacheManager.set(d,c,m)}return this.log(`‚úÖ SPA Workflow: Patient ${s.name} data extraction completed and returned to appointment book`),c}catch(n){this.log("‚ùå SPA Workflow extraction failed:",n);try{await this.navigateBackToAppointmentBook(e)}catch(a){this.log("‚ùå Failed to navigate back to appointment book:",a)}throw new Error(`SPA data extraction failed: ${n instanceof Error?n.message:"Unknown error"}`)}}async navigateBackToAppointmentBook(e){this.log("üìÖ Step 4: Navigating back to Appointment Book");const s=await this.sendMessageWithTimeout(e,{type:"EXECUTE_ACTION",action:"navigate-to-appointment-book",data:{}},15e3);if(!s?.success)throw new Error(`Navigate to appointment book failed: ${s?.error||"Unknown error"}`)}calculateDataQuality(e){let s=0,n=0;return["background","investigations","medications"].forEach(i=>{n++;const o=e[i]||"";o.trim().length>0&&(s+=1,o.trim().length>50&&(s+=.5))}),Math.min(s/(n*1.5),1)}async performAIReviewWithCaching(e,s){if(this.config.enableCaching){const i={patientId:s.fileNumber,dataType:"ai_review"},o=await this.cacheManager.get(i);if(o.hit&&o.data&&!await this.cacheManager.hasChanged({patientId:s.fileNumber,dataType:"extracted_data"},e))return this.log(`üíæ Using cached AI review for patient: ${s.name}`),o.data}const n=this.formatReviewInput(e,s);await this.loadAgent();const a=await this.batchPatientReviewAgent.process(n);if(this.config.enableCaching){const i={patientId:s.fileNumber,dataType:"ai_review"};await this.cacheManager.set(i,a)}return a}createEnhancedProgress(e,s,n,a,i,o){const l=Date.now()-o,c=a.filter(b=>b.success).length,d=e>0?l/e:0,g=(s-e)*d,h=s>0?e/s*100:0,p=this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():{averageTimePerPatient:d,successRate:e>0?c/e:1,currentSpeed:"normal",errorRate:e>0?i.length/e:0,memoryUsage:0};return{currentPatientIndex:e,totalPatients:s,currentPatient:n,phase:"navigating",completedPatients:a,errors:i,percentComplete:h,estimatedTimeRemaining:g,currentOperationDetails:n?`Processing ${n.name} (${n.fileNumber})`:"Initializing...",performanceIndicators:p}}async generateEnhancedBatchReport(e,s,n,a){const i=s.filter(h=>h.success),o=s.filter(h=>!h.success);let A=null;this.config.enableMetrics&&(A=this.metricsCollector.endSession());let l=0,c=0,d=0;const m=[];return i.forEach(h=>{if(h.reviewReport?.reviewData){const p=h.reviewReport.reviewData;l+=p.findings?.length||0,c+=p.findings?.filter(b=>b.urgency==="Immediate").length||0,d+=p.medicationSafetyIssues||0,p.findings?.forEach(b=>{b.finding&&!m.includes(b.finding)&&m.push(b.finding)})}}),{id:`batch-${Date.now()}`,agentName:"Enhanced Batch AI Review Orchestrator v3.0",content:`Enhanced batch AI medical review completed for ${e.selectedPatients.length} patients on ${e.appointmentDate}`,sections:[],metadata:{confidence:i.length/e.selectedPatients.length,processingTime:a-n,modelUsed:"BatchPatientReviewAgent",enhancedFeatures:{intelligentWaiting:!0,dataValidation:!0,errorRecovery:!0,caching:this.config.enableCaching,checkpointing:this.config.enableCheckpoints,metrics:this.config.enableMetrics}},timestamp:a,warnings:o.map(h=>`Failed to process ${h.patient.name}: ${h.error}`),errors:o.map(h=>h.error||"Unknown error"),batchData:{appointmentDate:e.appointmentDate,totalPatients:e.selectedPatients.length,successfulReviews:i.length,failedReviews:o.length,processingStartTime:n,processingEndTime:a,patientResults:s,summary:{totalFindings:l,immediateFindings:c,medicationSafetyIssues:d,commonFindings:m.slice(0,10)},enhancedMetrics:A}}}async checkForResumableCheckpoint(e){if(!this.config.enableCheckpoints)return null;try{const s=await this.checkpointManager.listCheckpoints(e);if(s.length>0){const n=s[0];return this.log(`üìÇ Found resumable checkpoint: ${n.id}`),await this.checkpointManager.loadCheckpoint(n.id)}}catch(s){this.log("‚ùå Error checking for resumable checkpoint:",s)}return null}async handleResumeOption(e,s){return this.log(`üîÑ Auto-resuming from checkpoint with ${e.completedPatients.length} completed patients`),!0}async saveProgressCheckpoint(e,s,n,a,i){if(!(!this.config.enableCheckpoints||!this.currentBatchId))try{const o=await this.getCurrentEnvironmentState(),A=this.config.enableMetrics?this.metricsCollector.getMetrics():this.createEmptyMetrics(),l=await this.checkpointManager.saveCheckpoint(this.currentBatchId,e,s,n,[],this.getBatchConfiguration(),A,o);this.log(`üíæ Saved checkpoint: ${l} (${s.length} patients completed)`)}catch(o){this.log("‚ùå Failed to save checkpoint:",o)}}async getCurrentTabId(){const e=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e[0]?.id)throw new Error("No active tab found");return e[0].id}async getCurrentEnvironmentState(){const e=await chrome.tabs.query({active:!0,currentWindow:!0});return{tabId:e[0]?.id||0,currentUrl:e[0]?.url||"",contentScriptVersion:"2.6.0",lastHealthCheck:Date.now()}}formatReviewInput(e,s){let n="";if(e.dataCompleteness){const{hasRealData:a,emptyFieldCount:i,totalFields:o}=e.dataCompleteness;a?i>0&&(n=`

DATA COMPLETENESS NOTE: ${i}/${o} clinical sections are incomplete. Consider if missing information is clinically significant.`):n=`

DATA COMPLETENESS ALERT: This patient record has ${i}/${o} empty clinical sections. Please assess if missing data represents a clinical oversight or if additional data collection is needed.`}return`Patient: ${s.name} (DOB: ${s.dob}, File: ${s.fileNumber})

Background: ${e.background}

Investigations: ${e.investigations}

Medications: ${e.medications}${n}`}generateBatchId(e){return`batch-${e.appointmentDate}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getBatchConfiguration(){return{maxRetries:this.config.retryAttempts,timeoutMs:this.config.timeoutMs,parallelProcessing:this.config.parallelProcessing,cacheEnabled:this.config.enableCaching,diagnosticsEnabled:this.config.enableAdvancedDiagnostics,checkpointInterval:this.config.checkpointInterval,errorRecoveryStrategy:"conservative"}}createEmptyMetrics(){return{sessionId:this.currentBatchId||"",batchStartTime:Date.now(),patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}async finalizeProcessing(){this.isProcessing=!1,this.abortController=null,this.currentBatchId=null,this.config.enableCaching&&await this.cacheManager.applyInvalidationRules(),this.log("üèÅ Batch processing finalized")}getDefaultConfig(){return{enableCheckpoints:!0,checkpointInterval:5,enableCaching:!0,enableMetrics:!0,enableAdvancedDiagnostics:!1,parallelProcessing:!0,maxConcurrentOperations:3,timeoutMs:3e5,retryAttempts:3}}updateConfig(e){Object.assign(this.config,e),this.dynamicWait.setDebugMode(e.enableAdvancedDiagnostics||!1),this.dataValidation.setDebugMode(e.enableAdvancedDiagnostics||!1),this.errorRecovery.setDebugMode(e.enableAdvancedDiagnostics||!1),this.cacheManager.setDebugMode(e.enableAdvancedDiagnostics||!1),this.checkpointManager.setDebugMode(e.enableAdvancedDiagnostics||!1),this.metricsCollector.setDebugMode(e.enableAdvancedDiagnostics||!1)}getConfig(){return{...this.config}}async validateAppointmentBookState(e,s){const n=await this.getCurrentTabId();this.log(`üîç Validating appointment book state for patient ${s}: ${e.name}`);try{const a=await this.sendMessageWithTimeout(n,{type:"EXECUTE_ACTION",action:"extract-calendar-patients",data:{}},1e4);if(!a?.success||!a?.data?.patients){this.log("‚ö†Ô∏è WARNING: Could not validate current patient list");return}const i=a.data.patients;if(this.log(`üîç Current appointment book has ${i.length} patients`),this.log("üîç Current patient list:",i.map((o,A)=>({index:A,name:o.name,fileNumber:o.fileNumber,dob:o.dob}))),s<i.length){const o=i[s];if(this.log(`üîç Expected patient at index ${s}:`,{name:e.name,fileNumber:e.fileNumber,dob:e.dob}),this.log(`üîç Actual patient at index ${s}:`,{name:o.name,fileNumber:o.fileNumber,dob:o.dob}),o.fileNumber!==e.fileNumber)throw this.log("üö® CRITICAL ERROR: Patient mismatch detected!"),this.log(`üö® Expected: ${e.name} (${e.fileNumber})`),this.log(`üö® Found: ${o.name} (${o.fileNumber})`),new Error(`Patient list state corrupted. Expected ${e.name} but found ${o.name} at index ${s}`);this.log(`‚úÖ Patient validation successful: ${e.name} is at correct position ${s}`)}else throw this.log(`üö® CRITICAL ERROR: Patient index ${s} is out of bounds (current list has ${i.length} patients)`),new Error(`Patient index ${s} is out of bounds for current appointment book`)}catch(a){throw this.log("‚ùå Patient validation failed:",a),new Error(`Patient validation failed: ${a instanceof Error?a.message:"Unknown error"}`)}}log(...e){console.log("[Enhanced BatchAIReviewOrchestrator]",...e)}async getAvailableCheckpoints(){return this.checkpointManager.listCheckpoints()}async deleteCheckpoint(e){return this.checkpointManager.deleteCheckpoint(e)}async exportMetrics(){if(!this.config.enableMetrics)throw new Error("Metrics collection is disabled");const e=this.metricsCollector.generateReport();return this.metricsCollector.exportMetrics(e)}async clearCaches(){return this.cacheManager.clear()}getDetailedStats(){return{processing:this.getProcessingStats(),cache:this.config.enableCaching?this.cacheManager.getCacheInfo():null,errors:this.errorRecovery.getFailureStats(),metrics:this.config.enableMetrics?this.metricsCollector.getMetrics():null}}}const Yw=Object.freeze(Object.defineProperty({__proto__:null,BatchAIReviewOrchestrator:Ou},Symbol.toStringTag,{value:"Module"})),Jw={background:"background","investigation-summary":"investigation-summary",medication:"medications",bloods:null,imaging:null,tavi:null,"angiogram-pci":null,mteer:null,tteer:null,"pfo-closure":null,"asd-closure":null,"pvl-plug":null,"bypass-graft":null,"right-heart-cath":null,"tavi-workup":null,"pre-op-plan":null,"quick-letter":null,consultation:null,"ai-medical-review":null,"batch-ai-review":null,"aus-medical-review":null,"patient-education":null,"ohif-viewer":null,enhancement:null,transcription:null,generation:null},Zw={background:"Background","investigation-summary":"Investigation Summary",medications:"Medications (Problem List for Phil)","social-history":"Social & Family History"};function _u(r){return r&&Jw[r]||null}function Cc(r){return Zw[r]||r}function Nc(r){return r!==null&&_u(r)!==null}class Hs{static instance;config={minSimilarityScore:.8,caseSensitive:!1,ignoreTitles:!0,allowPartialMatches:!0,enabled:!0};constructor(){oe.debug("PatientNameValidator initialized")}static getInstance(){return Hs.instance||(Hs.instance=new Hs),Hs.instance}updateConfig(e){this.config={...this.config,...e},oe.debug("PatientNameValidator config updated:",this.config)}validatePatientNames(e,s){const n=[];if(!this.config.enabled)return{sessionPatientName:e,emrPatientName:s,similarityScore:1,isMatch:!0,confidence:"high",normalizedSessionName:e,normalizedEmrName:s,warnings:["Validation disabled"]};if(!e||!s)return n.push("Missing patient name data"),{sessionPatientName:e||"Unknown",emrPatientName:s||"Unknown",similarityScore:0,isMatch:!1,confidence:"low",normalizedSessionName:"",normalizedEmrName:"",warnings:n};(this.isFallbackPatientName(e)||this.isFallbackPatientName(s))&&n.push("Fallback patient name detected - validation may be unreliable");const a=this.normalizeName(e),i=this.normalizeName(s),o=this.calculateSimilarity(a,i),A=o>=this.config.minSimilarityScore;let l;o>=.95?l="high":o>=.75?l="medium":l="low",A||(o>.5?n.push("Names are similar but not identical - possible transcription variation"):n.push("Names appear to be completely different"));const c={sessionPatientName:e,emrPatientName:s,similarityScore:o,isMatch:A,confidence:l,normalizedSessionName:a,normalizedEmrName:i,warnings:n};return oe.debug("Patient name validation result:",c),c}normalizeName(e){if(!e)return"";let s=e.trim();return this.config.ignoreTitles&&(s=s.replace(/^(Mr\.?|Mrs\.?|Ms\.?|Dr\.?|Miss)\s+/i,"")),s=s.replace(/\s*\(\d+\)$/,""),s=s.replace(/\s*\(Session-\d+\)$/,""),s=s.replace(/\s+/g," ").trim(),this.config.caseSensitive||(s=s.toLowerCase()),s}calculateSimilarity(e,s){if(!e||!s)return 0;if(e===s)return 1;if(this.config.allowPartialMatches){const i=e.length>s.length?e:s,o=e.length>s.length?s:e;if(i.includes(o)&&o.length>=3)return .85}const n=this.levenshteinDistance(e,s),a=Math.max(e.length,s.length);return a===0?1:1-n/a}levenshteinDistance(e,s){const n=[];for(let a=0;a<=s.length;a++)n[a]=[a];for(let a=0;a<=e.length;a++)n[0][a]=a;for(let a=1;a<=s.length;a++)for(let i=1;i<=e.length;i++)s.charAt(a-1)===e.charAt(i-1)?n[a][i]=n[a-1][i-1]:n[a][i]=Math.min(n[a-1][i-1]+1,n[a][i-1]+1,n[a-1][i]+1);return n[s.length][e.length]}isFallbackPatientName(e){return e?[/^Patient \d+/i,/^Patient \d+ \(\d{1,2}:\d{2}\)$/i,/^Session-\d+$/i,/^Unknown$/i,/^Patient$/i].some(n=>n.test(e.trim())):!0}getValidationExplanation(e){return this.config.enabled?e.isMatch?`Patient names match with ${Math.round(e.similarityScore*100)}% confidence.`:e.similarityScore>.5?`Patient names are similar (${Math.round(e.similarityScore*100)}% match) but may represent different patients or transcription variations.`:`Patient names appear to be different (${Math.round(e.similarityScore*100)}% match). You may be inserting into the wrong patient file.`:"Patient name validation is disabled."}shouldSkipValidation(e,s){if(!this.config.enabled)return!0;if(this.isFallbackPatientName(e)&&this.isFallbackPatientName(s))return oe.debug("Skipping validation - both names are fallback names"),!0;const n=3;return e.trim().length<n||s.trim().length<n?(oe.debug("Skipping validation - names too short to validate"),!0):!1}}const jc=Hs.getInstance();function eB(r){const{onRecordingComplete:e,onVoiceActivityUpdate:s,onRecordingTimeUpdate:n,onError:a,selectedMicrophoneId:i,getMicrophoneId:o}=r,[A,l]=u.useState({isRecording:!1,isPaused:!1,recordingTime:0,voiceActivityLevel:0,frequencyData:[],hasPermission:null,isRequestingPermission:!1,activeDeviceInfo:null,audioLevelHistory:[]}),c=u.useRef(null),d=u.useRef(null),m=u.useRef(null),g=u.useRef(null),h=u.useRef([]),p=u.useRef(),b=u.useRef(),N=u.useRef(!1),y=u.useCallback(async()=>{try{const F=m.current,w=d.current;if(!F){console.log("üîá detectVoiceActivity: analyser is null");return}if(!N.current){console.log("üîá detectVoiceActivity: not recording (ref check)");return}if(!w){console.log("üîá detectVoiceActivity: audio context is null");return}if(w.state!=="running")if(console.log("üîá detectVoiceActivity: audio context state is",w.state),w.state==="suspended"){console.log("üé§ Attempting to resume suspended audio context...");try{await w.resume(),console.log("‚úÖ Audio context resumed successfully")}catch(V){console.error("‚ùå Failed to resume audio context:",V);return}}else return;const T=F.frequencyBinCount,C=new Uint8Array(T);F.getByteFrequencyData(C),!(Math.max(...C)>0)&&Math.random()<.05&&console.warn("‚ö†Ô∏è No audio data detected in frequency analysis:",{contextState:w.state,analyserFftSize:F.fftSize,bufferLength:T,isRecording:N.current});const k=C.reduce((V,L)=>V+L,0)/T,P=Math.min(k/128,1),M=64,$=[],W=Math.floor(T/M);for(let V=0;V<M;V++){let L=0;const O=V*W,z=Math.min(O+W,T);for(let X=O;X<z;X++)L+=C[X];const H=Math.min(L/(z-O)/128,1);$.push(Math.pow(H,.7))}l(V=>{const L=[...V.audioLevelHistory,P].slice(-30),z=(L.length>10?L.slice(-10).reduce((H,X)=>H+X,0)/10:0)>.01||P>.05;return P>.1&&Math.random()<.001&&console.log("üé§ Audio Debug:",{level:Math.round(P*100)+"%",frequencyBars:$.length,avgFreq:Math.round($.reduce((H,X)=>H+X,0)/$.length*100)+"%",maxFreq:Math.round(Math.max(...$)*100)+"%"}),{...V,voiceActivityLevel:P,frequencyData:$,audioLevelHistory:L,activeDeviceInfo:V.activeDeviceInfo?{...V.activeDeviceInfo,isWorking:z}:null}}),s?.(P,$),N.current&&(p.current=requestAnimationFrame(()=>y()))}catch(F){console.error("üîá detectVoiceActivity error:",F),N.current&&(p.current=requestAnimationFrame(()=>y()))}},[s]),j=u.useCallback(()=>{l(F=>({...F,recordingTime:0})),b.current=setInterval(()=>{l(F=>{const w=F.recordingTime+1;return n?.(w),{...F,recordingTime:w}})},1e3)},[n]),Q=u.useCallback(()=>{b.current&&(clearInterval(b.current),b.current=void 0)},[]),v=u.useCallback(async()=>{try{const F=await navigator.permissions.query({name:"microphone"});l(w=>({...w,hasPermission:F.state==="granted"})),F.addEventListener("change",()=>{l(w=>({...w,hasPermission:F.state==="granted"}))})}catch{l(w=>({...w,hasPermission:null}))}},[]),x=u.useCallback(()=>{N.current=!1,Q(),p.current&&(cancelAnimationFrame(p.current),p.current=void 0),c.current&&c.current.state==="recording"&&c.current.stop(),g.current&&(g.current.getTracks().forEach(F=>F.stop()),g.current=null),d.current&&(d.current.close(),d.current=null),l(F=>({...F,isRecording:!1,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:null,audioLevelHistory:[]}))},[Q]),f=u.useCallback(async()=>{console.log("üé§ useRecorder.startRecording() called"),l(F=>({...F,isRequestingPermission:!0}));try{const F=o?.()||i,w={audio:F?{deviceId:F,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}},T=await navigator.mediaDevices.getUserMedia(w);g.current=T;const C=T.getAudioTracks();if(C.length===0)throw new Error("No audio tracks available in the media stream");const E=C[0];if(E.readyState!=="live"&&console.warn("‚ö†Ô∏è Audio track is not live:",E.readyState),E.enabled||(E.enabled=!0),E.muted&&(console.warn("‚ö†Ô∏è Microphone appears muted, attempting recovery..."),E.enabled=!1,await new Promise(W=>setTimeout(W,100)),E.enabled=!0,await new Promise(W=>setTimeout(W,100)),E.muted))throw console.error("‚ùå Microphone is muted. Please check System Settings ‚Üí Sound ‚Üí Input"),new Error("Microphone is muted at system level. Please restart your computer or check Sound settings.");let U=null;if(C.length>0){const W=C[0],V=W.getSettings();U={label:W.label||"Unknown Microphone",deviceId:V.deviceId||"unknown",isWorking:!1,hasMismatch:!1},F&&V.deviceId!==F?(console.warn("‚ö†Ô∏è Using different microphone than requested"),U&&(U.hasMismatch=!0,U.requestedDeviceId=F)):U&&(U.hasMismatch=!1)}N.current=!0,l(W=>({...W,hasPermission:!0,isRequestingPermission:!1,isRecording:!0,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:U,audioLevelHistory:[]}));const k=new AudioContext;k.state==="suspended"&&(console.log("üé§ Resuming suspended audio context..."),await k.resume());const P=k.createMediaStreamSource(T),M=k.createAnalyser();if(M.fftSize=512,M.smoothingTimeConstant=.7,M.minDecibels=-90,M.maxDecibels=-10,P.connect(M),k.state!=="running")throw console.error("‚ùå AudioContext failed to start:",k.state),new Error(`AudioContext is in ${k.state} state, expected "running"`);d.current=k,m.current=M;const $=new MediaRecorder(T,{mimeType:"audio/webm;codecs=opus"});h.current=[],$.ondataavailable=W=>{W.data.size>0&&h.current.push(W.data)},$.onerror=W=>{console.error("‚ùå MediaRecorder error:",W)},$.onstop=()=>{const W=new Blob(h.current,{type:"audio/webm;codecs=opus"});W.size===0&&console.error("‚ùå No audio data captured"),e(W),x()},$.start(100),c.current=$,j(),setTimeout(async()=>{await y()},100)}catch(F){console.error("üé§ Recording start failed:",F),N.current=!1,l(w=>({...w,hasPermission:!1,isRequestingPermission:!1})),a?.(F)}},[i,e,a,y,j,A.recordingTime,x,o]),S=u.useCallback(()=>{console.log("üõë useRecorder.stopRecording() called"),N.current=!1,c.current&&c.current.state==="recording"&&c.current.stop(),l(F=>({...F,isRecording:!1})),Q(),p.current&&(cancelAnimationFrame(p.current),p.current=void 0)},[Q]);return Fe.useEffect(()=>(v(),x),[v,x]),{...A,startRecording:f,stopRecording:S,cleanup:x}}const $u=ce.getInstance(),Sc=(r,e,s=3e3)=>$u.success(r,e,s),Da=(r,e,s=4e3)=>$u.error(r,e,s);function Ec(r){return r.trim().replace(/[-‚Äì‚Äî]+\s*$/,"").trim()}function tB(r){return r.replace(/^Patient\s+[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+/i,"").replace(/^[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+(?:had|has|presented|underwent|received)\s+/i,"").replace(/\s+/g," ").replace(/\.\s*\./g,".").replace(/;\s*;/g,";").replace(/,\s*,/g,",").trim()}function rB(r){const e=[];return r.toLowerCase(),[/(?:ejection fraction|ef)\s+(?:of\s+)?(\d+%?)/gi,/(?:blood pressure|bp)\s+(?:of\s+)?(\d+\/\d+)/gi,/(?:heart rate|hr)\s+(?:of\s+)?(\d+)/gi,/(?:chest pain|dyspnoea|palpitations|dizziness|syncope)/gi,/(?:atrial fibrillation|af|coronary artery disease|cad|heart failure|hypertension)/gi,/(?:aspirin|metoprolol|ramipril|atorvastatin|warfarin|apixaban)/gi].forEach(n=>{const a=r.match(n);a&&a.forEach(i=>{e.some(o=>o.toLowerCase().includes(i.toLowerCase()))||e.push(i)})}),r.includes("normal")&&(r.includes("ejection fraction")||r.includes("ef"))&&e.push("Normal EF"),e}function sB(r){const e=r.split(/[.!?]+/).filter(a=>a.trim().length>15),n=e.filter(a=>{const i=a.toLowerCase();return!i.includes("thank you")&&!i.includes("dear")&&!i.includes("kind regards")&&!i.includes("yours sincerely")&&!i.includes("best wishes")}).slice(0,3);return n.length===0?e.length>0?e[0].trim()+".":"No summary available.":n.join(". ").trim()+"."}function nB(r){const e=rB(r);if(e.length>0){const s=[],n=e.filter(o=>/(?:atrial fibrillation|af|coronary artery disease|cad|heart failure|hypertension)/i.test(o)),a=e.filter(o=>/(?:ejection fraction|blood pressure|heart rate)/i.test(o)),i=e.filter(o=>/(?:chest pain|dyspnoea|palpitations|dizziness|syncope)/i.test(o));if(n.length>0&&s.push(`${n.slice(0,2).join(" and ")}`),i.length>0&&s.push(`${i.slice(0,2).join(" and ")}`),a.length>0&&s.push(`${a.slice(0,2).join(", ")}`),s.length>0)return s.join(". ")+"."}return sB(r)}function Ku(r){try{console.log("üîß Parsing QuickLetter structured response for SUMMARY: and LETTER: markers");const e=r.lastIndexOf("SUMMARY:"),s=r.lastIndexOf("LETTER:");if(console.log("üîç Found SUMMARY: at index (last occurrence):",e),console.log("üîç Found LETTER: at index (last occurrence):",s),e!==-1&&s!==-1&&e<s){console.log("‚úÖ Found both SUMMARY: and LETTER: markers in correct order");let A=r.substring(e+8,s).trim();A=A.replace(/^[-\s]+|[-\s]+$/g,"").trim();let l=r.substring(s+7).trim();l=l.replace(/<unused\d+>|<\|endoftext\|>|<\|end\|>/gi,"").trim(),console.log("üìã Extracted summary raw:",A.substring(0,100)+(A.length>100?"...":"")),console.log("üìù Extracted letter content length:",l.length),console.log("üìù Letter preview:",l.substring(0,100)+(l.length>100?"...":""));const c=Ec(A);return console.log("üßπ Cleaned summary:",c),{summary:c,letterContent:l}}console.log("üîç Checking for legacy --- divider pattern");const n=r.match(/SUMMARY:\s*([\s\S]+?)(?=---)/),a=r.match(/LETTER:\s*([\s\S]*)/);if(n&&a){console.log("‚úÖ Found legacy pattern with --- divider");const A=Ec(n[1].trim()),l=a[1].trim();return{summary:A,letterContent:l}}console.log("‚ö†Ô∏è No SUMMARY:/LETTER: markers found, using fallback parsing"),console.log("üìÑ Raw output for fallback:",r.substring(0,200)+"...");const i=nB(r),o=i.length>150?i.substring(0,147)+"...":i;return console.log("üîÑ Generated fallback summary:",o),console.log("üìù Using entire output as letter content (length:",r.length,")"),{summary:o,letterContent:r}}catch(e){console.warn("‚ùå Error parsing structured response:",e);const s=r.length>150?r.substring(0,147)+"...":r;return console.log("üö® Using emergency fallback parsing"),{summary:s,letterContent:r}}}function aB(r){const{summary:e}=Ku(r);return tB(e)}class Ls{static instance=null;cache=null;extractionInProgress=!1;lastExtractionAttempt=0;CACHE_TTL=6e4;MIN_EXTRACTION_INTERVAL=2e3;MAX_RETRIES=2;constructor(){console.log("üèóÔ∏è PatientDataCacheService initialized")}static getInstance(){return Ls.instance||(Ls.instance=new Ls),Ls.instance}getCachedData(){if(!this.cache)return console.log("üì≠ Patient data cache is empty"),null;const s=Date.now()-this.cache.timestamp;if(s>this.CACHE_TTL)return console.log(`‚è∞ Patient data cache expired (age: ${Math.round(s/1e3)}s)`),null;const n=window.location.href;return this.cache.url!==n?(console.log("üîÑ Patient data cache invalidated - URL changed"),null):!this.cache.isValid||!this.cache.data?(console.log("‚ùå Patient data cache is invalid"),null):(console.log(`‚úÖ Patient data cache hit (age: ${Math.round(s/1e3)}s)`),this.cache.data)}async extractAndCache(){const e=Date.now();if(e-this.lastExtractionAttempt<this.MIN_EXTRACTION_INTERVAL){console.log("‚è±Ô∏è Skipping patient extraction - too soon since last attempt");return}if(this.extractionInProgress){console.log("‚è≥ Patient extraction already in progress - skipping");return}this.extractionInProgress=!0,this.lastExtractionAttempt=e;try{console.log("üîç Background patient data extraction started");const s=performance.now(),n=await this.performExtraction(),a=Math.round(performance.now()-s);console.log(`‚úÖ Background patient extraction completed in ${a}ms`),this.cache={data:n,timestamp:Date.now(),url:window.location.href,isValid:n!==null},n?console.log("üíæ Patient data cached:",{name:n.name,id:n.id,duration:`${a}ms`}):console.log("üì≠ No patient data found - cached null result")}catch(s){console.error("‚ùå Background patient extraction failed:",s),this.cache={data:null,timestamp:Date.now(),url:window.location.href,isValid:!1}}finally{this.extractionInProgress=!1}}async performExtraction(){for(let e=1;e<=this.MAX_RETRIES;e++)try{const s=await Promise.race([chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),new Promise((n,a)=>setTimeout(()=>a(new Error("Patient extraction timeout")),5e3))]);if(s?.success&&s?.data){const n=s.data,a=n.name&&n.name.trim()!=="",i=n.id&&n.id.trim()!=="";if(a||i)return{name:n.name||"Patient",id:n.id||"No ID",dob:n.dob||"",age:n.age||"",phone:n.phone,email:n.email,medicare:n.medicare,insurance:n.insurance,address:n.address,extractedAt:n.extractedAt||Date.now()};console.warn("Extracted patient data lacked name and ID, skipping cache update.")}else console.warn("Patient extraction succeeded without usable data",s?.error)}catch(s){if(console.warn("Patient extraction attempt failed:",s),e<this.MAX_RETRIES){const n=500*e;await new Promise(a=>setTimeout(a,n))}}return null}invalidateCache(){console.log("üóëÔ∏è Patient data cache invalidated"),this.cache=null}async refreshCache(){this.invalidateCache(),await this.extractAndCache()}isCacheValid(){if(!this.cache)return!1;const s=Date.now()-this.cache.timestamp,n=window.location.href;return this.cache.isValid&&s<this.CACHE_TTL&&this.cache.url===n}getCacheStats(){if(!this.cache)return{cached:!1};const e=Date.now()-this.cache.timestamp;return{cached:!0,valid:this.isCacheValid(),age:Math.round(e/1e3),hasData:this.cache.data!==null,url:this.cache.url,patientName:this.cache.data?.name||"N/A"}}}const iB={uncheckedExpiryMs:7*24*60*60*1e3,checkedExpiryMs:24*60*60*1e3,cleanupIntervalMs:60*60*1e3},oB={maxBytes:5*1024*1024,warningThreshold:.8,criticalThreshold:.9};class pn extends Error{constructor(e,s,n){super(s),this.type=e,this.originalError=n,this.name="PersistenceError"}}const oo="1.0.0",Gt={SESSIONS:"operator_sessions",CHECKED_IDS:"operator_checked_ids",METADATA:"operator_storage_metadata"};class Os{static instance=null;expiryConfig;quotaConfig;cleanupIntervalId=null;constructor(e=iB,s=oB){this.expiryConfig=e,this.quotaConfig=s}static getInstance(){return Os.instance||(Os.instance=new Os),Os.instance}async initialize(){console.log("üì¶ Initializing SessionPersistenceService"),await this.cleanupExpiredSessions(),this.startBackgroundCleanup(),console.log("‚úÖ SessionPersistenceService initialized")}async saveSession(e){try{const s=await this.loadAllSessions(),n=s.findIndex(o=>o.id===e.id),a=this.compressSession(e);n>=0?(s[n]=a,console.log("üìù Updated existing session in storage:",e.id)):(s.push(a),console.log("üíæ Saved new session to storage:",e.id)),this.estimateTotalSize(s)>this.quotaConfig.maxBytes*this.quotaConfig.criticalThreshold&&(console.warn("‚ö†Ô∏è Storage quota critical, pruning oldest sessions"),await this.pruneOldestSessions(s,5)),await this.saveSessions(s),await this.updateMetadata(s)}catch(s){throw this.handleStorageError(s,"SERIALIZATION_ERROR")}}async loadSessions(){try{return(await this.loadAllSessions()).map(s=>this.decompressSession(s))}catch(e){return console.error("‚ùå Failed to load sessions:",e),[]}}async deleteSession(e){try{const s=await this.loadAllSessions(),n=s.filter(a=>a.id!==e);if(n.length===s.length)throw new pn("DELETION_FAILED",`Session not found: ${e}`);await this.saveSessions(n),await this.updateMetadata(n),console.log("üóëÔ∏è Deleted session from storage:",e)}catch(s){throw this.handleStorageError(s,"DELETION_FAILED")}}async markSessionComplete(e){try{const s=await this.loadAllSessions(),n=s.find(i=>i.id===e);if(!n)throw new pn("DELETION_FAILED",`Session not found: ${e}`);n.markedCompleteAt=Date.now(),await this.saveSessions(s);const a=await this.getCheckedSessionIds();a.add(e),await chrome.storage.local.set({[Gt.CHECKED_IDS]:Array.from(a)}),console.log("‚úÖ Marked session complete (24h deletion timer started):",e)}catch(s){throw this.handleStorageError(s,"SERIALIZATION_ERROR")}}async unmarkSessionComplete(e){try{const s=await this.loadAllSessions(),n=s.find(i=>i.id===e);n&&(delete n.markedCompleteAt,await this.saveSessions(s));const a=await this.getCheckedSessionIds();a.delete(e),await chrome.storage.local.set({[Gt.CHECKED_IDS]:Array.from(a)}),console.log("‚Ü©Ô∏è Unmarked session complete (7d expiry restored):",e)}catch(s){throw this.handleStorageError(s,"SERIALIZATION_ERROR")}}async cleanupExpiredSessions(){const e={deletedCount:0,freedBytes:0,errors:[]};try{const s=await this.loadAllSessions(),n=Date.now(),a=this.estimateTotalSize(s),i=s.filter(o=>{const A=this.isSessionExpired(o,n);return A&&(e.deletedCount++,console.log("üóëÔ∏è Expired session:",o.id,{age:Math.round((n-o.persistedAt)/(24*60*60*1e3)),markedComplete:!!o.markedCompleteAt})),!A});if(e.deletedCount>0){await this.saveSessions(i),await this.updateMetadata(i);const o=this.estimateTotalSize(i);e.freedBytes=a-o,console.log(`üßπ Cleanup complete: ${e.deletedCount} sessions deleted, ${this.formatBytes(e.freedBytes)} freed`)}}catch(s){e.errors.push(s instanceof Error?s.message:String(s)),console.error("‚ùå Cleanup failed:",s)}return e}async getStorageStats(){const e=await this.loadAllSessions(),s=await this.getMetadata(),n=Date.now(),a=e.filter(A=>this.getTimeUntilExpiry(A,n)<24*60*60*1e3).length,i=e.reduce((A,l)=>!A||l.persistedAt<A.persistedAt?l:A,null),o=i?n-i.persistedAt:0;return{usedBytes:s.storageUsedBytes,totalBytes:this.quotaConfig.maxBytes,usedPercentage:s.storageUsedBytes/this.quotaConfig.maxBytes*100,sessionCount:e.length,oldestSessionAge:o,expiringCount:a}}async getCheckedSessionIds(){try{const s=(await chrome.storage.local.get(Gt.CHECKED_IDS))[Gt.CHECKED_IDS]||[];return new Set(s)}catch(e){return console.error("‚ùå Failed to load checked session IDs:",e),new Set}}async deleteAllCheckedSessions(){const e={deletedCount:0,freedBytes:0,errors:[]};try{const s=await this.loadAllSessions(),n=this.estimateTotalSize(s),a=s.filter(o=>{const A=!!o.markedCompleteAt;return A&&e.deletedCount++,!A});await this.saveSessions(a),await this.updateMetadata(a),await chrome.storage.local.set({[Gt.CHECKED_IDS]:[]});const i=this.estimateTotalSize(a);e.freedBytes=n-i,console.log(`üóëÔ∏è Deleted all checked sessions: ${e.deletedCount} removed`)}catch(s){e.errors.push(s instanceof Error?s.message:String(s))}return e}async deleteOldSessions(e){const s={deletedCount:0,freedBytes:0,errors:[]};try{const n=await this.loadAllSessions(),a=this.estimateTotalSize(n),i=Date.now()-e*24*60*60*1e3,o=n.filter(l=>{const c=l.persistedAt<i;return c&&s.deletedCount++,!c});await this.saveSessions(o),await this.updateMetadata(o);const A=this.estimateTotalSize(o);s.freedBytes=a-A,console.log(`üóëÔ∏è Deleted sessions older than ${e} days: ${s.deletedCount} removed`)}catch(n){s.errors.push(n instanceof Error?n.message:String(n))}return s}shutdown(){this.cleanupIntervalId&&(clearInterval(this.cleanupIntervalId),this.cleanupIntervalId=null,console.log("üõë SessionPersistenceService cleanup stopped"))}async loadAllSessions(){try{return(await chrome.storage.local.get(Gt.SESSIONS))[Gt.SESSIONS]||[]}catch(e){return console.error("‚ùå Failed to load sessions from storage:",e),[]}}async saveSessions(e){try{await chrome.storage.local.set({[Gt.SESSIONS]:e})}catch(s){throw s instanceof Error&&s.message.includes("QUOTA")?new pn("QUOTA_EXCEEDED","Storage quota exceeded",s):s}}async getMetadata(){try{return(await chrome.storage.local.get(Gt.METADATA))[Gt.METADATA]||{totalSessions:0,storageUsedBytes:0,oldestSessionTimestamp:Date.now(),lastCleanupAt:Date.now(),version:oo}}catch(e){return console.error("‚ùå Failed to load metadata:",e),{totalSessions:0,storageUsedBytes:0,oldestSessionTimestamp:Date.now(),lastCleanupAt:Date.now(),version:oo}}}async updateMetadata(e){const s=e.reduce((a,i)=>!a||i.persistedAt<a.persistedAt?i:a,null),n={totalSessions:e.length,storageUsedBytes:this.estimateTotalSize(e),oldestSessionTimestamp:s?.persistedAt||Date.now(),lastCleanupAt:Date.now(),version:oo};await chrome.storage.local.set({[Gt.METADATA]:n})}compressSession(e){const s=Date.now();return{id:e.id,patient:e.patient,transcription:e.transcription,results:e.results,summary:e.summary,taviStructuredSections:e.taviStructuredSections,educationData:e.educationData,preOpPlanData:e.preOpPlanData,reviewData:e.reviewData,agentType:e.agentType,agentName:e.agentName,timestamp:e.timestamp,status:e.status,processingTime:e.processingTime,modelUsed:e.modelUsed,completedTime:e.completedTime,quickActionField:e.quickActionField,persistedAt:s,lastAccessedAt:s,markedCompleteAt:e.completed?s:void 0}}decompressSession(e){return{id:e.id,patient:e.patient,transcription:e.transcription,results:e.results,summary:e.summary,taviStructuredSections:e.taviStructuredSections,educationData:e.educationData,preOpPlanData:e.preOpPlanData,reviewData:e.reviewData,agentType:e.agentType,agentName:e.agentName,timestamp:e.timestamp,status:e.status,processingTime:e.processingTime,modelUsed:e.modelUsed,completedTime:e.completedTime,quickActionField:e.quickActionField,completed:!!e.markedCompleteAt}}isSessionExpired(e,s){return e.markedCompleteAt?s-e.markedCompleteAt>this.expiryConfig.checkedExpiryMs:s-e.persistedAt>this.expiryConfig.uncheckedExpiryMs}getTimeUntilExpiry(e,s){if(e.markedCompleteAt){const n=e.markedCompleteAt+this.expiryConfig.checkedExpiryMs;return Math.max(0,n-s)}else{const n=e.persistedAt+this.expiryConfig.uncheckedExpiryMs;return Math.max(0,n-s)}}estimateTotalSize(e){const s=JSON.stringify(e);return new Blob([s]).size}async pruneOldestSessions(e,s){const a=[...e].sort((i,o)=>i.persistedAt-o.persistedAt).slice(s);console.log(`‚úÇÔ∏è Pruned ${s} oldest sessions to free space`),await this.saveSessions(a),await this.updateMetadata(a)}startBackgroundCleanup(){this.cleanupIntervalId=setInterval(async()=>{console.log("üßπ Running background cleanup..."),await this.cleanupExpiredSessions()},this.expiryConfig.cleanupIntervalMs)}handleStorageError(e,s){if(e instanceof pn)return e;const n=e instanceof Error?e.message:String(e);return new pn(s,n,e)}formatBytes(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}}const Vu=u.memo(()=>t.jsx($m,{children:t.jsx(dp,{children:t.jsx(Gu,{})})})),Gu=u.memo(()=>{const{state:r,actions:e,selectors:s}=qw(),n=$c(),a={patientEducation:s.isOverlayActive("patient-education"),patientSelection:s.isOverlayActive("patient-selection"),screenshotAnnotation:s.isOverlayActive("screenshot-annotation"),bpDiaryImporter:s.isOverlayActive("bp-diary-importer"),lipidProfileImporter:s.isOverlayActive("lipid-profile-importer"),tteTrendImporter:s.isOverlayActive("tte-trend-importer"),patientMismatch:s.isOverlayActive("patient-mismatch"),pasteNotes:s.isOverlayActive("paste-notes"),sparsityStepper:s.isOverlayActive("sparsity-stepper")},i=s.isSidePanelOpen("metrics-dashboard"),o=u.useRef(null),A=u.useRef(null),[l,c]=Fe.useState(null),[d,m]=u.useState(new Set),[g,h]=u.useState(new Set),[p,b]=u.useState(!1),[N,y]=u.useState(!1),j=u.useRef(null),Q=u.useRef(0),v=u.useRef(null),x=u.useRef(null),f=u.useRef(Jo.getInstance()).current,S=u.useRef(op.getInstance()).current,F=u.useRef(Ls.getInstance()).current,w=u.useRef(Vm.getInstance()).current,T=u.useRef(Os.getInstance()).current,C=u.useRef(null),E=u.useRef(null),[U,k]=u.useState(null),[P,M]=u.useState(!1),[$,W]=u.useState(null),[V,L]=u.useState(null),O=u.useRef(null),z=u.useRef(null),H=eB({onRecordingComplete:B=>{if(O.current)return O.current(B)},onVoiceActivityUpdate:(B,I)=>{z.current&&z.current(B,I)},onRecordingTimeUpdate:u.useCallback(B=>{Q.current=B},[]),onError:u.useCallback(B=>{console.error("üé§ Recording error:",B);const I=A.current||r.currentSessionId;I&&(console.log("üßπ Cleaning up failed recording session:",I),e.removePatientSession(I),e.setCurrentSessionId(null),A.current=null),e.setActiveWorkflow(null),o.current=null,e.setUIMode("idle",{sessionId:null,origin:"auto"});const R=B.name==="NotAllowedError"?"Microphone permission denied. Please allow microphone access to record.":`Recording failed: ${B.message}`;e.setErrors([R]),e.setProcessing(!1),e.setProcessingStatus("idle")},[e,r.currentSessionId]),getMicrophoneId:()=>n.selectedMicrophoneId}),X=u.useMemo(()=>(H.isRecording||A.current!==null,r.selectedSessionId),[r.selectedSessionId,H.isRecording]),Ae=u.useMemo(()=>X?r.patientSessions.find(I=>I.id===X)?.patient?.name:void 0,[X,r.patientSessions]),D=u.useMemo(()=>r.displaySession.isDisplayingSession&&r.displaySession.displaySessionId?r.displaySession.displaySessionId:X||(r.currentSessionId?r.currentSessionId:r.ui.modeContext.sessionId?r.ui.modeContext.sessionId:null),[r.displaySession.isDisplayingSession,r.displaySession.displaySessionId,X,r.currentSessionId,r.ui.modeContext.sessionId]),K=u.useMemo(()=>D&&r.patientSessions.find(B=>B.id===D)||null,[r.patientSessions,D]),ee=u.useMemo(()=>r.displaySession.isDisplayingSession&&r.displaySession.displayAgent?r.displaySession.displayAgent:r.currentAgent?r.currentAgent:K?.agentType??null,[r.displaySession.isDisplayingSession,r.displaySession.displayAgent,r.currentAgent,K]),pe=u.useMemo(()=>r.displaySession.isDisplayingSession&&r.displaySession.displayAgentName?r.displaySession.displayAgentName:r.currentAgentName?r.currentAgentName:K?.agentName??null,[r.displaySession.isDisplayingSession,r.displaySession.displayAgentName,r.currentAgentName,K]),ae=u.useMemo(()=>`${D??"active"}::${ee??"unknown"}`,[D,ee]),me=u.useMemo(()=>r.resultRevisions[ae],[r.resultRevisions,ae]),le=u.useMemo(()=>{if(r.displaySession.isDisplayingSession&&r.displaySession.displaySessionId===(D??r.displaySession.displaySessionId))return r.displaySession.displayResults||"";if(D){const B=r.patientSessions.find(I=>I.id===D);if(B)return B.results||""}return r.results||""},[r.displaySession.isDisplayingSession,r.displaySession.displaySessionId,r.displaySession.displayResults,r.patientSessions,D,r.results]),re=u.useMemo(()=>{if(me)return{key:ae,original:me.original,edited:me.edited,savedText:me.savedText,notes:me.notes,tags:me.tags,runEvaluationOnSave:me.runEvaluationOnSave,hasUnsavedChanges:me.hasUnsavedChanges,lastSavedAt:me.lastSavedAt,isEditing:me.isEditing}},[me,ae]),te=u.useMemo(()=>({workflowId:D,agentLabel:pe}),[D,pe]),he=u.useCallback(()=>{v.current&&(v.current.abort(),v.current=null),e.streamCancelled(),e.setStreaming(!1),e.setAiGeneratedSummary(void 0)},[e]),Ce=u.useCallback(B=>{if(!ae)return;const I=r.resultRevisions[ae];B?I?e.updateResultRevision(ae,{isEditing:!0,workflowId:D??I.workflowId}):e.setResultRevision(ae,{original:le,edited:le,savedText:le,notes:"",tags:[],workflowId:D,runEvaluationOnSave:!0,hasUnsavedChanges:!1,isEditing:!0,lastSavedAt:void 0}):I&&e.updateResultRevision(ae,{isEditing:!1})},[e,ae,r.resultRevisions,D,le]),ge=u.useCallback(B=>{if(!ae)return;const I=r.resultRevisions[ae];if(!I)return;const R={};B.edited!==void 0&&(R.edited=B.edited,R.hasUnsavedChanges=B.edited!==I.savedText),B.notes!==void 0&&(R.notes=B.notes),B.tags!==void 0&&(R.tags=B.tags),B.runEvaluationOnSave!==void 0&&(R.runEvaluationOnSave=B.runEvaluationOnSave),e.updateResultRevision(ae,R)},[e,ae,r.resultRevisions]),Z=u.useCallback(()=>{if(!ae)return;const B=r.resultRevisions[ae];B&&e.updateResultRevision(ae,{edited:B.savedText,hasUnsavedChanges:!1})},[e,ae,r.resultRevisions]),be=u.useCallback(async()=>{if(!me||!ae)return;const B=me.edited;b(!0);try{if(e.setResults(B),D){e.updatePatientSession(D,{results:B});const I=r.patientSessions.find(R=>R.id===D);if(I){const R={...I,results:B};e.setDisplaySession(R)}}e.updateResultRevision(ae,{savedText:B,hasUnsavedChanges:!1,lastSavedAt:Date.now()}),Sc("Revision saved","Updated result is ready for EMR actions.")}catch(I){const R=I instanceof Error?I.message:"Unknown error";oe.error("Failed to save revision",{error:R}),Da("Failed to save revision",R)}finally{b(!1)}},[me,ae,D,e,r.patientSessions]),we=u.useCallback(async()=>{if(!(!me||!ae)){if(!ee){Da("Unable to save golden pair","Agent context is missing.");return}if(!me.notes.trim()){Da("Scenario summary required","Add a scenario summary before saving.");return}y(!0);try{const B=Array.from(new Set([...me.tags||[],...ee?[ee]:[],...D?[D]:[]])),I=await w.saveGoldenPair({agentId:ee,workflowId:D,original:me.original,edited:me.edited,notes:me.notes.trim(),tags:B,runEvaluationOnNewExample:me.runEvaluationOnSave});Sc("Golden pair saved",`Captured as ${I.exampleId}`),e.updateResultRevision(ae,{savedText:me.edited,hasUnsavedChanges:!1,lastSavedAt:Date.now()})}catch(B){const I=B instanceof Error?B.message:"Unknown error";oe.error("Golden pair capture failed",{error:I}),Da("Failed to save golden pair",I)}finally{y(!1)}}},[me,ae,D,ee,w,e]);u.useEffect(()=>{r.ui.mode==="idle"&&!r.displaySession.isDisplayingSession&&!r.currentSessionId&&!X&&Object.keys(r.resultRevisions).length>0&&e.resetResultRevisions()},[r.ui.mode,r.displaySession.isDisplayingSession,r.currentSessionId,X,r.resultRevisions,e]),u.useEffect(()=>{},[e,r]),u.useEffect(()=>((async()=>{try{console.log("üì¶ Initializing session persistence..."),await T.initialize();const I=await T.loadSessions();console.log(`‚úÖ Loaded ${I.length} persisted sessions`);for(const _ of I)e.addPatientSession(_),e.addPersistedSessionId(_.id);const R=await T.getCheckedSessionIds();h(R),await ye(),console.log("‚úÖ Session persistence initialized")}catch(I){console.error("‚ùå Failed to initialize session persistence:",I)}})(),()=>{T.shutdown()}),[]);const ye=u.useCallback(async()=>{try{const B=await T.getStorageStats();k(B),e.setStorageMetadata({totalSessions:B.sessionCount,storageUsedBytes:B.usedBytes,usedPercentage:B.usedPercentage})}catch(B){console.error("‚ùå Failed to update storage stats:",B)}},[T,e]),Ne=u.useCallback(async B=>{try{await T.saveSession(B),e.addPersistedSessionId(B.id),await ye(),console.log("üíæ Session saved to local storage:",B.id)}catch(I){console.error("‚ùå Failed to save session to persistence:",I),ce.getInstance().error("Failed to save session locally. Storage may be full.")}},[T,e,ye]),Be=u.useCallback(async B=>{if(g.has(B)){h(R=>{const _=new Set(R);return _.delete(B),_});try{await T.unmarkSessionComplete(B),console.log("‚Ü©Ô∏è Session unchecked, expiry reset to 7 days:",B)}catch(R){console.error("‚ùå Failed to unmark session as complete:",R)}}else{h(R=>{const _=new Set(R);return _.add(B),_});try{await T.markSessionComplete(B),console.log("‚úÖ Session checked, will delete in 24 hours:",B)}catch(R){console.error("‚ùå Failed to mark session as complete:",R),ce.getInstance().error("Failed to mark session as complete"),h(_=>{const G=new Set(_);return G.delete(B),G})}}await ye()},[g,T,ye]),J=u.useCallback(async B=>{try{await T.deleteSession(B),e.removePatientSession(B),e.removePersistedSessionId(B),h(I=>{const R=new Set(I);return R.delete(B),R}),await ye(),console.log("üóëÔ∏è Session deleted from persistence:",B)}catch(I){console.error("‚ùå Failed to delete session:",I),ce.getInstance().error("Failed to delete session")}},[T,e,ye]),Y=u.useCallback(async()=>{try{const B=await T.deleteAllCheckedSessions();console.log(`üóëÔ∏è Deleted ${B.deletedCount} checked sessions`),r.patientSessions.forEach(I=>{I.completed&&(e.removePatientSession(I.id),e.removePersistedSessionId(I.id))}),h(new Set),await ye(),ce.getInstance().success(`Deleted ${B.deletedCount} checked sessions`)}catch(B){console.error("‚ùå Failed to delete checked sessions:",B),ce.getInstance().error("Failed to delete checked sessions")}},[T,r.patientSessions,e,ye]),fe=u.useCallback(async B=>{try{const I=await T.deleteOldSessions(B);console.log(`üóëÔ∏è Deleted ${I.deletedCount} sessions older than ${B} days`);const R=await T.loadSessions(),_=new Set(R.map(G=>G.id));r.patientSessions.forEach(G=>{_.has(G.id)||(e.removePatientSession(G.id),e.removePersistedSessionId(G.id))}),await ye(),ce.getInstance().success(`Deleted ${I.deletedCount} old sessions`)}catch(I){console.error("‚ùå Failed to delete old sessions:",I),ce.getInstance().error("Failed to delete old sessions")}},[T,r.patientSessions,e,ye]),Ue=u.useCallback(async()=>{if(!V)return;console.log("üîÑ Retrying workflow with same model after user freed memory"),W(null);const{sessionId:B,audioBlob:I,workflowId:R,transcription:_}=V;e.updatePatientSession(B,{status:"processing",errors:[],processingProgress:{phase:"Processing",progress:0}});try{await Ut(B,I,R,_),L(null)}catch(G){console.error("‚ùå Retry failed:",G)}},[V,e]),Ie=u.useCallback(async B=>{if(!V)return;console.log(`üîÄ Switching to model: ${B}`),f.updateConfig({processorModel:B}),W(null);const{sessionId:I,audioBlob:R,workflowId:_,transcription:G}=V;e.updatePatientSession(I,{status:"processing",errors:[],processingProgress:{phase:"Processing",progress:0}});try{await Ut(I,R,_,G),L(null),ce.getInstance().success(`Switched to ${B}`,"Processing will continue with the new model")}catch(q){console.error("‚ùå Switch and retry failed:",q)}},[V,f,e]),vt=u.useCallback(()=>{W(null),L(null),V&&e.updatePatientSession(V.sessionId,{status:"cancelled",errors:["User cancelled model loading"]})},[V,e]);u.useEffect(()=>{(async()=>{try{const I=await chrome.storage.local.get("checkedSessionIds");I.checkedSessionIds&&Array.isArray(I.checkedSessionIds)&&(h(new Set(I.checkedSessionIds)),console.log("‚úÖ Loaded checked sessions from storage:",I.checkedSessionIds))}catch(I){console.warn("Failed to load checked sessions from storage:",I)}})()},[]),u.useEffect(()=>{(async()=>{try{const I=Array.from(g);await chrome.storage.local.set({checkedSessionIds:I}),console.log("üíæ Saved checked sessions to storage:",I)}catch(I){console.warn("Failed to save checked sessions to storage:",I)}})()},[g]);const Pe=u.useCallback(async B=>{if(["right-heart-cath","tavi-workup"].includes(B))return console.log(`üîÑ Agent '${B}' requires agent-based processing, skipping streaming`),null;try{const{systemPromptLoader:R}=await $e(async()=>{const{systemPromptLoader:_}=await import("./chunks/agents.w_LsrkjM.js").then(G=>G.S);return{systemPromptLoader:_}},__vite__mapDeps([7,8,4,2,1]));return await R.loadSystemPrompt(B,"primary")}catch(R){return console.error("Failed to load system prompt for agent:",B,R),null}},[]);u.useCallback(async B=>{try{switch(B){case"quick-letter":return(await $e(()=>import("./chunks/QuickLetterSystemPrompts.CN0NMnJq.js"),[])).QUICK_LETTER_SYSTEM_PROMPTS.primary;case"investigation-summary":return(await $e(()=>import("./chunks/InvestigationSummarySystemPrompts.i3uNOkks.js"),__vite__mapDeps([16,7,8,4,2,1]))).INVESTIGATION_SUMMARY_SYSTEM_PROMPTS.primary;case"background":return(await $e(()=>import("./chunks/BackgroundSystemPrompts.Dx0p2kfn.js"),[])).BACKGROUND_SYSTEM_PROMPTS.primary;case"medication":return(await $e(()=>import("./chunks/MedicationSystemPrompts.--toCo-_.js"),__vite__mapDeps([17,7,8,4,2,1]))).MEDICATION_SYSTEM_PROMPTS.primary;case"bloods":return(await $e(()=>import("./chunks/agents.w_LsrkjM.js").then(R=>R.j),__vite__mapDeps([7,8,4,2,1]))).BLOODS_SYSTEM_PROMPTS.primary;case"imaging":return(await $e(()=>import("./chunks/agents.w_LsrkjM.js").then(R=>R.k),__vite__mapDeps([7,8,4,2,1]))).IMAGING_SYSTEM_PROMPTS.primary;default:return null}}catch(I){return console.warn("Failed to load system prompt for agent",B,I),null}},[]);const Ft=B=>{switch(B){case"investigation-summary":return{model:sn.QUICK_MODEL,maxTokens:2e3};case"background":return{model:sn.QUICK_MODEL,maxTokens:2e3};case"medication":return{model:sn.QUICK_MODEL,maxTokens:3e3};case"quick-letter":return{model:sn.REASONING_MODEL,maxTokens:5e3};default:return{model:sn.REASONING_MODEL,maxTokens:4e3}}},sr=u.useCallback(async(B,I,R,_)=>{let G=await Pe(I);if(!G)return{handled:!1,success:!1};if(I==="quick-letter"&&_?.patientInfo){const{name:De,age:pt,dob:rt,gender:Ct}=_.patientInfo,Mt=[];De&&Mt.push(`Patient Name: ${De}`),pt&&Mt.push(`Age: ${pt}`),rt&&Mt.push(`DOB: ${rt}`),Ct&&Mt.push(`Gender: ${Ct}`),Mt.length>0&&(G+=`

PATIENT DEMOGRAPHICS:
${Mt.join(`
`)}
Use these demographics when appropriate in the letter (e.g., salutations, patient identification).`,console.log("üìã Added patient demographics to Quick Letter streaming context:",{name:De,age:pt,dob:rt,gender:Ct}))}e.clearStream(),e.setStreaming(!0),e.setProcessingStatus("processing");const q=new AbortController;v.current=q;const{model:de,maxTokens:Ee}=Ft(I),Te=Date.now();e.setProcessingStartTime(Te),e.setPipelineProgress({stage:"ai-analysis",progress:50,stageProgress:10,details:`Generating ${I==="quick-letter"?"letter":"report"}`,modelName:de});let Qe=0,ze=!1,tt=null;const Xe=performance.now(),Je=hr.getInstance();return await Ap({model:de,messages:[{role:"system",content:G},{role:"user",content:R}],temperature:.3,maxTokens:Ee,signal:q.signal,onMessage:De=>{tt==null&&De?.choices?.[0]?.delta?.content&&(tt=Math.round(performance.now()-Xe),e.setTTFT(tt),e.updatePipelineProgress({stage:"generation",progress:70,stageProgress:20,details:"Streaming response"}))},onToken:De=>{e.appendStreamChunk(De)},onEnd:async(De,pt)=>{ze=!0,Qe=Date.now()-Te;let rt,Ct=De;if(I==="quick-letter")try{const Ze=Ku(De);rt=Ze.summary,Ct=Ze.letterContent,console.log("üìã Parsed QuickLetter streaming output:"),console.log("   Summary:",rt.substring(0,100)+"..."),console.log("   Letter content length:",Ct.length)}catch(Ze){console.warn("‚ö†Ô∏è Failed to parse QuickLetter output:",Ze),rt=aB(De),Ct=De}e.streamDone(Ct,pt,tt),rt&&e.setAiGeneratedSummary(rt),I==="quick-letter"?(console.log("üîç Streaming completion: detecting missing information for QuickLetter"),(async()=>{try{const{QuickLetterAgent:Ze}=await $e(async()=>{const{QuickLetterAgent:ve}=await import("./chunks/agents.w_LsrkjM.js").then(Ur=>Ur.m);return{QuickLetterAgent:ve}},__vite__mapDeps([7,8,4,2,1])),gA=new Ze,lt=R.toLowerCase(),or={letter_type:"general",missing_purpose:[],missing_clinical:[],missing_recommendations:[],completeness_score:"80%"};!lt.includes("refer")&&!lt.includes("follow up")&&!lt.includes("consultation")&&!lt.includes("thank you")&&or.missing_purpose.push("Letter purpose or reason for correspondence"),!lt.includes("patient")&&!lt.includes("gentleman")&&!lt.includes("lady")&&!lt.includes("year old")&&!lt.includes("age")&&or.missing_clinical.push("Patient demographics or context"),!lt.includes("examination")&&!lt.includes("found")&&!lt.includes("shows")&&!lt.includes("revealed")&&!lt.includes("noted")&&lt.length>100&&or.missing_clinical.push("Clinical examination findings");const Js=or.missing_purpose.length+or.missing_clinical.length+or.missing_recommendations.length;Js>0?(console.log("üìä Setting missing information from streaming completion:",Js,"items"),e.setMissingInfo(or)):(console.log("‚úÖ No missing information detected during streaming completion"),e.setMissingInfo(null))}catch(Ze){console.warn("‚ö†Ô∏è Failed to detect missing information during streaming:",Ze)}})()):(console.log(`üßπ Streaming completion: clearing missing info for ${I} agent (not quick-letter)`),e.setMissingInfo(null)),console.log("üèÅ Workflow Completion: Using atomic completion for streaming results"),console.log("üèÅ State Check: Before atomic completion - Processing:",r.isProcessing,"Status:",r.processingStatus,"Streaming:",r.streaming);try{console.log("üîß PRESERVING AGENT TYPE (streaming path):",I,"for session:",B),e.setCurrentAgent(I),e.completeProcessingAtomic(B,Ct,rt),console.log("üèÅ Workflow Completion: Atomic completion done for streaming workflow"),setTimeout(()=>{(r.streaming||r.currentSessionId!==null)&&(console.warn("üö® UI still showing active state after completion - forcing ready state"),e.forceUIReadyState())},1e3)}catch(Ze){console.error("‚ùå Atomic completion failed for streaming workflow:",Ze),e.forceUIReadyState()}v.current=null,e.updatePatientSession(B,{results:Ct,summary:rt,status:"completed",completed:!0,completedTime:Date.now(),processingProgress:{phase:"Complete",progress:100,details:"Streaming finished"}});const Mt=r.patientSessions.find(Ze=>Ze.id===B);Mt&&await Ne({...Mt,results:Ct,summary:rt,status:"completed",completed:!0,completedTime:Date.now()}),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{e.updatePatientSession(B,{processingProgress:void 0}),x.current=null},300)},onError:De=>{De.name==="AbortError"?e.streamCancelled():e.streamError(String(De)),e.setStreaming(!1),e.setAiGeneratedSummary(void 0),v.current=null}}),ze?(Je.recordMetrics("agent-processing",Qe,{agentType:I}),{handled:!0,success:!0,processingDuration:Qe,modelUsed:de}):{handled:!1,success:!1}},[e,Pe]),[At,mt]=u.useState(!1);u.useCallback(()=>(C.current||(C.current=new Ou),C.current),[]);const Qt=u.useCallback((B,I,R,_,G)=>{const q=()=>{const de={id:`failed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,audioBlob:B,timestamp:Date.now(),agentType:I,errorMessage:R,transcriptionAttempt:_,metadata:{duration:G||Q.current||0,fileSize:B.size,recordingTime:G||Q.current||0}};e.setFailedRecordings([de,...r.failedAudioRecordings.slice(0,4)])};"requestIdleCallback"in window?requestIdleCallback(q,{timeout:1e3}):setTimeout(q,0)},[e,r.failedAudioRecordings]);u.useCallback(()=>{e.setFailedRecordings([]),console.log("üóëÔ∏è Cleared all failed audio recordings")},[e]);const It=u.useCallback(async(B,I,R)=>{console.log("üîÑ Starting background processing for session:",B),console.log("üéØ Current selectedSessionId at start:",r.selectedSessionId);let _="";const G=new AbortController;try{e.updatePatientSession(B,{transcriptionStartTime:Date.now()}),e.setPipelineProgress({stage:"transcribing",progress:15,stageProgress:10,details:"Queued for transcription",modelName:"MLX Whisper v3-turbo"}),e.updatePatientSession(B,{pipelineProgress:{stage:"transcribing",progress:15,stageProgress:10,details:"Queued for transcription",modelName:"MLX Whisper v3-turbo"}}),console.log("üîÑ Queuing transcription for session:",B);const q=Date.now(),de=hr.getInstance(),{AudioProcessingQueueService:Ee}=await $e(async()=>{const{AudioProcessingQueueService:xe}=await import("./chunks/AudioProcessingQueueService.BquiCdnl.js");return{AudioProcessingQueueService:xe}},__vite__mapDeps([11,4,2,1,7,8])),Te=Ee.getInstance();_=await new Promise((xe,je)=>{Te.addJob(B,I,R,{onProgress:(Ge,en)=>{console.log(`üìä Session ${B} transcription status:`,Ge,en||""),Ge==="processing"?(e.setPipelineProgress({stage:"transcribing",progress:30,stageProgress:60,details:"Transcribing with Whisper",modelName:"MLX Whisper v3-turbo"}),e.updatePatientSession(B,{status:"transcribing",pipelineProgress:{stage:"transcribing",progress:30,stageProgress:60,details:"Transcribing with Whisper",modelName:"MLX Whisper v3-turbo"}})):(Ge==="failed"||Ge==="cancelled")&&(e.clearPipelineProgress(),e.updatePatientSession(B,{status:"error",errors:[en||"Transcription failed"],completedTime:Date.now(),processingProgress:void 0,pipelineProgress:void 0}))},onComplete:Ge=>{console.log("‚úÖ Queued transcription completed for session:",B),xe(Ge)},onError:Ge=>{console.error("‚ùå Queued transcription failed for session:",B,Ge),je(new Error(Ge))}})});const Qe=Date.now()-q;de.recordMetrics("transcription",Qe,{agentType:R,audioSize:I.size}),console.log("‚úÖ Transcription complete for session:",B),console.log("üìù Transcription result:",_.substring(0,200)+(_.length>200?"...":""));let ze=_,tt=0;try{const je=await CA.getInstance().applyPhrasebookCorrections(_,R);ze=je.correctedText,tt=je.appliedCorrections,tt>0&&(console.log(`üìñ Applied ${tt} phrasebook corrections`),ce.getInstance().info(`Applied ${tt} terminology correction${tt===1?"":"s"}`))}catch(xe){console.warn("‚ö†Ô∏è Failed to apply phrasebook corrections:",xe)}const Xe=ze.trim(),Je=Xe.length<10,De=Xe.length===0,pt=Xe.startsWith("[")&&Xe.endsWith("]"),rt=Xe.toLowerCase().includes("transcription failed")||Xe.toLowerCase().includes("server not running")||Xe.toLowerCase().includes("timed out");if(De||Je||pt||rt){console.warn("‚ùå Transcription validation failed:",{length:Xe.length,isEmpty:De,tooShort:Je,isPlaceholder:pt,isError:rt,preview:Xe.substring(0,100)}),setTimeout(()=>{Qt(I,R,`Transcription validation failed: ${De?"Empty transcription":Je?`Too short (${Xe.length} chars)`:pt?"Placeholder response":"Transcription error"}`,Xe);const je=De?"no-audio":Je?"too-short":pt?"service-unavailable":"error";Qa.transcriptionFailed(je);const Ge=De?"No audio detected":Je?"Recording too short":pt?"Transcription service unavailable":"Transcription service error";e.updatePatientSession(B,{transcription:Xe,status:"error",errors:[`Audio transcription failed: ${Ge}`],completedTime:Date.now()}),e.setTranscription(Xe),e.setErrors([`Audio transcription failed: ${Ge}`]),e.setProcessingStatus("error")},0),console.log("üö´ Skipping agent processing due to transcription validation failure");return}console.log("‚úÖ Transcription validation passed, proceeding with agent processing"),e.setPipelineProgress({stage:"ai-analysis",progress:45,stageProgress:10,details:"Loading AI agent",modelName:"MedGemma-27B"});const Ct=Date.now();e.updatePatientSession(B,{transcription:ze,status:"processing",processingStartTime:Ct,pipelineProgress:{stage:"ai-analysis",progress:45,stageProgress:10,details:"Loading AI agent",modelName:"MedGemma-27B"}}),e.setTranscription(ze),e.setProcessingStatus("processing"),e.setTimingData({processingStartTime:Ct}),e.setTranscriptionApproval({status:"pending",originalText:_,currentText:_,hasBeenEdited:!1});const Mt=R==="quick-letter"&&r.currentPatientInfo?{sessionId:B,timestamp:Date.now(),patientInfo:r.currentPatientInfo}:void 0;Mt&&console.log("üìã Passing patient demographics to streaming generation:",{name:r.currentPatientInfo?.name,age:r.currentPatientInfo?.age,dob:r.currentPatientInfo?.dob});const Ze=await sr(B,R,_,Mt);if(Ze.handled){if(Ze.success){const xe=Date.now()-q;de.recordMetrics("complete",xe,{agentType:R});try{await En.getInstance().storeMetric({agentType:R,transcriptionTime:Qe,processingTime:Ze.processingDuration??0,totalDuration:xe,modelUsed:Ze.modelUsed||"Unknown",success:!0})}catch(je){console.error("Failed to store performance metrics (streaming):",je)}try{const je=Nr.getInstance(),Ge=r.patientSessions.find(en=>en.id===B);Ge&&Ze.processingDuration&&(je.recordActualProcessingTime(R,_.length,Ze.processingDuration,Ge.audioDuration),console.log(`üìä Recorded processing time for ${R} (streaming): ${Ze.processingDuration}ms (transcription: ${_.length} chars, audio: ${Ge.audioDuration?.toFixed(1)}s)`))}catch(je){console.warn("Failed to record processing time for prediction (streaming):",je)}}return}console.log("üîÑ Processing with agent for session (non-streaming):",B,R);const gA=Date.now(),{AgentFactory:lt}=await $e(async()=>{const{AgentFactory:xe}=await import("./chunks/AgentFactory.LTvMbl2o.js");return{AgentFactory:xe}},__vite__mapDeps([18,4,2,1,7,8,10,5,6]));e.updatePatientSession(B,{status:"processing",processingStartTime:Date.now(),processingProgress:{phase:"Starting",progress:0,details:"Initializing agent"}}),e.setProcessingProgress(0);const or={skipNotification:!0,sessionId:B};or.onProgress=(xe,je,Ge)=>{console.log(`${R==="tavi-workup"?"ü´Ä TAVI":"ü§ñ"} Progress: ${xe} (${je}%) - ${Ge||""}`);const tn=Math.max(0,Math.min(100,je)),bA=40+tn*.5;e.setPipelineProgress({stage:"ai-analysis",progress:bA,stageProgress:tn,details:Ge||xe||"Processing with AI",modelName:"MedGemma-27B"}),e.updatePatientSession(B,{status:"processing",processingProgress:{phase:xe||"Processing",progress:tn,details:Ge},pipelineProgress:{stage:"ai-analysis",progress:bA,stageProgress:tn,details:Ge||xe||"Processing with AI",modelName:"MedGemma-27B"}}),e.setProcessingProgress(tn)};let Js;R==="quick-letter"&&r.currentPatientInfo&&(Js={sessionId:B,timestamp:Date.now(),patientInfo:r.currentPatientInfo},console.log("üìã Added patient demographics to Quick Letter context:",{name:r.currentPatientInfo.name,age:r.currentPatientInfo.age,dob:r.currentPatientInfo.dob}));const ve=await lt.processWithAgent(R,ze,Js,G.signal,or),Ur=Date.now()-gA;de.recordMetrics("agent-processing",Ur,{agentType:R}),console.log("‚úÖ Agent processing complete for session:",B),e.setPipelineProgress({stage:"generation",progress:95,stageProgress:50,details:"Formatting output",modelName:"MedGemma-27B"});const Zs={results:ve.content,summary:ve.summary||"",agentName:ve.agentName,modelUsed:ve.modelUsed,status:"completed",completed:!0,completedTime:Date.now(),processingTime:ve.processingTime,warnings:ve.warnings,errors:ve.errors,processingProgress:{phase:"Complete",progress:100,details:"Processing finished"},pipelineProgress:{stage:"generation",progress:100,stageProgress:100,details:"Complete"}};Zs.preOpPlanData=ve.preOpPlanData,ve.taviStructuredSections&&(Zs.taviStructuredSections=ve.taviStructuredSections),console.log("üö® STATE: Checking for rhcData in result..."),console.log("üö® STATE: Result keys:",Object.keys(ve)),console.log("üö® STATE: Has rhcData?","rhcData"in ve),"rhcData"in ve&&(console.log("üö® STATE: Storing RHC report to session"),console.log("üö® STATE: RHC report structure:",{hasRhcData:!!ve.rhcData,hasHaemodynamics:!!ve.haemodynamicPressures,hasCalculations:!!ve.calculations}),Zs.rhcReport=ve),e.updatePatientSession(B,Zs);const hA=r.patientSessions.find(xe=>xe.id===B);hA&&await Ne({...hA,...Zs}),e.setProcessingProgress(100),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{e.updatePatientSession(B,{processingProgress:void 0,pipelineProgress:void 0}),e.setProcessingProgress(0),e.clearPipelineProgress(),x.current=null},300),de.recordMetrics("complete",Date.now()-q,{agentType:R});try{await En.getInstance().storeMetric({agentType:R,transcriptionTime:Qe,processingTime:Ur,totalDuration:Date.now()-q,modelUsed:ve.agentName||"Unknown",success:!0})}catch(xe){console.error("Failed to store performance metrics:",xe)}try{const xe=Nr.getInstance(),je=r.patientSessions.find(Ge=>Ge.id===B);je&&(xe.recordActualProcessingTime(R,_.length,Ur,je.audioDuration),console.log(`üìä Recorded processing time for ${R}: ${Ur}ms (transcription: ${_.length} chars, audio: ${je.audioDuration?.toFixed(1)}s)`))}catch(xe){console.warn("Failed to record processing time for prediction:",xe)}const ps=B===r.selectedSessionId;if(ps?(e.setTranscription(_),e.setResults(ve.content),e.setPreOpPlanData(ve.preOpPlanData),e.setMissingInfo(ve.missingInfo||null),ve.taviStructuredSections&&e.setTaviStructuredSections(ve.taviStructuredSections),"rhcData"in ve&&e.setRhcReport(ve),console.log("üéØ Updated main results panel for currently selected session:",B)):console.log("üîï Background session completed, results stored in session only:",B),R==="bloods")try{console.log("ü©∏ Bloods workflow completed - inserting results into Tests Requested field");const xe={content:ve.content};(await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods-insert",data:xe}))?.success?console.log("‚úÖ Blood test results inserted into Tests Requested field successfully"):console.warn("‚ö†Ô∏è Failed to insert blood test results into Tests Requested field")}catch(xe){console.error("‚ùå Failed to insert blood test results into Tests Requested field:",xe)}console.log("üîß PRESERVING AGENT TYPE:",R,"for session:",B),e.setCurrentAgent(R),console.log("‚úÖ Agent type preserved:",R),ps&&(ve.summary&&ve.summary.trim()?(oe.debug("Setting AI-generated summary",{component:"summary",length:ve.summary.length}),e.setAiGeneratedSummary(ve.summary)):e.setAiGeneratedSummary(void 0),console.log("üéØ Updated agent and summary for currently selected session:",B));const fA=r.patientSessions.find(xe=>xe.id===B),xA=fA?.recordingStartTime?q-fA.recordingStartTime:0;if(console.log("üîç Session completion check:",{sessionId:B,currentSelectedSessionId:r.selectedSessionId,isCurrentlySelectedAtCompletion:ps,willUpdateGlobalUI:ps}),ps){e.setTimingData({recordingTime:xA,transcriptionTime:Qe,agentProcessingTime:Ur,totalProcessingTime:xA+Qe+Ur,processingStartTime:q}),console.log("üèÅ Background Workflow Completion: Using atomic completion for background session"),console.log("üèÅ State Check: Before atomic completion - Processing:",r.isProcessing,"Status:",r.processingStatus,"Streaming:",r.streaming);const xe=ve.summary||ve.content||"Workflow completed";try{e.completeProcessingAtomic(B,ve.content,xe),console.log("üèÅ Background completion successful"),setTimeout(()=>{(r.streaming||r.currentSessionId!==null)&&(console.warn("üö® UI still showing active state after background completion - forcing ready state"),e.forceUIReadyState())},1e3)}catch(je){console.error("‚ùå Atomic completion failed for background session:",je),e.forceUIReadyState()}ve.missingInfo&&e.setMissingInfo(ve.missingInfo),ve.taviStructuredSections&&e.setTaviStructuredSections(ve.taviStructuredSections),"rhcData"in ve&&e.setRhcReport(ve),console.log("üèÅ Background Workflow Completion: Atomic completion done for background workflow"),console.log("üéØ Updated global UI state for currently selected session:",B)}else console.log("üîï Background session completed, skipping global UI state updates for:",B);console.log("‚úÖ Session completed in background:",B);try{const xe=r.patientSessions.find(je=>je.id===B)?.patient.name||"Unknown Patient";await Oc.showCompletionNotification(R,ve.processingTime||0,void 0,xe),console.log("üéâ Background session completed for:",xe),Qa.sessionReady(xe,R)}catch(xe){console.warn("Failed to send completion notification:",xe)}if(ps)try{const xe=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;setTimeout(()=>{const je=E.current||document.getElementById("results-section");je&&typeof je.scrollIntoView=="function"&&(je.scrollIntoView({behavior:xe?"auto":"smooth",block:"start"}),console.log("üéØ Auto-scrolled to results for currently selected session:",B))},50)}catch(xe){console.debug("Auto-scroll to results failed (non-critical):",xe instanceof Error?xe.message:xe);try{const je=E.current||document.getElementById("results-section");je&&typeof je.focus=="function"&&je.focus({preventScroll:!1})}catch(je){console.debug("Fallback focus also failed:",je instanceof Error?je.message:je)}}else console.log("üîï Background session completed, skipping auto-scroll for:",B)}catch(q){if(console.error("‚ùå Background processing failed for session:",B,q),lp(q)){console.error("üíæ Model loading failed - showing error dialog"),W(q),L({sessionId:B,audioBlob:I,workflowId:R,transcription:_}),e.updatePatientSession(B,{status:"error",errors:["Model loading failed - awaiting user action"],processingProgress:void 0});return}setTimeout(()=>{if(e.setProcessing(!1),e.setProcessingStatus("idle"),q.name==="AbortError")e.updatePatientSession(B,{status:"cancelled",errors:["Processing was cancelled"],processingProgress:void 0});else{const Te=r.patientSessions.find(Qe=>Qe.id===B)?.patient.name||"Unknown Patient";e.updatePatientSession(B,{status:"error",errors:[q.message||"Processing failed"],processingProgress:void 0}),Qa.processingFailed(Te)}Qt(I,R,q.message||"Background processing failed","",0)},0)}},[e,f,Qt,r.patientSessions]),Ut=u.useCallback(async(B,I,R,_)=>{console.log("‚ôªÔ∏è Retrying background processing for session:",B),await It(B,I,R)},[It]),br=u.useCallback(async B=>{if(j.current=B,r.ui.isCancelling){console.log("üõë Recording completed but cancellation in progress - ignoring"),e.setCancelling(!1);return}const I=o.current||r.ui.activeWorkflow,R=A.current||r.currentSessionId;if(!I){console.error("‚ùå No active workflow selected"),e.setErrors(["No workflow selected. Please select a workflow type before recording."]);return}if(!R){console.error("‚ùå No current session found"),e.setErrors(["No active session. Please start a new recording."]);return}let _;try{const de=new AudioContext,Ee=await B.arrayBuffer();_=(await de.decodeAudioData(Ee)).duration,await de.close(),console.log(`üéµ Audio duration calculated: ${_.toFixed(1)}s`)}catch(de){console.warn("‚ö†Ô∏è Failed to calculate audio duration:",de)}console.log("üé§ Recording completed, starting background processing for session:",R),e.setPipelineProgress({stage:"audio-processing",progress:5,stageProgress:50,details:"Validating recording format"}),e.updatePatientSession(R,{status:"transcribing",audioBlob:B,audioDuration:_,pipelineProgress:{stage:"audio-processing",progress:5,stageProgress:50,details:"Validating recording format"}}),e.setCurrentSessionId(null),A.current=null,e.setActiveWorkflow(null),o.current=null,e.setSelectedSessionId(null),e.clearRecording();const q=r.patientSessions.find(de=>de.id===R)?.patient.name||"Patient";Qa.recordingSent(q,I),It(R,B,I),console.log("üöÄ Background processing started for session:",R,"- ready for new recordings!")},[e,It,r.ui.isCancelling,r.currentSessionId]),Jr=u.useCallback((B,I)=>{u.startTransition(()=>{e.setVoiceActivity(B,I)})},[e]);u.useEffect(()=>{O.current=br,z.current=Jr},[br,Jr]);const nr=u.useCallback(B=>{console.log("üìã üîç USER EXPLICIT SESSION SELECTION - Selected:",{patientName:B.patient.name,sessionId:B.id,status:B.status,hasTranscription:!!B.transcription,hasResults:!!B.results,hasSummary:!!B.summary,agentType:B.agentType,currentBackgroundWork:{isRecording:H.isRecording,isProcessing:r.isProcessing,streaming:r.streaming,currentSessionId:r.currentSessionId}}),u.startTransition(()=>{console.log("üìã üéØ Loading session into isolated display state:",B.id),e.setDisplaySession(B),e.setUIMode("reviewing",{sessionId:B.id,origin:"user"}),(B.status==="processing"||B.status==="transcribing")&&(e.openOverlay("field-ingestion"),console.log("üìä Opened field-ingestion overlay for processing session:",B.id)),console.log("‚úÖ üìã SESSION SELECT COMPLETE - Session loaded in isolated display (will show even during active work):",{patientName:B.patient.name,sessionId:B.id,status:B.status,priorityLevel:"PRIORITY 1 - User Explicit Selection"}),setTimeout(()=>{console.log("üîç DISPLAY STATE CHECK - Post session selection:",{isDisplayingSession:r.displaySession?.isDisplayingSession,displaySessionId:r.displaySession?.displaySessionId,displayResultsLength:r.displaySession?.displayResults?.length||0,displayTranscriptionLength:r.displaySession?.displayTranscription?.length||0,activeRecordingResults:r.results?.length||0,activeRecordingTranscription:r.transcription?.length||0,isRecording:H.isRecording,currentSessionId:r.currentSessionId})},100)})},[e,r.displaySession,r.results,r.transcription,r.currentSessionId,H.isRecording]),Vn=u.useCallback(B=>{e.setSelectedSessionId(B.id),e.setUIMode("recording",{sessionId:B.id,origin:"user"})},[e]),Zr=u.useCallback(B=>{const I=Date.now();e.updatePatientSession(B.id,{reviewedAt:I,finalizedAt:I,completed:!0,status:"completed"})},[e]),ar=u.useCallback(B=>{const I=B.split(/[.!?]+/).filter(G=>G.trim().length>0);if(I.length===0)return B.substring(0,150)+"...";const R=["stenosis","regurgitation","valve","artery","diagnosis","treatment"],_=I.filter(G=>R.some(q=>G.toLowerCase().includes(q)));return _.length>0?_.slice(0,2).join(". ").trim()+".":I[0]?.trim()+"."},[]);u.useCallback((B,I)=>I&&I.trim()?I.trim():ar(B),[ar]);const Gn=u.useCallback(()=>{if(r.displaySession.isDisplayingSession&&r.displaySession.displaySessionId){const I={transcription:r.displaySession.displayTranscription,results:r.displaySession.displayResults,summary:r.displaySession.displaySummary,taviStructuredSections:r.displaySession.displayTaviStructuredSections,educationData:r.displaySession.displayEducationData,preOpPlanData:r.displaySession.displayPreOpPlanData,reviewData:r.displaySession.displayReviewData,rhcReport:r.displaySession.displayRhcReport,agent:r.displaySession.displayAgent??null,agentName:r.displaySession.displayAgentName??null,patientInfo:r.displaySession.displayPatientInfo??null,processingTime:r.displaySession.displayProcessingTime??null,modelUsed:r.displaySession.displayModelUsed??null,audioDuration:r.displaySession.displayAudioDuration??null,pipelineProgress:r.displaySession.displayPipelineProgress??null,processingStatus:"complete",isDisplayingSession:!0};return console.log("üîç getCurrentDisplayData - Displaying session:",{sessionId:r.displaySession.displaySessionId,agent:I.agent,hasResults:!!I.results,resultsLength:I.results?.length||0,hasSummary:!!I.summary,summaryLength:I.summary?.length||0,hasTranscription:!!I.transcription,transcriptionLength:I.transcription?.length||0,patientName:I.patientInfo?.name||"Unknown",hasPipelineProgress:!!I.pipelineProgress,pipelineStage:I.pipelineProgress?.stage,pipelineProgressPercent:I.pipelineProgress?.progress}),I}return H.isRecording||r.isProcessing||r.streaming||r.currentSessionId!==null?(r.streaming&&r.results&&r.processingStatus==="complete"&&console.warn("üö® POTENTIAL STUCK STREAMING STATE DETECTED:",{streaming:r.streaming,hasResults:!!r.results,resultsLength:r.results.length,processingStatus:r.processingStatus,streamBuffer:r.streamBuffer?.length||0}),{transcription:r.transcription,results:r.results,summary:r.aiGeneratedSummary,taviStructuredSections:r.taviStructuredSections,educationData:r.educationData,preOpPlanData:r.preOpPlanData,reviewData:r.reviewData,rhcReport:r.rhcReport,agent:r.currentAgent,agentName:r.currentAgentName,patientInfo:r.currentPatientInfo,processingTime:r.totalProcessingTime,modelUsed:null,audioDuration:r.patientSessions.find(I=>I.id===r.currentSessionId)?.audioDuration??null,pipelineProgress:r.pipelineProgress,processingStatus:r.processingStatus,isDisplayingSession:!1}):{transcription:r.transcription,results:r.results,summary:r.aiGeneratedSummary,taviStructuredSections:r.taviStructuredSections,educationData:r.educationData,preOpPlanData:r.preOpPlanData,reviewData:r.reviewData,rhcReport:r.rhcReport,agent:r.currentAgent,agentName:r.currentAgentName,patientInfo:r.currentPatientInfo,processingTime:r.totalProcessingTime,modelUsed:null,audioDuration:null,pipelineProgress:r.pipelineProgress,processingStatus:r.processingStatus,isDisplayingSession:!1}},[H.isRecording,r.isProcessing,r.streaming,r.currentSessionId,r.transcription,r.results,r.aiGeneratedSummary,r.currentAgent,r.currentAgentName,r.currentPatientInfo,r.processingStatus,r.displaySession]),yr=u.useCallback(async()=>{try{console.log("üë§ Extracting patient data from EMR...");const B=await chrome.tabs.query({active:!0,currentWindow:!0});console.log("üîç Current active tab:",B[0]?.url);const I=3;let R=null;for(let _=1;_<=I;_++){console.log(`üîç Attempt ${_}/${I}: Sending extraction request to content script...`);try{const G=await Promise.race([chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),new Promise((q,de)=>setTimeout(()=>de(new Error("Patient extraction timeout")),1e4))]);if(console.log("üì¨ Received response from content script:",G),G?.success&&G?.data){const q=G.data;console.log(`‚úÖ Patient data extraction succeeded on attempt ${_}:`,q);const de=q.name&&q.name.trim()!=="",Ee=q.id&&q.id.trim()!=="";if(de||Ee)return console.log("‚úÖ Patient data validation passed - returning data"),q;console.warn(`‚ö†Ô∏è Attempt ${_}: Extracted data lacks name and ID - will retry`),R=new Error("Extracted data lacks required patient name or ID")}else console.warn(`‚ö†Ô∏è Attempt ${_}: No valid patient data in response`),R=new Error(G?.error||"No patient data found in response")}catch(G){if(console.warn(`‚ö†Ô∏è Attempt ${_} failed:`,G.message),R=G,_<I){const q=Math.min(1e3*Math.pow(2,_-1),5e3);console.log(`‚è≥ Waiting ${q}ms before retry...`),await new Promise(de=>setTimeout(de,q))}}}return console.error("‚ùå All patient extraction attempts failed. Last error:",R),null}catch(B){return console.error("‚ùå Critical error in patient data extraction:",B),console.error("üîç Error details:",{name:B instanceof Error?B.name:"Unknown",message:B instanceof Error?B.message:B,stack:B instanceof Error?B.stack:void 0}),null}},[]),qs=u.useCallback(async(B,I)=>{console.log("üéØ Workflow selected:",B,I?`(Quick Action field: ${I})`:""),console.log("üîç handleWorkflowSelect state:",{isRecording:H.isRecording,activeWorkflow:r.ui.activeWorkflow,workflowId:B,willStop:H.isRecording&&r.ui.activeWorkflow===B}),r.processingStatus==="error"&&(console.log("üîÑ Auto-recovering from error state - resetting to idle for new recording"),e.setProcessingStatus("idle"),e.setErrors([]),e.setWarnings([]),e.clearRecording()),(r.results?.trim().length>0||r.transcription?.trim().length>0)&&(console.log("üîÑ Clearing previous session before starting new workflow:",B),e.clearRecording()),r.displaySession.isDisplayingSession&&(console.log("üîÑ Clearing display session view for new recording"),e.clearDisplaySession(),e.setUIMode("idle",{sessionId:null,origin:"user"}));const R=r.patientSessions.filter(_=>["recording","transcribing","processing"].includes(_.status));if(H.isRecording&&r.ui.activeWorkflow===B){console.log("üõë Stopping current recording for:",B),H.stopRecording();return}if(!H.isRecording){if(R.length>=3){e.setErrors([`Too many active sessions (${R.length}). Please wait for some to complete before starting new recordings.`]);return}if(console.log(`üìä Current active sessions: ${R.length}/3 - proceeding with new recording`),console.log("üîç Checking Whisper server status before recording..."),!r.modelStatus.whisperServer?.running){console.error("‚ùå Whisper server not running"),e.setErrors(["Whisper server is not running. Please start the server first using: ./start-whisper-server.sh"]);return}console.log("üìã Extracting patient data for new recording..."),e.setProcessingStatus("extracting-patient");const _=performance.now();let G=null;try{F.invalidateCache(),console.log("üóëÔ∏è Cache invalidated - extracting fresh patient data"),G=await yr();const Ee=Math.round(performance.now()-_);if(console.log(`‚úÖ Patient data extracted in ${Ee}ms:`,G?.name||"No name found"),G)e.setCurrentPatientInfo(G);else throw new Error("No patient data found")}catch(Ee){console.error("‚ùå Patient data extraction failed:",Ee);const Te=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});G={name:`Patient ${(r.patientSessions?.length||0)+1} (${Te})`,id:`Session-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},e.setCurrentPatientInfo(G),console.log("üìù Using fallback patient info due to extraction error:",G.name)}finally{e.setProcessingStatus("idle")}const q=`session-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,de={id:q,patient:G,transcription:"",results:"",agentType:B,agentName:"",timestamp:Date.now(),status:"recording",completed:!1,recordingStartTime:Date.now(),...I&&{quickActionField:I}};e.addPatientSession(de),e.setCurrentSessionId(q),A.current=q,console.log("üìù Created new session:",q,"for patient:",de.patient.name),console.log("‚úÖ Whisper server is running, starting recording..."),e.setActiveWorkflow(B),o.current=B,e.setUIMode("recording",{sessionId:q,origin:"user"}),H.startRecording(),e.setProcessingStartTime(Date.now())}},[H,r.ui.activeWorkflow,e,yr,r.patientSessions,r.modelStatus]),Wn=u.useCallback(B=>{console.log("‚å®Ô∏è Type mode selected for workflow:",B),B==="quick-letter"&&(console.log("üìã Opening Paste Notes Panel for Quick Letter"),e.openOverlay("paste-notes"),e.setUIMode("configuring",{sessionId:r.selectedSessionId,origin:"user"}))},[e,r.selectedSessionId]),zn=u.useCallback(async B=>{try{if(await navigator.clipboard.writeText(B),console.log("üìã Text copied to clipboard"),r.currentSessionId){const I=r.patientSessions.find(R=>R.id===r.currentSessionId);I&&I.status==="completed"&&!I.reviewedAt&&(Zr(I),console.log("‚úÖ Auto-marked session as complete after copy"))}}catch(I){throw console.error("Failed to copy text:",I),I}},[r.currentSessionId,r.patientSessions,Zr]),[Bi,ir]=u.useState({status:"idle",message:""}),Ci=u.useCallback(async B=>{try{console.log("‚úèÔ∏è Transcription edited, length:",B.length),e.setTranscription(B);const I=r.transcription;if(I&&B!==I){const R={...r.transcriptionApproval,status:"edited",originalText:r.transcriptionApproval.originalText||I,currentText:B,hasBeenEdited:!0,editTimestamp:Date.now()};e.setTranscriptionApproval(R),ir({status:"idle",message:'Edit ready - click "Perfect" to submit for training'}),console.log("‚úèÔ∏è Transcription marked as edited, ready for approval")}else if(B===I){const R={...r.transcriptionApproval,status:"pending",currentText:B,hasBeenEdited:!1};e.setTranscriptionApproval(R),ir({status:"idle",message:""})}}catch(I){console.error("‚ùå Failed to handle transcription edit:",I),ir({status:"error",message:"‚ö† Failed to process edit",timestamp:new Date}),setTimeout(()=>{ir({status:"idle",message:""})},5e3)}},[r.transcription,r.transcriptionApproval,r.currentAgent,r.selectedSessionId,e]),es=u.useCallback(async B=>{try{console.log("‚úÖ Transcription approval status changed:",B);const I=r.transcription,R=r.transcriptionApproval,_={...R,status:B,currentText:I,approvalTimestamp:B==="approved"?Date.now():R.approvalTimestamp,editTimestamp:B==="edited"?Date.now():R.editTimestamp};if(e.setTranscriptionApproval(_),B==="approved"&&I.trim()!==""){console.log("üíæ Logging transcription for ASR training");const G=R.hasBeenEdited,q=R.originalText||I;await CA.getInstance().addCorrection({rawText:q,correctedText:I,agentType:r.currentAgent||"transcription",sessionId:r.selectedSessionId||"streaming",approvalStatus:"approved",userExplicitlyApproved:!0,approvalTimestamp:Date.now(),editTimestamp:G?R.editTimestamp||Date.now():void 0}),ir({status:"saved",message:G?"‚úì Corrected transcription saved for training":"‚úì Perfect transcription saved for training",timestamp:new Date}),setTimeout(()=>{ir({status:"idle",message:""})},3e3)}}catch(I){console.error("‚ùå Failed to handle transcription approval:",I),ir({status:"error",message:"‚ö† Failed to save approval",timestamp:new Date}),setTimeout(()=>{ir({status:"idle",message:""})},5e3)}},[r.transcription,r.transcriptionApproval,r.currentAgent,r.selectedSessionId,e]),Ni=u.useCallback(async B=>{try{if(console.log("üîÑ Reprocessing transcription with agent:",B),!r.transcription||r.transcription.trim().length===0){console.error("‚ùå No transcription available for reprocessing"),e.setErrors(["No transcription available for reprocessing"]);return}if(r.isProcessing){console.warn("‚ö†Ô∏è Already processing, ignoring reprocess request");return}e.setResults(""),e.setWarnings([]),e.setErrors([]),e.setResultsSummary(""),e.setProcessing(!0),e.setProcessingStatus("processing"),e.setCurrentAgent(B),e.setProcessingStartTime(Date.now()),console.log("üîÑ Starting agent processing with:",B),e.setMissingInfo(null);const{AgentFactory:I}=await $e(async()=>{const{AgentFactory:_}=await import("./chunks/AgentFactory.LTvMbl2o.js");return{AgentFactory:_}},__vite__mapDeps([18,4,2,1,7,8,10,5,6])),R=await I.processWithAgent(B,r.transcription,{isReprocessing:!0},v.current?.signal);console.log("‚úÖ Agent reprocessing completed"),e.setResults(R.content),e.setMissingInfo(R.missingInfo||null),R.taviStructuredSections&&e.setTaviStructuredSections(R.taviStructuredSections),"rhcData"in R&&e.setRhcReport(R),R.summary&&R.summary.trim()?(oe.debug("Setting AI-generated summary from reprocessing",{component:"summary",agent:B}),e.setAiGeneratedSummary(R.summary)):e.setAiGeneratedSummary(void 0),e.setTimingData({agentProcessingTime:R.processingTime,totalProcessingTime:R.processingTime}),e.setCurrentAgentName(R.agentName),e.completeProcessingAtomic(r.currentSessionId||"reprocess-session",R.content),R.warnings?.length&&e.setWarnings(R.warnings),R.errors?.length&&e.setErrors(R.errors)}catch(I){console.error("‚ùå Agent reprocessing failed:",I),e.setProcessing(!1),e.setProcessingStatus("idle"),I.name==="AbortError"?console.log("üõë Agent reprocessing was cancelled"):e.setErrors([I.message||"Reprocessing failed"])}},[r.transcription,r.isProcessing,e]),ms=u.useCallback(async B=>{try{if(!r.transcription||!r.currentAgent)return;e.setProcessing(!0),e.setProcessingStatus("processing");const I=Object.entries(B).filter(([q,de])=>de&&de.trim().length>0).map(([q,de])=>`- ${q}: ${de.trim()}`).join(`
`),R=`${r.transcription}

Additional details provided by clinician to fill missing information:
${I}`,{AgentFactory:_}=await $e(async()=>{const{AgentFactory:q}=await import("./chunks/AgentFactory.LTvMbl2o.js");return{AgentFactory:q}},__vite__mapDeps([18,4,2,1,7,8,10,5,6])),G=await _.processWithAgent(r.currentAgent,R,{isReprocessing:!0,withMissingInfo:!0},v.current?.signal);e.setMissingInfo(G.missingInfo||null),G.taviStructuredSections&&e.setTaviStructuredSections(G.taviStructuredSections),"rhcData"in G&&e.setRhcReport(G),e.completeProcessingAtomic(r.currentSessionId||"missing-info-session",G.content)}catch(I){console.error("Reprocess with missing info failed:",I),e.setProcessing(!1),e.setProcessingStatus("idle")}},[r.transcription,r.currentAgent,e]),Ys=u.useCallback(async()=>{if(!(!r.results||r.isGeneratingPatientVersion||!(r.currentAgent==="quick-letter"||r.currentAgent==="angiogram-pci")))try{console.log(`üéØ Generating patient-friendly version for ${r.currentAgent}`),e.setGeneratingPatientVersion(!0);let I;if(r.currentAgent==="quick-letter"){const{QuickLetterAgent:R}=await $e(async()=>{const{QuickLetterAgent:G}=await import("./chunks/agents.w_LsrkjM.js").then(q=>q.m);return{QuickLetterAgent:G}},__vite__mapDeps([7,8,4,2,1]));I=await new R().generatePatientVersion(r.results)}else if(r.currentAgent==="angiogram-pci"){const{AngiogramPCIAgent:R}=await $e(async()=>{const{AngiogramPCIAgent:G}=await import("./chunks/agents.w_LsrkjM.js").then(q=>q.n);return{AngiogramPCIAgent:G}},__vite__mapDeps([7,8,4,2,1]));I=await new R().generatePatientVersion(r.results)}else throw new Error(`Patient version not supported for ${r.currentAgent}`);e.setPatientVersion(I),console.log("‚úÖ Patient version generated successfully")}catch(I){console.error("‚ùå Failed to generate patient version:",I),e.setPatientVersion("Error generating patient version. Please try again.")}finally{e.setGeneratingPatientVersion(!1)}},[r.results,r.currentAgent,r.isGeneratingPatientVersion,e]),ji=u.useCallback(async B=>{try{console.log("üîç Starting patient name validation before EMR insertion");let I="";if(r.selectedSessionId){const G=r.patientSessions.find(q=>q.id===r.selectedSessionId);G&&(I=G.patient.name,console.log("üìã Using selected session patient name:",I))}else if(r.currentSessionId){const G=r.patientSessions.find(q=>q.id===r.currentSessionId);G&&(I=G.patient.name,console.log("üìã Using current session patient name:",I))}else r.currentPatientInfo?.name&&(I=r.currentPatientInfo.name,console.log("üìã Using current patient info name:",I));let R="";try{const G=await yr();G?.name?(R=G.name,console.log("üè• Extracted fresh EMR patient name:",R)):r.currentPatientInfo?.name&&(R=r.currentPatientInfo.name,console.log("üè• Using cached EMR patient name:",R))}catch(G){console.warn("‚ö†Ô∏è Failed to extract fresh patient data, using cached:",G),r.currentPatientInfo?.name&&(R=r.currentPatientInfo.name)}if(jc.shouldSkipValidation(I,R))return console.log("‚è© Skipping patient name validation - insufficient data"),!0;const _=jc.validatePatientNames(I,R);return console.log("üìä Patient name validation result:",_),_.isMatch?(console.log("‚úÖ Patient names match - proceeding with insertion"),!0):(console.log("‚ö†Ô∏è Patient name mismatch detected - showing confirmation modal"),new Promise(G=>{e.setPatientMismatchData({comparison:_,textToInsert:B,onConfirm:()=>{console.log("‚úÖ User confirmed insertion despite mismatch"),e.closeOverlay("patient-mismatch"),e.setPatientMismatchData({comparison:null,textToInsert:null,onConfirm:null,onCancel:null}),G(!0)},onCancel:()=>{console.log("‚ùå User cancelled insertion due to mismatch"),e.closeOverlay("patient-mismatch"),e.setPatientMismatchData({comparison:null,textToInsert:null,onConfirm:null,onCancel:null}),G(!1)}}),e.openOverlay("patient-mismatch"),e.setUIMode("reviewing",{sessionId:r.selectedSessionId||null,origin:"auto"})}))}catch(I){return console.error("‚ùå Patient name validation failed:",I),console.log("‚ö†Ô∏è Allowing insertion due to validation error"),!0}},[r.selectedSessionId,r.currentSessionId,r.patientSessions,r.currentPatientInfo,yr,e]),Xn=u.useCallback(async(B,I,R)=>{try{if(!await ji(B)){console.log("üõë Insertion cancelled due to patient mismatch");return}console.log("‚úÖ Patient validation passed - proceeding with insertion");const G=Gn(),de=(r.patientSessions.find(Je=>Je.id===r.currentSessionId)||r.patientSessions.find(Je=>Je.id===r.displaySession.displaySessionId))?.quickActionField,Ee=I?null:R||G.agent||r.currentAgent||r.ui.activeWorkflow,Te=I||de||_u(Ee);console.log("üîç EMR insertion debug:"),console.log("  - agentContext:",R),console.log("  - currentAgent:",r.currentAgent),console.log("  - activeWorkflow:",r.ui.activeWorkflow),console.log("  - displayData.agent:",G.agent),console.log("  - currentAgentType:",Ee),console.log("  - targetField:",I),console.log("  - quickActionField (from session):",de),console.log("  - field (final):",Te),console.log("  - supportsFieldSpecific:",Nc(Ee)),console.log("  - isDisplayingSession:",G.isDisplayingSession);const ze=Ee!==null&&["angiogram-pci","quick-letter"].includes(Ee);if(ze&&console.log("üìù Agent requires direct cursor insertion - bypassing field mapping."),!ze&&Te&&(de||Nc(Ee)))console.log(`üìù Opening ${Cc(Te)} field and appending content`),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:Te,data:{insertMode:"append",content:B}}),console.log(`‚úÖ Content appended to ${Cc(Te)} field`);else if(!ze&&B&&B.trim().length>0){console.log("üîç No agent type but have text to insert - trying Quick Action field detection");const Je=[{action:"medications",displayName:"Medications (Problem List for Phil)"},{action:"investigation-summary",displayName:"Investigation Summary"},{action:"background",displayName:"Background"}];let De=!1;for(const pt of Je)try{console.log(`üîç Attempting ${pt.displayName}...`);const rt=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:pt.action,data:{insertMode:"append",content:B}});if(rt&&rt.success!==!1){console.log(`‚úÖ Successfully inserted to ${pt.displayName}`),De=!0;break}}catch{console.log(`‚ö†Ô∏è ${pt.displayName} attempt failed, trying next...`);continue}De||(console.log("üìù All Quick Action fields failed - using generic insertion"),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insertText",data:{text:B}}))}else console.log("üìù Using generic EMR text insertion (no specific field mapping)"),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insertText",data:{text:B}}),console.log("üìù Text inserted to EMR (generic)");const tt=r.currentSessionId||r.displaySession.displaySessionId;if(tt){const Je=r.patientSessions.find(De=>De.id===tt);Je&&Je.status==="completed"&&!Je.reviewedAt&&(Zr(Je),console.log("‚úÖ Auto-marked session as complete after EMR insertion:",tt))}const Xe=r.currentSessionId||r.displaySession.displaySessionId;Xe&&(m(Je=>{const De=new Set(Je);return De.add(Xe),De}),console.log("‚úÖ Auto-checked session in dropdown after EMR insertion:",Xe))}catch(_){throw console.error("Failed to insert text to EMR:",_),_}},[r.currentAgent,r.ui.activeWorkflow,r.currentSessionId,r.patientSessions,Zr]),qn=e.setModelStatus,Yn=u.useCallback(async()=>{console.log("üîç checkModelStatus called - CALL STACK:",new Error().stack),console.time("‚è±Ô∏è Total checkModelStatus Duration");try{const B=await f.checkConnection(),I=await S.checkServerStatus(!1,{timeout:5e3,retries:2}),R={...B,whisperServer:I};u.startTransition(()=>{qn(R)}),console.timeEnd("‚è±Ô∏è Total checkModelStatus Duration")}catch(B){console.timeEnd("‚è±Ô∏è Total checkModelStatus Duration"),u.startTransition(()=>{qn({isConnected:!1,classifierModel:"",processorModel:"",lastPing:Date.now(),latency:0,whisperServer:{running:!1,model:"whisper-large-v3-turbo",port:8001,lastChecked:Date.now(),error:B instanceof Error?B.message:"Status check failed"}})})}},[f,S,qn]);u.useEffect(()=>{console.log("üöÄ Component mounted - performing initial model status check..."),Yn()},[Yn]),u.useEffect(()=>{console.log("üèóÔ∏è Starting background patient data cache..."),F.extractAndCache();const B=()=>{document.visibilityState==="visible"&&(console.log("üëÅÔ∏è Page became visible - refreshing patient cache"),F.refreshCache())};document.addEventListener("visibilitychange",B);const I=setInterval(()=>{document.visibilityState==="visible"&&!F.isCacheValid()&&(console.log("üîÑ Periodic patient cache refresh"),F.extractAndCache())},3e4);return()=>{document.removeEventListener("visibilitychange",B),clearInterval(I)}},[F]),u.useEffect(()=>{const B=r.results&&r.processingStatus==="complete",I=r.streaming||r.currentSessionId!==null,R=!H.isRecording&&!r.isProcessing;B&&I&&R&&(console.warn('üö® FIXING STUCK "ACTIVELY WORKING" STATE - clearing to restore record button access',{streaming:r.streaming,currentSessionId:r.currentSessionId,processingStatus:r.processingStatus,hasResults:!!r.results}),r.streaming&&(e.setStreaming(!1),e.clearStream()),r.currentSessionId!==null&&e.setCurrentSessionId(null))},[r.streaming,r.currentSessionId,r.results,r.processingStatus,H.isRecording,r.isProcessing,e]),u.useEffect(()=>{const B=setInterval(()=>{e.validateState();const I=r.processingStatus==="processing"&&r.isProcessing===!1,R=r.processingStatus==="complete"&&(r.streaming||r.currentSessionId),_=r.results&&r.processingStatus==="complete"&&(r.streaming||r.currentSessionId)&&!H.isRecording,G=Object.values(r.patientSessions).some(q=>q.status==="processing"||q.status==="transcribing");(I||R||_)&&!G&&(console.warn("üöë STUCK STATE DETECTED - Auto-recovering:",{isStuckProcessing:I,isStuckComplete:R,hasCompletedResultsButActiveState:_,processingStatus:r.processingStatus,isProcessing:r.isProcessing,streaming:r.streaming,currentSessionId:r.currentSessionId,hasResults:!!r.results}),r.results&&r.processingStatus==="complete"?(console.log("üîß Using forceUIReadyState for completed workflow with stuck indicators"),e.forceUIReadyState()):(console.log("üîß Using recoverStuckState for processing state inconsistencies"),e.recoverStuckState()))},5e3);return()=>clearInterval(B)},[r.processingStatus,r.isProcessing,r.streaming,r.currentSessionId,r.results,H.isRecording,e]),u.useEffect(()=>()=>{x.current&&(clearTimeout(x.current),x.current=null)},[]),u.useEffect(()=>{let B,I;const R=async()=>{try{console.log("üöÄ Initializing critical agents for improved performance...");const{AgentFactory:G}=await $e(async()=>{const{AgentFactory:q}=await import("./chunks/AgentFactory.LTvMbl2o.js");return{AgentFactory:q}},__vite__mapDeps([18,4,2,1,7,8,10,5,6]));await G.preloadCriticalAgents(),B=setTimeout(async()=>{try{console.log("üîÑ Background preloading of common agents..."),await G.preloadCommonAgents(),console.log("‚úÖ Background agent preloading completed")}catch(q){console.warn("‚ö†Ô∏è Background preloading failed:",q)}},5e3)}catch(G){console.warn("‚ö†Ô∏è Critical agent preloading failed:",G)}},_=()=>{I=setInterval(async()=>{try{const{AgentFactory:G}=await $e(async()=>{const{AgentFactory:de}=await import("./chunks/AgentFactory.LTvMbl2o.js");return{AgentFactory:de}},__vite__mapDeps([18,4,2,1,7,8,10,5,6])),q=G.getMemoryEstimate();console.log(`üìä Agent memory usage: ${q.totalAgents} agents (~${q.estimatedMemoryMB}MB)`),q.totalAgents>8&&(console.log("üßπ Optimizing agent cache due to high memory usage..."),G.optimizeCache())}catch(G){console.warn("‚ö†Ô∏è Memory optimization failed:",G)}},6e5)};return R(),_(),()=>{B&&clearTimeout(B),I&&clearInterval(I)}},[]);const pA=u.useMemo(()=>{const B=new Set(g);return d.forEach(I=>B.add(I)),B},[g,d]);return t.jsxs("div",{className:"relative h-full max-h-full flex flex-col bg-surface-secondary overflow-hidden",children:[t.jsx(ny,{status:H.isRecording?"recording":r.processingStatus,isRecording:H.isRecording,currentAgent:r.currentAgent||r.ui.activeWorkflow,modelStatus:r.modelStatus,onRefreshServices:Yn,patientSessions:r.patientSessions,onRemoveSession:e.removePatientSession,onClearAllSessions:e.clearPatientSessions,onSessionSelect:nr,onResumeRecording:Vn,selectedSessionId:X,currentSessionId:r.currentSessionId,checkedSessionIds:pA,onToggleSessionCheck:Be,persistedSessionIds:r.persistedSessionIds,storageStats:U,onStorageClick:()=>M(!0)}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",ref:E,id:"results-section",children:[r.currentPatientInfo&&r.ui.activeWorkflow&&(H.isRecording||r.processingStatus==="transcribing"||r.processingStatus==="processing")&&t.jsx(Bu,{patientInfo:r.currentPatientInfo,agentType:r.ui.activeWorkflow,processingStatus:r.processingStatus,isRecording:H.isRecording}),H.isRecording&&t.jsxs("div",{className:"flex flex-col space-y-4 p-4",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(by,{isRecording:H.isRecording,voiceActivityLevel:H.voiceActivityLevel,frequencyData:H.frequencyData,audioLevelHistory:H.audioLevelHistory,recordingTime:H.recordingTime,activeDeviceInfo:H.activeDeviceInfo,onStop:H.stopRecording,className:"min-h-0"})}),r.ui.activeWorkflow&&my(r.ui.activeWorkflow)&&t.jsx("div",{className:"flex-shrink-0",children:t.jsx(py,{agentType:r.ui.activeWorkflow,isVisible:!0,compactMode:!0})})]}),r.processingStatus==="extracting-patient"&&t.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:t.jsx("div",{className:"max-w-md w-full bg-white rounded-lg border border-blue-200 shadow-sm p-8",children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-blue-400 animate-ping opacity-30"})]}),t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Extracting Patient Data"}),t.jsx("p",{className:"text-sm text-blue-600",children:"Reading patient information from EMR..."}),t.jsx("p",{className:"text-xs text-gray-500",children:"This usually takes 2-5 seconds"})]}),t.jsx("div",{className:"w-full bg-blue-100 rounded-full h-1.5 overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-blue-400 to-blue-600 rounded-full animate-pulse",style:{width:"60%"}})})]})})}),!H.isRecording&&(r.processingStatus==="transcribing"||r.processingStatus==="processing")&&r.transcription&&!r.streaming&&!r.displaySession.isDisplayingSession&&r.currentSessionId&&t.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto p-6 space-y-4",children:t.jsxs("div",{className:"bg-white  rounded-lg border border-blue-200 p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx("div",{className:"w-2 h-2 bg-accent-violet rounded-full animate-pulse"}),t.jsx("h3",{className:"text-lg font-semibold text-blue-800",children:r.processingStatus==="transcribing"?"Transcribing Audio...":"Processing Report..."})]}),t.jsx(Lr,{originalTranscription:r.transcription,onTranscriptionCopy:B=>{navigator.clipboard.writeText(B),ce.getInstance().success("Transcription copied to clipboard")},onTranscriptionInsert:async B=>{try{await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insert-text",data:{content:B}}),ce.getInstance().success("Transcription inserted to EMR")}catch(I){console.error("Failed to insert transcription:",I),ce.getInstance().error("Failed to insert transcription")}},onTranscriptionEdit:B=>{e.setTranscription(B)},currentAgent:r.currentAgent,isProcessing:r.processingStatus==="processing",defaultExpanded:!0,className:"border-0 bg-transparent"}),r.processingStatus==="processing"&&t.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-sm text-blue-600",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsxs("span",{children:["Generating ",r.currentAgent," report..."]})]})]})}),r.reviewData&&t.jsx("div",{className:"flex-shrink-0 bg-white  border-b border-gray-200",children:t.jsx(Gb,{onQuickAction:async(B,I)=>{console.log("üîß Quick action:",B,I)},processingAction:""})}),a.patientEducation&&t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:t.jsx(ly,{isVisible:a.patientEducation,onClose:()=>{e.closeOverlay("patient-education"),e.setUIMode("idle",{sessionId:null,origin:"user"})},isGenerating:r.isProcessing&&r.currentAgent==="patient-education",pipelineProgress:r.pipelineProgress,processingStartTime:r.processingStartTime,onGenerate:async B=>{try{const I=`session-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,R=B.patientData||r.currentPatientInfo||{name:"Patient Education Session",id:`PE-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},_={id:I,patient:R,transcription:"",results:"",agentType:"patient-education",agentName:"Patient Education & Lifestyle Medicine",timestamp:Date.now(),status:"processing",completed:!1,processingStartTime:Date.now()};e.addPatientSession(_),e.setCurrentSessionId(I),e.setProcessing(!0),e.setCurrentAgent("patient-education"),e.setResults(""),e.setErrors([]),e.setProcessingStartTime(Date.now()),e.closeOverlay("patient-education"),e.setPipelineProgress({stage:"ai-analysis",progress:45,stageProgress:10,details:"Loading Patient Education agent",modelName:"MedGemma-27B"}),e.updatePatientSession(I,{pipelineProgress:{stage:"ai-analysis",progress:45,stageProgress:10,details:"Loading Patient Education agent",modelName:"MedGemma-27B"}});const{AgentFactory:G}=await $e(async()=>{const{AgentFactory:Ee}=await import("./chunks/AgentFactory.LTvMbl2o.js");return{AgentFactory:Ee}},__vite__mapDeps([18,4,2,1,7,8,10,5,6]));console.log("üéì Processing Patient Education with input:",B);const q=await G.processWithAgent("patient-education",JSON.stringify(B),void 0,void 0,{sessionId:I,onProgress:(Ee,Te,Qe)=>{console.log(`üéì Patient Education Progress: ${Ee} (${Te}%) - ${Qe||""}`);const ze=Math.max(0,Math.min(100,Te)),tt=40+ze*.5;e.updatePipelineProgress({stage:"ai-analysis",progress:tt,stageProgress:ze,details:Qe||Ee||"Generating lifestyle advice",modelName:"MedGemma-27B"}),e.updatePatientSession(I,{pipelineProgress:{stage:"ai-analysis",progress:tt,stageProgress:ze,details:Qe||Ee||"Generating lifestyle advice",modelName:"MedGemma-27B"}})}});e.updatePipelineProgress({stage:"generation",progress:95,stageProgress:50,details:"Formatting education plan"});const de=Date.now()-(_.processingStartTime||Date.now());e.updatePatientSession(I,{results:q.content,educationData:q.educationData,status:"completed",completed:!0,processingTime:de,completedTime:Date.now(),pipelineProgress:{stage:"generation",progress:100,stageProgress:100,details:"Complete"}}),e.setEducationData(q.educationData),e.completeProcessingAtomic(I,q.content),console.log("‚úÖ Patient Education generation completed")}catch(I){console.error("‚ùå Patient Education generation failed:",I);const R=I instanceof Error?I.message:String(I);r.currentSessionId&&e.updatePatientSession(r.currentSessionId,{status:"error",completed:!0,errors:[R]}),e.setErrors([`Patient Education generation failed: ${R}`]),e.setProcessingStatus("idle"),e.setProcessing(!1)}}})}),X&&!r.results&&!r.streaming&&!r.isProcessing&&r.processingStatus!=="complete"&&!r.displaySession.isDisplayingSession&&t.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center p-8",children:t.jsxs("div",{className:"max-w-md text-center space-y-4",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-purple-50 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-purple-600 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Loading Session"}),t.jsx("p",{className:"text-gray-600",children:(()=>{const B=r.patientSessions.find(I=>I.id===X);return B?`Loading ${B.patient.name}'s ${B.agentType} session...`:"Loading session data..."})()})]})]})}),(X||r.streaming||r.isProcessing||r.results&&r.processingStatus==="complete")&&t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:(()=>{const B=Gn();return t.jsx(lu,{results:B.results,resultsSummary:B.summary||"",warnings:r.ui.warnings,errors:r.ui.errors,agentType:B.agent||null,onCopy:zn,onInsertToEMR:(I,R)=>{Xn(I,R,B.agent||null)},originalTranscription:B.transcription,audioDuration:B.audioDuration??void 0,onTranscriptionCopy:zn,onTranscriptionInsert:I=>{Xn(I,void 0,B.agent||null)},onTranscriptionEdit:Ci,transcriptionSaveStatus:Bi,onAgentReprocess:B.isDisplayingSession?void 0:Ni,approvalState:B.isDisplayingSession?{status:"pending",originalText:B.transcription||"",currentText:B.transcription||"",hasBeenEdited:!1}:r.transcriptionApproval,onTranscriptionApprove:B.isDisplayingSession?I=>{console.log("üß† TAVI workup transcription approval for completed session:",{status:I,sessionId:(B.isDisplayingSession?B.patientInfo?.name:null)||"unknown",transcriptionLength:B.transcription?.length||0}),es(I)}:es,missingInfo:B.isDisplayingSession?null:r.missingInfo,onReprocessWithAnswers:B.isDisplayingSession?void 0:ms,onDismissMissingInfo:B.isDisplayingSession?void 0:()=>e.clearMissingInfo(),currentAgent:B.agent,isProcessing:B.isDisplayingSession?!1:r.isProcessing,audioBlob:B.isDisplayingSession?null:j.current,transcriptionTime:B.isDisplayingSession?null:r.transcriptionTime,agentProcessingTime:B.isDisplayingSession?null:r.agentProcessingTime,totalProcessingTime:B.isDisplayingSession?B.processingTime||null:r.totalProcessingTime,processingStatus:B.processingStatus,currentAgentName:B.agentName,modelUsed:B.modelUsed||null,selectedSessionId:B.isDisplayingSession?B.patientInfo?.name||"Unknown":X,selectedPatientName:B.patientInfo?.name||Ae,patientVersion:B.isDisplayingSession?null:r.patientVersion,isGeneratingPatientVersion:B.isDisplayingSession?!1:r.isGeneratingPatientVersion,onGeneratePatientVersion:B.isDisplayingSession?void 0:Ys,streaming:B.isDisplayingSession?!1:!!r.streaming,streamBuffer:B.isDisplayingSession?"":r.streamBuffer||"",ttftMs:B.isDisplayingSession?null:r.ttftMs??null,onStopStreaming:B.isDisplayingSession?void 0:he,taviStructuredSections:B.isDisplayingSession?B.taviStructuredSections:r.taviStructuredSections,educationData:B.isDisplayingSession?B.educationData:r.educationData,reviewData:B.isDisplayingSession?B.reviewData:r.reviewData,rhcReport:B.isDisplayingSession?B.rhcReport:r.rhcReport,pipelineProgress:B.pipelineProgress||r.pipelineProgress,processingStartTime:B.isDisplayingSession?null:r.processingStartTime,revisionPanel:re,revisionContext:te,onRevisionToggle:Ce,onRevisionChange:ge,onRevisionSave:be,onRevisionDiscard:Z,onRevisionMarkGoldenPair:we,isSavingRevision:p,isSavingGoldenPair:N})})()}),!r.displaySession.isDisplayingSession&&!H.isRecording&&!r.streaming&&!X&&!a.patientEducation&&!r.isProcessing&&!(r.results&&r.processingStatus==="complete")&&t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col items-center justify-between dot-grid-background-light",children:[t.jsx("div",{className:"w-full flex-1 flex items-start justify-center pt-4",children:t.jsx(Ww,{position:[0,0,20],gravity:[0,-40,0],fov:20,transparent:!0,cardText:""})}),t.jsxs("div",{className:"w-full max-w-md text-center space-y-3 px-8 pb-6",children:[t.jsx("div",{className:"space-y-1",children:t.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:"Select a workflow below to start recording for your next patient. Recordings will process in the background."})}),r.patientSessions.length>0&&t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.jsx("span",{className:"text-xs font-medium text-blue-900",children:"Background Processing"})]}),t.jsxs("p",{className:"text-xs text-blue-800",children:[r.patientSessions.filter(B=>["transcribing","processing"].includes(B.status)).length," processing, "," ",r.patientSessions.filter(B=>B.status==="completed").length," completed."]})]})]})]})]}),t.jsx("div",{className:"flex-shrink-0 bg-white  border-t border-gray-200 p-4",children:t.jsx(uu,{onQuickAction:async(B,I)=>{console.log("üîß Quick action triggered:",B,I);try{if(B==="annotate-screenshots"){console.log("üì∏ Opening screenshot annotation modal"),e.openOverlay("screenshot-annotation"),e.setUIMode("configuring",{sessionId:r.selectedSessionId,origin:"user"});return}if(B==="bp-diary-importer"){console.log("ü©∫ Opening BP Diary Importer"),e.openOverlay("bp-diary-importer"),e.setUIMode("configuring",{sessionId:r.selectedSessionId,origin:"user"});return}if(B==="lipid-profile-importer"){console.log("üß™ Opening Lipid Profile Importer"),e.openOverlay("lipid-profile-importer"),e.setUIMode("configuring",{sessionId:r.selectedSessionId,origin:"user"});return}if(B==="tte-trend-importer"){console.log("ü´Ä Opening TTE Trend Importer"),e.openOverlay("tte-trend-importer"),e.setUIMode("configuring",{sessionId:r.selectedSessionId,origin:"user"});return}if(B==="paste-letter"){console.log("üìã Opening Paste Notes Panel"),e.openOverlay("paste-notes"),e.setUIMode("configuring",{sessionId:r.selectedSessionId,origin:"user"});return}if(B==="patient-education"&&I?.type==="show-config"){console.log("üéì Showing Patient Education configuration card"),e.openOverlay("patient-education"),e.setUIMode("configuring",{sessionId:r.selectedSessionId,origin:"user"});return}if(B==="pre-op-plan"){console.log("üóÇÔ∏è Starting Pre-Op Plan workflow from quick action"),await qs("pre-op-plan");return}if(B==="bloods"&&I?.type==="prepare-modal"){console.log("ü©∏ Preparing bloods modal for dictation..."),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods",data:{}}),console.log("‚úÖ Bloods modal opened for dictation");return}if(["investigation-summary","background","medications","social-history","bloods","bloods-insert","imaging","quick-letter","appointment-wrap-up","profile-photo","create-task"].includes(B)){const R={...I};["investigation-summary","background","medications","social-history"].includes(B)&&I?.type!=="manual"&&(console.log(`üîß TAVI Ingestion: Showing field ingestion overlay for ${B}`),e.openOverlay("field-ingestion"),e.setUIMode("processing",{sessionId:r.selectedSessionId,origin:"auto"})),r.results&&r.results.trim().length>0&&I?.type!=="manual"?(R.content=r.results,console.log("üîß Sending content to EMR field:",B)):console.log("üîß Opening EMR field for manual entry:",B),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:B,data:R}),["investigation-summary","background","medications","social-history"].includes(B)&&(console.log(`üîß TAVI Ingestion: Clearing field ingestion overlay after ${B}`),setTimeout(()=>{e.closeOverlay("field-ingestion")},1500)),console.log("‚úÖ Quick action completed:",B)}else if(B==="ai-medical-review")if(console.log("ü§ñ Processing AI Medical Review with data:",I),I?.formattedInput){const R=`session-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,_=r.currentPatientInfo||I.emrData?.patientInfo||{name:"AI Medical Review Session",id:`AI-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},G={id:R,patient:_,transcription:"",results:"",agentType:"ai-medical-review",agentName:"AI Medical Review",timestamp:Date.now(),status:"processing",completed:!1,processingStartTime:Date.now()};e.addPatientSession(G),e.setCurrentSessionId(R),e.setProcessing(!0),e.setCurrentAgent("ai-medical-review"),e.setResults(""),e.setErrors([]),e.setProcessingStartTime(Date.now()),e.setPipelineProgress({stage:"ai-analysis",progress:45,stageProgress:10,details:"Analyzing EMR data against Australian guidelines",modelName:"MedGemma-27B"}),e.updatePatientSession(R,{pipelineProgress:{stage:"ai-analysis",progress:45,stageProgress:10,details:"Analyzing EMR data against Australian guidelines",modelName:"MedGemma-27B"}});try{const{AgentFactory:q}=await $e(async()=>{const{AgentFactory:Qe}=await import("./chunks/AgentFactory.LTvMbl2o.js");return{AgentFactory:Qe}},__vite__mapDeps([18,4,2,1,7,8,10,5,6]));e.setPipelineProgress({stage:"generation",progress:70,stageProgress:30,details:"Generating clinical findings and recommendations",modelName:"MedGemma-27B"}),e.updatePatientSession(R,{pipelineProgress:{stage:"generation",progress:70,stageProgress:30,details:"Generating clinical findings and recommendations",modelName:"MedGemma-27B"}}),console.log("ü§ñ Processing with BatchPatientReviewAgent...");const de=await q.processWithAgent("ai-medical-review",I.formattedInput);console.log("üîç AI Review Result:",{hasReviewData:!!de.reviewData,reviewDataKeys:de.reviewData?Object.keys(de.reviewData):null,findingsCount:de.reviewData?.findings?.length||0,resultKeys:Object.keys(de),contentPreview:de.content?.substring(0,200)}),de.reviewData?(console.log("‚úÖ Storing reviewData in state:",de.reviewData),e.setReviewData(de.reviewData)):console.warn("‚ö†Ô∏è No reviewData found in result!");const Ee=G.processingStartTime??G.timestamp??Date.now(),Te=Date.now()-Ee;e.updatePatientSession(R,{results:de.content,status:"completed",completed:!0,reviewData:de.reviewData,processingTime:Te,pipelineProgress:{stage:"generation",progress:100,stageProgress:100,details:`Review completed in ${Math.round(Te/1e3)}s`,modelName:"MedGemma-27B"}}),e.setMissingInfo(de.missingInfo||null),e.completeProcessingAtomic(R,de.content),console.log("‚úÖ AI Medical Review completed successfully in",Te,"ms")}catch(q){console.error("‚ùå AI Medical Review processing failed:",q),e.updatePatientSession(R,{status:"error",completed:!0,errors:[`AI Medical Review failed: ${q instanceof Error?q.message:"Unknown error"}`]}),e.setErrors([`AI Medical Review failed: ${q instanceof Error?q.message:"Unknown error"}`]),e.setProcessingStatus("idle"),e.setProcessing(!1)}}else console.error("‚ùå AI Medical Review: No formatted input provided"),e.setErrors(["AI Medical Review failed: No patient data available"]),e.setProcessingStatus("idle"),e.setProcessing(!1);else if(B==="batch-ai-review"&&I?.type==="show-modal"){console.log("üë• Batch AI Review: Extracting calendar patients before opening modal..."),e.setExtractingPatients(!0),e.setExtractError(null);try{const[R]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!R?.id)throw new Error("No active tab found. Please navigate to the EMR calendar page.");console.log("üìÖ Requesting calendar extraction from tab:",R.id);const _=await new Promise(G=>{chrome.tabs.sendMessage(R.id,{type:"extract-calendar-patients"},q=>{if(chrome.runtime.lastError){console.error("üìÖ Chrome runtime error:",chrome.runtime.lastError),G({success:!1,error:chrome.runtime.lastError.message});return}G(q||{success:!1,error:"No response from content script"})})});if(console.log("üìÖ Calendar extraction response:",_),_.success&&_.data)e.setCalendarData(_.data),e.setExtractingPatients(!1),console.log(`‚úÖ Extracted ${_.data.totalCount} patients from calendar`),e.openOverlay("patient-selection"),e.setUIMode("batch",{sessionId:null,origin:"user"});else throw new Error(_.error||"Failed to extract calendar patients. Make sure you are on the EMR appointment calendar page.")}catch(R){console.error("‚ùå Calendar extraction failed:",R);const _=R instanceof Error?R.message:"Unknown error";e.setExtractingPatients(!1),e.setExtractError(_),e.openOverlay("patient-selection"),e.setUIMode("batch",{sessionId:null,origin:"user"})}}else console.log("‚ÑπÔ∏è Unhandled quick action:",B)}catch(R){console.error("‚ùå Quick action failed:",B,R),e.setErrors([`Failed to execute ${B}: ${R instanceof Error?R.message:"Unknown error"}`])}},onStartWorkflow:B=>qs(B),onTypeClick:Wn,isFooter:!0,isRecording:H.isRecording,activeWorkflow:r.ui.activeWorkflow,voiceActivityLevel:r.voiceActivityLevel,recordingTime:H.recordingTime,whisperServerRunning:r.modelStatus.whisperServer?.running})})]}),a.patientSelection&&t.jsx(Ay,{isOpen:a.patientSelection,onClose:()=>{e.closeOverlay("patient-selection"),e.setUIMode("idle",{sessionId:null,origin:"user"})},onStartReview:async B=>{console.log("üîÑ Starting batch AI review for",B.length,"patients");try{e.closeOverlay("patient-selection");const{BatchAIReviewOrchestrator:I}=await $e(async()=>{const{BatchAIReviewOrchestrator:Te}=await Promise.resolve().then(()=>Yw);return{BatchAIReviewOrchestrator:Te}},void 0),R={selectedPatients:B,appointmentDate:r.ui.calendarData?.appointmentDate||new Date().toLocaleDateString(),calendarUrl:r.ui.calendarData?.calendarUrl||window.location.href},_=new I({enableCaching:!0,enableMetrics:!0,enableAdvancedDiagnostics:!0,parallelProcessing:!1,maxConcurrentOperations:1,enableCheckpoints:!0,checkpointInterval:1,retryAttempts:2});console.log("üöÄ Starting batch processing...");const G=await _.processBatch(R,Te=>{console.log("üìä Batch progress:",Te)});console.log("‚úÖ Batch processing complete:",G);const q=`batchResults_${Date.now()}`,de={report:G,patientResults:G.batchData.patientResults,summary:{total:G.batchData.totalPatients,successful:G.batchData.successfulReviews,failed:G.batchData.failedReviews,processingTime:G.batchData.processingEndTime-G.batchData.processingStartTime},timestamp:Date.now()};await chrome.storage.local.set({[q]:de});const Ee=chrome.runtime.getURL(`src/components/BatchReviewResults.html?key=${q}`);await chrome.tabs.create({url:Ee}),console.log("üìä Batch results page opened in new tab with key:",q)}catch(I){console.error("‚ùå Batch AI review failed:",I),e.setErrors([`Batch AI review failed: ${I instanceof Error?I.message:"Unknown error"}`])}},calendarData:r.ui.calendarData,isExtracting:r.ui.isExtractingPatients,extractError:r.ui.extractError}),a.screenshotAnnotation&&t.jsx(pv,{isOpen:a.screenshotAnnotation,onClose:()=>{e.closeOverlay("screenshot-annotation"),e.setUIMode("idle",{sessionId:null,origin:"user"})}}),a.bpDiaryImporter&&t.jsx(xv,{isOpen:a.bpDiaryImporter,onClose:()=>{e.closeOverlay("bp-diary-importer"),e.setUIMode("idle",{sessionId:null,origin:"user"})}}),a.lipidProfileImporter&&t.jsx(sw,{isOpen:a.lipidProfileImporter,onClose:()=>{e.closeOverlay("lipid-profile-importer"),e.setUIMode("idle",{sessionId:null,origin:"user"})}}),a.tteTrendImporter&&t.jsx(Kw,{isOpen:a.tteTrendImporter,onClose:()=>{e.closeOverlay("tte-trend-importer"),e.setUIMode("idle",{sessionId:null,origin:"user"})}}),a.patientMismatch&&t.jsx(gv,{isOpen:a.patientMismatch,comparison:r.patientMismatchData.comparison,textToInsert:r.patientMismatchData.textToInsert,onConfirm:r.patientMismatchData.onConfirm||(()=>{}),onCancel:r.patientMismatchData.onCancel||(()=>{}),onRefreshEMR:async()=>{try{console.log("üîÑ Refreshing EMR patient data...");const B=await yr();B?.name&&(e.setCurrentPatientInfo({...r.currentPatientInfo,...B}),console.log("‚úÖ EMR patient data refreshed:",B.name))}catch(B){console.error("‚ùå Failed to refresh EMR patient data:",B)}}}),a.pasteNotes&&t.jsx(bv,{isVisible:a.pasteNotes,isGenerating:r.isProcessing&&r.currentAgent==="quick-letter",onClose:()=>{e.closeOverlay("paste-notes"),e.setUIMode("idle",{sessionId:null,origin:"user"})},onGenerate:async B=>{console.log("üìã Processing pasted notes for Quick Letter...");try{e.closeOverlay("paste-notes");const I=await yr(),R={demographics:{name:I.name,age:I.age,dob:I.dob,gender:I.gender,mrn:I.mrn},gp:I.gp,allergies:I.allergies||[],background:I.background||"",investigation_summary:I.investigationSummary||"",medications_emr:(I.medications||[]).map(Qe=>({name:Qe.name||Qe,dose:Qe.dose||"",frequency:Qe.frequency||"",indication:Qe.indication||""}))},_=`paste-${Date.now()}`,G={id:_,patient:I,timestamp:Date.now(),agentType:"quick-letter",agentName:"Quick Letter",status:"processing",transcription:B,results:"",completed:!1,processingTime:0,modelUsed:"",pipelineProgress:{stage:"ai-analysis",progress:0,stageProgress:0}};e.addPatientSession(G),e.setCurrentSessionId(_),e.setSelectedSessionId(_),e.setUIMode("processing",{sessionId:_,origin:"user"}),e.setProcessing(!0),e.setProcessingStatus("processing"),e.setProcessingStartTime(Date.now());const q=(await $e(async()=>{const{QuickLetterAgent:Qe}=await import("./chunks/agents.w_LsrkjM.js").then(ze=>ze.m);return{QuickLetterAgent:Qe}},__vite__mapDeps([7,8,4,2,1]))).QuickLetterAgent,Ee=await new q().processPaste(B,R,{identity_mismatch:!1,patient_friendly_requested:!1},{onProgress:Qe=>{console.log(`üìù Paste processing: ${Qe}`)},onSparsityDetected:async(Qe,ze)=>(console.log("üìù Sparsity detected, missing fields:",Qe),console.log("üìù Prefill data:",ze),new Promise(tt=>{c({missingFields:Qe,prefillData:ze,onComplete:Xe=>{tt(Xe),e.closeOverlay("sparsity-stepper"),c(null)}}),e.openOverlay("sparsity-stepper")}))}),Te=Date.now()-(G.timestamp||Date.now());e.updatePatientSession(_,{status:"completed",completed:!0,results:Ee.content,processingTime:Te,pipelineProgress:{stage:"generation",progress:100,stageProgress:100}}),e.setResults(Ee.content),e.setProcessing(!1),e.setProcessingStatus("idle"),e.setUIMode("idle",{sessionId:_,origin:"user"}),console.log("‚úÖ Paste letter generated successfully"),ce.getInstance().success("Letter generated from pasted notes!")}catch(I){console.error("‚ùå Failed to process pasted notes:",I),e.setProcessing(!1),e.setProcessingStatus("error"),e.setErrors([`Failed to generate letter: ${I instanceof Error?I.message:"Unknown error"}`]),ce.getInstance().error("Failed to generate letter from pasted notes")}}}),a.sparsityStepper&&l&&t.jsx(yv,{isVisible:a.sparsityStepper,missingFields:l.missingFields,prefillData:l.prefillData,onComplete:l.onComplete,onCancel:()=>{e.closeOverlay("sparsity-stepper"),c(null),ce.getInstance().info("Letter generation cancelled")}}),t.jsx(gy,{isOpen:i,onClose:()=>e.clearSidePanel()}),t.jsx(cp,{isOpen:At,onClose:()=>mt(!1)}),t.jsx(Hu,{isOpen:P,onClose:()=>M(!1),sessions:r.patientSessions,persistedSessionIds:r.persistedSessionIds,storageStats:U,onDeleteSession:J,onDeleteAllChecked:Y,onDeleteOldSessions:fe}),$&&t.jsx(Gw,{error:$,onRetry:Ue,onSwitchModel:Ie,onClose:vt}),t.jsx(oy,{})]})});Gu.displayName="OptimizedAppContent";Vu.displayName="OptimizedApp";const AB=()=>{const r=e=>{e.preventDefault()};window.addEventListener("dragover",r,{capture:!0}),window.addEventListener("drop",r,{capture:!0}),document.addEventListener("dragover",r,{capture:!0}),document.addEventListener("drop",r,{capture:!0}),document.documentElement?.addEventListener?.("dragover",r,{capture:!0}),document.documentElement?.addEventListener?.("drop",r,{capture:!0}),document.body?.addEventListener?.("dragover",r,{capture:!0}),document.body?.addEventListener?.("drop",r,{capture:!0})};AB();class lB extends Fe.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("React Error Boundary caught an error:",e,s)}render(){return this.state.hasError?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-500 to-red-700 p-4 flex items-center justify-center",children:t.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md text-center",children:[t.jsx("h1",{className:"text-white text-xl font-bold mb-4",children:"Extension Error"}),t.jsx("p",{className:"text-white/80 mb-4",children:"The Operator Chrome Extension encountered an error."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors",children:"Reload Extension"}),this.state.error&&t.jsxs("details",{className:"mt-4 text-left",children:[t.jsx("summary",{className:"text-white/60 cursor-pointer text-sm",children:"Error Details"}),t.jsx("pre",{className:"text-xs text-white/50 mt-2 p-2 bg-black/20 rounded",children:this.state.error.message})]})]})}):this.props.children}}window.addEventListener("error",r=>{console.error("Global error in sidepanel:",r.error)});window.addEventListener("unhandledrejection",r=>{console.error("Unhandled promise rejection in sidepanel:",r.reason)});function Fc(){console.log("üè• Initializing Operator Chrome Extension...",new Date().toISOString()),console.log("üîß Extension context check:",typeof chrome<"u"&&chrome.runtime);const r=document.getElementById("root");if(!r){console.error("‚ùå Root element not found!"),document.body.innerHTML=`
      <div style="padding: 20px; text-align: center; background: #f5f5f5; min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 8px; border: 1px solid #e0e0e0;">
          <h1 style="color: #1a1a1a; margin-bottom: 1rem;">Mount Error</h1>
          <p style="color: #525252;">Could not find root element</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #1a1a1a; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `;return}typeof chrome>"u"||!chrome.runtime?console.warn("‚ö†Ô∏è Chrome extension APIs not available"):console.log("‚úÖ Chrome extension context detected");try{ci(r).render(t.jsx(Fe.StrictMode,{children:t.jsx(lB,{children:t.jsx(Vu,{})})})),console.log("‚úÖ React app rendered successfully")}catch(e){console.error("‚ùå Failed to render React app:",e),r.innerHTML=`
      <div style="padding: 20px; text-align: center; background: #f5f5f5; min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 8px; border: 1px solid #e0e0e0;">
          <h1 style="color: #1a1a1a; margin-bottom: 1rem;">Render Error</h1>
          <p style="color: #525252;">${e instanceof Error?e.message:"Unknown error"}</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #1a1a1a; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `}}document.readyState==="loading"?(console.log("‚è≥ Waiting for DOM to load..."),document.addEventListener("DOMContentLoaded",Fc)):(console.log("‚úÖ DOM already loaded, initializing immediately"),Fc());typeof window<"u"&&(window.operatorDebug={version:"1.0.0",timestamp:new Date().toISOString(),userAgent:navigator.userAgent,chromeAvailable:typeof chrome<"u",extensionId:chrome?.runtime?.id||"unknown"},console.log("üîß Debug info:",window.operatorDebug));export{pp as b,Rr as c,zc as m};
