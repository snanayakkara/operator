const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/AIReasoningModal.DwmTRHIp.js","chunks/vendor-ui.CLL7cqOt.js","chunks/vendor.DxVDkWSy.js","chunks/modulepreload-polyfill.B5Qt9EMX.js","chunks/AgentFactory.Da_RPH1f.js","chunks/agents.D9VU8YWQ.js","chunks/services.BFX6WlO5.js","chunks/settings-components.R3rIAk8d.js","assets/AgentFactory.css","chunks/PatientEducationAgent.IPUd9ewH.js","chunks/BatchPatientReviewAgent.CE7Uel0N.js","chunks/InvestigationSummarySystemPrompts.BNAkynnH.js","chunks/MedicationSystemPrompts.CVwqQxnq.js"])))=>i.map(i=>d[i]);
import"./chunks/modulepreload-polyfill.B5Qt9EMX.js";import{j as e,q as Vn,r as Qe,s as Ht,Z as xt,m as tt,t as un,o as at,u as _a,e as Wn,i as $a,V as La,D as Vt,R as Yt,h as Fa,P as za,v as Ua,B as bt,T as vt,w as Ba,x as Ee,y as W,f as Gn,z as ot,a as ss,E as qa,K as On,U as Wt,F as lt,G as Xn,H as Ds,I as Os,J as _s,L as Ha,N as $s,O as yt,Q as Mt,C as pn,W as dn,Y as as,p as _n,_ as Ls,$ as $n,a0 as Va,a1 as Wa,X as Le,a2 as Ga,a3 as Xa,l as Lt,k as wt,a4 as Ze,a5 as gn,a6 as Qa,a7 as Ja,a8 as Ya,n as Nn,a9 as Ka,aa as Za,A as et,ab as Gt,ac as ei,ad as ti,ae as kn,af as is,g as Fs,ag as ni,ah as si,d as ai,ai as zs,aj as Us,ak as ii,al as rs,am as ri,an as oi,ao as li,ap as ci,c as Bs,aq as qs,ar as di,as as mi}from"./chunks/vendor-ui.CLL7cqOt.js";import{r as c,R as ue,a as ui,g as pi}from"./chunks/vendor.DxVDkWSy.js";import{M as mn,A as gi,N as Hs,Q as hi,c as xi}from"./chunks/AgentFactory.Da_RPH1f.js";import{l as G,_ as Pe,t as Zt,C as fi}from"./chunks/agents.D9VU8YWQ.js";import{L as Vs,W as bi,s as vi,M as zt}from"./chunks/services.BFX6WlO5.js";import{A as os,O as yi}from"./chunks/settings-components.R3rIAk8d.js";const Ws=c.createContext(void 0),wi=({children:n})=>{const[t,s]=c.useState(null),[a,i]=c.useState(null),[r,o]=c.useState("auto"),[l,d]=c.useState("auto"),m=(g,u=!1)=>{if(s(g),o(u?"manual":"auto"),u&&g)try{localStorage.setItem("xestro-preferred-microphone",g)}catch(v){console.warn("Failed to persist microphone preference:",v)}},x=(g,u=!1)=>{if(i(g),d(u?"manual":"auto"),u&&g)try{localStorage.setItem("xestro-preferred-speaker",g)}catch(v){console.warn("Failed to persist speaker preference:",v)}};return e.jsx(Ws.Provider,{value:{selectedMicrophoneId:t,selectedSpeakerId:a,microphoneSelectionType:r,speakerSelectionType:l,setSelectedMicrophoneId:m,setSelectedSpeakerId:x},children:n})},Gs=()=>{const n=c.useContext(Ws);if(n===void 0)throw new Error("useAudioDeviceContext must be used within an AudioDeviceProvider");return n},Xs=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("path",{d:"m12 1 0 11"}),e.jsx("path",{d:"m18 7c0 4.97-4.03 9-9 9s-9-4.03-9-9"}),e.jsx("path",{d:"m12 20 0 3"}),e.jsx("path",{d:"m8 23 8 0"})]}),Kt=({className:n,size:t=20})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),He=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14,2 14,8 20,8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10,9 9,9 8,9"})]}),Dt=({className:n,size:t=20})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("polyline",{points:"22,12 18,12 15,21 9,3 6,12 2,12"})}),ji=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"}),e.jsx("path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"}),e.jsx("circle",{cx:"20",cy:"10",r:"2"})]}),Ni=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"1"})]}),qe=({className:n,size:t=20})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("polyline",{points:"20,6 9,17 4,12"})}),dt=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),ct=({className:n,size:t=20})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"})}),ki=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("polygon",{points:"11,5 6,9 2,9 2,15 6,15 11,19"}),e.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"})]}),Si=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),hn=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Ci=({className:n,size:t=20})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[e.jsx("path",{d:"M10.5 20.5 L3.5 13.5 L10.5 6.5 L17.5 13.5 Z"}),e.jsx("path",{d:"M13.5 3.5 L20.5 10.5 L13.5 17.5 L6.5 10.5 Z"})]}),Ti=({className:n,size:t=20})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),Qs=({className:n,size:t=20})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("polyline",{points:"6,9 12,15 18,9"})}),Js=({className:n,size:t=20})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:e.jsx("polyline",{points:"18,15 12,9 6,15"})}),De={immediate:.15,quick:.2,normal:.3},Je={sharp:[.4,0,.6,1],gentle:[.25,.46,.45,.94],professional:[.4,0,.2,1]},Ot={gentle:{type:"spring",damping:25,stiffness:300,mass:1},responsive:{type:"spring",damping:30,stiffness:400,mass:.8}},it=(n,t=Je.professional)=>({duration:n,ease:t,type:"tween"}),Bt=(n=Ot.gentle)=>n,Xt={tight:.03,normal:.05},mt={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:it(De.quick,Je.gentle)},exit:{opacity:0,y:-10,scale:.98,transition:it(De.immediate,Je.sharp)}},Pi={idle:{scale:1,y:0},hover:{scale:1.02,y:-1,transition:Bt(Ot.responsive)},tap:{scale:.98,y:0,transition:it(De.immediate,Je.sharp)},success:{scale:[1,1.05,1],transition:{duration:.6,times:[0,.3,1],ease:Je.gentle}}},xn={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:Xt.normal,delayChildren:.1,when:"beforeChildren"}},exit:{opacity:0,transition:{staggerChildren:Xt.tight,staggerDirection:-1,when:"afterChildren"}}},Ys={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:Bt(Ot.gentle)},exit:{opacity:0,scale:.95,y:10,transition:it(De.quick,Je.sharp)}},Ks={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(4px)",transition:it(De.normal,Je.gentle)},exit:{opacity:0,backdropFilter:"blur(0px)",transition:it(De.quick,Je.sharp)}},Qt={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:it(De.quick,Je.gentle)}},qt={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:it(De.quick,Je.gentle)},exit:{opacity:0,x:20,transition:it(De.immediate,Je.sharp)}},xe=n=>{if(!Ei())return n;const s={};return Object.keys(n).forEach(a=>{const i=n[a];typeof i=="object"&&i!==null?s[a]={...i,transition:{duration:.01}}:s[a]=i}),s},Ei=()=>typeof window>"u"?!1:window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,ft=({className:n="w-4 h-4",title:t})=>{const[s,a]=c.useState(!1),i=()=>{a(!0),setTimeout(()=>a(!1),300)};return e.jsx("span",{onMouseEnter:i,onFocus:i,className:"relative inline-flex items-center justify-center group","aria-hidden":t?void 0:!0,title:t,children:e.jsx(Vn,{className:`${n} transition-transform duration-300 ${s?"animate-bounce":"group-hover:scale-110"}`})})};class pt{static instance;metrics=[];maxMetricsHistory=100;constructor(){}static getInstance(){return pt.instance||(pt.instance=new pt),pt.instance}recordMetrics(t,s,a){try{const i={timestamp:Date.now(),processingPhase:t,duration:Math.max(0,s||0),memoryUsage:this.getMemoryInfo(),systemLoad:this.getSystemLoad(),...a};this.metrics.push(i),this.metrics.length>this.maxMetricsHistory&&(this.metrics=this.metrics.slice(-this.maxMetricsHistory)),console.log(`üìä Performance: ${t} completed in ${s}ms`,{phase:t,duration:s,agentType:a?.agentType,audioSize:a?.audioSize?Math.round(a.audioSize/1024)+"KB":void 0,memoryUsage:i.memoryUsage?.estimatedMemoryMB?i.memoryUsage.estimatedMemoryMB+"MB":"N/A"}),this.detectPerformanceIssues(i)}catch(i){console.warn("‚ö†Ô∏è Failed to record performance metrics:",i)}}getMemoryInfo(){let t={totalAgents:0,estimatedMemoryMB:0};try{if(typeof window<"u"&&window.AgentFactory){const a=window.AgentFactory.getMemoryEstimate();a&&typeof a=="object"&&(t={totalAgents:Math.max(0,a.totalAgents||0),estimatedMemoryMB:Math.max(0,a.estimatedMemoryMB||0)})}}catch{}let s={jsHeapSizeLimit:0,jsHeapTotalSize:0,jsHeapUsedSize:0};try{if(typeof window<"u"&&window.performance&&"memory"in window.performance&&window.performance.memory){const a=window.performance.memory;s={jsHeapSizeLimit:Math.max(0,a.jsHeapSizeLimit||0),jsHeapTotalSize:Math.max(0,a.totalJSHeapSize||0),jsHeapUsedSize:Math.max(0,a.usedJSHeapSize||0)}}}catch{}return{...t,...s}}getSystemLoad(){try{const t=this.metrics.slice(-5).filter(l=>l&&typeof l.duration=="number"&&l.duration>=0);if(t.length===0)return{};const a=t.reduce((l,d)=>l+(d.duration||0),0)/t.length,i={transcription:2e3,"agent-loading":500,"agent-processing":5e3,complete:0};let r=0;t.forEach(l=>{const d=i[l.processingPhase]||1e3;if(d>0){const m=(l.duration||0)/d;r+=Math.min(Math.max(m,0),3)}});const o=t.length>0?r/t.length*100:0;return{cpuUsage:Math.min(Math.max(o,0),100),isMainThreadBlocked:a>1e4,frameDrops:o>200?Math.max(0,Math.floor(o/50)):0}}catch(t){return console.warn("‚ö†Ô∏è Failed to calculate system load:",t),{}}}detectPerformanceIssues(t){try{if(!t||typeof t.duration!="number")return;const s=[],a=Math.max(0,t.duration);if(t.processingPhase==="transcription"&&a>1e4&&s.push(`Slow transcription (${a}ms) - check MLX Whisper server`),t.processingPhase==="agent-processing"&&a>3e4){const i=t.agentType||"unknown";s.push(`Slow processing (${a}ms) - agent: ${i}`)}if(t.memoryUsage&&typeof t.memoryUsage.jsHeapUsedSize=="number"&&t.memoryUsage.jsHeapUsedSize>100*1024*1024){const i=Math.round(t.memoryUsage.jsHeapUsedSize/1024/1024);s.push(`High memory usage (${i}MB)`)}t.memoryUsage&&typeof t.memoryUsage.totalAgents=="number"&&t.memoryUsage.totalAgents>8&&s.push(`Too many agents loaded (${t.memoryUsage.totalAgents}) - consider cache optimization`),s.length>0&&console.warn("‚ö†Ô∏è Performance issues detected:",s)}catch(s){console.warn("‚ö†Ô∏è Failed to detect performance issues:",s)}}getPerformanceSummary(){if(this.metrics.length===0)return{totalSessions:0,averageTranscriptionTime:0,averageProcessingTime:0,averageCompressionRatio:0,memoryTrend:"stable",recommendedOptimizations:["Start using the extension to collect performance data"]};const t=this.metrics.filter(m=>m.processingPhase==="transcription"),s=this.metrics.filter(m=>m.processingPhase==="agent-processing"),a=this.metrics.filter(m=>m.compressionRatio!==void 0),i=t.length>0?t.reduce((m,x)=>m+x.duration,0)/t.length:0,r=s.length>0?s.reduce((m,x)=>m+x.duration,0)/s.length:0,o=a.length>0?a.reduce((m,x)=>m+(x.compressionRatio||0),0)/a.length:0,l=this.analyzeMemoryTrend(),d=this.generateOptimizationRecommendations(i,r,o,l);return{totalSessions:Math.floor(this.metrics.filter(m=>m.processingPhase==="complete").length),averageTranscriptionTime:Math.round(i),averageProcessingTime:Math.round(r),averageCompressionRatio:Math.round(o*10)/10,memoryTrend:l,recommendedOptimizations:d}}analyzeMemoryTrend(){try{const t=this.metrics.slice(-20).filter(x=>x&&x.memoryUsage&&typeof x.memoryUsage.jsHeapUsedSize=="number");if(t.length<5)return"stable";const s=Math.floor(t.length/2),a=t.slice(0,s),i=t.slice(s);if(a.length===0||i.length===0)return"stable";const r=a.reduce((x,g)=>x+(g.memoryUsage?.jsHeapUsedSize||0),0),o=i.reduce((x,g)=>x+(g.memoryUsage?.jsHeapUsedSize||0),0),l=r/a.length,d=o/i.length;if(l===0)return"stable";const m=(d-l)/l*100;return m>10?"increasing":m<-10?"decreasing":"stable"}catch(t){return console.warn("‚ö†Ô∏è Failed to analyze memory trend:",t),"stable"}}generateOptimizationRecommendations(t,s,a,i){const r=[];return t>8e3&&(r.push("Transcription is slow - check MLX Whisper server performance"),r.push("Consider restarting the Whisper server: ./start-whisper-server.sh")),s>2e4&&r.push("Agent processing is slow - consider using lighter models for simple tasks"),a<20&&r.push("Low compression ratio - audio files may benefit from better compression"),i==="increasing"&&(r.push("Memory usage is increasing - enable automatic cache optimization"),r.push("Consider restarting the extension periodically for long sessions")),r.length===0&&(r.push("Performance is optimal - no specific optimizations needed"),r.push("Continue using agent preloading for best performance")),r}clearMetrics(){this.metrics=[],console.log("üßπ Performance metrics cleared")}exportMetrics(){return[...this.metrics]}getRecentIssues(t=5){const s=Date.now()-t*60*1e3,a=this.metrics.filter(r=>r.timestamp>s),i=[];return a.forEach(r=>{r.processingPhase==="transcription"&&r.duration>1e4&&i.push(`Slow transcription: ${r.duration}ms`),r.processingPhase==="agent-processing"&&r.duration>3e4&&i.push(`Slow ${r.agentType} processing: ${r.duration}ms`)}),[...new Set(i)]}}class gt{static instance;historicalData=[];maxHistorySize=200;performanceService;agentProfiles={"investigation-summary":{baselineMs:1500,lengthScalingFactor:.8,modelComplexity:"lightweight",expectedRange:{min:1e3,max:3e3}},medication:{baselineMs:1800,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3500}},background:{baselineMs:2e3,lengthScalingFactor:1,modelComplexity:"lightweight",expectedRange:{min:1500,max:4e3}},bloods:{baselineMs:1600,lengthScalingFactor:.85,modelComplexity:"lightweight",expectedRange:{min:1100,max:3200}},imaging:{baselineMs:1700,lengthScalingFactor:.9,modelComplexity:"lightweight",expectedRange:{min:1200,max:3400}},"ohif-viewer":{baselineMs:2400,lengthScalingFactor:.8,modelComplexity:"lightweight",expectedRange:{min:1500,max:5e3}},"quick-letter":{baselineMs:4e3,lengthScalingFactor:1.2,modelComplexity:"standard",expectedRange:{min:2500,max:8e3}},consultation:{baselineMs:5e3,lengthScalingFactor:1.4,modelComplexity:"standard",expectedRange:{min:3e3,max:12e3}},tavi:{baselineMs:6e3,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},"angiogram-pci":{baselineMs:6500,lengthScalingFactor:1.8,modelComplexity:"heavy",expectedRange:{min:4e3,max:15e3}},mteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},tteer:{baselineMs:6e3,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:4e3,max:14e3}},"pfo-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"asd-closure":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"right-heart-cath":{baselineMs:5800,lengthScalingFactor:1.7,modelComplexity:"heavy",expectedRange:{min:3800,max:13e3}},"pvl-plug":{baselineMs:5500,lengthScalingFactor:1.6,modelComplexity:"heavy",expectedRange:{min:3500,max:12e3}},"bypass-graft":{baselineMs:7e3,lengthScalingFactor:2,modelComplexity:"heavy",expectedRange:{min:4500,max:18e3}},"tavi-workup":{baselineMs:6500,lengthScalingFactor:1.9,modelComplexity:"heavy",expectedRange:{min:4e3,max:16e3}},"ai-medical-review":{baselineMs:8e3,lengthScalingFactor:2.2,modelComplexity:"heavy",expectedRange:{min:5e3,max:2e4}},"batch-ai-review":{baselineMs:15e3,lengthScalingFactor:3,modelComplexity:"heavy",expectedRange:{min:1e4,max:45e3}},"aus-medical-review":{baselineMs:5200,lengthScalingFactor:1.6,modelComplexity:"standard",expectedRange:{min:3200,max:12e3}},"patient-education":{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:3e3,max:1e4}},enhancement:{baselineMs:3e3,lengthScalingFactor:1.1,modelComplexity:"standard",expectedRange:{min:2e3,max:6e3}},transcription:{baselineMs:2e3,lengthScalingFactor:.5,modelComplexity:"lightweight",expectedRange:{min:1e3,max:4e3}},generation:{baselineMs:4500,lengthScalingFactor:1.3,modelComplexity:"standard",expectedRange:{min:2500,max:9e3}}};constructor(){this.performanceService=pt.getInstance(),this.loadHistoricalData()}static getInstance(){return gt.instance||(gt.instance=new gt),gt.instance}predictProcessingTime(t,s,a){const i=this.agentProfiles[t];if(!i)throw new Error(`Unknown agent type: ${t}`);const r=this.historicalData.filter(R=>R.agentType===t),o=this.categorizeTranscriptionLength(s),l=i.baselineMs,d=this.calculateLengthFactor(s,i.lengthScalingFactor),m=this.calculateHistoricalAdjustment(t,s,r),x=this.calculateSystemPerformanceFactor(a?.systemPerformance),g=l*d*m*x,u=Math.max(i.expectedRange.min,Math.min(i.expectedRange.max,g)),v=a?.includeTranscriptionTime?u+this.estimateTranscriptionTime(s):u,p=this.calculateConfidenceLevel(r.length,o),w=p==="high"?.2:p==="medium"?.4:.6,b={min:Math.round(v*(1-w)),max:Math.round(v*(1+w))},P=[{name:"Agent baseline",impact:l,description:`${i.modelComplexity} model baseline`,type:"additive"},{name:"Transcription length",impact:d,description:`${o.category} transcription (${s} chars)`,type:"multiplier"}];return m!==1&&P.push({name:"Historical performance",impact:m,description:`Based on ${r.length} similar sessions`,type:"multiplier"}),x!==1&&P.push({name:"System performance",impact:x,description:a?.systemPerformance?`Current system load: ${a.systemPerformance}%`:"System performance adjustment",type:"multiplier"}),{estimatedDurationMs:Math.round(v),confidenceLevel:p,factors:P,range:b,basedOnSessions:r.length,displayText:this.formatEstimateForDisplay(b,p,r.length)}}categorizeTranscriptionLength(t){return t<300?{category:"short",range:{min:0,max:300},description:"Short dictation (< 300 characters)"}:t<800?{category:"medium",range:{min:300,max:800},description:"Medium dictation (300-800 characters)"}:t<1500?{category:"long",range:{min:800,max:1500},description:"Long dictation (800-1500 characters)"}:{category:"very-long",range:{min:1500,max:1/0},description:"Very long dictation (> 1500 characters)"}}calculateLengthFactor(t,s){const i=t/500;return 1+Math.log(i+1)*s*.3}calculateHistoricalAdjustment(t,s,a){if(a.length<3)return 1;const i={min:s*.5,max:s*1.5},r=a.filter(o=>o.transcriptionLength>=i.min&&o.transcriptionLength<=i.max);return r.length<2?this.calculateAveragePerformanceRatio(a,t):this.calculateAveragePerformanceRatio(r,t)}calculateAveragePerformanceRatio(t,s){const a=this.agentProfiles[s],i=t.map(o=>{const l=a.baselineMs*this.calculateLengthFactor(o.transcriptionLength,a.lengthScalingFactor);return o.actualProcessingTime/l}),r=i.reduce((o,l)=>o+l,0)/i.length;return Math.max(.5,Math.min(2,r))}calculateSystemPerformanceFactor(t){return t?2-Math.max(0,Math.min(100,t))/100*1.2:(this.performanceService.getPerformanceSummary(),this.performanceService.getRecentIssues(2).length>0?1.3:1)}estimateTranscriptionTime(t){return 1500+Math.log(t/100+1)*200}calculateConfidenceLevel(t,s){return t>=20?"high":t>=8?"medium":"low"}formatEstimateForDisplay(t,s,a){const i=this.formatDuration(t.min),r=this.formatDuration(t.max),o=s==="high"?"High confidence":s==="medium"?"Medium confidence":"Low confidence";return a>0?`Expected: ${i}-${r} (${o}, ${a} sessions)`:`Expected: ${i}-${r} (${o})`}formatDuration(t){if(t<1e3)return`${Math.round(t)}ms`;const s=t/1e3;return s<10?`${s.toFixed(1)}s`:`${Math.round(s)}s`}recordActualProcessingTime(t,s,a,i){const r={agentType:t,transcriptionLength:s,actualProcessingTime:a,timestamp:Date.now(),systemPerformance:i};this.historicalData.push(r),this.historicalData.length>this.maxHistorySize&&(this.historicalData=this.historicalData.slice(-this.maxHistorySize)),this.saveHistoricalData(),G.info(`Recorded processing time for ${t}`,{component:"processing-predictor",operation:"record-time",agentType:t,transcriptionLength:s,processingTime:a})}updatePredictionAccuracy(t,s){const a=s>=t.range.min&&s<=t.range.max,i=1-Math.abs(t.estimatedDurationMs-s)/t.estimatedDurationMs;return G.info(`Prediction accuracy: ${Math.round(i*100)}%, within range: ${a}`,{component:"processing-predictor",operation:"accuracy-check",accuracy:Math.round(i*100),withinRange:a}),{accuracy:Math.max(0,i),wasWithinRange:a}}getAgentPerformanceStats(t){const s=this.historicalData.filter(r=>r.agentType===t);if(s.length===0)return{averageTime:this.agentProfiles[t]?.baselineMs||5e3,sessionCount:0,accuracyTrend:"stable"};const a=s.reduce((r,o)=>r+o.actualProcessingTime,0)/s.length,i=this.analyzeTrend(s);return{averageTime:Math.round(a),sessionCount:s.length,accuracyTrend:i}}analyzeTrend(t){if(t.length<6)return"stable";const s=Math.floor(t.length/2),a=t.slice(0,s),i=t.slice(s),r=a.reduce((d,m)=>d+m.actualProcessingTime,0)/a.length,l=(i.reduce((d,m)=>d+m.actualProcessingTime,0)/i.length-r)/r*100;return l<-10?"improving":l>10?"declining":"stable"}async loadHistoricalData(){try{const t=await chrome.storage.local.get("processingTimeHistory");t.processingTimeHistory&&(this.historicalData=t.processingTimeHistory.slice(-this.maxHistorySize),G.info(`Loaded ${this.historicalData.length} historical processing time data points`,{component:"processing-predictor",operation:"load-data",dataPoints:this.historicalData.length}))}catch(t){G.warn("Failed to load historical processing time data",{component:"processing-predictor",operation:"load-data",error:t instanceof Error?t.message:String(t)})}}async saveHistoricalData(){try{await chrome.storage.local.set({processingTimeHistory:this.historicalData})}catch(t){G.warn("Failed to save historical processing time data",{component:"processing-predictor",operation:"save-data",error:t instanceof Error?t.message:String(t)})}}clearHistoricalData(){this.historicalData=[],chrome.storage.local.remove("processingTimeHistory"),G.info("Cleared historical processing time data",{component:"processing-predictor",operation:"clear-data"})}exportHistoricalData(){return[...this.historicalData]}}const en={"quick-letter":{min:3e4,max:6e4,complexity:"low"},consultation:{min:12e4,max:24e4,complexity:"medium"},"investigation-summary":{min:1e4,max:3e4,complexity:"low"},tavi:{min:48e4,max:72e4,complexity:"high"},mteer:{min:42e4,max:6e5,complexity:"high"},"pfo-closure":{min:3e5,max:48e4,complexity:"medium"},"right-heart-cath":{min:36e4,max:6e5,complexity:"medium"},"angiogram-pci":{min:48e4,max:9e5,complexity:"high"},"ai-medical-review":{min:18e4,max:24e4,complexity:"medium"}},Ai=({appState:n,isRecording:t=!1,recordingTime:s=0,transcriptionLength:a})=>{const[i,r]=c.useState(0),[o,l]=c.useState(null),[d]=c.useState(()=>gt.getInstance());c.useEffect(()=>{let u;return(n.processingStatus==="transcribing"||n.processingStatus==="processing")&&(u=window.setInterval(()=>{n.processingStartTime&&r(Date.now()-n.processingStartTime)},100)),()=>{u&&clearInterval(u)}},[n.processingStatus,n.processingStartTime]),c.useEffect(()=>{try{if(n.currentAgent&&typeof a=="number"&&a>0){const u=d.predictProcessingTime(n.currentAgent,a,{includeTranscriptionTime:!0});l(u)}else l(null)}catch(u){console.warn("Failed to predict processing time:",u),l(null)}},[n.currentAgent,a,d]);const m=u=>{if(u===null)return"0s";const v=Math.floor(u/1e3);if(v<60)return`${(u/1e3).toFixed(1)}s`;{const p=Math.floor(v/60),w=v%60;return`${p}m ${w}s`}},x=u=>{if(u===null)return"0s";const v=Math.floor(u/1e3);if(v<60)return`${v}s`;{const p=Math.floor(v/60),w=v%60;return`${p}m ${w.toString().padStart(2,"0")}s`}},g=(u,v)=>{if(o)return u<o.range.min?{icon:"üü¢",color:"text-green-600",label:"Fast"}:u<=o.range.max?{icon:"üü°",color:"text-yellow-600",label:"Normal"}:{icon:"üî¥",color:"text-red-600",label:"Slow"};if(!v||!en[v])return{icon:"üü°",color:"text-yellow-600",label:"Normal"};const p=en[v];return u<p.min?{icon:"üü¢",color:"text-green-600",label:"Fast"}:u<=p.max?{icon:"üü°",color:"text-yellow-600",label:"Normal"}:{icon:"üî¥",color:"text-red-600",label:"Slow"}};if(t&&s>0)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-red-600 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Recording..."}),e.jsxs("span",{className:"text-sm text-red-600 font-mono",children:["(",x(s)," elapsed)"]})]})});if(n.processingStatus==="transcribing")return e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ht,{className:"h-4 w-4 text-blue-600 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Transcribing..."}),e.jsxs("span",{className:"text-sm text-blue-600 font-mono",children:["(",x(i)," elapsed)"]})]})});if(n.processingStatus==="processing")return e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"h-4 w-4 text-purple-600 animate-pulse"}),e.jsxs("span",{className:"text-sm font-medium text-purple-800",children:[n.currentAgentName||"Agent"," Processing..."]}),e.jsxs("span",{className:"text-sm text-purple-600 font-mono",children:["(",x(i)," elapsed)"]})]})});if(n.processingStatus==="complete"&&n.totalProcessingTime){const u=g(n.totalProcessingTime,n.currentAgent),v=n.recordingTime?Math.round(n.recordingTime/n.totalProcessingTime*100):0,p=n.transcriptionTime?Math.round(n.transcriptionTime/n.totalProcessingTime*100):0,w=n.agentProcessingTime?Math.round(n.agentProcessingTime/n.totalProcessingTime*100):0;return e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(tt,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Processing Complete"}),e.jsxs("span",{className:`text-xs ${u.color}`,children:[u.icon," ",u.label]})]}),e.jsx("span",{className:"text-sm font-semibold text-green-800",children:m(n.totalProcessingTime)})]}),e.jsxs("div",{className:"space-y-2",children:[n.recordingTime&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Recording (Voice Input)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-red-400 h-1.5 rounded-full",style:{width:`${v}%`}})}),e.jsx("span",{className:"w-12 text-right font-medium",children:m(n.recordingTime)}),e.jsxs("span",{className:"w-8 text-right text-gray-500",children:[v,"%"]})]})]}),n.transcriptionTime&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Transcription (MLX Whisper)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-400 h-1.5 rounded-full",style:{width:`${p}%`}})}),e.jsx("span",{className:"w-12 text-right font-medium",children:m(n.transcriptionTime)}),e.jsxs("span",{className:"w-8 text-right text-gray-500",children:[p,"%"]})]})]}),n.agentProcessingTime&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),e.jsxs("span",{className:"text-gray-700",children:[n.currentAgentName||"Agent"," (MedGemma-27b MLX)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-purple-400 h-1.5 rounded-full",style:{width:`${w}%`}})}),e.jsx("span",{className:"w-12 text-right font-medium",children:m(n.agentProcessingTime)}),e.jsxs("span",{className:"w-8 text-right text-gray-500",children:[w,"%"]})]})]})]}),(()=>{if(o)return e.jsx("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:o.displayText});if(n.currentAgent&&en[n.currentAgent]){const b=en[n.currentAgent];return e.jsxs("div",{className:"text-xs text-gray-600 pt-1 border-t border-green-100",children:["Expected: ",m(b.min)," - ",m(b.max)," (",b.complexity," complexity)"]})}return null})()]})})}return null},Zs=c.memo(({results:n,agentType:t,className:s=""})=>{const[a,i]=c.useState(!0),[r,o]=c.useState(!1),l=c.useMemo(()=>{const u=n.split(/\s+/).filter(b=>b.length>0).length,v=Math.ceil(u/200),p=n.length,w=n.split(`
`).length;return{wordCount:u,readingTime:v,charCount:p,lineCount:w}},[n]),d=n.length>1e3,m=c.useMemo(()=>!d||r?n:n.substring(0,500)+"...",[n,d,r]),x=c.useMemo(()=>{const u=[],v=m.split(`
`);let p={title:"",content:""};for(const w of v){const b=w.trim();b.match(/^[A-Z][A-Z\s]+:?$/)||b.match(/^[A-Z][a-z\s]+:$/)?(p.content.trim()&&u.push({...p}),p={title:b.replace(":",""),content:""}):b&&(p.content+=w+`
`)}return p.content.trim()&&u.push(p),u.length===0&&u.push({title:"Medical Report",content:m}),u},[m]),g=u=>u?{tavi:"TAVI Report","angiogram-pci":"Angiogram/PCI Report","quick-letter":"Quick Letter",consultation:"Consultation Report","investigation-summary":"Investigation Summary",background:"Background Summary",medication:"Medication Review",bloods:"Blood Test Order",imaging:"Imaging Order",mteer:"mTEER Report",tteer:"TTEER Report","pfo-closure":"PFO Closure Report","asd-closure":"ASD Closure Report","pvl-plug":"PVL Plug Report","bypass-graft":"Bypass Graft Report","right-heart-cath":"Right Heart Catheterisation","tavi-workup":"TAVI Workup","ai-medical-review":"AI Medical Review","batch-ai-review":"Batch AI Review","patient-education":"Patient Education","ohif-viewer":"Imaging Viewer Summary","aus-medical-review":"Australian Medical Review",enhancement:"Enhanced Report",transcription:"Transcription",generation:"Generated Report"}[u]||u.toUpperCase():"Medical Report";return n?e.jsxs("div",{className:`glass rounded-2xl overflow-hidden ${s}`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>i(!a),className:"p-1 hover:bg-gray-100 rounded transition-colors","aria-label":a?"Collapse report":"Expand report",children:a?e.jsx(un,{className:"w-5 h-5 text-gray-600"}):e.jsx(at,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold text-sm",children:g(t)}),e.jsxs("div",{className:"text-gray-600 text-xs mt-1",children:[e.jsxs("span",{children:[l.wordCount," words"]}),e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),e.jsxs("span",{children:[l.readingTime," min read"]}),e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),e.jsx("span",{children:new Date().toLocaleTimeString()})]})]})]}),d&&e.jsx("button",{onClick:()=>o(!r),className:"text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:r?"Show Less":"Show More"})]})}),a&&e.jsxs("div",{className:"report-content",children:[x.length>1?e.jsx("div",{className:"space-y-4 p-4",children:x.map((u,v)=>e.jsxs("div",{className:"section",children:[u.title&&e.jsx("h4",{className:"font-semibold text-gray-900 border-b border-gray-200 pb-1 mb-2 text-sm",children:u.title}),e.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:u.content})]},v))}):e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap font-mono",children:m})}),d&&!r&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("button",{onClick:()=>o(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1 transition-colors",children:[e.jsxs("span",{children:["Show complete report (",l.charCount," characters)"]}),e.jsx(at,{className:"w-4 h-4"})]})})]})]}):null});Zs.displayName="ReportDisplay";const ea=({audioBlob:n,fileName:t="investigation-audio",className:s="",onAnalysisUpdate:a})=>{const[i,r]=c.useState(!1),[o,l]=c.useState(0),[d,m]=c.useState(0),[x,g]=c.useState(1),[u,v]=c.useState(1),[p,w]=c.useState([]),[b,P]=c.useState(""),[R,j]=c.useState(null),[h,N]=c.useState(!1),[C,E]=c.useState(!1),A=c.useRef(null),O=c.useRef(null),S=c.useRef(),f=c.useRef();c.useEffect(()=>{const V=URL.createObjectURL(n);return P(V),()=>{URL.revokeObjectURL(V)}},[n]);const T=c.useCallback(async()=>{if(n)try{const V=await n.arrayBuffer(),J=new AudioContext,Z=await J.decodeAudioData(V),ae=Z.getChannelData(0),ke=Z.sampleRate,we=Z.duration;let Ce=0,y=0;const I=.01;for(let re=0;re<ae.length;re++){const Te=Math.abs(ae[re]);Ce+=Te,Te<I&&y++}const D=Ce/ae.length,H=y/ke,$=[...ae].map(Math.abs).sort((re,Te)=>re-Te),z=$[Math.floor($.length*.1)],K=$[Math.floor($.length*.9)],je=K>0?20*Math.log10(K/(z+.001)):0;let L="good";D<.005||H>we*.8||je<10?L="poor":(D<.02||H>we*.5||je<20)&&(L="fair");const B=200,ie=Math.floor(ae.length/B),te=[];for(let re=0;re<B;re++){let Te=0;const ce=re*ie,Me=Math.min(ce+ie,ae.length);for(let Re=ce;Re<Me;Re++)Te+=Math.abs(ae[Re]);te.push(Te/(Me-ce))}const ee={duration:we,fileSize:n.size,quality:L,avgVolume:D,silenceDuration:H,estimatedSNR:je};w(te),j(ee),a?.(ee),await J.close()}catch(V){console.error("Audio analysis failed:",V)}},[n,a]);c.useEffect(()=>{b&&T()},[b,T]);const k=c.useCallback(()=>{const V=O.current;if(!V||!p.length||!d)return;const J=V.getContext("2d");if(!J)return;const{width:Z,height:ae}=V,ke=o/d;J.clearRect(0,0,Z,ae);const we=Z/p.length,Ce=Math.max(...p);p.forEach((I,D)=>{const H=Math.max(2,I/Ce*ae*.8),$=D*we,z=(ae-H)/2;D/p.length<=ke?J.fillStyle=h?"#1d4ed8":"#3b82f6":J.fillStyle="#d1d5db",J.fillRect($,z,Math.max(1,we-1),H)});const y=ke*Z;J.strokeStyle=h?"#dc2626":"#ef4444",J.lineWidth=h?3:2,J.beginPath(),J.moveTo(y,0),J.lineTo(y,ae),J.stroke(),h&&(J.fillStyle="rgba(239, 68, 68, 0.2)",J.fillRect(y-2,0,4,ae))},[p,o,d,h]);c.useEffect(()=>{k()},[k]);const M=()=>{if(A.current&&!h&&!C){const V=A.current.currentTime;isFinite(V)&&V>=0&&l(V)}},_=()=>{if(A.current){const V=A.current.duration;isFinite(V)&&V>0?m(V):(console.warn("Invalid audio duration detected:",V),m(0))}},F=()=>{r(!1),ne()},U=c.useCallback(()=>{f.current&&(window.clearTimeout(f.current),f.current=void 0),N(!1),A.current&&isFinite(A.current.currentTime)&&l(A.current.currentTime)},[]),X=c.useCallback(()=>{f.current&&(window.clearTimeout(f.current),f.current=void 0),N(!1),A.current&&isFinite(A.current.currentTime)&&l(A.current.currentTime)},[]),q=c.useCallback(()=>{if(!i||!A.current||h||C)return;const V=()=>{A.current&&i&&!h&&!C&&(l(A.current.currentTime),S.current=requestAnimationFrame(V))};S.current=requestAnimationFrame(V)},[i,h,C]),ne=c.useCallback(()=>{S.current&&(cancelAnimationFrame(S.current),S.current=void 0)},[]),be=c.useCallback(()=>{!A.current||h||(i?(A.current.pause(),r(!1),ne()):A.current.play().then(()=>{r(!0),!C&&!h&&q()}).catch(V=>{console.error("Audio playback failed:",V),r(!1)}))},[i,h,C,q,ne]),ve=c.useCallback(V=>{if(!A.current||!d||!isFinite(d)||d<=0){console.log("‚ùå seekTo validation failed:",{hasAudioRef:!!A.current,duration:d,isFiniteDuration:isFinite(d||0),durationValid:(d||0)>0});return}if(!isFinite(V)||V<0||V>100){console.error("‚ùå Invalid percentage in seekTo:",{percentage:V,isFinite:isFinite(V),inRange:V>=0&&V<=100});return}if(h)return;N(!0);const J=V/100*d,Z=Math.max(0,Math.min(d,J));if(!isFinite(Z)){console.error("‚ùå Calculated newTime is non-finite:",{percentage:V,duration:d,rawNewTime:J,newTime:Z}),N(!1);return}console.log("üéØ Seeking to:",{percentage:V.toFixed(2),newTime:Z.toFixed(2),duration:d.toFixed(2)}),f.current&&(window.clearTimeout(f.current),f.current=void 0),l(Z);try{isFinite(Z)&&Z>=0&&Z<=d?(A.current.currentTime=Z,f.current=window.setTimeout(()=>{N(!1),A.current&&isFinite(A.current.currentTime)&&l(A.current.currentTime)},200)):(console.error("‚ùå Final validation failed for currentTime:",{newTime:Z,duration:d}),N(!1))}catch(ae){console.error("‚ùå Seek failed:",ae),N(!1),f.current&&(window.clearTimeout(f.current),f.current=void 0)}},[d,h]),_e=c.useCallback(V=>{V.preventDefault(),V.stopPropagation();const J=O.current;if(!J||!d||!isFinite(d)||d<=0){console.log("‚ùå Cannot seek: canvas or duration not available",{canvas:!!J,duration:d,isFiniteDuration:isFinite(d||0)});return}if(h){console.log("‚è≠Ô∏è Seek already in progress, ignoring click");return}const Z=J.getBoundingClientRect(),ae=V.clientX-Z.left,ke=ae/Z.width*100,we=Math.max(0,Math.min(100,ke));if(!isFinite(we)){console.error("‚ùå Invalid percentage calculated:",{x:ae,width:Z.width,rawPercentage:ke,percentage:we});return}console.log("üéØ Waveform clicked:",{x:ae.toFixed(2),width:Z.width.toFixed(2),percentage:we.toFixed(2)});try{ve(we)}catch(Ce){console.error("‚ùå Waveform seek failed:",Ce)}},[d,h,ve]),ye=c.useCallback(()=>{ne(),r(!1),E(!1),A.current&&A.current.pause(),ve(0)},[ve,ne]),We=()=>{const V=URL.createObjectURL(n),J=document.createElement("a");J.href=V,J.download=`${t}-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.webm`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(V)},Y=V=>{if(!isFinite(V)||isNaN(V)||V<0)return"0:00";const J=Math.floor(V/60),Z=Math.floor(V%60);return`${J}:${Z.toString().padStart(2,"0")}`},le=V=>{switch(V){case"good":return"text-green-600";case"fair":return"text-yellow-600";case"poor":return"text-red-600";default:return"text-gray-600"}},Ae=V=>{switch(V){case"good":return"‚úÖ";case"fair":return"‚ö†Ô∏è";case"poor":return"‚ùå";default:return"‚ùì"}};return c.useEffect(()=>{i||ne()},[i,ne]),c.useEffect(()=>()=>{f.current&&window.clearTimeout(f.current)},[]),c.useEffect(()=>()=>{ne(),f.current&&window.clearTimeout(f.current)},[ne]),e.jsxs("div",{className:`space-y-4 p-4 bg-gray-50 rounded-lg border ${s}`,children:[e.jsx("audio",{ref:A,src:b,onTimeUpdate:M,onLoadedMetadata:_,onEnded:F,onSeeked:U,onError:X,onRateChange:()=>g(A.current?.playbackRate||1),preload:"metadata"}),R&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Quality:"}),e.jsxs("span",{className:`font-medium ${le(R.quality)}`,children:[Ae(R.quality)," ",R.quality.toUpperCase()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Duration:"}),e.jsx("span",{className:"text-gray-900",children:Y(R.duration)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"File Size:"}),e.jsxs("span",{className:"text-gray-900",children:[(R.fileSize/1024).toFixed(1),"KB"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Avg Volume:"}),e.jsxs("span",{className:"text-gray-900",children:[(R.avgVolume*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Silence:"}),e.jsx("span",{className:"text-gray-900",children:Y(R.silenceDuration)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Est. SNR:"}),e.jsxs("span",{className:"text-gray-900",children:[R.estimatedSNR.toFixed(1),"dB"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("canvas",{ref:O,width:400,height:80,className:`w-full h-20 bg-white rounded border transition-all duration-200 ${h?"cursor-grabbing border-blue-400 shadow-md":"cursor-pointer hover:bg-gray-50 hover:border-gray-300"}`,onClick:_e,onMouseMove:V=>{const J=O.current;if(J&&d&&isFinite(d)&&d>0&&!h){const Z=J.getBoundingClientRect(),ae=V.clientX-Z.left,we=Math.max(0,Math.min(100,ae/Z.width*100))/100*d;J.title=`Click to seek to ${Y(we)}`}else J&&h&&(J.title="Seeking...")},style:{touchAction:"none"}}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:Y(o)}),e.jsx("span",{className:h?"text-blue-600 font-medium":"",children:h?"Seeking...":"Click waveform to seek"}),e.jsx("span",{children:Y(d)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{type:"range",min:"0",max:"100",step:"0.1",value:d&&isFinite(d)&&d>0?o/d*100:0,onMouseDown:()=>{E(!0),ne()},onMouseUp:()=>{E(!1),i&&!h&&q()},onTouchStart:()=>{E(!0),ne()},onTouchEnd:()=>{E(!1),i&&!h&&q()},onInput:V=>{if(C){const J=parseFloat(V.target.value);isFinite(J)&&ve(J)}},onChange:()=>{},className:"w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",disabled:!d||!isFinite(d)||d<=0}),e.jsx("div",{className:"text-xs text-gray-400 text-center",children:"Alternative: Use slider above to seek"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:be,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition-colors",disabled:!b,children:i?e.jsx(_a,{className:"w-5 h-5"}):e.jsx(Wn,{className:"w-5 h-5 ml-1"})}),e.jsx("button",{onClick:ye,className:"flex items-center justify-center w-8 h-8 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-full transition-colors",disabled:!b,children:e.jsx($a,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(La,{className:"w-4 h-4 text-gray-600"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:u,onChange:V=>{const J=parseFloat(V.target.value);v(J),A.current&&(A.current.volume=J)},className:"w-20 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:x,onChange:V=>{const J=parseFloat(V.target.value);g(J),A.current&&(A.current.playbackRate=J)},className:"text-xs bg-white border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:.5,children:"0.5x"}),e.jsx("option",{value:.75,children:"0.75x"}),e.jsx("option",{value:1,children:"1.0x"}),e.jsx("option",{value:1.25,children:"1.25x"}),e.jsx("option",{value:1.5,children:"1.5x"}),e.jsx("option",{value:2,children:"2.0x"})]}),e.jsx("button",{onClick:We,className:"flex items-center justify-center w-8 h-8 bg-green-600 hover:bg-green-700 text-white rounded transition-colors",title:"Download audio file",children:e.jsx(Vt,{className:"w-4 h-4"})})]})]}),R&&R.quality!=="good"&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3",children:e.jsx("div",{className:"flex items-start",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Audio Quality Issues Detected"}),e.jsxs("div",{className:"mt-1 text-xs text-yellow-600 space-y-1",children:[R.avgVolume<.005&&e.jsx("p",{children:"‚Ä¢ Recording is very quiet - check microphone levels"}),R.silenceDuration>R.duration*.5&&e.jsx("p",{children:"‚Ä¢ Recording contains significant silence"}),R.estimatedSNR<15&&e.jsx("p",{children:"‚Ä¢ High background noise detected"}),R.duration<2&&e.jsx("p",{children:"‚Ä¢ Recording is very short - may affect transcription accuracy"})]})]})})})]})},_t=c.memo(({originalTranscription:n,onTranscriptionCopy:t,onTranscriptionInsert:s,onTranscriptionEdit:a,transcriptionSaveStatus:i,onAgentReprocess:r,currentAgent:o,isProcessing:l=!1,className:d="",audioBlob:m,defaultExpanded:x=!1,collapseWhen:g,approvalState:u,onTranscriptionApprove:v})=>{const[p,w]=c.useState(!!x),[b,P]=c.useState(!1),[R,j]=c.useState(!1),[h,N]=c.useState(n||"");ue.useEffect(()=>{g&&p&&w(!1)},[g]),ue.useEffect(()=>{N(n)},[n]);const C=f=>{N(f),a&&a(f)},E=[{id:"tavi",label:"TAVI",icon:"ü´Ä"},{id:"angiogram-pci",label:"Angiogram/PCI",icon:"ü©∫"},{id:"quick-letter",label:"Quick Letter",icon:"üìù"},{id:"consultation",label:"Consultation",icon:"üë®‚Äç‚öïÔ∏è"},{id:"investigation-summary",label:"Investigation",icon:"üî¨"}],A=async()=>{if(t)try{await t(h),P(!0),setTimeout(()=>P(!1),2e3)}catch(f){console.error("Failed to copy transcription:",f)}},O=async()=>{if(s)try{await s(h),j(!0),setTimeout(()=>j(!1),2e3)}catch(f){console.error("Failed to insert transcription:",f)}},S=f=>{r&&!l&&r(f)};return e.jsxs("div",{className:`border-b border-gray-200/50 ${d} ${l?"bg-blue-50/30 border-b-blue-200/50":""}`,children:[e.jsxs("button",{onClick:()=>w(!p),className:`w-full p-4 text-left transition-colors flex items-center justify-between ${l?"hover:bg-blue-50/60":"hover:bg-gray-50/50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(He,{className:`w-4 h-4 ${l?"text-blue-600":"text-gray-600"}`}),e.jsx("span",{className:`font-medium text-sm ${l?"text-blue-900":"text-gray-900"}`,children:"Original Transcription"}),l&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-medium",children:"Processing..."}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(h||"").split(" ").filter(f=>f.trim()).length," words",h!==n&&e.jsx("span",{className:"text-blue-600 ml-1",children:"(edited)"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t&&e.jsxs("button",{onClick:f=>{f.stopPropagation(),A()},className:`px-2 py-1.5 rounded transition-all duration-200 flex items-center space-x-1 ${l?"bg-blue-50 border border-blue-200 hover:bg-blue-100 shadow-sm":"p-1.5 hover:bg-gray-100"}`,title:l?"Copy raw transcription":"Copy transcription",children:[b?e.jsx(qe,{className:"w-3.5 h-3.5 text-green-600"}):e.jsx(ft,{className:"w-3.5 h-3.5 text-blue-600",title:"Copy transcription"}),l&&e.jsx("span",{className:"text-xs text-blue-700 font-medium",children:"Copy Raw"})]}),s&&e.jsx("button",{onClick:f=>{f.stopPropagation(),O()},className:"p-1.5 rounded hover:bg-gray-100 transition-colors",title:"Insert transcription to EMR",children:R?e.jsx(qe,{className:"w-3.5 h-3.5 text-green-600"}):e.jsx(ct,{className:"w-3.5 h-3.5 text-blue-500"})}),r&&e.jsx("div",{className:"p-1.5",children:e.jsx(Yt,{className:`w-3.5 h-3.5 text-purple-500 ${l?"animate-spin":""}`})}),p?e.jsx(Js,{className:"w-4 h-4 text-gray-400"}):e.jsx(Qs,{className:"w-4 h-4 text-gray-400"})]})]}),p&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"bg-gray-50/80 rounded-lg p-2 border border-gray-200/50",children:[i&&i.status!=="idle"&&e.jsxs("div",{className:`flex items-center space-x-2 mb-2 p-2 rounded text-xs ${i.status==="saving"?"bg-yellow-50 text-yellow-700 border border-yellow-200":i.status==="saved"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[i.status==="saving"&&e.jsx("div",{className:"w-3 h-3 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:i.message}),i.timestamp&&e.jsxs("span",{className:"opacity-70",children:["at ",i.timestamp.toLocaleTimeString()]})]}),u&&v&&e.jsxs("div",{className:"mb-3 p-3 bg-white border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Training Data Quality Control"}),e.jsxs("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${u.status==="pending"?"bg-gray-100 text-gray-700":u.status==="approved"?"bg-green-100 text-green-700":u.status==="edited"?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-500"}`,children:[u.status==="pending"&&"‚è≥ Not Reviewed",u.status==="approved"&&"‚úÖ Approved",u.status==="edited"&&"‚úèÔ∏è Edited",u.status==="skipped"&&"‚è≠Ô∏è Skipped"]})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-3",children:[u.status==="pending"&&"Choose how to handle this transcription for AI training:",u.status==="approved"&&"This transcription has been approved and will be used for training.",u.status==="edited"&&"Your corrections will improve future transcriptions.",u.status==="skipped"&&"This transcription won't be used for training."]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>v("approved"),disabled:u.status==="approved",className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${u.status==="approved"?"bg-green-100 text-green-700 border border-green-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-green-400 hover:bg-green-50"}`,title:"Mark this transcription as perfect for training",children:[e.jsx(Fa,{className:"w-4 h-4"}),e.jsx("span",{children:"Perfect"})]}),e.jsxs("button",{onClick:()=>{u.status!=="edited"&&v("edited")},className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${u.status==="edited"?"bg-orange-100 text-orange-700 border border-orange-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-orange-400 hover:bg-orange-50"}`,title:"Edit this transcription to improve accuracy",children:[e.jsx(za,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:()=>v("skipped"),disabled:u.status==="skipped",className:`px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center space-x-2 ${u.status==="skipped"?"bg-gray-100 text-gray-700 border border-gray-200":"bg-white border-2 border-gray-300 text-gray-700 hover:border-gray-400 hover:bg-gray-50"}`,title:"Skip this transcription for training",children:[e.jsx(Ua,{className:"w-4 h-4"}),e.jsx("span",{children:"Skip"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:h,onChange:f=>C(f.target.value),disabled:!a,className:`w-full h-32 p-2 pb-6 text-sm text-gray-900 bg-white border border-gray-200 rounded resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 leading-relaxed ${a?"":"opacity-60 cursor-not-allowed"}`,placeholder:a?"Edit transcription to improve accuracy - corrections will be submitted for training only with your approval...":"Transcription editing not available",title:a?"Edit the transcription to improve accuracy. Training data is only submitted when you explicitly approve it.":"Transcription editing not available"}),e.jsxs("div",{className:"absolute bottom-1 right-2 flex items-center space-x-2 text-xs text-gray-400",children:[e.jsx("span",{children:"üß† Training AI"}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[(h||"").split(" ").filter(f=>f.trim()).length," words"]}),h!==n&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{className:"text-blue-600",children:"edited"})]})]})]})]}),e.jsx("div",{className:"mt-2 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:[u?.status==="pending"?"Choose how to handle this transcription above - training data is only submitted with your explicit approval.":u?.status==="approved"?"This approved transcription will help train Whisper.":u?.status==="edited"?"Your corrections will help train Whisper to be more accurate.":u?.status==="skipped"?"This transcription will not be used for training.":"Training data is only submitted with your explicit approval."," ",e.jsx("button",{className:"text-blue-600 underline hover:text-blue-800",onClick:()=>{console.log("üéØ User wants to view training contributions - would open settings modal")},children:"View your contributions"})]})}),m&&e.jsx("div",{className:"mt-3",children:e.jsx(ea,{audioBlob:m,fileName:`transcription-${o||"recording"}`,className:"bg-white border-gray-200"})}),r&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Reprocess with different agent:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(f=>e.jsxs("button",{onClick:()=>S(f.id),disabled:l,className:`px-2 py-1 text-xs rounded-md border transition-colors flex items-center space-x-1 ${o===f.id?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"} ${l?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("span",{children:f.icon}),e.jsx("span",{children:f.label}),o===f.id&&e.jsx("span",{className:"text-xs text-blue-500",children:"‚Ä¢"})]},f.id))})]})]})]})});_t.displayName="TranscriptionSection";const ta=c.memo(({reviewData:n,className:t=""})=>{const[s,a]=c.useState(new Set),[i,r]=c.useState(!1),[o,l]=c.useState(new Set);console.log("üé¥ AI REVIEW CARDS: Component render with data:",{hasReviewData:!!n,reviewDataType:typeof n,reviewDataKeys:n?Object.keys(n):null,findingsArray:n?.findings,findingsType:typeof n?.findings,findingsCount:n?.findings?.length||0,isBatchReview:n?.isBatchReview,timestamp:n?.timestamp,findingsPreview:Array.isArray(n?.findings)?n.findings.slice(0,2):"Not an array"});const d=Array.isArray(n?.findings)?n.findings:[];c.useEffect(()=>{d.length>0&&(a(new Set),l(new Set),r(!0),console.log("üîÑ Reset AI Review acknowledged findings for new review data"),d.forEach((g,u)=>{setTimeout(()=>{l(v=>new Set([...v,u]))},u*200+300)}),setTimeout(()=>{r(!1)},d.length*200+800))},[d.length,n?.timestamp]);const m=g=>{switch(g){case"Immediate":return"red";case"Soon":return"amber";default:return"blue"}},x=g=>{const u=new Set(s);s.has(g)?u.delete(g):u.add(g),a(u)};return e.jsxs("div",{className:`space-y-3 ${t}`,children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 transition-all duration-500 ${o.size>0||d.length===0?"opacity-100 translate-y-0":"opacity-0 translate-y-2"}`,children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Clinical Advisory Cards"}),e.jsx("div",{className:"text-xs text-gray-500",children:d.length>0?`${s.size} of ${d.length} reviewed`:"No findings"})]}),d.length===0?e.jsxs("div",{className:"text-center py-8 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h4",{className:"text-green-800 font-medium mb-2",children:"No Clinical Oversights Identified"}),e.jsx("p",{className:"text-green-700 text-sm",children:n?.noFindingsReason||"The AI review found no major clinical oversights based on Australian guidelines."})]}):d.map((g,u)=>{const v=s.has(u),p=m(g.urgency),w=o.has(u);return e.jsx("div",{className:`border rounded-lg motion-safe:transition-all motion-safe:duration-500 motion-safe:transform motion-reduce:transition-none ${w?"opacity-100 translate-y-0 scale-100":"opacity-0 translate-y-4 scale-95"} ${v?"opacity-60 border-gray-200 bg-gray-50":`border-${p}-200 bg-white`}`,style:{transitionDelay:w?"0ms":`${u*100}ms`},role:"article","aria-labelledby":`finding-${u}-title`,"aria-describedby":`finding-${u}-description`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("button",{onClick:()=>x(u),className:`flex-shrink-0 w-5 h-5 rounded border-2 motion-safe:transition-colors motion-reduce:transition-none flex items-center justify-center ${v?"bg-green-500 border-green-500":`border-${p}-300 hover:border-${p}-400`}`,"aria-label":v?"Mark as unreviewed":"Mark as reviewed","aria-pressed":v,children:v&&e.jsx(qe,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{id:`finding-${u}-title`,className:`font-medium text-sm ${v?"text-gray-500":"text-gray-900"}`,children:g.finding}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${p==="red"?"bg-red-100 text-red-800":p==="amber"?"bg-amber-100 text-amber-800":"bg-blue-100 text-blue-800"}`,children:g.urgency}),g.patientName&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:g.patientName})]}),g.patientFileNumber&&e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["File: ",g.patientFileNumber]}),!v&&e.jsxs("div",{id:`finding-${u}-description`,className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Guideline:"})," ",g.australianGuideline]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Reasoning:"})," ",g.clinicalReasoning]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Recommendation:"})," ",g.recommendedAction]}),g.heartFoundationLink&&e.jsx("div",{className:"text-sm",children:e.jsx("a",{href:g.heartFoundationLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 underline",children:"Heart Foundation Resource ‚Üí"})})]})]})]})})},u)})]})});ta.displayName="AIReviewCards";const Ri=ue.lazy(()=>Pe(()=>import("./chunks/AIReasoningModal.DwmTRHIp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),na=c.memo(({results:n,agentType:t,onCopy:s,onInsertToEMR:a,className:i="",reportMetadata:r,agentName:o})=>{const[l,d]=c.useState(!1),[m,x]=c.useState(!1),[g,u]=c.useState(!1),v=r?.reasoningArtifacts?.hasReasoningContent||r?.rawAIOutput&&r.rawAIOutput.trim().length>0,p=async()=>{try{await s(n),d(!0),setTimeout(()=>d(!1),2e3)}catch(P){console.error("Failed to copy:",P)}},w=async()=>{try{typeof a=="function"&&await a(n,void 0,t),x(!0),setTimeout(()=>x(!1),2e3)}catch(P){console.error("Failed to insert to EMR:",P)}},b=()=>{const P=new Blob([n],{type:"text/plain"}),R=URL.createObjectURL(P),j=document.createElement("a");j.href=R,j.download=`medical-report-${t||"report"}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(R)};return e.jsxs("div",{className:`p-4 border-t border-emerald-200/50 ${i}`,children:[e.jsxs("div",{className:`grid gap-2 ${v?"grid-cols-4":"grid-cols-3"}`,children:[e.jsxs("button",{onClick:p,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${l?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,children:[l?e.jsx(qe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):e.jsx(ft,{className:"w-4 h-4",title:"Copy"}),e.jsx("span",{className:`text-xs ${l?"text-emerald-700":"text-gray-700"}`,children:l?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:w,className:`
            p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
            ${m?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
          `,children:[m?e.jsx(qe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):e.jsx(ct,{className:"w-4 h-4"}),e.jsx("span",{className:`text-xs ${m?"text-emerald-700":"text-gray-700"}`,children:m?"Inserted!":"Insert"})]}),e.jsxs("button",{onClick:b,className:"bg-white/60 border border-emerald-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-emerald-50/60 transition-colors btn-micro-press btn-micro-hover",children:[e.jsx(Vt,{className:"w-4 h-4 text-gray-700"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]}),v&&e.jsxs("button",{onClick:()=>u(!0),className:"bg-white border-2 border-gray-300 p-3 rounded-lg flex flex-col items-center space-y-1 hover:border-gray-400 hover:shadow-sm transition-all duration-200 ease-out btn-micro-press",title:"View AI Reasoning Process",children:[e.jsx(bt,{className:"w-4 h-4 text-gray-700"}),e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Reasoning"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(dt,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-green-400 text-xs",children:"Report generated successfully"})]}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Confidence: 95%"})]}),e.jsx("div",{className:"mt-3 p-2 bg-emerald-50/50 rounded-lg border border-emerald-100",children:e.jsxs("p",{className:"text-emerald-700 text-xs",children:["üí° ",e.jsx("strong",{children:"Full Letter:"})," Complete medical correspondence ready for EMR insertion or sharing.",v&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"üß† ",e.jsx("strong",{children:"AI Reasoning:"})," View how the AI processed your dictation for transparency."]})]})}),v&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(Ri,{isOpen:g,onClose:()=>u(!1),reasoningArtifacts:r?.reasoningArtifacts,rawAIOutput:r?.rawAIOutput,agentName:o})})]})});na.displayName="ActionButtons";const sa=c.memo(({warnings:n=[],onDismissWarnings:t,className:s=""})=>{const[a,i]=c.useState(!1);return!n||n.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>i(!a),className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 hover:bg-orange-200 transition-colors",title:`${n.length} warning${n.length!==1?"s":""} - click to ${a?"hide":"view"}`,children:[e.jsx(dt,{className:"w-3 h-3"}),e.jsx("span",{children:n.length})]}),a&&e.jsx("div",{className:`p-4 border-b border-orange-200/50 bg-orange-50/30 ${s}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(dt,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-orange-800 font-medium text-sm mb-2",children:"Content Warnings"}),e.jsx("ul",{className:"space-y-1",children:n.map((r,o)=>e.jsxs("li",{className:"text-orange-700 text-sm leading-relaxed",children:["‚Ä¢ ",r]},o))}),t&&e.jsx("button",{onClick:()=>{t(),i(!1)},className:"mt-3 text-orange-600 hover:text-orange-700 text-xs font-medium transition-colors",children:"Dismiss warnings"})]})]})})]})});sa.displayName="WarningsPanel";const aa=c.memo(({failedAudioRecordings:n,errors:t,onClearFailedRecordings:s,className:a=""})=>{const[i,r]=c.useState(!1),[o,l]=c.useState(null);return n.length>0&&t.length>0&&t.some(m=>m.includes("could not be parsed coherently")||m.includes("Investigation dictation could not be parsed"))?e.jsxs("div",{className:`border-t border-red-200/50 bg-red-50/30 ${a}`,children:[e.jsxs("button",{onClick:()=>r(!i),className:"w-full p-4 text-left hover:bg-red-50/50 transition-colors flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ki,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-red-900 font-medium text-sm",children:"üîä Troubleshoot Audio Recording"}),e.jsxs("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-0.5 rounded-full",children:[n.length," recording",n.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s&&e.jsx("button",{onClick:m=>{m.stopPropagation(),s()},className:"p-1.5 rounded hover:bg-red-100 transition-colors",title:"Clear all failed recordings",children:e.jsx(vt,{className:"w-3.5 h-3.5 text-red-500"})}),i?e.jsx(Js,{className:"w-4 h-4 text-red-400"}):e.jsx(Qs,{className:"w-4 h-4 text-red-400"})]})]}),i&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-red-700 bg-red-100/50 p-3 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(dt,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Investigation parsing failed"}),e.jsx("p",{className:"text-red-600 mt-1 text-xs",children:"The recording could not be processed into a structured investigation summary. Use the audio playback below to identify potential issues:"}),e.jsxs("ul",{className:"mt-2 text-xs text-red-600 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Check if audio is too quiet or contains too much silence"}),e.jsx("li",{children:"‚Ä¢ Verify medical terminology is clearly spoken"}),e.jsx("li",{children:"‚Ä¢ Ensure recording duration is adequate (‚â•2 seconds)"}),e.jsx("li",{children:"‚Ä¢ Look for background noise or audio quality issues"})]})]})]})}),n.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-red-700 mb-2",children:"Select recording to troubleshoot:"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:n.map((m,x)=>e.jsx("button",{onClick:()=>l(m),className:`p-3 rounded-lg border text-left transition-colors ${o?.id===m.id?"bg-red-100 border-red-300 text-red-800":"bg-white border-red-200 hover:bg-red-50 text-red-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:["Recording #",n.length-x]}),e.jsxs("div",{className:"text-xs opacity-75 mt-1",children:[new Date(m.timestamp).toLocaleString()," ‚Ä¢",m.metadata.recordingTime,"s ‚Ä¢",(m.metadata.fileSize/1024).toFixed(1),"KB"]})]}),o?.id===m.id&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})]})},m.id))})]}),(o||n.length===1)&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-red-700 mb-1",children:"Audio Playback & Analysis"}),e.jsx("p",{className:"text-xs text-red-600",children:"Listen to the recording and check the audio quality metrics below:"})]}),e.jsx(ea,{audioBlob:(o||n[0]).audioBlob,fileName:`investigation-failed-${(o||n[0]).agentType}`,className:"border-red-200"}),(o||n[0]).transcriptionAttempt&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Transcription Result:"}),e.jsx("div",{className:"bg-white p-3 rounded-lg border border-red-200 text-sm text-gray-800",children:e.jsx("p",{className:"whitespace-pre-wrap",children:(o||n[0]).transcriptionAttempt})}),e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"The transcription above was successful, but could not be parsed into a structured investigation summary."})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Error Details:"}),e.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:e.jsx("p",{className:"text-sm text-red-800 font-mono",children:(o||n[0]).errorMessage})})]})]})]})})]}):null});aa.displayName="TroubleshootingSection";const tn=[{key:"patient",title:"Patient Demographics",icon:hn,color:"blue",priority:"high",group:"demographics"},{key:"social_history",title:"Social History",icon:hn,color:"cyan",priority:"low",group:"demographics"},{key:"clinical",title:"Clinical Assessment",icon:Dt,color:"green",priority:"high",group:"clinical"},{key:"background",title:"Background History",icon:He,color:"gray",priority:"medium",group:"clinical"},{key:"medications",title:"Medications",icon:He,color:"orange",priority:"medium",group:"clinical"},{key:"laboratory",title:"Laboratory Values",icon:He,color:"purple",priority:"medium",group:"investigations"},{key:"ecg",title:"ECG Assessment",icon:Dt,color:"red",priority:"medium",group:"investigations"},{key:"investigations",title:"Investigation Summary",icon:He,color:"indigo",priority:"medium",group:"investigations"},{key:"echocardiography",title:"Echocardiography",icon:Kt,color:"red",priority:"high",group:"investigations"},{key:"enhanced_ct",title:"Enhanced CT Analysis",icon:Dt,color:"emerald",priority:"high",group:"investigations"},{key:"procedure_planning",title:"Procedure Planning",icon:He,color:"violet",priority:"high",group:"planning"},{key:"alerts",title:"Alerts & Considerations",icon:dt,color:"red",priority:"high",group:"planning"}],Ii=[{key:"demographics",title:"Demographics",icon:hn,color:"blue",description:"Patient demographics and social information"},{key:"clinical",title:"Clinical Assessment",icon:Dt,color:"green",description:"Clinical history, medications, and assessments"},{key:"investigations",title:"Investigations",icon:Kt,color:"purple",description:"Imaging, laboratory, and diagnostic studies"},{key:"planning",title:"Planning",icon:He,color:"violet",description:"Procedure planning and clinical considerations"}],Mi=({structuredSections:n,results:t,missingInfo:s=[],onCopy:a,onInsertToEMR:i,onReprocessWithAnswers:r,className:o=""})=>{const[l,d]=c.useState(new Set(["patient","clinical","alerts"])),[m,x]=c.useState(new Set(["demographics","clinical","investigations","planning"])),[g,u]=c.useState(!1),[v,p]=c.useState({}),[w,b]=c.useState({copied:!1,inserted:!1}),P=c.useMemo(()=>{if(n)return n;if(t)try{let f=t.trim();f=f.replace(/```json\s*/,"").replace(/```\s*$/,"");const T=f.match(/\{[\s\S]*\}/);if(T){const k=JSON.parse(T[0]);return{patient:{content:k.patient?.content||"Not provided",missing:k.patient?.missing||[]},clinical:{content:k.clinical?.content||"Not provided",missing:k.clinical?.missing||[]},laboratory:{content:k.laboratory?.content||"Not provided",missing:k.laboratory?.missing||[]},ecg:{content:k.ecg?.content||"Not provided",missing:k.ecg?.missing||[]},background:{content:k.background?.content||"Not provided",missing:k.background?.missing||[]},medications:{content:k.medications?.content||"Not provided",missing:k.medications?.missing||[]},social_history:{content:k.social_history?.content||"Not provided",missing:k.social_history?.missing||[]},investigations:{content:k.investigations?.content||"Not provided",missing:k.investigations?.missing||[]},echocardiography:{content:k.echocardiography?.content||"Not provided",missing:k.echocardiography?.missing||[]},enhanced_ct:{content:k.enhanced_ct?.content||"Not provided",missing:k.enhanced_ct?.missing||[]},procedure_planning:{content:k.procedure_planning?.content||"Not provided",missing:k.procedure_planning?.missing||[]},alerts:{content:k.alerts?.content||"No alerts",missing:k.alerts?.missing||[],pre_anaesthetic_review_text:k.alerts?.pre_anaesthetic_review_text,pre_anaesthetic_review_json:k.alerts?.pre_anaesthetic_review_json},missing_summary:k.missing_summary||{missing_clinical:[],missing_diagnostic:[],missing_measurements:[],completeness_score:"0% (No data)"}}}}catch(f){console.warn("Failed to parse TAVI JSON from results:",f)}return{patient:{content:"No data available",missing:[]},clinical:{content:"No data available",missing:[]},laboratory:{content:"No data available",missing:[]},ecg:{content:"No data available",missing:[]},background:{content:"No data available",missing:[]},medications:{content:"No data available",missing:[]},social_history:{content:"No data available",missing:[]},investigations:{content:"No data available",missing:[]},echocardiography:{content:"No data available",missing:[]},enhanced_ct:{content:"No data available",missing:[]},procedure_planning:{content:"No data available",missing:[]},alerts:{content:"No alerts",missing:[]},missing_summary:{missing_clinical:[],missing_diagnostic:[],missing_measurements:[],completeness_score:"0% (No data available)"}}},[n,t]),R=c.useMemo(()=>{const f=tn.length,T=tn.filter(F=>{const U=P[F.key];return F.key==="missing_summary"?!0:U&&"content"in U&&U.content&&U.content!=="Not provided"&&U.content!=="No data available"&&!U.content.includes("not provided")&&!U.content.includes("not available")}).length,k=Math.round(T/f*100),M=P.missing_summary,_=[...M?.missing_clinical||[],...M?.missing_diagnostic||[],...M?.missing_measurements||[]].length;return{percentage:k,completedSections:T,totalSections:f,totalMissingItems:_,status:k>=80?"excellent":k>=60?"good":k>=40?"fair":"incomplete"}},[n]),j=c.useMemo(()=>{const f=tn.filter(k=>k.key!=="missing_summary").map(k=>{const M=P[k.key];if(!M||!("content"in M)||!M.content||M.content==="Not provided"||M.content==="No data available"||M.content.includes("not provided")||M.content.includes("not available"))return null;let _=`**${k.title}**
${M.content}`;return k.key==="alerts"&&"pre_anaesthetic_review_text"in M&&M.pre_anaesthetic_review_text&&(_+=`

${"pre_anaesthetic_review_text"in M?M.pre_anaesthetic_review_text:""}`),_+`
`}).filter(Boolean).join(`
`);return`TAVI WORKUP SUMMARY
Completion: ${R.percentage}% (${R.status})

`+f},[n,R]),h=c.useCallback(f=>{d(T=>{const k=new Set(T);return k.has(f)?k.delete(f):k.add(f),k})},[]),N=c.useCallback(f=>{x(T=>{const k=new Set(T);return k.has(f)?k.delete(f):k.add(f),k})},[]),C=c.useMemo(()=>Ii.map(f=>{const T=tn.filter(_=>_.group===f.key),k=T.filter(_=>{const F=P[_.key];return _.key==="missing_summary"?!0:F&&"content"in F&&F.content&&F.content!=="Not provided"&&F.content!=="No data available"&&!F.content.includes("not provided")&&!F.content.includes("not available")}).length,M=T.reduce((_,F)=>{const U=P[F.key];return U&&"missing"in U&&U.missing?_+U.missing.length:_},0);return{...f,sections:T,completed:k,total:T.length,completionPercentage:Math.round(k/T.length*100),missingItems:M}}),[P]),E=c.useCallback(async()=>{a&&(await a(j),b(f=>({...f,copied:!0})),setTimeout(()=>b(f=>({...f,copied:!1})),2e3))},[a,j]),A=c.useCallback(async()=>{i&&(await i(j),b(f=>({...f,inserted:!0})),setTimeout(()=>b(f=>({...f,inserted:!1})),2e3))},[i,j]),O=c.useCallback(()=>{r&&Object.keys(v).length>0&&(r(v),u(!1),p({}))},[r,v]),S=f=>{const T=P[f.key],k=l.has(f.key),M=f.key==="missing_summary",_=!M&&T&&"content"in T&&T.content!=="Not provided"&&T.content!=="No data available"&&!T.content.includes("not provided")&&!T.content.includes("not available")&&T.content.trim().length>0,F=!M&&T&&"missing"in T&&T.missing&&T.missing.length>0,U=f.icon;return e.jsxs(W.div,{className:"border border-gray-200 rounded-lg overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("button",{onClick:()=>h(f.key),className:`w-full p-4 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors ${_?"border-l-4 border-l-green-500":F?"border-l-4 border-l-yellow-500":"border-l-4 border-l-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{className:`w-5 h-5 text-${f.color}-600`}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:f.title}),e.jsx("p",{className:"text-sm text-gray-600",children:_?"Complete":F&&"missing"in T?`${T.missing.length} missing items`:"No data"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[_&&e.jsx(qe,{className:"w-4 h-4 text-green-600"}),F&&e.jsx(dt,{className:"w-4 h-4 text-yellow-600"}),k?e.jsx(un,{className:"w-4 h-4 text-gray-500"}):e.jsx(at,{className:"w-4 h-4 text-gray-500"})]})]}),e.jsx(Ee,{children:k&&e.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 border-t border-gray-200",children:[_?e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"text-gray-900 whitespace-pre-wrap",children:"content"in T?T.content:""})}):e.jsx("div",{className:"text-gray-500 italic",children:"No data available"}),f.key==="alerts"&&"pre_anaesthetic_review_text"in T&&T.pre_anaesthetic_review_text&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-800 mb-3",children:"Pre Anaesthetic Review"}),e.jsx("div",{className:"text-sm text-blue-900 whitespace-pre-wrap",children:"pre_anaesthetic_review_text"in T?T.pre_anaesthetic_review_text:""}),"pre_anaesthetic_review_json"in T&&T.pre_anaesthetic_review_json&&e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"text-xs text-blue-700 cursor-pointer hover:text-blue-900",children:"View structured anaesthetic data"}),e.jsx("pre",{className:"mt-2 text-xs text-blue-800 bg-blue-100 p-2 rounded overflow-x-auto",children:"pre_anaesthetic_review_json"in T?JSON.stringify(T.pre_anaesthetic_review_json,null,2):""})]})]}),F&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-800 mb-2",children:"Missing Information:"}),e.jsx("ul",{className:"text-sm text-yellow-700 space-y-2",children:"missing"in T?T.missing.map((X,q)=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-white border border-yellow-200 rounded",children:[e.jsxs("div",{className:"flex items-start space-x-2 flex-1",children:[e.jsx("span",{className:"text-yellow-500 mt-0.5",children:"‚Ä¢"}),e.jsx("span",{className:"flex-1",children:X})]}),e.jsx("button",{onClick:()=>{const ne=prompt(`Please provide: ${X}`,"");ne&&ne.trim()&&console.log(`Adding missing info for ${f.key}:`,{field:X,value:ne.trim()})},className:"ml-2 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Add"})]},q)):null}),e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-200",children:e.jsx("button",{onClick:()=>{console.log("Regenerating TAVI report with missing information...")},className:"w-full px-3 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Regenerate with Missing Information"})})]})]})})})]},f.key)};return e.jsxs("div",{className:`space-y-6 ${o}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"TAVI Workup Summary"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R.completedSections," of ",R.totalSections," sections complete",R.totalMissingItems>0&&` ‚Ä¢ ${R.totalMissingItems} items missing`]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-2xl font-bold ${R.status==="excellent"?"text-green-600":R.status==="good"?"text-blue-600":R.status==="fair"?"text-yellow-600":"text-red-600"}`,children:[R.percentage,"%"]}),e.jsx("div",{className:`text-xs uppercase tracking-wide ${R.status==="excellent"?"text-green-600":R.status==="good"?"text-blue-600":R.status==="fair"?"text-yellow-600":"text-red-600"}`,children:R.status})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${R.status==="excellent"?"bg-green-500":R.status==="good"?"bg-blue-500":R.status==="fair"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${R.percentage}%`}})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:E,className:`flex items-center space-x-2 px-4 py-2 rounded-lg border transition-all ${w.copied?"bg-green-50 border-green-200 text-green-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[w.copied?e.jsx(qe,{className:"w-4 h-4"}):e.jsx(ft,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:w.copied?"Copied!":"Copy Report"})]}),e.jsxs("button",{onClick:A,className:`flex items-center space-x-2 px-4 py-2 rounded-lg border transition-all ${w.inserted?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[w.inserted?e.jsx(qe,{className:"w-4 h-4"}):e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:w.inserted?"Inserted!":"Insert to EMR"})]}),R.totalMissingItems>0&&e.jsxs("button",{onClick:()=>u(!g),className:"flex items-center space-x-2 px-4 py-2 bg-yellow-50 border border-yellow-200 text-yellow-700 rounded-lg hover:bg-yellow-100 transition-colors",children:[e.jsx(Ba,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Complete Missing Info"})]})]}),e.jsx(Ee,{children:g&&e.jsx(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-3",children:"Complete Missing Information"}),e.jsx("div",{className:"space-y-3",children:[...P.missing_summary.missing_clinical,...P.missing_summary.missing_diagnostic,...P.missing_summary.missing_measurements].map((f,T)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:f}),e.jsx("input",{type:"text",value:v[f]||"",onChange:k=>p(M=>({...M,[f]:k.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:`Enter ${f.toLowerCase()}`})]},T))}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:Object.keys(v).length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Reprocess with Answers"})]})]})})}),e.jsx("div",{className:"space-y-6",children:C.map(f=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>N(f.key),className:"w-full p-4 flex items-center justify-between bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 border border-gray-200 rounded-lg transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${f.color}-100`,children:e.jsx(f.icon,{className:`w-5 h-5 text-${f.color}-600`})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:f.title}),e.jsx("p",{className:"text-sm text-gray-600",children:f.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-medium ${f.completionPercentage>=80?"text-green-600":f.completionPercentage>=50?"text-blue-600":"text-yellow-600"}`,children:[f.completed,"/",f.total," complete"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[f.completionPercentage,"%",f.missingItems>0&&` ‚Ä¢ ${f.missingItems} missing`]})]}),e.jsx("div",{className:`w-12 h-12 rounded-full border-4 ${f.completionPercentage>=80?"border-green-500":f.completionPercentage>=50?"border-blue-500":"border-yellow-500"} border-r-transparent animate-pulse flex items-center justify-center`,children:e.jsxs("span",{className:`text-xs font-bold ${f.completionPercentage>=80?"text-green-600":f.completionPercentage>=50?"text-blue-600":"text-yellow-600"}`,children:[f.completionPercentage,"%"]})}),m.has(f.key)?e.jsx(un,{className:"w-5 h-5 text-gray-500"}):e.jsx(at,{className:"w-5 h-5 text-gray-500"})]})]}),e.jsx(Ee,{children:m.has(f.key)&&e.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden space-y-3 pl-6",children:f.sections.map(S)})})]},f.key))}),P.missing_summary.completeness_score&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Assessment Summary"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Completeness Score:"})," ",P.missing_summary.completeness_score]})]})]})},Di=[{key:"indication",title:"Indication & Presentation",icon:He,color:"blue",priority:"high"},{key:"procedure",title:"Procedure Details",icon:Dt,color:"green",priority:"high"},{key:"pressures",title:"Haemodynamic Pressures",icon:Kt,color:"red",priority:"high"},{key:"cardiac_output",title:"Cardiac Output Assessment",icon:Gn,color:"purple",priority:"high"},{key:"exercise",title:"Exercise Testing",icon:Ht,color:"orange",priority:"medium"},{key:"complications",title:"Complications",icon:dt,color:"red",priority:"high"},{key:"conclusions",title:"Conclusions & Follow-up",icon:He,color:"indigo",priority:"high"}],Oi=({rhcReport:n,results:t,onCopy:s,onInsertToEMR:a,className:i="",originalTranscription:r,onTranscriptionCopy:o,onTranscriptionInsert:l,onTranscriptionEdit:d,transcriptionSaveStatus:m,onAgentReprocess:x,currentAgent:g,isProcessing:u=!1,audioBlob:v,defaultTranscriptionExpanded:p=!1,collapseTranscriptionWhen:w,approvalState:b,onTranscriptionApprove:P})=>{const[R,j]=c.useState(new Set(["indication","pressures","cardiac_output","complications"])),[h,N]=c.useState({copied:!1,inserted:!1}),C=c.useMemo(()=>{if(n)return n;if(t)try{const S=t.match(/<!-- RHC_STRUCTURED_DATA_JSON -->\n(\{[\s\S]*?\})\s*$/);if(S){const T=JSON.parse(S[1]);return{id:"rhc-display",agentName:"Right Heart Cath Agent",content:t,sections:[],metadata:{confidence:.95,processingTime:0,modelUsed:"RHC Parser"},timestamp:Date.now(),warnings:[],errors:[],rhcData:T.rhcData,haemodynamicPressures:T.haemodynamicPressures,cardiacOutput:T.cardiacOutput,exerciseHaemodynamics:T.exerciseHaemodynamics,complications:T.complications}}const f=t.match(/\{[\s\S]*\}/);if(f){const T=JSON.parse(f[0]);if(T.rhcData)return T}}catch(S){console.warn("Could not parse RHC report from results:",S)}return null},[n,t]),E=c.useCallback(S=>{j(f=>{const T=new Set(f);return T.has(S)?T.delete(S):T.add(S),T})},[]),A=c.useCallback(async()=>{if(!s)return;const S=ia(C,t);await s(S),N(f=>({...f,copied:!0})),setTimeout(()=>N(f=>({...f,copied:!1})),2e3)},[C,t,s]),O=c.useCallback(async()=>{if(!a)return;const S=Fi(C,t);await a(S),N(f=>({...f,inserted:!0})),setTimeout(()=>N(f=>({...f,inserted:!1})),2e3)},[C,t,a]);return e.jsxs("div",{className:`space-y-6 ${i}`,children:[r&&e.jsx(_t,{originalTranscription:r,onTranscriptionCopy:o,onTranscriptionInsert:l,onTranscriptionEdit:d,transcriptionSaveStatus:m,onAgentReprocess:x,currentAgent:g,isProcessing:u,audioBlob:v,defaultExpanded:p,collapseWhen:w,approvalState:b,onTranscriptionApprove:P}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-lg bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Kt,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Right Heart Catheterisation Report"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:A,disabled:!s,className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ft,{className:"w-3 h-3 mr-1"}),h.copied?"Copied":"Copy"]}),a&&e.jsxs("button",{onClick:O,className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700",children:[e.jsx(He,{className:"w-3 h-3 mr-1"}),h.inserted?"Inserted":"Insert to EMR"]})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:Di.map(({key:S,title:f,icon:T,color:k})=>{const M=R.has(S);return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>E(S),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:`w-4 h-4 text-${k}-600`}),e.jsx("span",{className:"font-medium text-gray-900",children:f})]}),M?e.jsx(un,{className:"w-4 h-4 text-gray-400"}):e.jsx(at,{className:"w-4 h-4 text-gray-400"})]}),e.jsx(Ee,{children:M&&e.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"px-4 pb-4",children:Li(S,C)})})]},S)})})]})]})},_i=n=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Right Atrial Pressures"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[n.ra.aWave&&e.jsxs("div",{children:["A-wave: ",e.jsxs("span",{className:"font-mono",children:[n.ra.aWave," mmHg"]})]}),n.ra.vWave&&e.jsxs("div",{children:["V-wave: ",e.jsxs("span",{className:"font-mono",children:[n.ra.vWave," mmHg"]})]}),n.ra.mean&&e.jsxs("div",{children:["Mean: ",e.jsxs("span",{className:"font-mono",children:[n.ra.mean," mmHg"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Right Ventricular Pressures"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[n.rv.systolic&&e.jsxs("div",{children:["Systolic: ",e.jsxs("span",{className:"font-mono",children:[n.rv.systolic," mmHg"]})]}),n.rv.diastolic&&e.jsxs("div",{children:["Diastolic: ",e.jsxs("span",{className:"font-mono",children:[n.rv.diastolic," mmHg"]})]}),n.rv.rvedp&&e.jsxs("div",{children:["RVEDP: ",e.jsxs("span",{className:"font-mono",children:[n.rv.rvedp," mmHg"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Pulmonary Artery Pressures"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[n.pa.systolic&&e.jsxs("div",{children:["Systolic: ",e.jsxs("span",{className:"font-mono",children:[n.pa.systolic," mmHg"]})]}),n.pa.diastolic&&e.jsxs("div",{children:["Diastolic: ",e.jsxs("span",{className:"font-mono",children:[n.pa.diastolic," mmHg"]})]}),n.pa.mean&&e.jsxs("div",{children:["Mean: ",e.jsxs("span",{className:"font-mono",children:[n.pa.mean," mmHg"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"PCWP"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[n.pcwp.aWave&&e.jsxs("div",{children:["A-wave: ",e.jsxs("span",{className:"font-mono",children:[n.pcwp.aWave," mmHg"]})]}),n.pcwp.vWave&&e.jsxs("div",{children:["V-wave: ",e.jsxs("span",{className:"font-mono",children:[n.pcwp.vWave," mmHg"]})]}),n.pcwp.mean&&e.jsxs("div",{children:["Mean: ",e.jsxs("span",{className:"font-mono",children:[n.pcwp.mean," mmHg"]})]})]})]})]}),$i=n=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Thermodilution"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[n.thermodilution.co&&e.jsxs("div",{children:["Cardiac Output: ",e.jsxs("span",{className:"font-mono",children:[n.thermodilution.co," L/min"]})]}),n.thermodilution.ci&&e.jsxs("div",{children:["Cardiac Index: ",e.jsxs("span",{className:"font-mono",children:[n.thermodilution.ci," L/min/m¬≤"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Fick Method"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[n.fick.co&&e.jsxs("div",{children:["Cardiac Output: ",e.jsxs("span",{className:"font-mono",children:[n.fick.co," L/min"]})]}),n.fick.ci&&e.jsxs("div",{children:["Cardiac Index: ",e.jsxs("span",{className:"font-mono",children:[n.fick.ci," L/min/m¬≤"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Other Measurements"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[n.mixedVenousO2&&e.jsxs("div",{children:["Mixed Venous O‚ÇÇ: ",e.jsx("span",{className:"font-mono",children:n.mixedVenousO2})]}),n.wedgeSaturation&&e.jsxs("div",{children:["Wedge Saturation: ",e.jsx("span",{className:"font-mono",children:n.wedgeSaturation})]})]})]})]});function Li(n,t){if(!t)return e.jsx("div",{className:"text-gray-500 italic",children:"No structured data available"});const{rhcData:s,haemodynamicPressures:a,cardiacOutput:i,exerciseHaemodynamics:r,complications:o}=t;switch(n){case"indication":return e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Indication:"})," ",s.indication.replace("_"," ")]}),s.clinicalPresentation&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Clinical Presentation:"})," ",s.clinicalPresentation]}),s.recentInvestigations&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Recent Investigations:"})," ",s.recentInvestigations]})]});case"procedure":return e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vascular Access:"})," ",s.vascularAccess.replace("_"," ")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Catheter Details:"})," ",s.catheterDetails]}),(s.laboratoryValues.haemoglobin||s.laboratoryValues.lactate)&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("span",{className:"font-medium",children:"Laboratory Values:"}),s.laboratoryValues.haemoglobin&&e.jsxs("div",{children:["Haemoglobin: ",s.laboratoryValues.haemoglobin," g/L"]}),s.laboratoryValues.lactate&&e.jsxs("div",{children:["Lactate: ",s.laboratoryValues.lactate," mmol/L"]})]})]});case"pressures":return _i(a);case"cardiac_output":return $i(i);case"exercise":return r?e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Protocol:"})," ",r.protocol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",r.duration]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Response:"})," ",r.response]})]}):e.jsx("div",{className:"text-gray-500 italic",children:"Exercise testing not performed"});case"complications":return o.length===0?e.jsx("div",{className:"text-green-600 text-sm",children:"No complications reported"}):e.jsx("div",{className:"space-y-3",children:o.map((l,d)=>e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-3",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium text-red-800",children:[l.type.replace("_"," ")," (",l.severity,")"]}),e.jsx("div",{className:"mt-1 text-red-700",children:l.description}),l.management&&e.jsxs("div",{className:"mt-2 text-red-600",children:[e.jsx("span",{className:"font-medium",children:"Management:"})," ",l.management]})]})},d))});case"conclusions":return e.jsxs("div",{className:"space-y-3 text-sm",children:[s.immediateOutcomes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Immediate Outcomes:"})," ",s.immediateOutcomes]}),s.recommendations&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Recommendations:"})," ",s.recommendations]}),s.followUp&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Follow-up:"})," ",s.followUp]})]});default:return e.jsx("div",{className:"text-gray-500",children:"Content not available"})}}function ia(n,t){return n?`Right Heart Catheterisation Report

Indication: ${n.rhcData.indication}
Access: ${n.rhcData.vascularAccess}
Immediate Outcomes: ${n.rhcData.immediateOutcomes||"Not specified"}
Recommendations: ${n.rhcData.recommendations||"None specified"}`:t||"No report data available"}function Fi(n,t){return ia(n,t)}const zi=({missingInfo:n,onSubmit:t,onDismiss:s})=>{console.log("üîç MissingInfoPanel: Received missingInfo:",n);const a=c.useMemo(()=>{const d=[];Array.isArray(n?.missing_diagnostic)&&(console.log("üìã MissingInfoPanel: Adding missing_diagnostic:",n.missing_diagnostic),d.push(...n.missing_diagnostic)),Array.isArray(n?.missing_intervention)&&(console.log("üìã MissingInfoPanel: Adding missing_intervention:",n.missing_intervention),d.push(...n.missing_intervention)),Array.isArray(n?.missing_purpose)&&(console.log("üìã MissingInfoPanel: Adding missing_purpose:",n.missing_purpose),d.push(...n.missing_purpose)),Array.isArray(n?.missing_clinical)&&(console.log("üìã MissingInfoPanel: Adding missing_clinical:",n.missing_clinical),d.push(...n.missing_clinical)),Array.isArray(n?.missing_recommendations)&&(console.log("üìã MissingInfoPanel: Adding missing_recommendations:",n.missing_recommendations),d.push(...n.missing_recommendations)),Array.isArray(n?.missing_structured)&&(console.log("üìã MissingInfoPanel: Adding missing_structured:",n.missing_structured),d.push(...n.missing_structured)),Array.isArray(n?.missing_measurements)&&(console.log("üìã MissingInfoPanel: Adding missing_measurements:",n.missing_measurements),d.push(...n.missing_measurements));const m=d.filter(p=>p&&p.trim().length>0),x=p=>p.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," ").replace(/\b(the|a|an|and|or|of|in|on|at|to|for|with)\b/g,"").trim(),g=(p,w)=>{const b=x(p),P=x(w);if(b===P||b.length>10&&P.length>10&&(b.includes(P)||P.includes(b)))return!0;if(["gradient","measurement","diameter","area","valve","pressure"].some(h=>b.includes(h)&&P.includes(h))){const h=b.split(" ").filter(A=>A.length>2),N=P.split(" ").filter(A=>A.length>2);if(h.filter(A=>N.includes(A)).length/Math.max(h.length,N.length)>.7)return!0}return!1},u=[],v=new Set;for(const p of m){const w=x(p);if(v.has(w)){console.log(`üìã MissingInfoPanel: Skipping exact duplicate: "${p}"`);continue}if(u.some(P=>g(p,P))){console.log(`üìã MissingInfoPanel: Skipping similar question: "${p}"`);continue}u.push(p),v.add(w)}return console.log(`üìä MissingInfoPanel: Total questions before dedup: ${d.length}, after enhanced dedup: ${u.length}`),console.log(`üìä MissingInfoPanel: Removed ${d.length-u.length} duplicate/similar questions`),u},[n]),[i,r]=c.useState({}),o=(d,m)=>{r(x=>({...x,[d]:m}))},l=n?.completeness_score||"";return a.length===0?null:e.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50",children:[e.jsxs("div",{className:"p-3 border-b border-amber-200 bg-amber-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-900 font-semibold text-sm",children:"Missing Information"}),l&&e.jsxs("p",{className:"text-amber-700 text-xs",children:["Completeness: ",l]})]}),s&&e.jsx("button",{className:"text-amber-700 text-xs underline",onClick:s,children:"Dismiss"})]}),e.jsx("div",{className:"p-3 space-y-3",children:a.map(d=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-amber-900 block",children:d}),e.jsx("input",{type:"text",className:"w-full text-sm p-2 border border-amber-200 rounded focus:outline-none focus:ring-2 focus:ring-amber-300 bg-white",placeholder:"Add detail...",value:i[d]||"",onChange:m=>o(d,m.target.value)})]},d))}),e.jsxs("div",{className:"p-3 border-t border-amber-200 bg-amber-50 flex items-center justify-end space-x-2",children:[s&&e.jsx("button",{className:"px-3 py-2 text-xs rounded border border-amber-200 bg-white hover:bg-amber-50",onClick:s,children:"Skip for now"}),e.jsx("button",{className:"px-3 py-2 text-xs rounded bg-amber-600 text-white hover:bg-amber-700",onClick:()=>t(i),children:"Reprocess with answers"})]})]})},Ui=({agentType:n,isProcessing:t,processingStatus:s,onPhaseUpdate:a})=>{const[i,r]=c.useState(s||null),[o,l]=c.useState("idle");c.useEffect(()=>{t?l("processing"):i?.overallProgress===100?(l("completing"),setTimeout(()=>l("idle"),2e3)):l("idle")},[t,i?.overallProgress]),c.useEffect(()=>{t&&!s?d():s&&r(s)},[t,s,n]);const d=c.useCallback(()=>{const b=m(n);r({agentType:n,isEnhanced:x(n),currentPhase:b[0].name,overallProgress:0,phases:b,estimatedTimeRemaining:u(n),warnings:[],insights:[]});let P=0,R=0;const j=setInterval(()=>{if(P>=b.length){clearInterval(j);return}const h=b[P];R+=Math.random()*15+5,R>=100?(h.status="completed",h.endTime=Date.now(),h.duration=h.endTime-(h.startTime||Date.now()),h.progress=100,P++,R=0,P<b.length&&(b[P].status="active",b[P].startTime=Date.now())):(h.progress=R,h.status="active",h.startTime||(h.startTime=Date.now()));const N=b.reduce((C,E,A)=>A<P?C+100/b.length:A===P?C+R/b.length:C,0);r(C=>C?{...C,currentPhase:b[P]?.name||"Completing",overallProgress:Math.min(100,N),phases:[...b],estimatedTimeRemaining:Math.max(0,C.estimatedTimeRemaining-500),qualityMetrics:v(N),insights:p(n,b[P])}:null),a&&b[P]&&a(b[P].name,N),N>=100&&(clearInterval(j),setTimeout(()=>{r(C=>C?{...C,overallProgress:100,currentPhase:"Completed"}:null)},500))},800);return()=>clearInterval(j)},[n,a]),m=b=>{const P=[{id:"initialization",name:"Initialization",description:"Preparing Phase 3 processing pipeline",status:"active",progress:0,subPhases:[{name:"Loading agent",status:"pending",progress:0},{name:"Context preparation",status:"pending",progress:0}]}];return x(b)&&(b==="tavi-workup"?P.push({id:"data_extraction",name:"Data Extraction",description:"Extracting structured TAVI data from dictation using TAVIWorkupExtractor",status:"pending",progress:0,subPhases:[{name:"Dictation parsing",status:"pending",progress:0},{name:"Missing fields detection",status:"pending",progress:0},{name:"Alert generation",status:"pending",progress:0}]},{id:"emr_integration",name:"EMR Integration",description:"Extracting EMR dialog fields and patient context",status:"pending",progress:0,subPhases:[{name:"EMR field extraction",status:"pending",progress:0},{name:"Patient data correlation",status:"pending",progress:0}]},{id:"llm_processing",name:"Main LLM Processing",description:"Processing with MedGemma-27b for structured narrative generation",status:"pending",progress:0,subPhases:[{name:"Payload preparation",status:"pending",progress:0},{name:"LLM inference",status:"pending",progress:0},{name:"Response generation",status:"pending",progress:0}]},{id:"response_parsing",name:"Multi-Strategy Response Parsing",description:"Parsing LLM response using JSON ‚Üí Text ‚Üí Deterministic strategies",status:"pending",progress:0,subPhases:[{name:"JSON parsing attempt",status:"pending",progress:0},{name:"Text pattern parsing",status:"pending",progress:0},{name:"Deterministic fallback",status:"pending",progress:0}]},{id:"missing_info_detection",name:"Missing Information Detection",description:"Analyzing missing clinical information with dedicated LLM call",status:"pending",progress:0,subPhases:[{name:"Clinical assessment gaps",status:"pending",progress:0},{name:"Diagnostic completeness",status:"pending",progress:0},{name:"Procedural planning gaps",status:"pending",progress:0}]},{id:"report_composition",name:"Report Composition",description:"Creating final TAVI workup report with enhanced metadata",status:"pending",progress:0,subPhases:[{name:"Section compilation",status:"pending",progress:0},{name:"Metadata enhancement",status:"pending",progress:0},{name:"Quality validation",status:"pending",progress:0}]}):P.push({id:"normalization",name:"Enhanced Normalization",description:"Applying Phase 2 + specialized medical text normalization",status:"pending",progress:0,subPhases:[{name:"Phase 2 normalization",status:"pending",progress:0},{name:"Specialized patterns",status:"pending",progress:0},{name:"Medical terminology",status:"pending",progress:0}]},{id:"extraction",name:"Clinical Finding Extraction",description:"Extracting clinical insights using MedicalSummaryExtractor",status:"pending",progress:0,subPhases:[{name:"Pattern recognition",status:"pending",progress:0},{name:"Quality assessment",status:"pending",progress:0},{name:"Confidence scoring",status:"pending",progress:0}]},{id:"cross_agent",name:"Cross-Agent Intelligence",description:"Analyzing shared insights and medical correlations",status:"pending",progress:0,subPhases:[{name:"Context enhancement",status:"pending",progress:0},{name:"Risk assessment",status:"pending",progress:0},{name:"Drug interactions",status:"pending",progress:0}]})),P.push({id:"ai_processing",name:"AI Model Processing",description:`Processing with ${g(b)} model`,status:"pending",progress:0,subPhases:[{name:"Model inference",status:"pending",progress:0},{name:"Response generation",status:"pending",progress:0}]},{id:"validation",name:"Quality Validation",description:"Validating output quality and medical accuracy",status:"pending",progress:0,subPhases:[{name:"Format validation",status:"pending",progress:0},{name:"Medical accuracy",status:"pending",progress:0},{name:"Confidence assessment",status:"pending",progress:0}]},{id:"finalization",name:"Report Generation",description:"Creating final medical report with enhanced metadata",status:"pending",progress:0,subPhases:[{name:"Section parsing",status:"pending",progress:0},{name:"Metadata generation",status:"pending",progress:0},{name:"Quality metrics",status:"pending",progress:0}]}),P},x=b=>["quick-letter","investigation-summary","background","medication","tavi-workup"].includes(b),g=b=>({"investigation-summary":"Google Gemma-3n-e4b (Fast)",background:"Google Gemma-3n-e4b (Fast)",medication:"Google Gemma-3n-e4b (Fast)","quick-letter":"MedGemma-27b MLX (Comprehensive)","tavi-workup":"MedGemma-27b MLX (Comprehensive)"})[b]||"MedGemma-27b MLX",u=b=>({"investigation-summary":3e3,background:4e3,medication:3500,"quick-letter":6e3,"tavi-workup":12e3})[b]||5e3,v=b=>{if(!(b<60))return{clinicalAccuracy:Math.min(1,.6+(b-60)/100*.4),terminologyPreservation:Math.min(1,.7+(b-60)/100*.3),structuralQuality:Math.min(1,.65+(b-60)/100*.35),confidence:Math.min(1,.5+b/100*.5)}},p=(b,P)=>P?{"Data Extraction":["Parsing TAVI procedural dictation","Identifying anatomical measurements and alerts","Extracting risk assessment scores"],"EMR Integration":["Correlating with patient electronic records","Validating demographic information","Enhancing clinical context"],"Main LLM Processing":["Generating comprehensive TAVI workup narrative","Applying interventional cardiology expertise","Structuring clinical findings systematically"],"Multi-Strategy Response Parsing":["Attempting JSON-structured parsing","Applying text pattern recognition","Ensuring robust data extraction"],"Missing Information Detection":["Analyzing clinical assessment completeness","Identifying procedural planning gaps","Assessing risk stratification adequacy"],"Report Composition":["Compiling final TAVI workup report","Adding procedural metadata","Validating clinical accuracy"],"Enhanced Normalization":["Applying medical terminology standardization","Preserving clinical context and meaning","Optimizing for Australian medical guidelines"],"Clinical Finding Extraction":["Identifying key clinical patterns","Assessing finding confidence levels","Categorizing medical insights"],"Cross-Agent Intelligence":["Analyzing patient context across sessions","Detecting potential drug interactions","Correlating findings with medical history"],"Quality Validation":["Ensuring medical accuracy standards","Validating clinical terminology","Assessing output completeness"]}[P.name]||[]:[];if(!t&&!i)return null;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[i?.isEnhanced?"Enhanced":"Legacy"," Processing"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[w(n)," Agent"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(i?.overallProgress||0),"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:i?.estimatedTimeRemaining?`${Math.ceil(i.estimatedTimeRemaining/1e3)}s remaining`:"Processing..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-between text-sm",children:e.jsx("span",{className:"font-medium text-gray-700",children:i?.currentPhase||"Processing..."})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${o==="processing"?"bg-gradient-to-r from-blue-500 to-blue-600 animate-pulse":o==="completing"?"bg-green-500":"bg-blue-500"}`,style:{width:`${i?.overallProgress||0}%`}})})]}),i?.phases&&i.phases.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Processing Phases"}),e.jsx("div",{className:"space-y-2",children:i.phases.map(b=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${b.status==="completed"?"bg-green-500":b.status==="active"?"bg-blue-500 animate-pulse":b.status==="error"?"bg-red-500":b.status==="warning"?"bg-yellow-500":"bg-gray-300"}`}),e.jsx("span",{className:`text-sm font-medium ${b.status==="active"?"text-blue-700":b.status==="completed"?"text-green-700":"text-gray-600"}`,children:b.name}),b.duration&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(b.duration/1e3).toFixed(1),"s)"]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(b.progress),"%"]})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-5",children:b.description}),b.subPhases&&b.status==="active"&&e.jsx("div",{className:"ml-5 space-y-1",children:b.subPhases.map((P,R)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${P.status==="completed"?"bg-green-400":P.status==="active"?"bg-blue-400 animate-pulse":"bg-gray-200"}`}),e.jsx("span",{className:"text-gray-600",children:P.name})]}),e.jsxs("span",{className:"text-gray-500",children:[Math.round(P.progress),"%"]})]},R))})]},b.id))})]}),i?.qualityMetrics&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Quality Metrics"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(i.qualityMetrics).map(([b,P])=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 capitalize",children:b.replace(/([A-Z])/g," $1").trim()}),e.jsxs("span",{className:"text-gray-800 font-medium",children:[Math.round(P*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full ${P>=.8?"bg-green-500":P>=.6?"bg-yellow-500":"bg-red-500"}`,style:{width:`${P*100}%`}})})]},b))})]}),i?.insights&&i.insights.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Processing Insights"}),e.jsx("ul",{className:"text-xs text-blue-700 space-y-1",children:i.insights.map((b,P)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-500 mr-1",children:"‚Ä¢"}),b]},P))})]}),i?.warnings&&i.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Warnings"}),e.jsx("ul",{className:"text-xs text-yellow-700 space-y-1",children:i.warnings.map((b,P)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-yellow-500 mr-1",children:"‚ö†"}),b]},P))})]})]});function w(b){return{"quick-letter":"Quick Letter","investigation-summary":"Investigation Summary",medication:"Medication",background:"Background",tavi:"TAVI","angiogram-pci":"Angiogram/PCI",mteer:"mTEER",tteer:"tTEER","pfo-closure":"PFO Closure","asd-closure":"ASD Closure","pvl-plug":"PVL Plug","bypass-graft":"Bypass Graft","right-heart-cath":"Right Heart Cath",consultation:"Consultation","ai-medical-review":"Australian Medical Review","batch-ai-review":"Batch AI Review","tavi-workup":"TAVI Workup",imaging:"Imaging",bloods:"Bloods","patient-education":"Patient Education","ohif-viewer":"OHIF Viewer",enhancement:"Enhancement",transcription:"Transcription",generation:"Generation","aus-medical-review":"Australian Medical Review"}[b]||b.replace("-"," ").replace(/\b\w/g,R=>R.toUpperCase())}},ra=c.memo(({results:n,resultsSummary:t="",agentType:s,onCopy:a,onInsertToEMR:i,warnings:r=[],onDismissWarnings:o,selectedSessionId:l=null,selectedPatientName:d="",originalTranscription:m,onTranscriptionCopy:x,onTranscriptionInsert:g,onTranscriptionEdit:u,transcriptionSaveStatus:v,currentAgent:p,onAgentReprocess:w,missingInfo:b,onReprocessWithAnswers:P,onDismissMissingInfo:R,isProcessing:j=!1,failedAudioRecordings:h=[],onClearFailedRecordings:N,errors:C=[],reviewData:E,audioBlob:A,transcriptionTime:O=null,agentProcessingTime:S=null,totalProcessingTime:f=null,processingStatus:T="idle",currentAgentName:k=null,patientVersion:M=null,isGeneratingPatientVersion:_=!1,onGeneratePatientVersion:F,streaming:U=!1,streamBuffer:X="",ttftMs:q=null,onStopStreaming:ne,approvalState:be,onTranscriptionApprove:ve,isStreaming:_e=!1,streamingTokens:ye="",onCancelStreaming:We,processingProgress:Y,taviStructuredSections:le})=>{const[Ae,V]=c.useState(!0);c.useEffect(()=>{(async()=>{T==="complete"&&f&&O&&S&&s&&await mn.getInstance().storeMetric({agentType:s,transcriptionTime:O,processingTime:S,totalDuration:f,modelUsed:k||"Unknown",success:!0})})().catch(pe=>{console.error("Failed to store metrics:",pe)})},[T,f,O,S,s,k]);const J=c.useMemo(()=>{if(!n||n.trim().length===0)return{wordCount:0,readingTime:0};const se=n.split(/\s+/).filter(he=>he.length>0).length,pe=Math.ceil(se/200);return{wordCount:se,readingTime:pe}},[n]),[Z,ae]=c.useState({copied:!1,inserted:!1}),[ke,we]=c.useState({copied:!1,inserted:!1}),[Ce,y]=c.useState({copied:!1,inserted:!1}),I=c.useCallback(async()=>{await a(t||"No summary available"),ae(pe=>({...pe,copied:!0})),setTimeout(()=>ae(pe=>({...pe,copied:!1})),2e3)},[a,t]),D=c.useCallback(async()=>{await i(t||"No summary available"),ae(pe=>({...pe,inserted:!0})),setTimeout(()=>ae(pe=>({...pe,inserted:!1})),2e3)},[i,t]),H=c.useCallback(async()=>{await a(n),we(se=>({...se,copied:!0})),setTimeout(()=>we(se=>({...se,copied:!1})),2e3)},[a,n]),$=c.useCallback(async()=>{await i(n),we(se=>({...se,inserted:!0})),setTimeout(()=>we(se=>({...se,inserted:!1})),2e3)},[i,n]),z=c.useCallback(()=>{const se=new Blob([t],{type:"text/plain"}),pe=URL.createObjectURL(se),he=document.createElement("a");he.href=pe,he.download=`medical-summary-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(he),he.click(),document.body.removeChild(he),URL.revokeObjectURL(pe)},[t]);c.useCallback(()=>{const se=new Blob([n],{type:"text/plain"}),pe=URL.createObjectURL(se),he=document.createElement("a");he.href=pe,he.download=`medical-letter-${s||"report"}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(he),he.click(),document.body.removeChild(he),URL.revokeObjectURL(pe)},[n,s]);const K=c.useCallback(async()=>{M&&(await a(M),y(se=>({...se,copied:!0})),setTimeout(()=>y(se=>({...se,copied:!1})),2e3))},[a,M]),je=c.useCallback(async()=>{M&&(await i(M),y(se=>({...se,inserted:!0})),setTimeout(()=>y(se=>({...se,inserted:!1})),2e3))},[i,M]),L=c.useCallback(()=>{if(M){const se=new Blob([M],{type:"text/plain"}),pe=URL.createObjectURL(se),he=document.createElement("a");he.href=pe,he.download=`patient-version-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(he),he.click(),document.body.removeChild(he),URL.revokeObjectURL(pe)}},[M]),B=s==="ai-medical-review"&&E,ie=s==="quick-letter"&&n,te=s==="tavi-workup"&&n,ee=s==="right-heart-cath"&&n;s==="tavi-workup"&&console.log("üîç TAVI Detection Debug:",{agentType:s,hasResults:!!n,resultsLength:n?.length,isTAVIWorkup:te,resultsPreview:n?.substring(0,100),hasStructuredSections:!!le,structuredSectionsKeys:le?Object.keys(le):null,patientContentExists:le?.patient?.content?"Yes":"No"});const Re=s==="quick-letter"&&!!n&&!!t||s==="tavi-workup"&&!!n||s==="right-heart-cath"&&!!n||s!=="quick-letter"&&s!=="tavi-workup"&&s!=="right-heart-cath"&&!!n,nt=()=>e.jsxs(W.div,{className:"p-4 border-b border-emerald-200/50",initial:"hidden",animate:"visible",variants:xe(mt),children:[l&&d&&e.jsx(W.div,{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2,duration:De.quick},children:e.jsxs(W.div,{className:"flex items-center space-x-2",variants:xe(Qt),children:[e.jsx(ss,{className:"w-3 h-3 text-blue-600"}),e.jsxs("span",{className:"text-blue-800 text-xs font-medium",children:["Viewing session for: ",d]})]})}),e.jsxs(W.div,{className:"flex items-center justify-between",variants:xe(qt),children:[e.jsx("div",{className:"flex items-center space-x-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:E.isBatchReview?"Batch AI Medical Review":"AI Medical Review"}),e.jsx("p",{className:"text-blue-700 text-xs",children:E.isBatchReview?"Multi-patient clinical oversight recommendations":"Australian clinical oversight recommendations"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Final Proof"}),e.jsx("p",{className:"text-emerald-700 text-xs",children:l?"Viewing previous session":"Processed output ready for review"})]})]})}),e.jsx("button",{onClick:()=>V(!Ae),className:"bg-white/60 border border-emerald-200 p-2 rounded-lg hover:bg-emerald-50/60 transition-colors",title:Ae?"Collapse":"Expand",children:Ae?e.jsx(qa,{className:"w-4 h-4 text-emerald-600"}):e.jsx(ss,{className:"w-4 h-4 text-emerald-600"})})]}),e.jsxs(W.div,{className:"flex items-center space-x-4 mt-2 text-xs",variants:xe(Qt),transition:{delay:.1},children:[B?e.jsxs("div",{className:"text-blue-600 flex items-center space-x-2",children:[e.jsxs("span",{children:[E.findings.length," clinical findings"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[E.findings.filter(se=>se.urgency==="Immediate").length," immediate"]}),E.isBatchReview&&E.batchSummary&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[E.batchSummary.totalPatients," patients"]})]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:new Date().toLocaleTimeString()}),r.length>0&&e.jsx("span",{children:"‚Ä¢"})]}):e.jsxs("div",{className:"text-emerald-600 flex items-center space-x-2",children:[e.jsxs("span",{children:[J.wordCount," words"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[J.readingTime," min read"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:new Date().toLocaleTimeString()}),r.length>0&&e.jsx("span",{children:"‚Ä¢"})]}),r.length>0&&e.jsx(sa,{warnings:r,onDismissWarnings:o})]})]});return e.jsxs(W.div,{className:"letter-card rounded-2xl overflow-hidden shadow-lg border",initial:"hidden",animate:"visible",variants:xe(mt),children:[nt(),e.jsx(Ee,{children:s==="tavi-workup"&&Y&&e.jsx(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:De.normal},className:"p-4 border-b border-gray-200",children:e.jsx(Ui,{agentType:s,isProcessing:!0,processingStatus:{agentType:s,isEnhanced:!0,currentPhase:Y.phase,overallProgress:Y.progress,phases:[],estimatedTimeRemaining:0,warnings:[],insights:Y.details?[Y.details]:[]}})})}),e.jsx(Ee,{children:m&&!U&&!te&&!ee&&e.jsx(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:De.normal},children:e.jsx(_t,{originalTranscription:m,onTranscriptionCopy:x,onTranscriptionInsert:g,onTranscriptionEdit:u,transcriptionSaveStatus:v,onAgentReprocess:w,currentAgent:p,isProcessing:j,audioBlob:A,defaultExpanded:!Re,collapseWhen:Re,approvalState:be,onTranscriptionApprove:ve})})}),e.jsx(Ee,{children:Ae&&e.jsxs(W.div,{className:"p-4",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:De.normal},children:[e.jsx(Ee,{children:U&&e.jsxs(W.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:De.quick},children:[m&&e.jsx(_t,{originalTranscription:m,onTranscriptionCopy:x,onTranscriptionInsert:g,onTranscriptionEdit:u,transcriptionSaveStatus:v,onAgentReprocess:w,currentAgent:p,isProcessing:!0,audioBlob:A,defaultExpanded:!0,collapseWhen:!1,approvalState:be,onTranscriptionApprove:ve}),e.jsxs("div",{className:"rounded-lg border border-emerald-300 bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-emerald-200 bg-emerald-100",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-emerald-600 text-sm",children:"‚óè Live Output"}),q!=null&&e.jsxs("span",{className:"text-xs text-emerald-700",children:["TTFT: ",q," ms"]})]}),e.jsx("button",{onClick:ne,className:"text-xs px-2 py-1 rounded border border-red-300 text-red-700 bg-red-50 hover:bg-red-100",children:"Stop"})]}),e.jsx("div",{className:"p-3 max-h-64 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-900",children:X})})]})]})}),e.jsx(Ee,{children:b&&(b.missing_diagnostic?.length>0||b.missing_intervention?.length>0||b.missing_purpose?.length>0||b.missing_clinical?.length>0||b.missing_recommendations?.length>0||b.missing_structured?.length>0)&&e.jsx(W.div,{className:"mb-4",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:De.quick},children:e.jsx(zi,{missingInfo:b,onSubmit:se=>P&&P(se),onDismiss:R})})}),_e&&ye?e.jsxs(W.div,{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",variants:xe(mt),initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"p-3 border-b border-blue-200 bg-blue-100 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Generating Response..."})]}),We&&e.jsx("button",{onClick:We,className:"text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors","aria-label":"Cancel streaming",children:"Cancel"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-gray-800 text-sm leading-relaxed whitespace-pre-wrap font-mono",children:[ye,e.jsx("span",{className:"inline-block w-2 h-4 bg-blue-500 animate-pulse ml-1"})]}),e.jsx("div",{className:"mt-3 text-xs text-blue-600",children:"Real-time generation in progress..."})]})]}):B?e.jsxs(e.Fragment,{children:[console.log("üñºÔ∏è RESULTS PANEL: Rendering AIReviewCards with data:",E),e.jsx(ta,{reviewData:E})]}):s==="quick-letter"&&n&&!U?(console.log("‚úÖ DISPLAY: Using QuickLetter dual-card display"),null,e.jsxs(W.div,{className:"space-y-4",variants:xe(xn),initial:"hidden",animate:"visible",transition:{staggerChildren:Xt.normal,delayChildren:.1},children:[e.jsxs(W.div,{className:"letter-card rounded-lg border border-emerald-200 bg-emerald-50",variants:xe(mt),children:[e.jsx("div",{className:"p-3 border-b border-emerald-200 bg-emerald-100",children:e.jsx("h4",{className:"text-emerald-800 font-semibold text-sm",children:"Summary"})}),e.jsx("div",{className:"p-3 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:t||e.jsx("div",{className:"text-gray-500 italic",children:"Summary not available - displaying full letter content below"})})}),e.jsx("div",{className:"p-3 border-t border-emerald-200 bg-emerald-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:I,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${Z.copied?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[Z.copied?e.jsx(qe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):e.jsx(ft,{className:"w-4 h-4",title:"Copy"}),e.jsx("span",{className:`text-xs ${Z.copied?"text-emerald-700":"text-gray-700"}`,children:Z.copied?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:D,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${Z.inserted?"bg-emerald-500/20 border-emerald-400 text-emerald-700 btn-success-animation completion-celebration":"bg-white/60 border-emerald-200 hover:bg-emerald-50/60 text-gray-700"}
                      `,children:[Z.inserted?e.jsx(qe,{className:"w-4 h-4 text-emerald-600 checkmark-appear"}):e.jsx(ct,{className:"w-4 h-4"}),e.jsx("span",{className:`text-xs ${Z.inserted?"text-emerald-700":"text-gray-700"}`,children:Z.inserted?"Inserted!":"Insert"})]}),e.jsxs("button",{onClick:z,className:"bg-white/60 border border-emerald-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-emerald-50/60 transition-colors btn-micro-press btn-micro-hover",children:[e.jsx(Vt,{className:"w-4 h-4 text-gray-700"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]}),e.jsxs(W.div,{className:"letter-card rounded-lg border border-blue-200 bg-blue-50",variants:xe(mt),children:[e.jsx("div",{className:"p-3 border-b border-blue-200 bg-blue-100",children:e.jsx("h4",{className:"text-blue-800 font-semibold text-sm",children:"Letter"})}),e.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:n})}),e.jsx("div",{className:"p-3 border-t border-blue-200 bg-blue-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:H,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${ke.copied?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[ke.copied?e.jsx(qe,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):e.jsx(ft,{className:"w-4 h-4",title:"Copy"}),e.jsx("span",{className:`text-xs ${ke.copied?"text-blue-700":"text-gray-700"}`,children:ke.copied?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:$,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${ke.inserted?"bg-blue-500/20 border-blue-400 text-blue-700 btn-success-animation completion-celebration":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:[ke.inserted?e.jsx(qe,{className:"w-4 h-4 text-blue-600 checkmark-appear"}):e.jsx(ct,{className:"w-4 h-4"}),e.jsx("span",{className:`text-xs ${ke.inserted?"text-blue-700":"text-gray-700"}`,children:ke.inserted?"Inserted!":"Insert"})]}),e.jsx("button",{onClick:F,disabled:_,className:`
                        p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                        ${_?"bg-blue-100/60 border-blue-300 text-blue-500 cursor-not-allowed":"bg-white/60 border-blue-200 hover:bg-blue-50/60 text-gray-700"}
                      `,children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-300 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-blue-500",children:"Generating"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-4 h-4 text-gray-700"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Patient Version"})]})})]})})]}),e.jsx(Ee,{children:M&&e.jsxs(W.div,{className:"letter-card rounded-lg border border-purple-200 bg-purple-50",variants:xe(mt),initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.2},children:[e.jsx("div",{className:"p-3 border-b border-purple-200 bg-purple-100",children:e.jsx("h4",{className:"text-purple-800 font-semibold text-sm",children:"Patient-Friendly Version"})}),e.jsx("div",{className:"p-3 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"text-gray-900 text-sm leading-relaxed whitespace-pre-wrap",children:M})}),e.jsx("div",{className:"p-3 border-t border-purple-200 bg-purple-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:K,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${Ce.copied?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[Ce.copied?e.jsx(qe,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):e.jsx(ft,{className:"w-4 h-4",title:"Copy"}),e.jsx("span",{className:`text-xs ${Ce.copied?"text-purple-700":"text-gray-700"}`,children:Ce.copied?"Copied!":"Copy"})]}),e.jsxs("button",{onClick:je,className:`
                          p-3 rounded-lg flex flex-col items-center space-y-1 transition-all border btn-micro-press btn-micro-hover
                          ${Ce.inserted?"bg-purple-500/20 border-purple-400 text-purple-700 btn-success-animation completion-celebration":"bg-white/60 border-purple-200 hover:bg-purple-50/60 text-gray-700"}
                        `,children:[Ce.inserted?e.jsx(qe,{className:"w-4 h-4 text-purple-600 checkmark-appear"}):e.jsx(ct,{className:"w-4 h-4"}),e.jsx("span",{className:`text-xs ${Ce.inserted?"text-purple-700":"text-gray-700"}`,children:Ce.inserted?"Inserted!":"Insert"})]}),e.jsxs("button",{onClick:L,className:"bg-white/60 border border-purple-200 p-3 rounded-lg flex flex-col items-center space-y-1 hover:bg-purple-50/60 transition-colors btn-micro-press btn-micro-hover",children:[e.jsx(Vt,{className:"w-4 h-4 text-gray-700"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Download"})]})]})})]})})]})):te?e.jsxs("div",{className:"space-y-6",children:[e.jsx(_t,{originalTranscription:m||"",onTranscriptionCopy:x,onTranscriptionInsert:g,onTranscriptionEdit:u,transcriptionSaveStatus:v,onAgentReprocess:w,currentAgent:p,isProcessing:j,audioBlob:A,defaultExpanded:!Re,collapseWhen:Re,approvalState:be,onTranscriptionApprove:ve}),e.jsx(Mi,{structuredSections:le,results:n,missingInfo:b?.missing_structured||[],onCopy:a,onInsertToEMR:i,onReprocessWithAnswers:P})]}):ee?e.jsx(Oi,{results:n,onCopy:a,onInsertToEMR:i,originalTranscription:m,onTranscriptionCopy:x,onTranscriptionInsert:g,onTranscriptionEdit:u,transcriptionSaveStatus:v,onAgentReprocess:w,currentAgent:p,isProcessing:j,audioBlob:A,defaultTranscriptionExpanded:!Re,collapseTranscriptionWhen:Re,approvalState:be,onTranscriptionApprove:ve}):e.jsx(Zs,{results:n,agentType:s})]})}),e.jsx(Ee,{children:!B&&!ie&&!te&&!ee&&e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.3},children:e.jsx(na,{results:n,agentType:s,onCopy:a,onInsertToEMR:i})})}),e.jsx(Ee,{children:(f||T!=="idle")&&e.jsx(W.div,{className:"px-4 pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.4},children:e.jsx(Ai,{appState:{processingStatus:T,totalProcessingTime:f,transcriptionTime:O,agentProcessingTime:S,currentAgent:s,currentAgentName:k,processingStartTime:null},isRecording:!1,recordingTime:0,transcriptionLength:m?m.length:0})})}),e.jsx(aa,{failedAudioRecordings:h,errors:C,onClearFailedRecordings:N})]})});ra.displayName="OptimizedResultsPanel";function Ie(n,t){t===void 0&&(t={});var s=t.insertAt;if(n&&typeof document<"u"){var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",s==="top"&&a.firstChild?a.insertBefore(i,a.firstChild):a.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}Ie(`.react-loading-indicator-normalize,
[class$=rli-bounding-box] {
  font-size: 1rem;
  display: inline-block;
  box-sizing: border-box;
  text-align: unset;
  isolation: isolate;
}

.rli-d-i-b {
  display: inline-block;
}

.rli-text-format {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 600;
  width: 90%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.7em;
  letter-spacing: 0.5px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Avenir Next", "Avenir", "Segoe UI", "Lucida Grande", "Helvetica Neue", "Helvetica", "Fira Sans", "Roboto", "Noto", "Droid Sans", "Cantarell", "Oxygen", "Ubuntu", "Franklin Gothic Medium", "Century Gothic", "Liberation Sans", sans-serif;
}`);var Ke=function(){return Ke=Object.assign||function(n){for(var t,s=1,a=arguments.length;s<a;s++)for(var i in t=arguments[s])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},Ke.apply(this,arguments)};function fn(n){return fn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fn(n)}var Bi=/^\s+/,qi=/\s+$/;function Q(n,t){if(t=t||{},(n=n||"")instanceof Q)return n;if(!(this instanceof Q))return new Q(n,t);var s=function(a){var i={r:0,g:0,b:0},r=1,o=null,l=null,d=null,m=!1,x=!1;typeof a=="string"&&(a=function(p){p=p.replace(Bi,"").replace(qi,"").toLowerCase();var w,b=!1;if(Ln[p])p=Ln[p],b=!0;else if(p=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(w=Ge.rgb.exec(p))?{r:w[1],g:w[2],b:w[3]}:(w=Ge.rgba.exec(p))?{r:w[1],g:w[2],b:w[3],a:w[4]}:(w=Ge.hsl.exec(p))?{h:w[1],s:w[2],l:w[3]}:(w=Ge.hsla.exec(p))?{h:w[1],s:w[2],l:w[3],a:w[4]}:(w=Ge.hsv.exec(p))?{h:w[1],s:w[2],v:w[3]}:(w=Ge.hsva.exec(p))?{h:w[1],s:w[2],v:w[3],a:w[4]}:(w=Ge.hex8.exec(p))?{r:Ve(w[1]),g:Ve(w[2]),b:Ve(w[3]),a:ps(w[4]),format:b?"name":"hex8"}:(w=Ge.hex6.exec(p))?{r:Ve(w[1]),g:Ve(w[2]),b:Ve(w[3]),format:b?"name":"hex"}:(w=Ge.hex4.exec(p))?{r:Ve(w[1]+""+w[1]),g:Ve(w[2]+""+w[2]),b:Ve(w[3]+""+w[3]),a:ps(w[4]+""+w[4]),format:b?"name":"hex8"}:(w=Ge.hex3.exec(p))?{r:Ve(w[1]+""+w[1]),g:Ve(w[2]+""+w[2]),b:Ve(w[3]+""+w[3]),format:b?"name":"hex"}:!1}(a)),fn(a)=="object"&&(st(a.r)&&st(a.g)&&st(a.b)?(g=a.r,u=a.g,v=a.b,i={r:255*Ne(g,255),g:255*Ne(u,255),b:255*Ne(v,255)},m=!0,x=String(a.r).substr(-1)==="%"?"prgb":"rgb"):st(a.h)&&st(a.s)&&st(a.v)?(o=Ut(a.s),l=Ut(a.v),i=function(p,w,b){p=6*Ne(p,360),w=Ne(w,100),b=Ne(b,100);var P=Math.floor(p),R=p-P,j=b*(1-w),h=b*(1-R*w),N=b*(1-(1-R)*w),C=P%6,E=[b,h,j,j,N,b][C],A=[N,b,b,h,j,j][C],O=[j,j,N,b,b,h][C];return{r:255*E,g:255*A,b:255*O}}(a.h,o,l),m=!0,x="hsv"):st(a.h)&&st(a.s)&&st(a.l)&&(o=Ut(a.s),d=Ut(a.l),i=function(p,w,b){var P,R,j;function h(E,A,O){return O<0&&(O+=1),O>1&&(O-=1),O<1/6?E+6*(A-E)*O:O<.5?A:O<2/3?E+(A-E)*(2/3-O)*6:E}if(p=Ne(p,360),w=Ne(w,100),b=Ne(b,100),w===0)P=R=j=b;else{var N=b<.5?b*(1+w):b+w-b*w,C=2*b-N;P=h(C,N,p+1/3),R=h(C,N,p),j=h(C,N,p-1/3)}return{r:255*P,g:255*R,b:255*j}}(a.h,o,d),m=!0,x="hsl"),a.hasOwnProperty("a")&&(r=a.a));var g,u,v;return r=oa(r),{ok:m,format:a.format||x,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:r}}(n);this._originalInput=n,this._r=s.r,this._g=s.g,this._b=s.b,this._a=s.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||s.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=s.ok}function ls(n,t,s){n=Ne(n,255),t=Ne(t,255),s=Ne(s,255);var a,i,r=Math.max(n,t,s),o=Math.min(n,t,s),l=(r+o)/2;if(r==o)a=i=0;else{var d=r-o;switch(i=l>.5?d/(2-r-o):d/(r+o),r){case n:a=(t-s)/d+(t<s?6:0);break;case t:a=(s-n)/d+2;break;case s:a=(n-t)/d+4}a/=6}return{h:a,s:i,l}}function cs(n,t,s){n=Ne(n,255),t=Ne(t,255),s=Ne(s,255);var a,i,r=Math.max(n,t,s),o=Math.min(n,t,s),l=r,d=r-o;if(i=r===0?0:d/r,r==o)a=0;else{switch(r){case n:a=(t-s)/d+(t<s?6:0);break;case t:a=(s-n)/d+2;break;case s:a=(n-t)/d+4}a/=6}return{h:a,s:i,v:l}}function ds(n,t,s,a){var i=[Xe(Math.round(n).toString(16)),Xe(Math.round(t).toString(16)),Xe(Math.round(s).toString(16))];return a&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function ms(n,t,s,a){return[Xe(la(a)),Xe(Math.round(n).toString(16)),Xe(Math.round(t).toString(16)),Xe(Math.round(s).toString(16))].join("")}function Hi(n,t){t=t===0?0:t||10;var s=Q(n).toHsl();return s.s-=t/100,s.s=jn(s.s),Q(s)}function Vi(n,t){t=t===0?0:t||10;var s=Q(n).toHsl();return s.s+=t/100,s.s=jn(s.s),Q(s)}function Wi(n){return Q(n).desaturate(100)}function Gi(n,t){t=t===0?0:t||10;var s=Q(n).toHsl();return s.l+=t/100,s.l=jn(s.l),Q(s)}function Xi(n,t){t=t===0?0:t||10;var s=Q(n).toRgb();return s.r=Math.max(0,Math.min(255,s.r-Math.round(-t/100*255))),s.g=Math.max(0,Math.min(255,s.g-Math.round(-t/100*255))),s.b=Math.max(0,Math.min(255,s.b-Math.round(-t/100*255))),Q(s)}function Qi(n,t){t=t===0?0:t||10;var s=Q(n).toHsl();return s.l-=t/100,s.l=jn(s.l),Q(s)}function Ji(n,t){var s=Q(n).toHsl(),a=(s.h+t)%360;return s.h=a<0?360+a:a,Q(s)}function Yi(n){var t=Q(n).toHsl();return t.h=(t.h+180)%360,Q(t)}function us(n,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var s=Q(n).toHsl(),a=[Q(n)],i=360/t,r=1;r<t;r++)a.push(Q({h:(s.h+r*i)%360,s:s.s,l:s.l}));return a}function Ki(n){var t=Q(n).toHsl(),s=t.h;return[Q(n),Q({h:(s+72)%360,s:t.s,l:t.l}),Q({h:(s+216)%360,s:t.s,l:t.l})]}function Zi(n,t,s){t=t||6,s=s||30;var a=Q(n).toHsl(),i=360/s,r=[Q(n)];for(a.h=(a.h-(i*t>>1)+720)%360;--t;)a.h=(a.h+i)%360,r.push(Q(a));return r}function er(n,t){t=t||6;for(var s=Q(n).toHsv(),a=s.h,i=s.s,r=s.v,o=[],l=1/t;t--;)o.push(Q({h:a,s:i,v:r})),r=(r+l)%1;return o}Q.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var n=this.toRgb();return(299*n.r+587*n.g+114*n.b)/1e3},getLuminance:function(){var n,t,s,a=this.toRgb();return n=a.r/255,t=a.g/255,s=a.b/255,.2126*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))},setAlpha:function(n){return this._a=oa(n),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var n=cs(this._r,this._g,this._b);return{h:360*n.h,s:n.s,v:n.v,a:this._a}},toHsvString:function(){var n=cs(this._r,this._g,this._b),t=Math.round(360*n.h),s=Math.round(100*n.s),a=Math.round(100*n.v);return this._a==1?"hsv("+t+", "+s+"%, "+a+"%)":"hsva("+t+", "+s+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var n=ls(this._r,this._g,this._b);return{h:360*n.h,s:n.s,l:n.l,a:this._a}},toHslString:function(){var n=ls(this._r,this._g,this._b),t=Math.round(360*n.h),s=Math.round(100*n.s),a=Math.round(100*n.l);return this._a==1?"hsl("+t+", "+s+"%, "+a+"%)":"hsla("+t+", "+s+"%, "+a+"%, "+this._roundA+")"},toHex:function(n){return ds(this._r,this._g,this._b,n)},toHexString:function(n){return"#"+this.toHex(n)},toHex8:function(n){return function(t,s,a,i,r){var o=[Xe(Math.round(t).toString(16)),Xe(Math.round(s).toString(16)),Xe(Math.round(a).toString(16)),Xe(la(i))];return r&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this._r,this._g,this._b,this._a,n)},toHex8String:function(n){return"#"+this.toHex8(n)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*Ne(this._r,255))+"%",g:Math.round(100*Ne(this._g,255))+"%",b:Math.round(100*Ne(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*Ne(this._r,255))+"%, "+Math.round(100*Ne(this._g,255))+"%, "+Math.round(100*Ne(this._b,255))+"%)":"rgba("+Math.round(100*Ne(this._r,255))+"%, "+Math.round(100*Ne(this._g,255))+"%, "+Math.round(100*Ne(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(tr[ds(this._r,this._g,this._b,!0)]||!1)},toFilter:function(n){var t="#"+ms(this._r,this._g,this._b,this._a),s=t,a=this._gradientType?"GradientType = 1, ":"";if(n){var i=Q(n);s="#"+ms(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+t+",endColorstr="+s+")"},toString:function(n){var t=!!n;n=n||this._format;var s=!1,a=this._a<1&&this._a>=0;return t||!a||n!=="hex"&&n!=="hex6"&&n!=="hex3"&&n!=="hex4"&&n!=="hex8"&&n!=="name"?(n==="rgb"&&(s=this.toRgbString()),n==="prgb"&&(s=this.toPercentageRgbString()),n!=="hex"&&n!=="hex6"||(s=this.toHexString()),n==="hex3"&&(s=this.toHexString(!0)),n==="hex4"&&(s=this.toHex8String(!0)),n==="hex8"&&(s=this.toHex8String()),n==="name"&&(s=this.toName()),n==="hsl"&&(s=this.toHslString()),n==="hsv"&&(s=this.toHsvString()),s||this.toHexString()):n==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return Q(this.toString())},_applyModification:function(n,t){var s=n.apply(null,[this].concat([].slice.call(t)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function(){return this._applyModification(Gi,arguments)},brighten:function(){return this._applyModification(Xi,arguments)},darken:function(){return this._applyModification(Qi,arguments)},desaturate:function(){return this._applyModification(Hi,arguments)},saturate:function(){return this._applyModification(Vi,arguments)},greyscale:function(){return this._applyModification(Wi,arguments)},spin:function(){return this._applyModification(Ji,arguments)},_applyCombination:function(n,t){return n.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(Zi,arguments)},complement:function(){return this._applyCombination(Yi,arguments)},monochromatic:function(){return this._applyCombination(er,arguments)},splitcomplement:function(){return this._applyCombination(Ki,arguments)},triad:function(){return this._applyCombination(us,[3])},tetrad:function(){return this._applyCombination(us,[4])}},Q.fromRatio=function(n,t){if(fn(n)=="object"){var s={};for(var a in n)n.hasOwnProperty(a)&&(s[a]=a==="a"?n[a]:Ut(n[a]));n=s}return Q(n,t)},Q.equals=function(n,t){return!(!n||!t)&&Q(n).toRgbString()==Q(t).toRgbString()},Q.random=function(){return Q.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},Q.mix=function(n,t,s){s=s===0?0:s||50;var a=Q(n).toRgb(),i=Q(t).toRgb(),r=s/100;return Q({r:(i.r-a.r)*r+a.r,g:(i.g-a.g)*r+a.g,b:(i.b-a.b)*r+a.b,a:(i.a-a.a)*r+a.a})},Q.readability=function(n,t){var s=Q(n),a=Q(t);return(Math.max(s.getLuminance(),a.getLuminance())+.05)/(Math.min(s.getLuminance(),a.getLuminance())+.05)},Q.isReadable=function(n,t,s){var a,i,r=Q.readability(n,t);switch(i=!1,(a=function(o){var l,d;return l=((o=o||{level:"AA",size:"small"}).level||"AA").toUpperCase(),d=(o.size||"small").toLowerCase(),l!=="AA"&&l!=="AAA"&&(l="AA"),d!=="small"&&d!=="large"&&(d="small"),{level:l,size:d}}(s)).level+a.size){case"AAsmall":case"AAAlarge":i=r>=4.5;break;case"AAlarge":i=r>=3;break;case"AAAsmall":i=r>=7}return i},Q.mostReadable=function(n,t,s){var a,i,r,o,l=null,d=0;i=(s=s||{}).includeFallbackColors,r=s.level,o=s.size;for(var m=0;m<t.length;m++)(a=Q.readability(n,t[m]))>d&&(d=a,l=Q(t[m]));return Q.isReadable(n,l,{level:r,size:o})||!i?l:(s.includeFallbackColors=!1,Q.mostReadable(n,["#fff","#000"],s))};var Ln=Q.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},tr=Q.hexNames=function(n){var t={};for(var s in n)n.hasOwnProperty(s)&&(t[n[s]]=s);return t}(Ln);function oa(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function Ne(n,t){(function(a){return typeof a=="string"&&a.indexOf(".")!=-1&&parseFloat(a)===1})(n)&&(n="100%");var s=function(a){return typeof a=="string"&&a.indexOf("%")!=-1}(n);return n=Math.min(t,Math.max(0,parseFloat(n))),s&&(n=parseInt(n*t,10)/100),Math.abs(n-t)<1e-6?1:n%t/parseFloat(t)}function jn(n){return Math.min(1,Math.max(0,n))}function Ve(n){return parseInt(n,16)}function Xe(n){return n.length==1?"0"+n:""+n}function Ut(n){return n<=1&&(n=100*n+"%"),n}function la(n){return Math.round(255*parseFloat(n)).toString(16)}function ps(n){return Ve(n)/255}var rt,nn,sn,Ge=(nn="[\\s|\\(]+("+(rt="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+rt+")[,|\\s]+("+rt+")\\s*\\)?",sn="[\\s|\\(]+("+rt+")[,|\\s]+("+rt+")[,|\\s]+("+rt+")[,|\\s]+("+rt+")\\s*\\)?",{CSS_UNIT:new RegExp(rt),rgb:new RegExp("rgb"+nn),rgba:new RegExp("rgba"+sn),hsl:new RegExp("hsl"+nn),hsla:new RegExp("hsla"+sn),hsv:new RegExp("hsv"+nn),hsva:new RegExp("hsva"+sn),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function st(n){return!!Ge.CSS_UNIT.exec(n)}var nr=function(n,t){var s=(typeof n=="string"?parseInt(n):n)||0;if(s>=-5&&s<=5){var a=s,i=parseFloat(t),r=i+a*(i/5)*-1;return(r==0||r<=Number.EPSILON)&&(r=.1),{animationPeriod:r+"s"}}return{animationPeriod:t}},sr=function(n,t){var s=n||{},a="";switch(t){case"small":a="12px";break;case"medium":a="16px";break;case"large":a="20px";break;default:a=void 0}var i={};if(s.fontSize){var r=s.fontSize;i=function(o,l){var d={};for(var m in o)Object.prototype.hasOwnProperty.call(o,m)&&l.indexOf(m)<0&&(d[m]=o[m]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var x=0;for(m=Object.getOwnPropertySymbols(o);x<m.length;x++)l.indexOf(m[x])<0&&Object.prototype.propertyIsEnumerable.call(o,m[x])&&(d[m[x]]=o[m[x]])}return d}(s,["fontSize"]),a=r}return{fontSize:a,styles:i}},ar={color:"currentColor",mixBlendMode:"difference",width:"unset",display:"block",paddingTop:"2px"},ir=function(n){var t=n.className,s=n.text,a=n.textColor,i=n.staticText,r=n.style;return s?ue.createElement("span",{className:"rli-d-i-b rli-text-format ".concat(t||"").trim(),style:Ke(Ke(Ke({},i&&ar),a&&{color:a,mixBlendMode:"unset"}),r&&r)},typeof s=="string"&&s.length?s:"loading"):null},ca="rgb(50, 205, 50)";function rr(n,t){if(t===void 0&&(t=0),n.length===0)throw new Error("Input array cannot be empty!");var s=[];return function a(i,r){return r===void 0&&(r=0),s.push.apply(s,i),s.length<r&&a(s,r),s.slice(0,r)}(n,t)}Ie(`.atom-rli-bounding-box {
  --atom-phase1-rgb: 50, 205, 50;
  color: rgba(var(--atom-phase1-rgb), 1);
  font-size: 16px;
  position: relative;
  text-align: unset;
  isolation: isolate;
}
.atom-rli-bounding-box .atom-indicator {
  width: 6em;
  height: 6em;
  position: relative;
  perspective: 6em;
  overflow: hidden;
  color: rgba(var(--atom-phase1-rgb), 1);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator::after, .atom-rli-bounding-box .atom-indicator::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 0.48em;
  height: 0.48em;
  margin: auto;
  border-radius: 50%;
  background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7eg;
}
.atom-rli-bounding-box .atom-indicator::before {
  filter: drop-shadow(0px 0px 0.0625em currentColor);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit {
  color: rgba(var(--atom-phase1-rgb), 0.85);
  border: 0;
  border-left: 0.4em solid currentColor;
  box-sizing: border-box;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  width: 4.8em;
  height: 4.8em;
  background-color: transparent;
  border-radius: 50%;
  transform-style: preserve-3d;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7fj, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gy;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  color: rgba(var(--atom-phase1-rgb), 0.18);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7hv;
  border: 0.125em solid currentColor;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::before {
  content: "";
  width: 0.192em;
  height: 0.192em;
  position: absolute;
  border-radius: 50%;
  top: -0.096em;
  right: 0;
  bottom: 0;
  left: 0;
  margin: 0 auto;
  color: rgba(var(--atom-phase1-rgb), 1);
  box-shadow: 0px 0px 0.0625em 0.0625em currentColor, 0px 0px 0.0625em 0.125em currentColor;
  background-color: currentColor;
  transform: rotateY(-70deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7ew, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7gg;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(1) {
  --orbit-vector-factor: -1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(2) {
  --orbit-vector-factor: 1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3) {
  --orbit-vector-factor: 0;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3)::before {
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --atom-phase1-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase2-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase3-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase4-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7fj {
  from {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(0deg);
  }
  to {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(360deg);
  }
}
@keyframes uxlv7ew {
  from {
    transform: rotateY(-70deg) rotateX(0deg);
  }
  to {
    transform: rotateY(-70deg) rotateX(-360deg);
  }
}
@keyframes uxlv7eg {
  100%, 0% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  20% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  25% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  45% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  50% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  70% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  75% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  95% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
}
@keyframes uxlv7gg {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
}
@keyframes uxlv7gy {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
}
@keyframes uxlv7hv {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
}`);Q(ca).toRgb();Array.from({length:4},function(n,t){return"--atom-phase".concat(t+1,"-rgb")});Ie(`.commet-rli-bounding-box {
  --commet-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  width: 6.85em;
  height: 6.85em;
  overflow: hidden;
  display: inline-block;
  box-sizing: border-box;
  position: relative;
  isolation: isolate;
}
.commet-rli-bounding-box .commet-indicator {
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  box-sizing: border-box;
  width: 6em;
  height: 6em;
  color: var(--commet-phase1-color);
  display: inline-block;
  isolation: isolate;
  position: absolute;
  z-index: 0;
  animation: calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite uxlv7cp;
}
.commet-rli-bounding-box .commet-indicator .commet-box {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  animation: uxlv7bx var(--rli-animation-duration, 1.2s) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(1) {
  width: 100%;
  height: 100%;
  animation-direction: normal;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(2) {
  width: 70%;
  height: 70%;
  animation-direction: reverse;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  display: inline-block;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box::before {
  content: "";
  width: 0.5em;
  height: 0.5em;
  border-radius: 50%;
  background-color: currentColor;
  position: absolute;
  top: -0.125em;
  left: 50%;
  transform: translateX(-50%);
  box-shadow: 0 0 0.2em 0em currentColor, 0 0 0.6em 0em currentColor;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  box-sizing: border-box;
  border-style: solid;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail1 {
  border-color: currentColor transparent transparent currentColor;
  border-width: 0.25em 0.25em 0 0;
  transform: rotateZ(-45deg);
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail2 {
  border-color: currentColor currentColor transparent transparent;
  border-width: 0.25em 0 0 0.25em;
  transform: rotateZ(45deg);
}
.commet-rli-bounding-box .commet-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--commet-phase1-color);
}

@property --commet-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7bx {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7cp {
  100%, 0% {
    color: var(--commet-phase1-color);
  }
  20% {
    color: var(--commet-phase1-color);
  }
  25% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  45% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  50% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  70% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  75% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
  95% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--commet-phase".concat(t+1,"-color")});Ie(`.OP-annulus-rli-bounding-box {
  --OP-annulus-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .whirl {
  animation: uxlv7n7 calc(var(--rli-animation-duration, 1.5s) * 1.33) linear infinite;
  height: 100%;
  transform-origin: center center;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .path {
  stroke-dasharray: 1, 125;
  stroke-dashoffset: 0;
  animation: var(--rli-animation-duration, 1.5s) var(--rli-animation-function, ease-in-out) infinite uxlv7oa, calc(var(--rli-animation-duration, 1.5s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7p5;
  stroke-linecap: round;
}
.OP-annulus-rli-bounding-box .OP-annulus-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7n7 {
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7oa {
  0% {
    stroke-dasharray: 1, 125;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -35px;
  }
  100% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -124px;
  }
}
@keyframes uxlv7p5 {
  100%, 0% {
    stroke: var(--OP-annulus-phase1-color);
  }
  22% {
    stroke: var(--OP-annulus-phase1-color);
  }
  25% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  42% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  50% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  72% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  75% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
  97% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--OP-annulus-phase".concat(t+1,"-color")});function Sn(n){return n&&n.Math===Math&&n}Ie(`.OP-dotted-rli-bounding-box {
  --OP-dotted-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-dotted-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .OP-dotted-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder .dot {
  display: block;
  margin: 0 auto;
  width: 15%;
  height: 15%;
  background-color: currentColor;
  border-radius: 50%;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) infinite uxlv7nu, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7ol;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) {
  transform: rotate(0deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 12 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) {
  transform: rotate(30deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 11 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) {
  transform: rotate(60deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 10 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) {
  transform: rotate(90deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 9 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) {
  transform: rotate(120deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 8 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) {
  transform: rotate(150deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 7 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) {
  transform: rotate(180deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 6 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) {
  transform: rotate(210deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 5 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) {
  transform: rotate(240deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 4 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) {
  transform: rotate(270deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 3 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) {
  transform: rotate(300deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 2 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) {
  transform: rotate(330deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 1 * -1);
}

@property --OP-dotted-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7nu {
  0%, 39%, 100% {
    opacity: 0;
  }
  40% {
    opacity: 1;
  }
}
@keyframes uxlv7ol {
  100%, 0% {
    background-color: var(--OP-dotted-phase1-color);
  }
  22% {
    background-color: var(--OP-dotted-phase1-color);
  }
  25% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  47% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  50% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  72% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  75% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
  97% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
}`);Sn(typeof window=="object"&&window)||Sn(typeof self=="object"&&self)||Sn(typeof global=="object"&&global)||function(){return this}()||Function("return this")();Array.from({length:4},function(n,t){return"--OP-dotted-phase".concat(t+1,"-color")});Ie(`.OP-spokes-rli-bounding-box {
  --OP-spokes-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  position: relative;
  color: var(--OP-spokes-phase1-color);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator {
  width: 4.8em;
  height: 4.8em;
  display: block;
  position: relative;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke {
  position: absolute;
  height: 1.2em;
  width: 0.4em;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: auto auto auto 50%;
  background-color: var(--OP-spokes-phase1-color);
  border-radius: 0.24em;
  opacity: 0;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) backwards infinite uxlv7pw, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite uxlv7qn;
  transform-origin: left center;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(1) {
  transform: rotate(calc(0 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(11 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(2) {
  transform: rotate(calc(1 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(10 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(3) {
  transform: rotate(calc(2 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(9 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(4) {
  transform: rotate(calc(3 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(8 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(5) {
  transform: rotate(calc(4 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(7 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(6) {
  transform: rotate(calc(5 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(6 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(7) {
  transform: rotate(calc(6 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(5 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(8) {
  transform: rotate(calc(7 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(4 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(9) {
  transform: rotate(calc(8 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(3 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(10) {
  transform: rotate(calc(9 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(2 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(11) {
  transform: rotate(calc(10 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(1 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(12) {
  transform: rotate(calc(11 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(0 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--OP-spokes-phase1-color);
  z-index: -2;
}

@property --OP-spokes-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7pw {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@keyframes uxlv7qn {
  100%, 0% {
    background-color: var(--OP-spokes-phase1-color);
  }
  22% {
    background-color: var(--OP-spokes-phase1-color);
  }
  25% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  42% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  50% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  72% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  75% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
  97% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--OP-spokes-phase".concat(t+1,"-color")});Ie(`.OP-annulus-dual-sectors-rli-bounding-box {
  --OP-annulus-dual-sectors-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator {
  width: 5em;
  height: 5em;
  display: inline-block;
  position: relative;
  z-index: 0;
  color: var(--OP-annulus-dual-sectors-phase1-color);
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .annulus-sectors {
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border-width: 0.34em;
  border-style: solid;
  border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent var(--OP-annulus-dual-sectors-phase1-color) transparent;
  background-color: transparent;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) infinite uxlv7ra, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) infinite uxlv7sv;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .OP-annulus-dual-sectors-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-dual-sectors-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7ra {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@keyframes uxlv7sv {
  100%, 0% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  20% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  25% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  45% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  50% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  70% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  75% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  95% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
}`);Array.from({length:4},function(n,t){return"--OP-annulus-dual-sectors-phase".concat(t+1,"-color")});Ie(`.OP-annulus-sector-track-rli-bounding-box {
  --OP-annulus-track-phase1-color: rgba(50, 205, 50, 0.22);
  --OP-annulus-sector-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-sector-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .annulus-track-ring {
  width: 100%;
  height: 100%;
  border-width: 0.34em;
  border-style: solid;
  border-radius: 50%;
  box-sizing: border-box;
  border-color: var(--OP-annulus-track-phase1-color);
  border-top-color: var(--OP-annulus-sector-phase1-color);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite uxlv7rl, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite uxlv7tf;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .OP-annulus-sector-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-track-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-sector-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7rl {
  to {
    transform: rotate(1turn);
  }
}
@keyframes uxlv7tf {
  100%, 0% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  18% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  25% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  43% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  50% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  68% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  75% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
  93% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return["--OP-annulus-track-phase".concat(t+1,"-color"),"--OP-annulus-sector-phase".concat(t+1,"-color")]});Ie(`.foursquare-rli-bounding-box {
  --four-square-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  color: var(--four-square-phase1-color);
  display: inline-block;
  overflow: hidden;
}
.foursquare-rli-bounding-box .foursquare-indicator {
  height: 5.3033008589em;
  width: 5.3033008589em;
  position: relative;
  display: block;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container {
  position: absolute;
  z-index: 0;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  height: 2.5em;
  width: 2.5em;
  color: inherit;
  will-change: color, width, height;
  transform: rotate(45deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7dk, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite uxlv7es;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square {
  position: absolute;
  width: 1.25em;
  height: 1.25em;
  border-radius: 0.1875em;
  background-color: currentColor;
  animation: uxlv7dd var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) both infinite;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square1 {
  top: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square2 {
  top: 0;
  right: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square3 {
  bottom: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square4 {
  bottom: 0;
  right: 0;
}

@property --four-square-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7dk {
  0% {
    width: 2.5em;
    height: 2.5em;
  }
  10% {
    width: 2.5em;
    height: 2.5em;
  }
  50% {
    width: 3.75em;
    height: 3.75em;
  }
  90% {
    width: 2.5em;
    height: 2.5em;
  }
  100% {
    width: 2.5em;
    height: 2.5em;
  }
}
@keyframes uxlv7dd {
  0% {
    transform: rotateZ(0deg);
  }
  10% {
    transform: rotateZ(0deg);
  }
  50% {
    transform: rotateZ(90deg);
  }
  90% {
    transform: rotateZ(90deg);
  }
  100% {
    transform: rotateZ(90deg);
  }
}
@keyframes uxlv7es {
  100%, 0% {
    color: var(--four-square-phase1-color);
  }
  20% {
    color: var(--four-square-phase1-color);
  }
  25% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  45% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  50% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  70% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  75% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
  95% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--four-square-phase".concat(t+1,"-color")});Ie(`.mosaic-rli-bounding-box {
  --mosaic-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  color: var(--mosaic-phase1-color);
}
.mosaic-rli-bounding-box .mosaic-indicator {
  width: 5em;
  height: 5em;
  color: currentColor;
  display: grid;
  gap: 0.125em;
  grid-template-columns: repeat(3, 1fr);
  grid-template-areas: "a b c" "d e f" "g h i";
  position: relative;
  z-index: 0;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  z-index: -2;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube {
  background-color: var(--mosaic-phase1-color);
  animation-name: uxlv7i4, uxlv7is;
  animation-duration: var(--rli-animation-duration, 1.5s), calc(var(--rli-animation-duration, 1.5s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in-out);
  animation-iteration-count: infinite;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube1 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
  grid-area: a;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube2 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
  grid-area: b;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube3 {
  grid-area: c;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 4);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube4 {
  grid-area: d;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube5 {
  grid-area: e;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube6 {
  grid-area: f;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube7 {
  grid-area: g;
  animation-delay: 0s;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube8 {
  grid-area: h;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube9 {
  grid-area: i;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}

@property --mosaic-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes uxlv7i4 {
  0%, 60%, 100% {
    transform: scale3D(1, 1, 1);
  }
  30% {
    transform: scale3D(0, 0, 1);
  }
}
@keyframes uxlv7is {
  100%, 0% {
    background-color: var(--mosaic-phase1-color);
  }
  25% {
    background-color: var(--mosaic-phase2-color, var(--mosaic-phase1-color));
  }
  50% {
    background-color: var(--mosaic-phase3-color, var(--mosaic-phase1-color));
  }
  75% {
    background-color: var(--mosaic-phase4-color, var(--mosaic-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--mosaic-phase".concat(t+1,"-color")});Ie(`.riple-rli-bounding-box {
  --riple-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--riple-phase1-color);
}
.riple-rli-bounding-box .riple-indicator {
  display: inline-block;
  width: 5em;
  height: 5em;
  position: relative;
  z-index: 0;
}
.riple-rli-bounding-box .riple-indicator .riple-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.riple-rli-bounding-box .riple-indicator .riple {
  --border-width: 0.25em;
  position: absolute;
  border: var(--border-width) solid var(--riple-phase1-color);
  opacity: 1;
  border-radius: 50%;
  will-change: top, right, left, bottom, border-color;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7i1, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite uxlv7io;
}
.riple-rli-bounding-box .riple-indicator .riple:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 1s) / 2 * -1);
}

@property --riple-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7i1 {
  0% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  4.9% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  5% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 1;
  }
  100% {
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
  }
}
@keyframes uxlv7io {
  100%, 0% {
    border-color: var(--riple-phase1-color);
  }
  24.9% {
    border-color: var(--riple-phase1-color);
  }
  25% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  49.9% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  50% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  74.9% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  75% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
  99.9% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--riple-phase".concat(t+1,"-color")});Ie(`.pulsate-rli-bounding-box {
  --TD-pulsate-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
  box-sizing: border-box;
  color: var(--TD-pulsate-phase1-color);
}
.pulsate-rli-bounding-box .pulsate-indicator {
  width: 4.4em;
  height: 1.1em;
  text-align: center;
  position: relative;
  z-index: 0;
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  align-items: center;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot {
  width: 1.1em;
  height: 1.1em;
  border-radius: 50%;
  background-color: var(--TD-pulsate-phase1-color);
  transform: scale(0);
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7s0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) var(--delay) infinite uxlv7to;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(1) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15 * -1);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(2) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(3) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15);
}
.pulsate-rli-bounding-box .pulsate-text {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 80%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.6em;
  letter-spacing: 0.5px;
  font-family: sans-serif;
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --TD-pulsate-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7s0 {
  0%, 90%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}
@keyframes uxlv7to {
  0%, 100% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  24.9% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  25% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  49.9% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  50% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  74.9% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  75% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
  99.9% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--TD-pulsate-phase".concat(t+1,"-color")});Ie(`.brick-stack-rli-bounding-box {
  --TD-brick-stack-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-brick-stack-phase1-color);
}
.brick-stack-rli-bounding-box .brick-stack-indicator {
  width: 2.8em;
  height: 2.8em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.brick-stack-rli-bounding-box .brick-stack {
  width: 100%;
  height: 100%;
  background: radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 0/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 100%/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 100% 100%/40% 40% no-repeat;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, ease-out) infinite uxlv7tu, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, ease-out) infinite uxlv7us;
}

@property --TD-brick-stack-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes uxlv7tu {
  0% {
    background-position: 0 0, 0 100%, 100% 100%;
  }
  25% {
    background-position: 100% 0, 0 100%, 100% 100%;
  }
  50% {
    background-position: 100% 0, 0 0, 100% 100%;
  }
  75% {
    background-position: 100% 0, 0 0, 0 100%;
  }
  100% {
    background-position: 100% 100%, 0 0, 0 100%;
  }
}
@keyframes uxlv7us {
  100%, 0% {
    color: var(--TD-brick-stack-phase1-color);
  }
  20% {
    color: var(--TD-brick-stack-phase1-color);
  }
  25% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  45% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  50% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  70% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  75% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
  95% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--TD-brick-stack-phase".concat(t+1,"-color")});Ie(`.bob-rli-bounding-box {
  --TD-bob-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-bob-phase1-color);
}
.bob-rli-bounding-box .bob-indicator {
  width: 4.4em;
  height: 2.2em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bob-rli-bounding-box .bob-indicator .bobbing,
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  width: 1.1em;
  height: 100%;
  display: grid;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) var(--delay) infinite uxlv7u0, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) var(--delay) infinite uxlv7vq;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  content: "";
  grid-area: 1/1;
}
.bob-rli-bounding-box .bob-indicator .bobbing {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12 * -1);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
  transform: translateX(150%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12);
  transform: translateX(300%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}

@property --TD-bob-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7u0 {
  100%, 0% {
    background-position: 50% 50%;
  }
  15% {
    background-position: 50% 10%;
  }
  30% {
    background-position: 50% 100%;
  }
  40% {
    background-position: 50% 0%;
  }
  50% {
    background-position: 50% 90%;
  }
  70% {
    background-position: 50% 10%;
  }
  98% {
    background-position: 50% 50%;
  }
}
@keyframes uxlv7vq {
  100%, 0% {
    color: var(--TD-bob-phase1-color);
  }
  22% {
    color: var(--TD-bob-phase1-color);
  }
  25% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  47% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  50% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  72% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  75% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
  97% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--TD-bob-phase".concat(t+1,"-color")});Ie(`.bounce-rli-bounding-box {
  --TD-bounce-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--TD-bounce-phase1-color);
  display: inline-block;
  padding-bottom: 0.25125em;
}
.bounce-rli-bounding-box .wrapper {
  --dot1-delay: 0s;
  --dot1-x-offset: 0.55em;
  --dot2-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.75) * -1);
  --dot2-x-offset: 2.2em;
  --dot3-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.5) * -1);
  --dot3-x-offset: 3.85em;
  width: 5.5em;
  height: 3.125em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bounce-rli-bounding-box .wrapper .group {
  display: block;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.bounce-rli-bounding-box .wrapper .group .dot {
  width: 1.1em;
  height: 1.1em;
  position: absolute;
  border-radius: 50%;
  background-color: var(--TD-bounce-phase1-color);
  transform-origin: 50%;
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7wc, calc(var(--rli-animation-duration, 0.5s) * 4) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) infinite uxlv7x6;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .shadow {
  width: 1.1em;
  height: 0.22em;
  border-radius: 50%;
  background-color: rgba(0, 0, 0, 0.5);
  position: absolute;
  top: 101%;
  transform-origin: 50%;
  z-index: -1;
  filter: blur(1px);
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite uxlv7ww;
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay);
}

@property --TD-bounce-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 0.5s;
}
@keyframes uxlv7wc {
  0% {
    top: 0%;
  }
  60% {
    height: 1.25em;
    border-radius: 50%;
    transform: scaleX(1);
  }
  100% {
    top: 100%;
    height: 0.22em;
    transform: scaleX(1.5);
    filter: blur(0.4px);
  }
}
@keyframes uxlv7ww {
  0% {
    transform: scaleX(0.2);
    opacity: 0.2;
  }
  60% {
    opacity: 0.4;
  }
  100% {
    transform: scaleX(1.5);
    opacity: 0.6;
  }
}
@keyframes uxlv7x6 {
  0%, 100% {
    background-color: var(--TD-bounce-phase1-color);
  }
  20% {
    background-color: var(--TD-bounce-phase1-color);
  }
  25% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  45% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  50% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  70% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  75% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
  95% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--TD-bounce-phase".concat(t+1,"-color")});Ie(`.blink-blur-rli-bounding-box {
  --shape-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--shape-phase1-color);
}
.blink-blur-rli-bounding-box .blink-blur-indicator {
  isolation: isolate;
  display: flex;
  flex-direction: row;
  -moz-column-gap: 0.4em;
       column-gap: 0.4em;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape {
  --x-deg: -20deg;
  width: 1.8em;
  height: 2.25em;
  border-radius: 0.25em;
  color: inherit;
  transform: skewX(var(--x-deg));
  background-color: var(--shape-phase1-color);
  animation-name: uxlv7id, uxlv7jl;
  animation-duration: var(--rli-animation-duration, 1.2s), calc(var(--rli-animation-duration, 1.2s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in);
  animation-iteration-count: infinite;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape1 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.5 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape2 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.4 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape3 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.3 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape4 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.2 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape5 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.1 * -1);
}

@property --shape-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes uxlv7id {
  100%, 0% {
    opacity: 0.3;
    filter: blur(0.0675em) drop-shadow(0 0 0.0625em);
    transform: skewX(var(--x-deg)) scale(1.2, 1.45);
  }
  39% {
    opacity: 0.8;
  }
  40%, 41%, 42% {
    opacity: 0;
  }
  43% {
    opacity: 0.8;
  }
  50% {
    opacity: 1;
    filter: blur(0em) drop-shadow(0 0 0em);
    transform: skewX(var(--x-deg)) scale(1, 1);
  }
}
@keyframes uxlv7jl {
  100%, 0% {
    color: var(--shape-phase1-color);
    background-color: var(--shape-phase1-color);
  }
  25% {
    color: var(--shape-phase2-color, var(--shape-phase1-color));
    background-color: var(--shape-phase2-color, var(--shape-phase1-color));
  }
  50% {
    color: var(--shape-phase3-color, var(--shape-phase1-color));
    background-color: var(--shape-phase3-color, var(--shape-phase1-color));
  }
  75% {
    color: var(--shape-phase4-color, var(--shape-phase1-color));
    background-color: var(--shape-phase4-color, var(--shape-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--shape-phase".concat(t+1,"-color")});Ie(`.trophy-spin-rli-bounding-box {
  --trophySpin-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  position: relative;
  isolation: isolate;
  color: var(--trophySpin-phase1-color);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator {
  width: 4em;
  perspective: 1000px;
  transform-style: preserve-3d;
  display: block;
  margin: 0 auto;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade {
  display: block;
  width: 4em;
  height: 0.5em;
  background: var(--trophySpin-phase1-color);
  animation: uxlv7ki var(--rli-animation-duration, 2.5s) var(--rli-animation-function, linear) infinite, uxlv7l2 calc(var(--rli-animation-duration, 2.5s) * 0.5) var(--rli-animation-function, linear) infinite, uxlv7ly calc(var(--rli-animation-duration, 2.5s) * 4) var(--rli-animation-function, linear) infinite;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(8) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 0 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(7) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 1 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(6) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 2 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(5) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 3 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(4) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 4 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(3) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 5 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 6 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(1) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 7 * -1);
}

@property --trophySpin-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2.5s;
}
@keyframes uxlv7ki {
  to {
    transform: rotateY(1turn) rotateX(-25deg);
  }
}
@keyframes uxlv7l2 {
  100%, 0% {
    filter: brightness(1);
    opacity: 1;
  }
  15% {
    filter: brightness(1);
  }
  25% {
    opacity: 0.96;
  }
  30% {
    filter: brightness(0.92);
  }
  50% {
    filter: brightness(0.7);
    opacity: 1;
  }
  75% {
    filter: brightness(0.92);
    opacity: 0.96;
  }
  90% {
    filter: brightness(1);
  }
}
@keyframes uxlv7ly {
  100%, 0% {
    background-color: var(--trophySpin-phase1-color);
  }
  18% {
    background-color: var(--trophySpin-phase1-color);
  }
  25% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  43% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  50% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  68% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  75% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
  93% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
}`);var an=Array.from({length:4},function(n,t){return"--trophySpin-phase".concat(t+1,"-color")}),or=function(n){var t,s=sr(n?.style,n?.size),a=s.styles,i=s.fontSize,r=n?.easing,o=nr(n?.speedPlus,"2.5s").animationPeriod,l=function(d){var m={},x=an.length;if(d instanceof Array){for(var g=rr(d,x),u=0;u<g.length&&!(u>=4);u++)m[an[u]]=g[u];return m}try{if(typeof d!="string")throw new Error("Color String expected");for(var v=0;v<x;v++)m[an[v]]=d}catch(p){for(p instanceof Error?console.warn("[".concat(p.message,']: Received "').concat(typeof d,'" instead with value, ').concat(JSON.stringify(d))):console.warn("".concat(JSON.stringify(d)," received in <TrophySpin /> indicator cannot be processed. Using default instead!")),v=0;v<x;v++)m[an[v]]=ca}return m}((t=n?.color)!==null&&t!==void 0?t:"");return ue.createElement("span",{className:"rli-d-i-b trophy-spin-rli-bounding-box",style:Ke(Ke(Ke(Ke(Ke({},i&&{fontSize:i}),o&&{"--rli-animation-duration":o}),r&&{"--rli-animation-function":r}),l),a),role:"status","aria-live":"polite","aria-label":"Loading"},ue.createElement("span",{className:"rli-d-i-b trophy-spin-indicator"},ue.createElement("span",{className:"blade"}),ue.createElement("span",{className:"blade"}),ue.createElement("span",{className:"blade"}),ue.createElement("span",{className:"blade"}),ue.createElement("span",{className:"blade"}),ue.createElement("span",{className:"blade"}),ue.createElement("span",{className:"blade"}),ue.createElement("span",{className:"blade"})),ue.createElement(ir,{staticText:!0,text:n?.text,textColor:n?.textColor}))};Ie(`.slab-rli-bounding-box {
  --slab-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--slab-phase1-color);
  position: relative;
}
.slab-rli-bounding-box .slab-indicator {
  position: relative;
  display: block;
  width: 7em;
  height: 4em;
  margin: 0 auto;
  overflow: hidden;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper {
  width: 4em;
  height: 4em;
  transform: perspective(15em) rotateX(66deg) rotateZ(-25deg);
  transform-style: preserve-3d;
  transform-origin: 50% 100%;
  display: block;
  position: absolute;
  bottom: 0;
  right: 0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--slab-phase1-color);
  opacity: 0;
  box-shadow: -0.08em 0.15em 0 rgba(0, 0, 0, 0.45);
  transform-origin: 0% 0%;
  animation: calc(var(--rli-animation-duration-unitless, 3) * 1s) var(--rli-animation-function, linear) infinite uxlv7md, calc(var(--rli-animation-duration-unitless, 3) * 4s) var(--rli-animation-function, linear) infinite uxlv7n0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(1) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 3 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(2) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 2 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(3) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(4) {
  animation-delay: 0s;
}

@property --slab-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration-unitless {
  syntax: "<number>";
  inherits: true;
  initial-value: 3;
}
@keyframes uxlv7md {
  0% {
    transform: translateY(0) rotateX(30deg);
    opacity: 0;
  }
  10% {
    transform: translateY(-40%) rotateX(0deg);
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  100% {
    transform: translateY(-400%) rotateX(0deg);
    opacity: 0;
  }
}
@keyframes uxlv7n0 {
  100%, 0% {
    background-color: var(--slab-phase1-color);
  }
  24.9% {
    background-color: var(--slab-phase1-color);
  }
  25% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  49.9% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  50% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  74.9% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  75% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
  99.9% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--slab-phase".concat(t+1,"-color")});Ie(`.lifeline-rli-bounding-box {
  --life-line-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  isolation: isolate;
  color: var(--life-line-phase1-color);
}
.lifeline-rli-bounding-box .lifeline-indicator {
  position: relative;
  text-align: center;
}
.lifeline-rli-bounding-box .lifeline-indicator path.rli-lifeline {
  stroke-dasharray: 474.7616760254 30.3039367676;
  animation: var(--rli-animation-duration, 2s) var(--rli-animation-function, linear) infinite uxlv7k3, calc(var(--rli-animation-duration, 2s) * 4) var(--rli-animation-function, linear) infinite uxlv7kg;
}
.lifeline-rli-bounding-box .lifeline-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --life-line-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2s;
}
@keyframes uxlv7k3 {
  to {
    stroke-dashoffset: -1010.1312255859;
  }
}
@keyframes uxlv7kg {
  100%, 0% {
    color: var(--life-line-phase1-color);
  }
  20% {
    color: var(--life-line-phase1-color);
  }
  25% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  45% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  50% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  70% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  75% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
  95% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
}`);Array.from({length:4},function(n,t){return"--life-line-phase".concat(t+1,"-color")});const lr={sm:14,md:20,lg:32,xl:48},da=({size:n="md",color:t="#3b82f6",speedPlus:s=1,className:a=""})=>{const i=lr[n];return e.jsx("div",{className:`flex items-center justify-center ${a}`,children:e.jsx(or,{color:t,size:i,speedPlus:s,style:{width:`${i}px`,height:`${i}px`}})})},bn=({className:n})=>e.jsx(da,{size:"sm",className:n}),Cn=({className:n,color:t})=>e.jsx(da,{size:"md",color:t,className:n}),gs=({config:n,onStartWorkflow:t,onQuickAction:s,processingAction:a,isFooter:i=!1})=>{const[r,o]=c.useState(!1),l=a===n.actionId,d=n.icon,m=c.useCallback(()=>{l||o(!0)},[l]),x=c.useCallback(()=>{o(!1)},[]),g=c.useCallback(async()=>{n.actionId==="bloods"&&s&&await s(n.actionId,{type:"prepare-modal"}),t&&t(n.workflowId),o(!1)},[t,s,n.workflowId,n.actionId]),u=c.useCallback(async()=>{await s(n.actionId,{type:"manual"}),o(!1)},[s,n.actionId]);return i?e.jsxs("div",{className:"relative overflow-hidden min-h-10",onMouseEnter:m,onMouseLeave:x,style:{minHeight:"40px"},children:[e.jsx("div",{className:`
          absolute inset-0 transition-all duration-200 ease-out
          ${r&&!l?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100"}
        `,children:e.jsxs("button",{disabled:l,className:`
              bg-transparent hover:bg-gray-50 transition-all duration-200 ease-out rounded-lg text-left w-full h-full p-1.5
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(d,{className:`w-3 h-3 text-${n.color}-600 flex-shrink-0`}),e.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:n.label})]}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsx("div",{className:`w-3 h-3 border-2 border-gray-300 border-t-${n.color}-600 rounded-full animate-spin`})})]})}),e.jsx("div",{className:`
          absolute inset-0 transition-all duration-200 ease-out
          ${r&&!l?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}
        `,children:e.jsxs("div",{className:"grid grid-cols-2 gap-1 h-full",children:[e.jsxs("button",{onClick:g,disabled:l,className:`
                bg-transparent hover:bg-gray-50 transition-all duration-200 ease-out rounded-lg 
                relative flex items-center justify-center p-1 text-left
                ${l?"opacity-50 cursor-not-allowed":""}
              `,children:[e.jsx(Qe,{className:`w-2.5 h-2.5 text-${n.color}-600 flex-shrink-0 mr-1`}),e.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:"Dictate"})]}),e.jsxs("button",{onClick:u,disabled:l,className:`
                bg-transparent hover:bg-gray-50 transition-all duration-200 ease-out rounded-lg 
                relative flex items-center justify-center p-1 text-left
                ${l?"opacity-50 cursor-not-allowed":""}
              `,children:[e.jsx(On,{className:`w-2.5 h-2.5 text-${n.color}-600 flex-shrink-0 mr-1`}),e.jsx("div",{className:"text-gray-900 text-[10px] font-medium leading-tight min-w-0 flex-1",children:"Type"})]})]})})]}):e.jsxs("div",{className:"relative overflow-hidden",onMouseEnter:m,onMouseLeave:x,children:[e.jsx("div",{className:`
        transition-all duration-200 ease-out
        ${r&&!l?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100"}
      `,children:e.jsxs("button",{disabled:l,className:`
            bg-transparent hover:bg-gray-50 relative flex items-center p-3 rounded-lg transition-all 
            hover:bg-gray-50 text-left w-full
            ${l?"opacity-50 cursor-not-allowed":""}
          `,children:[e.jsx(d,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-gray-900 font-medium text-sm",children:n.label}),e.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Quick entry and processing"})]}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsx("div",{className:`w-4 h-4 border-2 border-gray-300 border-t-${n.color}-600 rounded-full animate-spin`})})]})}),e.jsx("div",{className:`
        transition-all duration-200 ease-out
        ${r&&!l?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}
      `,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:g,disabled:l,className:`
              bg-transparent hover:bg-gray-50 relative flex items-center p-3 rounded-lg transition-all 
              hover:bg-${n.color}-50 text-left w-full
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[e.jsx(Qe,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-gray-900 font-medium text-sm",children:["Dictate ",n.label]}),e.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Voice recording and AI processing"})]})]}),e.jsxs("button",{onClick:u,disabled:l,className:`
              bg-transparent hover:bg-gray-50 relative flex items-center p-3 rounded-lg transition-all 
              hover:bg-${n.color}-50 text-left w-full
              ${l?"opacity-50 cursor-not-allowed":""}
            `,children:[e.jsx(On,{className:`w-4 h-4 text-${n.color}-600 flex-shrink-0 mr-3`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-gray-900 font-medium text-sm",children:["Type ",n.label]}),e.jsx("div",{className:`text-${n.color}-600 text-xs`,children:"Manual entry and quick processing"})]})]})]})})]})},cr=[{id:"preset-116-fup-3mth",displayName:"116 + FUP 3mth",itemCode:"116",notes:"Face to face follow up in 3 months please"},{id:"preset-91824-fup-3mth",displayName:"91824 + FUP 3mth",itemCode:"91824",notes:"TH follow up in 3 months please"}],dr=[{id:"dictate",label:"Dictate",icon:Qe,description:"Voice-to-text with AI formatting"},{id:"type",label:"Type",icon:On,description:"Open field for manual entry"}],rn={"investigation-summary":{icon:lt,label:"Investigations",actionId:"investigation-summary",workflowId:"investigation-summary",color:"emerald"},background:{icon:Wt,label:"Background",actionId:"background",workflowId:"background",color:"blue"},medications:{icon:Xn,label:"Medications",actionId:"medications",workflowId:"medication",color:"purple"},"social-history":{icon:Ds,label:"Social",actionId:"social-history",workflowId:"background",color:"indigo"},bloods:{icon:Os,label:"Bloods",actionId:"bloods",workflowId:"bloods",color:"red"},imaging:{icon:_s,label:"Imaging",actionId:"imaging",workflowId:"imaging",color:"cyan"}},mr=[{id:"background",label:"Background",icon:Wt,description:"Access patient background notes",category:"emr"},{id:"investigation-summary",label:"Investigations",icon:lt,description:"Open investigation summary field",category:"emr"},{id:"medications",label:"Medications",icon:Xn,description:"View/edit medication list",category:"emr"},{id:"social-history",label:"Social History",icon:Ds,description:"Access social & family history section",category:"emr"},{id:"bloods",label:"Bloods",icon:Os,description:"Blood test results and analysis",category:"emr"},{id:"imaging",label:"Imaging",icon:_s,description:"Medical imaging reports and analysis",category:"emr"},{id:"profile-photo",label:"Photo",icon:Ha,description:"Capture screenshot for patient profile",category:"emr"},{id:"annotate-screenshots",label:"Canvas",icon:$s,description:"Capture, annotate, and combine multiple screenshots",category:"emr"},{id:"quick-letter",label:"Quick Letter",icon:yt,description:"Generate quick medical letter",category:"documentation"},{id:"create-task",label:"Create Task",icon:Mt,description:"Add new task to workflow",category:"workflow"},{id:"appointment-wrap-up",label:"Wrap Up",icon:pn,description:"Complete appointment workflow",category:"workflow"},{id:"patient-education",label:"Patient Education",icon:dn,description:"Generate lifestyle advice and education",category:"documentation"},{id:"bp-diary-importer",label:"BP Diary",icon:Ht,description:"Import and analyze blood pressure diary images",category:"analysis"}],ur=[{id:"ai-medical-review",label:"AI Medical Review",icon:Ls,description:"Australian clinical oversight and guidelines review (analyzes existing EMR data)",category:"analysis"},{id:"batch-ai-review",label:"Batch AI Review",icon:ot,description:"AI review for multiple patients from appointment book",category:"analysis"}],ma=c.memo(({onQuickAction:n,onStartWorkflow:t,isFooter:s=!1})=>{const[a,i]=c.useState(null),[r,o]=c.useState(!1),[l,d]=c.useState(!1),m=async(h,N)=>{if(h==="appointment-wrap-up"&&!N){o(!0);return}if(h==="investigation-summary"&&!N){d(!0);return}if(h==="patient-education"){try{i(h),console.log("üéì Starting Patient Education..."),await n(h,{type:"show-config"}),console.log("‚úÖ Patient Education config triggered")}catch(C){console.error("‚ùå Patient Education failed:",C)}finally{i(null)}return}if(h==="batch-ai-review"){try{i(h),console.log("üë• Starting Batch AI Review..."),await n(h,{type:"show-modal"}),console.log("‚úÖ Batch AI Review modal triggered")}catch(C){console.error("‚ùå Batch AI Review failed:",C)}finally{i(null)}return}if(h==="ai-medical-review"){try{i(h),console.log("üîç Starting AI Medical Review..."),console.log("üìã Extracting EMR data for AI medical review...");const C=await x();if(C){const E={background:{hasContent:!!C.background.trim(),length:C.background.length},investigations:{hasContent:!!C.investigations.trim(),length:C.investigations.length},medications:{hasContent:!!C.medications.trim(),length:C.medications.length}},A=Object.entries(E).filter(([,f])=>f.hasContent),O=Object.keys(E).length;if(console.log("üìã EMR DATA VALIDATION:",{fieldsWithData:A.length,totalFields:O,details:E,extractionMeta:C.extractionMeta}),A.length===0){const f=Object.entries(E).filter(([,T])=>!T.hasContent).map(([T])=>T).join(", ");throw new Error(`No clinical data found - all EMR fields are empty: ${f}. Please ensure the patient record contains data in Background, Investigations, or Medications fields.`)}if(A.length<O){const f=Object.entries(E).filter(([,T])=>!T.hasContent).map(([T])=>T);console.warn(`‚ö†Ô∏è EMR PARTIAL DATA: Processing with ${A.length}/${O} fields. Missing: ${f.join(", ")}`)}console.log(`‚úÖ EMR data validation passed: ${A.length}/${O} fields available`),console.log("üîÑ Processing with Australian Medical Review Agent...");const S=u(C);await n(h,{emrData:C,formattedInput:S,type:"australian-medical-review"}),console.log("‚úÖ AI Medical Review completed successfully")}else throw console.error("‚ùå EMR EXTRACTION: extractEMRData returned null - critical extraction failure"),new Error("EMR data extraction failed - unable to connect to content script or read EMR fields. Please refresh the EMR page and ensure you are on a patient record page.")}catch(C){console.error("‚ùå AI MEDICAL REVIEW FAILED:",C);const E=C instanceof Error?C.message:"Unknown error";console.error("üö® AI Review Error Details:",{message:E,stack:C instanceof Error?C.stack:"No stack trace",timestamp:new Date().toISOString()});let A=`AI Medical Review Error

${E}`;E.includes("Content script not responding")?A+=`

üîß Troubleshooting:
1. Refresh the EMR page
2. Make sure you are on a patient record page
3. Try the AI Medical Review again`:E.includes("all EMR fields are empty")?A+=`

üîß Troubleshooting:
1. Navigate to a patient record with clinical data
2. Ensure Background, Investigations, or Medications fields contain information
3. Try the AI Medical Review again`:E.includes("extraction failed")&&(A+=`

üîß Troubleshooting:
1. Check the browser console for detailed logs
2. Refresh the EMR page
3. Contact support if the issue persists`),typeof window<"u"&&(E.includes("Unknown message type")||E.includes("No clinical data")||`${E}`,alert(`AI Medical Review Error

${A}`))}finally{i(null)}return}try{i(h),console.log("‚ö° Calling onQuickAction..."),await n(h,N),console.log("‚ö° onQuickAction completed successfully"),o(!1),d(!1)}catch(C){console.error(`‚ùå Quick action ${h} failed:`,C)}finally{i(null)}},x=async()=>{try{console.log("üìã EMR EXTRACTION: Starting EMR data extraction..."),console.log("üìã EMR EXTRACTION: Current tab info:",await chrome.tabs.query({active:!0,currentWindow:!0})),console.log("üìã EMR EXTRACTION: Testing content script connection...");try{const q=await chrome.runtime.sendMessage({type:"PING"});console.log("üìã EMR EXTRACTION: Content script ping response:",q)}catch(q){throw console.error("üìã EMR EXTRACTION: Content script ping failed:",q),new Error("Content script not responding - please refresh the EMR page and try again")}console.log("üìã EMR EXTRACTION: Making individual EXECUTE_ACTION calls...");const h=[{name:"background",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"background",data:{extractOnly:!0}})},{name:"investigation-summary",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"investigation-summary",data:{extractOnly:!0}})},{name:"medications",promise:chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"medications",data:{extractOnly:!0}})}],N=await Promise.allSettled(h.map(q=>q.promise)),[C,E,A]=N;console.log("üìã EMR EXTRACTION: Detailed extraction results:"),N.forEach((q,ne)=>{const be=h[ne].name;q.status==="fulfilled"?console.log(`üìã EMR EXTRACTION: ${be} - SUCCESS:`,q.value):console.error(`üìã EMR EXTRACTION: ${be} - FAILED:`,q.reason)});const O=C.status==="fulfilled"?C.value:null,S=E.status==="fulfilled"?E.value:null,f=A.status==="fulfilled"?A.value:null,T={background:{response:O,success:O?.success||!1,hasData:!!O?.data,error:C.status==="rejected"?C.reason:null},investigations:{response:S,success:S?.success||!1,hasData:!!S?.data,error:E.status==="rejected"?E.reason:null},medications:{response:f,success:f?.success||!1,hasData:!!f?.data,error:A.status==="rejected"?A.reason:null}};console.log("üìã EMR EXTRACTION: Detailed response validation:",T);const k=g(O,"Background"),M=g(S,"Investigation Summary"),_=g(f,"Medications"),F={background:{length:k.length,hasContent:!!k.trim()},investigations:{length:M.length,hasContent:!!M.trim()},medications:{length:_.length,hasContent:!!_.trim()}};console.log("üìã EMR EXTRACTION: Final extraction summary:",F);const U=Object.values(F).filter(q=>q.hasContent).length;console.log(`üìã EMR EXTRACTION: Successfully extracted ${U}/3 fields`);const X=[];return!F.background.hasContent&&T.background.error&&X.push(`Background: ${T.background.error.message||T.background.error}`),!F.investigations.hasContent&&T.investigations.error&&X.push(`Investigations: ${T.investigations.error.message||T.investigations.error}`),!F.medications.hasContent&&T.medications.error&&X.push(`Medications: ${T.medications.error.message||T.medications.error}`),X.length>0&&console.warn("üìã EMR EXTRACTION: Some fields failed to extract:",X),{background:k,investigations:M,medications:_,extractionMeta:{successfulFields:U,totalFields:3,failedFields:X,fieldDetails:F}}}catch(h){throw console.error("‚ùå EMR EXTRACTION: Critical error in extraction process:",h),new Error(`EMR data extraction failed: ${h instanceof Error?h.message:"Unknown error"}`)}},g=(h,N="Unknown")=>{if(console.log(`üìã EMR EXTRACTION: Parsing ${N} response:`,h),!h)return console.log(`üìã EMR EXTRACTION: ${N} - No response received`),"";let C="";return typeof h=="string"?C=h:h.data&&typeof h.data=="string"?C=h.data:h.content&&typeof h.content=="string"?C=h.content:h.text&&typeof h.text=="string"?C=h.text:h.value&&typeof h.value=="string"&&(C=h.value),console.log(`üìã EMR EXTRACTION: ${N} - Extracted ${C.length} characters:`,C?`"${C.substring(0,100)}${C.length>100?"...":""}"`:"(empty)"),C},u=h=>`BACKGROUND: ${h.background||"Not provided"}

INVESTIGATIONS: ${h.investigations||"Not provided"}

MEDICATIONS: ${h.medications||"Not provided"}`,v=async h=>{await m("appointment-wrap-up",{preset:h})},p=h=>{h.id==="dictate"?t&&(t("investigation-summary"),d(!1)):h.id==="type"&&m("investigation-summary",{type:"manual"})},w=()=>{o(!1),d(!1)},b=mr,P=b.reduce((h,N)=>(h[N.category]||(h[N.category]=[]),h[N.category].push(N),h),{}),R={emr:"EMR Navigation",documentation:"Documentation",workflow:"Workflow",analysis:"Clinical Analysis"},j={emr:Va,documentation:yt,workflow:Mt,analysis:$n};return l?e.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:w,className:"flex items-center text-blue-600 hover:text-blue-700",children:e.jsx(as,{className:"w-4 h-4 mr-1"})}),e.jsx(lt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Investigation Summary"}),e.jsx("p",{className:"text-gray-600 text-xs",children:"Choose how to add your summary"})]})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:dr.map(h=>e.jsxs("button",{onClick:()=>p(h),disabled:a==="investigation-summary",className:`
                  bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded-lg p-4 text-left
                  ${a==="investigation-summary"?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(h.icon,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:h.label}),e.jsx("div",{className:"text-gray-600 text-xs leading-tight",children:h.description})]}),e.jsx(_n,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]}),a==="investigation-summary"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsx(Cn,{})})]},h.id))})}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsxs("p",{className:"text-gray-600 text-xs",children:["üí° ",e.jsx("strong",{children:"Tip:"})," Dictate uses AI to format your speech, Type opens the field for manual entry"]})})]}):r?e.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:w,className:"flex items-center text-blue-600 hover:text-blue-700",children:e.jsx(as,{className:"w-4 h-4 mr-1"})}),e.jsx(pn,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Appointment Wrap-up Presets"}),e.jsx("p",{className:"text-gray-600 text-xs",children:"Choose a preset to apply"})]})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:cr.map(h=>e.jsxs("button",{onClick:()=>v(h),disabled:a==="appointment-wrap-up",className:`
                  bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded-lg p-4 text-left
                  ${a==="appointment-wrap-up"?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(pn,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-gray-900 text-sm font-semibold mb-1",children:h.displayName}),e.jsxs("div",{className:"text-gray-600 text-xs mb-2",children:[e.jsx("span",{className:"font-medium",children:"Item Code:"})," ",h.itemCode]}),e.jsxs("div",{className:"text-gray-600 text-xs leading-tight",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),' "',h.notes,'"']})]}),e.jsx(_n,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"})]}),a==="appointment-wrap-up"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsx(Cn,{})})]},h.id))})}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsxs("p",{className:"text-gray-600 text-xs",children:["üí° ",e.jsx("strong",{children:"Tip:"})," Presets will automatically fill the Item Code and Appointment Notes fields"]})})]}):s?e.jsxs(W.div,{className:"bg-white",variants:xe(xn),initial:"hidden",animate:"visible",children:[e.jsxs(W.div,{className:"flex items-center space-x-2 mb-3",variants:xe(qt),children:[e.jsx(Mt,{className:"w-3 h-3 text-blue-600"}),e.jsx("h3",{className:"text-gray-900 font-medium text-xs",children:"Quick Actions"})]}),e.jsxs(W.div,{className:"grid grid-cols-4 gap-2",variants:xe(xn),transition:{staggerChildren:Xt.tight,delayChildren:.1},children:[b.map((h,N)=>e.jsx(W.div,{variants:xe(qt),custom:N,children:rn[h.id]?e.jsx(gs,{config:rn[h.id],onStartWorkflow:t,onQuickAction:n,processingAction:a,isFooter:!0}):e.jsxs(W.button,{onClick:()=>{console.log("üîß Button clicked:",h.id,"at",new Date().toISOString()),m(h.id)},disabled:a===h.id,className:`
                    relative p-2 rounded-2xl transition-all duration-150 text-left min-h-10 flex items-center
                    hover:bg-surface-primary hover:border hover:border-line-primary hover:shadow-sm
                    ${h.category==="analysis"?"hover:border-accent-violet/30":""}
                    ${a===h.id?"opacity-50 cursor-not-allowed":""}
                  `,variants:xe(Pi),whileHover:a!==h.id?"hover":void 0,whileTap:a!==h.id?"tap":void 0,children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(h.icon,{className:`w-3 h-3 flex-shrink-0 ${h.category==="analysis"?"text-accent-violet":"text-accent-emerald"}`}),e.jsx("div",{className:"text-ink-primary text-[10px] font-medium leading-tight min-w-0 flex-1",children:h.label})]}),e.jsx(Ee,{children:a===h.id&&e.jsx(W.div,{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(bn,{})})})]})},h.id)),(()=>{const N=(b.length+1)%4===1;return e.jsx(W.div,{className:`relative rounded-2xl min-h-10 flex transition-all duration-150 hover:bg-surface-primary hover:border hover:border-accent-violet/30 ${N?"col-span-4":""}`,variants:xe(qt),whileHover:{scale:1.02},transition:{type:"spring",damping:25,stiffness:300},children:e.jsx("div",{className:`flex h-full ${N?"justify-center space-x-8":""}`,children:ur.map((C,E)=>e.jsxs(W.button,{onClick:()=>{console.log("üîß AI Button clicked:",C.id,"at",new Date().toISOString()),m(C.id)},disabled:a===C.id,className:`
                        ${N?"px-6 py-2":"flex-1 p-1"} relative transition-all text-left
                        ${!N&&E===0?"rounded-l-2xl border-r border-line-primary":""}
                        ${!N&&E===1?"rounded-r-2xl":""}
                        ${N?"rounded-2xl":""}
                        hover:bg-surface-tertiary
                        ${a===C.id?"opacity-50 cursor-not-allowed":""}
                      `,whileHover:a!==C.id?{scale:1.05}:void 0,whileTap:a!==C.id?{scale:.95}:void 0,children:[e.jsxs("div",{className:`flex items-center ${N?"flex-row space-x-2":"justify-center flex-col space-y-0.5"}`,children:[e.jsx(C.icon,{className:`${N?"w-4 h-4":"w-3 h-3"} flex-shrink-0 text-accent-violet`}),e.jsx("div",{className:`text-ink-primary font-medium leading-tight ${N?"text-xs":"text-[9px] text-center"}`,children:C.id==="ai-medical-review"?"AI Review":"Batch AI"})]}),e.jsx(Ee,{children:a===C.id&&e.jsx(W.div,{className:"absolute inset-0 flex items-center justify-center bg-surface-tertiary rounded-lg",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:e.jsx(bn,{})})})]},C.id))})})})()]})]}):e.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Mt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Quick Actions"}),e.jsx("p",{className:"text-gray-600 text-xs",children:"EMR shortcuts and workflows"})]})]})}),e.jsxs("div",{children:[Object.entries(P).map(([h,N])=>{const C=j[h];return e.jsxs("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(C,{className:"w-4 h-4 text-gray-500"}),e.jsx("h4",{className:"text-gray-700 text-xs font-medium uppercase tracking-wide",children:R[h]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:N.map(E=>rn[E.id]?e.jsx(gs,{config:rn[E.id],onStartWorkflow:t,onQuickAction:n,processingAction:a,isFooter:!1},E.id):e.jsxs("button",{onClick:()=>m(E.id),disabled:a===E.id,className:`
                          p-3 rounded-2xl text-left transition-all duration-150 micro-press micro-lift
                          hover:bg-surface-primary hover:border hover:border-line-primary hover:shadow-sm
                          ${E.category==="analysis"?"hover:border-accent-violet/30":""}
                          ${a===E.id?"opacity-50 cursor-not-allowed":""}
                        `,children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(E.icon,{className:`w-4 h-4 mt-0.5 flex-shrink-0 ${E.category==="analysis"?"text-accent-violet":"text-accent-emerald"}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-ink-primary text-xs font-medium truncate",children:E.label}),e.jsx("div",{className:"text-ink-secondary text-xs mt-1 leading-tight",children:E.description})]})]}),a===E.id&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsx(Cn,{})})]},E.id))})]},h)}),e.jsx("div",{className:"p-4 bg-surface-tertiary",children:e.jsxs("p",{className:"text-ink-secondary text-xs",children:["üí° ",e.jsx("strong",{children:"Tip:"})," Quick actions provide fast access to EMR fields and workflows"]})})]})]})});ma.displayName="QuickActions";const hs=[{id:"ai-medical-review",label:"AI Medical Review",icon:Ls,description:"Australian clinical oversight and guidelines review (analyzes existing EMR data)"},{id:"batch-ai-review",label:"Batch AI Review",icon:ot,description:"AI review for multiple patients from appointment book"}],pr=({onQuickAction:n,processingAction:t,isFooter:s=!1})=>{const[a,i]=c.useState(null),r=async(l,d)=>{if(l==="ai-medical-review"){i(l),console.log("ü§ñ AI Medical Review action triggered...");try{console.log("üìã EMR EXTRACTION: Starting EMR data extraction via service worker...");const m=await new Promise(x=>{console.log("üìã EMR EXTRACTION: Sending EXTRACT_EMR_DATA_AI_REVIEW message to service worker"),chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA_AI_REVIEW",fields:["background","investigations","medications-problemlist"]},g=>{if(console.log("üìã EMR EXTRACTION: Response from service worker:",g),chrome.runtime.lastError){console.error("üìã EMR EXTRACTION: Chrome runtime error:",chrome.runtime.lastError),x({success:!1,error:`Chrome runtime error: ${chrome.runtime.lastError.message}`});return}if(!g){console.error("üìã EMR EXTRACTION: No response received from service worker"),x({success:!1,error:"No response from service worker"});return}x(g)})});if(m.success&&m.data){const x=m.data;if(console.log("üìã EMR EXTRACTION: Successfully received data:",x),Object.entries(x).filter(([v,p])=>p&&typeof p=="string"&&p.trim().length>0).length===0)throw new Error("No EMR data found. Please ensure you're on a patient page with clinical data.");const u=`
Background: ${x.background||"No background data available"}

Investigations: ${x.investigations||"No investigations data available"}

Medications: ${x["medications-problemlist"]||"No medications data available"}
          `.trim();console.log("üìã EMR EXTRACTION: Processing EMR data for AI review"),await n(l,{emrData:x,formattedInput:u,type:"australian-medical-review"}),console.log("‚úÖ AI Medical Review completed successfully")}else{const x=m.error||"Unknown extraction error";throw new Error(`Failed to extract EMR data: ${x}`)}}catch(m){console.error("‚ùå AI Medical Review failed:",m);const x=m instanceof Error?m.message:"Unknown error";console.error("AI Review Error:",x),typeof window<"u"&&alert(`AI Medical Review Error

${x}`)}finally{i(null)}return}try{i(l),console.log("‚ö° Calling onQuickAction for AI Review..."),await n(l,d),console.log("‚ö° AI Review onQuickAction completed successfully")}catch(m){console.error(`‚ùå AI Review action ${l} failed:`,m)}finally{i(null)}},o=l=>t===l||a===l;return s?e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($n,{className:"w-3 h-3 text-indigo-600"}),e.jsx("h3",{className:"text-gray-900 font-medium text-xs",children:"AI Medical Review"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:hs.map(l=>e.jsxs("button",{onClick:()=>r(l.id),disabled:o(l.id),className:`
                bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 relative p-2 rounded-lg transition-all text-center btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(l.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx(l.icon,{className:"w-3 h-3 text-indigo-600 flex-shrink-0"}),e.jsx("div",{className:"text-gray-900 text-xs font-medium leading-tight",children:l.label})]}),o(l.id)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:e.jsx(bn,{})})]},l.id))})]}):e.jsxs("div",{className:"glass rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($n,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"AI Medical Review"}),e.jsx("p",{className:"text-gray-600 text-xs",children:"Clinical analysis and guidelines review"})]})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:hs.map(l=>e.jsxs("button",{onClick:()=>r(l.id),disabled:o(l.id),className:`
                bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 p-3 rounded-lg text-left transition-all btn-micro-press btn-micro-hover shadow-none
                hover:bg-indigo-50 border border-indigo-200 bg-indigo-50
                ${o(l.id)?"opacity-50 cursor-not-allowed":""}
              `,children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(l.icon,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-indigo-600"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-gray-900 text-xs font-medium truncate",children:l.label}),e.jsx("div",{className:"text-gray-600 text-xs mt-1 leading-tight",children:l.description})]})]}),o(l.id)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-100 rounded-lg",children:e.jsx(bn,{})})]},l.id))})}),e.jsx("div",{className:"p-4 bg-indigo-50",children:e.jsxs("p",{className:"text-indigo-700 text-xs",children:["üí° ",e.jsx("strong",{children:"Note:"})," AI Review uses MedGemma-27b for comprehensive clinical analysis"]})})]})},ua=n=>{const{isOpen:t,offset:s={x:0,y:8},alignment:a="right",maxHeight:i=320,dropdownWidth:r=280}=n,o=c.useRef(null),l=c.useRef(null),[d,m]=c.useState({top:0,left:0}),x=c.useCallback(()=>{if(!o.current||!t)return;const g=o.current.getBoundingClientRect(),u={width:window.innerWidth,height:window.innerHeight};let v=g.bottom+s.y,p=g.left+s.x,w;a==="right"?(p=g.right-r,w=u.width-g.right+s.x):a==="center"&&(p=g.left+g.width/2-r/2),p<8?(p=8,w=void 0):p+r>u.width-8&&(p=u.width-r-8,w=8);const b=u.height-g.bottom-8,P=g.top-8;let R=i;b<i&&P>b?(v=g.top-i-s.y,R=Math.min(i,P)):R=Math.min(i,b),m({top:v,left:w!==void 0?void 0:p,right:w,maxHeight:R})},[t,s,a,i]);return c.useEffect(()=>{if(t){x();const g=()=>x(),u=()=>x();return window.addEventListener("resize",g),window.addEventListener("scroll",u,!0),()=>{window.removeEventListener("resize",g),window.removeEventListener("scroll",u,!0)}}},[t,x]),{triggerRef:o,dropdownRef:l,position:d,calculatePosition:x}},gr=(n="portal-root")=>{const t=c.useRef(null);return c.useEffect(()=>{let s=document.getElementById(n);return s||(s=document.createElement("div"),s.id=n,s.style.position="relative",s.style.zIndex="999999",s.style.pointerEvents="none",document.body.appendChild(s)),t.current=s,()=>{if(s&&s.parentNode===document.body&&s.children.length===0)try{document.body.removeChild(s)}catch{console.debug("Portal container already removed:",n)}}},[n]),t.current},Qn=({isOpen:n,children:t,onClickOutside:s})=>{const a=gr("dropdown-portal");return c.useEffect(()=>{if(!n||!s)return;const i=o=>{const l=o.target;!l.closest("[data-dropdown-menu]")&&!l.closest("[data-dropdown-trigger]")&&s()},r=setTimeout(()=>{document.addEventListener("mousedown",i)},0);return()=>{clearTimeout(r),document.removeEventListener("mousedown",i)}},[n,s]),!n||!a?null:ui.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:50},children:e.jsx("div",{style:{pointerEvents:"auto"},children:t})}),a)},Tn=[{id:"quick-letter",label:"Quick Letter",description:"Medical correspondence and consultation letters",agent:"QuickLetterAgent",icon:"FileText",color:"green",category:"documentation",estimatedTime:"1-3 min",complexity:"low"},{id:"tavi-workup",label:"TAVI Workup",description:"Pre-procedural TAVI anatomical and clinical workup summary",agent:"TAVIWorkupAgent",icon:"ClipboardList",color:"red",category:"documentation",estimatedTime:"3-5 min",complexity:"medium"},{id:"consultation",label:"Consultation",description:"Comprehensive patient assessments",agent:"ConsultationAgent",icon:"Stethoscope",color:"blue",category:"documentation",estimatedTime:"2-4 min",complexity:"medium"},{id:"angiogram-pci",label:"Angiogram/PCI",description:"Cardiac catheterization and coronary interventions",agent:"AngiogramPCIAgent",icon:"Heart",color:"red",category:"procedure",estimatedTime:"8-15 min",complexity:"high"},{id:"tavi",label:"TAVI Report",description:"Transcatheter aortic valve implantation",agent:"TAVIAgent",icon:"CircleDot",color:"red",category:"procedure",estimatedTime:"8-12 min",complexity:"high"},{id:"mteer",label:"mTEER Report",description:"Mitral transcatheter edge-to-edge repair",agent:"MTEERAgent",icon:"Zap",color:"purple",category:"procedure",estimatedTime:"7-10 min",complexity:"high"},{id:"pfo-closure",label:"PFO Closure",description:"Patent foramen ovale closure",agent:"PFOClosureAgent",icon:"Shield",color:"green",category:"procedure",estimatedTime:"5-8 min",complexity:"medium"},{id:"right-heart-cath",label:"Right Heart Cath",description:"Right heart catheterisation with haemodynamic assessment",agent:"RightHeartCathAgent",icon:"Activity",color:"orange",category:"procedure",estimatedTime:"6-10 min",complexity:"medium"},{id:"ohif-viewer",label:"OHIF Viewer",description:"Medical imaging viewer (coming soon)",agent:"OHIFViewerAgent",icon:"Monitor",color:"cyan",category:"investigation",estimatedTime:"N/A",complexity:"low"}],hr={Heart:Kt,FileText:He,Activity:Dt,Stethoscope:ji,CircleDot:Ni,Mic:Xs,Square:ct,Search:Si,User:hn,Pill:Ci,Shield:Ti},pa=c.memo(({onWorkflowSelect:n,activeWorkflow:t,isRecording:s,disabled:a=!1,voiceActivityLevel:i=0,recordingTime:r=0,whisperServerRunning:o=!0})=>{const[l,d]=c.useState(!1),[m,x]=c.useState(!1),g=c.useRef(null),u=c.useRef(!1),v=c.useRef(null),p=c.useRef(`record-menu-${Math.random().toString(36).slice(2)}`),{triggerRef:w,position:b}=ua({isOpen:l,alignment:"center",offset:{x:0,y:8},maxHeight:400,dropdownWidth:390}),P=f=>{const T=Math.floor(f/60),k=f%60;return`${T}:${k.toString().padStart(2,"0")}`},R=()=>{if(a){console.log("üö´ Mouse enter ignored - button disabled");return}console.log("üñ±Ô∏è Mouse entered record button",{isExpanded:l,hasTimeout:!!g.current,isHoveringRefCurrent:u.current,whisperServerRunning:o,disabled:a,isRecording:s,activeWorkflow:t}),u.current=!0,x(!0),g.current&&(console.log("üßπ Clearing existing hover timeout"),window.clearTimeout(g.current),g.current=null),l||(console.log("‚è∞ Setting expand timeout"),g.current=window.setTimeout(()=>{u.current?(console.log("üéØ Expanding card after hover delay"),d(!0)):console.log("üö´ Not expanding - mouse already left"),g.current=null},50))},j=()=>{console.log("üñ±Ô∏è Mouse left record button",{isExpanded:l,isHoveringRefCurrent:u.current}),u.current=!1,x(!1),g.current&&(console.log("üßπ Clearing existing timeout on mouse leave"),window.clearTimeout(g.current),g.current=null),console.log("‚è∞ Setting collapse timeout"),g.current=window.setTimeout(()=>{u.current?console.log("üö´ Not collapsing - mouse returned"):(console.log("üîΩ Collapsing card - mouse completely away"),d(!1)),g.current=null},150)},h=()=>{console.log("üñ±Ô∏è Mouse entered card",{isExpanded:l,hasTimeout:!!g.current}),u.current=!0,x(!0),g.current&&(console.log("üßπ Clearing timeout on card enter"),window.clearTimeout(g.current),g.current=null)},N=()=>{console.log("üñ±Ô∏è Mouse left card",{isExpanded:l,isHoveringRefCurrent:u.current}),u.current=!1,x(!1),g.current&&(console.log("üßπ Clearing timeout on card leave"),window.clearTimeout(g.current),g.current=null),console.log("‚è∞ Setting collapse timeout from card"),g.current=window.setTimeout(()=>{u.current?console.log("üö´ Not collapsing - mouse returned to hover area"):(console.log("üîΩ Collapsing card - mouse left card area"),d(!1)),g.current=null},150)};c.useEffect(()=>{if(!s&&t){console.log("üîÑ Recording stopped - resetting dropdown state after delay",{activeWorkflow:t,isExpanded:l,isHovering:m,hasTimeout:!!g.current});const f=window.setTimeout(()=>{console.log("üîß Performing full dropdown state reset",{wasExpanded:l,wasHovering:m}),d(!1),x(!1),u.current=!1,g.current&&(console.log("üßπ Clearing hover timeout during recording stop reset"),window.clearTimeout(g.current),g.current=null),console.log("‚úÖ Dropdown state reset complete - ready for next recording")},1e3);return()=>{console.log("üßπ Cleaning up recording stop timeout"),window.clearTimeout(f)}}},[s,t]),c.useEffect(()=>()=>{console.log("üßπ RecordPanel unmounting - cleaning up timeouts and refs"),g.current&&(window.clearTimeout(g.current),g.current=null),u.current=!1},[]),c.useEffect(()=>{console.log("üîß RecordPanel state check:",{isExpanded:l,isHovering:m,isHoveringRefCurrent:u.current,disabled:a,whisperServerRunning:o,isRecording:s,activeWorkflow:t,hasTimeout:!!g.current,timestamp:Date.now()});const f=l&&!u.current&&!s,T=!a&&o;f&&(console.warn("üö® DETECTED STALE EXPANDED STATE - auto-fixing to restore hover functionality",{isExpanded:l,isHoveringRefCurrent:u.current,isRecording:s,isButtonAccessible:T}),d(!1),x(!1),u.current=!1,g.current&&(console.log("üßπ Clearing stale timeout during auto-fix"),window.clearTimeout(g.current),g.current=null),console.log("‚úÖ Stale state auto-fix complete - hover should work now")),T||console.log("‚ö†Ô∏è Button not accessible:",{disabled:a,whisperServerRunning:o,reason:a?"disabled=true":"whisper server not running"})},[a,o,s,l,t]),c.useEffect(()=>{const f=window.setTimeout(()=>{!s&&!a&&o&&console.log("üîç HOVER FUNCTIONALITY CHECK - button should be responsive",{componentReady:!0,buttonAccessible:!a&&o,isExpanded:l,isHovering:m,currentState:"ready-for-hover"})},2e3);return()=>{window.clearTimeout(f)}},[s,a,o,t]);const C=()=>{const f="relative flex items-center justify-center transition-all duration-300 cursor-pointer w-11 h-11 rounded-full border-2";return a?`${f} bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed`:s?`${f} bg-red-500 border-red-600 record-button-recording text-white shadow-lg`:`${f} bg-emerald-100 border-emerald-300 record-button-idle text-emerald-600 hover:bg-emerald-200 hover:border-emerald-400`},E=(f,T)=>{const k="relative w-full h-12 rounded-lg border-2 flex items-center justify-start font-medium transition-all duration-200 overflow-hidden hover:shadow-md";if(a||!o)return`${k} bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 border-gray-300 opacity-50 cursor-not-allowed`;if(T&&s){const _=f.category==="procedure"?"procedure-card":f.category==="documentation"?"documentation-card":"investigation-card";return`${k} ${_} recording-glow border-2`}const M=f.category==="procedure"?"btn-procedure-outline":f.category==="documentation"?"btn-documentation-outline":"btn-investigation-outline";return`${k} ${M} border-2 btn-hover-enhanced`},A=f=>{const T=hr[f.icon]||He,k=t===f.id,M=()=>o?`${f.description} ‚Ä¢ ${f.estimatedTime} ‚Ä¢ ${f.complexity} complexity`:"Whisper server not running. Please start server: ./start-whisper-server.sh";return e.jsx("button",{onClick:()=>n(f.id),disabled:a||s&&!k||!o,className:E(f,k),title:M(),tabIndex:0,children:e.jsxs("div",{className:"relative flex items-center justify-start w-full h-full px-3 py-2",children:[e.jsx("div",{className:"relative flex-shrink-0 mr-3",children:k&&s?e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-5 h-5"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-red-500/20 motion-safe:animate-ping"})]}):e.jsx(T,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("span",{className:`text-sm font-semibold ${k&&s?"text-red-700 font-bold":""}`,children:k&&s?"Complete Recording":f.label}),e.jsx("div",{className:`text-xs mt-0.5 ${k&&s?"text-red-600":"text-gray-500"}`,children:k&&s?P(r):f.estimatedTime})]}),k&&s&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-6 h-0.5 rounded-full transition-all duration-150",style:{backgroundColor:i>.1?"#10b981":"#e5e7eb",opacity:.3+i*.7}})})]})},f.id)},O=f=>{a||(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),d(T=>!T))};c.useEffect(()=>{if(l){const f=v.current;f&&setTimeout(()=>{const T=f.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');T.length>0&&T[0].focus()},0)}},[l]);const S=f=>{if(l){if(f.key==="Escape"){f.stopPropagation(),d(!1),x(!1),w.current?.focus?.();return}if(f.key==="Tab"){const T=v.current;if(!T)return;const k=Array.from(T.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(F=>!F.hasAttribute("disabled"));if(k.length===0)return;const M=k[0],_=k[k.length-1];f.shiftKey?document.activeElement===M&&(f.preventDefault(),_.focus()):document.activeElement===_&&(f.preventDefault(),M.focus())}}};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:w,type:"button","data-dropdown-trigger":!0,onMouseEnter:R,onMouseLeave:j,onClick:f=>{console.log("üñ±Ô∏è Record button clicked",{disabled:a,isExpanded:l,whisperServerRunning:o,currentTarget:f.currentTarget,timestamp:Date.now()}),!a&&o?(g.current&&(window.clearTimeout(g.current),g.current=null),d(T=>{const k=!T;return console.log("üéØ Toggling dropdown expansion:",T,"->",k),k})):console.log("‚ö†Ô∏è Click ignored - button disabled or whisper server not running")},onKeyDown:O,"aria-haspopup":"dialog","aria-expanded":l,"aria-controls":p.current,"aria-label":s?"Recording menu, recording in progress":"Open recording menu",className:C(),disabled:a,children:[e.jsx(Wa,{className:`w-5 h-5 ${s?"fill-current":""}`}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-red-300 motion-safe:animate-ping opacity-40"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-1 border-white opacity-60"})]})]}),e.jsx(Qn,{isOpen:l,onClickOutside:()=>{console.log("üñ±Ô∏è Click outside detected - closing card"),d(!1),x(!1),u.current=!1},children:e.jsxs("div",{"data-dropdown-menu":!0,id:p.current,role:"dialog","aria-labelledby":`${p.current}-label`,ref:v,onKeyDown:S,onMouseEnter:h,onMouseLeave:N,className:"record-card glass rounded-xl p-4 w-[390px] bg-white border border-gray-200 shadow-xl",style:{position:"fixed",top:b.top,left:b.left,zIndex:999999},children:[e.jsxs("div",{className:"mb-3 text-center",children:[e.jsx("h2",{id:`${p.current}-label`,className:"text-gray-900 text-base font-semibold",children:"Record Now"}),e.jsx("p",{className:"text-gray-600 text-sm",children:s?`Recording ${Tn.find(f=>f.id===t)?.label}...`:"Choose the type of medical report to create"})]}),e.jsx("div",{className:"flex flex-col gap-2 mb-3",children:Tn.map(A)}),!s&&e.jsx("div",{className:"text-center text-gray-500 text-sm",children:o?e.jsx("p",{children:"Tap workflow to start recording"}):e.jsxs("p",{className:"text-red-600 font-medium flex items-center justify-center gap-2",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-red-500","aria-hidden":"true"})," Whisper server not running - Please start server first"]})}),s&&t&&e.jsxs("div",{className:"glass rounded-lg p-2 text-center bg-red-50 border border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full motion-safe:animate-pulse"}),e.jsxs("span",{className:"text-red-800 text-xs font-bold",children:["Recording ",Tn.find(f=>f.id===t)?.label]})]}),e.jsxs("p",{className:"text-red-700 text-sm font-medium flex items-center justify-center gap-2",children:[i>.1?e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Xs,{className:"w-3.5 h-3.5"})," Listening..."]}):e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ct,{className:"w-3.5 h-3.5"})," Speak now"]})," ‚Ä¢ Tap ",e.jsx("strong",{children:"Complete"})," when done"]})]})]})})]})});pa.displayName="RecordPanel";const Pn=c.memo(({session:n,onRemoveSession:t,onSessionClick:s,showRemoveButton:a=!1,isCompact:i=!1})=>{const r=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),o=d=>e.jsx(yt,{className:"w-4 h-4"}),l=d=>{switch(d){case"recording":return{icon:e.jsx(Qe,{className:"w-3 h-3 text-red-500"}),label:"Recording",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200"};case"transcribing":return{icon:e.jsx(Ze,{className:"w-3 h-3 text-blue-500 animate-spin"}),label:"Transcribing",bgColor:"bg-blue-50",textColor:"text-blue-700",borderColor:"border-blue-200"};case"processing":return{icon:e.jsx(xt,{className:"w-3 h-3 text-purple-500"}),label:"Processing",bgColor:"bg-purple-50",textColor:"text-purple-700",borderColor:"border-purple-200"};case"completed":return{icon:e.jsx(wt,{className:"w-3 h-3 text-green-500"}),label:"Completed",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200"};case"error":return{icon:e.jsx(Lt,{className:"w-3 h-3 text-red-500"}),label:"Error",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200"};case"cancelled":return{icon:e.jsx(Le,{className:"w-3 h-3 text-gray-500"}),label:"Cancelled",bgColor:"bg-gray-50",textColor:"text-gray-700",borderColor:"border-gray-200"};default:return{icon:e.jsx(tt,{className:"w-3 h-3 text-gray-500"}),label:"Unknown",bgColor:"bg-gray-50",textColor:"text-gray-700",borderColor:"border-gray-200"}}};if(i){const d=l(n.status);return e.jsxs("div",{className:`flex items-center space-x-3 p-2 ${d.bgColor} rounded-lg border ${d.borderColor}`,children:[e.jsx(Wt,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:`text-sm font-semibold truncate ${d.textColor}`,children:n.patient.name}),e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:n.agentName||n.agentType})]}),e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-0.5 rounded-full text-xs font-medium ${d.bgColor} ${d.textColor}`,children:[d.icon,e.jsx("span",{children:d.label})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1 text-xs text-gray-600",children:[e.jsxs("span",{children:["ID: ",n.patient.id]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:r(n.timestamp)})]})]}),a&&t&&e.jsx("button",{onClick:m=>{m.stopPropagation(),t(n.id)},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Remove session",children:e.jsx(Le,{className:"w-4 h-4"})})]})}return e.jsx("div",{className:`glass rounded-xl p-4 border-l-4 border-blue-500 ${s?"cursor-pointer hover:bg-gray-50/50 transition-colors":""}`,onClick:()=>s?.(n),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Wt,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:n.patient.name}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[o(n.agentType),e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:n.agentName||n.agentType})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-700 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",n.patient.id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Age:"})," ",n.patient.age]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"DOB:"})," ",n.patient.dob]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(tt,{className:"w-3 h-3"}),e.jsx("span",{children:r(n.timestamp)})]})]}),(n.patient.phone||n.patient.medicare)&&e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[n.patient.phone&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ga,{className:"w-3.5 h-3.5"})," ",n.patient.phone]}),n.patient.medicare&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Xa,{className:"w-3.5 h-3.5"})," Medicare: ",n.patient.medicare]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n.completed&&e.jsx("div",{className:"text-green-600 bg-green-100 px-2 py-1 rounded-full text-xs font-medium",children:"‚úì Complete"}),a&&t&&e.jsx("button",{onClick:d=>{d.stopPropagation(),t(n.id)},className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove session",children:e.jsx(Le,{className:"w-4 h-4"})})]})]})})}),En=3,An=8,ga=c.memo(({sessions:n,onRemoveSession:t,onClearAllSessions:s,onSessionSelect:a,isOpen:i,onClose:r,triggerRef:o,position:l})=>{const[d,m]=c.useState(!1),[x,g]=c.useState(!1),[u,v]=c.useState(!1),p=c.useMemo(()=>{const S=performance.now();console.time("üìä Session Categorization Performance"),console.log("üìä Starting session categorization...",{totalSessions:n.length});const f=[],T=[],k=[];n.forEach(_=>{switch(_.status){case"completed":f.push(_);break;case"recording":case"transcribing":case"processing":T.push(_);break;case"error":case"cancelled":k.push(_);break}});const M=performance.now();return console.timeEnd("üìä Session Categorization Performance"),console.log("üìä Session categorization completed",{duration:`${(M-S).toFixed(2)}ms`,completed:f.length,inProgress:T.length,errored:k.length}),{completed:f,inProgress:T,errored:k}},[n]),w=c.useMemo(()=>{const S=performance.now();console.time("üìã Visible Sessions Calculation Performance");const f=d?An:En,T=x?An:En,k=u?An:En,M={completed:p.completed.slice(0,f),inProgress:p.inProgress.slice(0,T),errored:p.errored.slice(0,k),hasMoreCompleted:p.completed.length>f,hasMoreInProgress:p.inProgress.length>T,hasMoreErrored:p.errored.length>k},_=performance.now();return console.timeEnd("üìã Visible Sessions Calculation Performance"),console.log("üìã Visible sessions calculation completed",{duration:`${(_-S).toFixed(2)}ms`,visibleCompleted:M.completed.length,visibleInProgress:M.inProgress.length,visibleErrored:M.errored.length}),M},[p,d,x,u]),b=S=>{console.log("üñ±Ô∏è Session clicked in dropdown",{sessionId:S.id,patientName:S.patient.name,status:S.status,hasTranscription:!!S.transcription,hasResults:!!S.results,transcriptionLength:S.transcription?.length||0,resultsLength:S.results?.length||0,agentType:S.agentType,onSessionSelectExists:!!a}),a?(console.log("üöÄ Calling onSessionSelect..."),a(S),console.log("‚úÖ onSessionSelect called successfully")):console.warn("‚ö†Ô∏è onSessionSelect callback not provided!"),console.log("üîí Closing session dropdown..."),r()},P=S=>{t(S)},R=()=>{s(),r()},[j,h]=c.useState(null),N=ue.useRef(),C=c.useCallback(()=>{if(l){h(l);return}if(o?.current){requestAnimationFrame(()=>{if(o?.current){const S=o.current.getBoundingClientRect();h({top:Math.round(S.bottom+8),right:Math.round(window.innerWidth-S.right)})}});return}h(null)},[l,o]),E=({onClick:S,hiddenCount:f,category:T})=>e.jsxs("button",{onClick:S,className:"w-full px-3 py-2 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors flex items-center justify-center space-x-1",children:[e.jsx(at,{className:"w-3 h-3"}),e.jsxs("span",{children:["Show ",f," more ",T]})]});c.useEffect(()=>{if(!i)return;C();const S=()=>C();return window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S),N.current&&clearTimeout(N.current)}},[i,C]);const A=c.useCallback(()=>j?{position:"absolute",top:j.top,left:j.left,right:j.right,width:"320px",maxHeight:"384px",zIndex:999999}:{position:"fixed",top:"60px",right:"16px",width:"320px",maxHeight:"384px",zIndex:999999},[j]);if(!i||n.length===0)return null;const O=e.jsxs("div",{style:A(),className:"bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden","data-dropdown-menu":!0,children:[e.jsx("div",{className:"p-3 border-b border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium text-sm",children:"Recent Sessions"}),e.jsxs("p",{className:"text-gray-600 text-xs",children:[n.length," total ‚Ä¢ ",p.inProgress.length," processing ‚Ä¢ ",p.completed.length," completed",p.errored.length>0&&` ‚Ä¢ ${p.errored.length} error${p.errored.length!==1?"s":""}`]})]})]}),n.length>0&&e.jsx("button",{onClick:R,className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear all sessions",children:e.jsx(vt,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[p.inProgress.length>0&&e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[e.jsx(tt,{className:"w-3 h-3 text-amber-600"}),e.jsx("span",{className:"text-xs font-medium text-amber-700",children:"In Progress"})]}),e.jsxs("div",{className:"space-y-2",children:[w.inProgress.map(S=>e.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:f=>{console.log("üñ±Ô∏è Raw in-progress session clicked!",{sessionId:S.id,patientName:S.patient.name}),f.preventDefault(),f.stopPropagation(),b(S)},children:e.jsx(Pn,{session:S,onRemoveSession:P,showRemoveButton:!0,isCompact:!0})},S.id)),w.hasMoreInProgress&&e.jsx(E,{onClick:()=>g(!0),hiddenCount:p.inProgress.length-w.inProgress.length,category:"in progress"})]})]}),p.errored.length>0&&e.jsxs("div",{className:`p-2 ${p.inProgress.length>0?"border-t border-gray-100":""}`,children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Issues"})]}),e.jsxs("div",{className:"space-y-2",children:[w.errored.map(S=>e.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>b(S),children:e.jsx(Pn,{session:S,onRemoveSession:P,showRemoveButton:!0,isCompact:!0})},S.id)),w.hasMoreErrored&&e.jsx(E,{onClick:()=>v(!0),hiddenCount:p.errored.length-w.errored.length,category:"issues"})]})]}),p.completed.length>0&&e.jsxs("div",{className:`p-2 ${p.inProgress.length>0||p.errored.length>0?"border-t border-gray-100":""}`,children:[(p.inProgress.length>0||p.errored.length>0)&&e.jsxs("div",{className:"flex items-center space-x-1 mb-2 px-2",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium text-emerald-700",children:"Completed"})]}),e.jsxs("div",{className:"space-y-2",children:[w.completed.map(S=>e.jsx("div",{className:"cursor-pointer hover:bg-gray-50 rounded-lg transition-colors",onClick:f=>{console.log("üñ±Ô∏è Raw completed session div clicked!",{sessionId:S.id,patientName:S.patient.name,event:f.type,target:f.target,currentTarget:f.currentTarget}),f.preventDefault(),f.stopPropagation(),b(S)},onMouseDown:f=>{console.log("üñ±Ô∏è Completed session mousedown!",S.id)},children:e.jsx(Pn,{session:S,onRemoveSession:P,showRemoveButton:!0,isCompact:!0})},S.id)),w.hasMoreCompleted&&e.jsx(E,{onClick:()=>m(!0),hiddenCount:p.completed.length-w.completed.length,category:"completed"})]})]})]}),n.length===0&&e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No recent sessions"})]});return e.jsx(Qn,{isOpen:i,onClickOutside:r,children:O})},(n,t)=>{if(n.isOpen!==t.isOpen||n.sessions.length!==t.sessions.length||n.onRemoveSession!==t.onRemoveSession||n.onClearAllSessions!==t.onClearAllSessions||n.onSessionSelect!==t.onSessionSelect)return!1;const s=n.position,a=t.position;return!(s?.top!==a?.top||s?.left!==a?.left||s?.right!==a?.right)});ga.displayName="SessionDropdown";const xr={"quick-letter":"urgent",tavi:"urgent","tavi-workup":"urgent","angiogram-pci":"urgent",consultation:"high",mteer:"high","pfo-closure":"high","right-heart-cath":"high","investigation-summary":"normal",bloods:"normal","aus-medical-review":"normal",background:"low",medication:"low"};class ht{static instance;queue=[];activeJobs=new Map;completedJobs=[];isProcessing=!1;maxConcurrentJobs=2;maxQueueSize=10;maxRetries=3;retryDelayMs=1e3;jobTimeoutMs=3e5;processingTimes=[];lastCleanup=Date.now();cleanupIntervalMs=3e5;constructor(){this.startPeriodicCleanup()}static getInstance(){return ht.instance||(ht.instance=new ht),ht.instance}async addJob(t,s,a,i){if(this.queue.length>=this.maxQueueSize){const m=`Queue is full (${this.maxQueueSize} jobs). Please try again later.`;throw G.warn("Audio processing queue is full",{component:"AudioProcessingQueueService",queueSize:this.queue.length,maxQueueSize:this.maxQueueSize}),i?.onError&&i.onError(m),new Error(m)}const r=a==="tavi-workup",o=s.size/16e3,l=o>300,d={id:`job-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sessionId:t,audioBlob:s,workflowId:a,priority:xr[a]||"normal",status:"queued",queuedAt:Date.now(),retryCount:0,maxRetries:r&&l?2:this.maxRetries,onProgress:i?.onProgress,onComplete:i?.onComplete,onError:i?.onError};return r&&G.info("TAVI workup job optimization applied",{component:"AudioProcessingQueueService",jobId:d.id,audioDurationEstimate:o.toFixed(1)+"s",isLongRecording:l,maxRetries:d.maxRetries,priority:d.priority}),this.insertJobByPriority(d),G.info("Audio processing job queued",{component:"AudioProcessingQueueService",jobId:d.id,sessionId:t,workflowId:a,priority:d.priority,queuePosition:this.getJobPosition(d.id),totalQueued:this.queue.length,processing:this.activeJobs.size}),d.onProgress&&d.onProgress("queued"),this.processQueue(),d.id}cancelJob(t){const s=this.queue.findIndex(i=>i.id===t);if(s!==-1){const i=this.queue[s];return i.status="cancelled",this.queue.splice(s,1),i.onProgress&&i.onProgress("cancelled"),G.info("Audio processing job cancelled from queue",{component:"AudioProcessingQueueService",jobId:t,sessionId:i.sessionId}),!0}const a=this.activeJobs.get(t);return a?(a.status="cancelled",a.onProgress&&a.onProgress("cancelled"),G.info("Audio processing job cancelled while processing",{component:"AudioProcessingQueueService",jobId:t,sessionId:a.sessionId}),!0):!1}getQueueStats(){const t=this.queue.length+this.activeJobs.size+this.completedJobs.length,s=this.processingTimes.length>0?this.processingTimes.reduce((a,i)=>a+i,0)/this.processingTimes.length:0;return{totalJobs:t,queuedJobs:this.queue.length,processingJobs:this.activeJobs.size,completedJobs:this.completedJobs.filter(a=>a.status==="completed").length,failedJobs:this.completedJobs.filter(a=>a.status==="failed").length,averageProcessingTime:s,currentConcurrency:this.activeJobs.size,maxConcurrency:this.maxConcurrentJobs}}getJobPosition(t){const s=this.queue.findIndex(a=>a.id===t);return s===-1?-1:s+1}getJobStatus(t){const s=this.queue.find(r=>r.id===t);if(s)return s.status;const a=this.activeJobs.get(t);if(a)return a.status;const i=this.completedJobs.find(r=>r.id===t);return i?i.status:null}updateConcurrencySettings(t,s){this.maxConcurrentJobs=Math.max(1,Math.min(t,5)),s!==void 0&&(this.maxQueueSize=Math.max(5,Math.min(s,20))),G.info("Audio processing queue settings updated",{component:"AudioProcessingQueueService",maxConcurrentJobs:this.maxConcurrentJobs,maxQueueSize:this.maxQueueSize}),this.processQueue()}clearCompletedJobs(){const t=this.completedJobs.length;this.completedJobs=[],this.processingTimes=[],G.info("Cleared completed audio processing jobs",{component:"AudioProcessingQueueService",clearedCount:t})}insertJobByPriority(t){const s=["urgent","high","normal","low"],a=s.indexOf(t.priority);let i=this.queue.length;for(let r=0;r<this.queue.length;r++){const o=s.indexOf(this.queue[r].priority);if(a<o){i=r;break}}this.queue.splice(i,0,t)}async processQueue(){if(!this.isProcessing){this.isProcessing=!0;try{for(;this.queue.length>0&&this.activeJobs.size<this.maxConcurrentJobs;){const t=this.queue.shift();!t||t.status==="cancelled"||(this.activeJobs.set(t.id,t),t.status="processing",t.startedAt=Date.now(),t.onProgress&&t.onProgress("processing"),this.processJobAsync(t))}}finally{this.isProcessing=!1}}}async processJobAsync(t){try{G.info("Starting audio processing job",{component:"AudioProcessingQueueService",jobId:t.id,sessionId:t.sessionId,workflowId:t.workflowId,priority:t.priority,retryCount:t.retryCount});const{LMStudioService:s}=await Pe(async()=>{const{LMStudioService:d}=await import("./chunks/services.BFX6WlO5.js").then(m=>m.a);return{LMStudioService:d}},__vite__mapDeps([6,5])),a=s.getInstance(),i=new Promise((d,m)=>{setTimeout(()=>m(new Error("Job timeout")),this.jobTimeoutMs)});if(!t.audioBlob)throw new Error("Audio blob unavailable for processing");const r=a.transcribeAudio(t.audioBlob,void 0,t.workflowId),o=await Promise.race([r,i]);t.status="completed",t.completedAt=Date.now();const l=t.completedAt-(t.startedAt||t.queuedAt);this.processingTimes.push(l),this.processingTimes.length>50&&(this.processingTimes=this.processingTimes.slice(-50)),G.info("Audio processing job completed",{component:"AudioProcessingQueueService",jobId:t.id,sessionId:t.sessionId,processingTime:l,resultLength:o.length}),t.onComplete&&t.onComplete(o),t.onProgress&&t.onProgress("completed")}catch(s){const a=s instanceof Error?s.message:"Unknown error";if(G.error("Audio processing job failed",{component:"AudioProcessingQueueService",jobId:t.id,sessionId:t.sessionId,error:a,retryCount:t.retryCount,maxRetries:t.maxRetries}),t.retryCount<t.maxRetries&&t.status!=="cancelled"){t.retryCount++;const i=this.retryDelayMs*Math.pow(2,t.retryCount-1);G.info("Retrying audio processing job",{component:"AudioProcessingQueueService",jobId:t.id,retryCount:t.retryCount,retryDelay:i}),setTimeout(()=>{t.status!=="cancelled"&&(t.status="queued",this.insertJobByPriority(t),this.processQueue())},i)}else t.status="failed",t.completedAt=Date.now(),t.error=a,t.onError&&t.onError(a),t.onProgress&&t.onProgress("failed",a)}finally{this.activeJobs.delete(t.id),(t.status==="completed"||t.status==="failed")&&this.completedJobs.push(t),setTimeout(()=>this.processQueue(),100)}}startPeriodicCleanup(){setInterval(()=>{const t=Date.now(),s=t-36e5,a=t-18e5,i=this.completedJobs.length;this.completedJobs=this.completedJobs.filter(r=>{const o=r.workflowId==="tavi-workup"?a:s;return(r.completedAt||r.queuedAt)>o}),this.completedJobs.forEach(r=>{r.audioBlob&&(r.completedAt||r.queuedAt)<a&&(r.audioBlob=void 0)}),this.completedJobs.length<i&&G.info("Cleaned up old completed audio processing jobs with TAVI optimization",{component:"AudioProcessingQueueService",removedCount:i-this.completedJobs.length,remainingCount:this.completedJobs.length,taviOptimization:"Aggressive cleanup for TAVI workup jobs (30min vs 1hr)"}),this.lastCleanup=t},this.cleanupIntervalMs)}}const fr=Object.freeze(Object.defineProperty({__proto__:null,AudioProcessingQueueService:ht},Symbol.toStringTag,{value:"Module"})),br=({isCompact:n=!1,className:t=""})=>{const[s,a]=c.useState(null),[i,r]=c.useState(!1);if(c.useEffect(()=>{const l=ht.getInstance(),d=()=>{const x=l.getQueueStats();a(x);const g=x.queuedJobs>0||x.processingJobs>0;r(g)};d();const m=setInterval(d,2e3);return()=>clearInterval(m)},[]),!i||!s)return null;const o=l=>l<1e3?`${Math.round(l)}ms`:l<6e4?`${Math.round(l/1e3)}s`:`${Math.round(l/6e4)}m`;return n?e.jsxs("div",{className:`inline-flex items-center space-x-2 text-xs text-gray-600 ${t}`,children:[s.processingJobs>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(xt,{className:"w-3 h-3 text-blue-500"}),e.jsxs("span",{children:[s.processingJobs," processing"]})]}),s.queuedJobs>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(tt,{className:"w-3 h-3 text-amber-500"}),e.jsxs("span",{children:[s.queuedJobs," queued"]})]})]}):e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-3 shadow-sm ${t}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gn,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Audio Queue"})]}),s.currentConcurrency>0&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-green-600",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.currentConcurrency,"/",s.maxConcurrency]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[s.processingJobs>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Processing"}),e.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:s.processingJobs})]})]}),s.queuedJobs>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Queued"}),e.jsxs("div",{className:"flex items-center space-x-1 text-amber-600",children:[e.jsx(tt,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:s.queuedJobs})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[s.completedJobs>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Completed"}),e.jsx("span",{className:"font-medium text-green-600",children:s.completedJobs})]}),s.failedJobs>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Failed"}),e.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[e.jsx(Lt,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:s.failedJobs})]})]}),s.averageProcessingTime>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Avg Time"}),e.jsx("span",{className:"font-medium text-gray-900",children:o(s.averageProcessingTime)})]})]})]}),s.processingJobs>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${s.processingJobs/s.maxConcurrency*100}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.processingJobs,"/",s.maxConcurrency]})]})})]})};class fe{static instance;toasts=[];listeners=new Set;autoRemoveTimers=new Map;constructor(){}static getInstance(){return fe.instance||(fe.instance=new fe),fe.instance}subscribe(t){return this.listeners.add(t),t([...this.toasts]),()=>{this.listeners.delete(t)}}notifyListeners(){requestAnimationFrame(()=>{this.listeners.forEach(t=>{t([...this.toasts])})})}show(t){const s=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={...t,id:s,timestamp:Date.now(),duration:t.duration??(t.type==="error"?4e3:3e3)};if(this.toasts.unshift(a),this.toasts.length>5&&this.toasts.splice(5).forEach(r=>{const o=this.autoRemoveTimers.get(r.id);o&&(clearTimeout(o),this.autoRemoveTimers.delete(r.id))}),this.notifyListeners(),a.duration&&a.duration>0){const i=window.setTimeout(()=>{this.remove(s)},a.duration);this.autoRemoveTimers.set(s,i)}return s}remove(t){const s=this.toasts.findIndex(a=>a.id===t);if(s!==-1){this.toasts.splice(s,1);const a=this.autoRemoveTimers.get(t);a&&(clearTimeout(a),this.autoRemoveTimers.delete(t)),this.notifyListeners()}}clear(){this.autoRemoveTimers.forEach(t=>clearTimeout(t)),this.autoRemoveTimers.clear(),this.toasts=[],this.notifyListeners()}success(t,s,a){return this.show({type:"success",title:t,message:s,duration:a})}error(t,s,a){return this.show({type:"error",title:t,message:s,duration:a})}warning(t,s,a){return this.show({type:"warning",title:t,message:s,duration:a})}info(t,s,a){return this.show({type:"info",title:t,message:s,duration:a})}}const vr=n=>{const t=n.find(r=>r.deviceId==="default");if(t)return t;const s=n.find(r=>r.label.toLowerCase().includes("built-in")||r.label.toLowerCase().includes("internal")||r.label.toLowerCase().includes("macbook"));if(s)return s;const a=n.find(r=>r.deviceId!=="default"&&r.label&&!r.label.includes("Microphone ")&&!Jn(r.label));if(a)return a;const i=n.find(r=>r.deviceId!=="default");return i||n[0]},yr=n=>{const t=n.find(r=>r.deviceId==="default");if(t)return t;const s=n.find(r=>r.label.toLowerCase().includes("built-in")||r.label.toLowerCase().includes("internal")||r.label.toLowerCase().includes("macbook"));if(s)return s;const a=n.find(r=>r.deviceId!=="default"&&r.label&&!r.label.includes("Speaker ")&&!Jn(r.label));if(a)return a;const i=n.find(r=>r.deviceId!=="default");return i||n[0]},Jn=n=>{const t=n.toLowerCase();return["iphone","ipad","airpods","bluetooth","wireless","headphones","headset","earbuds","watch"].some(a=>t.includes(a))},xs=(n,t,s)=>{if(n.deviceId==="default")return"system default device";const a=n.label.toLowerCase();return a.includes("built-in")||a.includes("internal")||a.includes("macbook")?"built-in device":Jn(n.label)?n.deviceId!=="default"?"non-default device fallback":"first available device":"preferred non-mobile device"},wr=()=>{const[n,t]=c.useState([]),[s,a]=c.useState([]),[i,r]=c.useState(!0),[o,l]=c.useState(!1),{selectedMicrophoneId:d,selectedSpeakerId:m,microphoneSelectionType:x,speakerSelectionType:g,setSelectedMicrophoneId:u,setSelectedSpeakerId:v}=Gs(),p=c.useCallback(async()=>{try{r(!0);const C=(await navigator.permissions.query({name:"microphone"})).state==="granted";l(C);const E=await navigator.mediaDevices.enumerateDevices(),A=E.filter(S=>S.kind==="audioinput").map(S=>({deviceId:S.deviceId,label:S.label||`Microphone ${S.deviceId.slice(0,8)}`,groupId:S.groupId,kind:"audioinput"})),O=E.filter(S=>S.kind==="audiooutput").map(S=>({deviceId:S.deviceId,label:S.label||`Speaker ${S.deviceId.slice(0,8)}`,groupId:S.groupId,kind:"audiooutput"}));if(t(A),a(O),A.length>0&&(!d||x==="auto")){let S=null;if(x==="auto")try{const f=localStorage.getItem("xestro-preferred-microphone");f&&(S=A.find(T=>T.deviceId===f)||null,S&&console.log("üé§ Using saved microphone preference:",S.label))}catch(f){console.warn("Failed to read microphone preference:",f)}S||(S=vr(A),console.log("üé§ Auto-selected microphone:",{deviceId:S.deviceId,label:S.label,selectionReason:xs(S,A,"microphone")})),u(S.deviceId,!1)}if(O.length>0&&(!m||g==="auto")){let S=null;if(g==="auto")try{const f=localStorage.getItem("xestro-preferred-speaker");f&&(S=O.find(T=>T.deviceId===f)||null,S&&console.log("üîä Using saved speaker preference:",S.label))}catch(f){console.warn("Failed to read speaker preference:",f)}S||(S=yr(O),console.log("üîä Auto-selected speaker:",{deviceId:S.deviceId,label:S.label,selectionReason:xs(S,O,"speaker")})),v(S.deviceId,!1)}console.log("üé§ Audio devices enumerated:",{microphones:A.length,speakers:O.length})}catch(N){console.error("üé§ Failed to enumerate audio devices:",N)}finally{r(!1)}},[d,m,x,g]),w=c.useCallback(async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(C=>C.stop()),l(!0),await p()}catch(N){console.error("üé§ Failed to get microphone permission:",N),l(!1)}},[p]),b=c.useCallback(N=>{console.log("üé§ Manually selecting microphone:",N),u(N,!0)},[u]),P=c.useCallback(N=>{console.log("üîä Manually selecting speaker:",N),v(N,!0)},[v]),R=c.useCallback(()=>{if(!d)return"No microphone";const N=n.find(C=>C.deviceId===d);return N?N.label:d==="default"?"Default microphone":"Unknown microphone"},[d,n]),j=c.useCallback(()=>{if(!m)return"No speaker";const N=s.find(C=>C.deviceId===m);return N?N.label:m==="default"?"Default speaker":"Unknown speaker"},[m,s]),h=c.useCallback(async()=>{await p()},[p]);return c.useEffect(()=>{p();const N=()=>{console.log("üé§ Audio devices changed, re-enumerating..."),p()};return navigator.mediaDevices.addEventListener("devicechange",N),()=>{navigator.mediaDevices.removeEventListener("devicechange",N)}},[p]),{microphones:n,speakers:s,selectedMicrophoneId:d,selectedSpeakerId:m,isLoading:i,hasPermission:o,setSelectedMicrophone:b,setSelectedSpeaker:P,requestPermission:w,refreshDevices:h,getCurrentMicrophoneLabel:R,getCurrentSpeakerLabel:j}},jr=({disabled:n=!1})=>{const{microphones:t,speakers:s,selectedMicrophoneId:a,selectedSpeakerId:i,setSelectedMicrophone:r,setSelectedSpeaker:o,getCurrentMicrophoneLabel:l,getCurrentSpeakerLabel:d,isLoading:m,hasPermission:x,requestPermission:g}=wr(),[u,v]=c.useState(!1),[p,w]=c.useState(!1);ue.useEffect(()=>{const R=j=>{j.target.closest("[data-audio-dropdown]")||(v(!1),w(!1))};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[]);const b=R=>{R.kind==="audioinput"?(r(R.deviceId),v(!1)):(o(R.deviceId),w(!1))},P=(R,j=15)=>R.length<=j?R:R.substring(0,j-1)+"‚Ä¶";return m?e.jsx("div",{className:"text-gray-500 text-[10px]",children:"Loading devices..."}):x?e.jsxs("div",{className:"flex items-center space-x-2 text-[10px]","data-audio-dropdown":!0,children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>!n&&v(!u),disabled:n,className:`
            flex items-center space-x-1 text-gray-500 hover:text-gray-700 transition-colors
            ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,title:`Current microphone: ${l()}`,children:[e.jsx("span",{children:"üé§"}),e.jsx("span",{className:"max-w-[80px] truncate",children:P(l(),20)}),e.jsx(at,{className:`w-2 h-2 transition-transform ${u?"transform rotate-180":""}`})]}),u&&!n&&t.length>0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-[9998] bg-white border border-gray-200 rounded-md shadow-lg min-w-[200px] max-w-[250px]",children:e.jsx("div",{className:"py-1",children:t.map(R=>e.jsxs("button",{onClick:()=>b(R),className:`
                    w-full px-3 py-1.5 text-left text-xs hover:bg-gray-50 
                    transition-colors flex items-center space-x-2
                    ${a===R.deviceId?"bg-blue-50 text-blue-900":"text-gray-800"}
                  `,children:[e.jsx(Qe,{className:`w-3 h-3 ${a===R.deviceId?"text-blue-600":"text-gray-400"}`}),e.jsx("span",{className:"truncate",children:R.label}),a===R.deviceId&&e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full ml-auto flex-shrink-0"})]},R.deviceId))})})]}),e.jsx("span",{className:"text-gray-400",children:"‚Ä¢"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>!n&&w(!p),disabled:n,className:`
            flex items-center space-x-1 text-gray-500 hover:text-gray-700 transition-colors
            ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,title:`Current speaker: ${d()}`,children:[e.jsx("span",{children:"üîä"}),e.jsx("span",{className:"max-w-[80px] truncate",children:P(d(),20)}),e.jsx(at,{className:`w-2 h-2 transition-transform ${p?"transform rotate-180":""}`})]}),p&&!n&&s.length>0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-[9998] bg-white border border-gray-200 rounded-md shadow-lg min-w-[200px] max-w-[250px]",children:e.jsx("div",{className:"py-1",children:s.map(R=>e.jsxs("button",{onClick:()=>b(R),className:`
                    w-full px-3 py-1.5 text-left text-xs hover:bg-gray-50 
                    transition-colors flex items-center space-x-2
                    ${i===R.deviceId?"bg-blue-50 text-blue-900":"text-gray-800"}
                  `,children:[e.jsx(Qa,{className:`w-3 h-3 ${i===R.deviceId?"text-blue-600":"text-gray-400"}`}),e.jsx("span",{className:"truncate",children:R.label}),i===R.deviceId&&e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full ml-auto flex-shrink-0"})]},R.deviceId))})})]})]}):e.jsx("button",{onClick:g,className:"text-gray-500 hover:text-gray-700 text-[10px] transition-colors",disabled:n,children:"Enable audio access"})},Nr={idle:{icon:Qe,label:"operator",description:"Ready to record",color:"text-ink-secondary",bgColor:"bg-surface-tertiary",animate:!1},recording:{icon:Qe,label:"Recording",description:"Listening to your voice...",color:"text-accent-red",bgColor:"bg-surface-tertiary",animate:!1},transcribing:{icon:Ze,label:"Transcribing",description:"Converting speech to text...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},classifying:{icon:bt,label:"Analyzing",description:"Determining the best medical agent...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},processing:{icon:xt,label:"Processing",description:"Generating medical report...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},enhancing:{icon:bt,label:"Enhancing",description:"Refining medical content...",color:"text-accent-violet",bgColor:"bg-surface-tertiary",animate:!0},complete:{icon:wt,label:"Complete",description:"Medical report generated successfully",color:"text-accent-emerald",bgColor:"bg-surface-tertiary",animate:!1},error:{icon:Lt,label:"Error",description:"Something went wrong. Click any workflow to restart.",color:"text-accent-red",bgColor:"bg-surface-tertiary",animate:!1},cancelled:{icon:Le,label:"Cancelled",description:"Recording cancelled. Click any workflow to start again.",color:"text-ink-secondary",bgColor:"bg-surface-tertiary",animate:!1},cancelling:{icon:Ze,label:"Cancelling",description:"Cancelling operation...",color:"text-accent-amber",bgColor:"bg-surface-tertiary",animate:!0}},kr={tavi:"TAVI Agent","angiogram-pci":"Angiogram/PCI Agent","quick-letter":"Quick Letter Agent",consultation:"Consultation Agent","investigation-summary":"Investigation Summary Agent",background:"Background Agent",medication:"Medication Agent",mteer:"MTEER Agent",tteer:"TTEER Agent","pfo-closure":"PFO Closure Agent","asd-closure":"ASD Closure Agent","right-heart-cath":"RHC Agent","pvl-plug":"PVL Plug Agent","bypass-graft":"Bypass Graft Agent","tavi-workup":"TAVI Workup Agent",enhancement:"Enhancement Agent",transcription:"Transcription Agent",generation:"Generation Agent","ai-medical-review":"AI Medical Review"},Sr=({status:n,currentAgent:t,onCompleteRecording:s,onCancelProcessing:a,isRecording:i=!1,modelStatus:r,onRefreshServices:o,onWorkflowSelect:l,activeWorkflow:d,voiceActivityLevel:m=0,recordingTime:x=0,isExtractingPatients:g=!1,patientSessions:u=[],onRemoveSession:v,onClearAllSessions:p,onSessionSelect:w,onShowMetrics:b,onNewRecording:P,showNewRecording:R=!1})=>{const j=Nr[n],h=g?Ze:j.icon,[N,C]=c.useState(!1),[E,A]=c.useState(!1),[O,S]=c.useState(null),[f,T]=c.useState(!1),[k,M]=c.useState(!1),_=c.useRef(null),F=360,U=520,{triggerRef:X,position:q}=ua({isOpen:N,alignment:"right",offset:{x:0,y:8},maxHeight:U,dropdownWidth:F}),ne=q.maxHeight&&q.maxHeight<U?q.maxHeight:void 0;ue.useEffect(()=>{const Y=le=>{le.key==="Escape"&&N&&C(!1)};if(N)return document.addEventListener("keydown",Y),()=>document.removeEventListener("keydown",Y)},[N]),c.useEffect(()=>{const Y=()=>{try{const Ae=gi.getPhase4PerformanceStats();S(Ae)}catch(Ae){console.warn("Phase 4 stats not available:",Ae),S(null)}};Y();const le=setInterval(Y,3e4);return()=>clearInterval(le)},[]);const be=()=>g?"Extracting patient data from EMR...":n==="processing"&&t?t==="ai-medical-review"?"Analyzing clinical data against Australian guidelines...":`${kr[t]||t.toUpperCase()} is analyzing your input...`:j.description,ve=()=>({idle:0,recording:20,transcribing:40,classifying:60,processing:80,enhancing:90,complete:100,error:0,cancelled:0,cancelling:0})[n],_e=async()=>{A(!0);const Y=fe.getInstance();try{await o();const le=r.isConnected,Ae=r.whisperServer?.running||!1;le&&Ae?Y.success("Services Status","All AI services are running normally"):le||Ae?Y.warning("Partial Service Status",`${le?"LMStudio connected":"LMStudio offline"}, ${Ae?"Whisper running":"Whisper stopped"}`):Y.error("Services Offline","Both LMStudio and Whisper server are offline")}catch(le){Y.error("Status Check Failed",le instanceof Error?le.message:"Failed to check service status")}finally{A(!1)}},ye=Y=>Y===0?"N/A":Y<1e3?`${Y}ms`:`${(Y/1e3).toFixed(1)}s`,We=()=>{if(!r.lastPing)return"Never";const le=Date.now()-r.lastPing;return le<6e4?"Just now":le<36e5?`${Math.floor(le/6e4)}m ago`:`${Math.floor(le/36e5)}h ago`};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`w-full h-16 ${j.bgColor} border-b border-white/20 px-4 py-3`,children:[e.jsxs("div",{className:"flex items-center justify-between h-full",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(pa,{onWorkflowSelect:l,activeWorkflow:d,isRecording:i,disabled:!1,voiceActivityLevel:m,recordingTime:x,whisperServerRunning:r.whisperServer?.running})}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx(h,{className:`w-5 h-5 ${j.color} ${j.animate||g?"motion-safe:animate-spin":""}`}),j.animate&&e.jsx("div",{className:`absolute inset-0 rounded-full border-2 ${j.color.replace("text-","border-")} motion-safe:animate-ping opacity-30`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h3",{className:`font-medium text-sm ${j.color}`,children:i?"Ready":j.label})}),e.jsx("p",{className:"text-ink-secondary text-xs mt-0.5 truncate",children:be()}),n==="idle"&&!i&&e.jsx("div",{className:"mt-1",children:e.jsx(jr,{disabled:!1})})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(br,{isCompact:!0,className:"mx-2"})}),(n==="transcribing"||n==="processing"||n==="cancelling")&&a&&e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsxs("button",{onClick:a,disabled:n==="cancelling",className:`px-2 py-1 text-xs font-medium rounded-md transition-all duration-200 flex items-center space-x-1 ${n==="cancelling"?"bg-orange-500/10 border border-orange-300 text-orange-600 cursor-not-allowed":"bg-red-500/10 border border-red-300 text-red-600 hover:bg-red-500/20 hover:border-red-400"}`,title:n==="transcribing"?"Cancel audio transcription":"Cancel AI report generation",children:[n==="cancelling"?e.jsx(Ze,{className:"w-3 h-3 animate-spin"}):e.jsx(Le,{className:"w-3 h-3"}),e.jsx("span",{children:n==="cancelling"?"Cancelling...":"Cancel"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[!i&&e.jsx("div",{className:"text-xs text-ink-secondary hidden md:block",children:ye(r.latency)}),R&&P&&e.jsx("button",{onClick:P,disabled:i||["recording","transcribing","processing","enhancing","cancelling"].includes(n),className:`bg-white border border-gray-200 transition-all duration-200 ease-out rounded-lg p-2 ${i||["recording","transcribing","processing","enhancing","cancelling"].includes(n)?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 hover:border-gray-300 cursor-pointer"}`,title:"Clear previous recording and start fresh",children:e.jsx(Ja,{className:`w-4 h-4 ${i||["recording","transcribing","processing","enhancing","cancelling"].includes(n)?"text-ink-secondary":"text-green-600"}`})}),u.length>0&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:_,onClick:()=>{console.time("üîî Notification Bell Click Performance");const Y=performance.now();console.log("üîî Bell clicked, opening sessions dropdown...",{sessionCount:u.length,timestamp:Date.now()}),M(!0),T(!f),setTimeout(()=>{M(!1);const le=performance.now();console.timeEnd("üîî Notification Bell Click Performance"),console.log("üîî Bell opening completed",{duration:`${(le-Y).toFixed(2)}ms`,sessionCount:u.length})},180)},className:`bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded-lg p-2 relative ${i?"scale-90":""}`,title:`${u.length} recent session${u.length!==1?"s":""}`,"data-dropdown-trigger":!0,children:[e.jsx(Ya,{className:"w-4 h-4 text-accent-violet"}),k&&e.jsx("span",{className:"absolute -top-1 -left-1",children:e.jsx(Ze,{className:"w-3 h-3 text-accent-violet animate-spin"})}),e.jsx("div",{className:`absolute -top-1 -right-1 bg-red-500 rounded-full flex items-center justify-center border-2 border-white ${i?"w-4 h-4":"w-5 h-5"}`,children:e.jsx("span",{className:"font-bold text-surface-primary leading-none text-xs",children:u.length>9?"9+":u.length})})]}),e.jsx(ga,{sessions:u,onRemoveSession:v||(()=>{}),onClearAllSessions:p||(()=>{}),onSessionSelect:w,isOpen:f,onClose:()=>T(!1),triggerRef:_})]}),e.jsx("button",{ref:X,"data-dropdown-trigger":!0,onClick:()=>C(!N),className:"inline-flex items-center justify-center w-11 h-11 rounded focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500","aria-label":"Settings quick view",title:"Settings Quick View",children:e.jsx(Nn,{className:"w-5 h-5 text-ink-secondary"})})]})]}),n!=="idle"&&n!=="error"&&e.jsx("div",{className:"mt-1",children:e.jsx("div",{className:"w-full bg-white/10 rounded-full h-1",children:e.jsx("div",{className:`h-1 rounded-full transition-all duration-500 ease-out ${j.color.replace("text-","bg-")}`,style:{width:`${ve()}%`}})})})]}),e.jsx(Qn,{isOpen:N,onClickOutside:()=>C(!1),children:e.jsx("div",{"data-dropdown-menu":!0,className:"glass rounded-lg border border-white/20 p-4",style:{position:"fixed",top:q.top,left:q.left,right:q.right,maxHeight:ne,width:F,minWidth:F,maxWidth:`min(${F}px, calc(100vw - 24px))`,overflowY:ne?"auto":"visible",zIndex:9999},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-ink-primary font-medium text-sm flex items-center space-x-2",children:[e.jsx(Nn,{className:"w-4 h-4"}),e.jsx("span",{children:"Settings Quick View"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:_e,disabled:E,className:"bg-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 transition-all duration-200 ease-out rounded p-1.5",title:"Refresh all services",children:e.jsx(Yt,{className:`w-3 h-3 text-accent-violet ${E?"motion-safe:animate-spin":""}`})}),e.jsx("button",{onClick:()=>C(!1),className:"bg-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 transition-all duration-200 ease-out rounded p-1.5",title:"Close",children:e.jsx(Le,{className:"w-3 h-3 text-ink-secondary"})})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ka,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"Phase 4 Intelligence"})]}),e.jsx("div",{className:"text-xs text-ink-secondary",children:O?"Active":"Loading..."})]}),O?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Agent Cache:"}),e.jsxs("span",{className:"text-ink-primary ml-1",children:[Math.round((O.agentLoader?.cacheHitRate||0)*100),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Avg Load:"}),e.jsx("span",{className:"text-ink-primary ml-1",children:(O.agentLoader?.averageLoadTime||0)>0?`${Math.round(O.agentLoader.averageLoadTime)}ms`:"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Cross-Agent:"}),e.jsx("span",{className:"text-ink-primary ml-1",children:O.crossAgentIntelligence?.globalInsights||"Learning"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Profiles:"}),e.jsx("span",{className:"text-ink-primary ml-1",children:O.crossAgentIntelligence?.activeProfiles||"‚Äî"})]})]}):e.jsx("div",{className:"text-xs text-ink-tertiary",children:"Gathering performance metrics‚Ä¶"})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Za,{className:"w-4 h-4 text-ink-primary"}),e.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"LMStudio"})]}),e.jsxs("div",{className:`flex items-center space-x-1 ${r.isConnected?"text-accent-emerald":"text-accent-red"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r.isConnected?"bg-accent-emerald":"bg-accent-red"}`}),e.jsx("span",{className:"text-xs",children:r.isConnected?"Connected":"Offline"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Latency:"}),e.jsx("span",{className:"text-ink-primary font-mono ml-1",children:ye(r.latency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Last Check:"}),e.jsx("span",{className:"text-ink-secondary ml-1",children:We()})]})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-ink-primary"}),e.jsx("span",{className:"text-ink-primary text-sm font-medium",children:"Whisper Server"})]}),e.jsxs("div",{className:`flex items-center space-x-1 ${r.whisperServer?.running?"text-accent-emerald":"text-accent-red"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r.whisperServer?.running?"bg-accent-emerald":"bg-accent-red"}`}),e.jsx("span",{className:"text-xs",children:r.whisperServer?.running?"Running":"Stopped"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Port:"}),e.jsx("span",{className:"text-ink-primary font-mono ml-1",children:r.whisperServer?.port||"8001"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-ink-secondary",children:"Model:"}),e.jsx("span",{className:"text-ink-secondary ml-1 break-words leading-snug",children:r.whisperServer?.model||"whisper-large-v3-turbo"})]})]}),!r.whisperServer?.running&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded p-2",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(et,{className:"w-3 h-3 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-800 text-xs font-medium",children:r.whisperServer?.error?.includes("timeout")?"Server Starting Up":"Manual Start Required"}),e.jsx("p",{className:"text-amber-700 text-xs mt-1 leading-relaxed",children:r.whisperServer?.error?.includes("timeout")?e.jsx(e.Fragment,{children:'Server may be initializing. Use "Refresh All Services" button above to check again.'}):e.jsxs(e.Fragment,{children:["Run in terminal: ",e.jsx("code",{className:"bg-amber-100 px-1 rounded",children:"./start-whisper-server.sh"})]})})]})]})}),r.whisperServer?.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(et,{className:"w-3 h-3 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 text-xs font-medium",children:"Connection Error"}),e.jsx("p",{className:"text-red-700 text-xs mt-1 leading-relaxed",children:r.whisperServer.error})]})]})})]}),!r.isConnected&&e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(et,{className:"w-4 h-4 text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-400 text-xs font-medium",children:"LMStudio Disconnected"}),e.jsxs("div",{className:"text-gray-500 text-xs mt-1 leading-relaxed space-y-1",children:[e.jsx("p",{children:"To fix this:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 ml-1",children:[e.jsx("li",{children:"Open LMStudio application"}),e.jsx("li",{children:"Load MedGemma-27b MLX model"}),e.jsx("li",{children:"Start server on localhost:1234"})]})]})]})]})}),b&&e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("button",{onClick:()=>{try{const Y=chrome?.runtime?.getURL?`${chrome.runtime.getURL("src/options/index.html")}#performance-metrics`:null;Y?window.open(Y,"_blank","noopener"):b&&b()}catch(Y){console.warn("Failed to open performance metrics settings:",Y),b?.()}},className:"w-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded p-2 flex items-center justify-center space-x-2",children:[e.jsx(gn,{className:"w-3 h-3 text-accent-violet"}),e.jsx("span",{className:"text-ink-primary text-xs",children:"Performance Metrics"})]})}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("button",{onClick:()=>{chrome?.runtime?.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("src/options/index.html"),"_blank")},className:"w-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ease-out rounded p-2 flex items-center justify-center space-x-2",title:"Open settings page in new tab",children:[e.jsx(Nn,{className:"w-3 h-3 text-ink-secondary"}),e.jsx("span",{className:"text-ink-primary text-xs",children:"Open Full Settings"})]})})]})})})]})},Cr=({type:n})=>{const t={className:"w-4 h-4 flex-shrink-0"};switch(n){case"success":return e.jsx(wt,{...t,className:"w-4 h-4 text-emerald-600 flex-shrink-0"});case"error":return e.jsx(Lt,{...t,className:"w-4 h-4 text-red-600 flex-shrink-0"});case"warning":return e.jsx(et,{...t,className:"w-4 h-4 text-amber-600 flex-shrink-0"});case"info":return e.jsx(Gt,{...t,className:"w-4 h-4 text-blue-600 flex-shrink-0"});default:return e.jsx(Gt,{...t})}},Tr=({toast:n,onRemove:t})=>{const s=()=>{const a="bg-white border rounded-lg p-3 shadow-lg backdrop-blur-sm";switch(n.type){case"success":return`${a} border-emerald-200 bg-emerald-50/95`;case"error":return`${a} border-red-200 bg-red-50/95`;case"warning":return`${a} border-amber-200 bg-amber-50/95`;case"info":return`${a} border-blue-200 bg-blue-50/95`;default:return`${a} border-gray-200 bg-gray-50/95`}};return e.jsx("div",{className:`${s()} animate-in slide-in-from-right-full duration-300`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Cr,{type:n.type}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-900 font-semibold text-sm leading-tight",children:n.title}),n.message&&e.jsx("p",{className:"text-gray-700 text-xs mt-1.5 leading-relaxed",children:n.message})]}),e.jsx("button",{onClick:()=>t(n.id),className:"flex-shrink-0 bg-transparent text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 ease-out rounded-md p-1",title:"Dismiss notification","aria-label":"Dismiss notification",children:e.jsx(Le,{className:"w-3.5 h-3.5"})})]})})},Pr=()=>{const[n,t]=c.useState([]);c.useEffect(()=>fe.getInstance().subscribe(t),[]);const s=a=>{fe.getInstance().remove(a)};return n.length===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-[99999] space-y-2 w-80 max-w-[calc(100vw-2rem)] pointer-events-none","aria-live":"polite",role:"status",style:{maxWidth:"min(20rem, calc(100vw - 2rem))",position:"fixed",top:"1rem",right:"1rem"},children:n.map(a=>e.jsx("div",{className:"pointer-events-auto",children:e.jsx(Tr,{toast:a,onRemove:s})},a.id))})},Er=({isOpen:n,onClose:t,onStartReview:s,calendarData:a,isExtracting:i=!1,extractError:r})=>{const[o,l]=c.useState(new Set),[d,m]=c.useState("all"),[x,g]=c.useState(!1);if(c.useEffect(()=>{n&&a&&(l(new Set),m("all"))},[n,a]),!n)return null;const u=h=>{const N=new Set(o);N.has(h)?N.delete(h):N.add(h),l(N)},v=()=>{if(!a)return;const h=p(),N=h.every(E=>o.has(E.fileNumber)),C=new Set(o);h.forEach(E=>{N?C.delete(E.fileNumber):C.add(E.fileNumber)}),l(C)},p=()=>a?a.patients.filter(h=>{switch(d){case"confirmed":return h.confirmed;case"new":return h.isFirstAppointment;case"routine":return!h.isFirstAppointment;default:return!0}}):[],w=async()=>{if(!a||o.size===0)return;g(!0);const h=a.patients.filter(N=>o.has(N.fileNumber));try{await s(h)}catch(N){console.error("Failed to start batch review:",N)}finally{g(!1)}},b=h=>{switch(h.toLowerCase()){case"canew":return"bg-blue-100 text-blue-800";case"car20":case"carvi":return"bg-green-100 text-green-800";case"canvi":return"bg-purple-100 text-purple-800";case"phone":return"bg-gray-100 text-gray-800";case"unav":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},P=p(),R=o.size,j=Math.ceil(R*2.5);return e.jsx(Ee,{children:e.jsx(W.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",variants:xe(Ks),initial:"hidden",animate:"visible",exit:"exit",onClick:t,children:e.jsxs(W.div,{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden mx-4",variants:xe(Ys),initial:"hidden",animate:"visible",exit:"exit",onClick:h=>h.stopPropagation(),children:[e.jsxs(W.div,{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",variants:xe(Qt),initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ot,{className:"w-6 h-6 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Batch AI Medical Review"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select patients for sequential AI review and analysis"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:x,children:e.jsx(Le,{className:"w-5 h-5 text-gray-500"})})]}),a&&e.jsxs("div",{className:"mt-4 flex items-center space-x-6 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pn,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"font-medium",children:a.appointmentDate})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{children:[a.totalCount," total appointments"]})]})]})]}),e.jsx(W.div,{className:"flex-1 overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:i?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"w-8 h-8 text-purple-600 animate-spin mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extracting Patient Data"}),e.jsx("p",{className:"text-gray-600",children:"Reading appointment information from calendar..."})]})}):r?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-8 h-8 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Extraction Failed"}),e.jsx("p",{className:"text-red-600 mb-4",children:r}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please ensure you're on the appointment book page and try again."})]})}):!a||a.patients.length===0?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ot,{className:"w-8 h-8 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Patients Found"}),e.jsx("p",{className:"text-gray-600",children:"No appointments with patient data were found on this calendar page."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ei,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:d,onChange:h=>m(h.target.value),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm",disabled:x,children:[e.jsxs("option",{value:"all",children:["All Appointments (",a.patients.length,")"]}),e.jsxs("option",{value:"confirmed",children:["Confirmed Only (",a.patients.filter(h=>h.confirmed).length,")"]}),e.jsxs("option",{value:"new",children:["New Patients (",a.patients.filter(h=>h.isFirstAppointment).length,")"]}),e.jsxs("option",{value:"routine",children:["Return Visits (",a.patients.filter(h=>!h.isFirstAppointment).length,")"]})]})]}),e.jsx("button",{onClick:v,className:"text-sm text-purple-600 hover:text-purple-700 font-medium",disabled:x,children:P.every(h=>o.has(h.fileNumber))?"Deselect All":"Select All"})]})}),e.jsx("div",{className:"overflow-y-auto max-h-96 p-6",children:e.jsx("div",{className:"space-y-3",children:P.map(h=>e.jsx("div",{className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${o.has(h.fileNumber)?"border-purple-300 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>u(h.fileNumber),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:o.has(h.fileNumber),onChange:()=>u(h.fileNumber),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500",disabled:x}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:h.name}),h.isFirstAppointment&&e.jsx(ti,{className:"w-4 h-4 text-yellow-500"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["DOB: ",h.dob]}),e.jsxs("span",{children:["File: ",h.fileNumber]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(tt,{className:"w-3 h-3"}),e.jsx("span",{children:h.appointmentTime})]})]}),h.notes&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:h.notes})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${b(h.appointmentType)}`,children:h.appointmentType}),h.confirmed&&e.jsx(wt,{className:"w-4 h-4 text-green-500"})]})]})},h.fileNumber))})})]})}),a&&a.patients.length>0&&!i&&!r&&e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:R})," patient",R!==1?"s":""," selected",R>0&&e.jsxs("span",{className:"ml-2",children:["‚Ä¢ Estimated time: ",e.jsxs("span",{className:"font-medium",children:[j," minutes"]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:x,children:"Cancel"}),e.jsx("button",{onClick:w,disabled:R===0||x,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Starting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Wn,{className:"w-4 h-4"}),e.jsx("span",{children:"Start AI Review"})]})})]})]})})]})})})},Ar=({onGenerate:n,isGenerating:t,isVisible:s,onClose:a,emrExtractionError:i,onRetryExtraction:r})=>{const[o,l]=c.useState("medium"),[d,m]=c.useState(["diet_nutrition","physical_activity"]),[x,g]=c.useState({}),[u,v]=c.useState(""),[p,w]=c.useState(!1),[b,P]=c.useState(null),[R,j]=c.useState(null),[h,N]=c.useState(!1);c.useEffect(()=>{s&&(async()=>{if(!(R||h)){N(!0);try{const{PatientEducationAgent:M}=await Pe(async()=>{const{PatientEducationAgent:_}=await import("./chunks/PatientEducationAgent.IPUd9ewH.js");return{PatientEducationAgent:_}},__vite__mapDeps([9,5,6]));j({getPriorityOptions:M.getPriorityOptions.bind(M),getAvailableModules:M.getAvailableModules.bind(M)})}catch(M){console.error("Failed to load PatientEducationAgent:",M)}finally{N(!1)}}})()},[s,R,h]);const C=R?.getPriorityOptions()||[],E=R?.getAvailableModules()||[],A=c.useCallback(k=>{m(M=>M.includes(k)?(g(_=>{const F={..._};return delete F[k],F}),M.filter(_=>_!==k)):[...M,k])},[]),O=c.useCallback((k,M)=>{g(_=>{const F=_[k]||[];if(F.includes(M)){const U=F.filter(X=>X!==M);if(U.length===0){const X={..._};return delete X[k],X}return{..._,[k]:U}}else return{..._,[k]:[...F,M]}})},[]),S=c.useCallback(async()=>{if(d.length!==0){w(!0);try{const k=await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),M=await chrome.runtime.sendMessage({type:"EXTRACT_EMR_DATA",fields:["background","medications","investigations"]}),_={demographics:"",background:M?.background||"",medications:M?.medications||"",investigations:M?.investigations||""},F=k?.success&&k?.data?k.data:null;console.log("üéì Extracted patient data:",F),console.log("üéì Extracted EMR data for Patient Education:",_),P(_);const U={patientPriority:o,selectedModules:d,selectedSubFocus:Object.keys(x).length>0?x:void 0,emrData:_,patientData:F,patientContext:u.trim()||void 0};await n(U)}catch(k){console.warn("‚ö†Ô∏è EMR extraction failed, proceeding with user context only:",k);const M={demographics:"",background:"",medications:"",investigations:""},_={patientPriority:o,selectedModules:d,selectedSubFocus:Object.keys(x).length>0?x:void 0,emrData:M,patientData:null,patientContext:u.trim()||void 0};await n(_)}finally{w(!1)}}},[o,d,x,u,n]),f=c.useCallback(async()=>{if(r){w(!0);try{await r()}finally{w(!1)}}},[r]);if(!s)return null;if(h||!R)return e.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(dn,{className:"w-4 h-4"}),e.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),e.jsx("button",{onClick:a,className:"text-emerald-100 hover:text-white transition-colors",children:e.jsx(Le,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"p-8 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(kn,{className:"w-5 h-5 animate-spin text-emerald-600"}),e.jsx("span",{className:"text-gray-600",children:"Loading education modules..."})]})})]});const T=k=>{const M=d.includes(k.id),_=x[k.id]||[];return e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start space-x-3 p-3 hover:border-blue-300 transition-colors",children:[e.jsx("button",{onClick:()=>A(k.id),className:"flex-shrink-0 mt-0.5",disabled:t||p,children:M?e.jsx(Mt,{className:"w-5 h-5 text-blue-600"}):e.jsx(is,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`font-medium text-sm ${M?"text-blue-900":"text-gray-700"}`,children:k.label}),e.jsxs("div",{className:"group relative inline-block",title:k.tooltip,children:[e.jsx(Gt,{className:"w-4 h-4 text-gray-400 hover:text-blue-600 cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:k.tooltip})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:k.description})]})]}),M&&k.subFocusPoints&&k.subFocusPoints.length>0&&e.jsxs("div",{className:"border-t border-gray-100 bg-gray-50 p-3 space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Focus on specific areas (optional):"}),k.subFocusPoints.map(F=>{const U=_.includes(F.id);return e.jsxs("div",{className:"flex items-start space-x-2 ml-2",children:[e.jsx("button",{onClick:()=>O(k.id,F.id),className:"flex-shrink-0 mt-0.5",disabled:t||p,children:U?e.jsx(Mt,{className:"w-4 h-4 text-emerald-600"}):e.jsx(is,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:`text-xs ${U?"text-emerald-800 font-medium":"text-gray-600"}`,children:F.label}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:F.description})]})]},F.id)})]})]},k.id)};return e.jsx("div",{className:"w-full bg-white border border-gray-200 rounded-xl shadow-lg",children:e.jsxs("div",{className:"bg-white w-full overflow-hidden rounded-xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(dn,{className:"w-4 h-4"}),e.jsx("h3",{className:"font-semibold text-sm",children:"Patient Education & Lifestyle Advice"})]}),e.jsx("button",{onClick:a,className:"text-emerald-100 hover:text-white transition-colors",disabled:t||p,children:e.jsx(Le,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-full",children:[i&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Lt,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"EMR Extraction Issue"}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:i}),r&&e.jsx("button",{onClick:f,disabled:p,className:"mt-2 px-3 py-1 bg-amber-100 hover:bg-amber-200 text-amber-800 text-xs rounded-md font-medium transition-colors disabled:opacity-50",children:p?e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(kn,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Retrying..."})]}):e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Yt,{className:"w-3 h-3"}),e.jsx("span",{children:"Retry Extraction"})]})})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Priority Level"}),e.jsx("div",{className:"space-y-2",children:C.map(k=>e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"priority",value:k.value,checked:o===k.value,onChange:M=>l(M.target.value),className:"mt-1 text-emerald-600 focus:ring-emerald-500",disabled:t||p}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:k.label}),e.jsx("p",{className:"text-xs text-gray-600",children:k.description})]})]},k.value))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Patient Specific Priorities & Goals"}),e.jsx("textarea",{value:u,onChange:k=>v(k.target.value),placeholder:"Enter specific patient priorities and goals (e.g., lose weight, stop smoking, improve fitness, reduce blood pressure, manage diabetes)...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none text-sm",rows:3,disabled:t||p}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Optional: Describe what's most important for this patient to help personalize the lifestyle advice."})]}),b&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Extracted Patient Information"}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-2",children:[b.background&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Background:"}),e.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:b.background})]}),b.medications&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Medications:"}),e.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:b.medications})]}),b.investigations&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Recent Investigations:"}),e.jsx("p",{className:"text-xs text-gray-700 mt-1 line-clamp-2",children:b.investigations})]}),!b.background&&!b.medications&&!b.investigations&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:"No patient data found in EMR fields"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This information will be used to personalize the lifestyle advice."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Select Lifestyle Areas (Choose at least 1)"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:E.map(T)}),d.length===0&&e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"Please select at least one lifestyle area"})]}),e.jsx("div",{className:"mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Gt,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Education Only"}),e.jsx("p",{className:"mt-1",children:"This tool provides lifestyle education and general wellness advice only. It does not diagnose conditions or recommend medication changes."})]})]})}),e.jsx("div",{className:"flex justify-end border-t border-gray-200 pt-4 mt-6",children:e.jsx("button",{onClick:S,disabled:t||p||d.length===0,className:"px-8 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 shadow-lg",children:t||p?e.jsxs(e.Fragment,{children:[e.jsx(kn,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:p?"Extracting Data...":"Generating Advice..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Lifestyle Advice"})]})})}),(t||p)&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("div",{className:"text-xs text-gray-600",children:p?"Extracting patient data from EMR...":"Generating personalized lifestyle advice..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-emerald-600 h-2 rounded-full animate-pulse",style:{width:"60%"}})})]})]})]})})},Rn=[{name:"background",displayName:"Background History",icon:yt},{name:"investigations",displayName:"Investigation Results",icon:lt},{name:"medications-problemlist",displayName:"Medications & Problems",icon:Xn}],Rr=({isActive:n,onComplete:t,className:s=""})=>{const[a,i]=c.useState([]),[r,o]=c.useState("Initializing..."),[l,d]=c.useState(0);c.useEffect(()=>{if(n){const b=Rn.map(P=>({...P,status:"discovering",timestamp:Date.now()}));i(b),o("Discovering EMR fields..."),d(10),m()}else i([]),o(""),d(0)},[n]);const m=async()=>{o("Locating EMR sections..."),await x("extracting",200,10,25),o("Extracting Background section..."),await g(0,"complete",300,35),o("Extracting Investigations section..."),await g(1,"complete",400,55),o("Extracting Medications section..."),await g(2,"complete",350,75),o("Validating extracted data..."),d(85),await u(600),o("Preparing data for AI analysis..."),d(95),await u(500),d(100),o("Complete! Starting AI medical review..."),setTimeout(()=>{t()},1e3)},x=async(b,P,R,j)=>{const h=(j-R)/Rn.length;for(let N=0;N<Rn.length;N++)await u(P),i(C=>C.map((E,A)=>A===N?{...E,status:b,timestamp:Date.now()}:E)),d(R+h*(N+1))},g=async(b,P,R,j)=>{await u(R),i(h=>h.map((N,C)=>C===b?{...N,status:P,timestamp:Date.now()}:N)),d(j)},u=b=>new Promise(P=>setTimeout(P,b)),v=b=>{switch(b){case"discovering":return e.jsx(lt,{className:"w-4 h-4 text-blue-500 animate-pulse"});case"extracting":return e.jsx(Ze,{className:"w-4 h-4 text-amber-500 animate-spin"});case"complete":return e.jsx(wt,{className:"w-4 h-4 text-green-500"});case"not-found":case"error":return e.jsx(Fs,{className:"w-4 h-4 text-red-500"});default:return e.jsx(lt,{className:"w-4 h-4 text-gray-400"})}},p=b=>{switch(b){case"discovering":return"Scanning...";case"extracting":return"Extracting...";case"complete":return"Complete";case"not-found":return"Not found";case"error":return"Error";default:return"Pending"}},w=b=>{switch(b){case"discovering":return"border-blue-200 bg-blue-50";case"extracting":return"border-amber-200 bg-amber-50";case"complete":return"border-green-200 bg-green-50";case"not-found":case"error":return"border-red-200 bg-red-50";default:return"border-gray-200 bg-gray-50"}};return n?e.jsx("div",{className:`absolute inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center ${s}`,role:"dialog","aria-modal":"true","aria-labelledby":"field-ingestion-title","aria-describedby":"field-ingestion-description",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 m-4 max-w-md w-full motion-safe:animate-in motion-safe:fade-in motion-safe:slide-in-from-bottom-4 motion-reduce:transition-none",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(lt,{className:"w-6 h-6 text-indigo-600"})}),e.jsx("h3",{id:"field-ingestion-title",className:"text-lg font-semibold text-gray-900 mb-2",children:"AI Medical Review"}),e.jsx("p",{id:"field-ingestion-description",className:"text-sm text-gray-600",children:"Analyzing EMR data for clinical insights"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r}),e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(l),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",role:"progressbar","aria-valuenow":l,"aria-valuemin":0,"aria-valuemax":100,children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full motion-safe:transition-all motion-safe:duration-500 motion-safe:ease-out motion-reduce:transition-none",style:{width:`${l}%`}})})]}),e.jsx("div",{className:"space-y-3",children:a.map((b,P)=>e.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg border motion-safe:transition-all motion-safe:duration-300 motion-reduce:transition-none ${w(b.status)}`,role:"status","aria-label":`${b.displayName}: ${p(b.status)}`,children:[e.jsx(b.icon,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:b.displayName}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(b.status),e.jsx("span",{className:"text-xs text-gray-600",children:p(b.status)})]})]})})]},b.name))}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Processing EMR data locally with MedGemma-27b"})})]})}):null},on=[{id:"extraction",label:"Field Extraction",description:"Discovering and extracting EMR field content",icon:lt,progressRange:[0,30]},{id:"analysis",label:"AI Analysis",description:"Processing data with MedGemma-27b model",icon:bt,progressRange:[30,90]},{id:"generation",label:"Advisory Generation",description:"Creating clinical advisory cards",icon:ni,progressRange:[90,100]}],Ir=({currentProgress:n,isActive:t,className:s="",startTime:a=Date.now(),agentType:i,transcriptionLength:r,showTimeEstimate:o=!0,onProcessingComplete:l,streaming:d=!1,tokenCount:m})=>{const[x,g]=c.useState(""),[u,v]=c.useState(new Set),[p,w]=c.useState(0),[b,P]=c.useState(null),[R]=c.useState(()=>gt.getInstance());c.useEffect(()=>{let S;return t?S=window.setInterval(()=>{w(Date.now()-a)},100):w(0),()=>{S&&clearInterval(S)}},[t,a]),c.useEffect(()=>{if(!t){g(""),v(new Set);return}const S=on.find(f=>n>=f.progressRange[0]&&n<=f.progressRange[1]);if(S){g(S.id);const f=new Set;on.forEach(T=>{T.progressRange[1]<=n&&f.add(T.id)}),v(f)}},[n,t]),c.useEffect(()=>{if(t&&i&&r&&o&&!b)try{const S=R.predictProcessingTime(i,r,{includeTranscriptionTime:!1});P(S),console.log(`üìä Time prediction for ${i}:`,S.displayText)}catch(S){console.warn("Failed to generate time prediction:",S)}else if(!t){if(b&&n>=100&&l){const S=p;if(l(S),i&&r){R.recordActualProcessingTime(i,r,S);const f=R.updatePredictionAccuracy(b,S);console.log(`üéØ Prediction accuracy: ${Math.round(f.accuracy*100)}%`)}}P(null)}},[t,i,r,o,b,n,p,l,R]);const j=S=>{const f=Math.floor(S/1e3);if(f<60)return`${f}s`;{const T=Math.floor(f/60),k=f%60;return`${T}m ${k.toString().padStart(2,"0")}s`}},h=S=>u.has(S.id)?"completed":x===S.id?"active":"pending",N=S=>{const[f,T]=S.progressRange;return n<=f?0:n>=T?100:(n-f)/(T-f)*100},C=S=>{switch(S){case"completed":return"text-green-600 bg-green-100 border-green-200";case"active":return"text-indigo-600 bg-indigo-100 border-indigo-200";default:return"text-gray-400 bg-gray-50 border-gray-200"}},E=(S,f)=>{if(f==="completed")return e.jsx(wt,{className:"w-5 h-5 text-green-600"});const T=S.icon,k=f==="active"?"w-5 h-5 text-indigo-600":"w-5 h-5 text-gray-400";return e.jsx(T,{className:k})},A=()=>{if(!b||n>=100)return{timeMs:0,isEstimate:!1};const S=(100-n)/100,f=b.estimatedDurationMs*S,T=b.estimatedDurationMs*(n/100),k=p/Math.max(T,100),M=f*k;return{timeMs:Math.max(0,M),isEstimate:!0}},O=S=>{const f=Math.ceil(S/1e3);if(f<60)return`~${f}s left`;{const T=Math.floor(f/60),k=f%60;return`~${T}m ${k}s left`}};return t?e.jsxs(W.div,{className:`bg-white rounded-lg border border-gray-200 p-4 ${s}`,role:"status","aria-labelledby":"processing-status-title","aria-describedby":"processing-status-description",initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:Bt(Ot.gentle),children:[e.jsxs(W.div,{className:"flex items-center justify-between mb-4",variants:xe(Qt),initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{id:"processing-status-title",className:"text-sm font-medium text-gray-900",children:i?i.charAt(0).toUpperCase()+i.slice(1).replace("-"," "):"AI Medical Review"}),d&&e.jsxs("span",{className:"ml-2 text-xs px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700",children:["Generating (streaming‚Ä¶)",typeof m=="number"?` ‚Ä¢ ${m}`:""]}),e.jsxs("div",{className:"flex items-center space-x-1 text-indigo-600",children:[e.jsx(tt,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-mono font-medium","aria-live":"polite",children:j(p)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[b&&o&&(()=>{const S=A();return S.isEstimate&&S.timeMs>1e3?e.jsxs("div",{className:"flex items-center space-x-1 text-purple-600",children:[e.jsx(Gn,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium","aria-live":"polite",children:O(S.timeMs)})]}):null})(),e.jsxs("span",{className:"text-xs text-gray-500","aria-live":"polite",children:[Math.round(n),"%"]})]})]}),e.jsx(W.div,{className:"mb-4",initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},transition:{delay:.2,duration:De.normal},children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Overall processing progress",children:e.jsx(W.div,{className:"bg-indigo-600 h-1.5 rounded-full",initial:{width:0},animate:{width:`${n}%`},transition:Bt(Ot.gentle)})})}),e.jsx(W.div,{className:"space-y-3",variants:xe(xn),initial:"hidden",animate:"visible",transition:{staggerChildren:Xt.tight,delayChildren:.3},children:on.map((S,f)=>{const T=h(S),k=N(S);return e.jsxs(W.div,{className:`relative flex items-start space-x-3 p-3 rounded-lg border ${C(T)}`,role:"listitem","aria-label":`${S.label}: ${T==="completed"?"Complete":T==="active"?"In progress":"Pending"}`,variants:xe(qt),animate:{scale:T==="active"?[1,1.02,1]:1,borderColor:T==="active"?["rgb(199, 210, 254)","rgb(129, 140, 248)","rgb(199, 210, 254)"]:void 0},transition:{scale:{duration:2,repeat:T==="active"?1/0:0,ease:"easeInOut"},...Bt(Ot.gentle)},children:[e.jsx(W.div,{className:"flex-shrink-0 mt-0.5",animate:{scale:T==="active"?[1,1.1,1]:1,rotate:T==="active"&&S.icon===bt?[0,5,-5,0]:0},transition:{scale:{duration:1.5,repeat:T==="active"?1/0:0,ease:"easeInOut"},rotate:{duration:2,repeat:T==="active"&&S.icon===bt?1/0:0,ease:"easeInOut"}},children:E(S,T)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900",children:S.label}),T==="active"&&e.jsxs("span",{className:"text-xs text-indigo-600 font-medium",children:[Math.round(k),"%"]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:S.description}),e.jsx(Ee,{children:T==="active"&&e.jsx(W.div,{className:"w-full bg-indigo-200 rounded-full h-1",role:"progressbar","aria-valuenow":k,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`${S.label} progress`,initial:{opacity:0,height:0},animate:{opacity:1,height:4},exit:{opacity:0,height:0},transition:{duration:De.quick},children:e.jsx(W.div,{className:"bg-indigo-600 h-1 rounded-full",initial:{width:0},animate:{width:`${k}%`},transition:{type:"spring",damping:25,stiffness:400,mass:.5}})})})]}),f<on.length-1&&e.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-4 bg-gray-200"})]},S.id)})}),e.jsx(W.div,{className:"mt-4 pt-3 border-t border-gray-200",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:De.quick},children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 text-center",children:n>=100?"‚úÖ Processing complete - clinical advisory ready":"üîÑ Local processing with MedGemma-27b model"}),b&&o&&n<100&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs",children:[e.jsx("span",{className:"text-purple-600 font-medium",children:b.displayText}),b.confidenceLevel==="high"&&e.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:"High confidence"}),b.confidenceLevel==="medium"&&e.jsx("span",{className:"px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded text-xs",children:"Medium confidence"}),b.confidenceLevel==="low"&&e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded text-xs",children:"Low confidence"})]})]})})]}):null},Mr=({phase:n,progress:t,compact:s=!1})=>{const a=Math.max(0,Math.min(100,t)),i=s?`${a}%`:`${n} ¬∑ ${a}%`;return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"session-progress-bar",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Processing progress: ${a}%`,children:e.jsx("div",{className:"session-progress-fill",style:{width:`${a}%`}})}),e.jsx("span",{className:"text-[10px] font-medium text-slate-600 tabular-nums","aria-live":"polite","aria-atomic":"true",children:i})]})},Dr={recording:{label:"Recording",badgeClass:"bg-red-50 text-red-600 border border-red-200",dotClass:"bg-red-500 border-red-200",icon:e.jsx(Qe,{className:"w-3.5 h-3.5"}),description:"Audio capture in progress"},transcribing:{label:"Transcribing",badgeClass:"bg-blue-50 text-blue-600 border border-blue-200",dotClass:"bg-blue-500 border-blue-200",icon:e.jsx(Ze,{className:"w-3.5 h-3.5 animate-spin"}),description:"Converting speech to clinical text"},processing:{label:"Processing",badgeClass:"bg-purple-50 text-purple-600 border border-purple-200",dotClass:"bg-purple-500 border-purple-200",icon:e.jsx(Us,{className:"w-3.5 h-3.5"}),description:"AI drafting the note"},needs_review:{label:"Needs Review",badgeClass:"bg-amber-50 text-amber-700 border border-amber-200",dotClass:"bg-amber-500 border-amber-200",icon:e.jsx(ii,{className:"w-3.5 h-3.5"}),description:"Ready for clinician polish"},completed:{label:"Completed",badgeClass:"bg-emerald-50 text-emerald-600 border border-emerald-200",dotClass:"bg-emerald-500 border-emerald-200",icon:e.jsx(zs,{className:"w-3.5 h-3.5"}),description:"Finalized and ready to send"},error:{label:"Attention Needed",badgeClass:"bg-rose-50 text-rose-600 border border-rose-200",dotClass:"bg-rose-500 border-rose-200",icon:e.jsx(et,{className:"w-3.5 h-3.5"}),description:"Resolve to keep queue moving"}},Or=["recording","transcribing","processing"],fs=n=>{if(!n||n<0)return"‚Äî";const t=Math.floor(n/1e3);if(t<60)return`${t}s`;const s=Math.floor(t/60),a=t%60;return a===0?`${s}m`:`${s}m ${a}s`},ha=n=>n?new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"‚Äî",_r=n=>{if(!n)return"just now";const t=Date.now()-n;if(t<0)return"just now";const s=Math.floor(t/1e3);if(s<60)return`${s}s ago`;const a=Math.floor(s/60);if(a<60)return`${a}m ago`;const i=Math.floor(a/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`},$r=n=>{const t=n.status;return t==="recording"?"recording":t==="transcribing"?"transcribing":t==="processing"?"processing":t==="error"||t==="cancelled"?"error":t==="completed"&&n.completed&&(n.reviewedAt||n.finalizedAt)?"completed":"needs_review"},Lr=n=>n.completedTime||n.processingStartTime||n.transcriptionStartTime||n.recordingStartTime||n.timestamp,Fr=n=>n.processingTime?n.processingTime:n.processingStartTime&&n.completedTime?n.completedTime-n.processingStartTime:null,zr=n=>n.recordingStartTime&&n.transcriptionStartTime?n.transcriptionStartTime-n.recordingStartTime:null,Ur=({session:n})=>{if(!n.results)return null;const t=n.results.trim();if(t.length===0)return null;const s=t.length>320?`${t.slice(0,320)}‚Ä¶`:t;return e.jsxs("div",{className:"mt-3 rounded-lg border border-slate-200 bg-slate-50/80 px-3 py-2 text-xs text-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium text-slate-700",children:[e.jsx(yt,{className:"w-3 h-3"}),e.jsx("span",{children:"Letter preview"})]}),e.jsx("p",{className:"mt-1 line-clamp-3 leading-relaxed",children:s})]})},Br=({session:n,state:t,isLast:s,isSelected:a,isNextReview:i,copiedSessionId:r,onSessionSelect:o,onResumeRecording:l,onRemoveSession:d,onMarkSessionComplete:m,onCopyResults:x})=>{const g=Dr[t],u=!!(n.results&&n.results.trim().length>0),v=r===n.id,p=zr(n),w=Fr(n),b=Lr(n),P=c.useCallback(()=>{if(t==="recording"&&l){l(n);return}o&&o(n)},[t,l,o,n]),R=()=>{m&&m(n)};return e.jsxs("div",{className:"relative pl-6",children:[!s&&e.jsx("span",{className:"absolute left-3 top-7 h-[calc(100%-1.75rem)] w-px bg-slate-200","aria-hidden":!0}),e.jsxs("div",{className:`flex items-start gap-4 rounded-lg border px-4 py-3 transition-colors ${a?"border-accent-violet/80 bg-accent-violet/[0.08] shadow-sm":i?"border-amber-200 bg-amber-50/60":"border-transparent bg-white/60 hover:border-slate-200 hover:bg-white"}`,children:[e.jsx("span",{className:`mt-1 inline-flex h-2.5 w-2.5 rounded-full border ${g.dotClass}`,"aria-hidden":!0}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-slate-800",children:n.patient?.name||"Unnamed patient"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ${g.badgeClass}`,children:[g.icon,e.jsx("span",{children:g.label})]}),t==="processing"&&n.processingProgress&&e.jsx(Mr,{phase:n.processingProgress.phase||"Processing",progress:n.processingProgress.progress,compact:!0})]}),i&&e.jsx("span",{className:"rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-amber-700",children:"Next to review"}),a&&e.jsx("span",{className:"rounded-full bg-accent-violet/10 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-accent-violet",children:"In focus"})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"}),ha(n.timestamp)]}),n.patient?.id&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ot,{className:"w-3 h-3"}),n.patient.id]}),e.jsx("span",{children:n.agentName||n.agentType}),e.jsxs("span",{children:["Updated ",_r(b)]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:P,disabled:!o&&t!=="recording",className:`inline-flex items-center gap-1 rounded-md border px-2.5 py-1 text-xs font-medium transition-colors ${t==="recording"?"border-red-200 bg-red-50 text-red-600 hover:bg-red-100":"border-slate-200 bg-white text-slate-700 hover:border-slate-300 hover:bg-slate-50"} ${!o&&t!=="recording"?"opacity-60 cursor-not-allowed":""}`,children:[t==="recording"?e.jsx(Wn,{className:"w-3 h-3"}):e.jsx(si,{className:"w-3 h-3"}),e.jsx("span",{children:t==="recording"?"Resume recording":t==="needs_review"||t==="completed"?"Open results":"View session"})]}),(t==="needs_review"||t==="completed")&&e.jsxs("button",{onClick:()=>x(n),disabled:!u,className:`inline-flex items-center gap-1 rounded-md border px-2.5 py-1 text-xs font-medium transition-colors ${u?"border-emerald-200 bg-white text-emerald-600 hover:bg-emerald-50":"border-slate-200 bg-white text-slate-400 cursor-not-allowed"}`,title:u?"Copy letter content to clipboard":"Letter not ready yet",children:[v?e.jsx(ai,{className:"w-3 h-3"}):e.jsx(Vn,{className:"w-3 h-3"}),e.jsx("span",{children:v?"Copied":"Copy letter"})]}),t==="needs_review"&&m&&e.jsxs("button",{onClick:R,className:"inline-flex items-center gap-1 rounded-md border border-slate-200 bg-white px-2.5 py-1 text-xs font-medium text-slate-600 transition-colors hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-700",children:[e.jsx(zs,{className:"w-3 h-3"}),e.jsx("span",{children:"Mark complete"})]}),e.jsxs("button",{onClick:()=>d(n.id),className:"inline-flex items-center gap-1 rounded-md border border-slate-200 bg-white px-2 py-1 text-xs font-medium text-slate-500 transition-colors hover:border-rose-300 hover:bg-rose-50 hover:text-rose-600",title:"Remove session",children:[e.jsx(vt,{className:"w-3 h-3"}),e.jsx("span",{children:"Remove"})]})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-x-6 gap-y-1 text-xs text-slate-500",children:[p!==null&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-3 h-3"}),"Dictation ",fs(p)]}),w!==null&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Us,{className:"w-3 h-3"}),"Processing ",fs(w)]}),t==="error"&&n.errors?.length?e.jsxs("span",{className:"flex items-center gap-1 text-rose-600",children:[e.jsx(et,{className:"w-3 h-3"}),n.errors[0]]}):null,t==="error"&&!n.errors?.length&&n.status==="cancelled"&&e.jsxs("span",{className:"flex items-center gap-1 text-slate-500",children:[e.jsx(Fs,{className:"w-3 h-3"}),"Session cancelled"]})]}),(t==="needs_review"||t==="completed")&&e.jsx(Ur,{session:n})]})]})]})},qr=({sessions:n,onRemoveSession:t,onClearAllSessions:s,onSessionSelect:a,onResumeRecording:i,onMarkSessionComplete:r,selectedSessionId:o,isCollapsible:l=!0})=>{const[d,m]=c.useState(null),[x,g]=c.useState(!1);c.useEffect(()=>{if(!d)return;const j=setTimeout(()=>m(null),2e3);return()=>clearTimeout(j)},[d]);const u=c.useMemo(()=>[...n].sort((j,h)=>(j.recordingStartTime||j.timestamp)-(h.recordingStartTime||h.timestamp)),[n]),v=c.useMemo(()=>u.map(j=>({session:j,state:$r(j)})),[u]),p=c.useMemo(()=>v.reduce((j,h)=>(Or.includes(h.state)&&(j.active+=1),h.state==="needs_review"&&(j.review+=1),h.state==="completed"&&(j.completed+=1),h.state==="error"&&(j.error+=1),j),{active:0,review:0,completed:0,error:0}),[v]),w=c.useMemo(()=>v.find(j=>j.state==="needs_review")||v.find(j=>j.state==="completed"),[v]),b=c.useCallback(async j=>{if(!(!j.results||j.results.trim().length===0))try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(j.results);else{const h=document.createElement("textarea");h.value=j.results,h.setAttribute("readonly",""),h.style.position="absolute",h.style.left="-9999px",document.body.appendChild(h),h.select(),document.execCommand("copy"),document.body.removeChild(h)}m(j.id)}catch(h){console.error("Failed to copy letter content:",h)}},[]);if(u.length===0)return null;const P=()=>{const j=[];return p.active>0&&j.push(`${p.active} active`),p.review>0&&j.push(`${p.review} to review`),p.completed>0&&j.push(`${p.completed} completed`),p.error>0&&j.push(`${p.error} attention`),j.join(" ‚Ä¢ ")},R=w?`${w.session.patient?.name||"Patient"} ¬∑ ${ha(w.session.timestamp)}`:"Queue is clear";return e.jsxs("div",{className:"glass rounded-xl border border-slate-200/70 bg-white/70",children:[e.jsxs("button",{type:"button",className:`flex w-full items-center justify-between border-b border-slate-200 px-4 py-3 text-left transition-colors ${l?"hover:bg-white":"cursor-default"}`,onClick:()=>{l&&g(j=>!j)},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800",children:"Session timeline"}),e.jsx("span",{className:"text-xs text-slate-500",children:P()||`${u.length} session${u.length===1?"":"s"}`})]}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Next focus: ",R]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j=>{j.stopPropagation(),s()},className:"inline-flex items-center gap-1 rounded-md border border-slate-200 bg-white px-2 py-1 text-xs font-medium text-slate-500 transition-colors hover:border-rose-300 hover:bg-rose-50 hover:text-rose-600",children:[e.jsx(vt,{className:"w-3 h-3"}),e.jsx("span",{children:"Clear all"})]}),l&&e.jsx("span",{className:"text-xs font-medium text-slate-500",children:x?"Show":"Hide"})]})]}),!x&&e.jsx("div",{className:"max-h-[28rem] space-y-3 overflow-y-auto px-2 py-4",children:v.map(({session:j,state:h},N)=>e.jsx(Br,{session:j,state:h,isLast:N===v.length-1,isSelected:o===j.id,isNextReview:w?.session.id===j.id,copiedSessionId:d,onSessionSelect:a,onResumeRecording:i,onRemoveSession:t,onMarkSessionComplete:r,onCopyResults:b},j.id))})]})},xa=[{id:"tavi",title:"TAVI Procedure Recording",description:"Transcatheter Aortic Valve Implantation - Comprehensive procedural documentation",estimatedTime:"8-12 minutes",sections:[{title:"Preamble Information",icon:"üìã",items:["Patient demographics and clinical indication",'Preoperative CT findings: "suitable anatomy for valve implant"',"Valve morphology: tricuspid/bicuspid, calcification burden","Calcium score and LVOT assessment","Transthoracic echo: mean gradient, systolic function","Valve selection rationale with sizing logic"]},{title:"Procedural Details",icon:"‚öïÔ∏è",items:["Anaesthesia approach: local anaesthesia and deep sedation","Vascular access: radial planning, femoral with ultrasound guidance","Pre-closure technique: ProStyle sutures or equivalent","Sheath sizes: specific French sizes (e.g., 16F Cook sheath)","Valve crossing: AL1, straight wire, invasive gradient, LVEDP","Lunderquist wire placement at left ventricular apex","Pre-dilation: balloon size and technique","Valve deployment: positioning at annular plane","Immediate assessment: aortic regurgitation, coronary patency"]},{title:"Outcomes & Assessment",icon:"‚úÖ",items:["Valve deployment success and positioning","Final aortic regurgitation grade","Post-procedural echo findings","Arteriotomy closure method and success","Overall procedural success statement","Immediate post-procedural valve performance"]}],tips:["Use Australian spelling: anaesthesia, recognised, utilised","Include precise measurements with units (mmHg, cm¬≤, French sizes)","Preserve original stenosis terminology (mild/moderate/severe)","Document valve manufacturer and model specifically"],terminology:["Edwards Sapien 3 Ultra/Medtronic Evolut series","Annular perimeter and area, LVOT calcium burden","Well-seated valve, patent coronaries","Partial recaptures for optimal positioning"]},{id:"angiogram-pci",title:"Angiogram/PCI Recording",description:"Cardiac catheterization and coronary interventions - Diagnostic and interventional procedures",estimatedTime:"8-15 minutes",sections:[{title:"Vessel Assessment",icon:"ü´Ä",items:["Left Main coronary artery findings","LAD: proximal, mid, distal segments and diagonal branches","Circumflex: segments and obtuse marginal branches","RCA: segments including dominance pattern","Coronary dominance (right/left/co-dominant)","Collateral circulation if present"]},{title:"Procedural Information",icon:"üîß",items:["Vascular access site and approach","Catheter selection and sizes","Target lesion characteristics and location","Intervention strategy and rationale","Device specifications: stent type, manufacturer, size","Balloon pre-dilation details","Deployment technique and positioning"]},{title:"Results & Outcomes",icon:"üìä",items:["TIMI flow assessment (pre and post)","Final angiographic result","Residual stenosis percentage","Procedural complications if any","Hemodynamic measurements","Antiplatelet therapy plan"]}],tips:["Preserve stenosis grading as stated by clinician","Use descriptive TIMI flow language","Include specific device details when mentioned","Document both diagnostic and intervention aspects"],terminology:["Drug-eluting stent (DES), bare metal stent (BMS)","TIMI III flow, complete perfusion","Proximal/mid/distal vessel segments","Optimal angiographic result"]},{id:"quick-letter",title:"Quick Letter Recording",description:"Medical correspondence and consultation letters - Professional communication",estimatedTime:"1-3 minutes",sections:[{title:"Patient Presentation",icon:"üë§",items:["Clinical presentation and chief complaint","Relevant history and context","Current symptoms and functional status","Reason for referral or consultation","Timeline of events"]},{title:"Clinical Assessment",icon:"üîç",items:["Investigation findings and interpretation","Clinical examination relevant findings","Diagnostic considerations","Risk stratification if applicable"]},{title:"Management Plan",icon:"üìù",items:["Treatment recommendations","Medication changes or additions","Follow-up arrangements","Specialist referrals if needed","Patient education provided"]}],tips:['Use first-person voice: "I reviewed", "I examined"',"Keep paragraphs flowing and professional","Include specific timeframes and measurements","Use Australian spelling and medical terminology"],terminology:["Clinical assessment, management plan","Follow-up arrangements, specialist review","Patient education, shared decision-making","Routine/semi-urgent/urgent referral"]},{id:"tavi-workup",title:"TAVI Workup Dictation",description:"Single-pass dictation covering the clinical, echocardiographic, and CT sizing inputs for TAVI planning",estimatedTime:"3-5 minutes",sections:[{title:"Patient Basics",icon:"üßç",items:["State the patient name and date of birth clearly","Latest height in centimetres and weight in kilograms","Note any symptomatic change prompting assessment"]},{title:"Risk Profile",icon:"‚öïÔ∏è",items:["Indication for TAVI workup","NYHA functional class (I-IV only)","STS and EuroSCORE II percentages"]},{title:"Echocardiography Highlights",icon:"ü©ª",items:["Echo study date and ejection fraction","Septal thickness and mean pressure gradient","Aortic valve area, dimensionless index, MR grade, RVSP","Key qualitative comments"]},{title:"CT Sizing",icon:"üß†",items:["Annulus area, perimeter, minimum and maximum diameters","Left main and right coronary heights","Sinus of Valsalva diameters for each cusp",'Coplanar acquisition angles (e.g., "LAO 12 cranial 6")',"Access vessel minimal diameters (CIA, EIA, CFA) with laterality"]},{title:"Device Planning",icon:"üõ†Ô∏è",items:["Intended valve platform (Sapien, Evolut, Navitor)","Planned valve size and rationale","Any anatomical cautions (coronary height, annular calcification, access limitations)"]}],tips:['Say "percent" after risk scores to avoid misinterpretation',"Use centimetres when dictating distances so the system can convert to millimetres","Work systematically: patient basics -> risk -> echo -> CT -> access/device"],terminology:["Annulus area/perimeter","Dimensionless index (DVI)","Sinus of Valsalva","Common/external iliac, common femoral","Coplanar LAO/RAO cranial/caudal angles"]},{id:"consultation",title:"Consultation Recording",description:"Comprehensive patient assessments - Detailed clinical evaluation",estimatedTime:"2-4 minutes",sections:[{title:"Clinical History",icon:"üìö",items:["Presenting complaint and history","Past medical history and comorbidities","Current medications and allergies","Family history if relevant","Social history and functional status"]},{title:"Examination & Investigations",icon:"üî¨",items:["Physical examination findings","Vital signs and measurements","Investigation results and interpretation","Imaging findings if applicable","Laboratory results correlation"]},{title:"Assessment & Plan",icon:"üéØ",items:["Clinical impression and differential diagnosis","Risk assessment and stratification","Management strategy and rationale","Investigation plan if needed","Follow-up and monitoring plan"]}],tips:["Capture comprehensive clinical reasoning","Include functional assessment (NYHA class, etc.)","Document shared decision-making process","Note patient understanding and concerns"],terminology:["Clinical impression, differential diagnosis","Risk stratification, management strategy","Functional class, symptom assessment","Patient-centred care, shared decisions"]},{id:"mteer",title:"mTEER Procedure Recording",description:"Mitral transcatheter edge-to-edge repair - Structural heart intervention",estimatedTime:"7-10 minutes",sections:[{title:"Pre-procedural Assessment",icon:"üîç",items:["Mitral regurgitation severity and mechanism","Valve anatomy and morphology","TOE assessment and measurements","Procedural planning and approach","Patient selection criteria"]},{title:"Procedural Technique",icon:"‚öôÔ∏è",items:["Transseptal puncture technique","Device delivery and positioning","Clip deployment and assessment","TOE guidance throughout procedure","Immediate haemodynamic changes"]},{title:"Results & Follow-up",icon:"üìà",items:["Final mitral regurgitation grade","Mitral valve gradient assessment","Procedural success metrics","Complications if any","Post-procedural monitoring plan including TTE next day"]}],tips:["Document TOE guidance detail","Include specific device information","Note immediate haemodynamic improvement","Record precise regurgitation grading"],terminology:["Edge-to-edge repair, MitraClip device","Functional vs degenerative MR","TOE guidance, transseptal puncture","Immediate haemodynamic improvement"]},{id:"pfo-closure",title:"PFO Closure Recording",description:"Patent foramen ovale closure - Structural heart intervention",estimatedTime:"5-8 minutes",sections:[{title:"Pre-procedural Assessment",icon:"üîé",items:["PFO anatomy and tunnel length","Shunt assessment and grading","Device selection rationale","Imaging findings (TOE/ICE)","Clinical indication for closure"]},{title:"Deployment Technique",icon:"üéØ",items:["Device delivery and positioning","Deployment sequence and technique","Position confirmation","Immediate closure assessment","Device stability evaluation"]},{title:"Procedural Outcome",icon:"‚ú®",items:["Successful device deployment","Residual shunt assessment","Device position and stability","Procedural complications if any","Post-procedural monitoring requirements"]}],tips:["Document device sizing rationale","Include immediate closure success","Note any residual shunt","Record device stability assessment"],terminology:["Patent foramen ovale, atrial septal anatomy","Device deployment, positioning confirmation","Residual shunt, complete closure","TOE/ICE guidance, device stability"]},{id:"right-heart-cath",title:"Right Heart Catheterisation",description:"Right heart catheterisation with haemodynamic assessment",estimatedTime:"6-10 minutes",sections:[{title:"Haemodynamic Assessment",icon:"üìä",items:["Right atrial pressure measurements","Right ventricular pressures","Pulmonary artery pressures","Pulmonary capillary wedge pressure","Cardiac output and index","Pulmonary vascular resistance","TPG, RVSWI"]},{title:"Technical Details",icon:"üîß",items:["Vascular access approach","Catheter selection and positioning","Measurement technique and validation","Thermodilution or Fick method","Complications if any"]},{title:"Clinical Interpretation",icon:"üìã",items:["Haemodynamic interpretation","Pulmonary hypertension assessment","Heart failure classification","Treatment implications","Follow-up recommendations"]}],tips:["Include precise pressure measurements","Document calculation methods used","Note any technical challenges","Correlate with clinical presentation"],terminology:["Pulmonary vascular resistance, cardiac index","Thermodilution, Fick equation","Pulmonary hypertension, right heart failure","Haemodynamic profile, pressure gradients"]},{id:"investigation-summary",title:"Investigation Summary Recording",description:"Formatting voice-dictated investigation results into structured summaries",estimatedTime:"30-60 seconds",sections:[{title:"Test Information",icon:"üî¨",items:["Investigation type (TTE, CTCA, Bloods, etc.)","Date of investigation (DD MMM YYYY format)","Location/institution if relevant","Test methodology or approach if specified"]},{title:"Key Findings",icon:"üìã",items:["Primary findings and measurements","Normal and abnormal values with units","Qualitative descriptions (mild/moderate/severe)","Relevant anatomical observations","Clinical significance if stated"]},{title:"Measurements & Values",icon:"üìè",items:["Exact numerical values with units","Reference ranges when mentioned","Percentage values (e.g., EF 55%)","Pressure measurements (mmHg)","Laboratory values with proper abbreviations"]}],tips:["Use standard medical abbreviations (TChol, LDL, HDL, etc.)","Include units with all measurements","Preserve qualitative terms exactly as stated","Format as: TEST (date): comma-separated findings"],terminology:["TTE, TOE, CTCA, CMRI, RHC, Bloods","TChol, TG, HDL, LDL, HbA1c, Cr, eGFR","EF%, MPG, PPG, RVSP, TIMI flow","Normal, mild, moderate, severe"]},{id:"background",title:"Background & History Recording",description:"Patient medical background, history, and contextual information",estimatedTime:"1-2 minutes",sections:[{title:"Medical History",icon:"üè•",items:["Past medical conditions and diagnoses","Previous cardiovascular events or procedures","Chronic conditions and comorbidities","Surgical history relevant to current care","Hospital admissions and major events"]},{title:"Family & Social History",icon:"üë•",items:["Family history of cardiovascular disease","Hereditary conditions or risk factors","Social circumstances affecting care","Functional status and mobility","Support systems and care arrangements"]},{title:"Risk Factors",icon:"‚ö†Ô∏è",items:["Smoking history (current/former/never)","Alcohol consumption patterns","Exercise tolerance and activity levels","Occupational or environmental exposures","Lifestyle factors affecting health"]}],tips:["Use chronological order for medical events","Include dates and timeframes when mentioned","Note functional impact of conditions","Use arrow notation (‚Üí) for progression or outcomes"],terminology:["CAD, MI, CABG, PCI, valve disease","DM, HTN, dyslipidaemia, CKD","NYHA class, functional capacity","Family Hx, social circumstances"]},{id:"medication",title:"Medication Recording",description:"Current medications, changes, and pharmaceutical management",estimatedTime:"1-2 minutes",sections:[{title:"Current Medications",icon:"üíä",items:["Drug name (generic preferred)","Dosage and strength","Frequency and timing","Route of administration","Duration of therapy if specified"]},{title:"Recent Changes",icon:"üîÑ",items:["New medications started","Dose adjustments made","Medications discontinued","Reason for changes","Timing of modifications"]},{title:"Compliance & Effects",icon:"‚úÖ",items:["Adherence to current regimen","Side effects experienced","Therapeutic response noted","Patient understanding and concerns","Monitoring requirements"]}],tips:["Use generic drug names when possible","Include exact dosages with units (mg, mcg)","Note timing (morning, evening, with meals)","Document reasons for any changes"],terminology:["ACE inhibitor, ARB, beta-blocker, statin","BD, TDS, QID, PRN, with meals","mg, mcg, g, units, mL","Commenced, ceased, increased, decreased"]}];function Hr(n){return xa.find(t=>t.id===n)}function Vr(n){return xa.some(t=>t.id===n)}const Wr=ue.memo(({agentType:n,isVisible:t,onClose:s,onStartRecording:a,compactMode:i=!1})=>{const[r,o]=c.useState({}),l=Hr(n);Math.random()<.001&&console.log("üìã Recording prompt shown for:",n);const d=c.useCallback(x=>{o(g=>({...g,[x]:!g[x]}))},[]);if(c.useCallback(()=>{a?.(),s?.()},[a,s]),!t||!l)return null;const m=(x,g)=>{const u=r[x.title]??(i?!1:g===0);return e.jsxs("div",{className:`border border-gray-200 rounded-lg overflow-hidden ${i?"mb-2":"mb-3"}`,children:[e.jsxs("button",{onClick:()=>d(x.title),className:`w-full bg-gray-50 hover:bg-gray-100 flex items-center justify-between text-left transition-colors ${i?"px-3 py-2":"px-4 py-3"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:i?"text-sm":"text-lg",children:x.icon}),e.jsx("span",{className:`font-semibold text-gray-800 ${i?"text-xs":"text-sm"}`,children:x.title})]}),u?e.jsx(at,{className:`text-gray-500 ${i?"w-3 h-3":"w-4 h-4"}`}):e.jsx(_n,{className:`text-gray-500 ${i?"w-3 h-3":"w-4 h-4"}`})]}),u&&e.jsx("div",{className:`bg-white ${i?"px-3 py-2":"px-4 py-3"}`,children:e.jsx("ul",{className:i?"space-y-1":"space-y-2",children:x.items.map((v,p)=>e.jsxs("li",{className:`flex items-start space-x-2 text-gray-700 ${i?"text-xs":"text-sm"}`,children:[e.jsx("div",{className:`bg-blue-500 rounded-full mt-2 flex-shrink-0 ${i?"w-1 h-1":"w-1.5 h-1.5"}`}),e.jsx("span",{children:v})]},p))})})]},x.title)};return e.jsx("div",{className:`w-full bg-white border border-gray-200 ${i?"rounded-lg shadow-md":"max-w-none mx-2 rounded-xl shadow-lg mb-4"}`,children:e.jsxs("div",{className:`bg-white w-full overflow-hidden ${i?"rounded-lg max-h-[40vh]":"rounded-xl max-h-[70vh]"}`,children:[e.jsx("div",{className:`bg-gradient-to-r from-red-600 to-red-700 text-white ${i?"px-3 py-2":"px-4 py-3"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[!i&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-300 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-semibold",children:"RECORDING"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{className:i?"w-3 h-3":"w-4 h-4"}),e.jsx("span",{className:`font-medium ${i?"text-xs":"text-sm"}`,children:i?l.title.replace(" Recording",""):`Recording Guide: ${l.title.replace(" Recording","")}`})]})]})}),e.jsxs("div",{className:`overflow-y-auto ${i?"p-3 max-h-[35vh]":"p-4 max-h-[60vh]"}`,children:[!i&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ri,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:"Include these key elements while recording to ensure a comprehensive medical report:"})})]})}),e.jsxs("div",{className:i?"mb-3":"mb-6",children:[!i&&e.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center space-x-2",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{children:"What to Include"})]}),l.sections.map(m)]}),l.tips.length>0&&e.jsxs("div",{className:i?"mb-3":"mb-6",children:[e.jsxs("h3",{className:`font-semibold text-gray-800 ${i?"mb-2 text-sm":"mb-3"}`,children:["üí° ",i?"Tips":"Recording Tips"]}),e.jsx("div",{className:`bg-yellow-50 border border-yellow-200 rounded-lg ${i?"p-2":"p-4"}`,children:e.jsx("ul",{className:i?"space-y-1":"space-y-2",children:l.tips.map((x,g)=>e.jsxs("li",{className:`flex items-start space-x-2 text-yellow-800 ${i?"text-xs":"text-sm"}`,children:[e.jsx("div",{className:`bg-yellow-500 rounded-full mt-2 flex-shrink-0 ${i?"w-1 h-1":"w-1.5 h-1.5"}`}),e.jsx("span",{children:x})]},g))})})]}),l.terminology.length>0&&e.jsxs("div",{className:i?"mb-2":"mb-6",children:[e.jsxs("h3",{className:`font-semibold text-gray-800 ${i?"mb-2 text-sm":"mb-3"}`,children:["üìö ",i?"Terms":"Key Terminology"]}),e.jsx("div",{className:`bg-green-50 border border-green-200 rounded-lg ${i?"p-2":"p-4"}`,children:e.jsx("div",{className:`grid gap-2 ${i?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:l.terminology.map((x,g)=>e.jsxs("div",{className:`flex items-center space-x-2 text-green-800 ${i?"text-xs":"text-sm"}`,children:[e.jsx("div",{className:`bg-green-500 rounded-full flex-shrink-0 ${i?"w-1 h-1":"w-1.5 h-1.5"}`}),e.jsx("span",{className:"font-medium",children:x})]},g))})})]})]})]})})}),Gr=({isOpen:n,onClose:t})=>{const[s,a]=c.useState(null),[i,r]=c.useState([]),[o,l]=c.useState(!0);c.useEffect(()=>{n&&d()},[n]);const d=async()=>{l(!0);try{const p=mn.getInstance(),[w,b]=await Promise.all([p.getAnalytics(),p.getAllMetrics()]);a(w),r(b.slice(0,10))}catch(p){console.error("Failed to load metrics:",p)}finally{l(!1)}},m=async()=>{confirm("Are you sure you want to clear all performance metrics? This cannot be undone.")&&(await mn.getInstance().clearAllMetrics(),await d())},x=async()=>{try{const w=await mn.getInstance().exportMetrics(),b=new Blob([w],{type:"application/json"}),P=URL.createObjectURL(b),R=document.createElement("a");R.href=P,R.download=`xestro-metrics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(P)}catch(p){console.error("Failed to export metrics:",p)}},g=p=>{if(p<1e3)return`${p}ms`;if(p<6e4)return`${(p/1e3).toFixed(1)}s`;const w=Math.floor(p/6e4),b=Math.floor(p%6e4/1e3);return`${w}m ${b}s`},u=p=>({tavi:"‚ù§Ô∏è","angiogram-pci":"ü´Ä",mteer:"üîß",tteer:"ü´Ä","pfo-closure":"üè•","asd-closure":"üè•","pvl-plug":"üîå","bypass-graft":"üõ§Ô∏è","right-heart-cath":"üìä","tavi-workup":"üîç","quick-letter":"üìù",consultation:"üë®‚Äç‚öïÔ∏è","investigation-summary":"üîç","ai-medical-review":"üõ°Ô∏è","batch-ai-review":"üìã","patient-education":"üéì",background:"üìã",medication:"üíä",bloods:"ü©∏",imaging:"üì∑","ohif-viewer":"ü©ª","aus-medical-review":"üá¶üá∫",enhancement:"‚ú®",transcription:"üé§",generation:"ü§ñ"})[p]||"ü§ñ",v=p=>p>0?"text-green-600":p<0?"text-red-600":"text-gray-600";return n?e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl max-h-[90vh] overflow-hidden w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(gn,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Performance Analytics"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Historical recording metrics and trends"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:x,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Export Metrics",children:e.jsx(Vt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:d,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:e.jsx(Yt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Clear All Metrics",children:e.jsx(vt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:t,className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Close",children:e.jsx(Le,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})}):s&&s.totalRecordings>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(oi,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Total Recordings"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:s.totalRecordings})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ht,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Avg Transcription"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:g(s.averageTranscriptionTime)})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(bt,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-800",children:"Avg Processing"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:g(s.averageProcessingTime)})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(tt,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Avg Total"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:g(s.averageTotalDuration)})]})]}),s.recentTrend.last25Avg>0&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.recentTrend.improvementPercent>0?e.jsx(Gn,{className:"w-4 h-4 text-green-600"}):s.recentTrend.improvementPercent<0?e.jsx(li,{className:"w-4 h-4 text-red-600"}):e.jsx(Ht,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-800",children:"Performance Trend"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Last 10 Average"}),e.jsx("div",{className:"font-semibold",children:g(s.recentTrend.last10Avg)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Last 25 Average"}),e.jsx("div",{className:"font-semibold",children:g(s.recentTrend.last25Avg)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Improvement"}),e.jsxs("div",{className:`font-semibold ${v(s.recentTrend.improvementPercent)}`,children:[s.recentTrend.improvementPercent>0?"+":"",s.recentTrend.improvementPercent,"%"]})]})]})]}),Object.keys(s.agentTypeBreakdown).length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Agent Performance Breakdown"}),e.jsx("div",{className:"space-y-3",children:Object.entries(s.agentTypeBreakdown).map(([p,w])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-xl",children:u(p)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 capitalize",children:p.replace("-"," ")}),e.jsxs("div",{className:"text-sm text-gray-600",children:[w.count," recordings"]})]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("div",{className:"font-medium",children:g(w.avgTotal)}),e.jsxs("div",{className:"text-gray-600",children:[g(w.avgTranscription)," + ",g(w.avgProcessing)]})]})]},p))})]}),i.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Recordings"}),e.jsx("div",{className:"space-y-2",children:i.map((p,w)=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm",children:u(p.agentType)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 capitalize",children:p.agentType.replace("-"," ")}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(p.timestamp).toLocaleString()})]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("div",{className:"font-medium",children:g(p.totalDuration)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[g(p.transcriptionTime)," + ",g(p.processingTime)]})]})]},p.sessionId))})]}),Object.keys(s.modelPerformance).length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Model Performance"}),e.jsx("div",{className:"space-y-2",children:Object.entries(s.modelPerformance).map(([p,w])=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("div",{className:"font-medium",children:g(w.avgTime)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[w.count," recordings"]})]})]},p))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(gn,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Metrics Available"}),e.jsx("p",{className:"text-gray-600",children:"Start recording to see performance analytics appear here."})]})})]})}):null},Xr=({isRecording:n,voiceActivityLevel:t,frequencyData:s,audioLevelHistory:a,recordingTime:i,activeDeviceInfo:r,onStop:o,className:l=""})=>{const[d,m]=ue.useState({status:"idle",color:"gray",message:"Not recording"}),[x,g]=ue.useState(!1),u=ue.useRef();ue.useEffect(()=>{n&&!r?.isWorking&&Math.random()<.01&&console.warn("‚ö†Ô∏è Audio device may not be working properly")},[n,r]);const v=a.slice(-10).some(j=>j>.05),p=()=>n?a.length<5?{status:"initializing",color:"blue",message:"Initializing..."}:v?{status:"active",color:"green",message:"Audio detected"}:t>.01?{status:"low",color:"yellow",message:"Low audio"}:{status:"silent",color:"red",message:"No audio detected"}:{status:"idle",color:"gray",message:"Not recording"};ue.useEffect(()=>{const j=p();if(u.current&&clearTimeout(u.current),j.status==="active"||j.status==="initializing"){m(j),g(!1);return}return j.status==="silent"||j.status==="low"?u.current=setTimeout(()=>{m(j),j.status==="silent"&&a.length>50&&g(!0)},2500):(m(j),g(!1)),()=>{u.current&&clearTimeout(u.current)}},[n,v,t,a.length]);const w=d,b=j=>{const h=Math.floor(j/60),N=j%60;return`${h}:${N.toString().padStart(2,"0")}`},R=(j=>j.length===0?[]:[...[...j].reverse(),...j])(s);return e.jsxs(W.div,{className:`flex-1 flex flex-col items-center justify-center p-4 space-y-4 ${l}`,variants:xe(mt),initial:"hidden",animate:"visible",children:[e.jsxs(W.div,{className:"text-center space-y-1",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,type:"spring",damping:20,stiffness:300},children:[e.jsx(W.h3,{className:"text-base font-semibold text-gray-900",animate:{color:n?"#3b82f6":"#1f2937"},transition:{duration:300},children:n?"Recording in progress":"Ready to record"}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-600",children:[e.jsx(W.div,{className:"w-2 h-2 rounded-full",style:{backgroundColor:w.color==="green"?"#10b981":w.color==="yellow"?"#f59e0b":w.color==="red"?"#ef4444":w.color==="blue"?"#3b82f6":"#9ca3af"},animate:{scale:w.status==="active"?[1,1.3,1]:1},transition:{duration:2,repeat:w.status==="active"?1/0:0,ease:"easeInOut"}}),e.jsx(W.span,{animate:{color:w.status==="active"?"#10b981":"#6b7280"},transition:{duration:300},children:w.message})]}),e.jsx(Ee,{children:r&&e.jsx(W.div,{className:"text-xs text-gray-500 truncate max-w-xs",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:20,stiffness:300},children:r.label})}),e.jsx(Ee,{children:n&&e.jsx(W.div,{className:"text-lg font-mono font-semibold text-gray-900 bg-gray-100 rounded-full px-3 py-1",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},transition:{type:"spring",damping:20,stiffness:300},children:b(i)})})]}),e.jsx(Ee,{children:n&&e.jsxs(W.div,{className:"w-full max-w-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:20,stiffness:300,delay:.1},children:[e.jsx(W.div,{className:"text-sm text-ink-secondary text-center mb-4 font-medium",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"Live Audio Spectrum"}),e.jsx("div",{className:"h-40 bg-gray-100 rounded-3xl border border-gray-200 flex items-center justify-center px-6 overflow-hidden shadow-sm",children:R.length>0?e.jsx("div",{className:"flex items-end justify-center gap-0.5 h-full w-full px-2",children:R.map((j,h)=>{const N=Math.floor(R.length/2),C=Math.abs(h-N),E=Math.pow(j*3,.6),A=Math.max(E*90,8),O=S=>S>.3?"#10b981":S>.2?"#059669":S>.15?"#3b82f6":S>.1?"#6366f1":S>.05?"#f59e0b":S>.02?"#9ca3af":"#d1d5db";return e.jsx(W.div,{className:"flex-1 min-w-[2px] max-w-[4px] rounded-full",style:{backgroundColor:O(E),height:`${Math.min(A,95)}%`,minHeight:"8px"},initial:{height:"8px"},animate:{height:`${Math.min(A,95)}%`},transition:{type:"spring",damping:20,stiffness:400,mass:.2,delay:C*.003}},h)})}):e.jsxs("div",{className:"flex items-center space-x-4 text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W.div,{className:"w-4 h-4 bg-blue-400 rounded-full",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(W.div,{className:"w-4 h-4 bg-blue-500 rounded-full",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.2}}),e.jsx(W.div,{className:"w-4 h-4 bg-blue-600 rounded-full",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.4}})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Waiting for audio..."}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Speak into your microphone to see the waveform"})]})]})}),e.jsxs(W.div,{className:"mt-4 flex items-center justify-between text-sm bg-gray-50 rounded-2xl px-4 py-3 border border-gray-200",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Audio Level:"}),e.jsxs(W.span,{className:"font-bold text-lg",animate:{color:t>.3?"#10b981":t>.1?"#3b82f6":"#6b7280",scale:t>.5?1.1:1},transition:{type:"spring",damping:25,stiffness:300},children:[Math.round(t*100),"%"]})]})]})}),e.jsx(Ee,{children:n&&e.jsxs(W.button,{onClick:o,className:"flex items-center space-x-2 bg-gray-900 hover:bg-gray-800 text-white px-6 py-3 rounded-full shadow-sm",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},whileHover:{scale:1.05,y:-2,boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)"},whileTap:{scale:.95},transition:{type:"spring",damping:20,stiffness:300,delay:.4},children:[e.jsx(ci,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Stop recording"})]})}),e.jsxs("div",{className:"w-full max-w-sm min-h-[60px] flex items-center justify-center",children:[n&&x&&e.jsxs("div",{className:"w-full bg-gray-50 border border-gray-200 rounded-2xl p-3 transition-all duration-300",children:[e.jsxs("div",{className:"text-xs text-gray-900 font-medium mb-1 flex items-center space-x-1",children:[e.jsx("div",{className:"w-1 h-1 rounded-full transition-colors duration-300",style:{backgroundColor:w.color==="red"?"#ef4444":"#f59e0b"}}),e.jsx("span",{children:w.message})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["‚Ä¢ Check if microphone is muted",e.jsx("br",{}),"‚Ä¢ Ensure device is connected",e.jsx("br",{}),"‚Ä¢ Try speaking louder",e.jsx("br",{}),"‚Ä¢ Switch microphones if available"]})]}),n&&!x&&e.jsx("div",{className:"text-xs text-gray-500 text-center opacity-60",children:"Audio monitoring active"})]})]})};var fa={exports:{}},Qr="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Jr=Qr,Yr=Jr;function ba(){}function va(){}va.resetWarningCache=ba;var Kr=function(){function n(a,i,r,o,l,d){if(d!==Yr){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}}n.isRequired=n;function t(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:t,element:n,elementType:n,instanceOf:t,node:n,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:va,resetWarningCache:ba};return s.PropTypes=s,s};fa.exports=Kr();var Zr=fa.exports;const ge=pi(Zr);function jt(n,t,s,a){function i(r){return r instanceof s?r:new s(function(o){o(r)})}return new(s||(s=Promise))(function(r,o){function l(x){try{m(a.next(x))}catch(g){o(g)}}function d(x){try{m(a.throw(x))}catch(g){o(g)}}function m(x){x.done?r(x.value):i(x.value).then(l,d)}m((a=a.apply(n,t||[])).next())})}const eo=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function $t(n,t,s){const a=to(n),{webkitRelativePath:i}=n,r=typeof t=="string"?t:typeof i=="string"&&i.length>0?i:`./${n.name}`;return typeof a.path!="string"&&bs(a,"path",r),bs(a,"relativePath",r),a}function to(n){const{name:t}=n;if(t&&t.lastIndexOf(".")!==-1&&!n.type){const a=t.split(".").pop().toLowerCase(),i=eo.get(a);i&&Object.defineProperty(n,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return n}function bs(n,t,s){Object.defineProperty(n,t,{value:s,writable:!1,configurable:!1,enumerable:!0})}const no=[".DS_Store","Thumbs.db"];function so(n){return jt(this,void 0,void 0,function*(){return vn(n)&&ao(n.dataTransfer)?lo(n.dataTransfer,n.type):io(n)?ro(n):Array.isArray(n)&&n.every(t=>"getFile"in t&&typeof t.getFile=="function")?oo(n):[]})}function ao(n){return vn(n)}function io(n){return vn(n)&&vn(n.target)}function vn(n){return typeof n=="object"&&n!==null}function ro(n){return Fn(n.target.files).map(t=>$t(t))}function oo(n){return jt(this,void 0,void 0,function*(){return(yield Promise.all(n.map(s=>s.getFile()))).map(s=>$t(s))})}function lo(n,t){return jt(this,void 0,void 0,function*(){if(n.items){const s=Fn(n.items).filter(i=>i.kind==="file");if(t!=="drop")return s;const a=yield Promise.all(s.map(co));return vs(ya(a))}return vs(Fn(n.files).map(s=>$t(s)))})}function vs(n){return n.filter(t=>no.indexOf(t.name)===-1)}function Fn(n){if(n===null)return[];const t=[];for(let s=0;s<n.length;s++){const a=n[s];t.push(a)}return t}function co(n){if(typeof n.webkitGetAsEntry!="function")return ys(n);const t=n.webkitGetAsEntry();return t&&t.isDirectory?wa(t):ys(n,t)}function ya(n){return n.reduce((t,s)=>[...t,...Array.isArray(s)?ya(s):[s]],[])}function ys(n,t){return jt(this,void 0,void 0,function*(){var s;if(globalThis.isSecureContext&&typeof n.getAsFileSystemHandle=="function"){const r=yield n.getAsFileSystemHandle();if(r===null)throw new Error(`${n} is not a File`);if(r!==void 0){const o=yield r.getFile();return o.handle=r,$t(o)}}const a=n.getAsFile();if(!a)throw new Error(`${n} is not a File`);return $t(a,(s=t?.fullPath)!==null&&s!==void 0?s:void 0)})}function mo(n){return jt(this,void 0,void 0,function*(){return n.isDirectory?wa(n):uo(n)})}function wa(n){const t=n.createReader();return new Promise((s,a)=>{const i=[];function r(){t.readEntries(o=>jt(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(mo));i.push(l),r()}else try{const l=yield Promise.all(i);s(l)}catch(l){a(l)}}),o=>{a(o)})}r()})}function uo(n){return jt(this,void 0,void 0,function*(){return new Promise((t,s)=>{n.file(a=>{const i=$t(a,n.fullPath);t(i)},a=>{s(a)})})})}var In=function(n,t){if(n&&t){var s=Array.isArray(t)?t:t.split(",");if(s.length===0)return!0;var a=n.name||"",i=(n.type||"").toLowerCase(),r=i.replace(/\/.*$/,"");return s.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?a.toLowerCase().endsWith(l):l.endsWith("/*")?r===l.replace(/\/.*$/,""):i===l})}return!0};function ws(n){return ho(n)||go(n)||Na(n)||po()}function po(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function go(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ho(n){if(Array.isArray(n))return zn(n)}function js(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function Ns(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?js(Object(s),!0).forEach(function(a){ja(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):js(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}function ja(n,t,s){return t in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function Jt(n,t){return bo(n)||fo(n,t)||Na(n,t)||xo()}function xo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Na(n,t){if(n){if(typeof n=="string")return zn(n,t);var s=Object.prototype.toString.call(n).slice(8,-1);if(s==="Object"&&n.constructor&&(s=n.constructor.name),s==="Map"||s==="Set")return Array.from(n);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return zn(n,t)}}function zn(n,t){(t==null||t>n.length)&&(t=n.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=n[s];return a}function fo(n,t){var s=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(s!=null){var a=[],i=!0,r=!1,o,l;try{for(s=s.call(n);!(i=(o=s.next()).done)&&(a.push(o.value),!(t&&a.length===t));i=!0);}catch(d){r=!0,l=d}finally{try{!i&&s.return!=null&&s.return()}finally{if(r)throw l}}return a}}function bo(n){if(Array.isArray(n))return n}var vo=typeof In=="function"?In:In.default,yo="file-invalid-type",wo="file-too-large",jo="file-too-small",No="too-many-files",ko=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=t.split(","),a=s.length>1?"one of ".concat(s.join(", ")):s[0];return{code:yo,message:"File type must be ".concat(a)}},ks=function(t){return{code:wo,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},Ss=function(t){return{code:jo,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},So={code:No,message:"Too many files"};function ka(n,t){var s=n.type==="application/x-moz-file"||vo(n,t);return[s,s?null:ko(t)]}function Sa(n,t,s){if(ut(n.size))if(ut(t)&&ut(s)){if(n.size>s)return[!1,ks(s)];if(n.size<t)return[!1,Ss(t)]}else{if(ut(t)&&n.size<t)return[!1,Ss(t)];if(ut(s)&&n.size>s)return[!1,ks(s)]}return[!0,null]}function ut(n){return n!=null}function Co(n){var t=n.files,s=n.accept,a=n.minSize,i=n.maxSize,r=n.multiple,o=n.maxFiles,l=n.validator;return!r&&t.length>1||r&&o>=1&&t.length>o?!1:t.every(function(d){var m=ka(d,s),x=Jt(m,1),g=x[0],u=Sa(d,a,i),v=Jt(u,1),p=v[0],w=l?l(d):null;return g&&p&&!w})}function yn(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function ln(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!n.target&&!!n.target.files}function Cs(n){n.preventDefault()}function To(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function Po(n){return n.indexOf("Edge/")!==-1}function Eo(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return To(n)||Po(n)}function Ye(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return function(a){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return t.some(function(l){return!yn(a)&&l&&l.apply(void 0,[a].concat(r)),yn(a)})}}function Ao(){return"showOpenFilePicker"in window}function Ro(n){if(ut(n)){var t=Object.entries(n).filter(function(s){var a=Jt(s,2),i=a[0],r=a[1],o=!0;return Ca(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(r)||!r.every(Ta))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(s,a){var i=Jt(a,2),r=i[0],o=i[1];return Ns(Ns({},s),{},ja({},r,o))},{});return[{description:"Files",accept:t}]}return n}function Io(n){if(ut(n))return Object.entries(n).reduce(function(t,s){var a=Jt(s,2),i=a[0],r=a[1];return[].concat(ws(t),[i],ws(r))},[]).filter(function(t){return Ca(t)||Ta(t)}).join(",")}function Mo(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function Do(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}function Ca(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||n==="application/*"||/\w+\/[-+.\w]+/g.test(n)}function Ta(n){return/^.*\.[\w]+$/.test(n)}var Oo=["children"],_o=["open"],$o=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Lo=["refKey","onChange","onClick"];function Fo(n){return Bo(n)||Uo(n)||Pa(n)||zo()}function zo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Uo(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Bo(n){if(Array.isArray(n))return Un(n)}function Mn(n,t){return Vo(n)||Ho(n,t)||Pa(n,t)||qo()}function qo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pa(n,t){if(n){if(typeof n=="string")return Un(n,t);var s=Object.prototype.toString.call(n).slice(8,-1);if(s==="Object"&&n.constructor&&(s=n.constructor.name),s==="Map"||s==="Set")return Array.from(n);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Un(n,t)}}function Un(n,t){(t==null||t>n.length)&&(t=n.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=n[s];return a}function Ho(n,t){var s=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(s!=null){var a=[],i=!0,r=!1,o,l;try{for(s=s.call(n);!(i=(o=s.next()).done)&&(a.push(o.value),!(t&&a.length===t));i=!0);}catch(d){r=!0,l=d}finally{try{!i&&s.return!=null&&s.return()}finally{if(r)throw l}}return a}}function Vo(n){if(Array.isArray(n))return n}function Ts(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function Se(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Ts(Object(s),!0).forEach(function(a){Bn(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Ts(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}function Bn(n,t,s){return t in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function wn(n,t){if(n==null)return{};var s=Wo(n,t),a,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)a=r[i],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(n,a)&&(s[a]=n[a])}return s}function Wo(n,t){if(n==null)return{};var s={},a=Object.keys(n),i,r;for(r=0;r<a.length;r++)i=a[r],!(t.indexOf(i)>=0)&&(s[i]=n[i]);return s}var Yn=c.forwardRef(function(n,t){var s=n.children,a=wn(n,Oo),i=Kn(a),r=i.open,o=wn(i,_o);return c.useImperativeHandle(t,function(){return{open:r}},[r]),ue.createElement(c.Fragment,null,s(Se(Se({},o),{},{open:r})))});Yn.displayName="Dropzone";var Ea={disabled:!1,getFilesFromEvent:so,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Yn.defaultProps=Ea;Yn.propTypes={children:ge.func,accept:ge.objectOf(ge.arrayOf(ge.string)),multiple:ge.bool,preventDropOnDocument:ge.bool,noClick:ge.bool,noKeyboard:ge.bool,noDrag:ge.bool,noDragEventsBubbling:ge.bool,minSize:ge.number,maxSize:ge.number,maxFiles:ge.number,disabled:ge.bool,getFilesFromEvent:ge.func,onFileDialogCancel:ge.func,onFileDialogOpen:ge.func,useFsAccessApi:ge.bool,autoFocus:ge.bool,onDragEnter:ge.func,onDragLeave:ge.func,onDragOver:ge.func,onDrop:ge.func,onDropAccepted:ge.func,onDropRejected:ge.func,onError:ge.func,validator:ge.func};var qn={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Kn(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Se(Se({},Ea),n),s=t.accept,a=t.disabled,i=t.getFilesFromEvent,r=t.maxSize,o=t.minSize,l=t.multiple,d=t.maxFiles,m=t.onDragEnter,x=t.onDragLeave,g=t.onDragOver,u=t.onDrop,v=t.onDropAccepted,p=t.onDropRejected,w=t.onFileDialogCancel,b=t.onFileDialogOpen,P=t.useFsAccessApi,R=t.autoFocus,j=t.preventDropOnDocument,h=t.noClick,N=t.noKeyboard,C=t.noDrag,E=t.noDragEventsBubbling,A=t.onError,O=t.validator,S=c.useMemo(function(){return Io(s)},[s]),f=c.useMemo(function(){return Ro(s)},[s]),T=c.useMemo(function(){return typeof b=="function"?b:Ps},[b]),k=c.useMemo(function(){return typeof w=="function"?w:Ps},[w]),M=c.useRef(null),_=c.useRef(null),F=c.useReducer(Go,qn),U=Mn(F,2),X=U[0],q=U[1],ne=X.isFocused,be=X.isFileDialogActive,ve=c.useRef(typeof window<"u"&&window.isSecureContext&&P&&Ao()),_e=function(){!ve.current&&be&&setTimeout(function(){if(_.current){var B=_.current.files;B.length||(q({type:"closeDialog"}),k())}},300)};c.useEffect(function(){return window.addEventListener("focus",_e,!1),function(){window.removeEventListener("focus",_e,!1)}},[_,be,k,ve]);var ye=c.useRef([]),We=function(B){M.current&&M.current.contains(B.target)||(B.preventDefault(),ye.current=[])};c.useEffect(function(){return j&&(document.addEventListener("dragover",Cs,!1),document.addEventListener("drop",We,!1)),function(){j&&(document.removeEventListener("dragover",Cs),document.removeEventListener("drop",We))}},[M,j]),c.useEffect(function(){return!a&&R&&M.current&&M.current.focus(),function(){}},[M,R,a]);var Y=c.useCallback(function(L){A?A(L):console.error(L)},[A]),le=c.useCallback(function(L){L.preventDefault(),L.persist(),$(L),ye.current=[].concat(Fo(ye.current),[L.target]),ln(L)&&Promise.resolve(i(L)).then(function(B){if(!(yn(L)&&!E)){var ie=B.length,te=ie>0&&Co({files:B,accept:S,minSize:o,maxSize:r,multiple:l,maxFiles:d,validator:O}),ee=ie>0&&!te;q({isDragAccept:te,isDragReject:ee,isDragActive:!0,type:"setDraggedFiles"}),m&&m(L)}}).catch(function(B){return Y(B)})},[i,m,Y,E,S,o,r,l,d,O]),Ae=c.useCallback(function(L){L.preventDefault(),L.persist(),$(L);var B=ln(L);if(B&&L.dataTransfer)try{L.dataTransfer.dropEffect="copy"}catch{}return B&&g&&g(L),!1},[g,E]),V=c.useCallback(function(L){L.preventDefault(),L.persist(),$(L);var B=ye.current.filter(function(te){return M.current&&M.current.contains(te)}),ie=B.indexOf(L.target);ie!==-1&&B.splice(ie,1),ye.current=B,!(B.length>0)&&(q({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),ln(L)&&x&&x(L))},[M,x,E]),J=c.useCallback(function(L,B){var ie=[],te=[];L.forEach(function(ee){var re=ka(ee,S),Te=Mn(re,2),ce=Te[0],Me=Te[1],Re=Sa(ee,o,r),nt=Mn(Re,2),se=nt[0],pe=nt[1],he=O?O(ee):null;if(ce&&se&&!he)ie.push(ee);else{var de=[Me,pe];he&&(de=de.concat(he)),te.push({file:ee,errors:de.filter(function(Ft){return Ft})})}}),(!l&&ie.length>1||l&&d>=1&&ie.length>d)&&(ie.forEach(function(ee){te.push({file:ee,errors:[So]})}),ie.splice(0)),q({acceptedFiles:ie,fileRejections:te,isDragReject:te.length>0,type:"setFiles"}),u&&u(ie,te,B),te.length>0&&p&&p(te,B),ie.length>0&&v&&v(ie,B)},[q,l,S,o,r,d,u,v,p,O]),Z=c.useCallback(function(L){L.preventDefault(),L.persist(),$(L),ye.current=[],ln(L)&&Promise.resolve(i(L)).then(function(B){yn(L)&&!E||J(B,L)}).catch(function(B){return Y(B)}),q({type:"reset"})},[i,J,Y,E]),ae=c.useCallback(function(){if(ve.current){q({type:"openDialog"}),T();var L={multiple:l,types:f};window.showOpenFilePicker(L).then(function(B){return i(B)}).then(function(B){J(B,null),q({type:"closeDialog"})}).catch(function(B){Mo(B)?(k(B),q({type:"closeDialog"})):Do(B)?(ve.current=!1,_.current?(_.current.value=null,_.current.click()):Y(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Y(B)});return}_.current&&(q({type:"openDialog"}),T(),_.current.value=null,_.current.click())},[q,T,k,P,J,Y,f,l]),ke=c.useCallback(function(L){!M.current||!M.current.isEqualNode(L.target)||(L.key===" "||L.key==="Enter"||L.keyCode===32||L.keyCode===13)&&(L.preventDefault(),ae())},[M,ae]),we=c.useCallback(function(){q({type:"focus"})},[]),Ce=c.useCallback(function(){q({type:"blur"})},[]),y=c.useCallback(function(){h||(Eo()?setTimeout(ae,0):ae())},[h,ae]),I=function(B){return a?null:B},D=function(B){return N?null:I(B)},H=function(B){return C?null:I(B)},$=function(B){E&&B.stopPropagation()},z=c.useMemo(function(){return function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=L.refKey,ie=B===void 0?"ref":B,te=L.role,ee=L.onKeyDown,re=L.onFocus,Te=L.onBlur,ce=L.onClick,Me=L.onDragEnter,Re=L.onDragOver,nt=L.onDragLeave,se=L.onDrop,pe=wn(L,$o);return Se(Se(Bn({onKeyDown:D(Ye(ee,ke)),onFocus:D(Ye(re,we)),onBlur:D(Ye(Te,Ce)),onClick:I(Ye(ce,y)),onDragEnter:H(Ye(Me,le)),onDragOver:H(Ye(Re,Ae)),onDragLeave:H(Ye(nt,V)),onDrop:H(Ye(se,Z)),role:typeof te=="string"&&te!==""?te:"presentation"},ie,M),!a&&!N?{tabIndex:0}:{}),pe)}},[M,ke,we,Ce,y,le,Ae,V,Z,N,C,a]),K=c.useCallback(function(L){L.stopPropagation()},[]),je=c.useMemo(function(){return function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=L.refKey,ie=B===void 0?"ref":B,te=L.onChange,ee=L.onClick,re=wn(L,Lo),Te=Bn({accept:S,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:I(Ye(te,Z)),onClick:I(Ye(ee,K)),tabIndex:-1},ie,_);return Se(Se({},Te),re)}},[_,s,l,Z,a]);return Se(Se({},X),{},{isFocused:ne&&!a,getRootProps:z,getInputProps:je,rootRef:M,inputRef:_,open:I(ae)})}function Go(n,t){switch(t.type){case"focus":return Se(Se({},n),{},{isFocused:!0});case"blur":return Se(Se({},n),{},{isFocused:!1});case"openDialog":return Se(Se({},qn),{},{isFileDialogActive:!0});case"closeDialog":return Se(Se({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":return Se(Se({},n),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return Se(Se({},n),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections,isDragReject:t.isDragReject});case"reset":return Se({},qn);default:return n}}function Ps(){}class Xo{screenshots=[];gridSlots=[null,null,null,null];maxScreenshots=4;constructor(t=4){this.maxScreenshots=t}addScreenshot(t){this.screenshots.length>=this.maxScreenshots&&(G.warn(`Maximum ${this.maxScreenshots} screenshots reached. Replacing oldest.`,{component:"screenshot-combiner",operation:"add-screenshot",maxScreenshots:this.maxScreenshots}),this.screenshots.shift()),this.screenshots.push(t),G.info(`Screenshot added. Total: ${this.screenshots.length}/${this.maxScreenshots}`,{component:"screenshot-combiner",operation:"add-screenshot",current:this.screenshots.length,max:this.maxScreenshots})}setGrid(t){const s=[null,null,null,null];for(let a=0;a<4;a++)s[a]=t[a]||null;this.gridSlots=s,this.screenshots=this.gridSlots.filter(a=>a!==null)}removeScreenshot(t){const s=this.screenshots.findIndex(a=>a.id===t);return s!==-1?(this.screenshots.splice(s,1),G.info(`Screenshot removed. Remaining: ${this.screenshots.length}`,{component:"screenshot-combiner",operation:"remove-screenshot",remaining:this.screenshots.length}),!0):!1}getScreenshots(){return[...this.screenshots]}getScreenshotCount(){return this.screenshots.length}canAddMore(){return this.screenshots.length<this.maxScreenshots}clear(){this.screenshots=[],this.gridSlots=[null,null,null,null],G.info("All screenshots cleared",{component:"screenshot-combiner",operation:"clear"})}async combineScreenshots(){if(this.screenshots.length===0)throw new Error("No screenshots to combine");G.info(`Combining ${this.screenshots.length} screenshots into 2x2 grid (10x10 cm)`,{component:"screenshot-combiner",operation:"combine-start",count:this.screenshots.length});try{const s={dataUrl:await this.createCombinedCanvas(),width:0,height:0,screenshotCount:this.screenshots.length,timestamp:Date.now()};return G.info(`Successfully combined ${this.screenshots.length} screenshots`,{component:"screenshot-combiner",operation:"combine-success",count:this.screenshots.length}),s}catch(t){const s=Zt(t);throw G.error("Failed to combine screenshots",s,{component:"screenshot-combiner",operation:"combine-error"}),new Error(`Screenshot combination failed: ${t instanceof Error?t.message:"Unknown error"}`)}}drawCombinedCanvas(){return new Promise((t,s)=>{try{const a=document.createElement("canvas"),i=a.getContext("2d");if(!i){s(new Error("Could not get canvas context"));return}const r=96/2.54,o=Math.round(10*r),l=Math.round(5*r),d=Math.max(1,Math.floor(window.devicePixelRatio||1));a.width=o*d,a.height=o*d,i.scale(d,d),G.debug(`Canvas dimensions: ${o}x${o} (CSS px), DPR=${d}`,{component:"screenshot-combiner",operation:"canvas-setup",width:o,height:o,dpr:d}),i.fillStyle="#ffffff",i.fillRect(0,0,o,o);const m=(p,w,b,P)=>{i.save(),i.beginPath(),i.rect(w,b,P,P),i.clip();const R=Math.max(P/p.width,P/p.height),j=p.width*R,h=p.height*R,N=w+(P-j)/2,C=b+(P-h)/2;i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(p,N,C,j,h),i.restore()},x=this.gridSlots,g=[null,null,null,null];let u=x.filter(Boolean).length;if(u===0){t(a);return}const v=()=>{if(u--,u===0){const p=[{x:0,y:0},{x:l,y:0},{x:0,y:l},{x:l,y:l}];for(let w=0;w<4;w++){const b=g[w];if(!b)continue;const P=p[w];m(b,P.x,P.y,l),G.debug(`Drew slot ${w+1} at (${P.x}, ${P.y}), cell ${l}x${l}`,{component:"screenshot-combiner",operation:"draw-slot",slot:w+1,x:P.x,y:P.y,cellSize:l})}G.info("Canvas combination completed",{component:"screenshot-combiner",operation:"canvas-complete"}),t(a)}};x.forEach((p,w)=>{if(!p)return;const b=new Image;b.onload=()=>{g[w]=b,G.debug(`Loaded slot ${w+1} image - ${b.width}x${b.height}`,{component:"screenshot-combiner",operation:"load-image",slot:w+1,width:b.width,height:b.height}),v()},b.onerror=P=>{const R=Zt(P);G.error(`Failed to load slot ${w+1} image`,R,{component:"screenshot-combiner",operation:"load-image",slot:w+1,error:P instanceof Error?P.message:String(P)}),g[w]=null,v()},b.src=p.dataUrl})}catch(a){const i=Zt(a);G.error("Error setting up canvas combination",i,{component:"screenshot-combiner",operation:"canvas-setup"}),s(a)}})}createCombinedCanvas(){return this.drawCombinedCanvas().then(t=>t.toDataURL("image/png"))}async copyToClipboard(){if(this.screenshots.length===0)throw new Error("No screenshots to copy");try{const t=await this.drawCombinedCanvas(),s=await new Promise((i,r)=>{t.toBlob(o=>o?i(o):r(new Error("toBlob failed")),"image/png")}),a=new ClipboardItem({"image/png":s});await navigator.clipboard.write([a]),G.info("Combined screenshot copied to clipboard",{component:"screenshot-combiner",operation:"copy-clipboard"})}catch(t){const s=Zt(t);throw G.error("Failed to copy to clipboard",s,{component:"screenshot-combiner",operation:"copy-clipboard"}),new Error(`Clipboard copy failed: ${t instanceof Error?t.message:"Unknown error"}`)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}}const Ue=fe.getInstance(),Be={success:3e3,error:4e3,brief:2e3,extended:6e3},cn={recordingStarted:n=>Ue.success("Recording Started",`${n} recording in progress`,Be.brief),recordingSent:(n,t)=>Ue.success("Recording Sent for Processing",`${n}'s ${t} recording is being processed. Ready for next recording.`,Be.success),sessionReady:(n,t)=>Ue.success("Session Ready for Review",`${n}'s ${t} results are ready. Click the notification bell to view.`,Be.extended),processingFailed:n=>Ue.error("Processing Failed",`${n}'s recording failed`,Be.error),transcriptionFailed:n=>{const t={"no-audio":"No audio detected","too-short":"Recording too short","service-unavailable":"Transcription service unavailable",error:"Transcription service error"};return Ue.error("Audio Transcription Failed",t[n],Be.error)}},Oe={imageAdded:n=>Ue.success("Image Added",`Screenshot ${n+1} loaded successfully`,Be.brief),imageRemoved:n=>Ue.success("Screenshot Removed",`Slot ${n+1} cleared`,Be.brief),imagesCombined:n=>Ue.success("Screenshots Combined!",`${n} screenshots combined and copied to clipboard`,Be.success),allCleared:()=>Ue.success("Cleared","All screenshots removed",Be.brief),invalidFile:(n="PNG, JPG, GIF")=>Ue.error("Invalid File",`Please select an image file (${n})`,Be.error),noFiles:()=>Ue.error("No Files","No files were detected in the drag operation",Be.error),combineFailed:n=>Ue.error("Combine Failed",n||"Failed to combine screenshots",Be.error),importFailed:()=>Ue.error("Import Failed","Could not load dropped image",Be.error),noScreenshots:()=>Ue.error("No Screenshots","Please add at least one screenshot to combine",Be.error)},Qo=({isOpen:n,onClose:t})=>{const[s,a]=c.useState([null,null,null,null]),[i,r]=c.useState(!1),[o,l]=c.useState(null),[d,m]=c.useState(0),x=c.useRef(new Xo(4)),g=c.useRef(null),u=()=>{a([null,null,null,null]),r(!1),x.current.clear(),m(0);try{chrome.tabs.query({active:!0,currentWindow:!0},N=>{const C=N?.[0]?.id;C&&chrome.tabs.sendMessage(C,{type:"SET_FILE_DROP_GUARD",enabled:!1})})}catch(N){console.debug("Failed to disable file drop guard on modal close:",N instanceof Error?N.message:N)}t()};c.useEffect(()=>{const N=async C=>{try{const A=(await chrome.tabs.query({active:!0,currentWindow:!0}))?.[0]?.id;A&&await chrome.tabs.sendMessage(A,{type:"SET_FILE_DROP_GUARD",enabled:C})}catch(E){console.warn("SET_FILE_DROP_GUARD send failed (likely non-EMR tab):",E)}try{await chrome.runtime.sendMessage({type:"SET_FILE_DROP_GUARD",enabled:C})}catch(E){console.warn("SET_FILE_DROP_GUARD to background failed:",E)}};return n&&N(!0),()=>{N(!1)}},[n]);const v=c.useCallback((N,C)=>{if(!N.type.startsWith("image/")){Oe.invalidFile();return}const E=new FileReader;E.onload=A=>{const O=A.target?.result,S=new Image;S.onload=()=>{const f={id:`slot-${C}-${Date.now()}`,dataUrl:O,timestamp:Date.now(),width:S.width,height:S.height};a(T=>{const k=[...T];return k[C]=f,k}),Oe.imageAdded(C)},S.src=O},E.readAsDataURL(N)},[]);c.useEffect(()=>{m(N=>{if(N!=null&&s[N]===null)return N;const C=s.findIndex(E=>E===null);return C>=0?C:N??0})},[s]),c.useEffect(()=>{try{const N=(d??0)+1;chrome.runtime.sendMessage({type:"SET_DROP_HINT",data:{slot:N}})}catch(N){console.debug("Failed to send drop hint message for slot",(d??0)+1,":",N instanceof Error?N.message:N)}},[d]),c.useCallback((N,C)=>{N.preventDefault(),console.log("üéØ Drag enter on drop zone",C),l(C)},[]),c.useCallback((N,C)=>{if(N.preventDefault(),N.dataTransfer)try{N.dataTransfer.dropEffect="copy"}catch(E){console.debug("Cannot set dropEffect on dataTransfer (browser security):",E instanceof Error?E.message:E)}l(C)},[]),c.useCallback(N=>{N.preventDefault(),console.log("üö´ Drag leave drop zone"),l(null)},[]),c.useCallback((N,C)=>{if(N.preventDefault(),N.dataTransfer)try{N.dataTransfer.dropEffect="copy"}catch(O){console.debug("Cannot set dropEffect on dataTransfer (browser security):",O instanceof Error?O.message:O)}if(console.log("üéØ Drop event triggered on zone",C,"with files:",N.dataTransfer?.files?.length??0),l(null),!N.dataTransfer)return console.log("‚ùå No dataTransfer on drag event"),Oe.noFiles(),!1;let E=[];if(N.dataTransfer.files&&N.dataTransfer.files.length>0)E=Array.from(N.dataTransfer.files);else if(N.dataTransfer.items&&N.dataTransfer.items.length>0){const O=[];for(const S of Array.from(N.dataTransfer.items))if(S.kind==="file"){const f=S.getAsFile();f&&O.push(f)}E=O}if(!E.length)return console.log("‚ùå No file items present in drag operation"),Oe.noFiles(),!1;console.log("üìÅ Files detected:",E.map(O=>`${O.name} (${O.type})`));const A=E.find(O=>O.type.startsWith("image/"));return A?(console.log("‚úÖ Processing image file:",A.name,A.type),v(A,C)):(console.log("‚ùå No valid image files found"),Oe.invalidFile()),!1},[v]),c.useCallback((N,C)=>{const E=N.target.files;E&&E.length>0&&v(E[0],C),N.target.value=""},[v]);const p=c.useCallback(N=>{a(C=>{const E=[...C];return E[N]=null,E}),Oe.imageRemoved(N)},[]),w=c.useCallback((N,C)=>{try{const E=new Image;E.onload=()=>{const A={id:`slot-${C}-${Date.now()}`,dataUrl:N,timestamp:Date.now(),width:E.width,height:E.height};a(O=>{const S=[...O];return S[C]=A,S}),Oe.imageAdded(C)},E.src=N}catch(E){console.error("Failed to import data URL image",E),Oe.importFailed()}},[]);c.useEffect(()=>{const N=C=>{if(C?.type==="PAGE_FILE_DROPPED"&&C.payload?.dataUrl){let E=d;if(E==null||s[E]!==null){const A=s.findIndex(O=>O===null);E=A>=0?A:0}w(C.payload.dataUrl,E)}};return chrome.runtime.onMessage.addListener(N),()=>chrome.runtime.onMessage.removeListener(N)},[s,d,w]);const b=({index:N,screenshot:C})=>{const E=c.useCallback(k=>{console.log("üì• react-dropzone onDrop accepted:",k.map(M=>`${M.name} (${M.type||"unknown"})`)),k&&k.length>0?v(k[0],N):Oe.invalidFile()},[v,N]),{getRootProps:A,getInputProps:O,isDragActive:S,open:f}=Kn({onDrop:E,onDragEnter:()=>{console.log("üü¶ dropzone dragenter",N),l(N)},onDragOver:()=>{l(N)},onDragLeave:()=>{console.log("‚¨ú dropzone dragleave",N),l(k=>k===N?null:k)},accept:{"image/*":[]},multiple:!1,noKeyboard:!0,useFsAccessApi:!1}),T=S||o===N;return e.jsxs("div",{...A({className:`
          relative aspect-video rounded-lg border-2 border-dashed cursor-pointer transition-all duration-200
          ${T?"border-blue-500 bg-blue-50 scale-105":C?"border-gray-300 bg-gray-50":"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-25"} ${d===N?"ring-2 ring-blue-500":""}
        `,onClick:k=>{k.preventDefault(),m(N),f()},"data-drop-zone":"true"}),children:[e.jsx("input",{...O({accept:"image/*"})}),C?e.jsxs("div",{className:"relative w-full h-full group",children:[e.jsx("img",{src:C.dataUrl,alt:`Screenshot ${N+1}`,className:"w-full h-full object-cover rounded-lg",draggable:!1,onDragStart:k=>k.preventDefault()}),e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:N+1}),e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation(),p(N)},className:"absolute top-2 left-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx(Le,{className:"w-3 h-3"})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 rounded-lg transition-all"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-3 ${T?"bg-blue-200":"bg-gray-200"}`,children:T?e.jsx(Bs,{className:"w-6 h-6 text-blue-600"}):e.jsx(qs,{className:"w-6 h-6 text-gray-500"})}),e.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-1 flex items-center justify-center gap-2",children:[e.jsxs("span",{children:["Slot ",N+1]}),d===N&&e.jsx("span",{className:"text-xs text-blue-600 font-semibold",children:"Next"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:T?"Drop image here":"Drag image or click"})]})]})},P=c.useCallback(async()=>{if(!s.some(C=>C!==null)){Oe.noScreenshots();return}r(!0);try{x.current.clear(),x.current.setGrid(s),await x.current.copyToClipboard();const C=s.filter(Boolean).length;Oe.imagesCombined(C)}catch(C){console.error("Failed to combine and copy screenshots:",C),Oe.combineFailed(C instanceof Error?C.message:void 0)}finally{r(!1)}},[s]),R=c.useCallback(()=>{a([null,null,null,null]),m(0),x.current.clear(),Oe.allCleared()},[]),j=s.filter(N=>N!==null).length,h=j>0&&!i;return c.useEffect(()=>{const N=E=>{E.preventDefault()},C=E=>{E.target?.closest('[data-drop-zone="true"]')||E.preventDefault()};return window.addEventListener("dragover",N,!0),window.addEventListener("drop",N,!0),window.addEventListener("dragenter",C,!0),()=>{window.removeEventListener("dragover",N,!0),window.removeEventListener("drop",N,!0),window.removeEventListener("dragenter",C,!0)}},[]),n?e.jsx(Ee,{children:e.jsx(W.div,{ref:g,className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center",variants:xe(Ks),initial:"hidden",animate:"visible",exit:"exit",onClick:N=>{N.target===N.currentTarget&&u()},children:e.jsxs(W.div,{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",variants:xe(Ys),initial:"hidden",animate:"visible",exit:"exit",onClick:N=>N.stopPropagation(),children:[e.jsxs(W.div,{className:"flex items-center justify-between p-6 border-b border-gray-200",variants:xe(Qt),initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx($s,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Screenshot Combiner"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Drag and drop up to 4 screenshots to combine them"})]})]}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Le,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:j===0?"No screenshots added yet":`${j}/4 screenshots ready`}),i&&e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Combining..."})]})]})}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsx(b,{index:0,screenshot:s[0]}),e.jsx(b,{index:1,screenshot:s[1]}),e.jsx(b,{index:2,screenshot:s[2]}),e.jsx(b,{index:3,screenshot:s[3]})]}),e.jsxs("div",{className:"text-center text-sm text-gray-600 space-y-2",children:[e.jsx("p",{children:"Drag screenshots from your desktop or click to browse files."}),e.jsx("p",{children:"Supports PNG, JPG, and GIF formats. Screenshots will be combined vertically."})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[e.jsx("div",{className:"flex items-center space-x-2",children:j>0&&e.jsxs("button",{onClick:R,className:"flex items-center space-x-2 px-3 py-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Clear All"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Close"}),e.jsxs("button",{onClick:P,disabled:!h||i,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[i?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Vn,{className:"w-4 h-4"}),e.jsx("span",{children:i?"Combining...":"Combine & Copy"})]})]})]})]})})}):null},Jo=({isOpen:n,comparison:t,textToInsert:s,onConfirm:a,onCancel:i,onRefreshEMR:r})=>{if(!n||!t)return null;const o=m=>{switch(m){case"high":return"text-green-600";case"medium":return"text-yellow-600";case"low":return"text-red-600";default:return"text-gray-600"}},d=t.isMatch?{border:"border-green-200",bg:"bg-green-50",iconColor:"text-green-600",title:"Patient Names Match"}:t.similarityScore>.5?{border:"border-yellow-200",bg:"bg-yellow-50",iconColor:"text-yellow-600",title:"Patient Name Similarity Warning"}:{border:"border-red-200",bg:"bg-red-50",iconColor:"text-red-600",title:"Patient Name Mismatch Warning"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-xl max-w-md w-full ${d.border} border-2`,children:[e.jsx("div",{className:`${d.bg} px-6 py-4 rounded-t-2xl border-b border-gray-200`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(et,{className:`w-6 h-6 ${d.iconColor}`}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:d.title})]}),e.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(Le,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Wt,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Session Patient Name:"})]}),e.jsxs("div",{className:"ml-6 p-3 bg-blue-50 rounded-lg border",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:t.sessionPatientName}),e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"From dictation session"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(yt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current EMR Patient:"})]}),e.jsxs("div",{className:"ml-6 p-3 bg-green-50 rounded-lg border",children:[e.jsx("div",{className:"text-sm font-medium text-green-900",children:t.emrPatientName}),e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Currently open EMR file"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Similarity Score:"}),e.jsxs("span",{className:`text-sm font-bold ${o(t.confidence)}`,children:[Math.round(t.similarityScore*100),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Confidence Level:"}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${t.confidence==="high"?"bg-green-100 text-green-800":t.confidence==="medium"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.confidence.toUpperCase()})]})]}),t.warnings.length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-orange-800 mb-2",children:"Warnings:"}),e.jsx("ul",{className:"text-xs text-orange-700 space-y-1",children:t.warnings.map((m,x)=>e.jsxs("li",{className:"flex items-start space-x-1",children:[e.jsx("span",{className:"w-1 h-1 bg-orange-600 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("span",{children:m})]},x))})]}),s&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Text to Insert:"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 max-h-32 overflow-y-auto",children:[e.jsx("div",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:s.length>200?`${s.substring(0,200)}...`:s}),s.length>200&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Showing first 200 characters (",s.length," total)"]})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${t.isMatch?"bg-green-100 border-green-200":"bg-red-100 border-red-200"} border`,children:e.jsx("div",{className:`text-sm ${t.isMatch?"text-green-800":"text-red-800"}`,children:t.isMatch?"The patient names appear to match. You can proceed with inserting the text.":"You are about to insert session results into a potentially different patient's EMR file. Please verify this is intentional."})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Cancel"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r&&e.jsx("button",{onClick:r,className:"px-4 py-2 text-blue-700 bg-blue-100 border border-blue-300 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium",children:"Refresh EMR"}),e.jsx("button",{onClick:a,className:`px-4 py-2 text-white rounded-lg font-medium text-sm transition-colors ${t.isMatch?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:t.isMatch?"Insert Text":"Insert Anyway"})]})]})})]})})},Yo=({onImageSelect:n,currentImage:t,onClearImage:s,disabled:a=!1})=>{const i=c.useCallback(x=>{if(!x.type.startsWith("image/")){Oe.invalidFile();return}const g=new FileReader;g.onload=u=>{const v=u.target?.result;v&&(n(v),Oe.imageAdded(0))},g.readAsDataURL(x)},[n]),r=c.useCallback(x=>{x&&x.length>0?i(x[0]):Oe.invalidFile()},[i]),{getRootProps:o,getInputProps:l,isDragActive:d}=Kn({onDrop:r,accept:{"image/*":[]},multiple:!1,disabled:a,noKeyboard:!0,useFsAccessApi:!1}),m=c.useCallback(x=>{x.stopPropagation(),s&&(s(),Oe.imageRemoved(0))},[s]);return t?e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"relative rounded-lg border-2 border-gray-300 bg-gray-50 overflow-hidden",children:[e.jsx("img",{src:t,alt:"BP Diary Sheet",className:"w-full h-auto max-h-96 object-contain"}),s&&!a&&e.jsx("button",{onClick:m,className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Remove image",children:e.jsx(Le,{className:"w-4 h-4"})})]})}):e.jsxs("div",{...o({className:`
          relative rounded-lg border-2 border-dashed cursor-pointer transition-all duration-200
          ${a?"opacity-50 cursor-not-allowed":""}
          ${d?"border-blue-500 bg-blue-50 scale-105":"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-25"}
          min-h-64 flex items-center justify-center p-8
        `}),children:[e.jsx("input",{...l({accept:"image/*"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center mb-4 ${d?"bg-blue-200":"bg-gray-200"}`,children:d?e.jsx(Bs,{className:"w-8 h-8 text-blue-600"}):e.jsx(qs,{className:"w-8 h-8 text-gray-500"})}),e.jsx("div",{className:"text-base font-medium text-gray-700 mb-2",children:d?"Drop BP diary image here":"Drop BP diary image or click to browse"}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:"Supports PNG, JPG, or PDF screenshots"}),e.jsx("p",{className:"text-xs",children:"Photos of handwritten BP diaries work best"})]})]})]})},Ko=({readings:n,onReadingsChange:t,editable:s=!0})=>{const[a,i]=c.useState(null),r=c.useCallback((u,v)=>{s&&i({readingId:u,field:v})},[s]),o=c.useCallback((u,v,p)=>{const w=parseInt(p,10);if(isNaN(w))return;const b=n.map(P=>P.id===u?{...P,[v]:w}:P);t(b)},[n,t]),l=c.useCallback(()=>{i(null)},[]),d=(u=[])=>{const v=u.some(w=>w.severity==="error"),p=u.some(w=>w.severity==="warning");return v?e.jsx(Lt,{className:"w-4 h-4 text-red-600"}):p?e.jsx(et,{className:"w-4 h-4 text-yellow-600"}):u.length>0?e.jsx(Gt,{className:"w-4 h-4 text-blue-600"}):null},m=(u,v)=>{const p=a?.readingId===u.id&&a?.field===v,w=u[v],b=u.warnings?.filter(R=>R.field===v)||[],P=b.length>0;return p?e.jsx("input",{type:"number",defaultValue:w,autoFocus:!0,onBlur:R=>{o(u.id,v,R.target.value),l()},onKeyDown:R=>{R.key==="Enter"?(o(u.id,v,R.currentTarget.value),l()):R.key==="Escape"&&l()},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none",style:{minWidth:"60px"}}):e.jsxs("div",{className:`flex items-center justify-between gap-2 px-2 py-1 rounded ${s?"cursor-pointer hover:bg-gray-100":""} ${P?"bg-yellow-50":""}`,onClick:()=>r(u.id,v),title:b.map(R=>R.message).join(`
`),children:[e.jsx("span",{className:"font-medium",children:w}),P&&d(b)]})},x=u=>new Date(u).toLocaleDateString("en-AU",{day:"numeric",month:"short"}),g=()=>n.reduce((u,v)=>u+(v.warnings?.length||0),0);return n.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No readings to review"})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 bg-gray-50 px-4 py-2 rounded-lg",children:[e.jsxs("span",{children:[n.length," reading",n.length!==1?"s":""]}),g()>0&&e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(et,{className:"w-4 h-4"}),g()," warning",g()!==1?"s":""]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Time"}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700",children:["SBP",e.jsx("br",{}),e.jsx("span",{className:"font-normal text-xs",children:"(mmHg)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700",children:["DBP",e.jsx("br",{}),e.jsx("span",{className:"font-normal text-xs",children:"(mmHg)"})]}),e.jsxs("th",{className:"px-4 py-3 text-center font-semibold text-gray-700",children:["HR",e.jsx("br",{}),e.jsx("span",{className:"font-normal text-xs",children:"(bpm)"})]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.map(u=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:x(u.date)}),e.jsx("td",{className:"px-4 py-3 text-gray-700 capitalize",children:u.timeOfDay}),e.jsx("td",{className:"px-4 py-3 text-center",children:m(u,"sbp")}),e.jsx("td",{className:"px-4 py-3 text-center",children:m(u,"dbp")}),e.jsx("td",{className:"px-4 py-3 text-center",children:m(u,"hr")})]},u.id))})]})}),s&&e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Click any value to edit ‚Ä¢ Press Enter to save, Esc to cancel"}),g()>0&&e.jsx("div",{className:"mt-4 space-y-2",children:n.filter(u=>u.warnings&&u.warnings.length>0).map(u=>e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-1",children:[x(u.date)," ",u.timeOfDay,":"]}),e.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:u.warnings?.map((v,p)=>e.jsxs("li",{className:"flex items-start gap-2",children:[d([v]),e.jsx("span",{children:v.message})]},p))})]},u.id))})]})},Aa=c.forwardRef(({readings:n,showReferenceLines:t=!0,referenceSBP:s=135,referenceDBP:a=85,width:i=800,height:r=400},o)=>{const l=c.useRef(null),d=c.useRef(null),[m,x]=c.useState(null);c.useImperativeHandle(o,()=>({copyToClipboard:async()=>{await R()}})),c.useEffect(()=>{g()},[n,t,s,a]);const g=c.useCallback(()=>{const j=l.current;if(!j||n.length===0)return;const h=j.getContext("2d");if(!h)return;const N=window.devicePixelRatio||1;j.width=i*N,j.height=r*N,j.style.width=`${i}px`,j.style.height=`${r}px`,h.scale(N,N),h.clearRect(0,0,i,r);const C={top:30,right:60,bottom:50,left:60},E=i-C.left-C.right,A=r-C.top-C.bottom,O=n.map(F=>F.sbp),S=n.map(F=>F.dbp),f=[...O,...S];t&&f.push(s,a);const T=Math.floor(Math.min(...f)/10)*10-10,k=Math.ceil(Math.max(...f)/10)*10+10,M=F=>C.left+F/(n.length-1)*E,_=F=>C.top+A-(F-T)/(k-T)*A;t&&(p(h,_(s),`SBP ${s}`,"#94a3b8",C,E),p(h,_(a),`DBP ${a}`,"#94a3b8",C,E)),w(h,C,E,A,T,k,n),u(h,n,O,M,_,"#1e293b"),u(h,n,S,M,_,"#475569"),n.forEach((F,U)=>{const X=M(U);v(h,X,_(F.sbp),"#1e293b"),v(h,X,_(F.dbp),"#475569")})},[n,t,s,a,i,r]),u=(j,h,N,C,E,A,O)=>{j.beginPath(),j.strokeStyle=A,j.lineWidth=2,h.forEach((S,f)=>{const T=C(f),k=E(N[f]);f===0?j.moveTo(T,k):j.lineTo(T,k)}),j.stroke()},v=(j,h,N,C)=>{j.beginPath(),j.fillStyle=C,j.arc(h,N,4,0,Math.PI*2),j.fill(),j.strokeStyle="#ffffff",j.lineWidth=2,j.stroke()},p=(j,h,N,C,E,A)=>{j.save(),j.setLineDash([5,5]),j.strokeStyle=C,j.lineWidth=1,j.beginPath(),j.moveTo(E.left,h),j.lineTo(E.left+A,h),j.stroke(),j.setLineDash([]),j.fillStyle=C,j.font="11px sans-serif",j.textAlign="right",j.fillText(N,E.left+A+55,h+4),j.restore()},w=(j,h,N,C,E,A,O)=>{j.strokeStyle="#cbd5e1",j.lineWidth=1,j.beginPath(),j.moveTo(h.left,h.top),j.lineTo(h.left,h.top+C),j.stroke(),j.beginPath(),j.moveTo(h.left,h.top+C),j.lineTo(h.left+N,h.top+C),j.stroke(),j.fillStyle="#64748b",j.font="12px sans-serif",j.textAlign="right";const S=5;for(let f=0;f<=S;f++){const T=E+(A-E)*(f/S),k=h.top+C-f/S*C;j.fillText(Math.round(T).toString(),h.left-10,k+4)}j.textAlign="center",O.forEach((f,T)=>{const k=h.left+T/(O.length-1)*N,M=new Date(f.date),_=`${M.getDate()}/${M.getMonth()+1}`,F=f.timeOfDay==="morning"?"M":"E";j.fillText(`${_} ${F}`,k,h.top+C+20)}),j.save(),j.translate(15,h.top+C/2),j.rotate(-Math.PI/2),j.textAlign="center",j.fillStyle="#475569",j.font="bold 13px sans-serif",j.fillText("Blood Pressure (mmHg)",0,0),j.restore(),j.fillStyle="#475569",j.font="bold 13px sans-serif",j.textAlign="center",j.fillText("Date & Time",h.left+N/2,r-10)},b=c.useCallback(j=>{if(n.length===0)return;const h=l.current;if(!h)return;const N=h.getBoundingClientRect(),C=j.clientX-N.left;j.clientY-N.top;const E={right:60,left:60},A=i-E.left-E.right;if(C<E.left||C>E.left+A){x(null);return}const O=C-E.left,S=Math.round(O/A*(n.length-1)),f=Math.max(0,Math.min(S,n.length-1)),T=n[f];x({visible:!0,x:j.clientX,y:j.clientY,reading:T,index:f})},[n,i]),P=c.useCallback(()=>{x(null)},[]),R=async()=>{const j=l.current;if(!j){fe.getInstance().error("Copy failed","Chart not available");return}try{const h=await new Promise((N,C)=>{j.toBlob(E=>{E?N(E):C(new Error("Failed to create image"))},"image/png",1)});await navigator.clipboard.write([new ClipboardItem({"image/png":h})]),fe.getInstance().success("Chart copied","Paste into your document with Cmd+V (Mac) or Ctrl+V (Windows)")}catch(h){console.error("Failed to copy chart:",h),fe.getInstance().error("Copy failed","Your browser may not support clipboard images")}};return n.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No readings to display"})}):e.jsxs("div",{ref:d,className:"relative",children:[e.jsx("canvas",{ref:l,onMouseMove:b,onMouseLeave:P,className:"cursor-crosshair",style:{maxWidth:"100%",height:"auto"}}),m&&m.visible&&e.jsxs("div",{className:"absolute z-50 bg-white border-2 border-gray-800 rounded-lg shadow-lg p-3 pointer-events-none",style:{left:m.x+10,top:m.y-80,minWidth:"180px"},children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-900 mb-2",children:[new Date(m.reading.date).toLocaleDateString("en-AU",{day:"numeric",month:"short"})," ",m.reading.timeOfDay==="morning"?"Morning":"Evening"]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"SBP:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[m.reading.sbp," mmHg"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"DBP:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[m.reading.dbp," mmHg"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"HR:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[m.reading.hr," bpm"]})]})]})]})]})});Aa.displayName="BPChart";class kt{static instance;lmStudioService;constructor(){this.lmStudioService=Vs.getInstance()}static getInstance(){return kt.instance||(kt.instance=new kt),kt.instance}async extractFromImage(t,s){const a=Date.now();try{G.info("Starting BP diary extraction",{component:"bp-extractor",imageSize:t.length});const i=this.buildExtractionPrompt(t),r=await this.lmStudioService.processWithAgent(this.getSystemPrompt(),i,"bp-diary-extraction",s);G.info("Received LM Studio response",{component:"bp-extractor",responseLength:r.length});const o=this.parseResponse(r),l=Date.now()-a;return G.info("BP extraction complete",{component:"bp-extractor",readingsCount:o.length,processingTime:l}),{success:!0,readings:o,rawResponse:r,processingTime:l}}catch(i){const r=Date.now()-a,o=i instanceof Error?i.message:"Unknown error";return G.error("BP extraction failed",{component:"bp-extractor",error:o,processingTime:r}),{success:!1,readings:[],error:o,processingTime:r}}}buildExtractionPrompt(t){throw new Error("Vision/OCR not yet supported. LM Studio requires a multimodal model for image analysis. Please manually enter your BP readings or use the manual entry feature (coming soon).")}getSystemPrompt(){return`You are a medical data extraction specialist focused on blood pressure diaries.
Your task is to accurately extract BP readings from images, following the strict rule that when
a cell contains two stacked values, you must select the BOTTOM value only.
Return structured JSON data without any markdown formatting or explanatory text.`}parseResponse(t){try{let s=t.trim();s.startsWith("```")&&(s=s.replace(/```json\n?/g,"").replace(/```\n?/g,""));const a=JSON.parse(s);return Array.isArray(a)?a.map((r,o)=>({id:`bp-${Date.now()}-${o}`,date:this.normalizeDate(String(r.date||"")),timeOfDay:this.normalizeTimeOfDay(String(r.timeOfDay||"")),sbp:this.parseNumber(r.sbp),dbp:this.parseNumber(r.dbp),hr:this.parseNumber(r.hr),confidence:typeof r.confidence=="number"?r.confidence:.8,warnings:[]})):(G.warn("Response is not an array",{component:"bp-extractor"}),[])}catch(s){return G.error("Failed to parse extraction response",{component:"bp-extractor",error:s instanceof Error?s.message:"Parse error",response:t.substring(0,200)}),[]}}normalizeDate(t){if(!t)return new Date().toISOString().split("T")[0];if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const s=t.match(/(\d{1,2})[/-](\d{1,2})(?:[/-](\d{2,4}))?/);if(s){const a=s[1].padStart(2,"0"),i=s[2].padStart(2,"0");return`${s[3]?s[3].length===2?`20${s[3]}`:s[3]:new Date().getFullYear().toString()}-${i}-${a}`}return new Date().toISOString().split("T")[0]}normalizeTimeOfDay(t){if(!t)return"morning";const s=t.toLowerCase();return s.includes("evening")||s.includes("pm")||s.includes("night")?"evening":"morning"}parseNumber(t){if(typeof t=="number")return t;if(!t)return 0;const s=String(t).trim(),a=s.match(/(\d+)[\n/\\,](\d+)/);if(a)return parseInt(a[2],10);const i=s.match(/\d+/);return i?parseInt(i[0],10):0}}const Hn={showReferenceLines:!0,referenceSBP:135,referenceDBP:85,dateFormat:"dd/MM",assumeCurrentYear:!0},$e={sbp:{min:70,max:260},dbp:{min:40,max:160},hr:{min:30,max:200}};class St{static instance;constructor(){}static getInstance(){return St.instance||(St.instance=new St),St.instance}validateReading(t){const s=[];let a=!1,i={...t};if((i.sbp<$e.sbp.min||i.sbp>$e.sbp.max)&&s.push({type:"range",field:"sbp",message:`SBP ${i.sbp} is outside typical range (${$e.sbp.min}-${$e.sbp.max} mmHg)`,severity:"warning"}),(i.dbp<$e.dbp.min||i.dbp>$e.dbp.max)&&s.push({type:"range",field:"dbp",message:`DBP ${i.dbp} is outside typical range (${$e.dbp.min}-${$e.dbp.max} mmHg)`,severity:"warning"}),(i.hr<$e.hr.min||i.hr>$e.hr.max)&&s.push({type:"range",field:"hr",message:`HR ${i.hr} is outside typical range (${$e.hr.min}-${$e.hr.max} bpm)`,severity:"warning"}),i.dbp>i.sbp)if(this.shouldSwapValues(i.sbp,i.dbp)){const r=i.sbp;i.sbp=i.dbp,i.dbp=r,a=!0,s.push({type:"swapped",field:"sbp",message:"Swapped SBP/DBP (DBP was greater than SBP)",severity:"info"})}else s.push({type:"relational",field:"dbp",message:`DBP ${i.dbp} is greater than SBP ${i.sbp} (unusual)`,severity:"error"});return i.sbp===0&&s.push({type:"missing",field:"sbp",message:"SBP value is missing or zero",severity:"error"}),i.dbp===0&&s.push({type:"missing",field:"dbp",message:"DBP value is missing or zero",severity:"error"}),i.warnings=s,{valid:s.filter(r=>r.severity==="error").length===0,reading:i,warnings:s,modified:a}}validateAndSort(t){return t.map(a=>this.validateReading(a).reading).sort((a,i)=>{const r=a.date.localeCompare(i.date);return r!==0?r:a.timeOfDay==="morning"&&i.timeOfDay==="evening"?-1:a.timeOfDay==="evening"&&i.timeOfDay==="morning"?1:0})}shouldSwapValues(t,s){if(s<=t)return!1;const a=s>=$e.sbp.min&&s<=$e.sbp.max,i=t>=$e.dbp.min&&t<=$e.dbp.max,r=s-t,o=r>=20&&r<=100;return a&&i&&o}getStatistics(t){if(t.length===0)return{count:0,avgSBP:0,avgDBP:0,avgHR:0,minSBP:0,maxSBP:0,minDBP:0,maxDBP:0,aboveTarget:0,percentAboveTarget:0};const s=t.map(m=>m.sbp),a=t.map(m=>m.dbp),i=t.map(m=>m.hr),r=this.average(s),o=this.average(a),l=this.average(i),d=t.filter(m=>m.sbp>=135||m.dbp>=85).length;return{count:t.length,avgSBP:Math.round(r),avgDBP:Math.round(o),avgHR:Math.round(l),minSBP:Math.min(...s),maxSBP:Math.max(...s),minDBP:Math.min(...a),maxDBP:Math.max(...a),aboveTarget:d,percentAboveTarget:Math.round(d/t.length*100)}}normalizeDate(t,s=!0){if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const a=t.match(/(\d{1,2})[/-](\d{1,2})(?:[/-](\d{2,4}))?/);if(a){const i=a[1].padStart(2,"0"),r=a[2].padStart(2,"0");let o=a[3];return!o&&s?o=new Date().getFullYear().toString():o&&o.length===2&&(o=`20${o}`),`${o}-${r}-${i}`}return new Date().toISOString().split("T")[0]}average(t){return t.length===0?0:t.reduce((s,a)=>s+a,0)/t.length}applyBottomNumberRule(t){const s=t.match(/(\d+)[\n/\\,\s](\d+)/);if(s)return parseInt(s[2],10);const a=t.match(/\d+/);return a?parseInt(a[0],10):0}}const ze={LATEST_SESSION:"bp-diary-latest",SETTINGS:"bp-diary-settings",HISTORY:"bp-diary-history"},Es=10;class Ct{static instance;constructor(){}static getInstance(){return Ct.instance||(Ct.instance=new Ct),Ct.instance}async saveSession(t){try{await chrome.storage.local.set({[ze.LATEST_SESSION]:t}),G.info("BP diary session saved",{component:"bp-storage",sessionId:t.id,readingsCount:t.readings.length}),await this.addToHistory(t)}catch(s){throw G.error("Failed to save BP diary session",{component:"bp-storage",error:s instanceof Error?s.message:"Unknown error"}),s}}async loadLatestSession(){try{const s=(await chrome.storage.local.get(ze.LATEST_SESSION))[ze.LATEST_SESSION];return s&&G.info("BP diary session loaded",{component:"bp-storage",sessionId:s.id,readingsCount:s.readings.length}),s||null}catch(t){return G.error("Failed to load BP diary session",{component:"bp-storage",error:t instanceof Error?t.message:"Unknown error"}),null}}async clearLatestSession(){try{await chrome.storage.local.remove(ze.LATEST_SESSION),G.info("BP diary latest session cleared",{component:"bp-storage"})}catch(t){G.error("Failed to clear BP diary session",{component:"bp-storage",error:t instanceof Error?t.message:"Unknown error"})}}async saveSettings(t){try{await chrome.storage.local.set({[ze.SETTINGS]:t}),G.info("BP diary settings saved",{component:"bp-storage"})}catch(s){throw G.error("Failed to save BP diary settings",{component:"bp-storage",error:s instanceof Error?s.message:"Unknown error"}),s}}async loadSettings(){try{return(await chrome.storage.local.get(ze.SETTINGS))[ze.SETTINGS]||Hn}catch(t){return G.error("Failed to load BP diary settings",{component:"bp-storage",error:t instanceof Error?t.message:"Unknown error"}),Hn}}async addToHistory(t){try{let a=(await chrome.storage.local.get(ze.HISTORY))[ze.HISTORY]||[];a.unshift(t),a.length>Es&&(a=a.slice(0,Es)),await chrome.storage.local.set({[ze.HISTORY]:a})}catch(s){G.warn("Failed to add session to history",{component:"bp-storage",error:s instanceof Error?s.message:"Unknown error"})}}async loadHistory(){try{return(await chrome.storage.local.get(ze.HISTORY))[ze.HISTORY]||[]}catch(t){return G.error("Failed to load BP diary history",{component:"bp-storage",error:t instanceof Error?t.message:"Unknown error"}),[]}}async clearAll(){try{await chrome.storage.local.remove([ze.LATEST_SESSION,ze.SETTINGS,ze.HISTORY]),G.info("All BP diary data cleared",{component:"bp-storage"})}catch(t){throw G.error("Failed to clear BP diary data",{component:"bp-storage",error:t instanceof Error?t.message:"Unknown error"}),t}}}const Zo=({isOpen:n,onClose:t})=>{const[s,a]=c.useState(null),[i,r]=c.useState([]),[o,l]=c.useState("idle"),[d,m]=c.useState(""),[x,g]=c.useState(Hn),[u,v]=c.useState(!1),p=c.useRef(null),w=c.useRef(kt.getInstance()),b=c.useRef(St.getInstance()),P=c.useRef(Ct.getInstance());c.useEffect(()=>{R()},[]);const R=async()=>{const k=await P.current.loadSettings();g(k)},j=c.useCallback(async k=>{a(k),l("extracting"),m("");try{const M=await w.current.extractFromImage(k);if(!M.success||M.readings.length===0){l("error"),m(M.error||"No readings could be extracted from the image"),fe.getInstance().error("Extraction failed","Could not extract BP readings from the image");return}l("validating");const _=b.current.validateAndSort(M.readings);r(_),l("ready"),fe.getInstance().success("Extraction complete",`Found ${_.length} BP reading${_.length!==1?"s":""}`)}catch(M){l("error");const _=M instanceof Error?M.message:"Unknown error";m(_),fe.getInstance().error("Processing failed",_)}},[]),h=c.useCallback(k=>{const M=b.current.validateAndSort(k);r(M)},[]),N=c.useCallback(()=>{a(null),r([]),l("idle"),m("")},[]),C=c.useCallback(async()=>{if(i.length!==0)try{const k={id:`bp-session-${Date.now()}`,timestamp:Date.now(),imageDataUrl:s||"",readings:i,settings:x};await P.current.saveSession(k),await P.current.saveSettings(x),fe.getInstance().success("Saved","BP diary session saved successfully")}catch(k){fe.getInstance().error("Save failed",k instanceof Error?k.message:"Unknown error")}},[i,s,x]),E=c.useCallback(async()=>{const k=await P.current.loadLatestSession();if(!k){fe.getInstance().info("No saved session","No previous BP diary found");return}a(k.imageDataUrl),r(k.readings),g(k.settings),l("ready"),v(!1),fe.getInstance().success("Loaded","Previous BP diary loaded")},[]),A=c.useCallback(()=>{const k=b.current.getStatistics(i),M={exportDate:new Date().toISOString(),readingsCount:i.length,statistics:k,readings:i.map(q=>({date:q.date,timeOfDay:q.timeOfDay,sbp:q.sbp,dbp:q.dbp,hr:q.hr}))},_=JSON.stringify(M,null,2),F=new Blob([_],{type:"application/json"}),U=URL.createObjectURL(F),X=document.createElement("a");X.href=U,X.download=`bp-diary-${new Date().toISOString().split("T")[0]}.json`,X.click(),URL.revokeObjectURL(U),fe.getInstance().success("Exported","BP diary exported as JSON")},[i]),O=c.useCallback(()=>{const k=[];k.push("Date,Time,SBP (mmHg),DBP (mmHg),HR (bpm)"),i.forEach(X=>{k.push(`${X.date},${X.timeOfDay},${X.sbp},${X.dbp},${X.hr}`)});const M=k.join(`
`),_=new Blob([M],{type:"text/csv"}),F=URL.createObjectURL(_),U=document.createElement("a");U.href=F,U.download=`bp-diary-${new Date().toISOString().split("T")[0]}.csv`,U.click(),URL.revokeObjectURL(F),fe.getInstance().success("Exported","BP diary exported as CSV")},[i]),S=c.useCallback(async()=>{p.current&&await p.current.copyToClipboard()},[]),f=c.useCallback(()=>{g(k=>({...k,showReferenceLines:!k.showReferenceLines}))},[]);if(!n)return null;const T=i.length>0?b.current.getStatistics(i):null;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"BP Diary Importer"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upload a photo of your blood pressure diary for analysis"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Le,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[o==="idle"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Yo,{onImageSelect:j,currentImage:s,onClearImage:N}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Load Last Session"]})})]}),(o==="extracting"||o==="validating")&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-700 font-medium",children:o==="extracting"?"Extracting readings from image...":"Validating data..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This typically takes 10-30 seconds"})]}),o==="error"&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[e.jsx("div",{className:"text-yellow-800 font-semibold mb-2 text-center",children:"‚ö†Ô∏è Vision/OCR Not Yet Supported"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4 text-center",children:d}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-4 text-sm",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:"Workaround Options:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-gray-600",children:[e.jsx("li",{children:"Use the sample data button below to test the chart and editing features"}),e.jsx("li",{children:"Manually enter your BP readings by editing the sample data"}),e.jsxs("li",{children:["To enable OCR: install Tesseract.js (",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-xs",children:"npm install tesseract.js"}),")"]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Clear & Start Over"}),e.jsx("button",{onClick:()=>{r([{id:"1",date:"2025-09-28",timeOfDay:"morning",sbp:142,dbp:88,hr:72,warnings:[]},{id:"2",date:"2025-09-28",timeOfDay:"evening",sbp:138,dbp:85,hr:68,warnings:[]},{id:"3",date:"2025-09-29",timeOfDay:"morning",sbp:145,dbp:90,hr:75,warnings:[]},{id:"4",date:"2025-09-29",timeOfDay:"evening",sbp:140,dbp:87,hr:70,warnings:[]},{id:"5",date:"2025-09-30",timeOfDay:"morning",sbp:138,dbp:84,hr:69,warnings:[]}]),l("ready"),fe.getInstance().info("Sample data loaded","Edit values by clicking on them")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Load Sample Data"})]})]}),o==="ready"&&i.length>0&&e.jsxs("div",{className:"space-y-6",children:[T&&e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Average SBP"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:T.avgSBP}),e.jsx("div",{className:"text-xs text-gray-500",children:"mmHg"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Average DBP"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:T.avgDBP}),e.jsx("div",{className:"text-xs text-gray-500",children:"mmHg"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Average HR"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:T.avgHR}),e.jsx("div",{className:"text-xs text-gray-500",children:"bpm"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Above Target"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[T.percentAboveTarget,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:">135/85"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Review Readings"}),e.jsx(Ko,{readings:i,onReadingsChange:h,editable:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Trend Chart"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.showReferenceLines,onChange:f,className:"rounded border-gray-300"}),"Show guidelines (135/85)"]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsx(Aa,{ref:p,readings:i,showReferenceLines:x.showReferenceLines,referenceSBP:x.referenceSBP,referenceDBP:x.referenceDBP})})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-60 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Load Last Session?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"This will replace your current work with the last saved BP diary session."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:E,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Load"})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[e.jsx("div",{className:"flex items-center gap-2",children:o==="ready"&&e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-3 py-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Clear"})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[o==="ready"&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(di,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Export JSON"})]}),e.jsxs("button",{onClick:O,className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Export CSV"})]}),e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(mi,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Copy Chart"})]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Accept & Save"})]})]}),e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Close"})]})]})]})})},Ra={isRecording:!1,isProcessing:!1,currentAgent:null,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,missingInfo:null,missingInfoAnswers:{},processingStatus:"idle",voiceActivityLevel:0,frequencyData:[],modelStatus:{isConnected:!1,classifierModel:"",processorModel:"",lastPing:0,latency:0},recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,currentAgentName:null,processingStartTime:null,failedAudioRecordings:[],reviewData:null,taviStructuredSections:void 0,patientVersion:null,isGeneratingPatientVersion:!1,streamBuffer:"",ttftMs:null,streaming:!1,transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},patientMismatchData:{comparison:null,textToInsert:null,onConfirm:null,onCancel:null},patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayTaviStructuredSections:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null},ui:{mode:"idle",modeContext:{sessionId:null,origin:"auto"},overlay:"none",sidePanel:"none",activeWorkflow:null,isCancelling:!1,showAlerts:!0,isExtractingPatients:!1,isBatchProcessing:!1,processingProgress:0,processingStartTime:0,warnings:[],errors:[],resultSummary:"",calendarData:null,extractError:null,batchProcessingProgress:null}};function el(n,t){switch(t.type){case"SET_RECORDING":return n.isRecording===t.payload?n:{...n,isRecording:t.payload};case"SET_PROCESSING":return n.isProcessing===t.payload?n:{...n,isProcessing:t.payload};case"SET_CURRENT_AGENT":return n.currentAgent===t.payload?n:{...n,currentAgent:t.payload};case"SET_TRANSCRIPTION":return n.transcription===t.payload?n:{...n,transcription:t.payload};case"SET_RESULTS":return n.results===t.payload?n:{...n,results:t.payload};case"SET_RESULTS_SUMMARY":return n.resultsSummary===t.payload?n:{...n,resultsSummary:t.payload};case"SET_AI_GENERATED_SUMMARY":return n.aiGeneratedSummary===t.payload?n:{...n,aiGeneratedSummary:t.payload};case"SET_MISSING_INFO":return{...n,missingInfo:t.payload};case"SET_MISSING_INFO_ANSWERS":return{...n,missingInfoAnswers:t.payload};case"CLEAR_MISSING_INFO":return{...n,missingInfo:null,missingInfoAnswers:{}};case"SET_PROCESSING_STATUS":return n.processingStatus===t.payload?n:{...n,processingStatus:t.payload};case"SET_VOICE_ACTIVITY":return Date.now()-(n.modelStatus.lastPing||0)<200?n:{...n,voiceActivityLevel:t.payload.level,frequencyData:t.payload.frequencyData,modelStatus:{...n.modelStatus,lastPing:Date.now()}};case"SET_MODEL_STATUS":return{...n,modelStatus:t.payload};case"SET_TIMING_DATA":return{...n,...t.payload};case"SET_CURRENT_AGENT_NAME":return n.currentAgentName===t.payload?n:{...n,currentAgentName:t.payload};case"SET_FAILED_RECORDINGS":return{...n,failedAudioRecordings:t.payload};case"SET_REVIEW_DATA":return{...n,reviewData:t.payload};case"SET_TAVI_STRUCTURED_SECTIONS":return n.taviStructuredSections===t.payload?n:{...n,taviStructuredSections:t.payload};case"SET_ACTIVE_WORKFLOW":return n.ui.activeWorkflow===t.payload?n:{...n,ui:{...n.ui,activeWorkflow:t.payload}};case"SET_CANCELLING":return n.ui.isCancelling===t.payload?n:{...n,ui:{...n.ui,isCancelling:t.payload}};case"SET_WARNINGS":return{...n,ui:{...n.ui,warnings:t.payload}};case"SET_ERRORS":return{...n,ui:{...n.ui,errors:t.payload}};case"SET_ALERTS_VISIBLE":return n.ui.showAlerts===t.payload?n:{...n,ui:{...n.ui,showAlerts:t.payload}};case"SET_RESULT_SUMMARY":return n.ui.resultSummary===t.payload?n:{...n,ui:{...n.ui,resultSummary:t.payload}};case"SET_UI_MODE":{if(n.ui.mode===t.payload.mode&&(t.payload.context?.sessionId===void 0||n.ui.modeContext.sessionId===t.payload.context?.sessionId))return n;const i={sessionId:t.payload.context?.sessionId??null,origin:t.payload.context?.origin??"auto"};let r=n.ui.overlay,o=n.ui.sidePanel;return t.payload.mode!=="processing"&&r==="processing-phase"&&(r="none"),t.payload.mode!=="processing"&&r==="field-ingestion"&&(r="none"),t.payload.mode==="processing"&&r==="none"&&(r="processing-phase"),t.payload.mode==="recording"&&(o=o==="metrics-dashboard"?"none":o),t.payload.mode!=="configuring"&&o==="metrics-dashboard"&&(o="none"),t.payload.mode!=="recording"&&o==="recording-prompts"&&(o="none"),{...n,ui:{...n.ui,mode:t.payload.mode,modeContext:i,overlay:r,sidePanel:o}}}case"SET_UI_OVERLAY":return n.ui.overlay===t.payload?n:{...n,ui:{...n.ui,overlay:t.payload}};case"CLEAR_UI_OVERLAY":return t.payload&&n.ui.overlay!==t.payload||n.ui.overlay==="none"?n:{...n,ui:{...n.ui,overlay:"none"}};case"SET_UI_SIDE_PANEL":return n.ui.sidePanel===t.payload?n:{...n,ui:{...n.ui,sidePanel:t.payload}};case"SET_PATIENT_MISMATCH_DATA":return{...n,patientMismatchData:t.payload};case"SET_CALENDAR_DATA":return{...n,ui:{...n.ui,calendarData:t.payload}};case"SET_EXTRACTING_PATIENTS":return n.ui.isExtractingPatients===t.payload?n:{...n,ui:{...n.ui,isExtractingPatients:t.payload}};case"SET_EXTRACT_ERROR":return n.ui.extractError===t.payload?n:{...n,ui:{...n.ui,extractError:t.payload}};case"SET_BATCH_PROCESSING":return n.ui.isBatchProcessing===t.payload?n:{...n,ui:{...n.ui,isBatchProcessing:t.payload}};case"SET_BATCH_PROGRESS":return{...n,ui:{...n.ui,batchProcessingProgress:t.payload}};case"SET_PROCESSING_START_TIME":return{...n,processingStartTime:t.payload};case"RESET_STATE":return Ra;case"CLEAR_RECORDING":return console.log("üîÑ CLEAR_RECORDING: Clearing state for new recording",{hadResults:!!n.results,hadReviewData:!!n.reviewData,currentAgent:n.currentAgent,processingStatus:n.processingStatus,wasDisplayingSession:n.displaySession.isDisplayingSession,wasStreaming:n.streaming,hadStreamBuffer:!!n.streamBuffer,currentSessionId:n.currentSessionId}),{...n,transcription:"",results:"",resultsSummary:"",aiGeneratedSummary:void 0,patientVersion:null,processingStatus:"idle",currentAgent:null,currentAgentName:null,recordingTime:null,transcriptionTime:null,agentProcessingTime:null,totalProcessingTime:null,processingStartTime:null,reviewData:null,taviStructuredSections:void 0,streaming:!1,streamBuffer:"",ttftMs:null,currentSessionId:null,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayTaviStructuredSections:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null},transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},ui:{...n.ui,activeWorkflow:null,warnings:[],errors:[],resultSummary:"",isCancelling:!1,mode:"idle",modeContext:{sessionId:null,origin:"auto"},overlay:"none",sidePanel:"none"}};case"SET_CURRENT_PATIENT_INFO":return{...n,currentPatientInfo:t.payload};case"ADD_PATIENT_SESSION":return{...n,patientSessions:[t.payload,...n.patientSessions]};case"UPDATE_PATIENT_SESSION":return{...n,patientSessions:n.patientSessions.map(i=>i.id===t.payload.id?{...i,...t.payload.updates}:i)};case"REMOVE_PATIENT_SESSION":return{...n,patientSessions:n.patientSessions.filter(i=>i.id!==t.payload)};case"CLEAR_PATIENT_SESSIONS":return{...n,patientSessions:[],currentPatientInfo:null,currentSessionId:null,selectedSessionId:null};case"SET_CURRENT_SESSION_ID":return{...n,currentSessionId:t.payload};case"SET_SELECTED_SESSION_ID":return{...n,selectedSessionId:t.payload};case"SET_PROCESSING_PROGRESS":return{...n,ui:{...n.ui,processingProgress:t.payload}};case"SET_AI_REVIEW_START_TIME":return{...n,ui:{...n.ui,processingStartTime:t.payload}};case"SET_PATIENT_VERSION":return n.patientVersion===t.payload?n:{...n,patientVersion:t.payload};case"SET_GENERATING_PATIENT_VERSION":return n.isGeneratingPatientVersion===t.payload?n:{...n,isGeneratingPatientVersion:t.payload};case"RESULTS_STREAMING":return{...n,streaming:t.payload};case"RESULTS_CLEAR_STREAM":return{...n,streamBuffer:"",ttftMs:null};case"RESULTS_APPEND_STREAM_CHUNK":return{...n,streamBuffer:(n.streamBuffer||"")+t.payload};case"RESULTS_TTFT":return{...n,ttftMs:t.payload};case"RESULTS_STREAM_DONE":return{...n,results:t.payload.final,streamBuffer:"",streaming:!1,ttftMs:t.payload.ttftMs??n.ttftMs??null,processingStatus:"complete"};case"RESULTS_STREAM_ERROR":return{...n,ui:{...n.ui,errors:[...n.ui.errors,t.payload]},streaming:!1};case"RESULTS_STREAM_CANCELLED":return{...n,streaming:!1};case"SET_TRANSCRIPTION_APPROVAL":return{...n,transcriptionApproval:t.payload};case"COMPLETE_PROCESSING_ATOMIC":{console.log("üèÅ ATOMIC COMPLETION: Processing complete for session:",t.payload.sessionId);const i=t.payload.results||"Processing completed",r=t.payload.summary||t.payload.results||"Processing completed";console.log("üîí ATOMIC COMPLETION: Safety checks applied - Results length:",i.length,"Summary length:",r.length);const o=["processing-phase","field-ingestion"].includes(n.ui.overlay),l=n.ui.mode==="processing"&&n.ui.modeContext.sessionId===t.payload.sessionId;return{...n,isProcessing:!1,processingStatus:"complete",streaming:!1,currentSessionId:null,results:i,aiGeneratedSummary:r,resultsSummary:r,streamBuffer:"",ttftMs:null,processingStartTime:null,ui:{...n.ui,activeWorkflow:null,isCancelling:!1,processingProgress:0,processingStartTime:0,overlay:o?"none":n.ui.overlay,mode:l?"reviewing":n.ui.mode,modeContext:l?{sessionId:t.payload.sessionId,origin:"auto"}:n.ui.modeContext}}}case"VALIDATE_STATE":{const i=[];return n.processingStatus==="complete"&&n.isProcessing&&i.push("processingStatus is complete but isProcessing is true"),n.processingStatus==="complete"&&n.streaming&&i.push("processingStatus is complete but streaming is true"),n.currentSessionId&&n.processingStatus==="complete"&&!n.isProcessing&&i.push("currentSessionId set but processing is complete - may block record button"),i.length>0&&console.warn("‚ö†Ô∏è STATE VALIDATION WARNINGS:",i),n}case"RECOVER_STUCK_STATE":console.log("üîÑ RECOVERING FROM STUCK STATE");const s=["processing-phase","field-ingestion"].includes(n.ui.overlay),a=n.ui.mode==="processing";return{...n,isProcessing:!1,processingStatus:"idle",streaming:!1,currentSessionId:null,streamBuffer:"",ttftMs:null,processingStartTime:null,transcriptionApproval:{status:"pending",originalText:"",currentText:"",hasBeenEdited:!1},ui:{...n.ui,isCancelling:!1,processingProgress:0,processingStartTime:0,activeWorkflow:null,warnings:[],errors:[],overlay:s?"none":n.ui.overlay,mode:a?"idle":n.ui.mode,modeContext:a?{sessionId:null,origin:"auto"}:n.ui.modeContext}};case"SET_DISPLAY_SESSION":{const i=t.payload.session;return{...n,selectedSessionId:i.id,displaySession:{isDisplayingSession:!0,displaySessionId:i.id,displayTranscription:i.transcription||"",displayResults:i.results||"",displaySummary:i.summary,displayTaviStructuredSections:i.taviStructuredSections,displayAgent:i.agentType||null,displayAgentName:i.agentName||null,displayPatientInfo:i.patient||null}}}case"CLEAR_DISPLAY_SESSION":return{...n,selectedSessionId:null,displaySession:{isDisplayingSession:!1,displaySessionId:null,displayTranscription:"",displayResults:"",displaySummary:void 0,displayTaviStructuredSections:void 0,displayAgent:null,displayAgentName:null,displayPatientInfo:null}};case"FORCE_UI_READY_STATE":return console.log("üîß FORCING UI READY STATE - clearing all processing indicators"),{...n,isRecording:!1,isProcessing:!1,streaming:!1,currentSessionId:null,ui:{...n.ui,activeWorkflow:null,isCancelling:!1,processingProgress:0,processingStartTime:0,overlay:["processing-phase","field-ingestion"].includes(n.ui.overlay)?"none":n.ui.overlay,mode:n.ui.mode==="processing"?"idle":n.ui.mode,modeContext:n.ui.mode==="processing"?{sessionId:null,origin:"auto"}:n.ui.modeContext}};default:return n}}function tl(){const[n,t]=c.useReducer(el,Ra),s=c.useRef(0),a={setRecording:c.useCallback(r=>{t({type:"SET_RECORDING",payload:r})},[]),setProcessing:c.useCallback(r=>{t({type:"SET_PROCESSING",payload:r})},[]),setCurrentAgent:c.useCallback(r=>{t({type:"SET_CURRENT_AGENT",payload:r})},[]),setTranscription:c.useCallback(r=>{t({type:"SET_TRANSCRIPTION",payload:r})},[]),setResults:c.useCallback(r=>{t({type:"SET_RESULTS",payload:r})},[]),setResultsSummary:c.useCallback(r=>{t({type:"SET_RESULTS_SUMMARY",payload:r})},[]),setAiGeneratedSummary:c.useCallback(r=>{t({type:"SET_AI_GENERATED_SUMMARY",payload:r})},[]),setMissingInfo:c.useCallback(r=>{t({type:"SET_MISSING_INFO",payload:r})},[]),setMissingInfoAnswers:c.useCallback(r=>{t({type:"SET_MISSING_INFO_ANSWERS",payload:r})},[]),clearMissingInfo:c.useCallback(()=>{t({type:"CLEAR_MISSING_INFO"})},[]),setProcessingStatus:c.useCallback(r=>{t({type:"SET_PROCESSING_STATUS",payload:r})},[]),setVoiceActivity:c.useCallback((r,o)=>{const l=Date.now();l-s.current>=200&&(s.current=l,t({type:"SET_VOICE_ACTIVITY",payload:{level:r,frequencyData:o}}))},[]),setModelStatus:c.useCallback(r=>{t({type:"SET_MODEL_STATUS",payload:r})},[]),setTimingData:c.useCallback(r=>{t({type:"SET_TIMING_DATA",payload:r})},[]),setCurrentAgentName:c.useCallback(r=>{t({type:"SET_CURRENT_AGENT_NAME",payload:r})},[]),setFailedRecordings:c.useCallback(r=>{t({type:"SET_FAILED_RECORDINGS",payload:r})},[]),setReviewData:c.useCallback(r=>{t({type:"SET_REVIEW_DATA",payload:r})},[]),setTaviStructuredSections:c.useCallback(r=>{t({type:"SET_TAVI_STRUCTURED_SECTIONS",payload:r})},[]),setActiveWorkflow:c.useCallback(r=>{t({type:"SET_ACTIVE_WORKFLOW",payload:r})},[]),setCancelling:c.useCallback(r=>{t({type:"SET_CANCELLING",payload:r})},[]),setWarnings:c.useCallback(r=>{t({type:"SET_WARNINGS",payload:r})},[]),setErrors:c.useCallback(r=>{t({type:"SET_ERRORS",payload:r})},[]),setAlertsVisible:c.useCallback(r=>{t({type:"SET_ALERTS_VISIBLE",payload:r})},[]),setResultSummary:c.useCallback(r=>{t({type:"SET_RESULT_SUMMARY",payload:r})},[]),setUIMode:c.useCallback((r,o)=>{t({type:"SET_UI_MODE",payload:{mode:r,context:o}})},[]),openOverlay:c.useCallback(r=>{t({type:"SET_UI_OVERLAY",payload:r})},[]),closeOverlay:c.useCallback(r=>{t({type:"CLEAR_UI_OVERLAY",payload:r})},[]),setSidePanel:c.useCallback(r=>{t({type:"SET_UI_SIDE_PANEL",payload:r})},[]),clearSidePanel:c.useCallback(()=>{t({type:"SET_UI_SIDE_PANEL",payload:"none"})},[]),setPatientMismatchData:c.useCallback(r=>{t({type:"SET_PATIENT_MISMATCH_DATA",payload:r})},[]),setCalendarData:c.useCallback(r=>{t({type:"SET_CALENDAR_DATA",payload:r})},[]),setExtractingPatients:c.useCallback(r=>{t({type:"SET_EXTRACTING_PATIENTS",payload:r})},[]),setExtractError:c.useCallback(r=>{t({type:"SET_EXTRACT_ERROR",payload:r})},[]),setBatchProcessing:c.useCallback(r=>{t({type:"SET_BATCH_PROCESSING",payload:r})},[]),setBatchProgress:c.useCallback(r=>{t({type:"SET_BATCH_PROGRESS",payload:r})},[]),setProcessingStartTime:c.useCallback(r=>{t({type:"SET_PROCESSING_START_TIME",payload:r})},[]),resetState:c.useCallback(()=>{t({type:"RESET_STATE"})},[]),clearRecording:c.useCallback(()=>{t({type:"CLEAR_RECORDING"})},[]),setCurrentPatientInfo:c.useCallback(r=>{t({type:"SET_CURRENT_PATIENT_INFO",payload:r})},[]),addPatientSession:c.useCallback(r=>{t({type:"ADD_PATIENT_SESSION",payload:r})},[]),updatePatientSession:c.useCallback((r,o)=>{t({type:"UPDATE_PATIENT_SESSION",payload:{id:r,updates:o}})},[]),removePatientSession:c.useCallback(r=>{t({type:"REMOVE_PATIENT_SESSION",payload:r})},[]),clearPatientSessions:c.useCallback(()=>{t({type:"CLEAR_PATIENT_SESSIONS"})},[]),setCurrentSessionId:c.useCallback(r=>{t({type:"SET_CURRENT_SESSION_ID",payload:r})},[]),setSelectedSessionId:c.useCallback(r=>{t({type:"SET_SELECTED_SESSION_ID",payload:r})},[]),setProcessingProgress:c.useCallback(r=>{t({type:"SET_PROCESSING_PROGRESS",payload:r})},[]),setAIReviewStartTime:c.useCallback(r=>{t({type:"SET_AI_REVIEW_START_TIME",payload:r})},[]),setPatientVersion:c.useCallback(r=>{t({type:"SET_PATIENT_VERSION",payload:r})},[]),setGeneratingPatientVersion:c.useCallback(r=>{t({type:"SET_GENERATING_PATIENT_VERSION",payload:r})},[]),setStreaming:c.useCallback(r=>{t({type:"RESULTS_STREAMING",payload:r})},[]),clearStream:c.useCallback(()=>{t({type:"RESULTS_CLEAR_STREAM"})},[]),appendStreamChunk:c.useCallback(r=>{t({type:"RESULTS_APPEND_STREAM_CHUNK",payload:r})},[]),setTTFT:c.useCallback(r=>{t({type:"RESULTS_TTFT",payload:r})},[]),streamDone:c.useCallback((r,o,l)=>{t({type:"RESULTS_STREAM_DONE",payload:{final:r,usage:o,ttftMs:l}})},[]),streamError:c.useCallback(r=>{t({type:"RESULTS_STREAM_ERROR",payload:r})},[]),streamCancelled:c.useCallback(()=>{t({type:"RESULTS_STREAM_CANCELLED"})},[]),setTranscriptionApproval:c.useCallback(r=>{t({type:"SET_TRANSCRIPTION_APPROVAL",payload:r})},[]),completeProcessingAtomic:c.useCallback((r,o,l)=>{t({type:"COMPLETE_PROCESSING_ATOMIC",payload:{sessionId:r,results:o,summary:l}})},[]),validateState:c.useCallback(()=>{t({type:"VALIDATE_STATE"})},[]),recoverStuckState:c.useCallback(()=>{t({type:"RECOVER_STUCK_STATE"})},[]),setDisplaySession:c.useCallback(r=>{t({type:"SET_DISPLAY_SESSION",payload:{session:r}})},[]),clearDisplaySession:c.useCallback(()=>{t({type:"CLEAR_DISPLAY_SESSION"})},[]),forceUIReadyState:c.useCallback(()=>{t({type:"FORCE_UI_READY_STATE"})},[])},i=c.useMemo(()=>({isMode:r=>n.ui.mode===r,isOverlayActive:r=>n.ui.overlay===r,isSidePanelOpen:r=>n.ui.sidePanel===r,activeModeContext:n.ui.modeContext}),[n.ui.mode,n.ui.overlay,n.ui.sidePanel,n.ui.modeContext]);return{state:n,actions:a,selectors:i}}class Tt{static instance;defaultTimeout=15e3;defaultInterval=500;debugMode=!1;constructor(){}static getInstance(){return Tt.instance||(Tt.instance=new Tt),Tt.instance}setDebugMode(t){this.debugMode=t}async waitForPatientDataLoad(t,s,a=this.defaultTimeout){const i=[{name:"content_script_responsive",checker:()=>this.checkContentScriptResponsive(t),description:"Content script is responsive",timeout:5e3,interval:200},{name:"xestro_boxes_present",checker:()=>this.checkXestroBoxesPresent(t),description:"XestroBox elements are present",timeout:a,interval:this.defaultInterval},{name:"patient_data_populated",checker:()=>this.checkPatientDataPopulated(t,s),description:"Patient data fields are populated",timeout:a,interval:this.defaultInterval},{name:"clinical_sections_ready",checker:()=>this.checkClinicalSectionsReady(t),description:"Clinical sections have content",timeout:a,interval:this.defaultInterval}];return this.waitForMultipleConditions(i,{requireAll:!1,minConditions:2,earlyReturnOnCritical:!0})}async waitForClinicalSection(t,s,a=this.defaultTimeout){const i=[{name:`${s}_section_present`,checker:()=>this.checkSectionPresent(t,s),description:`${s} section is present in DOM`,timeout:a/2,interval:this.defaultInterval},{name:`${s}_content_loaded`,checker:()=>this.checkSectionContentLoaded(t,s),description:`${s} section has content`,timeout:a,interval:this.defaultInterval}];return this.waitForMultipleConditions(i,{requireAll:!0,minConditions:2,earlyReturnOnCritical:!1})}async waitForPatientActivation(t,s,a=1e4){const i=[{name:"patient_row_highlighted",checker:()=>this.checkPatientRowHighlighted(t,s),description:"Patient row is highlighted/selected",timeout:a/3,interval:200},{name:"patient_record_loading",checker:()=>this.checkPatientRecordLoading(t),description:"Patient record is loading",timeout:a/2,interval:this.defaultInterval},{name:"patient_record_loaded",checker:()=>this.checkPatientRecordLoaded(t),description:"Patient record is fully loaded",timeout:a,interval:this.defaultInterval}];return this.waitForMultipleConditions(i,{requireAll:!1,minConditions:1,earlyReturnOnCritical:!0,sequentialChecking:!0})}async waitForDOMStability(t,s=1e3,a=this.defaultTimeout){const i=Date.now(),r=[];let o=Date.now(),l="";for(;Date.now()-i<a;)try{const d=await this.getDOMHash(t),m=Date.now();if(d!==l)o=m,l=d,r.push({timestamp:m,conditionName:"dom_changed",passed:!1,details:"DOM structure changed"});else if(m-o>=s)return r.push({timestamp:m,conditionName:"dom_stable",passed:!0,details:`DOM stable for ${s}ms`}),{success:!0,timeElapsed:m-i,conditionMet:"dom_stable",intermediateChecks:r};await this.sleep(200)}catch(d){this.log("Error checking DOM stability:",d),await this.sleep(this.defaultInterval)}return{success:!1,timeElapsed:Date.now()-i,conditionMet:null,error:`DOM did not stabilize within ${a}ms`,intermediateChecks:r}}async waitForCondition(t,s={}){const a=Date.now(),i=[],{earlyReturn:r=!0,logProgress:o=this.debugMode}=s;for(this.log(`Starting wait for condition: ${t.name} - ${t.description}`);Date.now()-a<t.timeout;)try{const d=await t.checker(),m=Date.now();if(i.push({timestamp:m,conditionName:t.name,passed:d,details:d?"Condition met":"Condition not met"}),d){const x=m-a;return this.log(`‚úÖ Condition '${t.name}' met in ${x}ms`),{success:!0,timeElapsed:x,conditionMet:t.name,intermediateChecks:i}}o&&i.length%10===0&&this.log(`‚è≥ Still waiting for '${t.name}' (${Date.now()-a}ms elapsed)`),await this.sleep(t.interval)}catch(d){i.push({timestamp:Date.now(),conditionName:t.name,passed:!1,details:`Error: ${d instanceof Error?d.message:String(d)}`}),this.log(`‚ùå Error checking condition '${t.name}':`,d),await this.sleep(t.interval)}const l=Date.now()-a;return this.log(`‚è∞ Timeout waiting for condition '${t.name}' after ${l}ms`),{success:!1,timeElapsed:l,conditionMet:null,error:`Timeout waiting for condition '${t.name}'`,intermediateChecks:i}}async waitForMultipleConditions(t,s){const a=Date.now(),i=[],r=new Set,o=Math.max(...t.map(x=>x.timeout));if(this.log(`Starting multi-condition wait: ${t.length} conditions`),s.sequentialChecking)for(const x of t){const g=await this.waitForCondition(x);if(i.push(...g.intermediateChecks),g.success)r.add(x.name);else if(s.requireAll)return{success:!1,timeElapsed:Date.now()-a,conditionMet:null,error:`Sequential condition failed: ${x.name}`,intermediateChecks:i}}else for(;Date.now()-a<o;){for(const g of t)if(!r.has(g.name))try{const u=await g.checker(),v=Date.now();i.push({timestamp:v,conditionName:g.name,passed:u,details:u?"Condition met":"Condition not met"}),u&&(r.add(g.name),this.log(`‚úÖ Condition met: ${g.name}`))}catch(u){i.push({timestamp:Date.now(),conditionName:g.name,passed:!1,details:`Error: ${u instanceof Error?u.message:String(u)}`})}const x=r.size;if(s.requireAll&&x===t.length)break;if(!s.requireAll&&x>=s.minConditions)break;await this.sleep(Math.min(...t.map(g=>g.interval)))}const l=r.size,d=s.requireAll?l===t.length:l>=s.minConditions,m=Date.now()-a;return d?this.log(`‚úÖ Multi-condition wait successful: ${l}/${t.length} conditions met`):this.log(`‚ùå Multi-condition wait failed: ${l}/${t.length} conditions met`),{success:d,timeElapsed:m,conditionMet:d?Array.from(r).join(", "):null,error:d?void 0:`Insufficient conditions met: ${l}/${s.minConditions}`,intermediateChecks:i}}async checkContentScriptResponsive(t){try{return!!await this.sendMessage(t,{type:"PING"},2e3)}catch{return!1}}async checkXestroBoxesPresent(t){try{return(await this.sendMessage(t,{type:"CHECK_XESTRO_BOXES"},3e3))?.found===!0}catch{return!1}}async checkPatientDataPopulated(t,s){try{return(await this.sendMessage(t,{type:"CHECK_PATIENT_DATA",data:{expectedPatientName:s}},3e3))?.populated===!0}catch{return!1}}async checkClinicalSectionsReady(t){try{return(await this.sendMessage(t,{type:"CHECK_CLINICAL_SECTIONS"},3e3))?.sectionsReady===!0}catch{return!1}}async checkSectionPresent(t,s){try{return(await this.sendMessage(t,{type:"CHECK_SECTION_PRESENT",data:{sectionType:s}},3e3))?.present===!0}catch{return!1}}async checkSectionContentLoaded(t,s){try{const a=await this.sendMessage(t,{type:"CHECK_SECTION_CONTENT",data:{sectionType:s}},3e3);return a?.hasContent===!0&&a?.wordCount>0}catch{return!1}}async checkPatientRowHighlighted(t,s){try{return(await this.sendMessage(t,{type:"CHECK_PATIENT_ROW_HIGHLIGHTED",data:{patientIndex:s}},2e3))?.highlighted===!0}catch{return!1}}async checkPatientRecordLoading(t){try{const s=await this.sendMessage(t,{type:"CHECK_PATIENT_RECORD_STATE"},2e3);return s?.state==="loading"||s?.state==="loaded"}catch{return!1}}async checkPatientRecordLoaded(t){try{return(await this.sendMessage(t,{type:"CHECK_PATIENT_RECORD_STATE"},2e3))?.state==="loaded"}catch{return!1}}async getDOMHash(t){try{return(await this.sendMessage(t,{type:"GET_DOM_HASH"},2e3))?.hash||""}catch{return""}}async sendMessage(t,s,a=5e3){return new Promise((i,r)=>{const o=setTimeout(()=>{r(new Error(`Message timeout after ${a}ms`))},a);try{chrome.tabs.sendMessage(t,s,l=>{if(clearTimeout(o),chrome.runtime.lastError){r(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}i(l)})}catch(l){clearTimeout(o),r(l)}})}async sleep(t){return new Promise(s=>setTimeout(s,t))}log(...t){this.debugMode&&console.log("[DynamicWaitUtils]",...t)}setDefaultTimeout(t){this.defaultTimeout=t}setDefaultInterval(t){this.defaultInterval=t}getDefaultTimeout(){return this.defaultTimeout}getDefaultInterval(){return this.defaultInterval}}class Pt{static instance;debugMode=!1;medicalTermPatterns=[];commonErrorPatterns=[];defaultConfig={fields:["background","investigations","medications"],fallbackSelectors:{background:['textarea[data-field="background"]',"#background",".background textarea",'.XestroBox:contains("Background") textarea','textarea[placeholder*="background" i]'],investigations:['textarea[data-field="investigations"]',"#investigations",".investigations textarea",'.XestroBox:contains("Investigation") textarea','textarea[placeholder*="investigation" i]'],medications:['textarea[data-field="medications"]',"#medications",".medications textarea",'.XestroBox:contains("Medication") textarea','textarea[placeholder*="medication" i]']},qualityThresholds:{minWordCount:5,minMedicalTerms:1,minCompletenessScore:.3,acceptableConfidenceLevel:"medium"},retryAttempts:3,timeout:1e4,screenshotOnFailure:!0};constructor(){this.initializeMedicalPatterns(),this.initializeErrorPatterns()}static getInstance(){return Pt.instance||(Pt.instance=new Pt),Pt.instance}async extractPatientClinicalData(t,s,a={}){const i={...this.defaultConfig,...a},r=Date.now();this.log(`üîç Starting data extraction for patient: ${s.name}`);const o=await this.preExtractionValidation(t,s);if(!o.isValid)throw new Error(`Pre-extraction validation failed: ${o.errors.join(", ")}`);const l=new Map;for(const g of i.fields)try{const u=await this.extractField(t,g,i);l.set(g,u),u.success?this.log(`‚úÖ Successfully extracted ${g}: ${u.content.length} chars`):this.log(`‚ùå Failed to extract ${g}: ${u.errorMessage}`)}catch(u){this.log(`‚ùå Exception extracting ${g}:`,u),l.set(g,{fieldName:g,content:"",extractionTime:0,success:!1,errorMessage:u instanceof Error?u.message:String(u),quality:this.createEmptyQualityReport(),fallbackUsed:!1,selectorUsed:"none"})}const d={background:l.get("background")?.content||"",investigations:l.get("investigations")?.content||"",medications:l.get("medications")?.content||"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:this.calculateOverallQualityScore(l)},m=this.assessDataQuality(d);if(this.log("üìä Data quality assessment:",{completeness:m.completenessScore,richness:m.contentRichness,confidence:m.confidenceLevel,medicalTerms:m.medicalTermsFound}),m.completenessScore<i.qualityThresholds.minCompletenessScore){this.log("‚ö†Ô∏è Low quality data detected, attempting fallback extraction");const g=await this.attemptFallbackExtraction(t,d,l,i);if(g)return g}const x=Date.now()-r;return this.log(`‚úÖ Data extraction completed in ${x}ms`),d}assessDataQuality(t){const s=["background","investigations","medications"],a=s.length;let i=0,r=0,o=0;const l=[],d=[];for(const v of s){const p=t[v];if(this.isContentMeaningful(p)){i++;const w=this.countWords(p),b=this.countMedicalTerms(p);r+=w,o+=b,this.containsErrorPatterns(p)&&d.push(`${v} contains potential error text`),w<5&&d.push(`${v} has very little content (${w} words)`)}else l.push(v)}const m=i/a,x=i>0?r/i:0,g=Math.min(1,x/50*.7+o/10*.3);let u="low";return m>=.8&&g>=.6&&o>=3?u="high":m>=.5&&g>=.3&&o>=1&&(u="medium"),{completenessScore:m,contentRichness:g,confidenceLevel:u,missingFields:l,extractionWarnings:d,medicalTermsFound:o,estimatedWordCount:r}}async verifyPatientIdentity(t,s){try{const a=await this.sendMessage(t,{type:"VERIFY_PATIENT_IDENTITY",data:{expectedName:s.name,expectedFileNumber:s.fileNumber,expectedDOB:s.dob}});if(a?.verified===!0)return{isValid:!0,errors:[],warnings:[],score:1};{const i=[`Patient identity mismatch. Expected: ${s.name} (${s.fileNumber})`];return a?.currentPatient&&i.push(`Current patient: ${a.currentPatient.name} (${a.currentPatient.fileNumber})`),{isValid:!1,errors:i,warnings:a?.warnings||[],score:0}}}catch(a){return{isValid:!1,errors:[`Failed to verify patient identity: ${a}`],warnings:[],score:0}}}async extractField(t,s,a){const i=Date.now(),r=a.fallbackSelectors[s]||[];for(let o=0;o<r.length;o++){const l=r[o],d=o===0;try{this.log(`üîç Extracting ${s} with selector: ${l} (attempt ${o+1})`);const m=await this.sendMessage(t,{type:"EXTRACT_FIELD_DATA",data:{fieldName:s,selector:l,timeout:a.timeout/r.length}});if(m?.success&&m?.content){const x=this.sanitizeContent(m.content),g=this.assessFieldQuality(s,x);return{fieldName:s,content:x,extractionTime:Date.now()-i,success:!0,quality:g,fallbackUsed:!d,selectorUsed:l}}}catch(m){if(this.log(`‚ùå Extraction attempt ${o+1} failed for ${s}:`,m),o<r.length-1)continue;return{fieldName:s,content:"",extractionTime:Date.now()-i,success:!1,errorMessage:m instanceof Error?m.message:String(m),quality:this.createEmptyQualityReport(),fallbackUsed:!d,selectorUsed:l}}}return{fieldName:s,content:"",extractionTime:Date.now()-i,success:!1,errorMessage:"All selectors failed",quality:this.createEmptyQualityReport(),fallbackUsed:!0,selectorUsed:"none"}}async preExtractionValidation(t,s){const a=[],i=[];try{const r=await this.verifyPatientIdentity(t,s);r.isValid||a.push(...r.errors),i.push(...r.warnings);const o=await this.sendMessage(t,{type:"CHECK_PAGE_READY_FOR_EXTRACTION"});o?.ready||(a.push("Page not ready for data extraction"),o?.reason&&a.push(`Reason: ${o.reason}`));const l=await this.sendMessage(t,{type:"CHECK_CLINICAL_SECTIONS_EXIST"});l?.allSectionsFound||(i.push("Some clinical sections may not be available"),l?.missingSections&&i.push(`Missing: ${l.missingSections.join(", ")}`))}catch(r){a.push(`Pre-extraction validation failed: ${r}`)}return{isValid:a.length===0,errors:a,warnings:i,score:a.length===0?1:0}}async attemptFallbackExtraction(t,s,a,i){this.log("üîÑ Attempting fallback extraction strategies");const r=[];for(const[d,m]of a)(!m.success||m.quality.completenessScore<.5)&&r.push(d);if(r.length===0)return null;const o={...s};let l=!1;for(const d of r)try{const m=await this.tryOCRExtraction(t,d);if(m&&this.isContentMeaningful(m)&&(d==="background"||d==="investigations"||d==="medications")){o[d]=m,l=!0,this.log(`‚úÖ OCR extraction successful for ${d}`);continue}const x=await this.trySemanticExtraction(t,d);if(x&&this.isContentMeaningful(x)&&(d==="background"||d==="investigations"||d==="medications")){o[d]=x,l=!0,this.log(`‚úÖ Semantic extraction successful for ${d}`);continue}}catch(m){this.log(`‚ùå Fallback extraction failed for ${d}:`,m)}return l?(o.extractionAttempts++,o.qualityScore=this.calculateOverallQualityScore(new Map([["improved",{fieldName:"improved",content:JSON.stringify(o),extractionTime:0,success:!0,quality:this.assessDataQuality(o),fallbackUsed:!0,selectorUsed:"fallback"}]])),o):null}async tryOCRExtraction(t,s){try{return(await this.sendMessage(t,{type:"EXTRACT_FIELD_OCR",data:{fieldName:s}}))?.content||null}catch{return null}}async trySemanticExtraction(t,s){try{return(await this.sendMessage(t,{type:"EXTRACT_FIELD_SEMANTIC",data:{fieldName:s}}))?.content||null}catch{return null}}isContentMeaningful(t){if(!t||typeof t!="string")return!1;const s=t.trim();return s.length<3?!1:![/^(\s*|-|n\/a|none|nil|not?\s*applicable?)$/i,/^\s*\[.*extraction.*failed.*\]\s*$/i,/^\s*loading\.+\s*$/i,/^\s*please\s+wait\.+\s*$/i].some(i=>i.test(s))}countWords(t){return t?t.trim().split(/\s+/).filter(s=>s.length>0).length:0}countMedicalTerms(t){if(!t)return 0;let s=0;for(const a of this.medicalTermPatterns){const i=t.match(a);i&&(s+=i.length)}return s}containsErrorPatterns(t){return this.commonErrorPatterns.some(s=>s.test(t))}sanitizeContent(t){return t?t.trim().replace(/\s+/g," ").replace(/[\\u0000-\\u001F\\u007F]/g,""):""}assessFieldQuality(t,s){const a=this.countWords(s),i=this.countMedicalTerms(s),r=this.isContentMeaningful(s),o=r?1:0,l=Math.min(1,a/20);let d="low";return o===1&&a>=10&&i>=1?d="high":o===1&&a>=5&&(d="medium"),{completenessScore:o,contentRichness:l,confidenceLevel:d,missingFields:r?[]:[t],extractionWarnings:this.containsErrorPatterns(s)?["Contains error patterns"]:[],medicalTermsFound:i,estimatedWordCount:a}}createEmptyQualityReport(){return{completenessScore:0,contentRichness:0,confidenceLevel:"low",missingFields:[],extractionWarnings:[],medicalTermsFound:0,estimatedWordCount:0}}calculateOverallQualityScore(t){const s=Array.from(t.values());if(s.length===0)return 0;const a=s.reduce((o,l)=>o+l.quality.completenessScore,0)/s.length,i=s.reduce((o,l)=>o+l.quality.contentRichness,0)/s.length,r=s.filter(o=>o.success).length/s.length;return a*.4+i*.3+r*.3}initializeMedicalPatterns(){this.medicalTermPatterns=[/\b(?:diagnosis|treatment|medication|prescription|symptom|condition|disease|disorder|syndrome)\b/gi,/\b\d+\s*(?:mg|mcg|g|ml|cc|units?|mmHg|bpm|kg|lbs?)\b/gi,/\b(?:angiogram|angioplasty|stent|bypass|catheter|biopsy|surgery|procedure)\b/gi,/\b(?:abnormal|normal|elevated|decreased|hypertension|diabetes|coronary|cardiac|pulmonary)\b/gi,/\b(?:paracetamol|lignocaine|adrenaline|salbutamol|glyceryl trinitrate)\b/gi]}initializeErrorPatterns(){this.commonErrorPatterns=[/error|failed|timeout|exception|null|undefined/gi,/loading\.+|please\s+wait\.+/gi,/access\s+denied|permission\s+denied/gi,/not\s+found|404|500|503/gi]}async sendMessage(t,s,a=5e3){return new Promise((i,r)=>{const o=setTimeout(()=>{r(new Error(`Message timeout after ${a}ms`))},a);try{chrome.tabs.sendMessage(t,s,l=>{if(clearTimeout(o),chrome.runtime.lastError){r(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}i(l)})}catch(l){clearTimeout(o),r(l)}})}log(...t){this.debugMode&&console.log("[DataValidation]",...t)}setDebugMode(t){this.debugMode=t}updateConfig(t){Object.assign(this.defaultConfig,t)}getConfig(){return{...this.defaultConfig}}}class Et{static instance;strategies;circuitBreakers;failureHistory;config;debugMode=!1;constructor(){this.strategies=new Map,this.circuitBreakers=new Map,this.failureHistory=[],this.config=this.getDefaultConfig(),this.initializeStrategies()}static getInstance(){return Et.instance||(Et.instance=new Et),Et.instance}async executeWithRecovery(t,s,a){const i=`${s.operation}_${s.patientIndex}`;if(this.isCircuitBreakerOpen(i))throw new Error(`Circuit breaker is open for operation: ${s.operation}`);let r=null,o=0;const l=this.getMaxAttempts(s.operation);for(;o<l;)try{this.log(`üîÑ Executing ${s.operation} (attempt ${o+1}/${l})`);const d=await t();return this.resetCircuitBreaker(i),this.log(`‚úÖ Operation ${s.operation} succeeded on attempt ${o+1}`),d}catch(d){o++,r=d instanceof Error?d:new Error(String(d)),this.log(`‚ùå Attempt ${o} failed for ${s.operation}:`,r.message);const m=this.classifyError(r),x={patientIndex:s.patientIndex,patient:s.patient,operation:s.operation,error:r.message,timestamp:Date.now(),context:s,recoveryAttempted:!1},g=this.getStrategy(m,a);if(!g.shouldRetry(r,o,s)||o>=l){this.recordCircuitBreakerFailure(i),this.recordFailure(x);break}x.recoveryAttempted=!0,await this.applyRecoveryStrategy(g,r,o,s),this.recordFailure(x)}if(this.recordCircuitBreakerFailure(i),this.config.enableGracefulDegradation){const d=await this.attemptGracefulDegradation(s,r);if(d!==null)return this.log(`üîÑ Graceful degradation successful for ${s.operation}`),d}throw new Error(`Operation ${s.operation} failed after ${o} attempts. Last error: ${r?.message}`)}shouldRetryOperation(t,s,a){const i=this.classifyError(s),r=this.strategies.get(i);if(!r)return!1;const o={operation:t,patientIndex:0,patient:{name:"",dob:"",fileNumber:"",appointmentTime:"",appointmentType:"",confirmed:!1,isFirstAppointment:!1},timestamp:Date.now(),environmentState:{tabId:0,currentUrl:"",contentScriptVersion:"",lastHealthCheck:0},previousAttempts:a-1};return r.shouldRetry(s,a,o)}getRetryDelay(t,s){const a=this.strategies.get(t);return a?this.calculateBackoffDelay(a.backoffStrategy,s,1e3):1e3}resetCircuitBreaker(t){const s=this.circuitBreakers.get(t);s&&(s.failures=0,s.state="closed",s.resetAttempts=0)}getFailureStats(){const t=new Map,s=new Map;for(const r of this.failureHistory){const o=this.classifyError(new Error(r.error));t.set(o,(t.get(o)||0)+1),s.set(r.operation,(s.get(r.operation)||0)+1)}const a=this.failureHistory.filter(r=>Date.now()-r.timestamp<3e5).slice(-10),i=Array.from(this.circuitBreakers.entries()).filter(([r,o])=>o.state==="open").map(([r,o])=>r);return{totalFailures:this.failureHistory.length,failuresByType:t,failuresByOperation:s,recentFailures:a,circuitBreakersOpen:i}}initializeStrategies(){this.strategies.set("network_timeout",{errorType:"network_timeout",maxRetries:3,backoffStrategy:"exponential",recoveryTimeout:3e4,shouldRetry:(t,s,a)=>s<=3&&!t.message.includes("permanent")}),this.strategies.set("dom_not_found",{errorType:"dom_not_found",maxRetries:5,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(t,s,a)=>s<=5,fallbackAction:async()=>null}),this.strategies.set("content_script_unresponsive",{errorType:"content_script_unresponsive",maxRetries:2,backoffStrategy:"fixed",recoveryTimeout:15e3,shouldRetry:(t,s,a)=>s<=2,fallbackAction:async()=>null}),this.strategies.set("extraction_failed",{errorType:"extraction_failed",maxRetries:4,backoffStrategy:"fibonacci",recoveryTimeout:25e3,shouldRetry:(t,s,a)=>s<=4&&!t.message.includes("no data available")}),this.strategies.set("ai_processing_failed",{errorType:"ai_processing_failed",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:6e4,shouldRetry:(t,s,a)=>s<=2&&!t.message.includes("model unavailable")}),this.strategies.set("navigation_failed",{errorType:"navigation_failed",maxRetries:3,backoffStrategy:"linear",recoveryTimeout:2e4,shouldRetry:(t,s,a)=>s<=3}),this.strategies.set("permission_denied",{errorType:"permission_denied",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:5e3,shouldRetry:(t,s,a)=>!1}),this.strategies.set("memory_limit",{errorType:"memory_limit",maxRetries:1,backoffStrategy:"fixed",recoveryTimeout:1e4,shouldRetry:(t,s,a)=>s===1,fallbackAction:async()=>{try{window.gc&&window.gc()}catch{}return null}}),this.strategies.set("unknown",{errorType:"unknown",maxRetries:2,backoffStrategy:"exponential",recoveryTimeout:15e3,shouldRetry:(t,s,a)=>s<=2})}classifyError(t){const s=t.message.toLowerCase();return s.includes("timeout")||s.includes("timed out")?"network_timeout":s.includes("not found")||s.includes("element")||s.includes("selector")?"dom_not_found":s.includes("content script")||s.includes("script not responsive")?"content_script_unresponsive":s.includes("extraction")||s.includes("data")||s.includes("field")?"extraction_failed":s.includes("ai")||s.includes("model")||s.includes("processing")?"ai_processing_failed":s.includes("navigation")||s.includes("navigate")||s.includes("tab")?"navigation_failed":s.includes("permission")||s.includes("access denied")?"permission_denied":s.includes("memory")||s.includes("heap")||s.includes("out of memory")?"memory_limit":"unknown"}getStrategy(t,s){const a=this.strategies.get(t)||this.strategies.get("unknown");return s?{...a,...s}:a}async applyRecoveryStrategy(t,s,a,i){const r=this.calculateBackoffDelay(t.backoffStrategy,a);if(this.log(`üîÑ Applying recovery strategy for ${t.errorType}, waiting ${r}ms`),t.fallbackAction)try{await t.fallbackAction(),this.log(`‚úÖ Fallback action executed for ${t.errorType}`)}catch(o){this.log(`‚ùå Fallback action failed for ${t.errorType}:`,o)}await this.sleep(r),await this.performContextSpecificRecovery(i,t.errorType)}async performContextSpecificRecovery(t,s){switch(s){case"content_script_unresponsive":await this.recoverContentScript(t.environmentState.tabId);break;case"dom_not_found":await this.recoverDOMElements(t.environmentState.tabId);break;case"navigation_failed":await this.recoverNavigation(t.environmentState.tabId);break;case"memory_limit":await this.recoverMemory();break}}async recoverContentScript(t){try{this.log(`üîß Attempting to recover content script on tab ${t}`),await chrome.scripting.executeScript({target:{tabId:t},files:["content-script.js"]}),await this.sleep(2e3)}catch(s){this.log("‚ùå Content script recovery failed:",s)}}async recoverDOMElements(t){try{this.log(`üîß Attempting to recover DOM elements on tab ${t}`),await this.sleep(1e3),await chrome.tabs.sendMessage(t,{type:"REFRESH_PAGE_SECTION"})}catch(s){this.log("‚ùå DOM recovery failed:",s)}}async recoverNavigation(t){try{if(this.log(`üîß Attempting to recover navigation on tab ${t}`),!await chrome.tabs.get(t))throw new Error("Tab no longer exists");await this.sleep(3e3)}catch(s){this.log("‚ùå Navigation recovery failed:",s)}}async recoverMemory(){this.log("üîß Attempting memory recovery"),this.failureHistory.length>100&&(this.failureHistory=this.failureHistory.slice(-50));const t=Date.now();for(const[s,a]of this.circuitBreakers)t-a.lastFailureTime>3e5&&this.circuitBreakers.delete(s);try{window.gc&&window.gc()}catch{}}calculateBackoffDelay(t,s,a=1e3){switch(t){case"exponential":return Math.min(a*Math.pow(2,s-1),3e4);case"linear":return Math.min(a*s,2e4);case"fibonacci":return Math.min(this.fibonacci(s)*a,25e3);case"fixed":default:return a}}fibonacci(t){if(t<=1)return 1;if(t===2)return 2;let s=1,a=2;for(let i=3;i<=t;i++){const r=s+a;s=a,a=r}return a}isCircuitBreakerOpen(t){const s=this.circuitBreakers.get(t);return s&&s.state==="open"?Date.now()-s.lastFailureTime>this.config.circuitBreakerResetTime?(s.state="half-open",s.resetAttempts++,!1):!0:!1}recordCircuitBreakerFailure(t){let s=this.circuitBreakers.get(t);s||(s={failures:0,lastFailureTime:0,state:"closed",resetAttempts:0},this.circuitBreakers.set(t,s)),s.failures++,s.lastFailureTime=Date.now(),s.failures>=this.config.circuitBreakerThreshold&&(s.state="open",this.log(`üö® Circuit breaker opened for operation: ${t}`))}recordFailure(t){this.failureHistory.push(t),this.failureHistory.length>500&&(this.failureHistory=this.failureHistory.slice(-250))}getMaxAttempts(t){const s=["extract-data","ai-review"],a=["navigate","activate-patient"];return s.some(i=>t.includes(i))?5:a.some(i=>t.includes(i))?3:2}async attemptGracefulDegradation(t,s){switch(this.log(`üîÑ Attempting graceful degradation for ${t.operation}`),t.operation){case"extract-data":return{background:"[Data extraction failed - manual review required]",investigations:"[Data extraction failed]",medications:"[Data extraction failed]"};case"ai-review":return{summary:"[AI review failed - manual review required]",findings:[],recommendations:[]};default:return null}}getDefaultConfig(){return{strategy:"conservative",maxTotalRetries:10,circuitBreakerThreshold:5,circuitBreakerResetTime:3e5,enableGracefulDegradation:!0,userNotificationEnabled:!0}}async sleep(t){return new Promise(s=>setTimeout(s,t))}log(...t){this.debugMode&&console.log("[ErrorRecoveryManager]",...t)}setDebugMode(t){this.debugMode=t}updateConfig(t){Object.assign(this.config,t)}getConfig(){return{...this.config}}clearHistory(){this.failureHistory=[],this.circuitBreakers.clear()}addCustomStrategy(t,s){this.strategies.set(t,s)}}class At{static instance;config;storagePrefix="batch_checkpoint_";backupPrefix="backup_checkpoint_";debugMode=!1;constructor(){this.config=this.getDefaultConfig()}static getInstance(){return At.instance||(At.instance=new At),At.instance}async saveCheckpoint(t,s,a,i,r,o,l,d){const m=this.generateCheckpointId(t),x=Date.now();this.log(`üíæ Saving checkpoint: ${m}`);const g={lastSuccessfulOperation:this.getLastSuccessfulOperation(a),skippedPatients:this.getSkippedPatients(a),retryQueue:this.buildRetryQueue(r),environmentState:d},u={id:m,batchId:t,timestamp:x,version:"1.0.0",totalPatients:s.selectedPatients.length,completedPatients:a,currentPatientIndex:i,failedAttempts:r,configuration:o,performanceMetrics:l,resumeData:g,integrityHash:""};u.integrityHash=await this.calculateIntegrityHash(u);try{const v=this.config.compressionEnabled?await this.compressData(u):JSON.stringify(u),p=this.config.encryptionEnabled?await this.encryptData(v):v,w=this.storagePrefix+m;if(await this.saveToStorage(w,p),this.config.backupEnabled){const b=this.backupPrefix+m;await this.saveToStorage(b,p)}return this.log(`‚úÖ Checkpoint saved successfully: ${m}`),await this.cleanupOldCheckpoints(t),m}catch(v){throw this.log("‚ùå Failed to save checkpoint:",v),new Error(`Checkpoint save failed: ${v instanceof Error?v.message:String(v)}`)}}async loadCheckpoint(t){this.log(`üìÇ Loading checkpoint: ${t}`);try{let s=await this.loadFromStorage(this.storagePrefix+t);if(!s&&this.config.backupEnabled&&(this.log("‚ö†Ô∏è Primary checkpoint not found, trying backup"),s=await this.loadFromStorage(this.backupPrefix+t)),!s)throw new Error(`Checkpoint not found: ${t}`);const a=this.config.encryptionEnabled?await this.decryptData(s):s,i=this.config.compressionEnabled?await this.decompressData(a):JSON.parse(a);if(this.config.integrityChecking&&!await this.validateIntegrity(i))throw new Error("Checkpoint integrity validation failed");const r=this.validateCheckpointStructure(i);if(!r.isValid)throw new Error(`Invalid checkpoint structure: ${r.errors.join(", ")}`);return this.log(`‚úÖ Checkpoint loaded successfully: ${t}`),i}catch(s){throw this.log("‚ùå Failed to load checkpoint:",s),new Error(`Checkpoint load failed: ${s instanceof Error?s.message:String(s)}`)}}async resumeFromCheckpoint(t,s,a={}){this.log(`üîÑ Resuming from checkpoint: ${t}`);const i=await this.loadCheckpoint(t),r={skipFailedPatients:!1,retryFailedPatients:!0,validateEnvironment:!0,allowConfigChanges:!0,resumeFromLastSuccessful:!0,...a},o=[];if(r.validateEnvironment){const d=await this.validateEnvironment(i.resumeData.environmentState);if(!d.isValid&&(o.push(`Environment validation warnings: ${d.warnings.join(", ")}`),d.errors.length>0))throw new Error(`Environment validation failed: ${d.errors.join(", ")}`)}if(s){if(!r.allowConfigChanges)throw new Error("Configuration changes not allowed during resume");const d=this.compareConfigurations(i.configuration,s);d.hasSignificantChanges&&o.push(`Significant configuration changes detected: ${d.changes.join(", ")}`),i.configuration={...i.configuration,...s}}const l=this.determineResumeStrategy(i,r);return i.resumeData.lastSuccessfulOperation=`resumed_from_checkpoint_${Date.now()}`,this.log("‚úÖ Resume strategy determined:",l),{checkpoint:i,resumeStrategy:l,warnings:o}}async listCheckpoints(t){try{const a=await chrome.storage.local.get(null),i=[];for(const[r,o]of Object.entries(a))if(r.startsWith(this.storagePrefix))try{const l=await this.extractCheckpointInfo(r,o);(!t||l.batchId===t)&&i.push(l)}catch(l){this.log(`‚ö†Ô∏è Error reading checkpoint ${r}:`,l)}return i.sort((r,o)=>o.timestamp-r.timestamp),i}catch(s){return this.log("‚ùå Failed to list checkpoints:",s),[]}}async deleteCheckpoint(t){try{const s=chrome.storage.local,a=[this.storagePrefix+t,this.backupPrefix+t];await s.remove(a),this.log(`üóëÔ∏è Checkpoint deleted: ${t}`)}catch(s){throw this.log("‚ùå Failed to delete checkpoint:",s),new Error(`Checkpoint deletion failed: ${s instanceof Error?s.message:String(s)}`)}}async cleanupOldCheckpoints(t){try{const s=await this.listCheckpoints(t);if(s.length<=this.config.maxCheckpoints)return 0;const a=s.slice(this.config.maxCheckpoints);let i=0;for(const r of a)try{await this.deleteCheckpoint(r.id),i++}catch(o){this.log(`‚ö†Ô∏è Failed to delete old checkpoint ${r.id}:`,o)}return this.log(`üßπ Cleaned up ${i} old checkpoints`),i}catch(s){return this.log("‚ùå Cleanup failed:",s),0}}generateCheckpointId(t){return`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async calculateIntegrityHash(t){const s={...t};delete s.integrityHash;const a=JSON.stringify(s),r=new TextEncoder().encode(a),o=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(o)).map(d=>d.toString(16).padStart(2,"0")).join("")}async validateIntegrity(t){const s=t.integrityHash,a=await this.calculateIntegrityHash(t);return s===a}validateCheckpointStructure(t){const s=[],a=[],i=["id","batchId","timestamp","version","totalPatients","completedPatients","currentPatientIndex"];for(const r of i)(t[r]===void 0||t[r]===null)&&s.push(`Missing required field: ${r}`);return typeof t.currentPatientIndex!="number"&&s.push("currentPatientIndex must be a number"),Array.isArray(t.completedPatients)||s.push("completedPatients must be an array"),(t.currentPatientIndex<0||t.currentPatientIndex>t.totalPatients)&&a.push("currentPatientIndex seems out of bounds"),t.version!=="1.0.0"&&a.push(`Checkpoint version ${t.version} may not be fully compatible`),{isValid:s.length===0,errors:s,warnings:a,score:s.length===0?1:0}}async validateEnvironment(t){const s=[],a=[];try{if(t.tabId)try{await chrome.tabs.get(t.tabId)}catch{a.push("Original tab no longer exists")}if(t.currentUrl)try{new URL(t.currentUrl)}catch{a.push("Current URL appears invalid")}t.contentScriptVersion&&a.push("Content script version compatibility not verified"),Date.now()-t.lastHealthCheck>36e5&&a.push("Environment state is quite old (>1 hour)")}catch(i){s.push(`Environment validation error: ${i}`)}return{isValid:s.length===0,errors:s,warnings:a,score:s.length===0?1:0}}compareConfigurations(t,s){const a=[],i=["maxRetries","timeoutMs","errorRecoveryStrategy"];for(const[o,l]of Object.entries(s)){const d=t[o];d!==l&&a.push(`${o}: ${d} ‚Üí ${l}`)}return{hasSignificantChanges:a.some(o=>i.some(l=>o.startsWith(l))),changes:a}}determineResumeStrategy(t,s){const a={startIndex:t.currentPatientIndex,skipPatients:[],retryPatients:[],forceReprocessPatients:[],resumeMode:"continue"};if(s.resumeFromLastSuccessful){const i=this.findLastSuccessfulPatientIndex(t.completedPatients);a.startIndex=Math.max(i+1,t.currentPatientIndex)}return s.skipFailedPatients?a.skipPatients=t.failedAttempts.map(i=>i.patientIndex):s.retryFailedPatients&&(a.retryPatients=t.failedAttempts.map(i=>i.patientIndex)),a.retryPatients.length>0?a.resumeMode="retry_failed":a.skipPatients.length>0?a.resumeMode="skip_failed":a.resumeMode="continue",a}getLastSuccessfulOperation(t){const s=t.filter(i=>i.success);return s.length===0?"batch_start":`patient_completed_${s[s.length-1].patient.fileNumber}`}getSkippedPatients(t){const s=new Set(t.map((i,r)=>r)),a=[];for(let i=0;i<t.length;i++)s.has(i)||a.push(i);return a}buildRetryQueue(t){const s=[],a=new Map;for(const i of t){const r=a.get(i.patientIndex)||[];r.push(i),a.set(i.patientIndex,r)}for(const[i,r]of a){const o=r[r.length-1];s.push({patientIndex:i,patient:o.patient,lastError:o.error,retryCount:r.length,nextRetryTime:Date.now()+r.length*6e4})}return s}findLastSuccessfulPatientIndex(t){for(let s=t.length-1;s>=0;s--)if(t[s].success)return s;return-1}async extractCheckpointInfo(t,s){try{const a=t.replace(this.storagePrefix,"");let i;return this.config.encryptionEnabled?i={id:a,timestamp:0,batchId:"encrypted"}:this.config.compressionEnabled?i=await this.decompressData(s):i=JSON.parse(s),{id:i.id||a,batchId:i.batchId||"unknown",timestamp:i.timestamp||0,totalPatients:i.totalPatients||0,completedPatients:i.completedPatients?.length||0,currentIndex:i.currentPatientIndex||0,hasFailures:(i.failedAttempts?.length||0)>0}}catch(a){throw new Error(`Failed to extract checkpoint info: ${a}`)}}async saveToStorage(t,s){await chrome.storage.local.set({[t]:s})}async loadFromStorage(t){return(await chrome.storage.local.get(t))[t]||null}async compressData(t){return JSON.stringify(t).replace(/\s+/g,"").replace(/"completedPatients"/g,'"cp"').replace(/"currentPatientIndex"/g,'"ci"').replace(/"failedAttempts"/g,'"fa"').replace(/"timestamp"/g,'"ts"')}async decompressData(t){const s=t.replace(/"cp"/g,'"completedPatients"').replace(/"ci"/g,'"currentPatientIndex"').replace(/"fa"/g,'"failedAttempts"').replace(/"ts"/g,'"timestamp"');return JSON.parse(s)}async encryptData(t){return btoa(t)}async decryptData(t){return atob(t)}getDefaultConfig(){return{autoSaveInterval:5,maxCheckpoints:10,compressionEnabled:!0,encryptionEnabled:!1,integrityChecking:!0,backupEnabled:!0}}log(...t){this.debugMode&&console.log("[CheckpointManager]",...t)}setDebugMode(t){this.debugMode=t}updateConfig(t){Object.assign(this.config,t)}getConfig(){return{...this.config}}}class Rt{static instance;metrics;config;memorySnapshots=[];activeOperations=new Map;memoryMonitorInterval;debugMode=!1;constructor(){this.config=this.getDefaultConfig(),this.metrics=this.initializeMetrics(),this.startMemoryMonitoring()}static getInstance(){return Rt.instance||(Rt.instance=new Rt),Rt.instance}startSession(t){this.log(`üìä Starting metrics session: ${t}`),this.metrics=this.initializeMetrics(),this.metrics.sessionId=t,this.metrics.batchStartTime=Date.now(),this.config.enablePerformanceMarks&&performance.mark(`batch-start-${t}`)}endSession(){const t=Date.now();this.metrics.totalProcessingTime=t-this.metrics.batchStartTime,this.log(`üìä Ending metrics session: ${this.metrics.sessionId}`),this.config.enablePerformanceMarks&&(performance.mark(`batch-end-${this.metrics.sessionId}`),performance.measure(`batch-duration-${this.metrics.sessionId}`,`batch-start-${this.metrics.sessionId}`,`batch-end-${this.metrics.sessionId}`));const s=this.generateReport();return this.config.autoExport&&this.exportMetrics(s),s}startOperation(t,s,a){const i=Date.now();this.activeOperations.set(t,i),this.log(`‚è±Ô∏è Started operation: ${s} (${t})`),this.config.enablePerformanceMarks&&performance.mark(`op-start-${t}`)}endOperation(t,s,a,i,r){const o=Date.now(),l=this.activeOperations.get(t);if(!l)return this.log(`‚ö†Ô∏è No start time found for operation: ${t}`),this.createEmptyTiming(s,t);const d=o-l;this.activeOperations.delete(t);const m={operation:s,startTime:l,endTime:o,duration:d,success:a,patientIndex:i,metadata:r};switch(this.metrics.operationTimings.push(m),s){case"patient-activation":this.metrics.patientActivationTimes.push(d);break;case"data-extraction":this.metrics.dataExtractionTimes.push(d);break;case"ai-review":this.metrics.aiReviewTimes.push(d);break;case"content-script-response":this.metrics.contentScriptResponseTimes.push(d);break}if(!a){const x=this.metrics.retryCount.get(s)||0;this.metrics.retryCount.set(s,x+1)}return this.log(`‚úÖ Completed operation: ${s} in ${d}ms (success: ${a})`),this.config.enablePerformanceMarks&&(performance.mark(`op-end-${t}`),performance.measure(`op-duration-${t}`,`op-start-${t}`,`op-end-${t}`)),m}recordError(t,s,a){const i=this.classifyError(s),r=this.metrics.errorFrequency.get(i)||0;this.metrics.errorFrequency.set(i,r+1);const o=this.metrics.errorFrequency.get(t)||0;this.metrics.errorFrequency.set(t,o+1),this.log(`‚ùå Recorded error: ${i} in ${t} (patient ${a})`)}takeMemorySnapshot(){const t={timestamp:Date.now(),heapUsed:0,heapTotal:0,external:0};if(performance.memory){const s=performance.memory;t.heapUsed=s.usedJSHeapSize,t.heapTotal=s.totalJSHeapSize,t.external=s.usedJSHeapSize}return this.memorySnapshots.push(t),this.metrics.memoryUsageHistory.push(t),this.memorySnapshots.length>1e3&&(this.memorySnapshots=this.memorySnapshots.slice(-500)),t}getPerformanceIndicators(){const t=this.getRecentTimings(3e5),s=this.metrics.operationTimings.length,a=this.metrics.operationTimings.filter(u=>u.success).length,i=t.filter(u=>u.patientIndex!==void 0),r=i.length>0?i.reduce((u,v)=>u+v.duration,0)/i.length:0,o=s>0?a/s:1;let l="normal";r>0&&(r<3e4?l="fast":r<6e4?l="normal":r<12e4?l="slow":l="degraded");const d=Array.from(this.metrics.errorFrequency.values()).reduce((u,v)=>u+v,0),m=s>0?d/s:0,x=this.memorySnapshots[this.memorySnapshots.length-1],g=x?x.heapUsed/(1024*1024):0;return{averageTimePerPatient:r,successRate:o,currentSpeed:l,errorRate:m,memoryUsage:g}}generateReport(){const t=this.generateSummary(),s=this.analyzeTimings(),a=this.analyzeMemory(),i=this.analyzeErrors(),r=this.generateInsights(),o=this.generateRecommendations(r);return{summary:t,timingAnalysis:s,memoryAnalysis:a,errorAnalysis:i,performanceInsights:r,recommendations:o}}async exportMetrics(t){const s=new Date().toISOString().replace(/[:.]/g,"-"),a=`batch-metrics-${t.summary.sessionId}-${s}`;return this.config.exportFormat==="csv"?this.exportAsCSV(t,a):this.exportAsJSON(t,a)}generateSummary(){const t=new Set(this.metrics.operationTimings.filter(m=>m.patientIndex!==void 0).map(m=>m.patientIndex)).size,s=new Set(this.metrics.operationTimings.filter(m=>m.patientIndex!==void 0&&m.success).map(m=>m.patientIndex)).size,a=t-s,i=this.metrics.operationTimings.filter(m=>m.patientIndex!==void 0),r=i.length>0?i.reduce((m,x)=>m+x.duration,0)/i.length:0,o=t>0?s/t:0,l=this.metrics.totalProcessingTime/(1e3*60*60),d=l>0?t/l:0;return{sessionId:this.metrics.sessionId,totalDuration:this.metrics.totalProcessingTime,totalPatients:t,successfulPatients:s,failedPatients:a,averageTimePerPatient:r,successRate:o,throughputPatientsPerHour:d}}analyzeTimings(){const t=new Map,s=[];for(const o of this.metrics.operationTimings){s.push(o.duration);let l=t.get(o.operation);l||(l={operation:o.operation,count:0,totalTime:0,averageTime:0,minTime:1/0,maxTime:0,standardDeviation:0,successRate:0},t.set(o.operation,l)),l.count++,l.totalTime+=o.duration,l.minTime=Math.min(l.minTime,o.duration),l.maxTime=Math.max(l.maxTime,o.duration),o.success&&l.successRate++}for(const o of t.values()){o.averageTime=o.totalTime/o.count,o.successRate=o.successRate/o.count;const l=this.metrics.operationTimings.filter(m=>m.operation===o.operation).map(m=>m.duration),d=l.reduce((m,x)=>m+Math.pow(x-o.averageTime,2),0)/l.length;o.standardDeviation=Math.sqrt(d)}s.sort((o,l)=>o-l);const a={p50:this.getPercentile(s,50),p90:this.getPercentile(s,90),p95:this.getPercentile(s,95),p99:this.getPercentile(s,99)},i=this.identifyBottlenecks(t),r=this.determineCriticalPath(t);return{operationBreakdown:t,criticalPath:r,bottlenecks:i,percentiles:a}}analyzeMemory(){if(this.memorySnapshots.length<2)return{peakUsage:0,averageUsage:0,growthRate:0,leakDetection:[],gcImpact:0};const t=this.memorySnapshots.map(x=>x.heapUsed),s=Math.max(...t),a=t.reduce((x,g)=>x+g,0)/t.length,i=this.memorySnapshots[0],r=this.memorySnapshots[this.memorySnapshots.length-1],o=(r.timestamp-i.timestamp)/(1e3*60),l=(r.heapUsed-i.heapUsed)/(1024*1024),d=o>0?l/o:0,m=this.detectMemoryLeaks();return{peakUsage:s/(1024*1024),averageUsage:a/(1024*1024),growthRate:d,leakDetection:m,gcImpact:0}}analyzeErrors(){const t=Array.from(this.metrics.errorFrequency.values()).reduce((v,p)=>v+p,0),s=this.metrics.operationTimings.length,a=this.metrics.operationTimings.filter(v=>v.success).length,i=s>0?t/s:0,r=s>t?(a-(s-t))/t:0,o=new Map,l=new Map;for(const[v,p]of this.metrics.errorFrequency)this.isErrorType(v)?o.set(v,p):l.set(v,p);const d=this.metrics.operationTimings.filter(v=>!v.success),m=d.length>0?d.reduce((v,p)=>v+p.duration,0)/d.length:0,x=this.metrics.operationTimings.filter(v=>v.success),g=x.length>0?x.reduce((v,p)=>v+p.duration,0)/x.length:0,u=g>0?(m-g)/g:0;return{totalErrors:t,errorsByType:o,errorsByOperation:l,errorRate:i,recoveryRate:r,impactOnPerformance:u}}generateInsights(){const t=[],s=this.getPerformanceIndicators();return s.currentSpeed==="degraded"&&t.push({type:"warning",title:"Severely Degraded Performance",description:`Average processing time per patient is ${Math.round(s.averageTimePerPatient/1e3)}s, indicating severe performance issues.`,impact:"high",actionRequired:!0}),s.errorRate>.1&&t.push({type:"warning",title:"High Error Rate",description:`Error rate of ${Math.round(s.errorRate*100)}% is concerning and may indicate system issues.`,impact:"high",actionRequired:!0}),s.memoryUsage>500&&t.push({type:"warning",title:"High Memory Usage",description:`Memory usage of ${Math.round(s.memoryUsage)}MB is high and may cause performance issues.`,impact:"medium",actionRequired:!1}),s.successRate<.9&&t.push({type:"optimization",title:"Low Success Rate",description:`Success rate of ${Math.round(s.successRate*100)}% suggests opportunities for improvement.`,impact:"medium",actionRequired:!1}),t}generateRecommendations(t){const s=[];for(const a of t)switch(a.title){case"Severely Degraded Performance":s.push("Consider reducing batch size or increasing timeout values"),s.push("Check for network connectivity issues");break;case"High Error Rate":s.push("Review error logs to identify common failure patterns"),s.push("Consider implementing additional retry strategies");break;case"High Memory Usage":s.push("Implement more frequent garbage collection"),s.push("Reduce the number of concurrent operations");break;case"Low Success Rate":s.push("Improve error handling and recovery mechanisms"),s.push("Add more robust validation checks");break}return s}identifyBottlenecks(t){const s=[];for(const a of t.values()){let i="low",r="";a.averageTime>6e4?(i="critical",r="This operation is extremely slow and should be optimized immediately"):a.averageTime>3e4?(i="high",r="Consider optimizing this operation or implementing caching"):a.averageTime>15e3&&(i="medium",r="Monitor this operation for potential optimization opportunities"),i!=="low"&&s.push({operation:a.operation,averageTime:a.averageTime,impact:i,description:`${a.operation} takes an average of ${Math.round(a.averageTime/1e3)}s`,suggestion:r})}return s.sort((a,i)=>i.averageTime-a.averageTime)}determineCriticalPath(t){return Array.from(t.values()).sort((a,i)=>i.averageTime*i.count-a.averageTime*a.count).slice(0,5).map(a=>a.operation)}detectMemoryLeaks(){const t=[];if(this.memorySnapshots.length<10)return t;const s=this.memorySnapshots.slice(-10),a=[];for(let r=1;r<s.length;r++){const o=s[r].heapUsed-s[r-1].heapUsed;a.push(o)}const i=a.reduce((r,o)=>r+o,0)/a.length;return s[s.length-1].heapUsed-s[0].heapUsed,i>1024*1024&&t.push({suspected:!0,confidence:Math.min(i/(5*1024*1024),1),description:"Consistent memory growth detected",growthPattern:"linear"}),t}getPercentile(t,s){const a=Math.ceil(s/100*t.length)-1;return t[Math.max(0,Math.min(a,t.length-1))]||0}getRecentTimings(t){const s=Date.now()-t;return this.metrics.operationTimings.filter(a=>a.startTime>=s)}classifyError(t){const s=t.toLowerCase();return s.includes("timeout")?"timeout":s.includes("network")?"network":s.includes("permission")?"permission":s.includes("not found")?"not_found":s.includes("memory")?"memory":"unknown"}isErrorType(t){return["timeout","network","permission","not_found","memory","unknown"].includes(t)}createEmptyTiming(t,s){return{operation:t,startTime:Date.now(),endTime:Date.now(),duration:0,success:!1,metadata:{error:"No start time found",operationId:s}}}async exportAsJSON(t,s){const a=JSON.stringify(t,null,2);if(typeof window<"u"){const i=new Blob([a],{type:"application/json"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=`${s}.json`,o.click(),URL.revokeObjectURL(r)}return a}async exportAsCSV(t,s){const a=[];a.push("Category,Metric,Value,Unit"),a.push(`Summary,Session ID,${t.summary.sessionId},`),a.push(`Summary,Total Duration,${t.summary.totalDuration},ms`),a.push(`Summary,Total Patients,${t.summary.totalPatients},count`),a.push(`Summary,Success Rate,${t.summary.successRate},percentage`),a.push(`Summary,Avg Time Per Patient,${t.summary.averageTimePerPatient},ms`);for(const[r,o]of t.timingAnalysis.operationBreakdown)a.push(`Timing,${r} Count,${o.count},count`),a.push(`Timing,${r} Avg Time,${o.averageTime},ms`),a.push(`Timing,${r} Success Rate,${o.successRate},percentage`);a.push(`Memory,Peak Usage,${t.memoryAnalysis.peakUsage},MB`),a.push(`Memory,Average Usage,${t.memoryAnalysis.averageUsage},MB`),a.push(`Memory,Growth Rate,${t.memoryAnalysis.growthRate},MB/min`);const i=a.join(`
`);if(typeof window<"u"){const r=new Blob([i],{type:"text/csv"}),o=URL.createObjectURL(r),l=document.createElement("a");l.href=o,l.download=`${s}.csv`,l.click(),URL.revokeObjectURL(o)}return i}startMemoryMonitoring(){this.config.enableMemoryTracking&&(this.memoryMonitorInterval=setInterval(()=>{this.takeMemorySnapshot()},this.config.sampleInterval))}stopMemoryMonitoring(){this.memoryMonitorInterval&&(clearInterval(this.memoryMonitorInterval),this.memoryMonitorInterval=void 0)}initializeMetrics(){return{sessionId:"",batchStartTime:0,patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}getDefaultConfig(){return{enableDetailedTiming:!0,enableMemoryTracking:!0,enablePerformanceMarks:!0,sampleInterval:5e3,retentionPeriod:36e5,exportFormat:"json",autoExport:!1}}log(...t){this.debugMode&&console.log("[MetricsCollector]",...t)}setDebugMode(t){this.debugMode=t}updateConfig(t){Object.assign(this.config,t),(t.sampleInterval!==void 0||t.enableMemoryTracking!==void 0)&&(this.stopMemoryMonitoring(),this.startMemoryMonitoring())}getConfig(){return{...this.config}}getMetrics(){return{...this.metrics}}clearMetrics(){this.metrics=this.initializeMetrics(),this.memorySnapshots=[],this.activeOperations.clear()}cleanup(){this.stopMemoryMonitoring(),this.clearMetrics()}}class nl{batchPatientReviewAgent;dynamicWait;dataValidation;errorRecovery;cacheManager;checkpointManager;metricsCollector;isProcessing=!1;abortController=null;currentBatchId=null;config;currentProcessingContext=null;constructor(t={}){this.batchPatientReviewAgent=null,this.dynamicWait=Tt.getInstance(),this.dataValidation=Pt.getInstance(),this.errorRecovery=Et.getInstance(),this.cacheManager=fi.getInstance(),this.checkpointManager=At.getInstance(),this.metricsCollector=Rt.getInstance(),this.config=this.getDefaultConfig(),this.updateConfig(t),this.log("üöÄ Enhanced Batch AI Review Orchestrator initialized")}async loadAgent(){if(!this.batchPatientReviewAgent){const{BatchPatientReviewAgent:t}=await Pe(async()=>{const{BatchPatientReviewAgent:s}=await import("./chunks/BatchPatientReviewAgent.CE7Uel0N.js");return{BatchPatientReviewAgent:s}},__vite__mapDeps([10,5,6]));this.batchPatientReviewAgent=new t}}async processBatch(t,s){if(this.isProcessing)throw new Error("Batch processing already in progress");this.isProcessing=!0,this.abortController=new AbortController,this.currentBatchId=this.generateBatchId(t);const a=Date.now(),i=[],r=[];this.log(`üîÑ Starting enhanced batch AI review for ${t.selectedPatients.length} patients`),this.config.enableMetrics&&this.metricsCollector.startSession(this.currentBatchId),this.config.enableCaching&&await this.cacheManager.warmup(t.selectedPatients);try{const o=await this.checkForResumableCheckpoint(this.currentBatchId);let l=0;o&&await this.handleResumeOption(o,s)&&(i.push(...o.completedPatients),l=o.currentPatientIndex,this.log(`üìÇ Resuming from checkpoint at patient ${l}`));const d=t.selectedPatients.slice(l);if(this.config.parallelProcessing&&d.length>1){this.log(`üöÄ Using PARALLEL processing for ${d.length} patients (max ${this.config.maxConcurrentOperations} concurrent)`);const g=await this.processPatientsBatchParallel(d,l,s,a);i.push(...g.results),r.push(...g.errors)}else{this.log(`üîÑ Using SEQUENTIAL processing for ${d.length} patients`);for(let g=0;g<d.length;g++){const u=d[g],v=l+g;if(this.abortController?.signal.aborted)throw this.log("üõë Batch processing was cancelled by user"),new Error("Batch processing was cancelled");await this.validateAppointmentBookState(u,v);const p=this.createEnhancedProgress(v,t.selectedPatients.length,u,i,r,a);s?.(p);try{this.log(`üß≠ Processing patient ${v+1}/${t.selectedPatients.length}: ${u.name}`);const w=await this.processIndividualPatientEnhanced(u,v,(b,P)=>{p.phase=b,p.subPhase=P,s?.(p)});i.push(w),this.log(`‚úÖ Completed patient ${v+1}: ${u.name}`),this.config.enableCheckpoints&&(v+1)%this.config.checkpointInterval===0&&await this.saveProgressCheckpoint(t,i,v+1,r,a)}catch(w){const b=w instanceof Error?w.message:"Unknown error";this.log(`‚ùå Failed to process patient ${u.name}:`,b),this.config.enableMetrics&&this.metricsCollector.recordError("patient-processing",b,v),i.push({patient:u,reviewReport:null,extractedData:{background:"",investigations:"",medications:""},processingTime:0,success:!1,error:b}),r.push(`${u.name}: ${b}`);const P=r.length/(v+1);if(P>.5&&r.length>3)throw this.log(`üö® High error rate detected (${Math.round(P*100)}%), stopping batch`),new Error(`Batch stopped due to high error rate: ${Math.round(P*100)}%`)}}}const m=this.createEnhancedProgress(t.selectedPatients.length,t.selectedPatients.length,null,i,r,a);m.phase="completed",s?.(m);const x=await this.generateEnhancedBatchReport(t,i,a,Date.now());this.log(`üéâ Batch processing completed: ${i.filter(g=>g.success).length}/${t.selectedPatients.length} successful`);try{const g=Date.now()-a,u=i.filter(w=>w.success).length,v=t.selectedPatients.length,p=`${u}/${v} patients processed successfully`;await Hs.showCompletionNotification("batch-ai-review",g,p),console.log(`üîî Batch completion notification sent: ${u}/${v} patients (${g}ms)`)}catch(g){console.warn("Failed to send batch completion notification:",g)}return x}catch(o){this.log("‚ùå Batch processing failed:",o);const l=this.createEnhancedProgress(0,t.selectedPatients.length,null,i,[...r,o instanceof Error?o.message:"Unknown error"],a);throw l.phase="error",s?.(l),o}finally{await this.finalizeProcessing()}}async resumeFromCheckpoint(t,s){this.log(`üîÑ Resuming batch processing from checkpoint: ${t}`);const{checkpoint:a,resumeStrategy:i,warnings:r}=await this.checkpointManager.resumeFromCheckpoint(t);for(const l of r)this.log(`‚ö†Ô∏è Resume warning: ${l}`);const o={selectedPatients:[],appointmentDate:new Date().toISOString(),calendarUrl:a.resumeData.environmentState?.currentUrl||""};return this.processBatch(o,s)}cancelProcessing(){this.abortController&&(this.abortController.abort(),this.log("üõë Batch processing cancelled by user"))}isCurrentlyProcessing(){return this.isProcessing}getProcessingStats(){return{isProcessing:this.isProcessing,currentBatchId:this.currentBatchId,performanceIndicators:this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():null,cacheStats:this.config.enableCaching?this.cacheManager.getStats():null,errorStats:this.errorRecovery.getFailureStats()}}async processPatientsBatchParallel(t,s,a,i){const r=[],o=[];this.log(`üöÄ Starting parallel batch processing for ${t.length} patients`),this.log(`üìä PHASE 1: Collecting data from all ${t.length} patients...`);const l=[];for(let x=0;x<t.length;x++){const g=t[x],u=s+x;if(this.abortController?.signal.aborted)throw new Error("Batch processing was cancelled");a?.({currentPatientIndex:u,totalPatients:t.length,currentPatient:g,phase:"extracting",subPhase:`collecting-data-${x+1}/${t.length}`,completedPatients:[],errors:[],percentComplete:x/t.length*50,estimatedTimeRemaining:0,currentOperationDetails:`Collecting data from ${g.name}`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}});try{await this.validateAppointmentBookState(g,u);const v=await this.getCurrentTabId(),p=await this.extractPatientDataEnhanced(v,g);l.push({patient:g,extractedData:p,patientIndex:u,success:!0}),this.log(`‚úÖ Phase 1: Collected data for ${g.name} (${x+1}/${t.length})`)}catch(v){const p=v instanceof Error?v.message:"Unknown error";this.log(`‚ùå Phase 1: Failed to collect data for ${g.name}: ${p}`),l.push({patient:g,extractedData:{background:"",investigations:"",medications:"",extractionTimestamp:Date.now(),extractionAttempts:1,qualityScore:0},patientIndex:u,success:!1,error:p}),o.push(`${g.name}: ${p}`)}}this.log(`üìä PHASE 1 COMPLETE: Collected data from ${l.length} patients`),this.log(`ü§ñ PHASE 2: Processing AI reviews in parallel (max ${this.config.maxConcurrentOperations} concurrent)...`);const d=l.filter(x=>x.success),m=this.chunkArray(d,this.config.maxConcurrentOperations);for(const x of m){const g=x.map(async(v,p)=>{try{const w=50+r.length/t.length*50;a?.({currentPatientIndex:v.patientIndex,totalPatients:t.length,currentPatient:v.patient,phase:"reviewing",subPhase:"ai-processing-parallel",completedPatients:r,errors:[],percentComplete:w,estimatedTimeRemaining:0,currentOperationDetails:`AI review: ${v.patient.name} (parallel)`,performanceIndicators:{averageTimePerPatient:0,successRate:1,currentSpeed:"normal",errorRate:0,memoryUsage:0}}),this.log(`ü§ñ Processing AI review for ${v.patient.name} (parallel batch)`);const b=await this.performAIReviewWithCaching(v.extractedData,v.patient),P={patient:v.patient,reviewReport:b,extractedData:v.extractedData,processingTime:0,success:!0};return this.log(`‚úÖ Completed AI review for ${v.patient.name}`),P}catch(w){const b=w instanceof Error?w.message:"Unknown error";this.log(`‚ùå AI review failed for ${v.patient.name}: ${b}`);const P={patient:v.patient,reviewReport:null,extractedData:v.extractedData,processingTime:0,success:!1,error:b};return o.push(`${v.patient.name}: ${b}`),P}}),u=await Promise.allSettled(g);for(const v of u)v.status==="fulfilled"&&r.push(v.value);this.log(`‚úÖ Completed AI processing chunk: ${r.filter(v=>v.success).length}/${r.length} successful`)}for(const x of l.filter(g=>!g.success))r.push({patient:x.patient,reviewReport:null,extractedData:x.extractedData,processingTime:0,success:!1,error:x.error});return this.log(`üéâ PARALLEL PROCESSING COMPLETE: ${r.filter(x=>x.success).length}/${r.length} patients successful`),{results:r,errors:o}}chunkArray(t,s){const a=[];for(let i=0;i<t.length;i+=s)a.push(t.slice(i,i+s));return a}async processIndividualPatientEnhanced(t,s,a){const i=Date.now();this.currentProcessingContext={patient:t};const r={operation:"process-patient",patientIndex:s,patient:t,timestamp:i,environmentState:await this.getCurrentEnvironmentState(),previousAttempts:0};try{const o=`patient-${s}`;this.config.enableMetrics&&this.metricsCollector.startOperation(o,"patient-processing",s),a?.("navigating","activating-patient"),this.log(`üñ±Ô∏è Activating patient ${s}: ${t.name} (${t.fileNumber})`),await this.errorRecovery.executeWithRecovery(()=>this.activatePatientWithIntelligentWaiting(s),{...r,operation:"patient-activation"}),a?.("waiting-for-load","patient-data-loading");const l=await this.getCurrentTabId(),d=await this.dynamicWait.waitForPatientDataLoad(l,t.name);if(!d.success)throw new Error(`Patient data failed to load: ${d.error}`);a?.("extracting","clinical-data-extraction"),this.log(`üìã Extracting clinical data for: ${t.name}`);const m=await this.errorRecovery.executeWithRecovery(()=>this.extractPatientDataEnhanced(l,t),{...r,operation:"data-extraction"});a?.("reviewing","ai-medical-review"),m.dataCompleteness&&!m.dataCompleteness.hasRealData?this.log(`ü§ñ Running AI review for ${t.name} (incomplete data - ${m.dataCompleteness.emptyFieldCount}/${m.dataCompleteness.totalFields} fields empty)`):this.log(`ü§ñ Running AI review for: ${t.name}`);const x=await this.errorRecovery.executeWithRecovery(()=>this.performAIReviewWithCaching(m,t),{...r,operation:"ai-review"}),g=Date.now()-i;return this.config.enableMetrics&&this.metricsCollector.endOperation(o,"patient-processing",!0,s,{processingTime:g,dataQuality:m.qualityScore}),{patient:t,reviewReport:x,extractedData:m,processingTime:g,success:!0}}catch(o){const l=Date.now()-i;throw this.log(`‚ùå Failed to process patient ${t.name}:`,o),this.config.enableMetrics&&this.metricsCollector.endOperation(`patient-${s}`,"patient-processing",!1,s,{processingTime:l,error:o instanceof Error?o.message:String(o)}),o}finally{this.currentProcessingContext=null}}async activatePatientWithIntelligentWaiting(t){const s=await this.getCurrentTabId(),a=this.getCurrentProcessingContext();if(!a?.patient)throw new Error("No patient context available for activation");const i=a.patient;try{this.log(`üëÜ SPA Workflow: Starting patient processing for ${i.name} (${i.fileNumber})`),this.log(`üëÜ Step 1: Double-clicking patient ${i.name}`);const r=await this.sendMessageWithTimeout(s,{type:"EXECUTE_ACTION",action:"double-click-patient",data:{patientName:i.name,patientId:i.fileNumber}},1e4);if(!r?.success)throw new Error(`Double-click patient failed: ${r?.error||"Unknown error"}`);this.log("üè• Step 2: Navigating to Patient Record view");const o=await this.sendMessageWithTimeout(s,{type:"EXECUTE_ACTION",action:"navigate-to-patient-record",data:{}},15e3);if(!o?.success)throw new Error(`Navigate to patient record failed: ${o?.error||"Unknown error"}`);await this.waitForPatientDataReady(s,i.name),this.log(`‚úÖ SPA Workflow: Patient ${i.name} activated and Patient Record view ready`)}catch(r){throw this.log("‚ùå SPA Workflow activation failed:",r),new Error(`SPA patient activation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}getCurrentProcessingContext(){return this.currentProcessingContext||null}async waitForPatientDataReady(t,s){this.log(`‚è≥ Waiting for patient data to load for: ${s}`);for(let r=0;r<30;r++)try{const o=await this.sendMessageWithTimeout(t,{type:"CHECK_XESTRO_BOXES"},3e3);if(o?.found&&o.count>0){this.log(`‚úÖ Patient data ready after ${(r+1)*500}ms (${o.count} XestroBoxes found)`),await this.sleep(1e3);return}r%5===0&&this.log(`‚è≥ Still waiting for patient data... (attempt ${r+1}/30, ${o?.count||0} XestroBoxes)`),await this.sleep(500)}catch(o){if(this.log(`‚ùå Error checking patient data readiness (attempt ${r+1}):`,o),o instanceof Error&&o.message.includes("message channel")?(this.log("üîß Message channel error detected, waiting longer before retry..."),await this.sleep(500*2)):await this.sleep(500),r===29)throw new Error(`Patient data failed to load after ${30*500}ms: ${o instanceof Error?o.message:"Unknown error"}`)}throw new Error(`Patient data did not load within ${30*500}ms for patient: ${s}`)}async sleep(t){return new Promise(s=>setTimeout(s,t))}async sendMessageWithTimeout(t,s,a=5e3){return new Promise((i,r)=>{const o=setTimeout(()=>{r(new Error(`Message timeout after ${a}ms`))},a);try{chrome.tabs.sendMessage(t,s,l=>{if(clearTimeout(o),chrome.runtime.lastError){r(new Error(`Message failed: ${chrome.runtime.lastError.message}`));return}i(l)})}catch(l){clearTimeout(o),r(l)}})}async extractPatientDataEnhanced(t,s){if(this.config.enableCaching){const a={patientId:s.fileNumber,dataType:"extracted_data"},i=await this.cacheManager.get(a);if(i.hit&&i.data)return this.log(`üíæ Using cached data for patient: ${s.name}`),await this.navigateBackToAppointmentBook(t),i.data}try{this.log(`üìã Step 3: Extracting patient fields for ${s.name}`);const a=await this.sendMessageWithTimeout(t,{type:"EXECUTE_ACTION",action:"extract-patient-fields",data:{}},3e4);if(!a?.success||!a?.data)throw new Error(`Patient fields extraction failed: ${a?.error||"No data returned"}`);const i=a.data,r=i.hasAnyData;this.log(`üìä Data completeness check for ${s.name}:`,{hasAnyData:r,backgroundLength:i.background?.length||0,investigationsLength:i.investigations?.length||0,medicationsLength:i.medications?.length||0});const o=i.background?.trim()?i.background:"No data available in Background section",l=i.investigations?.trim()?i.investigations:"No data available in Investigations section",d=i.medications?.trim()?i.medications:"No data available in Medications section";this.log(`üìù Processed field data for ${s.name}:`,{backgroundMarked:!i.background?.trim(),investigationsMarked:!i.investigations?.trim(),medicationsMarked:!i.medications?.trim(),hasAnyRealData:r});const m={background:o,investigations:l,medications:d,extractionTimestamp:i.extractionTimestamp||Date.now(),extractionAttempts:1,qualityScore:this.calculateDataQuality(i),dataCompleteness:{hasRealData:r,emptyFieldCount:[!i.background?.trim(),!i.investigations?.trim(),!i.medications?.trim()].filter(Boolean).length,totalFields:3}};if(await this.navigateBackToAppointmentBook(t),this.config.enableCaching){const x={patientId:s.fileNumber,dataType:"extracted_data"},g=this.dataValidation.assessDataQuality(m);await this.cacheManager.set(x,m,g)}return this.log(`‚úÖ SPA Workflow: Patient ${s.name} data extraction completed and returned to appointment book`),m}catch(a){this.log("‚ùå SPA Workflow extraction failed:",a);try{await this.navigateBackToAppointmentBook(t)}catch(i){this.log("‚ùå Failed to navigate back to appointment book:",i)}throw new Error(`SPA data extraction failed: ${a instanceof Error?a.message:"Unknown error"}`)}}async navigateBackToAppointmentBook(t){this.log("üìÖ Step 4: Navigating back to Appointment Book");const s=await this.sendMessageWithTimeout(t,{type:"EXECUTE_ACTION",action:"navigate-to-appointment-book",data:{}},15e3);if(!s?.success)throw new Error(`Navigate to appointment book failed: ${s?.error||"Unknown error"}`)}calculateDataQuality(t){let s=0,a=0;return["background","investigations","medications"].forEach(r=>{a++;const o=t[r]||"";o.trim().length>0&&(s+=1,o.trim().length>50&&(s+=.5))}),Math.min(s/(a*1.5),1)}async performAIReviewWithCaching(t,s){if(this.config.enableCaching){const r={patientId:s.fileNumber,dataType:"ai_review"},o=await this.cacheManager.get(r);if(o.hit&&o.data&&!await this.cacheManager.hasChanged({patientId:s.fileNumber,dataType:"extracted_data"},t))return this.log(`üíæ Using cached AI review for patient: ${s.name}`),o.data}const a=this.formatReviewInput(t,s);await this.loadAgent();const i=await this.batchPatientReviewAgent.process(a);if(this.config.enableCaching){const r={patientId:s.fileNumber,dataType:"ai_review"};await this.cacheManager.set(r,i)}return i}createEnhancedProgress(t,s,a,i,r,o){const d=Date.now()-o,m=i.filter(w=>w.success).length,x=t>0?d/t:0,u=(s-t)*x,v=s>0?t/s*100:0,p=this.config.enableMetrics?this.metricsCollector.getPerformanceIndicators():{averageTimePerPatient:x,successRate:t>0?m/t:1,currentSpeed:"normal",errorRate:t>0?r.length/t:0,memoryUsage:0};return{currentPatientIndex:t,totalPatients:s,currentPatient:a,phase:"navigating",completedPatients:i,errors:r,percentComplete:v,estimatedTimeRemaining:u,currentOperationDetails:a?`Processing ${a.name} (${a.fileNumber})`:"Initializing...",performanceIndicators:p}}async generateEnhancedBatchReport(t,s,a,i){const r=s.filter(v=>v.success),o=s.filter(v=>!v.success);let l=null;this.config.enableMetrics&&(l=this.metricsCollector.endSession());let d=0,m=0,x=0;const g=[];return r.forEach(v=>{if(v.reviewReport?.reviewData){const p=v.reviewReport.reviewData;d+=p.findings?.length||0,m+=p.findings?.filter(w=>w.urgency==="Immediate").length||0,x+=p.medicationSafetyIssues||0,p.findings?.forEach(w=>{w.finding&&!g.includes(w.finding)&&g.push(w.finding)})}}),{id:`batch-${Date.now()}`,agentName:"Enhanced Batch AI Review Orchestrator v3.0",content:`Enhanced batch AI medical review completed for ${t.selectedPatients.length} patients on ${t.appointmentDate}`,sections:[],metadata:{confidence:r.length/t.selectedPatients.length,processingTime:i-a,modelUsed:"BatchPatientReviewAgent",enhancedFeatures:{intelligentWaiting:!0,dataValidation:!0,errorRecovery:!0,caching:this.config.enableCaching,checkpointing:this.config.enableCheckpoints,metrics:this.config.enableMetrics}},timestamp:i,warnings:o.map(v=>`Failed to process ${v.patient.name}: ${v.error}`),errors:o.map(v=>v.error||"Unknown error"),batchData:{appointmentDate:t.appointmentDate,totalPatients:t.selectedPatients.length,successfulReviews:r.length,failedReviews:o.length,processingStartTime:a,processingEndTime:i,patientResults:s,summary:{totalFindings:d,immediateFindings:m,medicationSafetyIssues:x,commonFindings:g.slice(0,10)},enhancedMetrics:l}}}async checkForResumableCheckpoint(t){if(!this.config.enableCheckpoints)return null;try{const s=await this.checkpointManager.listCheckpoints(t);if(s.length>0){const a=s[0];return this.log(`üìÇ Found resumable checkpoint: ${a.id}`),await this.checkpointManager.loadCheckpoint(a.id)}}catch(s){this.log("‚ùå Error checking for resumable checkpoint:",s)}return null}async handleResumeOption(t,s){return this.log(`üîÑ Auto-resuming from checkpoint with ${t.completedPatients.length} completed patients`),!0}async saveProgressCheckpoint(t,s,a,i,r){if(!(!this.config.enableCheckpoints||!this.currentBatchId))try{const o=await this.getCurrentEnvironmentState(),l=this.config.enableMetrics?this.metricsCollector.getMetrics():this.createEmptyMetrics(),d=await this.checkpointManager.saveCheckpoint(this.currentBatchId,t,s,a,[],this.getBatchConfiguration(),l,o);this.log(`üíæ Saved checkpoint: ${d} (${s.length} patients completed)`)}catch(o){this.log("‚ùå Failed to save checkpoint:",o)}}async getCurrentTabId(){const t=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t[0]?.id)throw new Error("No active tab found");return t[0].id}async getCurrentEnvironmentState(){const t=await chrome.tabs.query({active:!0,currentWindow:!0});return{tabId:t[0]?.id||0,currentUrl:t[0]?.url||"",contentScriptVersion:"2.6.0",lastHealthCheck:Date.now()}}formatReviewInput(t,s){let a="";if(t.dataCompleteness){const{hasRealData:i,emptyFieldCount:r,totalFields:o}=t.dataCompleteness;i?r>0&&(a=`

DATA COMPLETENESS NOTE: ${r}/${o} clinical sections are incomplete. Consider if missing information is clinically significant.`):a=`

DATA COMPLETENESS ALERT: This patient record has ${r}/${o} empty clinical sections. Please assess if missing data represents a clinical oversight or if additional data collection is needed.`}return`Patient: ${s.name} (DOB: ${s.dob}, File: ${s.fileNumber})

Background: ${t.background}

Investigations: ${t.investigations}

Medications: ${t.medications}${a}`}generateBatchId(t){return`batch-${t.appointmentDate}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getBatchConfiguration(){return{maxRetries:this.config.retryAttempts,timeoutMs:this.config.timeoutMs,parallelProcessing:this.config.parallelProcessing,cacheEnabled:this.config.enableCaching,diagnosticsEnabled:this.config.enableAdvancedDiagnostics,checkpointInterval:this.config.checkpointInterval,errorRecoveryStrategy:"conservative"}}createEmptyMetrics(){return{sessionId:this.currentBatchId||"",batchStartTime:Date.now(),patientActivationTimes:[],dataExtractionTimes:[],aiReviewTimes:[],contentScriptResponseTimes:[],totalProcessingTime:0,retryCount:new Map,errorFrequency:new Map,memoryUsageHistory:[],operationTimings:[]}}async finalizeProcessing(){this.isProcessing=!1,this.abortController=null,this.currentBatchId=null,this.config.enableCaching&&await this.cacheManager.applyInvalidationRules(),this.log("üèÅ Batch processing finalized")}getDefaultConfig(){return{enableCheckpoints:!0,checkpointInterval:5,enableCaching:!0,enableMetrics:!0,enableAdvancedDiagnostics:!1,parallelProcessing:!0,maxConcurrentOperations:3,timeoutMs:3e5,retryAttempts:3}}updateConfig(t){Object.assign(this.config,t),this.dynamicWait.setDebugMode(t.enableAdvancedDiagnostics||!1),this.dataValidation.setDebugMode(t.enableAdvancedDiagnostics||!1),this.errorRecovery.setDebugMode(t.enableAdvancedDiagnostics||!1),this.cacheManager.setDebugMode(t.enableAdvancedDiagnostics||!1),this.checkpointManager.setDebugMode(t.enableAdvancedDiagnostics||!1),this.metricsCollector.setDebugMode(t.enableAdvancedDiagnostics||!1)}getConfig(){return{...this.config}}async validateAppointmentBookState(t,s){const a=await this.getCurrentTabId();this.log(`üîç Validating appointment book state for patient ${s}: ${t.name}`);try{const i=await this.sendMessageWithTimeout(a,{type:"EXECUTE_ACTION",action:"extract-calendar-patients",data:{}},1e4);if(!i?.success||!i?.data?.patients){this.log("‚ö†Ô∏è WARNING: Could not validate current patient list");return}const r=i.data.patients;if(this.log(`üîç Current appointment book has ${r.length} patients`),this.log("üîç Current patient list:",r.map((o,l)=>({index:l,name:o.name,fileNumber:o.fileNumber,dob:o.dob}))),s<r.length){const o=r[s];if(this.log(`üîç Expected patient at index ${s}:`,{name:t.name,fileNumber:t.fileNumber,dob:t.dob}),this.log(`üîç Actual patient at index ${s}:`,{name:o.name,fileNumber:o.fileNumber,dob:o.dob}),o.fileNumber!==t.fileNumber)throw this.log("üö® CRITICAL ERROR: Patient mismatch detected!"),this.log(`üö® Expected: ${t.name} (${t.fileNumber})`),this.log(`üö® Found: ${o.name} (${o.fileNumber})`),new Error(`Patient list state corrupted. Expected ${t.name} but found ${o.name} at index ${s}`);this.log(`‚úÖ Patient validation successful: ${t.name} is at correct position ${s}`)}else throw this.log(`üö® CRITICAL ERROR: Patient index ${s} is out of bounds (current list has ${r.length} patients)`),new Error(`Patient index ${s} is out of bounds for current appointment book`)}catch(i){throw this.log("‚ùå Patient validation failed:",i),new Error(`Patient validation failed: ${i instanceof Error?i.message:"Unknown error"}`)}}log(...t){console.log("[Enhanced BatchAIReviewOrchestrator]",...t)}async getAvailableCheckpoints(){return this.checkpointManager.listCheckpoints()}async deleteCheckpoint(t){return this.checkpointManager.deleteCheckpoint(t)}async exportMetrics(){if(!this.config.enableMetrics)throw new Error("Metrics collection is disabled");const t=this.metricsCollector.generateReport();return this.metricsCollector.exportMetrics(t)}async clearCaches(){return this.cacheManager.clear()}getDetailedStats(){return{processing:this.getProcessingStats(),cache:this.config.enableCaching?this.cacheManager.getCacheInfo():null,errors:this.errorRecovery.getFailureStats(),metrics:this.config.enableMetrics?this.metricsCollector.getMetrics():null}}}const sl={background:"background","investigation-summary":"investigation-summary",medication:"medications",bloods:null,imaging:null,tavi:null,"angiogram-pci":null,mteer:null,tteer:null,"pfo-closure":null,"asd-closure":null,"pvl-plug":null,"bypass-graft":null,"right-heart-cath":null,"tavi-workup":null,"quick-letter":null,consultation:null,"ai-medical-review":null,"batch-ai-review":null,"aus-medical-review":null,"patient-education":null,"ohif-viewer":null,enhancement:null,transcription:null,generation:null},al={background:"Background","investigation-summary":"Investigation Summary",medications:"Medications (Problem List for Phil)","social-history":"Social & Family History"};function Ia(n){return n&&sl[n]||null}function Dn(n){return al[n]||n}function As(n){return n!==null&&Ia(n)!==null}class It{static instance;config={minSimilarityScore:.8,caseSensitive:!1,ignoreTitles:!0,allowPartialMatches:!0,enabled:!0};constructor(){G.debug("PatientNameValidator initialized")}static getInstance(){return It.instance||(It.instance=new It),It.instance}updateConfig(t){this.config={...this.config,...t},G.debug("PatientNameValidator config updated:",this.config)}validatePatientNames(t,s){const a=[];if(!this.config.enabled)return{sessionPatientName:t,emrPatientName:s,similarityScore:1,isMatch:!0,confidence:"high",normalizedSessionName:t,normalizedEmrName:s,warnings:["Validation disabled"]};if(!t||!s)return a.push("Missing patient name data"),{sessionPatientName:t||"Unknown",emrPatientName:s||"Unknown",similarityScore:0,isMatch:!1,confidence:"low",normalizedSessionName:"",normalizedEmrName:"",warnings:a};(this.isFallbackPatientName(t)||this.isFallbackPatientName(s))&&a.push("Fallback patient name detected - validation may be unreliable");const i=this.normalizeName(t),r=this.normalizeName(s),o=this.calculateSimilarity(i,r),l=o>=this.config.minSimilarityScore;let d;o>=.95?d="high":o>=.75?d="medium":d="low",l||(o>.5?a.push("Names are similar but not identical - possible transcription variation"):a.push("Names appear to be completely different"));const m={sessionPatientName:t,emrPatientName:s,similarityScore:o,isMatch:l,confidence:d,normalizedSessionName:i,normalizedEmrName:r,warnings:a};return G.debug("Patient name validation result:",m),m}normalizeName(t){if(!t)return"";let s=t.trim();return this.config.ignoreTitles&&(s=s.replace(/^(Mr\.?|Mrs\.?|Ms\.?|Dr\.?|Miss)\s+/i,"")),s=s.replace(/\s*\(\d+\)$/,""),s=s.replace(/\s*\(Session-\d+\)$/,""),s=s.replace(/\s+/g," ").trim(),this.config.caseSensitive||(s=s.toLowerCase()),s}calculateSimilarity(t,s){if(!t||!s)return 0;if(t===s)return 1;if(this.config.allowPartialMatches){const r=t.length>s.length?t:s,o=t.length>s.length?s:t;if(r.includes(o)&&o.length>=3)return .85}const a=this.levenshteinDistance(t,s),i=Math.max(t.length,s.length);return i===0?1:1-a/i}levenshteinDistance(t,s){const a=[];for(let i=0;i<=s.length;i++)a[i]=[i];for(let i=0;i<=t.length;i++)a[0][i]=i;for(let i=1;i<=s.length;i++)for(let r=1;r<=t.length;r++)s.charAt(i-1)===t.charAt(r-1)?a[i][r]=a[i-1][r-1]:a[i][r]=Math.min(a[i-1][r-1]+1,a[i][r-1]+1,a[i-1][r]+1);return a[s.length][t.length]}isFallbackPatientName(t){return t?[/^Patient \d+/i,/^Patient \d+ \(\d{1,2}:\d{2}\)$/i,/^Session-\d+$/i,/^Unknown$/i,/^Patient$/i].some(a=>a.test(t.trim())):!0}getValidationExplanation(t){return this.config.enabled?t.isMatch?`Patient names match with ${Math.round(t.similarityScore*100)}% confidence.`:t.similarityScore>.5?`Patient names are similar (${Math.round(t.similarityScore*100)}% match) but may represent different patients or transcription variations.`:`Patient names appear to be different (${Math.round(t.similarityScore*100)}% match). You may be inserting into the wrong patient file.`:"Patient name validation is disabled."}shouldSkipValidation(t,s){if(!this.config.enabled)return!0;if(this.isFallbackPatientName(t)&&this.isFallbackPatientName(s))return G.debug("Skipping validation - both names are fallback names"),!0;const a=3;return t.trim().length<a||s.trim().length<a?(G.debug("Skipping validation - names too short to validate"),!0):!1}}const Rs=It.getInstance();function il(n){const{onRecordingComplete:t,onVoiceActivityUpdate:s,onRecordingTimeUpdate:a,onError:i,selectedMicrophoneId:r,getMicrophoneId:o}=n,[l,d]=c.useState({isRecording:!1,isPaused:!1,recordingTime:0,voiceActivityLevel:0,frequencyData:[],hasPermission:null,isRequestingPermission:!1,activeDeviceInfo:null,audioLevelHistory:[]}),m=c.useRef(null),x=c.useRef(null),g=c.useRef(null),u=c.useRef(null),v=c.useRef([]),p=c.useRef(),w=c.useRef(),b=c.useRef(!1),P=c.useCallback(async()=>{try{const A=g.current,O=x.current;if(!A){console.log("üîá detectVoiceActivity: analyser is null");return}if(!b.current){console.log("üîá detectVoiceActivity: not recording (ref check)");return}if(!O){console.log("üîá detectVoiceActivity: audio context is null");return}if(O.state!=="running")if(console.log("üîá detectVoiceActivity: audio context state is",O.state),O.state==="suspended"){console.log("üé§ Attempting to resume suspended audio context...");try{await O.resume(),console.log("‚úÖ Audio context resumed successfully")}catch(q){console.error("‚ùå Failed to resume audio context:",q);return}}else return;const S=A.frequencyBinCount,f=new Uint8Array(S);A.getByteFrequencyData(f),!(Math.max(...f)>0)&&Math.random()<.05&&console.warn("‚ö†Ô∏è No audio data detected in frequency analysis:",{contextState:O.state,analyserFftSize:A.fftSize,bufferLength:S,isRecording:b.current});const M=f.reduce((q,ne)=>q+ne,0)/S,_=Math.min(M/128,1),F=64,U=[],X=Math.floor(S/F);for(let q=0;q<F;q++){let ne=0;const be=q*X,ve=Math.min(be+X,S);for(let ye=be;ye<ve;ye++)ne+=f[ye];const _e=Math.min(ne/(ve-be)/128,1);U.push(Math.pow(_e,.7))}d(q=>{const ne=[...q.audioLevelHistory,_].slice(-30),ve=(ne.length>10?ne.slice(-10).reduce((_e,ye)=>_e+ye,0)/10:0)>.01||_>.05;return _>.1&&Math.random()<.001&&console.log("üé§ Audio Debug:",{level:Math.round(_*100)+"%",frequencyBars:U.length,avgFreq:Math.round(U.reduce((_e,ye)=>_e+ye,0)/U.length*100)+"%",maxFreq:Math.round(Math.max(...U)*100)+"%"}),{...q,voiceActivityLevel:_,frequencyData:U,audioLevelHistory:ne,activeDeviceInfo:q.activeDeviceInfo?{...q.activeDeviceInfo,isWorking:ve}:null}}),s?.(_,U),b.current&&(p.current=requestAnimationFrame(()=>P()))}catch(A){console.error("üîá detectVoiceActivity error:",A),b.current&&(p.current=requestAnimationFrame(()=>P()))}},[s]),R=c.useCallback(()=>{d(A=>({...A,recordingTime:0})),w.current=setInterval(()=>{d(A=>{const O=A.recordingTime+1;return a?.(O),{...A,recordingTime:O}})},1e3)},[a]),j=c.useCallback(()=>{w.current&&(clearInterval(w.current),w.current=void 0)},[]),h=c.useCallback(async()=>{try{const A=await navigator.permissions.query({name:"microphone"});d(O=>({...O,hasPermission:A.state==="granted"})),A.addEventListener("change",()=>{d(O=>({...O,hasPermission:A.state==="granted"}))})}catch{d(O=>({...O,hasPermission:null}))}},[]),N=c.useCallback(async()=>{console.log("üé§ useRecorder.startRecording() called"),d(A=>({...A,isRequestingPermission:!0}));try{const A=o?.()||r,O={audio:A?{deviceId:{exact:A},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}};let S;try{S=await navigator.mediaDevices.getUserMedia(O)}catch(U){if(A){console.warn("‚ö†Ô∏è Exact device constraint failed, attempting fallback:",{requestedDevice:A,error:U?.message||"Unknown error"});const X={audio:{deviceId:A,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}};try{S=await navigator.mediaDevices.getUserMedia(X),console.log("‚úÖ Fallback constraint succeeded")}catch(q){throw console.error("‚ùå Both exact and fallback constraints failed:",q),q}}else throw U}u.current=S;const f=S.getAudioTracks();let T=null;if(f.length>0){const U=f[0],X=U.getSettings(),q=U.getConstraints();if(T={label:U.label||"Unknown Microphone",deviceId:X.deviceId||"unknown",isWorking:!1,hasMismatch:!1},console.log("üé§ Audio device details:",{label:U.label,deviceId:X.deviceId,requestedDeviceId:A,sampleRate:X.sampleRate,channelCount:X.channelCount,constraints:q,deviceMatch:X.deviceId===A}),A&&X.deviceId!==A){const ne={requested:A,actual:X.deviceId,actualLabel:U.label,isExactConstraint:q.deviceId&&typeof q.deviceId=="object"&&"exact"in q.deviceId,isDefaultDevice:X.deviceId==="default"||!X.deviceId};console.warn("‚ö†Ô∏è Device mismatch detected:",ne),ne.isDefaultDevice?(console.warn("üí° Falling back to system default microphone"),console.warn("   - AirPods may not be properly connected or available"),console.warn("   - Check Bluetooth connection and system audio settings")):(console.warn("üí° Using different device than requested:"),console.warn(`   - Requested: ${A}`),console.warn(`   - Actually using: "${U.label}" (${X.deviceId})`),console.warn("   - This may indicate device availability issues")),T&&(T.hasMismatch=!0,T.requestedDeviceId=A)}else A&&(console.log("‚úÖ Device match confirmed:",{requested:A,actual:X.deviceId,label:U.label}),T&&(T.hasMismatch=!1))}b.current=!0,d(U=>({...U,hasPermission:!0,isRequestingPermission:!1,isRecording:!0,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:T,audioLevelHistory:[]}));const k=new AudioContext,M=k.createMediaStreamSource(S),_=k.createAnalyser();_.fftSize=256,_.smoothingTimeConstant=.8,M.connect(_),console.log("üé§ Web Audio API setup:",{contextState:k.state,analyserFFTSize:_.fftSize,frequencyBinCount:_.frequencyBinCount,sampleRate:k.sampleRate}),x.current=k,g.current=_,k.state==="suspended"&&(console.log("üé§ Resuming suspended audio context..."),await k.resume());const F=new MediaRecorder(S,{mimeType:"audio/webm;codecs=opus"});v.current=[],F.ondataavailable=U=>{U.data.size>0&&v.current.push(U.data)},F.onstop=()=>{const U=new Blob(v.current,{type:"audio/webm;codecs=opus"});console.log("üé§ Audio recording completed:",{size:U.size,type:U.type,chunks:v.current.length,recordingTime:l.recordingTime}),t(U),E()},F.start(100),m.current=F,R(),setTimeout(async()=>{console.log("üé§ Starting voice activity detection..."),await P()},100)}catch(A){console.error("üé§ Recording start failed:",A),b.current=!1,d(O=>({...O,hasPermission:!1,isRequestingPermission:!1})),i?.(A)}},[r,t,i,P,R,l.recordingTime]),C=c.useCallback(()=>{console.log("üõë useRecorder.stopRecording() called"),b.current=!1,m.current&&m.current.state==="recording"&&m.current.stop(),d(A=>({...A,isRecording:!1})),j(),p.current&&(cancelAnimationFrame(p.current),p.current=void 0)},[j]),E=c.useCallback(()=>{b.current=!1,j(),p.current&&(cancelAnimationFrame(p.current),p.current=void 0),m.current&&m.current.state==="recording"&&m.current.stop(),u.current&&(u.current.getTracks().forEach(A=>A.stop()),u.current=null),x.current&&(x.current.close(),x.current=null),d(A=>({...A,isRecording:!1,voiceActivityLevel:0,frequencyData:[],activeDeviceInfo:null,audioLevelHistory:[]}))},[j]);return ue.useEffect(()=>(h(),E),[h,E]),{...l,startRecording:N,stopRecording:C,cleanup:E}}function Is(n){return n.trim().replace(/[-‚Äì‚Äî]+\s*$/,"").trim()}function rl(n){return n.replace(/\s+/g," ").replace(/\.\s*\./g,".").replace(/;\s*;/g,";").replace(/,\s*,/g,",").trim()}function ol(n){const t=[];return n.toLowerCase(),[/(?:ejection fraction|ef)\s+(?:of\s+)?(\d+%?)/gi,/(?:blood pressure|bp)\s+(?:of\s+)?(\d+\/\d+)/gi,/(?:heart rate|hr)\s+(?:of\s+)?(\d+)/gi,/(?:chest pain|dyspnoea|palpitations|dizziness|syncope)/gi,/(?:atrial fibrillation|af|coronary artery disease|cad|heart failure|hypertension)/gi,/(?:aspirin|metoprolol|ramipril|atorvastatin|warfarin|apixaban)/gi].forEach(a=>{const i=n.match(a);i&&i.forEach(r=>{t.some(o=>o.toLowerCase().includes(r.toLowerCase()))||t.push(r)})}),n.includes("normal")&&(n.includes("ejection fraction")||n.includes("ef"))&&t.push("Normal EF"),t}function ll(n){const t=n.split(/[.!?]+/).filter(i=>i.trim().length>15),a=t.filter(i=>{const r=i.toLowerCase();return!r.includes("thank you")&&!r.includes("dear")&&!r.includes("kind regards")&&!r.includes("yours sincerely")&&!r.includes("best wishes")}).slice(0,3);return a.length===0?t.length>0?t[0].trim()+".":"No summary available.":a.join(". ").trim()+"."}function cl(n){const t=ol(n);if(t.length>0){const s=[],a=t.filter(o=>/(?:atrial fibrillation|af|coronary artery disease|cad|heart failure|hypertension)/i.test(o)),i=t.filter(o=>/(?:ejection fraction|blood pressure|heart rate)/i.test(o)),r=t.filter(o=>/(?:chest pain|dyspnoea|palpitations|dizziness|syncope)/i.test(o));if(a.length>0&&s.push(`Patient with ${a.slice(0,2).join(" and ")}`),r.length>0&&s.push(`presenting with ${r.slice(0,2).join(" and ")}`),i.length>0&&s.push(`${i.slice(0,2).join(", ")}`),s.length>0)return s.join(". ")+"."}return ll(n)}function Ma(n){try{console.log("üîß Parsing QuickLetter structured response for SUMMARY: and LETTER: markers");const t=n.indexOf("SUMMARY:"),s=n.indexOf("LETTER:");if(console.log("üîç Found SUMMARY: at index:",t),console.log("üîç Found LETTER: at index:",s),t!==-1&&s!==-1&&t<s){console.log("‚úÖ Found both SUMMARY: and LETTER: markers in correct order");const l=n.substring(t+8,s).trim(),d=n.substring(s+7).trim();console.log("üìã Extracted summary raw:",l.substring(0,100)+"..."),console.log("üìù Extracted letter content length:",d.length);const m=Is(l);return console.log("üßπ Cleaned summary:",m),{summary:m,letterContent:d}}console.log("üîç Checking for legacy --- divider pattern");const a=n.match(/SUMMARY:\s*([\s\S]+?)(?=---)/),i=n.match(/LETTER:\s*([\s\S]*)/);if(a&&i){console.log("‚úÖ Found legacy pattern with --- divider");const l=Is(a[1].trim()),d=i[1].trim();return{summary:l,letterContent:d}}console.log("‚ö†Ô∏è No SUMMARY:/LETTER: markers found, using fallback parsing"),console.log("üìÑ Raw output for fallback:",n.substring(0,200)+"...");const r=cl(n),o=r.length>150?r.substring(0,147)+"...":r;return console.log("üîÑ Generated fallback summary:",o),console.log("üìù Using entire output as letter content (length:",n.length,")"),{summary:o,letterContent:n}}catch(t){console.warn("‚ùå Error parsing structured response:",t);const s=n.length>150?n.substring(0,147)+"...":n;return console.log("üö® Using emergency fallback parsing"),{summary:s,letterContent:n}}}function dl(n){const{summary:t}=Ma(n);return rl(t)}const Da=c.memo(()=>e.jsx(hi,{children:e.jsx(wi,{children:e.jsx(Oa,{})})})),Oa=c.memo(()=>{const{state:n,actions:t,selectors:s}=tl(),a=Gs(),i={patientEducation:s.isOverlayActive("patient-education"),patientSelection:s.isOverlayActive("patient-selection"),screenshotAnnotation:s.isOverlayActive("screenshot-annotation"),bpDiaryImporter:s.isOverlayActive("bp-diary-importer"),patientMismatch:s.isOverlayActive("patient-mismatch"),fieldIngestion:s.isOverlayActive("field-ingestion"),processingPhase:s.isOverlayActive("processing-phase")},r=s.isSidePanelOpen("metrics-dashboard"),o=c.useRef(null),l=c.useRef(null),d=c.useRef(null),m=c.useRef(0),x=c.useRef(null),g=c.useRef(null),u=c.useRef(null),v=c.useRef(Vs.getInstance()).current,p=c.useRef(bi.getInstance()).current,w=c.useRef(null),b=c.useRef(null),P=c.useRef(null),R=c.useRef(null),j=il({onRecordingComplete:y=>{if(P.current)return P.current(y)},onVoiceActivityUpdate:(y,I)=>{R.current&&R.current(y,I)},onRecordingTimeUpdate:c.useCallback(y=>{m.current=y},[]),getMicrophoneId:()=>a.selectedMicrophoneId}),h=c.useMemo(()=>(j.isRecording||l.current!==null,n.selectedSessionId),[n.selectedSessionId,j.isRecording]),N=c.useMemo(()=>h?n.patientSessions.find(I=>I.id===h)?.patient?.name:void 0,[h,n.patientSessions]),C=c.useCallback(()=>{g.current&&(g.current.abort(),g.current=null),t.streamCancelled(),t.setStreaming(!1),t.setAiGeneratedSummary(void 0)},[t]),E=c.useCallback(async y=>{try{const{systemPromptLoader:I}=await Pe(async()=>{const{systemPromptLoader:D}=await import("./chunks/agents.D9VU8YWQ.js").then(H=>H.S);return{systemPromptLoader:D}},__vite__mapDeps([5,6]));return await I.loadSystemPrompt(y,"primary")}catch(I){return console.error("Failed to load system prompt for agent:",y,I),null}},[]);c.useCallback(async y=>{try{switch(y){case"quick-letter":return(await Pe(()=>import("./chunks/QuickLetterSystemPrompts.C78rrURy.js"),[])).QUICK_LETTER_SYSTEM_PROMPTS.primary;case"investigation-summary":return(await Pe(()=>import("./chunks/InvestigationSummarySystemPrompts.BNAkynnH.js"),__vite__mapDeps([11,5,6]))).INVESTIGATION_SUMMARY_SYSTEM_PROMPTS.primary;case"background":return(await Pe(()=>import("./chunks/BackgroundSystemPrompts.Dx0p2kfn.js"),[])).BACKGROUND_SYSTEM_PROMPTS.primary;case"medication":return(await Pe(()=>import("./chunks/MedicationSystemPrompts.CVwqQxnq.js"),__vite__mapDeps([12,5,6]))).MEDICATION_SYSTEM_PROMPTS.primary;case"bloods":return(await Pe(()=>import("./chunks/agents.D9VU8YWQ.js").then(D=>D.B),__vite__mapDeps([5,6]))).BLOODS_SYSTEM_PROMPTS.primary;case"imaging":return(await Pe(()=>import("./chunks/agents.D9VU8YWQ.js").then(D=>D.I),__vite__mapDeps([5,6]))).IMAGING_SYSTEM_PROMPTS.primary;default:return null}}catch(I){return console.warn("Failed to load system prompt for agent",y,I),null}},[]);const A=y=>{switch(y){case"investigation-summary":return{model:zt.QUICK_MODEL,maxTokens:2e3};case"background":return{model:zt.QUICK_MODEL,maxTokens:2e3};case"medication":return{model:zt.QUICK_MODEL,maxTokens:3e3};case"quick-letter":return{model:zt.REASONING_MODEL,maxTokens:5e3};default:return{model:zt.REASONING_MODEL,maxTokens:4e3}}},O=c.useCallback(async(y,I,D)=>{const H=await E(I);if(!H)return!1;t.clearStream(),t.setStreaming(!0),t.setProcessingStatus("processing");const $=new AbortController;g.current=$;const{model:z,maxTokens:K}=A(I);let je=null;const L=performance.now();return await vi({model:z,messages:[{role:"system",content:H},{role:"user",content:D}],temperature:.3,maxTokens:K,signal:$.signal,onMessage:B=>{je==null&&B?.choices?.[0]?.delta?.content&&(je=Math.round(performance.now()-L),t.setTTFT(je))},onToken:B=>{t.appendStreamChunk(B)},onEnd:(B,ie)=>{let te,ee=B;if(I==="quick-letter")try{const re=Ma(B);te=re.summary,ee=re.letterContent,console.log("üìã Parsed QuickLetter streaming output:"),console.log("   Summary:",te.substring(0,100)+"..."),console.log("   Letter content length:",ee.length)}catch(re){console.warn("‚ö†Ô∏è Failed to parse QuickLetter output:",re),te=dl(B),ee=B}t.streamDone(ee,ie,je),te&&t.setAiGeneratedSummary(te),I==="quick-letter"&&(console.log("üîç Streaming completion: detecting missing information for QuickLetter"),(async()=>{try{const{QuickLetterAgent:re}=await Pe(async()=>{const{QuickLetterAgent:nt}=await import("./chunks/agents.D9VU8YWQ.js").then(se=>se.Q);return{QuickLetterAgent:nt}},__vite__mapDeps([5,6])),Te=new re,ce=D.toLowerCase(),Me={letter_type:"general",missing_purpose:[],missing_clinical:[],missing_recommendations:[],completeness_score:"80%"};!ce.includes("refer")&&!ce.includes("follow up")&&!ce.includes("consultation")&&!ce.includes("thank you")&&Me.missing_purpose.push("Letter purpose or reason for correspondence"),!ce.includes("patient")&&!ce.includes("gentleman")&&!ce.includes("lady")&&!ce.includes("year old")&&!ce.includes("age")&&Me.missing_clinical.push("Patient demographics or context"),!ce.includes("examination")&&!ce.includes("found")&&!ce.includes("shows")&&!ce.includes("revealed")&&!ce.includes("noted")&&ce.length>100&&Me.missing_clinical.push("Clinical examination findings");const Re=Me.missing_purpose.length+Me.missing_clinical.length+Me.missing_recommendations.length;Re>0?(console.log("üìä Setting missing information from streaming completion:",Re,"items"),t.setMissingInfo(Me)):(console.log("‚úÖ No missing information detected during streaming completion"),t.setMissingInfo(null))}catch(re){console.warn("‚ö†Ô∏è Failed to detect missing information during streaming:",re)}})()),console.log("üèÅ TAVI Completion: Using atomic completion for streaming results"),console.log("üèÅ TAVI State Check: Before atomic completion - Processing:",n.isProcessing,"Status:",n.processingStatus,"Streaming:",n.streaming);try{t.completeProcessingAtomic(y,ee,te),console.log("üèÅ TAVI Completion: Atomic completion done for streaming workflow"),setTimeout(()=>{(n.streaming||n.currentSessionId!==null)&&(console.warn("üö® UI still showing active state after completion - forcing ready state"),t.forceUIReadyState())},1e3)}catch(re){console.error("‚ùå Atomic completion failed for streaming workflow:",re),t.forceUIReadyState()}g.current=null,t.updatePatientSession(y,{results:ee,summary:te,status:"completed",completed:!0,completedTime:Date.now(),processingProgress:{phase:"Complete",progress:100,details:"Streaming finished"}}),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{t.updatePatientSession(y,{processingProgress:void 0}),u.current=null},300)},onError:B=>{B.name==="AbortError"?t.streamCancelled():t.streamError(String(B)),t.setStreaming(!1),t.setAiGeneratedSummary(void 0),g.current=null}}),!0},[t,E]),[S,f]=c.useState(!1);c.useCallback(()=>(w.current||(w.current=new nl),w.current),[]);const T=c.useCallback((y,I,D,H,$)=>{const z=()=>{const K={id:`failed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,audioBlob:y,timestamp:Date.now(),agentType:I,errorMessage:D,transcriptionAttempt:H,metadata:{duration:$||m.current||0,fileSize:y.size,recordingTime:$||m.current||0}};t.setFailedRecordings([K,...n.failedAudioRecordings.slice(0,4)])};"requestIdleCallback"in window?requestIdleCallback(z,{timeout:1e3}):setTimeout(z,0)},[t,n.failedAudioRecordings]);c.useCallback(()=>{t.setFailedRecordings([]),console.log("üóëÔ∏è Cleared all failed audio recordings")},[t]);const k=c.useCallback(async(y,I,D)=>{console.log("üîÑ Starting background processing for session:",y),console.log("üéØ Current selectedSessionId at start:",n.selectedSessionId);const H=new AbortController;t.setUIMode("processing",{sessionId:y,origin:"auto"});try{t.updatePatientSession(y,{transcriptionStartTime:Date.now()}),console.log("üîÑ Queuing transcription for session:",y);const $=Date.now(),z=pt.getInstance(),{AudioProcessingQueueService:K}=await Pe(async()=>{const{AudioProcessingQueueService:oe}=await Promise.resolve().then(()=>fr);return{AudioProcessingQueueService:oe}},void 0),je=K.getInstance(),L=await new Promise((oe,me)=>{je.addJob(y,I,D,{onProgress:(Fe,ns)=>{console.log(`üìä Session ${y} transcription status:`,Fe,ns||""),Fe==="processing"?t.updatePatientSession(y,{status:"transcribing"}):(Fe==="failed"||Fe==="cancelled")&&t.updatePatientSession(y,{status:"error",errors:[ns||"Transcription failed"],completedTime:Date.now(),processingProgress:void 0})},onComplete:Fe=>{console.log("‚úÖ Queued transcription completed for session:",y),oe(Fe)},onError:Fe=>{console.error("‚ùå Queued transcription failed for session:",y,Fe),me(new Error(Fe))}})}),B=Date.now()-$;z.recordMetrics("transcription",B,{agentType:D,audioSize:I.size}),console.log("‚úÖ Transcription complete for session:",y),console.log("üìù Transcription result:",L.substring(0,200)+(L.length>200?"...":""));let ie=L,te=0;try{const me=await os.getInstance().applyPhrasebookCorrections(L,D);ie=me.correctedText,te=me.appliedCorrections,te>0&&(console.log(`üìñ Applied ${te} phrasebook corrections`),fe.getInstance().info(`Applied ${te} terminology correction${te===1?"":"s"}`))}catch(oe){console.warn("‚ö†Ô∏è Failed to apply phrasebook corrections:",oe)}const ee=ie.trim(),re=ee.length<10,Te=ee.length===0,ce=ee.startsWith("[")&&ee.endsWith("]"),Me=ee.toLowerCase().includes("transcription failed")||ee.toLowerCase().includes("server not running")||ee.toLowerCase().includes("timed out");if(Te||re||ce||Me){console.warn("‚ùå Transcription validation failed:",{length:ee.length,isEmpty:Te,tooShort:re,isPlaceholder:ce,isError:Me,preview:ee.substring(0,100)}),setTimeout(()=>{T(I,D,`Transcription validation failed: ${Te?"Empty transcription":re?`Too short (${ee.length} chars)`:ce?"Placeholder response":"Transcription error"}`,ee);const me=Te?"no-audio":re?"too-short":ce?"service-unavailable":"error";cn.transcriptionFailed(me);const Fe=Te?"No audio detected":re?"Recording too short":ce?"Transcription service unavailable":"Transcription service error";t.updatePatientSession(y,{transcription:ee,status:"error",errors:[`Audio transcription failed: ${Fe}`],completedTime:Date.now()}),t.setTranscription(ee),t.setErrors([`Audio transcription failed: ${Fe}`]),t.setProcessingStatus("error")},0),console.log("üö´ Skipping agent processing due to transcription validation failure");return}console.log("‚úÖ Transcription validation passed, proceeding with agent processing");const Re=Date.now();if(t.updatePatientSession(y,{transcription:ie,status:"processing",processingStartTime:Re}),t.setTranscription(ie),t.setProcessingStatus("processing"),t.setTimingData({processingStartTime:Re}),t.setTranscriptionApproval({status:"pending",originalText:L,currentText:L,hasBeenEdited:!1}),await O(y,D,L))return;console.log("üîÑ Processing with agent for session (non-streaming):",y,D);const se=Date.now(),{AgentFactory:pe}=await Pe(async()=>{const{AgentFactory:oe}=await import("./chunks/AgentFactory.Da_RPH1f.js").then(me=>me.a);return{AgentFactory:oe}},__vite__mapDeps([4,2,1,5,6,7,8]));t.updatePatientSession(y,{status:"processing",processingStartTime:Date.now(),processingProgress:{phase:"Starting",progress:0,details:"Initializing agent"}});const he={skipNotification:!0,sessionId:y};D==="tavi-workup"&&(he.onProgress=(oe,me,Fe)=>{console.log(`ü´Ä TAVI Progress: ${oe} (${me}%) - ${Fe||""}`),t.updatePatientSession(y,{status:"processing",processingProgress:{phase:oe||"Processing",progress:Math.max(0,Math.min(100,me)),details:Fe}})});const de=await pe.processWithAgent(D,ie,void 0,H.signal,he),Ft=Date.now()-se;z.recordMetrics("agent-processing",Ft,{agentType:D}),console.log("‚úÖ Agent processing complete for session:",y);const Zn={results:de.content,summary:de.summary||"",agentName:de.agentName,status:"completed",completed:!0,completedTime:Date.now(),processingTime:de.processingTime,warnings:de.warnings,errors:de.errors,processingProgress:{phase:"Complete",progress:100,details:"Processing finished"}};de.taviStructuredSections&&(Zn.taviStructuredSections=de.taviStructuredSections),t.updatePatientSession(y,Zn),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{t.updatePatientSession(y,{processingProgress:void 0}),u.current=null},300),z.recordMetrics("complete",Date.now()-$,{agentType:D});const Nt=y===n.selectedSessionId;if(Nt?(t.setTranscription(L),t.setResults(de.content),t.setMissingInfo(de.missingInfo||null),de.taviStructuredSections&&t.setTaviStructuredSections(de.taviStructuredSections),console.log("üéØ Updated main results panel for currently selected session:",y)):console.log("üîï Background session completed, results stored in session only:",y),D==="bloods")try{console.log("ü©∏ Bloods workflow completed - inserting results into Tests Requested field");const oe={content:de.content};(await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods-insert",data:oe}))?.success?console.log("‚úÖ Blood test results inserted into Tests Requested field successfully"):console.warn("‚ö†Ô∏è Failed to insert blood test results into Tests Requested field")}catch(oe){console.error("‚ùå Failed to insert blood test results into Tests Requested field:",oe)}Nt&&(de.summary&&de.summary.trim()?(G.debug("Setting AI-generated summary",{component:"summary",length:de.summary.length}),t.setAiGeneratedSummary(de.summary)):t.setAiGeneratedSummary(void 0),t.setCurrentAgent(D),console.log("üéØ Updated agent and summary for currently selected session:",y));const es=n.patientSessions.find(oe=>oe.id===y),ts=es?.recordingStartTime?$-es.recordingStartTime:0;if(console.log("üîç Session completion check:",{sessionId:y,currentSelectedSessionId:n.selectedSessionId,isCurrentlySelectedAtCompletion:Nt,willUpdateGlobalUI:Nt}),Nt){t.setTimingData({recordingTime:ts,transcriptionTime:B,agentProcessingTime:Ft,totalProcessingTime:ts+B+Ft,processingStartTime:$}),console.log("üèÅ TAVI Completion: Using atomic completion for background session"),console.log("üèÅ TAVI State Check: Before atomic completion - Processing:",n.isProcessing,"Status:",n.processingStatus,"Streaming:",n.streaming);const oe=de.summary||de.content||"TAVI workup completed";try{t.completeProcessingAtomic(y,de.content,oe),console.log("üèÅ Background completion successful"),setTimeout(()=>{(n.streaming||n.currentSessionId!==null)&&(console.warn("üö® UI still showing active state after background completion - forcing ready state"),t.forceUIReadyState())},1e3)}catch(me){console.error("‚ùå Atomic completion failed for background session:",me),t.forceUIReadyState()}de.missingInfo&&t.setMissingInfo(de.missingInfo),de.taviStructuredSections&&t.setTaviStructuredSections(de.taviStructuredSections),console.log("üèÅ TAVI Completion: Atomic completion done for background workflow"),console.log("üéØ Updated global UI state for currently selected session:",y)}else console.log("üîï Background session completed, skipping global UI state updates for:",y);console.log("‚úÖ Session completed in background:",y);try{const oe=n.patientSessions.find(me=>me.id===y)?.patient.name||"Unknown Patient";await Hs.showCompletionNotification(D,de.processingTime||0,void 0,oe),console.log("üéâ Background session completed for:",oe),cn.sessionReady(oe,D)}catch(oe){console.warn("Failed to send completion notification:",oe)}if(Nt)try{const oe=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;setTimeout(()=>{const me=b.current||document.getElementById("results-section");me&&typeof me.scrollIntoView=="function"&&(me.scrollIntoView({behavior:oe?"auto":"smooth",block:"start"}),console.log("üéØ Auto-scrolled to results for currently selected session:",y))},50)}catch(oe){console.debug("Auto-scroll to results failed (non-critical):",oe instanceof Error?oe.message:oe);try{const me=b.current||document.getElementById("results-section");me&&typeof me.focus=="function"&&me.focus({preventScroll:!1})}catch(me){console.debug("Fallback focus also failed:",me instanceof Error?me.message:me)}}else console.log("üîï Background session completed, skipping auto-scroll for:",y)}catch($){console.error("‚ùå Background processing failed for session:",y,$),setTimeout(()=>{if(t.setProcessing(!1),t.setProcessingStatus("idle"),$.name==="AbortError")t.updatePatientSession(y,{status:"cancelled",errors:["Processing was cancelled"],processingProgress:void 0});else{const je=n.patientSessions.find(L=>L.id===y)?.patient.name||"Unknown Patient";t.updatePatientSession(y,{status:"error",errors:[$.message||"Processing failed"],processingProgress:void 0}),cn.processingFailed(je)}T(I,D,$.message||"Background processing failed","",0)},0)}},[t,v,T,n.patientSessions]),M=c.useCallback(async y=>{if(d.current=y,n.ui.isCancelling){console.log("üõë Recording completed but cancellation in progress - ignoring"),t.setCancelling(!1);return}const I=o.current||n.ui.activeWorkflow,D=l.current||n.currentSessionId;if(!I){console.error("‚ùå No active workflow selected"),t.setErrors(["No workflow selected. Please select a workflow type before recording."]);return}if(!D){console.error("‚ùå No current session found"),t.setErrors(["No active session. Please start a new recording."]);return}console.log("üé§ Recording completed, starting background processing for session:",D),t.updatePatientSession(D,{status:"transcribing",audioBlob:y}),t.setCurrentSessionId(null),l.current=null,t.setActiveWorkflow(null),o.current=null,t.setSelectedSessionId(null),t.clearRecording();const $=n.patientSessions.find(z=>z.id===D)?.patient.name||"Patient";cn.recordingSent($,I),k(D,y,I),console.log("üöÄ Background processing started for session:",D,"- ready for new recordings!")},[t,k,n.ui.isCancelling,n.currentSessionId]),_=c.useCallback((y,I)=>{c.startTransition(()=>{t.setVoiceActivity(y,I)})},[t]);c.useEffect(()=>{P.current=M,R.current=_},[M,_]);const F=c.useCallback(y=>{console.log("üìã üîç USER EXPLICIT SESSION SELECTION - Selected:",{patientName:y.patient.name,sessionId:y.id,status:y.status,hasTranscription:!!y.transcription,hasResults:!!y.results,hasSummary:!!y.summary,agentType:y.agentType,currentBackgroundWork:{isRecording:j.isRecording,isProcessing:n.isProcessing,streaming:n.streaming,currentSessionId:n.currentSessionId}}),c.startTransition(()=>{console.log("üìã üéØ Loading session into isolated display state:",y.id),t.setDisplaySession(y),t.setUIMode("reviewing",{sessionId:y.id,origin:"user"}),console.log("‚úÖ üìã SESSION SELECT COMPLETE - Session loaded in isolated display (will show even during active work):",{patientName:y.patient.name,sessionId:y.id,status:y.status,priorityLevel:"PRIORITY 1 - User Explicit Selection"}),setTimeout(()=>{console.log("üîç DISPLAY STATE CHECK - Post session selection:",{isDisplayingSession:n.displaySession?.isDisplayingSession,displaySessionId:n.displaySession?.displaySessionId,displayResultsLength:n.displaySession?.displayResults?.length||0,displayTranscriptionLength:n.displaySession?.displayTranscription?.length||0,activeRecordingResults:n.results?.length||0,activeRecordingTranscription:n.transcription?.length||0,isRecording:j.isRecording,currentSessionId:n.currentSessionId})},100)})},[t,n.displaySession,n.results,n.transcription,n.currentSessionId,j.isRecording]),U=c.useCallback(y=>{t.setSelectedSessionId(y.id),t.setUIMode("recording",{sessionId:y.id,origin:"user"})},[t]),X=c.useCallback(y=>{const I=Date.now();t.updatePatientSession(y.id,{reviewedAt:I,finalizedAt:I,completed:!0,status:"completed"}),n.selectedSessionId===y.id&&(t.clearDisplaySession(),t.setUIMode("idle",{sessionId:null,origin:"user"}))},[t,n.selectedSessionId]),q=c.useCallback(y=>{const I=y.split(/[.!?]+/).filter($=>$.trim().length>0);if(I.length===0)return y.substring(0,150)+"...";const D=["stenosis","regurgitation","valve","artery","diagnosis","treatment"],H=I.filter($=>D.some(z=>$.toLowerCase().includes(z)));return H.length>0?H.slice(0,2).join(". ").trim()+".":I[0]?.trim()+"."},[]);c.useCallback((y,I)=>I&&I.trim()?I.trim():q(y),[q]);const ne=c.useCallback(()=>n.displaySession.isDisplayingSession&&n.displaySession.displaySessionId?(console.log("üìã ü•á PRIORITY 1: Showing DISPLAY session data (user explicitly selected)",{displaySessionId:n.displaySession.displaySessionId,hasDisplayResults:!!n.displaySession.displayResults,hasDisplayTranscription:!!n.displaySession.displayTranscription,backgroundActiveWork:{isRecording:j.isRecording,isProcessing:n.isProcessing,streaming:n.streaming,currentSessionId:n.currentSessionId}}),{transcription:n.displaySession.displayTranscription,results:n.displaySession.displayResults,summary:n.displaySession.displaySummary,taviStructuredSections:n.displaySession.displayTaviStructuredSections,agent:n.displaySession.displayAgent,agentName:n.displaySession.displayAgentName,patientInfo:n.displaySession.displayPatientInfo,processingStatus:"complete",isDisplayingSession:!0}):j.isRecording||n.isProcessing||n.streaming||n.currentSessionId!==null?(console.log("üéØ ü•à PRIORITY 2: Showing ACTIVE recording data (no explicit selection)",{isRecording:j.isRecording,isProcessing:n.isProcessing,streaming:n.streaming,currentSessionId:n.currentSessionId,processingStatus:n.processingStatus,streamBuffer:n.streamBuffer?.length||0}),n.streaming&&n.results&&n.processingStatus==="complete"&&console.warn("üö® POTENTIAL STUCK STREAMING STATE DETECTED:",{streaming:n.streaming,hasResults:!!n.results,resultsLength:n.results.length,processingStatus:n.processingStatus,streamBuffer:n.streamBuffer?.length||0}),{transcription:n.transcription,results:n.results,summary:n.aiGeneratedSummary,agent:n.currentAgent,agentName:n.currentAgentName,patientInfo:n.currentPatientInfo,processingStatus:n.processingStatus,isDisplayingSession:!1}):(console.log("üîß ü•â PRIORITY 3: Showing default ACTIVE recording data (empty state)",{noExplicitSelection:!n.displaySession.isDisplayingSession,noActiveWork:!0,defaultFallback:!0}),{transcription:n.transcription,results:n.results,summary:n.aiGeneratedSummary,agent:n.currentAgent,agentName:n.currentAgentName,patientInfo:n.currentPatientInfo,processingStatus:n.processingStatus,isDisplayingSession:!1}),[j.isRecording,n.isProcessing,n.streaming,n.currentSessionId,n.transcription,n.results,n.aiGeneratedSummary,n.currentAgent,n.currentAgentName,n.currentPatientInfo,n.processingStatus,n.displaySession]),be=c.useCallback(async()=>{try{console.log("üë§ Extracting patient data from EMR...");const y=await chrome.tabs.query({active:!0,currentWindow:!0});console.log("üîç Current active tab:",y[0]?.url);const I=3;let D=null;for(let H=1;H<=I;H++){console.log(`üîç Attempt ${H}/${I}: Sending extraction request to content script...`);try{const $=await Promise.race([chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"extract-patient-data",data:{}}),new Promise((z,K)=>setTimeout(()=>K(new Error("Patient extraction timeout")),1e4))]);if(console.log("üì¨ Received response from content script:",$),$?.success&&$?.data){const z=$.data;console.log(`‚úÖ Patient data extraction succeeded on attempt ${H}:`,z);const K=z.name&&z.name.trim()!=="",je=z.id&&z.id.trim()!=="";if(K||je)return console.log("‚úÖ Patient data validation passed - returning data"),z;console.warn(`‚ö†Ô∏è Attempt ${H}: Extracted data lacks name and ID - will retry`),D=new Error("Extracted data lacks required patient name or ID")}else console.warn(`‚ö†Ô∏è Attempt ${H}: No valid patient data in response`),D=new Error($?.error||"No patient data found in response")}catch($){if(console.warn(`‚ö†Ô∏è Attempt ${H} failed:`,$.message),D=$,H<I){const z=Math.min(1e3*Math.pow(2,H-1),5e3);console.log(`‚è≥ Waiting ${z}ms before retry...`),await new Promise(K=>setTimeout(K,z))}}}return console.error("‚ùå All patient extraction attempts failed. Last error:",D),null}catch(y){return console.error("‚ùå Critical error in patient data extraction:",y),console.error("üîç Error details:",{name:y instanceof Error?y.name:"Unknown",message:y instanceof Error?y.message:y,stack:y instanceof Error?y.stack:void 0}),null}},[]),ve=c.useCallback(async y=>{console.log("üéØ Workflow selected:",y),n.processingStatus==="error"&&(console.log("üîÑ Auto-recovering from error state - resetting to idle for new recording"),t.setProcessingStatus("idle"),t.setErrors([]),t.setWarnings([]),t.clearRecording()),(n.results?.trim().length>0||n.transcription?.trim().length>0)&&(console.log("üîÑ Clearing previous session before starting new workflow:",y),t.clearRecording()),n.displaySession.isDisplayingSession&&(console.log("üîÑ Clearing display session view for new recording"),t.clearDisplaySession(),t.setUIMode("idle",{sessionId:null,origin:"user"}));const I=n.patientSessions.filter(D=>["recording","transcribing","processing"].includes(D.status));if(j.isRecording&&n.ui.activeWorkflow===y)console.log("üõë Stopping current recording for:",y),j.stopRecording();else if(!j.isRecording){if(I.length>=3){t.setErrors([`Too many active sessions (${I.length}). Please wait for some to complete before starting new recordings.`]);return}if(console.log(`üìä Current active sessions: ${I.length}/3 - proceeding with new recording`),console.log("üîç Checking Whisper server status before recording..."),!n.modelStatus.whisperServer?.running){console.error("‚ùå Whisper server not running"),t.setErrors(["Whisper server is not running. Please start the server first using: ./start-whisper-server.sh"]);return}console.log("üìã Extracting patient data for new recording..."),t.setExtractingPatients(!0);let D=null;try{const z=await be();if(z&&(z.name||z.id))D={name:z.name||"Patient",id:z.id||"No ID",dob:z.dob||"",age:z.age||"",phone:z.phone,email:z.email,medicare:z.medicare,insurance:z.insurance,address:z.address,extractedAt:z.extractedAt||Date.now()},t.setCurrentPatientInfo(D),console.log("‚úÖ Patient data extracted successfully:",z.name,"(ID:",z.id+")");else{console.log("‚ö†Ô∏è No patient data extracted from EMR - generating fallback patient info");const K=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});D={name:`Patient ${(n.patientSessions?.length||0)+1} (${K})`,id:`Session-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},t.setCurrentPatientInfo(D),console.log("üìù Generated fallback patient info:",D.name)}}catch(z){console.error("‚ùå Patient extraction failed with error:",z);const K=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});D={name:`Patient ${(n.patientSessions?.length||0)+1} (${K})`,id:`Session-${Date.now()}`,dob:"",age:"",extractedAt:Date.now()},t.setCurrentPatientInfo(D),console.log("üìù Generated fallback patient info after extraction error:",D.name)}finally{t.setExtractingPatients(!1)}const H=`session-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,$={id:H,patient:D,transcription:"",results:"",agentType:y,agentName:"",timestamp:Date.now(),status:"recording",completed:!1,recordingStartTime:Date.now()};t.addPatientSession($),t.setCurrentSessionId(H),l.current=H,console.log("üìù Created new session:",H,"for patient:",$.patient.name),console.log("‚úÖ Whisper server is running, starting recording..."),t.setActiveWorkflow(y),o.current=y,t.setUIMode("recording",{sessionId:H,origin:"user"}),j.startRecording(),t.setProcessingStartTime(Date.now())}},[j,n.ui.activeWorkflow,t,be,n.patientSessions,n.modelStatus]),_e=c.useCallback(()=>{console.log("üõë Cancellation requested"),t.setCancelling(!0),x.current&&(x.current.abort(),x.current=null),g.current&&(g.current.abort(),g.current=null),j.isRecording&&j.stopRecording();const y=l.current||n.currentSessionId;y&&(console.log("üßπ Cleaning up current session:",y),t.removePatientSession(y),t.setCurrentSessionId(null),l.current=null),t.setActiveWorkflow(null),t.setProcessing(!1),t.setProcessingStatus("idle"),t.setWarnings([]),t.setErrors([]),t.setResults(""),t.setResultsSummary(""),o.current=null,t.setUIMode("idle",{sessionId:null,origin:"user"}),setTimeout(()=>t.setCancelling(!1),1e3)},[j,t]),ye=c.useCallback(async y=>{try{await navigator.clipboard.writeText(y),console.log("üìã Text copied to clipboard")}catch(I){throw console.error("Failed to copy text:",I),I}},[]),[We,Y]=c.useState({status:"idle",message:""}),le=c.useCallback(async y=>{try{console.log("‚úèÔ∏è Transcription edited, length:",y.length),t.setTranscription(y);const I=n.transcription;if(I&&y!==I){const D={...n.transcriptionApproval,status:"edited",originalText:n.transcriptionApproval.originalText||I,currentText:y,hasBeenEdited:!0,editTimestamp:Date.now()};t.setTranscriptionApproval(D),Y({status:"idle",message:'Edit ready - click "Perfect" to submit for training'}),console.log("‚úèÔ∏è Transcription marked as edited, ready for approval")}else if(y===I){const D={...n.transcriptionApproval,status:"pending",currentText:y,hasBeenEdited:!1};t.setTranscriptionApproval(D),Y({status:"idle",message:""})}}catch(I){console.error("‚ùå Failed to handle transcription edit:",I),Y({status:"error",message:"‚ö† Failed to process edit",timestamp:new Date}),setTimeout(()=>{Y({status:"idle",message:""})},5e3)}},[n.transcription,n.transcriptionApproval,n.currentAgent,n.selectedSessionId,t]),Ae=c.useCallback(async y=>{try{console.log("‚úÖ Transcription approval status changed:",y);const I=n.transcription,D=n.transcriptionApproval,H={...D,status:y,currentText:I,approvalTimestamp:y==="approved"?Date.now():D.approvalTimestamp,editTimestamp:y==="edited"?Date.now():D.editTimestamp};if(t.setTranscriptionApproval(H),y==="approved"&&I.trim()!==""){console.log("üíæ Logging transcription for ASR training");const $=D.hasBeenEdited,z=D.originalText||I;await os.getInstance().addCorrection({rawText:z,correctedText:I,agentType:n.currentAgent||"transcription",sessionId:n.selectedSessionId||"streaming",approvalStatus:"approved",userExplicitlyApproved:!0,approvalTimestamp:Date.now(),editTimestamp:$?D.editTimestamp||Date.now():void 0}),Y({status:"saved",message:$?"‚úì Corrected transcription saved for training":"‚úì Perfect transcription saved for training",timestamp:new Date}),setTimeout(()=>{Y({status:"idle",message:""})},3e3)}}catch(I){console.error("‚ùå Failed to handle transcription approval:",I),Y({status:"error",message:"‚ö† Failed to save approval",timestamp:new Date}),setTimeout(()=>{Y({status:"idle",message:""})},5e3)}},[n.transcription,n.transcriptionApproval,n.currentAgent,n.selectedSessionId,t]),V=c.useCallback(async y=>{try{if(console.log("üîÑ Reprocessing transcription with agent:",y),!n.transcription||n.transcription.trim().length===0){console.error("‚ùå No transcription available for reprocessing"),t.setErrors(["No transcription available for reprocessing"]);return}if(n.isProcessing){console.warn("‚ö†Ô∏è Already processing, ignoring reprocess request");return}t.setResults(""),t.setWarnings([]),t.setErrors([]),t.setResultsSummary(""),t.setProcessing(!0),t.setProcessingStatus("processing"),t.setCurrentAgent(y),t.setProcessingStartTime(Date.now()),console.log("üîÑ Starting agent processing with:",y),t.setMissingInfo(null);const{AgentFactory:I}=await Pe(async()=>{const{AgentFactory:H}=await import("./chunks/AgentFactory.Da_RPH1f.js").then($=>$.a);return{AgentFactory:H}},__vite__mapDeps([4,2,1,5,6,7,8])),D=await I.processWithAgent(y,n.transcription,{isReprocessing:!0},g.current?.signal);console.log("‚úÖ Agent reprocessing completed"),t.setResults(D.content),t.setMissingInfo(D.missingInfo||null),D.taviStructuredSections&&t.setTaviStructuredSections(D.taviStructuredSections),D.summary&&D.summary.trim()?(G.debug("Setting AI-generated summary from reprocessing",{component:"summary",agent:y}),t.setAiGeneratedSummary(D.summary)):t.setAiGeneratedSummary(void 0),t.setTimingData({agentProcessingTime:D.processingTime,totalProcessingTime:D.processingTime}),t.setCurrentAgentName(D.agentName),t.completeProcessingAtomic(n.currentSessionId||"reprocess-session",D.content),D.warnings?.length&&t.setWarnings(D.warnings),D.errors?.length&&t.setErrors(D.errors)}catch(I){console.error("‚ùå Agent reprocessing failed:",I),t.setProcessing(!1),t.setProcessingStatus("idle"),I.name==="AbortError"?console.log("üõë Agent reprocessing was cancelled"):t.setErrors([I.message||"Reprocessing failed"])}},[n.transcription,n.isProcessing,t]),J=c.useCallback(async y=>{try{if(!n.transcription||!n.currentAgent)return;t.setProcessing(!0),t.setProcessingStatus("processing");const I=Object.entries(y).filter(([z,K])=>K&&K.trim().length>0).map(([z,K])=>`- ${z}: ${K.trim()}`).join(`
`),D=`${n.transcription}

Additional details provided by clinician to fill missing information:
${I}`,{AgentFactory:H}=await Pe(async()=>{const{AgentFactory:z}=await import("./chunks/AgentFactory.Da_RPH1f.js").then(K=>K.a);return{AgentFactory:z}},__vite__mapDeps([4,2,1,5,6,7,8])),$=await H.processWithAgent(n.currentAgent,D,{isReprocessing:!0,withMissingInfo:!0},g.current?.signal);t.setMissingInfo($.missingInfo||null),$.taviStructuredSections&&t.setTaviStructuredSections($.taviStructuredSections),t.completeProcessingAtomic(n.currentSessionId||"missing-info-session",$.content)}catch(I){console.error("Reprocess with missing info failed:",I),t.setProcessing(!1),t.setProcessingStatus("idle")}},[n.transcription,n.currentAgent,t]),Z=c.useCallback(async()=>{if(!(!n.results||n.currentAgent!=="quick-letter"||n.isGeneratingPatientVersion))try{console.log("üéØ Generating patient-friendly version of letter"),t.setGeneratingPatientVersion(!0);const{QuickLetterAgent:y}=await Pe(async()=>{const{QuickLetterAgent:H}=await import("./chunks/agents.D9VU8YWQ.js").then($=>$.Q);return{QuickLetterAgent:H}},__vite__mapDeps([5,6])),D=await new y().generatePatientVersion(n.results);t.setPatientVersion(D),console.log("‚úÖ Patient version generated successfully")}catch(y){console.error("‚ùå Failed to generate patient version:",y),t.setPatientVersion("Error generating patient version. Please try again.")}finally{t.setGeneratingPatientVersion(!1)}},[n.results,n.currentAgent,n.isGeneratingPatientVersion,t]),ae=c.useCallback(async y=>{try{console.log("üîç Starting patient name validation before EMR insertion");let I="";if(n.selectedSessionId){const $=n.patientSessions.find(z=>z.id===n.selectedSessionId);$&&(I=$.patient.name,console.log("üìã Using selected session patient name:",I))}else if(n.currentSessionId){const $=n.patientSessions.find(z=>z.id===n.currentSessionId);$&&(I=$.patient.name,console.log("üìã Using current session patient name:",I))}else n.currentPatientInfo?.name&&(I=n.currentPatientInfo.name,console.log("üìã Using current patient info name:",I));let D="";try{const $=await be();$?.name?(D=$.name,console.log("üè• Extracted fresh EMR patient name:",D)):n.currentPatientInfo?.name&&(D=n.currentPatientInfo.name,console.log("üè• Using cached EMR patient name:",D))}catch($){console.warn("‚ö†Ô∏è Failed to extract fresh patient data, using cached:",$),n.currentPatientInfo?.name&&(D=n.currentPatientInfo.name)}if(Rs.shouldSkipValidation(I,D))return console.log("‚è© Skipping patient name validation - insufficient data"),!0;const H=Rs.validatePatientNames(I,D);return console.log("üìä Patient name validation result:",H),H.isMatch?(console.log("‚úÖ Patient names match - proceeding with insertion"),!0):(console.log("‚ö†Ô∏è Patient name mismatch detected - showing confirmation modal"),new Promise($=>{t.setPatientMismatchData({comparison:H,textToInsert:y,onConfirm:()=>{console.log("‚úÖ User confirmed insertion despite mismatch"),t.closeOverlay("patient-mismatch"),t.setPatientMismatchData({comparison:null,textToInsert:null,onConfirm:null,onCancel:null}),$(!0)},onCancel:()=>{console.log("‚ùå User cancelled insertion due to mismatch"),t.closeOverlay("patient-mismatch"),t.setPatientMismatchData({comparison:null,textToInsert:null,onConfirm:null,onCancel:null}),$(!1)}}),t.openOverlay("patient-mismatch"),t.setUIMode("reviewing",{sessionId:n.selectedSessionId||null,origin:"auto"})}))}catch(I){return console.error("‚ùå Patient name validation failed:",I),console.log("‚ö†Ô∏è Allowing insertion due to validation error"),!0}},[n.selectedSessionId,n.currentSessionId,n.patientSessions,n.currentPatientInfo,be,t]),ke=c.useCallback(async(y,I,D)=>{try{if(!await ae(y)){console.log("üõë Insertion cancelled due to patient mismatch");return}console.log("‚úÖ Patient validation passed - proceeding with insertion");const $=ne(),z=I?null:D||$.agent||n.currentAgent||n.ui.activeWorkflow,K=I||Ia(z);if(console.log("üîç EMR insertion debug:"),console.log("  - agentContext:",D),console.log("  - currentAgent:",n.currentAgent),console.log("  - activeWorkflow:",n.ui.activeWorkflow),console.log("  - displayData.agent:",$.agent),console.log("  - currentAgentType:",z),console.log("  - targetField:",I),console.log("  - field:",K),console.log("  - supportsFieldSpecific:",As(z)),console.log("  - isDisplayingSession:",$.isDisplayingSession),K&&As(z)){console.log(`üìù Opening specific EMR field: ${K} (${Dn(K)})`),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:K,data:{}}),console.log(`üìù Inserting text to ${Dn(K)} field`);const je=K==="investigation-summary"?1e3:500;await new Promise(B=>setTimeout(B,je));const L=K==="investigation-summary"?`
${y}`:y;await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insertText",data:{text:L,fieldType:K}}),console.log(`‚úÖ Text inserted to ${Dn(K)} field after opening`)}else console.log("üìù Using generic EMR text insertion (no specific field mapping)"),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insertText",data:{text:y}}),console.log("üìù Text inserted to EMR (generic)")}catch(H){throw console.error("Failed to insert text to EMR:",H),H}},[n.currentAgent,n.ui.activeWorkflow]),we=t.setModelStatus,Ce=c.useCallback(async()=>{console.log("üîç checkModelStatus called - CALL STACK:",new Error().stack),console.time("‚è±Ô∏è Total checkModelStatus Duration");try{const y=await v.checkConnection(),I=await p.checkServerStatus(!1,{timeout:5e3,retries:2}),D={...y,whisperServer:I};c.startTransition(()=>{we(D)}),console.timeEnd("‚è±Ô∏è Total checkModelStatus Duration")}catch(y){console.timeEnd("‚è±Ô∏è Total checkModelStatus Duration"),c.startTransition(()=>{we({isConnected:!1,classifierModel:"",processorModel:"",lastPing:Date.now(),latency:0,whisperServer:{running:!1,model:"whisper-large-v3-turbo",port:8001,lastChecked:Date.now(),error:y instanceof Error?y.message:"Status check failed"}})})}},[v,p,we]);return c.useEffect(()=>{console.log("üöÄ Component mounted - performing initial model status check..."),Ce()},[Ce]),c.useEffect(()=>{const y=n.results&&n.processingStatus==="complete",I=n.streaming||n.currentSessionId!==null,D=!j.isRecording&&!n.isProcessing;y&&I&&D&&(console.warn('üö® FIXING STUCK "ACTIVELY WORKING" STATE - clearing to restore record button access',{streaming:n.streaming,currentSessionId:n.currentSessionId,processingStatus:n.processingStatus,hasResults:!!n.results}),n.streaming&&(t.setStreaming(!1),t.clearStream()),n.currentSessionId!==null&&t.setCurrentSessionId(null))},[n.streaming,n.currentSessionId,n.results,n.processingStatus,j.isRecording,n.isProcessing,t]),c.useEffect(()=>{const y=setInterval(()=>{t.validateState();const I=n.processingStatus==="processing"&&n.isProcessing===!1,D=n.processingStatus==="complete"&&(n.streaming||n.currentSessionId),H=n.results&&n.processingStatus==="complete"&&(n.streaming||n.currentSessionId)&&!j.isRecording,$=Object.values(n.patientSessions).some(z=>z.status==="processing"||z.status==="transcribing");(I||D||H)&&!$&&(console.warn("üöë STUCK STATE DETECTED - Auto-recovering:",{isStuckProcessing:I,isStuckComplete:D,hasCompletedResultsButActiveState:H,processingStatus:n.processingStatus,isProcessing:n.isProcessing,streaming:n.streaming,currentSessionId:n.currentSessionId,hasResults:!!n.results}),n.results&&n.processingStatus==="complete"?(console.log("üîß Using forceUIReadyState for completed workflow with stuck indicators"),t.forceUIReadyState()):(console.log("üîß Using recoverStuckState for processing state inconsistencies"),t.recoverStuckState()))},5e3);return()=>clearInterval(y)},[n.processingStatus,n.isProcessing,n.streaming,n.currentSessionId,n.results,j.isRecording,t]),c.useEffect(()=>()=>{u.current&&(clearTimeout(u.current),u.current=null)},[]),c.useEffect(()=>{let y,I;const D=async()=>{try{console.log("üöÄ Initializing critical agents for improved performance...");const{AgentFactory:$}=await Pe(async()=>{const{AgentFactory:z}=await import("./chunks/AgentFactory.Da_RPH1f.js").then(K=>K.a);return{AgentFactory:z}},__vite__mapDeps([4,2,1,5,6,7,8]));await $.preloadCriticalAgents(),y=setTimeout(async()=>{try{console.log("üîÑ Background preloading of common agents..."),await $.preloadCommonAgents(),console.log("‚úÖ Background agent preloading completed")}catch(z){console.warn("‚ö†Ô∏è Background preloading failed:",z)}},5e3)}catch($){console.warn("‚ö†Ô∏è Critical agent preloading failed:",$)}},H=()=>{I=setInterval(async()=>{try{const{AgentFactory:$}=await Pe(async()=>{const{AgentFactory:K}=await import("./chunks/AgentFactory.Da_RPH1f.js").then(je=>je.a);return{AgentFactory:K}},__vite__mapDeps([4,2,1,5,6,7,8])),z=$.getMemoryEstimate();console.log(`üìä Agent memory usage: ${z.totalAgents} agents (~${z.estimatedMemoryMB}MB)`),z.totalAgents>8&&(console.log("üßπ Optimizing agent cache due to high memory usage..."),$.optimizeCache())}catch($){console.warn("‚ö†Ô∏è Memory optimization failed:",$)}},6e5)};return D(),H(),()=>{y&&clearTimeout(y),I&&clearInterval(I)}},[]),e.jsxs("div",{className:"relative h-full max-h-full flex flex-col bg-surface-secondary overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 bg-white  border-b border-gray-200",children:e.jsx(Sr,{status:j.isRecording?"recording":"idle",currentAgent:n.currentAgent||n.ui.activeWorkflow,isRecording:j.isRecording,modelStatus:n.modelStatus,onRefreshServices:Ce,onCompleteRecording:j.stopRecording,onCancelProcessing:_e,onWorkflowSelect:ve,activeWorkflow:n.ui.activeWorkflow,voiceActivityLevel:n.voiceActivityLevel,recordingTime:j.recordingTime,isExtractingPatients:n.ui.isExtractingPatients,patientSessions:n.patientSessions,onRemoveSession:t.removePatientSession,onClearAllSessions:t.clearPatientSessions,onSessionSelect:F,onShowMetrics:()=>t.setSidePanel("metrics-dashboard"),onNewRecording:t.clearRecording,showNewRecording:n.results?.trim().length>0||n.patientSessions.some(y=>y.status==="completed")})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-y-auto",ref:b,id:"results-section",children:[n.patientSessions.length>0&&e.jsx("div",{className:"px-4 pt-4",children:e.jsx(qr,{sessions:n.patientSessions,onRemoveSession:t.removePatientSession,onClearAllSessions:t.clearPatientSessions,onSessionSelect:F,onResumeRecording:U,onMarkSessionComplete:X,selectedSessionId:h,isCollapsible:!1})}),j.isRecording&&e.jsxs("div",{className:"flex flex-col space-y-4 p-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Xr,{isRecording:j.isRecording,voiceActivityLevel:j.voiceActivityLevel,frequencyData:j.frequencyData,audioLevelHistory:j.audioLevelHistory,recordingTime:j.recordingTime,activeDeviceInfo:j.activeDeviceInfo,onStop:j.stopRecording,className:"min-h-0"})}),n.ui.activeWorkflow&&Vr(n.ui.activeWorkflow)&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Wr,{agentType:n.ui.activeWorkflow,isVisible:!0,compactMode:!0})})]}),!j.isRecording&&(n.processingStatus==="transcribing"||n.processingStatus==="processing")&&n.transcription&&!n.streaming&&!n.displaySession.isDisplayingSession&&n.currentSessionId&&e.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto p-6 space-y-4",children:e.jsxs("div",{className:"bg-white  rounded-lg border border-blue-200 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-accent-violet rounded-full animate-pulse"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800",children:n.processingStatus==="transcribing"?"Transcribing Audio...":"Processing Report..."})]}),e.jsx(_t,{originalTranscription:n.transcription,onTranscriptionCopy:y=>{navigator.clipboard.writeText(y),fe.getInstance().success("Transcription copied to clipboard")},onTranscriptionInsert:async y=>{try{await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"insert-text",data:{content:y}}),fe.getInstance().success("Transcription inserted to EMR")}catch(I){console.error("Failed to insert transcription:",I),fe.getInstance().error("Failed to insert transcription")}},onTranscriptionEdit:y=>{t.setTranscription(y)},currentAgent:n.currentAgent,isProcessing:n.processingStatus==="processing",defaultExpanded:!0,className:"border-0 bg-transparent"}),n.processingStatus==="processing"&&e.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-sm text-blue-600",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{children:["Generating ",n.currentAgent," report..."]})]})]})}),n.reviewData&&e.jsx("div",{className:"flex-shrink-0 bg-white  border-b border-gray-200",children:e.jsx(pr,{onQuickAction:async(y,I)=>{console.log("üîß Quick action:",y,I)},processingAction:""})}),i.patientEducation&&e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:e.jsx(Ar,{isVisible:i.patientEducation,onClose:()=>{t.closeOverlay("patient-education"),t.setUIMode("idle",{sessionId:null,origin:"user"})},isGenerating:n.isProcessing&&n.currentAgent==="patient-education",onGenerate:async y=>{try{t.setProcessing(!0),t.setCurrentAgent("patient-education"),t.setResults(""),t.setErrors([]);const{AgentFactory:I}=await Pe(async()=>{const{AgentFactory:H}=await import("./chunks/AgentFactory.Da_RPH1f.js").then($=>$.a);return{AgentFactory:H}},__vite__mapDeps([4,2,1,5,6,7,8]));console.log("üéì Processing Patient Education with input:",y);const D=await I.processWithAgent("patient-education",JSON.stringify(y));t.closeOverlay("patient-education"),t.completeProcessingAtomic(n.currentSessionId||"patient-education-session",D.content),console.log("‚úÖ Patient Education generation completed")}catch(I){console.error("‚ùå Patient Education generation failed:",I);const D=I instanceof Error?I.message:String(I);t.setErrors([`Patient Education generation failed: ${D}`]),t.setProcessingStatus("idle"),t.setProcessing(!1)}}})}),h&&!n.results&&!n.streaming&&!n.isProcessing&&n.processingStatus!=="complete"&&!n.displaySession.isDisplayingSession&&e.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center p-8",children:e.jsxs("div",{className:"max-w-md text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-purple-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-purple-600 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Loading Session"}),e.jsx("p",{className:"text-gray-600",children:(()=>{const y=n.patientSessions.find(I=>I.id===h);return y?`Loading ${y.patient.name}'s ${y.agentType} session...`:"Loading session data..."})()})]})]})}),(h||n.streaming||n.isProcessing||n.results&&n.processingStatus==="complete")&&(console.log("üéØ RESULTS PANEL RENDERING:",{selectedSessionId:h,streaming:n.streaming,isProcessing:n.isProcessing,hasResults:!!n.results,hasTranscription:!!n.transcription,resultsLength:n.results?.length||0,transcriptionLength:n.transcription?.length||0,shouldRender:!0}),!0)&&e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:(()=>{const y=ne();return e.jsx(ra,{results:y.results,resultsSummary:y.summary||"",warnings:n.ui.warnings,errors:n.ui.errors,agentType:y.agent||null,onCopy:ye,onInsertToEMR:(I,D)=>{ke(I,D,y.agent||null)},originalTranscription:y.transcription,onTranscriptionCopy:ye,onTranscriptionInsert:I=>{ke(I,void 0,y.agent||null)},onTranscriptionEdit:le,transcriptionSaveStatus:We,onAgentReprocess:y.isDisplayingSession?void 0:V,approvalState:y.isDisplayingSession?{status:"pending",originalText:y.transcription||"",currentText:y.transcription||"",hasBeenEdited:!1}:n.transcriptionApproval,onTranscriptionApprove:y.isDisplayingSession?I=>{console.log("üß† TAVI workup transcription approval for completed session:",{status:I,sessionId:(y.isDisplayingSession?y.patientInfo?.name:null)||"unknown",transcriptionLength:y.transcription?.length||0}),Ae(I)}:Ae,missingInfo:y.isDisplayingSession?null:n.missingInfo,onReprocessWithAnswers:y.isDisplayingSession?void 0:J,onDismissMissingInfo:y.isDisplayingSession?void 0:()=>t.clearMissingInfo(),currentAgent:y.agent,isProcessing:y.isDisplayingSession?!1:n.isProcessing,audioBlob:y.isDisplayingSession?null:d.current,transcriptionTime:y.isDisplayingSession?null:n.transcriptionTime,agentProcessingTime:y.isDisplayingSession?null:n.agentProcessingTime,totalProcessingTime:y.isDisplayingSession?null:n.totalProcessingTime,processingStatus:y.processingStatus,currentAgentName:y.agentName,selectedSessionId:y.isDisplayingSession?y.patientInfo?.name||"Unknown":h,selectedPatientName:y.patientInfo?.name||N,patientVersion:y.isDisplayingSession?null:n.patientVersion,isGeneratingPatientVersion:y.isDisplayingSession?!1:n.isGeneratingPatientVersion,onGeneratePatientVersion:y.isDisplayingSession?void 0:Z,streaming:y.isDisplayingSession?!1:!!n.streaming,streamBuffer:y.isDisplayingSession?"":n.streamBuffer||"",ttftMs:y.isDisplayingSession?null:n.ttftMs??null,onStopStreaming:y.isDisplayingSession?void 0:C,processingProgress:y.isDisplayingSession?void 0:typeof n.ui.processingProgress=="number"?{phase:"processing",progress:n.ui.processingProgress,details:void 0}:n.ui.processingProgress,taviStructuredSections:y.isDisplayingSession?y.taviStructuredSections:n.taviStructuredSections})})()}),!n.displaySession.isDisplayingSession&&!j.isRecording&&!n.streaming&&!h&&!i.patientEducation&&!n.isProcessing&&!(n.results&&n.processingStatus==="complete")&&e.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center p-8",children:e.jsxs("div",{className:"max-w-md text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 mx-auto bg-blue-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Ready to Record"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Select a workflow below to start recording for your next patient. Recordings will process in the background, allowing you to continue with other patients."})]}),n.patientSessions.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Background Processing"})]}),e.jsxs("p",{className:"text-xs text-blue-800",children:[n.patientSessions.filter(y=>["transcribing","processing"].includes(y.status)).length," sessions processing, "," ",n.patientSessions.filter(y=>y.status==="completed").length," completed. Click the notification bell to view results."]})]})]})})]}),e.jsx("div",{className:"flex-shrink-0 bg-white  border-t border-gray-200 p-4",children:e.jsx(ma,{onQuickAction:async(y,I)=>{console.log("üîß Quick action triggered:",y,I);try{if(y==="annotate-screenshots"){console.log("üì∏ Opening screenshot annotation modal"),t.openOverlay("screenshot-annotation"),t.setUIMode("configuring",{sessionId:n.selectedSessionId,origin:"user"});return}if(y==="bp-diary-importer"){console.log("ü©∫ Opening BP Diary Importer"),t.openOverlay("bp-diary-importer"),t.setUIMode("configuring",{sessionId:n.selectedSessionId,origin:"user"});return}if(y==="patient-education"&&I?.type==="show-config"){console.log("üéì Showing Patient Education configuration card"),t.openOverlay("patient-education"),t.setUIMode("configuring",{sessionId:n.selectedSessionId,origin:"user"});return}if(y==="bloods"&&I?.type==="prepare-modal"){console.log("ü©∏ Preparing bloods modal for dictation..."),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:"bloods",data:{}}),console.log("‚úÖ Bloods modal opened for dictation");return}if(["investigation-summary","background","medications","social-history","bloods","bloods-insert","imaging","quick-letter","appointment-wrap-up","profile-photo","create-task"].includes(y)){const D={};["investigation-summary","background","medications","social-history"].includes(y)&&I?.type!=="manual"&&(console.log(`üîß TAVI Ingestion: Showing field ingestion overlay for ${y}`),t.openOverlay("field-ingestion"),t.setUIMode("processing",{sessionId:n.selectedSessionId,origin:"auto"})),n.results&&n.results.trim().length>0&&I?.type!=="manual"?(D.content=n.results,console.log("üîß Sending content to EMR field:",y)):console.log("üîß Opening EMR field for manual entry:",y),await chrome.runtime.sendMessage({type:"EXECUTE_ACTION",action:y,data:D}),["investigation-summary","background","medications","social-history"].includes(y)&&(console.log(`üîß TAVI Ingestion: Clearing field ingestion overlay after ${y}`),setTimeout(()=>{t.closeOverlay("field-ingestion")},1500)),console.log("‚úÖ Quick action completed:",y)}else if(y==="ai-medical-review")if(console.log("ü§ñ Processing AI Medical Review with data:",I),I?.formattedInput){t.setProcessing(!0),t.setCurrentAgent("ai-medical-review"),t.setResults(""),t.setErrors([]);try{const{AgentFactory:D}=await Pe(async()=>{const{AgentFactory:$}=await import("./chunks/AgentFactory.Da_RPH1f.js").then(z=>z.a);return{AgentFactory:$}},__vite__mapDeps([4,2,1,5,6,7,8]));console.log("ü§ñ Processing with BatchPatientReviewAgent...");const H=await D.processWithAgent("ai-medical-review",I.formattedInput);t.setMissingInfo(H.missingInfo||null),t.completeProcessingAtomic(n.currentSessionId||"ai-review-session",H.content),console.log("‚úÖ AI Medical Review completed successfully")}catch(D){console.error("‚ùå AI Medical Review processing failed:",D),t.setErrors([`AI Medical Review failed: ${D instanceof Error?D.message:"Unknown error"}`]),t.setProcessingStatus("idle"),t.setProcessing(!1)}}else console.error("‚ùå AI Medical Review: No formatted input provided"),t.setErrors(["AI Medical Review failed: No patient data available"]),t.setProcessingStatus("idle"),t.setProcessing(!1);else y==="batch-ai-review"&&I?.type==="show-modal"?(console.log("üë• Batch AI Review: Triggering patient selection modal"),t.openOverlay("patient-selection"),t.setUIMode("batch",{sessionId:null,origin:"user"})):console.log("‚ÑπÔ∏è Unhandled quick action:",y)}catch(D){console.error("‚ùå Quick action failed:",y,D),t.setErrors([`Failed to execute ${y}: ${D instanceof Error?D.message:"Unknown error"}`])}},onStartWorkflow:y=>ve(y),isFooter:!0})})]}),i.patientSelection&&e.jsx(Er,{isOpen:i.patientSelection,onClose:()=>{t.closeOverlay("patient-selection"),t.setUIMode("idle",{sessionId:null,origin:"user"})},onStartReview:()=>{console.log("üîÑ Starting patient review")},calendarData:n.ui.calendarData,isExtracting:n.ui.isExtractingPatients,extractError:n.ui.extractError}),i.screenshotAnnotation&&e.jsx(Qo,{isOpen:i.screenshotAnnotation,onClose:()=>{t.closeOverlay("screenshot-annotation"),t.setUIMode("idle",{sessionId:null,origin:"user"})}}),i.bpDiaryImporter&&e.jsx(Zo,{isOpen:i.bpDiaryImporter,onClose:()=>{t.closeOverlay("bp-diary-importer"),t.setUIMode("idle",{sessionId:null,origin:"user"})}}),i.patientMismatch&&e.jsx(Jo,{isOpen:i.patientMismatch,comparison:n.patientMismatchData.comparison,textToInsert:n.patientMismatchData.textToInsert,onConfirm:n.patientMismatchData.onConfirm||(()=>{}),onCancel:n.patientMismatchData.onCancel||(()=>{}),onRefreshEMR:async()=>{try{console.log("üîÑ Refreshing EMR patient data...");const y=await be();y?.name&&(t.setCurrentPatientInfo({...n.currentPatientInfo,...y}),console.log("‚úÖ EMR patient data refreshed:",y.name))}catch(y){console.error("‚ùå Failed to refresh EMR patient data:",y)}}}),e.jsx(Rr,{isActive:i.fieldIngestion,onComplete:()=>t.closeOverlay("field-ingestion")}),i.processingPhase&&e.jsx("div",{className:"absolute top-4 left-4 right-4 z-40",children:e.jsx(Ir,{currentProgress:n.ui.processingProgress,isActive:i.processingPhase,startTime:n.ui.processingStartTime,agentType:n.currentAgent||void 0,transcriptionLength:n.transcription?n.transcription.length:void 0,showTimeEstimate:!0,onProcessingComplete:y=>{console.log(`‚è±Ô∏è Processing completed in ${y}ms`)}})}),e.jsx(Gr,{isOpen:r,onClose:()=>t.clearSidePanel()}),e.jsx(yi,{isOpen:S,onClose:()=>f(!1)}),e.jsx(Pr,{})]})});Oa.displayName="OptimizedAppContent";Da.displayName="OptimizedApp";const ml=()=>{const n=t=>{t.preventDefault()};window.addEventListener("dragover",n,{capture:!0}),window.addEventListener("drop",n,{capture:!0}),document.addEventListener("dragover",n,{capture:!0}),document.addEventListener("drop",n,{capture:!0}),document.documentElement?.addEventListener?.("dragover",n,{capture:!0}),document.documentElement?.addEventListener?.("drop",n,{capture:!0}),document.body?.addEventListener?.("dragover",n,{capture:!0}),document.body?.addEventListener?.("drop",n,{capture:!0})};ml();class ul extends ue.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("React Error Boundary caught an error:",t,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-500 to-red-700 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md text-center",children:[e.jsx("h1",{className:"text-white text-xl font-bold mb-4",children:"Extension Error"}),e.jsx("p",{className:"text-white/80 mb-4",children:"The Operator Chrome Extension encountered an error."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors",children:"Reload Extension"}),this.state.error&&e.jsxs("details",{className:"mt-4 text-left",children:[e.jsx("summary",{className:"text-white/60 cursor-pointer text-sm",children:"Error Details"}),e.jsx("pre",{className:"text-xs text-white/50 mt-2 p-2 bg-black/20 rounded",children:this.state.error.message})]})]})}):this.props.children}}window.addEventListener("error",n=>{console.error("Global error in sidepanel:",n.error)});window.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection in sidepanel:",n.reason)});function Ms(){console.log("üè• Initializing Operator Chrome Extension...",new Date().toISOString()),console.log("üîß Extension context check:",typeof chrome<"u"&&chrome.runtime);const n=document.getElementById("root");if(!n){console.error("‚ùå Root element not found!"),document.body.innerHTML=`
      <div style="padding: 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px);">
          <h1 style="color: white; margin-bottom: 1rem;">Mount Error</h1>
          <p style="color: rgba(255,255,255,0.8);">Could not find root element</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `;return}typeof chrome>"u"||!chrome.runtime?console.warn("‚ö†Ô∏è Chrome extension APIs not available"):console.log("‚úÖ Chrome extension context detected");try{xi(n).render(e.jsx(ue.StrictMode,{children:e.jsx(ul,{children:e.jsx(Da,{})})})),console.log("‚úÖ React app rendered successfully")}catch(t){console.error("‚ùå Failed to render React app:",t),n.innerHTML=`
      <div style="padding: 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px);">
          <h1 style="color: white; margin-bottom: 1rem;">Render Error</h1>
          <p style="color: rgba(255,255,255,0.8);">${t instanceof Error?t.message:"Unknown error"}</p>
          <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
            Reload
          </button>
        </div>
      </div>
    `}}document.readyState==="loading"?(console.log("‚è≥ Waiting for DOM to load..."),document.addEventListener("DOMContentLoaded",Ms)):(console.log("‚úÖ DOM already loaded, initializing immediately"),Ms());typeof window<"u"&&(window.operatorDebug={version:"1.0.0",timestamp:new Date().toISOString(),userAgent:navigator.userAgent,chromeAvailable:typeof chrome<"u",extensionId:chrome?.runtime?.id||"unknown"},console.log("üîß Debug info:",window.operatorDebug));export{Pi as b,mt as c,Ys as m};
